<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>markdownæ–‡ä»¶è½¬æˆpdfæ–‡ä»¶</title>
    <link href="/2025/05/23/markdown%E6%96%87%E4%BB%B6%E8%BD%AC%E6%88%90pdf%E6%96%87%E4%BB%B6/"/>
    <url>/2025/05/23/markdown%E6%96%87%E4%BB%B6%E8%BD%AC%E6%88%90pdf%E6%96%87%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€æ–¹æ³•ä¸€å€ŸåŠ©vscodeæ’ä»¶ä¸æµè§ˆå™¨">ä¸€ã€æ–¹æ³•ä¸€&quot;å€ŸåŠ©vscodeæ’ä»¶ä¸æµè§ˆå™¨&quot;</h1><h2 id="vscodeå®‰è£…æ’ä»¶">1.1 vscodeå®‰è£…æ’ä»¶</h2><p>å®‰è£…æ’ä»¶ï¼šMarkdown Preview Enhanced</p><figure><img src="https://s2.loli.net/2025/05/23/VESg2QucfkCM6Uz.png" alt="image-20250523165809819" /><figcaption>image-20250523165809819</figcaption></figure><h2 id="æ‰“å¼€mdæ–‡ä»¶åŠé¢„è§ˆ">1.2 æ‰“å¼€mdæ–‡ä»¶åŠé¢„è§ˆ</h2><figure><img src="https://s2.loli.net/2025/05/23/Guy7VXMIHdC6RpQ.png" alt="image-20250523170311961" /><figcaption>image-20250523170311961</figcaption></figure><h2 id="é¢„è§ˆè§†å›¾ä¸­å†ä»æµè§ˆå™¨ä¸­æ‰“å¼€">1.3 é¢„è§ˆè§†å›¾ä¸­å†ä»æµè§ˆå™¨ä¸­æ‰“å¼€</h2><figure><img src="https://s2.loli.net/2025/05/23/IWhFK1uBxeZi4Nb.png" alt="image-20250523170413227" /><figcaption>image-20250523170413227</figcaption></figure><h2 id="æµè§ˆå™¨ä¸­æŸ¥çœ‹æ•ˆæœ">1.4 æµè§ˆå™¨ä¸­æŸ¥çœ‹æ•ˆæœ</h2><p>æ­¤æ—¶å¯ä»¥åœ¨é»˜è®¤æµè§ˆå™¨ä¸­çœ‹åˆ°markdownæ–‡ä»¶è¢«è§£æåçš„æ•ˆæœï¼Œè·Ÿvscodeä¸­çœ‹åˆ°çš„é¢„è§ˆè§†å›¾æ•ˆæœä¸€æ ·</p><figure><img src="https://s2.loli.net/2025/05/23/ZqwpUFvxPEd1uJ8.png" alt="image-20250523170500900" /><figcaption>image-20250523170500900</figcaption></figure><h2 id="ä»¥pdfæ ¼å¼æ‰“å°">1.5 ä»¥pdfæ ¼å¼æ‰“å°</h2>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>å¤§è¯­è¨€æ¨¡å‹MCPå­¦ä¹ 03-MCPå®ç°å¯¹MySQLæ•°æ®åº“çš„æ“ä½œ</title>
    <link href="/2025/05/22/%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8BMCP%E5%AD%A6%E4%B9%A003-MCP%E5%AE%9E%E7%8E%B0%E5%AF%B9MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%93%8D%E4%BD%9C/"/>
    <url>/2025/05/22/%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8BMCP%E5%AD%A6%E4%B9%A003-MCP%E5%AE%9E%E7%8E%B0%E5%AF%B9MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%93%8D%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€èƒŒæ™¯ä¸éœ€æ±‚">ä¸€ã€èƒŒæ™¯ä¸éœ€æ±‚</h1><p>æœ¬æ–‡èƒ½å¤Ÿç†Ÿç»ƒä½¿ç”¨Pythonè¯­è¨€ï¼Œèƒ½å¯¹MySQLæ•°æ®åº“ã€å¸¸è§çš„AIå·¥å…·è¿›è¡Œæ“ä½œã€‚</p><p>åœ¨å½“å‰MCPæœåŠ¡å¼€å‘ç¤¾åŒºå†…ï¼Œæˆ‘å‘ç°åœ¨ç½‘ä¸Šï¼ˆä¸»è¦æ˜¯mcp.soï¼‰ä¸Šå¹¶æ²¡æœ‰æ‰¾åˆ°ä¸€ä¸ªèƒ½å¤Ÿå®Œå…¨æ­£å¸¸é€šè¿‡<strong>è¿œç¨‹æœåŠ¡</strong>æ–¹å¼è¿è¡Œçš„æ“ä½œMySQLæ•°æ®åº“çš„MCPæœåŠ¡ç«¯ï¼Œä½†æˆ‘åœ¨ä½¿ç”¨LLMæ—¶åˆæœ‰æ“ä½œMySQLæ•°æ®åº“çš„éœ€æ±‚ï¼Œæ‰€ä»¥æˆ‘æƒ³è‡ªå·±å¼€å‘ä¸€ä¸ªé€šè¿‡<strong>æœ¬åœ°è¿è¡Œ</strong>æ–¹å¼è¿è¡Œçš„æ“ä½œMySQLæ•°æ®åº“çš„MCPæœåŠ¡ç«¯ã€‚</p><p>ç”±äºå¹³æ—¶æœ‰å·¥ä½œï¼Œä¸”æœ€è¿‘åšçš„å·¥ä½œä¹Ÿæ²¡æœ‰ç›´æ¥ä¸MCPç›¸å…³ã€‚æ‰€ä»¥è€ƒè™‘åˆ°æ—¶é—´çš„ç´§è¿«æ€§ä¸è‡ªå·±å¯¹äºpython MCP SDKä¸å¤Ÿç†Ÿç»ƒï¼Œæ‰€ä»¥è‡ªå·±æƒ³é€šè¿‡LLMæ¥å®Œæˆâ€œç¼–å†™MCPæœåŠ¡ç«¯ä»£ç â€è¿™ä¸ªå·¥ä½œï¼Œè‡ªå·±ä¸»è¦ç¼–å†™LLMçš„æç¤ºè¯å³å¯ã€‚ç„¶åè‡ªå·±é€šè¿‡è‡ªå·±å·²ç»æŒæ¡çš„æ–¹æ³•å°†å…¶éƒ¨ç½²åˆ°traeè¿™ä¸ªå·¥å…·ä¸­è¿›è¡Œä½¿ç”¨ã€‚</p><h1 id="äºŒç¯å¢ƒä¿¡æ¯">äºŒã€ç¯å¢ƒä¿¡æ¯</h1><h2 id="mysqlæ•°æ®åº“">2.1 MySQLæ•°æ®åº“</h2><ul><li>MySQLæ•°æ®åº“æœåŠ¡æ‰€åœ¨IPã€è¿œç¨‹è®¿é—®ç”¨æˆ·åã€å¯†ç ä¸æ•°æ®åº“åç§°åˆ†åˆ«æ˜¯ï¼š172.20.0.22ã€rootã€root@123ã€test01ã€‚</li><li>MySQLæ•°æ®åº“ç‰ˆæœ¬ï¼š10.5.6-MariaDB-1:10.5.6+maria~focal</li></ul><h2 id="å®¢æˆ·ç«¯ç¯å¢ƒ">2.2 å®¢æˆ·ç«¯ç¯å¢ƒ</h2><ul><li>è”æƒ³ç¬”è®°æœ¬ç”µè„‘ï¼Œwin11æ“ä½œç³»ç»Ÿ</li><li>å·²ç»å®‰è£…å¥½uvå·¥å…·</li><li>python3.11</li></ul><h1 id="ä¸‰å…·ä½“å®æ–½æ­¥éª¤">ä¸‰ã€å…·ä½“å®æ–½æ­¥éª¤</h1><p>ä½¿ç”¨Claudeï¼ˆä½¿ç”¨traceä¹Ÿå¯ä»¥ï¼‰è¿™ä¸ªå·¥å…·åŠå…¶ä¸­çš„Claude3.7 LLMæ¥å¸®åŠ©æˆ‘ç¼–å†™pythonä»£ç ã€‚</p><h2 id="æ’°å†™mcpåº”ç”¨æœåŠ¡ç«¯ä»£ç ">3.1 æ’°å†™MCPåº”ç”¨æœåŠ¡ç«¯ä»£ç </h2><p>è‡ªå·±ç¼–å†™çš„æç¤ºè¯å¦‚ä¸‹ï¼š</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vim">ä½ ä½œä¸ºä¸€ä¸ªå¤§æ¨¡å‹å¼€å‘å·¥ç¨‹å¸ˆï¼Œç°åœ¨éœ€è¦å¼€å‘ä¸€ä¸ªMCPåº”ç”¨ï¼Œè¿™ä¸ªåº”ç”¨çš„åŠŸèƒ½ä¸»è¦æ˜¯å¯¹MySQLæ•°æ®åº“è¿›è¡Œåˆ›å»ºè¡¨ä»¥åŠå¢åˆ æ”¹æŸ¥æ“ä½œã€‚<br>- è¦æ±‚<br> -è¯·ç”¨<span class="hljs-keyword">python3</span>è¯­è¨€å®ç°MCPæœåŠ¡ç«¯<br> -æ­¤æ¬¡ä½¿ç”¨çš„<span class="hljs-keyword">python</span> MCP SDKçš„ç‰ˆæœ¬æ˜¯<span class="hljs-number">1.9</span>.<span class="hljs-number">0</span><br> -è¯·ç»™å‡ºæµ‹è¯•æ—¶éœ€è¦ç”¨åˆ°çš„å®¢æˆ·ç«¯ä»£ç <br></code></pre></td></tr></table></figure><p>ç„¶åLLMä¼šç»™å‡ºæœåŠ¡ç«¯pythonä»£ç çš„å†…å®¹ï¼Œä»¥åŠä½¿ç”¨è¯´æ˜ã€‚</p><ul><li><p>å°†ä¸Šè¿°ç”Ÿæˆçš„æœåŠ¡ç«¯ä»£ç ä¿å­˜ä¸ºmain.pyã€‚å¹¶ä¿®æ”¹å…¶ä¸­çš„æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼ˆæš‚æ—¶æœªå¯¹MySQLçš„è¿æ¥ä¿¡æ¯åŠè¿æ¥è¿‡ç¨‹è¿›è¡Œä¿®æ”¹ä¸å°è£…ï¼‰</p></li><li><p>åŒæ—¶LLMè¿˜æç¤ºæˆ‘è¿è¡Œæ­¤æœåŠ¡ç«¯ä»£ç æ—¶éœ€è¦å®‰è£…çš„pythonåº“åˆ—è¡¨ï¼Œå°†è¿™äº›å†…å®¹ä¿å­˜ä¸ºrequirements.txtæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">aiomysql</span>==<span class="hljs-number">0</span>.<span class="hljs-number">2</span>.<span class="hljs-number">0</span><br><span class="hljs-attribute">mcp</span>&gt;=<span class="hljs-number">1</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span><br><span class="hljs-attribute">asyncio</span><br><span class="hljs-attribute">typing</span><br><span class="hljs-attribute">logging</span><br></code></pre></td></tr></table></figure><h2 id="ä¸ºæœåŠ¡ç«¯è¿è¡Œé…ç½®ç¯å¢ƒ">3.2 ä¸ºæœåŠ¡ç«¯è¿è¡Œé…ç½®ç¯å¢ƒ</h2><p>ä»¥ç®¡ç†å‘˜æƒé™æ‰“å¼€win11çš„cmdçª—å£ï¼Œç„¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»ºç›®å½•manipulate_mysql</span><br>E:\Hdisk\å­¦ä¹ \06_AIå­¦ä¹ \13_LatestTechKnowledge\01_MCP\try01&gt;uv init manipulate_mysql<br>E:\Hdisk\å­¦ä¹ \06_AIå­¦ä¹ \13_LatestTechKnowledge\01_MCP\try01&gt;cd manipulate_mysql<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨uvåˆ›å»ºè™šæ‹Ÿpythonç¯å¢ƒ</span><br>E:\Hdisk\å­¦ä¹ \06_AIå­¦ä¹ \13_LatestTechKnowledge\01_MCP\try01\manipulate_mysql&gt;uv venv<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ¿€æ´»æ­¤è™šæ‹Ÿpythonç¯å¢ƒ</span><br>E:\Hdisk\å­¦ä¹ \06_AIå­¦ä¹ \13_LatestTechKnowledge\01_MCP\try01\manipulate_mysql&gt;.venv\Scripts\activate<br>(manipulate_mysql) E:\Hdisk\å­¦ä¹ \06_AIå­¦ä¹ \13_LatestTechKnowledge\01_MCP\try01\manipulate_mysql&gt;<br></code></pre></td></tr></table></figure><p>å°†å‰é¢ç”Ÿæˆçš„main.pyä¸requirements.txt æ–‡ä»¶æ”¾åˆ°manipulate_mysql ç›®å½•ä¸‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…ä¾èµ–</span><br>(manipulate_mysql) E:\Hdisk\å­¦ä¹ \06_AIå­¦ä¹ \13_LatestTechKnowledge\01_MCP\try01\manipulate_mysql&gt;uv pip install -r requirements.txt<br></code></pre></td></tr></table></figure><h2 id="è°ƒè¯•">3.2 è°ƒè¯•</h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-comment">#å®‰è£…è°ƒè¯•ç›¸å…³å·¥å…·</span><br><span class="hljs-params">(manipulate_mysql)</span> E:\Hdisk\å­¦ä¹ \06_AIå­¦ä¹ \13_LatestTechKnowledge\01_MCP\<span class="hljs-keyword">try</span>01\manipulate_mysql&gt;uv add <span class="hljs-string">&quot;mcp[cli]&quot;</span> httpx<br><br><span class="hljs-comment">#å¯åŠ¨è°ƒè¯•</span><br><span class="hljs-params">(manipulate_mysql)</span> E:\Hdisk\å­¦ä¹ \06_AIå­¦ä¹ \13_LatestTechKnowledge\01_MCP\<span class="hljs-keyword">try</span>01\manipulate_mysql&gt;mcp dev main.py<br></code></pre></td></tr></table></figure><figure><img src="https://s2.loli.net/2025/05/22/SKCx8WXI2grjOdf.png" alt="image-20250522235037047" /><figcaption>image-20250522235037047</figcaption></figure><p>è°ƒè¯•æ—¶æ˜¾ç¤ºå¯æ­£å¸¸ä½¿ç”¨ã€‚</p><h2 id="å‘½ä»¤è¡Œéƒ¨ç½²æœåŠ¡ç«¯">3.3 å‘½ä»¤è¡Œéƒ¨ç½²æœåŠ¡ç«¯</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">(manipulate_mysql) E:\Hdisk\å­¦ä¹ \06_AIå­¦ä¹ \13_LatestTechKnowledge\01_MCP\try01\manipulate_mysql&gt;uv run main.py<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯æ­¤æ—¶å°±æŠ¥é”™ï¼Œæç¤ºå¦‚ä¸‹ï¼š</p><figure><img src="https://s2.loli.net/2025/05/22/vGAIOPSoibBmr4j.png" alt="image-20250522235255115" /><figcaption>image-20250522235255115</figcaption></figure><p>è§£å†³åŠæ³•å¦‚ä¸‹ï¼ˆå°†å¦‚ä¸‹tryä¸­è¯­å¥æ”¹æˆï¼šapp.run(transport=&quot;stdio&quot;)ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    try:<br>        app.run(transport=<span class="hljs-string">&quot;stdio&quot;</span>)<br>    except Exception as e:<br>        logger.error(f<span class="hljs-string">&quot;ç¨‹åºå¯åŠ¨å¤±è´¥: &#123;e&#125;&quot;</span>, exc_info=True)<br>        sys.<span class="hljs-keyword">exit</span>(<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><p>åŸå› åˆ†æå¦‚ä¸‹ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs routeros">æ ¹æ®LLMæç¤ºï¼šè¿™ä¸ªé—®é¢˜çš„æ ¹æœ¬åŸå› åœ¨äº FastMCP å’Œä¼ ç»Ÿ MCP æœåŠ¡å™¨çš„åˆå§‹åŒ–å’Œè¿è¡Œæœºåˆ¶ä¸åŒã€‚<br><br>FastMCP æ˜¯ä¸€ä¸ªé«˜çº§å°è£…çš„ MCP æ¡†æ¶ï¼Œå®ƒå†…éƒ¨å¤„ç†äº†æ‰€æœ‰å¿…ìš”çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼ŒåŒ…æ‹¬ï¼š<br>è‡ªåŠ¨è®¾ç½® notification options<br>å¤„ç† capabilities åå•†<br>ç®¡ç†å·¥å…·æ³¨å†Œå’Œé€šçŸ¥æœºåˆ¶<br><br>è€ŒåŸå…ˆçš„æ–¹å¼ï¼Œâ€œå½“ä½ æ‰‹åŠ¨åˆ›å»º stdio_server() å¹¶è°ƒç”¨ app.<span class="hljs-built_in">run</span>() æ—¶ï¼ŒFastMCP æœŸæœ›çš„æŸäº›åˆå§‹åŒ–æ­¥éª¤å¯èƒ½æ²¡æœ‰æ­£ç¡®æ‰§è¡Œï¼Œç‰¹åˆ«æ˜¯ notification_options æ²¡æœ‰è¢«æ­£ç¡®è®¾ç½®ï¼Œå¯¼è‡´åœ¨è®¿é—® notification_options.tools_changed æ—¶å‡ºç° NoneType é”™è¯¯ã€‚â€<br><br>ä¸ºä»€ä¹ˆ app.<span class="hljs-built_in">run</span>(<span class="hljs-attribute">transport</span>=<span class="hljs-string">&quot;stdio&quot;</span>) èƒ½è§£å†³é—®é¢˜ï¼š<br>å®Œæ•´çš„åˆå§‹åŒ–æµç¨‹ï¼šapp.<span class="hljs-built_in">run</span>(<span class="hljs-attribute">transport</span>=<span class="hljs-string">&quot;stdio&quot;</span>) ä¼šè‡ªåŠ¨å¤„ç†æ‰€æœ‰å¿…è¦çš„åˆå§‹åŒ–æ­¥éª¤<br>æ­£ç¡®çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼šFastMCP å†…éƒ¨ç®¡ç†è¿æ¥çš„å»ºç«‹ã€ç»´æŠ¤å’Œæ¸…ç†<br>è‡ªåŠ¨çš„ capabilities è®¾ç½®ï¼šæ¡†æ¶ä¼šè‡ªåŠ¨è®¾ç½®æ­£ç¡®çš„ notification_options<br></code></pre></td></tr></table></figure><p>ä¹‹åï¼Œå†åœ¨å‘½ä»¤å¯åŠ¨æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å°†ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ï¼š</p><figure><img src="https://s2.loli.net/2025/05/22/vc7EnQx6MPOIUFW.png" alt="image-20250522235536082" /><figcaption>image-20250522235536082</figcaption></figure><p>æ­£å¸¸ã€‚</p><h2 id="cursorä¸­é…ç½®è‡ªå®šä¹‰mcpæœåŠ¡ç«¯">3.4 cursorä¸­é…ç½®è‡ªå®šä¹‰MCPæœåŠ¡ç«¯</h2><p>File-&gt;Preferences-&gt;Cursor Settingsï¼Œçœ‹åˆ°å¦‚ä¸‹ç•Œé¢ï¼š</p><figure><img src="https://s2.loli.net/2025/05/22/r8Dxk7G6eYBVHLg.png" alt="image-20250522235804195" /><figcaption>image-20250522235804195</figcaption></figure><p>ç‚¹å‡»ä¸Šè¿°&quot;Add new global MCP server&quot;ï¼Œå°†æ˜¾ç¤ºä¸€ä¸ªmcp.jsonæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;mcpServers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;manipulate_mysqlmo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;disabled&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;timeout&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">180</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;command&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;uv&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;args&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-string">&quot;--directory&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;E:\\Hdisk\\å­¦ä¹ \\06_AIå­¦ä¹ \\13_LatestTechKnowledge\\01_MCP\\try01\\manipulate_mysql&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;run&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;main.py&quot;</span><br>      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;transportType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;stdio&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­â€œE:\Hdisk\å­¦ä¹ \06_AIå­¦ä¹ \13_LatestTechKnowledge\01_MCP\try01\manipulate_mysqlâ€æ˜¯æˆ‘çš„MCPæœåŠ¡ä»£ç çš„è·¯å¾„ã€‚</p><p>å›åˆ°Cursor Settingsç•Œé¢ï¼Œä¿è¯â€œEnabledâ€å¯ç”¨ï¼Œç„¶åç‚¹å‡»â€œåˆ·æ–°â€æŒ‰é’®ï¼Œå½“mcpæœåŠ¡çš„å·¦è¾¹å‡ºç°ä¸€ä¸ªç»¿ç‚¹æ—¶ï¼Œè¡¨ç¤ºå…¶æ­£å¸¸å·¥ä½œäº†ã€‚</p><figure><img src="https://s2.loli.net/2025/05/23/fIPFQDcoC2xRWUl.png" alt="image-20250523000111236" /><figcaption>image-20250523000111236</figcaption></figure><h2 id="cursorä¸­ä½¿ç”¨è‡ªå®šä¹‰mcpæœåŠ¡ç«¯">3.5 cursorä¸­ä½¿ç”¨è‡ªå®šä¹‰MCPæœåŠ¡ç«¯</h2><figure><img src="https://s2.loli.net/2025/05/23/TMZNAqc2oQry5CO.png" alt="image-20250523000457842" /><figcaption>image-20250523000457842</figcaption></figure>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤§æ¨¡å‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¤§è¯­è¨€æ¨¡å‹MCPå­¦ä¹ 02-åœ¨claudeä¸­ä½¿ç”¨mcpåº”ç”¨</title>
    <link href="/2025/05/19/%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8BMCP%E5%AD%A6%E4%B9%A002-%E5%9C%A8claude%E4%B8%AD%E4%BD%BF%E7%94%A8mcp%E5%BA%94%E7%94%A8/"/>
    <url>/2025/05/19/%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8BMCP%E5%AD%A6%E4%B9%A002-%E5%9C%A8claude%E4%B8%AD%E4%BD%BF%E7%94%A8mcp%E5%BA%94%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€å®æ–½æ­¥éª¤">ä¸€ã€å®æ–½æ­¥éª¤</h1><h2 id="éœ€è¦çš„å·¥å…·æˆ–è½¯ä»¶">1.1 éœ€è¦çš„å·¥å…·æˆ–è½¯ä»¶</h2><p>å®‰è£… Claude Desktopï¼ˆéœ€è¦é­”æ³•ï¼‰</p><p>Python 3.10+ ç¯å¢ƒï¼ˆä¸‹è¿°æ­¥éª¤ä¸­ä¼šå®‰è£…ï¼‰</p><p>Python MCP SDK 1.2.0+ï¼ˆä¸‹è¿°æ­¥éª¤ä¸­ä¼šå®‰è£…ï¼‰</p><h2 id="é…ç½®åº”ç”¨ç¯å¢ƒ">1.2 é…ç½®åº”ç”¨ç¯å¢ƒ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…uvï¼ŒæŸ¥çœ‹å…¶githubå®˜æ–¹ç½‘å€â€œhttps://github.com/astral-sh/uvâ€</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">åœ¨Windowsä¸Šï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</span><br>powershell -ExecutionPolicy ByPass -c &quot;irm https://astral.sh/uv/install.ps1 | iex&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ç®¡ç†å‘˜æ¨¡å¼æ‰“å¼€cmdçª—å£ä¸­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ã€‚</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»ºé¡¹ç›®ç›®å½•</span><br>E:\Hdisk\å­¦ä¹ \06_AIå­¦ä¹ \13_LatestTechKnowledge\01_MCP\try02&gt;uv init scan_kantu<br>Initialized project `scan-kantu` at `E:\Hdisk\å­¦ä¹ \06_AIå­¦ä¹ \13_LatestTechKnowledge\01_MCP\try02\scan_kantu`<br><br>E:\Hdisk\å­¦ä¹ \06_AIå­¦ä¹ \13_LatestTechKnowledge\01_MCP\try02&gt;cd scan_kantu<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">ä½¿ç”¨uvåˆ›å»ºè™šæ‹Ÿpythonç¯å¢ƒå¹¶æ¿€æ´»ï¼ˆè¿™é‡Œé»˜è®¤å°±æ˜¯ä½¿ç”¨CPython3.11.12ï¼‰</span><br>E:\Hdisk\å­¦ä¹ \06_AIå­¦ä¹ \13_LatestTechKnowledge\01_MCP\try02\scan_kantu&gt;uv venv<br>Using CPython 3.11.12<br>Creating virtual environment at: .venv<br>Activate with: .venv\Scripts\activate<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ­¤æ—¶åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªåä¸ºâ€œ.python-versionâ€çš„æ–‡ä»¶ï¼Œé‡Œé¢å†…å®¹åŒ…å«â€œ3.11â€</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">(1)å¦‚æœä¸æ˜ç¡®æŒ‡å®šä½¿ç”¨çš„pythonç‰ˆæœ¬ï¼Œuvä¼šé»˜è®¤æœ‰è‡ªå·±çš„æœºåˆ¶å»å†³å®šä½¿ç”¨å“ªä¸ªpythonç‰ˆæœ¬</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨<span class="hljs-string">&quot;uv python list&quot;</span>å¯ä»¥çœ‹åˆ°uvå½“å‰èƒ½çœ‹åˆ°ä¸ä½¿ç”¨çš„pythonç¯å¢ƒä¸ç‰ˆæœ¬(è€Œä¸”uvè‡ªå·±ä¼šç»´æŠ¤è·Ÿè‡ªå·±ç‰ˆæœ¬åŒ¹é…çš„pythonç¯å¢ƒ)ï¼Œåç»­å¦‚æœä¸ç»™uvå‘½ä»¤åŠ --pythonå‚æ•°æŒ‡å®špythonç‰ˆæœ¬ï¼Œå®ƒä¼šé¦–é€‰åœ¨è‡ªå·±ç»´æŠ¤çš„pythonç¯å¢ƒåˆ—è¡¨ä¸­æŸ¥æ‰¾ä¸€ä¸ªå·²ç»å®‰è£…äº†çš„ã€æœ€åŒ¹é…çš„pythonç‰ˆæœ¬ï¼ˆä»ä¸‹é¢å†…å®¹å¯çŸ¥ï¼Œå®ƒä»è‡ªå·±ç»´æŠ¤çš„python3.10.16ä¸python3.11.12 ä¸¤ä¸ªpythonç‰ˆæœ¬ä¸­ï¼Œé€‰æ‹©äº†åè€…ï¼‰ï¼Œæ•´ä¸ªè¿‡ç¨‹é€šè¿‡â€œuv init xxx --verboseâ€å¯ä»¥çœ‹å¾—æ›´æ¸…æ¥š</span><br>E:\Hdisk\å­¦ä¹ \06_AIå­¦ä¹ \13_LatestTechKnowledge\01_MCP\try01\add_numbers&gt;uv python list<br>cpython-3.14.0a6-windows-x86_64-none                 &lt;download available&gt;<br>cpython-3.14.0a6+freethreaded-windows-x86_64-none    &lt;download available&gt;<br>cpython-3.13.3-windows-x86_64-none                   C:\Python313\python.exe<br>cpython-3.13.3-windows-x86_64-none                   C:\ProgramData\chocolatey\bin\python3.13.exe<br>cpython-3.13.3-windows-x86_64-none                   &lt;download available&gt;<br>cpython-3.13.3+freethreaded-windows-x86_64-none      &lt;download available&gt;<br>cpython-3.12.10-windows-x86_64-none                  &lt;download available&gt;<br>cpython-3.12.7-windows-x86_64-none                   D:\ProgramData\anaconda3\python.exe<br>cpython-3.11.12-windows-x86_64-none                  C:\Users\jiangsanyin\AppData\Roaming\uv\python\cpython-3.11.12-windows-x86_64-none\python.exe<br>cpython-3.10.17-windows-x86_64-none                  &lt;download available&gt;<br>cpython-3.10.16-windows-x86_64-none                  C:\Users\jiangsanyin\AppData\Roaming\uv\python\cpython-3.10.16-windows-x86_64-none\python.exe<br>cpython-3.9.22-windows-x86_64-none                   &lt;download available&gt;<br>cpython-3.8.20-windows-x86_64-none                   &lt;download available&gt;<br>cpython-3.7.9-windows-x86_64-none                    &lt;download available&gt;<br><span class="hljs-meta prompt_">#</span><span class="language-bash">(2)ä¹Ÿå¯ä»¥åœ¨ä½¿ç”¨uv init xxxå‘½ä»¤æ—¶ï¼Œæ˜ç¡®æŒ‡å®šè¦ä½¿ç”¨çš„pythonç‰ˆæœ¬</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ¯”å¦‚ï¼šâ€œuv init scan_kantu --python 3.12â€</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ­¤æ—¶ï¼Œscan_kantu ç›®å½•ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª.python-versionæ–‡ä»¶ï¼Œå…¶ä¸­çš„å†…å®¹æ˜¯ 3.12</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç„¶åæ‰§è¡Œâ€œuv venvâ€æ—¶å°†ä¼šåˆå§‹åŒ–è¿™ä¸ªè™šæ‹Ÿpythonç¯å¢ƒï¼Œå¦‚æœuvç»´æŠ¤çš„pythonç¯å¢ƒæ²¡æœ‰æ­¤ç‰ˆæœ¬ï¼Œå°†ä¼šä½¿ç”¨ä¸Šè¿°pythonåˆ—è¡¨ä¸­åŒ¹é…pythonç‰ˆæœ¬(ä½†ä¸ä¼šä½¿ç”¨åŒä¸€ä¸ªpythonå¯æ‰§è¡Œæ–‡ä»¶ï¼Œè€Œæ˜¯ä¼šæ–°åˆ›å»ºä¸€ä¸ª)</span><br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">#è§£é™¤ç¦æ­¢è¿è¡Œè„šæœ¬çš„é™åˆ¶ï¼ˆåœ¨powershellçª—å£ä¸­æ‰§è¡Œã€‚å…¶ä½™æœªè¯´æ˜çš„å°±æ˜¯åœ¨cmdçª—å£ä¸­æ‰§è¡Œï¼‰</span><br>E:\Hdisk\å­¦ä¹ \<span class="hljs-number">06</span>_AIå­¦ä¹ \<span class="hljs-number">13</span>_LatestTechKnowledge\<span class="hljs-number">01</span>_MCP\try02\scan_kantu&gt;<span class="hljs-built_in">set-ExecutionPolicy</span> RemoteSigned<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ¿€æ´»</span><br>E:\Hdisk\å­¦ä¹ \06_AIå­¦ä¹ \13_LatestTechKnowledge\01_MCP\try02\scan_kantu&gt;.venv\Scripts\activate<br>(scan_kantu) E:\Hdisk\å­¦ä¹ \06_AIå­¦ä¹ \13_LatestTechKnowledge\01_MCP\try02\scan_kantu&gt;python -V<br>Python 3.11.12<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å®‰è£…ä¾èµ–</span><br>(scan_kantu) E:\Hdisk\å­¦ä¹ \06_AIå­¦ä¹ \13_LatestTechKnowledge\01_MCP\try02\scan_kantu&gt;uv add &quot;mcp[cli]&quot; httpx<br></code></pre></td></tr></table></figure><h2 id="ç¼–å†™æç¤ºè¯">1.3 ç¼–å†™æç¤ºè¯</h2><p>åœ¨ windows ä¸Šè¿›è¡Œå¼€å‘æµ‹è¯•ï¼Œä½¿ç”¨å¦‚ä¸‹æç¤ºè¯ï¼Œä»¥è®©LLMä¸ºæˆ‘ä»¬è‡ªåŠ¨ç”ŸæˆmcpæœåŠ¡ç«¯æ–‡ä»¶ï¼ˆæˆ‘ä»¥çœ‹å›¾ç‹è¿™ä¸ªè½¯ä»¶ä¸ºä¾‹ï¼Œæ˜¯å› ä¸ºå…¶æ€»æ˜¯è¯•å›¾ä¿®æ”¹æˆ‘ç”µè„‘ä¸Šæ‰“å¼€pdfæˆ–å›¾ç‰‡çš„é»˜è®¤è½¯ä»¶ï¼Œè®©æˆ‘è§‰å¾—æ¯”è¾ƒçƒ¦ï¼Œæƒ³å¹²æ‰å®ƒã€‚å½“ç„¶æœ‰å…¶ä»–å¯è¡Œçš„æ–¹æ³•å®Œå…¨å°†å…¶å¸è½½ï¼Œæ­¤å¤„ä¸æ¢è®¨ï¼‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">æ‰“é€ ä¸€ä¸ª MCP æœåŠ¡å™¨ï¼Œå®ƒèƒ½å¤Ÿï¼š<br>- åŠŸèƒ½ï¼š<br>    - ç»Ÿè®¡å½“å‰æ¡Œé¢ä¸Šçš„æ˜¯å¦å­˜åœ¨åç§°ä¸­åŒ…å«â€œçœ‹å›¾â€çš„å¿«æ·æ–¹å¼<br>    - è·å–å¯¹åº”å¿«æ·æ–¹å¼çš„åå­—<br><br>- è¦æ±‚ï¼š<br>    - ä½ å¯ä»¥å‡è®¾æˆ‘çš„æ¡Œé¢è·¯å¾„ä¸º C:\Users\&#123;username&#125;\Desktop<br></code></pre></td></tr></table></figure><p>æˆ–è€…ï¼Œå¦‚æœæˆ‘ä»¬å¯¹å…¶ä»–ç±»å‹æ–‡ä»¶æ¯”å¦‚.pyã€.javaç­‰æ„Ÿå…´è¶£ï¼Œå¯ä»¥ç¼–å†™å¦‚ä¸‹æç¤ºè¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">æ‰“é€ ä¸€ä¸ª MCP æœåŠ¡å™¨ï¼Œå®ƒèƒ½å¤Ÿï¼š<br>- åŠŸèƒ½ï¼š<br>    - æ£€æŸ¥å½“å‰æ¡Œé¢ä¸Šçš„æ˜¯å¦å­˜åœ¨pythonæºç æ–‡ä»¶<br>    - è·å–pythonæºç æ–‡ä»¶çš„åå­—<br>    - è§£è¯»pythonæºç æ–‡ä»¶çš„å†…å®¹<br><br>- è¦æ±‚ï¼š<br>    - ä½ å¯ä»¥å‡è®¾æˆ‘çš„æ¡Œé¢è·¯å¾„ä¸º C:\Users\&#123;username&#125;\Desktop<br></code></pre></td></tr></table></figure><p>æˆ–è€…ï¼Œå¦‚æœæˆ‘ä»¬å¯¹å…¶ä»–ç±»å‹æ–‡ä»¶ï¼ˆæˆ–å¿«æ·æ–¹å¼ï¼‰æ¯”å¦‚æ“ä½œæ•°æ®åº“çš„å®¢æˆ·ç«¯è½¯ä»¶æ„Ÿå…´è¶£ï¼Œå¯ä»¥ç¼–å†™å¦‚ä¸‹æç¤ºè¯ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs markdown">æ‰“é€ ä¸€ä¸ª MCP æœåŠ¡å™¨ï¼Œå®ƒèƒ½å¤Ÿï¼š<br><span class="hljs-bullet">-</span> åŠŸèƒ½ï¼š<br><span class="hljs-bullet">    -</span> æ£€æŸ¥å½“å‰æ¡Œé¢ä¸Šçš„æ˜¯å¦å­˜åœ¨â€œè¿æ¥ä¸æ“ä½œæ•°æ®åº“çš„å®¢æˆ·ç«¯è½¯ä»¶â€çš„å¿«æ·æ–¹å¼æˆ–å·¥å…·<br><span class="hljs-bullet">    -</span> è·å–è¿™ç±»å¿«æ·æ–¹å¼æˆ–å·¥å…·çš„åå­—<br><br><span class="hljs-bullet">-</span> è¦æ±‚ï¼š<br><span class="hljs-bullet">    -</span> ä½ å¯ä»¥å‡è®¾æˆ‘çš„æ¡Œé¢è·¯å¾„ä¸º C:\Users\&#123;username&#125;\Desktop<br></code></pre></td></tr></table></figure><h2 id="ç¼–å†™mcpæœåŠ¡ç«¯æ–‡ä»¶">1.4 ç¼–å†™mcpæœåŠ¡ç«¯æ–‡ä»¶</h2><p>ä½¿ç”¨ Claude 3.7 å¤§æ¨¡å‹ç›´æ¥ç”Ÿæˆç›¸å…³ä»£ç ï¼ˆè¾“å‡ºç±»ä¼¼å¦‚ä¸‹å›¾ã€‚è®°å¾—æ ¹æ®å¼€å‘ç¯å¢ƒæ“ä½œç³»ç»Ÿä½¿ç”¨ä¸åŒçš„æç¤ºè¯ï¼‰ã€‚</p><p>è¾“å…¥æç¤ºè¯å‰ï¼Œè¿˜éœ€è¦ä¸Šä¼ ä¸€ä¸ªREADME.mdæ–‡ä»¶ï¼ˆè¿™ä¸ªæ–‡ä»¶åœ¨æ­¤å¤„å«åšDomain Knowledgeï¼‰ï¼Œä¸‹è½½è‡ªå¦‚ä¸‹é“¾æ¥ï¼š https://raw.githubusercontent.com/modelcontextprotocol/python-sdk/refs/heads/main/README.md</p><figure><img src="https://s2.loli.net/2025/05/18/xNwq3vBSitjgEnQ.png" alt="image-20250518223140526" /><figcaption>image-20250518223140526</figcaption></figure><p>å¯ä»¥ç›´æ¥ä¿å­˜ä¸ºâ€œE:\06_AIå­¦ä¹ \13_LatestTechKnowledge\01_MCP02_kantu_kantu.pyâ€ï¼Œä½œä¸ºmcpæœåŠ¡ç«¯æ–‡ä»¶ã€‚ï¼ˆæœ¬æ¥è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹æ˜¯éœ€è¦å¼€å‘äººå‘˜æ‰‹åŠ¨ç¼–å†™çš„ï¼Œç°ä½¿ç”¨claudeå¸®å¿™ç”Ÿæˆï¼‰</p><figure><img src="https://s2.loli.net/2025/05/18/QAO2mWicbdBZ8KN.png" alt="image-20250518223241719" /><figcaption>image-20250518223241719</figcaption></figure><p>å¦‚ä¸‹æ˜¯åœ¨win11ä¸Šç»è¿‡éªŒè¯å¥½çš„å†…å®¹ï¼ˆæŸäº›æƒ…å†µä¸‹å¦‚æœæœ‰éœ€è¦ï¼Œå¯èƒ½éœ€è¦å¯¹LLMç”Ÿæˆçš„ä»£ç å†ä¿®æ”¹ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> glob<br><span class="hljs-keyword">import</span> win32com.client<br><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path<br><span class="hljs-keyword">from</span> mcp.server.fastmcp <span class="hljs-keyword">import</span> FastMCP, Context<br><br><span class="hljs-comment"># åˆ›å»º MCP æœåŠ¡å™¨</span><br>mcp = FastMCP(<span class="hljs-string">&quot;æ¡Œé¢å¿«æ·æ–¹å¼æ‰«æå™¨&quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_desktop_path</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;è·å–å½“å‰ç”¨æˆ·çš„æ¡Œé¢è·¯å¾„&quot;&quot;&quot;</span><br>    username = os.environ.get(<span class="hljs-string">&quot;USERNAME&quot;</span>)<br>    <span class="hljs-keyword">return</span> os.path.join(<span class="hljs-string">&quot;C:&quot;</span>, <span class="hljs-string">&quot;Users&quot;</span>, username, <span class="hljs-string">&quot;Desktop&quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_shortcut_target</span>(<span class="hljs-params">shortcut_path</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;è·å–å¿«æ·æ–¹å¼çš„ç›®æ ‡è·¯å¾„&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        shell = win32com.client.Dispatch(<span class="hljs-string">&quot;WScript.Shell&quot;</span>)<br>        shortcut = shell.CreateShortCut(shortcut_path)<br>        <span class="hljs-keyword">return</span> shortcut.TargetPath<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;æ— æ³•è·å–ç›®æ ‡: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">find_shortcuts_with_keyword</span>(<span class="hljs-params">keyword=<span class="hljs-string">&quot;çœ‹å›¾&quot;</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;æŸ¥æ‰¾åŒ…å«ç‰¹å®šå…³é”®è¯çš„å¿«æ·æ–¹å¼&quot;&quot;&quot;</span><br>    desktop_path = get_desktop_path()<br>    shortcuts = []<br>    <br>    <span class="hljs-comment"># æŸ¥æ‰¾æ‰€æœ‰ .lnk æ–‡ä»¶ (Windows å¿«æ·æ–¹å¼)</span><br>    shortcut_files = glob.glob(os.path.join(desktop_path, <span class="hljs-string">&quot;*.lnk&quot;</span>))<br>    <br>    <span class="hljs-keyword">for</span> shortcut_path <span class="hljs-keyword">in</span> shortcut_files:<br>        filename = os.path.basename(shortcut_path)<br>        <span class="hljs-comment"># æ£€æŸ¥æ–‡ä»¶åæ˜¯å¦åŒ…å«å…³é”®è¯</span><br>        <span class="hljs-keyword">if</span> keyword <span class="hljs-keyword">in</span> filename:<br>            target = get_shortcut_target(shortcut_path)<br>            shortcuts.append(&#123;<br>                <span class="hljs-string">&quot;name&quot;</span>: filename,<br>                <span class="hljs-string">&quot;path&quot;</span>: shortcut_path,<br>                <span class="hljs-string">&quot;target&quot;</span>: target<br>            &#125;)<br>    <br>    <span class="hljs-keyword">return</span> shortcuts<br><br><br><span class="hljs-meta">@mcp.tool()</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">count_image_viewers</span>(<span class="hljs-params">ctx: Context</span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;ç»Ÿè®¡æ¡Œé¢ä¸Šåç§°åŒ…å«&#x27;çœ‹å›¾&#x27;çš„å¿«æ·æ–¹å¼æ•°é‡&quot;&quot;&quot;</span><br>    shortcuts = find_shortcuts_with_keyword(<span class="hljs-string">&quot;çœ‹å›¾&quot;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(shortcuts)<br><br><br><span class="hljs-meta">@mcp.tool()</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_image_viewer_names</span>() -&gt; <span class="hljs-built_in">list</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;è·å–æ¡Œé¢ä¸Šæ‰€æœ‰åç§°åŒ…å«&#x27;çœ‹å›¾&#x27;çš„å¿«æ·æ–¹å¼åç§°åˆ—è¡¨&quot;&quot;&quot;</span><br>    shortcuts = find_shortcuts_with_keyword(<span class="hljs-string">&quot;çœ‹å›¾&quot;</span>)<br>    <span class="hljs-keyword">return</span> [shortcut[<span class="hljs-string">&quot;name&quot;</span>] <span class="hljs-keyword">for</span> shortcut <span class="hljs-keyword">in</span> shortcuts]<br><br><br><span class="hljs-meta">@mcp.tool()</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_image_viewer_details</span>() -&gt; <span class="hljs-built_in">list</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;è·å–æ¡Œé¢ä¸Šæ‰€æœ‰åç§°åŒ…å«&#x27;çœ‹å›¾&#x27;çš„å¿«æ·æ–¹å¼è¯¦ç»†ä¿¡æ¯&quot;&quot;&quot;</span><br>    shortcuts = find_shortcuts_with_keyword(<span class="hljs-string">&quot;çœ‹å›¾&quot;</span>)<br>    <span class="hljs-keyword">return</span> shortcuts<br><br><br><span class="hljs-meta">@mcp.resource(<span class="hljs-params"><span class="hljs-string">&quot;desktop://viewers&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_viewers_resource</span>() -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;è·å–æ¡Œé¢ä¸Šçš„å›¾ç‰‡æŸ¥çœ‹å™¨èµ„æºä¿¡æ¯&quot;&quot;&quot;</span><br>    shortcuts = find_shortcuts_with_keyword(<span class="hljs-string">&quot;çœ‹å›¾&quot;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> shortcuts:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æ¡Œé¢ä¸Šæœªæ‰¾åˆ°åŒ…å«&#x27;çœ‹å›¾&#x27;çš„å¿«æ·æ–¹å¼ã€‚&quot;</span><br>    <br>    result = <span class="hljs-string">&quot;æ¡Œé¢ä¸Šæ‰¾åˆ°ä»¥ä¸‹åŒ…å«&#x27;çœ‹å›¾&#x27;çš„å¿«æ·æ–¹å¼ï¼š\n\n&quot;</span><br>    <span class="hljs-keyword">for</span> i, shortcut <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(shortcuts, <span class="hljs-number">1</span>):<br>        result += <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;i&#125;</span>. åç§°: <span class="hljs-subst">&#123;shortcut[<span class="hljs-string">&#x27;name&#x27;</span>]&#125;</span>\n&quot;</span><br>        result += <span class="hljs-string">f&quot;   è·¯å¾„: <span class="hljs-subst">&#123;shortcut[<span class="hljs-string">&#x27;path&#x27;</span>]&#125;</span>\n&quot;</span><br>        result += <span class="hljs-string">f&quot;   ç›®æ ‡: <span class="hljs-subst">&#123;shortcut[<span class="hljs-string">&#x27;target&#x27;</span>]&#125;</span>\n\n&quot;</span><br>    <br>    <span class="hljs-keyword">return</span> result<br><br><br><span class="hljs-meta">@mcp.prompt()</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">how_to_use</span>() -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;æä¾›å¦‚ä½•ä½¿ç”¨æ­¤æœåŠ¡å™¨çš„è¯´æ˜&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">æˆ‘æ˜¯æ¡Œé¢å¿«æ·æ–¹å¼æ‰«æå™¨ï¼Œå¯ä»¥å¸®åŠ©æ‚¨æ£€æŸ¥æ¡Œé¢ä¸Šæ˜¯å¦å­˜åœ¨åŒ…å«&quot;çœ‹å›¾&quot;çš„å¿«æ·æ–¹å¼ã€‚</span><br><span class="hljs-string"></span><br><span class="hljs-string">æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·ï¼š</span><br><span class="hljs-string">1. count_image_viewers - è®¡ç®—æ¡Œé¢ä¸ŠåŒ…å«&quot;çœ‹å›¾&quot;çš„å¿«æ·æ–¹å¼æ•°é‡</span><br><span class="hljs-string">2. get_image_viewer_names - è·å–æ‰€æœ‰åŒ…å«&quot;çœ‹å›¾&quot;çš„å¿«æ·æ–¹å¼åç§°</span><br><span class="hljs-string">3. get_image_viewer_details - è·å–æ‰€æœ‰åŒ…å«&quot;çœ‹å›¾&quot;çš„å¿«æ·æ–¹å¼çš„è¯¦ç»†ä¿¡æ¯</span><br><span class="hljs-string"></span><br><span class="hljs-string">æ‚¨ä¹Ÿå¯ä»¥è®¿é—®ä»¥ä¸‹èµ„æºï¼š</span><br><span class="hljs-string">- desktop://viewers - è·å–æ‰€æœ‰åŒ…å«&quot;çœ‹å›¾&quot;çš„å¿«æ·æ–¹å¼çš„è¯¦ç»†ä¿¡æ¯</span><br><span class="hljs-string"></span><br><span class="hljs-string">è¯·é—®æ‚¨æƒ³äº†è§£å“ªæ–¹é¢çš„ä¿¡æ¯ï¼Ÿ</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    mcp.run()<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°å†…å®¹ä¿å­˜æˆ<code>E:\Hdisk\å­¦ä¹ \06_AIå­¦ä¹ \13_LatestTechKnowledge\01_MCP\try02\scan_kantu\scan_kantu.py</code></p><h2 id="æµ‹è¯•mcpåº”ç”¨">1.5. æµ‹è¯•MCPåº”ç”¨</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">#å®‰è£…pywin32 pythonåº“</span><br>(scan_kantu) E:\Hdisk\å­¦ä¹ \<span class="hljs-number">06</span>_AIå­¦ä¹ \<span class="hljs-number">13</span>_LatestTechKnowledge\<span class="hljs-number">01</span>_MCP\try02\scan_kantu&gt;uv add pywin32<br><br>(scan_kantu) E:\Hdisk\å­¦ä¹ \<span class="hljs-number">06</span>_AIå­¦ä¹ \<span class="hljs-number">13</span>_LatestTechKnowledge\<span class="hljs-number">01</span>_MCP\try02\scan_kantu&gt;mcp dev scan_kantu.py<br>Need to install the following packages:<br>@modelcontextprotocol/inspector@<span class="hljs-number">0.12</span>.<span class="hljs-number">0</span><br>Ok to proceed? (y) y<br><br>Starting MCP inspector...<br>ğŸ” MCP Inspector is up and running at http://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">6274</span> ğŸš€<br>âš™ï¸ Proxy server listening on port <span class="hljs-number">6277</span><br></code></pre></td></tr></table></figure><p>åœ¨è‡ªå·±win11çš„chromeæµè§ˆå™¨ä¸­è®¿é—®ä¸Šè¿°åœ°å€<code>http://127.0.0.1:6274</code>ï¼Œå°†çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼š</p><figure><img src="https://s2.loli.net/2025/05/19/HtEJS1zcvypXC7N.png" alt="image-20250518224358340" /><figcaption>image-20250518224358340</figcaption></figure><hr /><figure><img src="https://s2.loli.net/2025/05/19/dxRVezcthLrpA3I.png" alt="image-20250519143105848" /><figcaption>image-20250519143105848</figcaption></figure><hr /><figure><img src="https://s2.loli.net/2025/05/19/DUM3b1gAjGHiEFm.png" alt="image-20250519144333266" /><figcaption>image-20250519144333266</figcaption></figure><p>å…¶ä»–çš„å·¥å…·å¦‚â€œcount_image_viewersâ€ã€â€œget_image_viewer_detailsâ€ä¹Ÿå¯ä»¥åœ¨æ­¤ç•Œé¢ä¸Šè¿›è¡Œæµ‹è¯•</p><h2 id="mcpåº”ç”¨é›†æˆåˆ°claude">1.6 MCPåº”ç”¨é›†æˆåˆ°claude</h2><p>å°†ä¸Šè¿°ç¼–å†™çš„scan_kantu.pyæ–‡ä»¶ï¼ˆæ­¤å¤„æ˜¯ä½¿ç”¨claude3.7å¤§æ¨¡å‹ç”Ÿæˆçš„ï¼‰æ¥å…¥åˆ°Claude Desktopä¸­ã€‚éœ€è¦ç¼–è¾‘Claude Desktopçš„<code>claude_desktop_config.json</code>æ–‡ä»¶ï¼ŒæŒ‰ç…§å¦‚ä¸‹æ–¹å¼æ‰“å¼€ï¼šFile-&gt;Settings-&gt;Developer-&gt;&quot;Edit Config&quot;ï¼Œç¼–è¾‘åçš„<code>claude_desktop_config.json</code>æ–‡ä»¶å†…å®¹å¯èƒ½å¦‚ä¸‹ï¼š</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs nix">&#123;<br>  <span class="hljs-string">&quot;mcpServers&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;scan_kantu&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;command&quot;</span>: <span class="hljs-string">&quot;C:<span class="hljs-char escape_">\\</span>Users<span class="hljs-char escape_">\\</span>jiangsanyin<span class="hljs-char escape_">\\</span>.local<span class="hljs-char escape_">\\</span>bin<span class="hljs-char escape_">\\</span>uv.exe&quot;</span>,<br>      <span class="hljs-string">&quot;args&quot;</span>: [<br>        <span class="hljs-string">&quot;--directory&quot;</span>,<br>        <span class="hljs-string">&quot;E:<span class="hljs-char escape_">\\</span>Hdisk<span class="hljs-char escape_">\\</span>å­¦ä¹ <span class="hljs-char escape_">\\</span>06_AIå­¦ä¹ <span class="hljs-char escape_">\\</span>13_LatestTechKnowledge<span class="hljs-char escape_">\\</span>01_MCP<span class="hljs-char escape_">\\</span>try02<span class="hljs-char escape_">\\</span>scan_kantu&quot;</span>,<br>        <span class="hljs-string">&quot;run&quot;</span>,<br>        <span class="hljs-string">&quot;scan_kantu.py&quot;</span><br>      ]<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åé‡å¯ Claude Desktopï¼ˆæ˜¯å…ˆExitè€Œä¸æ˜¯Closeï¼Œå†é‡æ–°æ‰“å¼€Claude Desktopï¼‰ã€‚æ­¤æ—¶å°±å¯ä»¥çœ‹åˆ°æœ‰å‡ ä¸ªMCP toolså¯ç”¨äº†ã€‚</p><figure><img src="https://s2.loli.net/2025/05/19/jIo5t1ONRkmAL3r.png" alt="image-20250519150226210" /><figcaption>image-20250519150226210</figcaption></figure><figure><img src="https://s2.loli.net/2025/05/19/vOrIAEsjZaLh9J6.png" alt="image-20250519150239800" /><figcaption>image-20250519150239800</figcaption></figure><h2 id="åœ¨claudeä¸­ä½¿ç”¨mcpåº”ç”¨">1.7 åœ¨claudeä¸­ä½¿ç”¨mcpåº”ç”¨</h2><p>ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ prompt æ¥è¿›è¡Œå®é™…æµ‹è¯•ï¼šâ€œèƒ½æ¨æµ‹æˆ‘å½“å‰æ¡Œé¢ä¸Š txt æ–‡ä»¶åçš„å«ä¹‰å—ï¼Ÿâ€</p><figure><img src="https://s2.loli.net/2025/05/19/qyaElu4SsFUQkOR.png" alt="image-20250519150417991" /><figcaption>image-20250519150417991</figcaption></figure><p>æ‰§è¡Œç»“æœæ­£ç¡®ï¼Œæƒ…å†µå¦‚ä¸‹ï¼š</p><figure><img src="https://s2.loli.net/2025/05/19/wnRjq2yztZ8NV1b.png" alt="image-20250519150612965" /><figcaption>image-20250519150612965</figcaption></figure><h2 id="mcpåº”ç”¨å·¥ä½œæµç¨‹">1.8 MCPåº”ç”¨å·¥ä½œæµç¨‹</h2><ol type="1"><li>MCPå®¢æˆ·ç«¯å°†è¯·æ±‚å‘é€ç»™Claude LLM</li><li>Claude LLMåˆ†æå¯ç”¨çš„å·¥å…·ã€å†³å®šä½¿ç”¨å“ªä¸ªï¼ˆäº›ï¼‰å·¥å…·</li><li>MCPå®¢æˆ·ç«¯é€šè¿‡MCPæœåŠ¡ç«¯æ‰§è¡ŒLLMå†³å®šä½¿ç”¨çš„é‚£äº›å·¥å…·</li><li>å·¥å…·æ‰§è¡Œåçš„ç»“æœè¢«è¿”å›ç»™Claude LLM</li><li>Claude LLMæ ¹æ®å†å²ä¼šè¯æ¶ˆæ¯ä¸å·¥å…·æ‰§è¡Œåè¿”å›çš„ç»“æœï¼Œç”Ÿæˆç»“æœå¹¶ç»„ç»‡æˆæµç•…å¯è¯»çš„è‡ªç„¶è¯­è¨€å½¢å¼çš„å›å¤</li><li>è¿™äº›å›å¤æœ€ç»ˆè¢«å±•ç¤ºåœ¨ç”¨æˆ·ï¼ˆä½ ï¼‰çš„é¢å‰</li></ol><h1 id="äºŒç›¸å…³æ–‡æ¡£">äºŒã€ç›¸å…³æ–‡æ¡£</h1><ul><li>For Server Developersï¼šhttps://modelcontextprotocol.io/quickstart/server</li><li>Example Serversï¼šhttps://modelcontextprotocol.io/examples</li><li>quickstart-resourcesï¼šhttps://github.com/modelcontextprotocol/quickstart-resources/tree/main</li></ul>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤§æ¨¡å‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®¹å™¨ç‰ˆdify-v0.15.3å‡çº§åˆ°v1.3.1</title>
    <link href="/2025/05/15/%E5%AE%B9%E5%99%A8%E7%89%88dify-v0-15-3%E5%8D%87%E7%BA%A7%E5%88%B0v1-3-1/"/>
    <url>/2025/05/15/%E5%AE%B9%E5%99%A8%E7%89%88dify-v0-15-3%E5%8D%87%E7%BA%A7%E5%88%B0v1-3-1/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€å‚è€ƒæ–‡æ¡£">ä¸€ã€å‚è€ƒæ–‡æ¡£</h1><p>ï¼ˆ1ï¼‰https://docs.dify.ai/zh-hans/development/migration/migrate-to-v1</p><p>ï¼ˆ2ï¼‰https://github.com/langgenius/dify/releases/tag/1.3.1</p><h1 id="äºŒæ­¥éª¤">äºŒã€æ­¥éª¤</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å¤‡ä»½ docker-compose YAML æ–‡ä»¶</span><br>root@dify:/opt/code_repos/dify# cp docker-compose.yaml docker-compose.yaml.$(date +%s).bak<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ›´æ–°è¿œç¨‹ä»“åº“ä¸­çš„æ‰€æœ‰tagåˆ°æœ¬åœ°</span><br>root@dify:/opt/code_repos/dify# git fetch --tags<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è¿è¡Œå‘½ä»¤åœæ­¢æœåŠ¡ï¼Œåœ¨ Docker ç›®å½•ä¸­æ‰§è¡Œå¤‡ä»½æ•°æ®å‘½ä»¤</span><br>root@dify:/opt/code_repos/dify/docker# docker-compose down<br>root@dify:/opt/code_repos/dify/docker# tar -cvf volumes-$(date +%s).tgz volumes<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å‡çº§ç‰ˆæœ¬</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ‡æ¢è‡³ 1.3.1 tag</span><br>root@dify:/opt/code_repos/dify/docker# git checkout 1.3.1 <br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹.<span class="hljs-built_in">env</span>ä¸docker-compose.yamlæ–‡ä»¶ï¼ˆä¸»è¦æ˜¯ä¿®æ”¹yamlæ–‡ä»¶ä¸­ä½¿ç”¨åˆ°çš„é•œåƒï¼‰</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¯åŠ¨æœåŠ¡</span><br>root@dify:/opt/code_repos/dify/docker# docker-compose up -d<br></code></pre></td></tr></table></figure><figure><img src="https://s2.loli.net/2025/05/15/l56VvTZQ9K3JM8D.png" alt="image-20250515152107390" /><figcaption>image-20250515152107390</figcaption></figure><figure><img src="https://s2.loli.net/2025/05/15/1fKisIaN92xyHTC.png" alt="image-20250515152308201" /><figcaption>image-20250515152308201</figcaption></figure><p>å¦‚æœè¦è¿ç§»å·¥å…·ä¸ºæ’ä»¶ï¼š<a href="https://docs.dify.ai/zh-hans/development/migration/migrate-to-v1#3-%E5%B7%A5%E5%85%B7%E8%BF%81%E7%A7%BB%E4%B8%BA%E6%8F%92%E4%BB%B6">å·¥å…·è¿ç§»ä¸ºæ’ä»¶</a></p><h1 id="ä¸‰å¤‡æ³¨">ä¸‰ã€å¤‡æ³¨</h1><h2 id="dify1.3.1ä½¿ç”¨åˆ°çš„åŸé•œåƒåŠåŠ é€Ÿé•œåƒ">3.1 dify1.3.1ä½¿ç”¨åˆ°çš„åŸé•œåƒåŠåŠ é€Ÿé•œåƒ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ç¬¬ä¸€è¡Œä¸ºåŸé•œåƒ</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç¬¬äºŒè¡Œæ˜¯åŠ é€Ÿé•œåƒ</span><br><br>langgenius/dify-api:1.3.1<br>swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/langgenius/dify-api:1.3.1<br><br>postgres:15-alpine<br>swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/postgres:15-alpine<br><br>redis:6-alpine<br>swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/redis:6-alpine<br><br>langgenius/dify-sandbox:0.2.11<br>swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/langgenius/dify-sandbox:0.2.11<br><br>langgenius/dify-plugin-daemon:0.0.9-local<br>swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/langgenius/dify-plugin-daemon:0.0.9-local<br><br>ubuntu/squid:latest<br>swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/ubuntu/squid:latest<br><br>certbot/certbot<br>swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/certbot/certbot:latest<br><br>nginx:latest<br>swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/nginx:latest<br><br>semitechnologies/weaviate:1.19.0<br>swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/semitechnologies/weaviate:1.19.0<br><br>langgenius/qdrant:v1.7.3<br>swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/langgenius/qdrant:v1.7.3<br><br>pgvector/pgvector:pg16<br>swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/pgvector/pgvector:pg16<br><br>vastdata/vastbase-vector<br><br><br>tensorchord/pgvecto-rs:pg16-v0.3.0<br>swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/tensorchord/pgvecto-rs:pg16-v0.3.0<br><br>ghcr.io/chroma-core/chroma:0.5.20<br>swr.cn-north-4.myhuaweicloud.com/ddn-k8s/ghcr.io/chroma-core/chroma:0.5.20<br><br>oceanbase/oceanbase-ce:4.3.5.1-101000042025031818<br>swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/oceanbase/oceanbase-ce:4.3.5.1-101000042025031818<br><br>container-registry.oracle.com/database/free:latest<br>swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/container-registry.oracle.com/database/free:latest<br><br>quay.io/coreos/etcd:v3.5.5<br>swr.cn-north-4.myhuaweicloud.com/ddn-k8s/quay.io/coreos/etcd:v3.5.5<br><br>minio/minio:RELEASE.2023-03-20T20-16-18Z<br>swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/minio/minio:RELEASE.2023-03-20T20-16-18Z<br><br>milvusdb/milvus:v2.5.0-beta<br>swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/milvusdb/milvus:v2.5.0-beta<br><br>opensearchproject/opensearch:latest<br>swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/opensearchproject/opensearch:latest<br><br>opensearchproject/opensearch-dashboards:latest<br>swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/opensearchproject/opensearch-dashboards:latest<br><br>opengauss/opengauss:7.0.0-RC1<br>swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/opengauss/opengauss:7.0.0-RC1<br><br>myscale/myscaledb:1.6.4<br>swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/myscale/myscaledb:1.6.4<br><br>docker.elastic.co/elasticsearch/elasticsearch:8.14.3<br>swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.elastic.co/elasticsearch/elasticsearch:8.14.3<br><br>docker.elastic.co/kibana/kibana:8.14.3<br>swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.elastic.co/kibana/kibana:8.14.3<br><br>downloads.unstructured.io/unstructured-io/unstructured-api:latest<br>swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/downloads.unstructured.io/unstructured-io/unstructured-api:latest<br><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤§æ¨¡å‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¤§è¯­è¨€æ¨¡å‹MCPå­¦ä¹ 01-æ¦‚å¿µå­¦ä¹ ä¸cursorä¸­åˆä½“éªŒ</title>
    <link href="/2025/04/25/%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8BMCP%E5%AD%A6%E4%B9%A001-%E6%A6%82%E5%BF%B5%E5%AD%A6%E4%B9%A0%E4%B8%8Ecursor%E4%B8%AD%E5%88%9D%E4%BD%93%E9%AA%8C/"/>
    <url>/2025/04/25/%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8BMCP%E5%AD%A6%E4%B9%A001-%E6%A6%82%E5%BF%B5%E5%AD%A6%E4%B9%A0%E4%B8%8Ecursor%E4%B8%AD%E5%88%9D%E4%BD%93%E9%AA%8C/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€æ¦‚å¿µå­¦ä¹ ">ä¸€ã€æ¦‚å¿µå­¦ä¹ </h1><h2 id="mcpæ˜¯ä»€ä¹ˆ">1.1 MCPæ˜¯ä»€ä¹ˆ</h2><p>MCP æ˜¯ Anthropic (Claude) ä¸»å¯¼å‘å¸ƒçš„ä¸€ä¸ªå¼€æ”¾çš„ã€é€šç”¨çš„ã€æœ‰å…±è¯†çš„åè®®æ ‡å‡†ã€‚å®˜ç½‘åœ°å€ï¼šhttps://modelcontextprotocol.io/introduction ã€‚å…¶ç¤ºæ„å›¾å¦‚ä¸‹ã€‚</p><figure><img src="https://s2.loli.net/2025/04/25/i21Sh5IzmRuBK7Z.png" alt="image-20250425165703422" /><figcaption>image-20250425165703422</figcaption></figure><p>MCPæ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†åè®®ï¼Œå®ƒä¸ºåº”ç”¨å¦‚ä½•ä¸ºLLMæä¾›ä¸Šä¸‹æ–‡è¿™ä¸ªè¿‡ç¨‹æä¾›äº†ä¸€ä¸ªæ ‡å‡†åè®®ã€‚å¯ä»¥æŠŠMCPçœ‹æˆæ˜¯AIåº”ç”¨ç¨‹åºçš„USB-Cæ¥å£ï¼Œå°±åƒUSB-Cæ¥å£æä¾›äº†ä¸€ä¸ªæ ‡å‡†çš„æ–¹å¼ä»¥æŠŠä½ çš„è®¾å¤‡è¿æ¥åˆ°å„ç§å„æ ·çš„å‘¨è¾¹è®¾å¤‡å’Œé…ä»¶ä¸€æ ·ï¼ŒMCPæä¾›äº†ä¸€ä¸ªæ ‡å‡†çš„æ–¹å¼ä»¥å°†AIæ¨¡å‹è¿æ¥åˆ°ä¸åŒçš„æ•°æ®æºå’Œå·¥å…·ã€‚</p><p>MCPèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬é›†æˆç°æœ‰çš„å„ä¸ªAgentï¼Œä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿæ›´åŠ é«˜æ•ˆä¾¿æ·åœ°å¼€å‘è‡ªå·±çš„AIåº”ç”¨ç¨‹åºã€‚å› ä¸ºæˆ‘ä»¬å¯ä»¥ç›´æ¥ä» https://mcp.so/ ï¼ˆå®ƒæœ‰ç‚¹åƒæ˜¯Dockerç”Ÿæ€ä¸­çš„å®˜æ–¹ dockerhub ç½‘ç«™ï¼‰ç½‘ç«™ä¸‹è½½åˆ«äººä¸Šä¼ çš„MCP Serveræˆ–MCP Clientï¼Œç›´æ¥ä½¿ç”¨ã€‚å½“ç„¶æ­¤ç½‘ç«™ä¸­å¦‚æœæ²¡æœ‰æˆ‘ä»¬æƒ³è¦çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬åœ¨MCPè§„èŒƒä¸‹è‡ªå·±å®ç°ã€‚</p><figure><img src="https://s2.loli.net/2025/04/25/NPDdca4sQVU15oC.png" alt="image-20250425170351457" /><figcaption>image-20250425170351457</figcaption></figure><h2 id="mcpæ€»ä½“æ„æ¶">1.2 MCPæ€»ä½“æ„æ¶</h2><p>MCPçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šMCPéµå¾ªC-Sæ„æ¶ï¼Œå³ä¸€ä¸ªä¸»æœºåº”ç”¨ç¨‹åºè¿æ¥åˆ°å¤šä¸ªä¸åŒçš„MCPæœåŠ¡ç«¯ã€‚å…¶æ¶æ„å›¾å¦‚ä¸‹ï¼š</p><figure><img src="https://s2.loli.net/2025/04/25/MiuFJ5ltAZsVfWx.png" alt="image-20250425170700928" /><figcaption>image-20250425170700928</figcaption></figure><hr /><p>ä¸Šå›¾ä¸­å„ç§æ¦‚å¿µçš„è§£æå¦‚ä¸‹ã€‚</p><p><strong>MCP Hosts</strong>ï¼šå¦‚Claude Desktopã€IDEæˆ–AIå·¥å…·ç­‰æƒ³è¦é€šè¿‡MCPè·å–æ•°æ®çš„ç¨‹åºã€‚</p><p><strong>MCP Clients</strong>ï¼šä¸MCP æœåŠ¡å™¨ä¿æŒ 1:1 çš„è¿æ¥çš„åè®®å®¢æˆ·ç«¯ï¼Œä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼ŒMCPå®¢æˆ·ç«¯ä¸MCP Hostæ˜¯åœ¨ä¸€èµ·çš„ã€‚</p><p><strong>MCP Servers</strong>ï¼šå®ƒæ˜¯ä¸€ä¸ªè½»é‡çº§çš„ã€é€šè¿‡æ ‡å‡†æ¨¡å‹ä¸Šä¸‹æ–‡åè®®æš´éœ²ç‰¹å®šèƒ½åŠ›çš„ç¨‹åºã€‚</p><p><strong>Local Data Sources</strong>ï¼šæŒ‡ä½ ç”µè„‘ä¸Šçš„å¯ä¾› MCP æœåŠ¡å™¨å®‰å…¨è®¿é—®çš„æ•°æ®èµ„æºï¼Œå¦‚æ–‡ä»¶ã€æ•°æ®åº“ä¸æœåŠ¡ã€‚</p><p><strong>Remote Services</strong>ï¼šé€šè¿‡äº’è”ç½‘ç»œå¯ä¾› MCP æœåŠ¡å™¨è¿æ¥ä¸è®¿é—®ï¼ˆæ¯”å¦‚é€šè¿‡APIè°ƒç”¨çš„å½¢å¼ï¼‰çš„å¤–éƒ¨ç³»ç»Ÿã€‚</p><h2 id="mcpå¤§è‡´å·¥ä½œè¿‡ç¨‹">1.3 MCPå¤§è‡´å·¥ä½œè¿‡ç¨‹</h2><ol type="1"><li>ç”¨æˆ·åœ¨MCPå®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚cursoræˆ–claudeæˆ–pythonç¨‹åºå®¢æˆ·ç«¯ï¼‰è¾“å…¥é—®é¢˜ï¼ŒMCPå®¢æˆ·ç«¯æŸ¥è¯¢MCPæœåŠ¡ç«¯æœ‰å“ªäº›å·¥å…·å¯ç”¨ï¼Œç„¶åMCPå®¢æˆ·ç«¯å°†â€œé—®é¢˜ä¸å¯ç”¨å·¥å…·çš„ç›¸å…³æƒ…å†µâ€å‘é€ç»™LLMï¼ˆæ¯”å¦‚è‡ªå·±ä½¿ç”¨è¿‡Claude-3.7æˆ–DeepSeek-V3ï¼‰</li><li>LLMåˆ†æé—®é¢˜ï¼Œå‘å®¢æˆ·ç«¯è¿›è¡Œå›å¤ï¼Œå›å¤ä¸­åŒ…å«æ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·ç›¸å…³ä¿¡æ¯ï¼ˆè¿™é‡Œçš„å·¥å…·å…¶å®å°±æ˜¯å‡½æ•°ï¼Œè¿™ä¸ªæ—¶å€™å‡½æ•°åä¸å‡½æ•°çš„æ³¨é‡Šè¯´æ˜å°±å¾ˆé‡è¦äº†ï¼Œå®ƒå°†å½±å“LLMçš„å†³å®šï¼‰</li><li>å¦‚æœä¸éœ€è¦è°ƒç”¨å·¥å…·ï¼Œåˆ™LLMçš„å›å¤ä¸­å°±ç›´æ¥åŒ…å«äº†é—®é¢˜çš„ç­”å¤ï¼Œå¯ä»¥è¢«ç›´æ¥ä½¿ç”¨äº†ã€‚å¦‚æœéœ€è¦è°ƒç”¨å·¥å…·ï¼ˆå¯ä»¥ä¾æ¬¡è°ƒç”¨å¤šä¸ªå·¥å…·ï¼‰ï¼Œåˆ™MCPå®¢æˆ·ç«¯å‘MCPæœåŠ¡ç«¯è¯·æ±‚è¯´â€œå¸®å¿™è°ƒç”¨å“ªä¸ªå·¥å…·ï¼Œå¹¶å°†éœ€è¦çš„å‚æ•°ä¼ é€’ç»™å®ƒâ€ã€‚MCPå®¢æˆ·ç«¯ç­‰å¾…å¹¶æ‹¿åˆ°å·¥å…·è°ƒç”¨çš„ç»“æœï¼Œç„¶åå°†å·¥å…·è°ƒç”¨ç»“æœä½œä¸ºå†å²ä¿¡æ¯å‘Šè¯‰LLMï¼Œè®©LLMæ ¹æ®æ‰€æœ‰å†å²æ¶ˆæ¯è§£å†³æˆ‘ä»¬çš„é—®é¢˜ã€‚</li><li>ç„¶åå°±å›åˆ°ç¬¬2æ­¥æˆ–ç¬¬3æ­¥äº†ï¼ˆå¦‚æœä¸è¶…è¿‡LLMçš„æœ€å¤§tokenæˆ–ç¨‹åºæ ˆæº¢å‡ºï¼Œç›´æ¥è°ƒç”¨SDKæ¥å®ç°å¯ä»¥è¿™æ ·ä¸æ–­è°ƒç”¨ä¸‹å»ï¼›cursoræˆ–claudeè¿™æ ·çš„é›†æˆå®¢æˆ·ç«¯æ˜¯åªä¼šè°ƒç”¨ä¸€æ¬¡å·¥å…·è¿˜æ˜¯ä¼šä¸æ–­é‡å¤ç›´åˆ°ä¸å†éœ€è¦è°ƒç”¨å·¥å…·äº†ï¼Œè¿˜ä¸ç¡®å®šï¼‰ã€‚ç›´åˆ°ä¸å†éœ€è¦è°ƒç”¨å·¥å…·äº†ï¼ŒLLMç›´æ¥ç»„ç»‡è¯­è¨€é’ˆå¯¹é—®é¢˜è¿›è¡Œåˆ†æä¸æœ€åçš„æ€»ç»“å›å¤ã€‚</li></ol><h1 id="äºŒcursorä¸­ä½“éªŒmcp">äºŒã€cursorä¸­ä½“éªŒMCP</h1><h2 id="é…ç½®é«˜å¾·åœ°å›¾mcp-server">2.1 é…ç½®é«˜å¾·åœ°å›¾MCP-server</h2><p>åœ¨é˜¿é‡Œäº‘ç™¾ç»ƒå¹³å°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºå·¥ä½œæµï¼Œåœ¨å·¥ä½œæµä¸­æˆ‘ä»¬å¯ä»¥è°ƒç”¨â€œå‘¨è¾¹æŸ¥è¯¢â€çš„æ’ä»¶æ¥äº«å—â€œå‘¨è¾¹ä½ç½®ä¿¡æ¯æŸ¥è¯¢æœåŠ¡â€ï¼Œæ¯”å¦‚æŸ¥è¯¢è¡Œç¨‹ã€æŸ¥æ‰¾é¥­åº—é…’åº—ç­‰ã€‚MCPä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„åŠŸèƒ½ï¼Œåœ¨cursorä¸­ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ã€‚</p><h3 id="é«˜å¾·å¼€æ”¾å¹³å°ç”³è¯·key">2.1.1 é«˜å¾·å¼€æ”¾å¹³å°ç”³è¯·Key</h3><figure><img src="https://s2.loli.net/2025/05/09/KVPuc61ShtiYGd5.png" alt="image-20250509162544289" /><figcaption>image-20250509162544289</figcaption></figure><p>å¤åˆ¶ä¸Šè¿°Keyå€¼ï¼Œåé¢è¦ç”¨ã€‚</p><h3 id="æ‰“å¼€cursor-setting">2.1.2 æ‰“å¼€cursor setting</h3><p>File-&gt;Preferences-&gt;Cursor Settingï¼Œç„¶å</p><figure><img src="https://s2.loli.net/2025/05/09/D6nJcFBtpvbHMdC.png" alt="image-20250509160218716" /><figcaption>image-20250509160218716</figcaption></figure><h3 id="é…ç½®mcp.json">2.1.3 é…ç½®mcp.json</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;mcpServers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;amap-maps&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;command&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;npx&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;args&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-string">&quot;-y&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;@amap/amap-maps-mcp-server&quot;</span><br>          <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;env&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;AMAP_MAPS_API_KEY&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ­¤å¤„æ›¿æ¢æˆå‰é¢è‡ªå·±ç”³è¯·çš„AMAP_MAPS_API_KEY&quot;</span><br>          <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="ç¡®è®¤é…ç½®æƒ…å†µ">2.1.4 ç¡®è®¤é…ç½®æƒ…å†µ</h3><figure><img src="https://s2.loli.net/2025/05/09/W2vVQmOrwMoblAY.png" alt="image-20250509162819638" /><figcaption>image-20250509162819638</figcaption></figure><p>å¦‚æœé…ç½®æˆåŠŸï¼Œåˆ™é…ç½®mcp-serveré¡¹å·¦è¾¹ä¼šæœ‰ä¸€ä¸ªç»¿è‰²çš„å°ç‚¹ã€‚å¦‚æœæ˜¯çº¢è‰²æˆ–å…¶ä»–æƒ…å†µå°±è¯´æ˜æŠ¥é”™äº†æ²¡å®‰è£…é…ç½®æˆåŠŸï¼Œé€šè¿‡å¦‚ä¸‹æ–¹æ³•æŸ¥çœ‹å…·ä½“æ—¥å¿—ï¼šcursorèœå•æ ä¾æ¬¡ç‚¹å‡»â€œView-&gt;Outputâ€ï¼Œç„¶åå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç•Œé¢è§†å›¾ï¼Œåœ¨ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹©â€œCursor MCPâ€ï¼š</p><figure><img src="https://s2.loli.net/2025/05/09/TudhFs78P6oS4xR.png" alt="image-20250509163356708" /><figcaption>image-20250509163356708</figcaption></figure><p>å¦‚æœæœ‰é”™è¯¯ï¼Œè§†æƒ…å†µè§£å†³ã€‚</p><h3 id="å®é™…è¯•ç”¨">2.1.5 å®é™…è¯•ç”¨</h3><p>æ¨¡å¼é€‰æ‹©â€œAgentâ€ï¼Œæ¨¡å‹é€‰æ‹©â€œclaude-3.7-sonnetâ€ï¼Œç„¶åè¾“å…¥é—®é¢˜å‘é€è¿›è¡Œæé—®ã€‚</p><figure><img src="https://s2.loli.net/2025/05/09/irJ9UoVXeEPDpwY.png" alt="image-20250509164028896" /><figcaption>image-20250509164028896</figcaption></figure><figure><img src="https://s2.loli.net/2025/05/09/pm3jO2gb5Rq9LAZ.png" alt="image-20250509164321025" /><figcaption>image-20250509164321025</figcaption></figure><p>åç»­æ¯æ¬¡è°ƒç”¨ä¸€ä¸ªå·¥å…·éƒ½éœ€è¦ç”¨æˆ·ç‚¹å‡»â€œRun toolâ€æŒ‰é’®ä¸€æ¬¡ï¼Œç›´åˆ°ä¸å†éœ€è¦è°ƒç”¨å·¥å…·ã€‚ç„¶åè¾“å‡ºLLMæ€»ç»“æ‰€æœ‰çš„ä¿¡æ¯ï¼Œç”¨è‡ªç„¶è¯­è¨€è¾“å‡ºæ¥å‘ˆç°ç»™ç”¨æˆ·ï¼š</p><figure><img src="https://s2.loli.net/2025/05/09/odTI27k6GvKfHFt.png" alt="image-20250509164752401" /><figcaption>image-20250509164752401</figcaption></figure><h2 id="é…ç½®mysqlæ•°æ®åº“mcp-server">2.2 é…ç½®MySQLæ•°æ®åº“MCP-server</h2><p>ä»¥ä¸‹é…ç½®æ˜¯ç”¨æ¥éƒ¨ç½²MySQLæ•°æ®åº“mcpæœåŠ¡å™¨çš„ï¼Œéƒ¨ç½²åå¯ä»¥åœ¨cursorä¸­ç›´æ¥æ“ä½œé…ç½®çš„æ•°æ®åº“åŠæ•°æ®è¡¨ã€‚</p><h3 id="è®¿é—®mcp.soç½‘ç«™">2.2.1 è®¿é—®mcp.soç½‘ç«™</h3><p>æœç´¢â€œmcp-mysql-serverâ€ï¼Œåœ¨å¤šä¸ªæœç´¢ç»“æœé€‰æ‹©ä¸€ä¸ªã€‚</p><figure><img src="https://s2.loli.net/2025/05/09/fy4U5rxscZmGD7d.png" alt="image-20250509173402129" /><figcaption>image-20250509173402129</figcaption></figure><p>ä½†è‡ªå·±æµ‹è¯•æ—¶ï¼Œæ€»æ˜¯æœ‰å„ç§å„æ ·çš„é—®é¢˜ã€‚å”¯æœ‰è¿™ä¸ªâ€œhttps://mcp.so/server/MCP-MySQL-server-implementation/shensiqi0701?tab=contentâ€èƒ½ç”Ÿæˆå¾…æ‰§è¡Œsqlè¯­å¥ï¼Œä½†å´ä¸ä¼šçœŸæ­£æ‰§è¡Œï¼Œå³éœ€è¦è‡ªå·±æ‰‹åŠ¨å»æ‰§è¡Œç”Ÿæˆçš„sqlè¯­å¥ã€‚</p><p>ä»¥ä¸‹æ˜¯è‡ªå·±åœ¨æ‰¾åˆ°çš„ä¸€ä¸ªå¯ç”¨é…ç½®ã€‚</p><h3 id="é…ç½®mcp.json-1">2.2.2 é…ç½®mcp.json</h3><p>æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹ï¼Œæœ€åçš„mcp.jsonæ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;mcpServers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;amap-maps&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;command&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;npx&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;args&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-string">&quot;-y&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;@amap/amap-maps-mcp-server&quot;</span><br>      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;env&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;AMAP_MAPS_API_KEY&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è‡ªå·±ç”³è¯·çš„AMAP_MAPS_API_KEY&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;MySQL&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;command&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;npx&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;args&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-string">&quot;mcprunner&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;MYSQL_HOST=172.20.0.22&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;MYSQL_PORT=3306&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;MYSQL_USER=root&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;MYSQL_PASS=root@123&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;MYSQL_DB=test01&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;ALLOW_INSERT_OPERATION=true&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;ALLOW_UPDATE_OPERATION=true&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;ALLOW_DELETE_OPERATION=true&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;--&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;npx&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;-y&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;@benborla29/mcp-server-mysql&quot;</span><br>      <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="ç¡®è®¤é…ç½®æƒ…å†µ-1">2.2.3 ç¡®è®¤é…ç½®æƒ…å†µ</h3><figure><img src="https://s2.loli.net/2025/05/09/lhqYb2L9EZKOaHS.png" alt="image-20250509215137649" /><figcaption>image-20250509215137649</figcaption></figure><h3 id="å®é™…è¯•ç”¨-1">2.2.4 å®é™…è¯•ç”¨</h3><p>è¾“å…¥æç¤ºæç¤ºè¯ï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">è¯·ä¸ºæˆ‘åœ¨test01æ•°æ®åº“ä¸­åˆ›å»ºä¸€å¼ æ•°æ®è¡¨ï¼Œè¡¨åæ˜¯productsï¼Œç”¨æ¥ä¿å­˜å•†å“ä¿¡æ¯çš„ã€‚å…¶ä¸­åŒ…å«å¦‚ä¸‹å‡ ä¸ªå­—æ®µï¼Œ<span class="hljs-built_in">id</span>ã€å•†å“åã€å•†å“ä»·æ ¼ã€å•†å“é‡é‡ã€äº§åœ°ã€ç”Ÿäº§å•†ã€ç”Ÿäº§æ—¶é—´ã€ä¿æŒæœŸã€‚è¯·ä¸ºæ¯ä¸ªå­—æ®µåŠ ä¸Šå¤‡æ³¨<br></code></pre></td></tr></table></figure><figure><img src="https://s2.loli.net/2025/05/09/vuadFZqxoJ2AH5W.png" alt="image-20250509215432301" /><figcaption>image-20250509215432301</figcaption></figure><p>ç„¶åæç¤ºéœ€è¦è°ƒç”¨æŸæŸå·¥å…·ï¼Œéœ€è¦ç”¨æˆ·ä¸æ–­ç‚¹å‡»â€œRun toolâ€æŒ‰é’®ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼ŒmcpæœåŠ¡ç«¯é¦–å…ˆç”Ÿæˆåˆ›å»ºæ•°æ®è¡¨çš„è¯­å¥ï¼Œç„¶ååˆ¤æ–­test01æ•°æ®åº“æ˜¯å¦å­˜åœ¨ã€åœ¨test01æ•°æ®åº“ä¸­æ˜¯å¦æœ‰åˆ›å»ºè¡¨çš„æƒé™ã€æ£€æŸ¥ç”¨æˆ·rootå¯¹æ­¤æ•°æ®åº“çš„æ“ä½œæƒé™ã€åˆ‡æ¢åˆ°test01æ•°æ®åº“ï¼ˆå°±æ˜¯æ‰§è¡Œuse test01ï¼‰ã€æ‰§è¡Œåˆ›å»ºæ•°æ®è¡¨çš„è¯­å¥ï¼Œä½†æ˜¯æ‰§è¡Œæ—¶æç¤ºæƒé™é”™è¯¯ï¼ŒLLMåˆå»æ£€æŸ¥äº†productsæ•°æ®è¡¨å·²ç»è¢«æˆåŠŸåˆ›å»ºå‡ºæ¥ï¼Œå‘ç°æ²¡æœ‰ï¼Œäºæ˜¯ç»™å‡ºäº†ä¸€äº›æç¤ºå¹¶è¾“å‡ºåˆ›å»ºproductsæ•°æ®è¡¨çš„sqlè¯­å¥ï¼Œè®©ç”¨æˆ·è‡ªå·±æ‰‹åŠ¨å»æ‰§è¡Œã€‚</p><figure><img src="https://s2.loli.net/2025/05/09/zxe7BuKgrS26HhR.png" alt="image-20250509215727489" /><figcaption>image-20250509215727489</figcaption></figure><hr /><p>æˆ‘ä»¬åˆ©ç”¨ä¸Šè¿°ç”Ÿæˆçš„sqlè¯­å¥æ‰‹åŠ¨åˆ›å»ºæ•°æ®è¡¨åç»§ç»­æ“ä½œã€‚ç°åœ¨å°è¯•å‘æ­¤è¡¨ä¸­æ’å…¥ä¸€æ¡æ•°æ®ï¼š</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">è¯·å‘productsè¡¨ä¸­æ’å…¥ä¸€æ¡æ•°æ®ï¼Œå•†å“åâ€œæ›²å¥‡é¥¼å¹²â€ï¼Œä»·æ ¼æ˜¯<span class="hljs-number">20</span>.<span class="hljs-number">98</span>ï¼Œå•†å“é‡é‡æ˜¯<span class="hljs-number">0</span>.<span class="hljs-number">08</span>ï¼Œäº§åœ°æ˜¯å¹¿ä¸œä¸œèï¼Œç”Ÿäº§å•†æ˜¯ä¸œèåˆ©å‘é£Ÿå“å‚ï¼Œç”Ÿäº§æ—¥æœŸæ˜¯<span class="hljs-number">2025å¹´5æœˆ9</span>æ—¥ï¼Œä¿æŒæœŸæ˜¯<span class="hljs-number">12</span>ä¸ªæœˆ<br></code></pre></td></tr></table></figure><figure><img src="https://s2.loli.net/2025/05/09/au2Rv6xMTBZIjP3.png" alt="image-20250509220601775" /><figcaption>image-20250509220601775</figcaption></figure><p>ç³»ç»Ÿæç¤ºæ’å…¥æ•°æ®æˆåŠŸäº†ã€‚</p><hr /><p>æˆ‘ä»¬ç»§ç»­æ“ä½œï¼Œå°è¯•ä¿®æ”¹æŸå­—æ®µå€¼ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">ä¸Šä¸€æ¡æ•°æ®ç¨å¾®æœ‰ç‚¹é—®é¢˜ï¼Œä»·æ ¼é”™äº†ï¼Œéœ€è¦ä¿®æ”¹æˆ19.98<br></code></pre></td></tr></table></figure><figure><img src="https://s2.loli.net/2025/05/09/6uR1aqGHcNkXWMw.png" alt="image-20250509220827182" /><figcaption>image-20250509220827182</figcaption></figure><p>ç³»ç»Ÿæç¤ºä¿®æ”¹æ•°æ®æˆåŠŸäº†ã€‚æ ¹æ®ä¼šè¯æ—¶LLMçš„è¾“å‡ºå¯ä»¥çœ‹å‡ºï¼Œå†å²ä¿¡æ¯ä¹Ÿæ˜¯è¢«LLMè®°å½•å¹¶ä½¿ç”¨çš„ã€‚</p><hr /><p>æœ€åï¼Œæˆ‘ä»¬å°è¯•æŸ¥è¯¢ä¸‹æ•°æ®è¡¨ä¸­æ•°æ®ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">è¯·æŸ¥è¯¢å•†å“ä¿¡æ¯è¡¨ä¸­çš„æ‰€æœ‰æ•°æ®<br></code></pre></td></tr></table></figure><figure><img src="https://s2.loli.net/2025/05/09/edSD7UhqiW8GauO.png" alt="image-20250509221220294" /><figcaption>image-20250509221220294</figcaption></figure><h1 id="ä¸‰ç›¸å…³æ–‡æ¡£">ä¸‰ã€ç›¸å…³æ–‡æ¡£</h1><p><strong>MCPå®˜ç½‘ï¼š</strong>https://modelcontextprotocol.io/introduction</p><p><strong>MCPæœåŠ¡å™¨å¯¼èˆªä¸æ‰˜ç®¡å¹³å°ï¼š</strong>https://mcp.so/</p><p><strong>cursorä¸­é…ç½®ä½¿ç”¨mcpï¼š</strong>ï»¿https://docs.cursor.com/context/model-context-protocol</p>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤§æ¨¡å‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç™¾ç‚¼å¹³å°-æ™ºèƒ½å¤šæ¨¡æ€è¯†åˆ«åº”ç”¨</title>
    <link href="/2025/04/16/%E7%99%BE%E7%82%BC%E5%B9%B3%E5%8F%B0-%E6%99%BA%E8%83%BD%E5%A4%9A%E6%A8%A1%E6%80%81%E8%AF%86%E5%88%AB%E5%BA%94%E7%94%A8/"/>
    <url>/2025/04/16/%E7%99%BE%E7%82%BC%E5%B9%B3%E5%8F%B0-%E6%99%BA%E8%83%BD%E5%A4%9A%E6%A8%A1%E6%80%81%E8%AF%86%E5%88%AB%E5%BA%94%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>ç›¸å…³è¯´æ˜ï¼š</p><p>ï¼ˆ1ï¼‰æœ¬æ–‡é€šè¿‡åˆ›å»ºä¸€ä¸ªçŸ¥è¯†åº“ï¼Œå…¶ä¸­æœ‰3ä¸ªæ–‡ä»¶ï¼šPyTorchå­¦ä¹ æ•™ç¨‹.pdfã€2019å¹´å„å‚å•†æ‰‹æœºå‡ºè´§é‡.docxã€å„ç§ç±»å‹æ¡ˆä»¶æ•°.docxã€‚åä¸¤ä¸ªæ–‡ä»¶å„æœ‰ä¸€å¼ å›¾ç‰‡ï¼Œç¬¬ä¸€ä¸ªæ–‡ä»¶ä¸­æœ‰å›¾æœ‰æ–‡å­—æè¿°ã€‚</p><p>ï¼ˆ2ï¼‰åˆ›å»ºä¸€ä¸ªæ™ºèƒ½ä½“åº”ç”¨ï¼Œä½¿ç”¨äº†â€œé€šä¹‰åƒé—®VL-Max-Latestâ€æ¨¡å‹ã€‚å¦‚æœä¸å¼€å¯çŸ¥è¯†åº“â€œå¤šæ¨¡æ€å›å¤å¢å¼ºâ€åŠŸèƒ½ï¼Œåˆ™å›¾è¡¨è§£æå¯èƒ½ä¸èƒ½æ­£å¸¸å·¥ä½œã€‚å¼€å¯åï¼Œå¢åŠ äº†æ­£å¸¸å·¥ä½œçš„åŠŸèƒ½æ€§ï¼Œä½†ä»å¯èƒ½å‡ºç°é—®é¢˜å¦‚è§£æä¸å‡†ç¡®ã€‚</p><p>å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ã€‚</p><h1 id="ä¸€åˆ›å»ºçŸ¥è¯†åº“">ä¸€ã€åˆ›å»ºçŸ¥è¯†åº“</h1><figure><img src="https://s2.loli.net/2025/04/16/lr79wX6YBo1Depd.png" alt="image-20250416223516232" /><figcaption aria-hidden="true">image-20250416223516232</figcaption></figure><figure><img src="https://s2.loli.net/2025/04/16/3KkWwhBTqyYH4Um.png" alt="image-20250416223612762" /><figcaption aria-hidden="true">image-20250416223612762</figcaption></figure><p>å…¶ä½™é»˜è®¤ã€‚</p><figure><img src="https://s2.loli.net/2025/04/16/FB8AZKiL76yebRY.png" alt="image-20250416223655986" /><figcaption aria-hidden="true">image-20250416223655986</figcaption></figure><figure><img src="https://s2.loli.net/2025/04/16/I9aRtYJfjd1PKq6.png" alt="image-20250416230947835" /><figcaption aria-hidden="true">image-20250416230947835</figcaption></figure><h1 id="äºŒåˆ›å»ºæ™ºèƒ½ä½“åº”ç”¨">äºŒã€åˆ›å»ºæ™ºèƒ½ä½“åº”ç”¨</h1><figure><img src="https://s2.loli.net/2025/04/16/riYlHF1tcoaxwyJ.png" alt="image-20250416223739268" /><figcaption aria-hidden="true">image-20250416223739268</figcaption></figure><figure><img src="https://s2.loli.net/2025/04/16/rXC2YuWVctbyRiq.png" alt="image-20250416231040349" /><figcaption aria-hidden="true">image-20250416231040349</figcaption></figure><h1 id="ä¸‰ç¡®è¯æ•ˆæœ">ä¸‰ã€ç¡®è¯æ•ˆæœ</h1><h2 id="å¦‚æœæœªå¼€å¯å¤šæ¨¡æ€è§†è§‰å¢å¼ºragæœªèƒ½åšå‡ºå›ç­”">å¦‚æœæœªå¼€å¯â€œå¤šæ¨¡æ€è§†è§‰å¢å¼ºâ€ï¼ŒRAGæœªèƒ½åšå‡ºå›ç­”</h2><figure><img src="https://s2.loli.net/2025/04/16/l4BCN9Rbte2ay6X.png" alt="image-20250416231221485" /><figcaption aria-hidden="true">image-20250416231221485</figcaption></figure><h2 id="å¼€å¯å¤šæ¨¡æ€è§†è§‰å¢å¼ºragå›ç­”æ­£ç¡®">å¼€å¯â€œå¤šæ¨¡æ€è§†è§‰å¢å¼ºâ€ï¼ŒRAGå›ç­”æ­£ç¡®</h2><figure><img src="https://s2.loli.net/2025/04/16/cHpY3oXeEzfax9i.png" alt="image-20250416231256270" /><figcaption aria-hidden="true">image-20250416231256270</figcaption></figure><p>å…¶ä¸­ï¼Œå›¾1çš„å†…å®¹å¦‚ä¸‹ï¼š</p><figure><img src="https://s2.loli.net/2025/04/16/vrZkECjLSNUOHIg.png" alt="image-20250416231322652" /><figcaption aria-hidden="true">image-20250416231322652</figcaption></figure><hr /><h2 id="å†æ¬¡æ£€éªŒ">å†æ¬¡æ£€éªŒ</h2><p>ä½†æ­¤æ™ºèƒ½ä½“åº”ç”¨å¹¶ä¸èƒ½ç™¾åˆ†ç™¾æ­£ç¡®è§£æä¸å›å¤å›¾è¡¨ç›¸å…³é—®é¢˜ï¼Œæ¯”å¦‚å›å¤å…³äºâ€œ2019å¹´å…¨çƒå„å“ç‰Œæ‰‹æœºå‡ºè´§é‡ï¼Œå“ªä¸ªå“ç‰Œçš„æ‰‹æœºå‡ºè´§é‡æœ€å¤šâ€é—®é¢˜æ—¶ï¼Œæœªèƒ½æ­£ç¡®è§£æç›¸å…³å›¾è¡¨å†…å®¹ï¼ˆè™½ç„¶æœ€ç»ˆå›å¤ç»“æœæ˜¯æ­£ç¡®çš„ï¼Œä½†è§£ææœ‰é”™ï¼‰ã€‚è§£ææ•ˆæœå¦‚ä¸‹ï¼š</p><figure><img src="https://s2.loli.net/2025/04/16/o1iAwWjmbd3felI.png" alt="image-20250416231618064" /><figcaption aria-hidden="true">image-20250416231618064</figcaption></figure><p>å…¶å®ï¼Œ2019å¹´å…¨çƒå„å“ç‰Œæ‰‹æœºå‡ºè´§é‡ç›¸å…³ç»Ÿè®¡æ•°æ®å¦‚ä¸‹ï¼š</p><figure><img src="https://s2.loli.net/2025/04/16/YKJwPXGqM8CNQi6.png" alt="image-20250416231458612" /><figcaption aria-hidden="true">image-20250416231458612</figcaption></figure>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤§æ¨¡å‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>difyä¸­Agentç±»å‹åº”ç”¨-ä¸ªäººåœ¨çº¿æ—…æ¸¸åŠ©æ‰‹</title>
    <link href="/2025/04/15/dify%E4%B8%ADAgent%E7%B1%BB%E5%9E%8B%E5%BA%94%E7%94%A8-%E4%B8%AA%E4%BA%BA%E5%9C%A8%E7%BA%BF%E6%97%85%E6%B8%B8%E5%8A%A9%E6%89%8B/"/>
    <url>/2025/04/15/dify%E4%B8%ADAgent%E7%B1%BB%E5%9E%8B%E5%BA%94%E7%94%A8-%E4%B8%AA%E4%BA%BA%E5%9C%A8%E7%BA%BF%E6%97%85%E6%B8%B8%E5%8A%A9%E6%89%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€åˆ›å»ºç©ºç™½åº”ç”¨">ä¸€ã€åˆ›å»ºç©ºç™½åº”ç”¨</h1><p>å‚è€ƒï¼šhttps://docs.dify.ai/zh-hans/workshop/basic/travel-assistant</p><p>å·¥ä½œå®¤-åˆ›å»ºç©ºç™½åº”ç”¨-Agent</p><figure><img src="https://s2.loli.net/2025/04/15/HxqyO71Yf2bEgjT.png" alt="image-20250415164828514" /><figcaption aria-hidden="true">image-20250415164828514</figcaption></figure><h1 id="äºŒé…ç½®ä¸ç¡®è®¤å·¥å…·">äºŒã€é…ç½®ä¸ç¡®è®¤å·¥å…·</h1><h2 id="é…ç½®serpapi">2.1 é…ç½®SerpAPI</h2><p>è¿›å…¥é¡µé¢ <a href="https://serpapi.com/manage-api-key">SerpAPI - API Key</a> ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨githubè´¦å·è¿›è¡Œæ³¨å†Œç™»å½•çš„ã€‚åˆ›å»ºä¸€ä¸ªapi kyeï¼ŒSerpAPIæä¾›ä¸€ä¸ªæœˆ100æ¬¡çš„å…è´¹è°ƒç”¨æ¬¡æ•°ã€‚</p><figure><img src="https://s2.loli.net/2025/04/15/H1vhfqi8UQcMNz2.png" alt="image-20250415165406012" /><figcaption aria-hidden="true">image-20250415165406012</figcaption></figure><p>Difyä¸­æ“ä½œï¼š</p><figure><img src="https://s2.loli.net/2025/04/15/4MHWXKVugZaby3N.png" alt="image-20250415165641152" /><figcaption aria-hidden="true">image-20250415165641152</figcaption></figure><h2 id="ç¡®è®¤webscraper">2.2 ç¡®è®¤webscraper</h2><p>å®ƒæ˜¯ä¸€ä¸ªçˆ¬è™«å·¥å…·ï¼Œä»æŒ‡å®šçš„ç½‘é¡µä¸­æŠ“å–å†…å®¹ï¼ŒDify å·²æä¾›å†…ç½®å·¥å…·ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚</p><p>æ­¤å·¥å…·æ— é¡»è¿›è¡Œé…ç½®ï¼Œæ¯”å¦‚é…ç½®api keyï¼Œç›´æ¥ä½¿ç”¨å³å¯ã€‚</p><figure><img src="https://s2.loli.net/2025/04/15/uCVcPdDE2lb7TMW.png" alt="image-20250415165714419" /><figcaption aria-hidden="true">image-20250415165714419</figcaption></figure><h2 id="ç¡®è®¤wikipedia">2.3 ç¡®è®¤Wikipedia</h2><p>è¦è®©Agent èƒ½å¤Ÿå‡†ç¡®ä»‹ç»ç›®çš„åœ°çŸ¥è¯†ï¼ŒWikipedia æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çŸ¥è¯†æ¥æºï¼ŒDify ä¹Ÿå†…ç½®äº†è¯¥å·¥å…·ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚</p><p>æ­¤å·¥å…·ä¹Ÿæ— é¡»è¿›è¡Œé…ç½®ï¼Œæ¯”å¦‚é…ç½®api keyï¼Œç›´æ¥ä½¿ç”¨å³å¯ã€‚</p><figure><img src="https://s2.loli.net/2025/04/15/EWInwL7ehXTsK1C.png" alt="image-20250415165827316" /><figcaption aria-hidden="true">image-20250415165827316</figcaption></figure><h1 id="ä¸‰é…ç½®agentåº”ç”¨">ä¸‰ã€é…ç½®Agentåº”ç”¨</h1><h2 id="å˜é‡">å˜é‡</h2><figure><img src="https://s2.loli.net/2025/04/15/HDf4b6B2OpSzsKJ.png" alt="image-20250415170159086" /><figcaption aria-hidden="true">image-20250415170159086</figcaption></figure><h2 id="å·¥å…·">å·¥å…·</h2><figure><img src="https://s2.loli.net/2025/04/15/R3hDug61JSsOTVU.png" alt="image-20250415170119159" /><figcaption aria-hidden="true">image-20250415170119159</figcaption></figure><h2 id="ç³»ç»Ÿæç¤ºè¯">ç³»ç»Ÿæç¤ºè¯</h2><p>ç¤ºä¾‹è¾“å‡ºçš„ç›®çš„æ˜¯ä¸ºäº†ç»™ Agent ä¸€ä¸ªä¹¦å†™æ ¼å¼çš„å‚è€ƒï¼Œä»¥ç¡®ä¿ Agent çš„è¾“å‡ºæ›´æ¥è¿‘æˆ‘ä»¬çš„æœŸæœ›ã€‚</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs markdown">ä½ æ˜¯ä¸€ä¸ªåœ¨çº¿æ—…è¡ŒåŠ©æ‰‹ï¼Œè¯·æ ¹æ®å¦‚ä¸‹ä¿¡æ¯ç»™å‡ºä¸€ä¸ªè¯¦ç»†çš„æ—…è¡Œè®¡åˆ’ï¼Œç›®çš„åœ°æ˜¯&#123;&#123;destination&#125;&#125;ï¼Œæ—…è¡Œå¤©æ•°æ˜¯&#123;&#123;day&#125;&#125;ï¼Œæ—…è¡Œé¢„ç®—æ˜¯&#123;&#123;budget&#125;&#125; ã€‚å¦‚ä¸‹æ˜¯ä¸€ä¸ªæ—…è¡Œè®¡åˆ’ç¤ºä¾‹<br><br><br><span class="hljs-section">## ç¤ºä¾‹</span><br><span class="hljs-section">### è¯¦ç»†æ—…è¡Œè®¡åˆ’</span><br><br><span class="hljs-strong">**é…’åº—æ¨è**</span><br><span class="hljs-bullet">1.</span> è‚¯è¾›é¡¿é…’åº— (äº†è§£æ›´å¤šï¼šwww.doylecollection.com/hotels/the-kensington-hotel)<br><span class="hljs-bullet">-</span> è¯„åˆ†ï¼š4.6â­<br><span class="hljs-bullet">-</span> ä»·æ ¼ï¼šæ¯æ™šçº¦350ç¾å…ƒ<br><span class="hljs-bullet">-</span> ç®€ä»‹ï¼šåè½åœ¨ä¸€åº§æ‘„æ”¿æ—¶æœŸçš„è”æ’åˆ«å¢…ä¸­ï¼Œè¿™å®¶ä¼˜é›…çš„é…’åº—è·ç¦»å—è‚¯è¾›é¡¿åœ°é“ç«™5åˆ†é’Ÿæ­¥è¡Œè·¯ç¨‹ï¼Œè·ç¦»ç»´å¤šåˆ©äºšå’Œé˜¿å°”ä¼¯ç‰¹åšç‰©é¦†10åˆ†é’Ÿæ­¥è¡Œè·¯ç¨‹ã€‚<br><br><span class="hljs-bullet">2.</span> ä¼¦å‹ƒæœ—é…’åº— (äº†è§£æ›´å¤šï¼šwww.sarova-rembrandthotel.com)<br><span class="hljs-bullet">-</span> è¯„åˆ†ï¼š4.3â­<br><span class="hljs-bullet">-</span> ä»·æ ¼ï¼šæ¯æ™šçº¦130ç¾å…ƒ<br><span class="hljs-bullet">-</span> ç®€ä»‹ï¼šå»ºäº1911å¹´ï¼Œæœ€åˆæ˜¯å“ˆç½—å¾·ç™¾è´§å…¬å¸ï¼ˆè·ç¦»0.4è‹±é‡Œï¼‰çš„å…¬å¯“ï¼Œè¿™å®¶ç°ä»£åŒ–é…’åº—åè½åœ¨ç»´å¤šåˆ©äºšå’Œé˜¿å°”ä¼¯ç‰¹åšç‰©é¦†å¯¹é¢ï¼Œè·ç¦»å—è‚¯è¾›é¡¿åœ°é“ç«™ï¼ˆç›´è¾¾å¸Œæ€ç½—æœºåœºï¼‰5åˆ†é’Ÿæ­¥è¡Œè·¯ç¨‹ã€‚<br><br><span class="hljs-strong">**ç¬¬1å¤© - æŠµè¾¾å’Œå®‰é¡¿**</span><br><span class="hljs-bullet">-</span> <span class="hljs-strong">**ä¸Šåˆ**</span>ï¼šæŠµè¾¾æœºåœºã€‚æ¬¢è¿æ¥åˆ°ä½ çš„å†’é™©ä¹‹æ—…ï¼æˆ‘ä»¬çš„ä»£è¡¨å°†åœ¨æœºåœºè¿æ¥ä½ ï¼Œç¡®ä¿ä½ é¡ºåˆ©å…¥ä½ã€‚<br><span class="hljs-bullet">-</span> <span class="hljs-strong">**ä¸‹åˆ**</span>ï¼šå…¥ä½é…’åº—ï¼Œç¨ä½œä¼‘æ¯ï¼Œæ¢å¤ç²¾åŠ›ã€‚<br><span class="hljs-bullet">-</span> <span class="hljs-strong">**æ™šä¸Š**</span>ï¼šåœ¨ä½å®¿å‘¨è¾¹è¿›è¡Œè½»æ¾çš„æ­¥è¡Œæ¸¸è§ˆï¼Œç†Ÿæ‚‰å½“åœ°ç¯å¢ƒã€‚å‘ç°é™„è¿‘çš„ç”¨é¤é€‰æ‹©ï¼Œäº«å—æ„‰å¿«çš„ç¬¬ä¸€é¡¿æ™šé¤ã€‚<br><br><span class="hljs-strong">**ç¬¬2å¤© - æ–‡åŒ–ä¸è‡ªç„¶ä¹‹æ—…**</span><br><span class="hljs-bullet">-</span> <span class="hljs-strong">**ä¸Šåˆ**</span>ï¼šä»å¸å›½ç†å·¥å­¦é™¢å¼€å§‹ä½ çš„ä¸€å¤©ï¼Œè¿™æ˜¯ä¸–ç•Œé¡¶å°–çš„å­¦åºœä¹‹ä¸€ã€‚äº«å—ä¸€æ¬¡æ ¡å›­å¯¼è§ˆã€‚<br><span class="hljs-bullet">-</span> <span class="hljs-strong">**ä¸‹åˆ**</span>ï¼šé€‰æ‹©å‚è§‚è‡ªç„¶å†å²åšç‰©é¦†ï¼ˆä»¥å…¶å¼•äººå…¥èƒœçš„å±•è§ˆè€Œé—»åï¼‰æˆ–ç»´å¤šåˆ©äºšå’Œé˜¿å°”ä¼¯ç‰¹åšç‰©é¦†ï¼ˆåº†ç¥è‰ºæœ¯å’Œè®¾è®¡ï¼‰ã€‚ä¹‹åï¼Œåœ¨å®é™çš„æµ·å¾·å…¬å›­æ”¾æ¾ï¼Œä¹Ÿè®¸è¿˜å¯ä»¥åœ¨è›‡å½¢æ¹–ä¸Šä¹˜èˆ¹æ¸¸è§ˆã€‚<br><span class="hljs-bullet">-</span> <span class="hljs-strong">**æ™šä¸Š**</span>ï¼šæ¢ç´¢å½“åœ°ç¾é£Ÿã€‚æˆ‘ä»¬æ¨èä½ åœ¨ä¼ ç»Ÿçš„è‹±å›½é…’å§äº«ç”¨æ™šé¤ã€‚<br><br><span class="hljs-strong">**é™„åŠ æœåŠ¡ï¼š**</span><br><span class="hljs-bullet">-</span> <span class="hljs-strong">**ç¤¼å®¾æœåŠ¡**</span>ï¼šåœ¨ä½ åœç•™æœŸé—´ï¼Œæˆ‘ä»¬çš„ç¤¼å®¾æœåŠ¡éšæ—¶å¯ä»¥ååŠ©é¢„è®¢é¤å…ã€è´­ä¹°é—¨ç¥¨ã€å®‰æ’äº¤é€šï¼Œä»¥åŠæ»¡è¶³ä»»ä½•ç‰¹æ®Šè¦æ±‚ï¼Œä»¥æå‡ä½ çš„ä½“éªŒã€‚<br><span class="hljs-bullet">-</span> <span class="hljs-strong">**24/7æ”¯æŒ**</span>ï¼šæˆ‘ä»¬æä¾›å…¨å¤©å€™æ”¯æŒï¼Œä»¥è§£å†³ä½ åœ¨æ—…è¡Œä¸­å¯èƒ½é‡åˆ°çš„ä»»ä½•é—®é¢˜æˆ–éœ€æ±‚ã€‚<br><br>ç¥ä½ æ—…é€”æ„‰å¿«ï¼Œæ»¡è½½ä¸°å¯Œç»å†å’Œç¾å¥½å›å¿†ï¼<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°å†…å®¹å¡«å†™åœ¨å¦‚ä¸‹â€œæç¤ºè¯â€è¾“å…¥æ¡†å†…ï¼š</p><figure><img src="https://s2.loli.net/2025/04/15/HWBOtvu57dlf6er.png" alt="image-20250415170429931" /><figcaption aria-hidden="true">image-20250415170429931</figcaption></figure><h2 id="å…¶ä»–è°ƒæ•´è®¾ç½®">å…¶ä»–è°ƒæ•´è®¾ç½®</h2><p>Agentè®¾ç½®-&gt;æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œè®¾ç½®ä¸º1å³å¯ï¼š</p><figure><img src="https://s2.loli.net/2025/04/15/fSn5oJVzedyPKZR.png" alt="image-20250415170539433" /><figcaption aria-hidden="true">image-20250415170539433</figcaption></figure><hr /><p>é€‰æ‹©æ¨¡å‹ï¼Œå¯ä»¥è‡ªå·±æƒ³è¦ä½¿ç”¨çš„æ¨¡å‹ï¼Œå‰ææ˜¯å·²ç»é…ç½®æ¨¡å‹æä¾›å•†ï¼Œæˆ‘å·²ç»é…ç½®å¥½äº†é€šä¹‰åƒé—®ä¸DeepSeekï¼Œæ­¤å¤„ä½¿ç”¨äº†é€šä¹‰åƒé—®çš„â€œqwen-vl-max-0809â€æ¨¡å‹ï¼Œæ­¤æ¨¡å‹æ˜¯ä¸€ä¸ªå¤šæ¨¡æ€æ¨¡å‹ï¼ˆå‡†ç¡®åœ°è¯´æ˜¯è§†è§‰è¯­è¨€æ¨¡å‹vision language modelï¼‰ï¼Œå…¶å®æ­¤å¤„ä½¿ç”¨æ™®é€šçš„å¤§è¯­è¨€æ¨¡å‹å³å¯æ¯”å¦‚"qwen-max-latest"</p><h2 id="è¯•ç”¨æ•ˆæœ">è¯•ç”¨æ•ˆæœ</h2><ul><li><p>ç›®çš„åœ°ã€æ—…è¡Œå¤©æ•°ã€æ—…è¡Œé¢„ç®—ï¼Œè¾“å…¥é€‚å½“å†…å®¹</p></li><li><p>è¾“å…¥ç”¨æˆ·æç¤ºè¯</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">æˆ‘æ—…è¡Œæ—¶å–œæ¬¢å¤ä»£å»ºç­‘ä¸è‡ªç„¶é£å…‰ï¼Œä½å®¿è´¹è¦æ±‚åœ¨500å…ƒ/æ™š ä»¥ä¸‹ï¼Œæ™šé¤åœ¨å½“åœ°ä¸­ç­‰æ°´å¹³å³å¯ã€‚è¯·ç»™å‡ºä¸€ä¸ªä¸ºæœŸ7å¤©çš„æ—…è¡Œè®¡åˆ’<br></code></pre></td></tr></table></figure></li><li><p>æ¨¡å‹å›ç­”å¦‚ä¸‹</p></li></ul><figure><img src="https://s2.loli.net/2025/04/15/CtNIFueQH7y3UiJ.png" alt="image-20250415170247520" /><figcaption aria-hidden="true">image-20250415170247520</figcaption></figure>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤§æ¨¡å‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¼ä¸šçº§RAGè¡Œä¸šåº”ç”¨è½åœ°åˆ†äº«</title>
    <link href="/2025/04/14/2025%E5%B9%B44%E6%9C%8814%E6%97%A5%E5%90%AC%E8%AF%BE/"/>
    <url>/2025/04/14/2025%E5%B9%B44%E6%9C%8814%E6%97%A5%E5%90%AC%E8%AF%BE/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€æ¯›å«ä¿Šè€å¸ˆåˆ†äº«">ä¸€ã€æ¯›å«ä¿Šè€å¸ˆåˆ†äº«</h1><h2 id="è¡Œä¸šç—›ç‚¹é”šå®š">1.1 è¡Œä¸šç—›ç‚¹é”šå®š</h2><figure><img src="https://s2.loli.net/2025/04/14/KZVJHBdXSPsgRny.png" alt="image-20250414203520866" /><figcaption aria-hidden="true">image-20250414203520866</figcaption></figure><p>AIå°±å¥½åƒä½ å¸¦äº†ä¸€ä¸ªåæ ¡æ¯•ä¸šçš„å®ä¹ ç”ŸåŠ©ç†ã€‚é‚£ä¹ˆä½ è¦å¦‚ä½•ä¸ä»–åä½œå‘¢?</p><p>æ˜ç¡®çš„ä»»åŠ¡ã€ä¸°å¯Œçš„æ¡ˆä¾‹æ•°æ®ã€å®šæœŸçš„è¿›åº¦æ²Ÿé€š</p><figure><img src="https://s2.loli.net/2025/04/14/gYDUlX9PdeJI4cB.png" alt="image-20250414203936908" /><figcaption aria-hidden="true">image-20250414203936908</figcaption></figure><h2 id="å•†ä¸šä»·å€¼æ˜¯å¦å€¼å¾—å¹²">1.2 å•†ä¸šä»·å€¼ï¼ˆæ˜¯å¦å€¼å¾—å¹²ï¼‰</h2><figure><img src="https://s2.loli.net/2025/04/14/tg3DhbPrTXZoHz9.png" alt="image-20250414204638495" /><figcaption aria-hidden="true">image-20250414204638495</figcaption></figure><h2 id="æŠ€æœ¯å¯è¡Œæ€§è¯„ä¼°">1.3 æŠ€æœ¯å¯è¡Œæ€§è¯„ä¼°</h2><figure><img src="https://s2.loli.net/2025/04/14/6DcAMdBrEoU97CY.png" alt="image-20250414205223348" /><figcaption aria-hidden="true">image-20250414205223348</figcaption></figure><h2 id="é¡¹ç›®å¼€å‘é˜¶æ®µ">1.4 é¡¹ç›®å¼€å‘é˜¶æ®µ</h2><figure><img src="https://s2.loli.net/2025/04/14/OIxroN15SEJf4A7.png" alt="image-20250414210042138" /><figcaption aria-hidden="true">image-20250414210042138</figcaption></figure><figure><img src="https://s2.loli.net/2025/04/14/xjgchsFPQ9V8iwb.png" alt="image-20250414210117641" /><figcaption aria-hidden="true">image-20250414210117641</figcaption></figure><p>å¼€æºçš„æ•°æ®æ¸…æ´—å·¥å…·ï¼Œgithubå¼€æºé¡¹ç›®ï¼šMinerUï¼ˆä¸Šæµ·äººå·¥æ™ºèƒ½å®éªŒå®¤ç ”å‘å¼€æºï¼‰</p><p>https://github.com/opendatalab/MinerU</p><h1 id="äºŒä¸ç‘é›ªè€å¸ˆåˆ†äº«">äºŒã€ä¸ç‘é›ªè€å¸ˆåˆ†äº«</h1><figure><img src="https://s2.loli.net/2025/04/14/evyBu9QZwDEP2qp.png" alt="image-20250414213049351" /><figcaption aria-hidden="true">image-20250414213049351</figcaption></figure><figure><img src="https://s2.loli.net/2025/04/14/X4dwOt5YFK8jki7.png" alt="image-20250414213215639" /><figcaption aria-hidden="true">image-20250414213215639</figcaption></figure><figure><img src="https://s2.loli.net/2025/04/14/AQHlv8WLtarXois.png" alt="image-20250414213320631" /><figcaption aria-hidden="true">image-20250414213320631</figcaption></figure><figure><img src="https://s2.loli.net/2025/04/14/z2HD46QZsea9Ohm.png" alt="image-20250414213455387" /><figcaption aria-hidden="true">image-20250414213455387</figcaption></figure>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤§æ¨¡å‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>dify0.15.3ä¸­å·¥ä½œæµä½¿ç”¨01</title>
    <link href="/2025/04/14/dify0.15.3%E4%B8%AD%E5%B7%A5%E4%BD%9C%E6%B5%81%E4%BD%BF%E7%94%A801/"/>
    <url>/2025/04/14/dify0.15.3%E4%B8%AD%E5%B7%A5%E4%BD%9C%E6%B5%81%E4%BD%BF%E7%94%A801/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€èƒŒæ™¯ä¿¡æ¯ä»‹ç»">ä¸€ã€èƒŒæ™¯ä¿¡æ¯ä»‹ç»</h1><p>æ­å»ºæ•™ç¨‹ï¼šhttps://jiangsanyin.github.io/2025/03/17/Ubuntu2204%E9%83%A8%E7%BD%B2Dify%E7%8E%AF%E5%A2%83/</p><p>ç°åœ¨ä¸€ä¸ªæ–°çš„æœåŠ¡å™¨ä¸Šé‡æ–°æ­å»ºäº†ä¸€å¥—dify0.15.3ç¯å¢ƒï¼ŒæœåŠ¡å™¨IPæ˜¯ï¼š172.20.0.22ï¼ŒdifyæœåŠ¡è¿è¡Œåœ¨81ç«¯å£ã€‚</p><figure><img src="https://s2.loli.net/2025/04/14/IwGUmOLuisr9BFh.png" alt="image-20250414100326346" /><figcaption>image-20250414100326346</figcaption></figure><h1 id="äºŒå·¥ä½œæµåº”ç”¨">äºŒã€å·¥ä½œæµåº”ç”¨</h1><h2 id="chatflowç±»å‹åº”ç”¨">2.1 chatflowç±»å‹åº”ç”¨</h2><figure><img src="https://s2.loli.net/2025/04/14/Qd1JpEzhOMlxVwv.png" alt="image-20250414171302837" /><figcaption>image-20250414171302837</figcaption></figure><figure><img src="https://s2.loli.net/2025/04/14/qY8yDrV3x4IapLX.png" alt="image-20250414171423497" /><figcaption>image-20250414171423497</figcaption></figure><figure><img src="https://s2.loli.net/2025/04/14/rGEYwl4sNydxW3e.png" alt="image-20250414105611601" /><figcaption>image-20250414105611601</figcaption></figure><p>åˆ›å»ºå¦‚ä¸‹å·¥ä½œæµå†…å®¹ï¼š</p><figure><img src="https://s2.loli.net/2025/04/14/rWHGqouRxtLcFXb.png" alt="image-20250414171539734" /><figcaption>image-20250414171539734</figcaption></figure><p>å…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">app:</span><br>  <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;&#x27;</span><br>  <span class="hljs-attr">icon:</span> <span class="hljs-string">ğŸ¤–</span><br>  <span class="hljs-attr">icon_background:</span> <span class="hljs-string">&#x27;#FFEAD5&#x27;</span><br>  <span class="hljs-attr">mode:</span> <span class="hljs-string">advanced-chat</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">çŸ¥è¯†åº“é—®ç­”å·¥ä½œæµ</span><br>  <span class="hljs-attr">use_icon_as_answer_icon:</span> <span class="hljs-literal">false</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">app</span><br><span class="hljs-attr">version:</span> <span class="hljs-number">0.1</span><span class="hljs-number">.5</span><br><span class="hljs-attr">workflow:</span><br>  <span class="hljs-attr">conversation_variables:</span> []<br>  <span class="hljs-attr">environment_variables:</span> []<br>  <span class="hljs-attr">features:</span><br>    <span class="hljs-attr">file_upload:</span><br>      <span class="hljs-attr">allowed_file_extensions:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">.JPG</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">.JPEG</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">.PNG</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">.GIF</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">.WEBP</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">.SVG</span><br>      <span class="hljs-attr">allowed_file_types:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">image</span><br>      <span class="hljs-attr">allowed_file_upload_methods:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">local_file</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">remote_url</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">fileUploadConfig:</span><br>        <span class="hljs-attr">audio_file_size_limit:</span> <span class="hljs-number">50</span><br>        <span class="hljs-attr">batch_count_limit:</span> <span class="hljs-number">5</span><br>        <span class="hljs-attr">file_size_limit:</span> <span class="hljs-number">100</span><br>        <span class="hljs-attr">image_file_size_limit:</span> <span class="hljs-number">10</span><br>        <span class="hljs-attr">video_file_size_limit:</span> <span class="hljs-number">100</span><br>        <span class="hljs-attr">workflow_file_upload_limit:</span> <span class="hljs-number">10</span><br>      <span class="hljs-attr">image:</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>        <span class="hljs-attr">number_limits:</span> <span class="hljs-number">3</span><br>        <span class="hljs-attr">transfer_methods:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">local_file</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">remote_url</span><br>      <span class="hljs-attr">number_limits:</span> <span class="hljs-number">3</span><br>    <span class="hljs-attr">opening_statement:</span> <span class="hljs-string">æˆ‘æ˜¯ä½ </span> <span class="hljs-string">PyTorchå­¦ä¹ åŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨ã€‚</span><br>    <span class="hljs-attr">retriever_resource:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">sensitive_word_avoidance:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">speech_to_text:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">suggested_questions:</span> []<br>    <span class="hljs-attr">suggested_questions_after_answer:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">text_to_speech:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">language:</span> <span class="hljs-string">&#x27;&#x27;</span><br>      <span class="hljs-attr">voice:</span> <span class="hljs-string">&#x27;&#x27;</span><br>  <span class="hljs-attr">graph:</span><br>    <span class="hljs-attr">edges:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">data:</span><br>        <span class="hljs-attr">sourceType:</span> <span class="hljs-string">start</span><br>        <span class="hljs-attr">targetType:</span> <span class="hljs-string">llm</span><br>      <span class="hljs-attr">id:</span> <span class="hljs-number">1744599364444</span><span class="hljs-string">-llm</span><br>      <span class="hljs-attr">selected:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">source:</span> <span class="hljs-string">&#x27;1744599364444&#x27;</span><br>      <span class="hljs-attr">sourceHandle:</span> <span class="hljs-string">source</span><br>      <span class="hljs-attr">target:</span> <span class="hljs-string">llm</span><br>      <span class="hljs-attr">targetHandle:</span> <span class="hljs-string">target</span><br>      <span class="hljs-attr">type:</span> <span class="hljs-string">custom</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">data:</span><br>        <span class="hljs-attr">isInIteration:</span> <span class="hljs-literal">false</span><br>        <span class="hljs-attr">sourceType:</span> <span class="hljs-string">llm</span><br>        <span class="hljs-attr">targetType:</span> <span class="hljs-string">knowledge-retrieval</span><br>      <span class="hljs-attr">id:</span> <span class="hljs-string">llm-source-1744604782998-target</span><br>      <span class="hljs-attr">selected:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">source:</span> <span class="hljs-string">llm</span><br>      <span class="hljs-attr">sourceHandle:</span> <span class="hljs-string">source</span><br>      <span class="hljs-attr">target:</span> <span class="hljs-string">&#x27;1744604782998&#x27;</span><br>      <span class="hljs-attr">targetHandle:</span> <span class="hljs-string">target</span><br>      <span class="hljs-attr">type:</span> <span class="hljs-string">custom</span><br>      <span class="hljs-attr">zIndex:</span> <span class="hljs-number">0</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">data:</span><br>        <span class="hljs-attr">isInIteration:</span> <span class="hljs-literal">false</span><br>        <span class="hljs-attr">sourceType:</span> <span class="hljs-string">knowledge-retrieval</span><br>        <span class="hljs-attr">targetType:</span> <span class="hljs-string">llm</span><br>      <span class="hljs-attr">id:</span> <span class="hljs-number">1744604782998</span><span class="hljs-string">-source-1744605230519-target</span><br>      <span class="hljs-attr">selected:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">source:</span> <span class="hljs-string">&#x27;1744604782998&#x27;</span><br>      <span class="hljs-attr">sourceHandle:</span> <span class="hljs-string">source</span><br>      <span class="hljs-attr">target:</span> <span class="hljs-string">&#x27;1744605230519&#x27;</span><br>      <span class="hljs-attr">targetHandle:</span> <span class="hljs-string">target</span><br>      <span class="hljs-attr">type:</span> <span class="hljs-string">custom</span><br>      <span class="hljs-attr">zIndex:</span> <span class="hljs-number">0</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">data:</span><br>        <span class="hljs-attr">isInIteration:</span> <span class="hljs-literal">false</span><br>        <span class="hljs-attr">sourceType:</span> <span class="hljs-string">llm</span><br>        <span class="hljs-attr">targetType:</span> <span class="hljs-string">answer</span><br>      <span class="hljs-attr">id:</span> <span class="hljs-number">1744605230519</span><span class="hljs-string">-source-answer-target</span><br>      <span class="hljs-attr">selected:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">source:</span> <span class="hljs-string">&#x27;1744605230519&#x27;</span><br>      <span class="hljs-attr">sourceHandle:</span> <span class="hljs-string">source</span><br>      <span class="hljs-attr">target:</span> <span class="hljs-string">answer</span><br>      <span class="hljs-attr">targetHandle:</span> <span class="hljs-string">target</span><br>      <span class="hljs-attr">type:</span> <span class="hljs-string">custom</span><br>      <span class="hljs-attr">zIndex:</span> <span class="hljs-number">0</span><br>    <span class="hljs-attr">nodes:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">data:</span><br>        <span class="hljs-attr">desc:</span> <span class="hljs-string">&#x27;&#x27;</span><br>        <span class="hljs-attr">selected:</span> <span class="hljs-literal">false</span><br>        <span class="hljs-attr">title:</span> <span class="hljs-string">å¼€å§‹</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">start</span><br>        <span class="hljs-attr">variables:</span> []<br>      <span class="hljs-attr">height:</span> <span class="hljs-number">53</span><br>      <span class="hljs-attr">id:</span> <span class="hljs-string">&#x27;1744599364444&#x27;</span><br>      <span class="hljs-attr">position:</span><br>        <span class="hljs-attr">x:</span> <span class="hljs-number">80</span><br>        <span class="hljs-attr">y:</span> <span class="hljs-number">282</span><br>      <span class="hljs-attr">positionAbsolute:</span><br>        <span class="hljs-attr">x:</span> <span class="hljs-number">80</span><br>        <span class="hljs-attr">y:</span> <span class="hljs-number">282</span><br>      <span class="hljs-attr">selected:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">sourcePosition:</span> <span class="hljs-string">right</span><br>      <span class="hljs-attr">targetPosition:</span> <span class="hljs-string">left</span><br>      <span class="hljs-attr">type:</span> <span class="hljs-string">custom</span><br>      <span class="hljs-attr">width:</span> <span class="hljs-number">244</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">data:</span><br>        <span class="hljs-attr">context:</span><br>          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>          <span class="hljs-attr">variable_selector:</span> []<br>        <span class="hljs-attr">desc:</span> <span class="hljs-string">&#x27;&#x27;</span><br>        <span class="hljs-attr">memory:</span><br>          <span class="hljs-attr">query_prompt_template:</span> <span class="hljs-string">&#x27;ç”¨æˆ·çš„é—®é¢˜å¦‚ä¸‹ï¼š</span><br><span class="hljs-string"></span><br><span class="hljs-string">            &#123;&#123;#sys.query#&#125;&#125;&#x27;</span><br>          <span class="hljs-attr">role_prefix:</span><br>            <span class="hljs-attr">assistant:</span> <span class="hljs-string">&#x27;&#x27;</span><br>            <span class="hljs-attr">user:</span> <span class="hljs-string">&#x27;&#x27;</span><br>          <span class="hljs-attr">window:</span><br>            <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>            <span class="hljs-attr">size:</span> <span class="hljs-number">10</span><br>        <span class="hljs-attr">model:</span><br>          <span class="hljs-attr">completion_params:</span><br>            <span class="hljs-attr">temperature:</span> <span class="hljs-number">0.7</span><br>          <span class="hljs-attr">mode:</span> <span class="hljs-string">chat</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">qwen-max-latest</span><br>          <span class="hljs-attr">provider:</span> <span class="hljs-string">tongyi</span><br>        <span class="hljs-attr">prompt_template:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">90d3eb3d-8c11-4069-9f6c-b0cf1effd52b</span><br>          <span class="hljs-attr">role:</span> <span class="hljs-string">system</span><br>          <span class="hljs-attr">text:</span> <span class="hljs-string">&#x27;## ä»»åŠ¡</span><br><span class="hljs-string"></span><br><span class="hljs-string">            è¯·ä»ç”¨æˆ·ç»™å®šçš„é—®é¢˜ä¸­æå–å…³é”®å†…å®¹ï¼Œç”¨äºæ£€ç´¢çŸ¥è¯†åº“å†…å®¹</span><br><span class="hljs-string"></span><br><span class="hljs-string">            ## è¾“å‡º</span><br><span class="hljs-string"></span><br><span class="hljs-string">            è¾“å‡ºå¤šä¸ªå…³é”®å­—æˆ–å…³é”®å¥ï¼Œå…³é”®å­—æˆ–å…³é”®å¥ä¹‹é—´ç”¨ç©ºæ ¼éš”å¼€ï¼Œä¸éœ€è¦å…¶ä»–æ— å…³çš„æ–‡æœ¬å†…å®¹ã€‚ç¦æ­¢ç›´æ¥å›å¤ç”¨æˆ·çš„é—®é¢˜&#x27;</span><br>        <span class="hljs-attr">selected:</span> <span class="hljs-literal">false</span><br>        <span class="hljs-attr">title:</span> <span class="hljs-string">æå–å…³é”®å†…å®¹</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">llm</span><br>        <span class="hljs-attr">variables:</span> []<br>        <span class="hljs-attr">vision:</span><br>          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">height:</span> <span class="hljs-number">97</span><br>      <span class="hljs-attr">id:</span> <span class="hljs-string">llm</span><br>      <span class="hljs-attr">position:</span><br>        <span class="hljs-attr">x:</span> <span class="hljs-number">380</span><br>        <span class="hljs-attr">y:</span> <span class="hljs-number">282</span><br>      <span class="hljs-attr">positionAbsolute:</span><br>        <span class="hljs-attr">x:</span> <span class="hljs-number">380</span><br>        <span class="hljs-attr">y:</span> <span class="hljs-number">282</span><br>      <span class="hljs-attr">selected:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">sourcePosition:</span> <span class="hljs-string">right</span><br>      <span class="hljs-attr">targetPosition:</span> <span class="hljs-string">left</span><br>      <span class="hljs-attr">type:</span> <span class="hljs-string">custom</span><br>      <span class="hljs-attr">width:</span> <span class="hljs-number">244</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">data:</span><br>        <span class="hljs-attr">answer:</span> <span class="hljs-string">&#x27;&#123;&#123;#1744605230519.text#&#125;&#125;&#x27;</span><br>        <span class="hljs-attr">desc:</span> <span class="hljs-string">&#x27;&#x27;</span><br>        <span class="hljs-attr">selected:</span> <span class="hljs-literal">false</span><br>        <span class="hljs-attr">title:</span> <span class="hljs-string">ç›´æ¥å›å¤</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">answer</span><br>        <span class="hljs-attr">variables:</span> []<br>      <span class="hljs-attr">height:</span> <span class="hljs-number">102</span><br>      <span class="hljs-attr">id:</span> <span class="hljs-string">answer</span><br>      <span class="hljs-attr">position:</span><br>        <span class="hljs-attr">x:</span> <span class="hljs-number">1273</span><br>        <span class="hljs-attr">y:</span> <span class="hljs-number">282</span><br>      <span class="hljs-attr">positionAbsolute:</span><br>        <span class="hljs-attr">x:</span> <span class="hljs-number">1273</span><br>        <span class="hljs-attr">y:</span> <span class="hljs-number">282</span><br>      <span class="hljs-attr">selected:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">sourcePosition:</span> <span class="hljs-string">right</span><br>      <span class="hljs-attr">targetPosition:</span> <span class="hljs-string">left</span><br>      <span class="hljs-attr">type:</span> <span class="hljs-string">custom</span><br>      <span class="hljs-attr">width:</span> <span class="hljs-number">244</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">data:</span><br>        <span class="hljs-attr">dataset_ids:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">12b20101-0ff8-422b-98fc-cc78440007d8</span><br>        <span class="hljs-attr">desc:</span> <span class="hljs-string">&#x27;&#x27;</span><br>        <span class="hljs-attr">multiple_retrieval_config:</span><br>          <span class="hljs-attr">reranking_enable:</span> <span class="hljs-literal">true</span><br>          <span class="hljs-attr">reranking_mode:</span> <span class="hljs-string">reranking_model</span><br>          <span class="hljs-attr">reranking_model:</span><br>            <span class="hljs-attr">model:</span> <span class="hljs-string">gte-rerank</span><br>            <span class="hljs-attr">provider:</span> <span class="hljs-string">tongyi</span><br>          <span class="hljs-attr">top_k:</span> <span class="hljs-number">4</span><br>        <span class="hljs-attr">query_variable_selector:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">llm</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">text</span><br>        <span class="hljs-attr">retrieval_mode:</span> <span class="hljs-string">multiple</span><br>        <span class="hljs-attr">selected:</span> <span class="hljs-literal">false</span><br>        <span class="hljs-attr">title:</span> <span class="hljs-string">çŸ¥è¯†æ£€ç´¢</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">knowledge-retrieval</span><br>      <span class="hljs-attr">height:</span> <span class="hljs-number">91</span><br>      <span class="hljs-attr">id:</span> <span class="hljs-string">&#x27;1744604782998&#x27;</span><br>      <span class="hljs-attr">position:</span><br>        <span class="hljs-attr">x:</span> <span class="hljs-number">681</span><br>        <span class="hljs-attr">y:</span> <span class="hljs-number">282</span><br>      <span class="hljs-attr">positionAbsolute:</span><br>        <span class="hljs-attr">x:</span> <span class="hljs-number">681</span><br>        <span class="hljs-attr">y:</span> <span class="hljs-number">282</span><br>      <span class="hljs-attr">selected:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">sourcePosition:</span> <span class="hljs-string">right</span><br>      <span class="hljs-attr">targetPosition:</span> <span class="hljs-string">left</span><br>      <span class="hljs-attr">type:</span> <span class="hljs-string">custom</span><br>      <span class="hljs-attr">width:</span> <span class="hljs-number">244</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">data:</span><br>        <span class="hljs-attr">context:</span><br>          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>          <span class="hljs-attr">variable_selector:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;1744604782998&#x27;</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">result</span><br>        <span class="hljs-attr">desc:</span> <span class="hljs-string">&#x27;&#x27;</span><br>        <span class="hljs-attr">memory:</span><br>          <span class="hljs-attr">query_prompt_template:</span> <span class="hljs-string">&#x27;&#x27;</span><br>          <span class="hljs-attr">role_prefix:</span><br>            <span class="hljs-attr">assistant:</span> <span class="hljs-string">&#x27;&#x27;</span><br>            <span class="hljs-attr">user:</span> <span class="hljs-string">&#x27;&#x27;</span><br>          <span class="hljs-attr">window:</span><br>            <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>            <span class="hljs-attr">size:</span> <span class="hljs-number">50</span><br>        <span class="hljs-attr">model:</span><br>          <span class="hljs-attr">completion_params:</span><br>            <span class="hljs-attr">temperature:</span> <span class="hljs-number">0.7</span><br>          <span class="hljs-attr">mode:</span> <span class="hljs-string">chat</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">qwen-max-latest</span><br>          <span class="hljs-attr">provider:</span> <span class="hljs-string">tongyi</span><br>        <span class="hljs-attr">prompt_template:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">0741400e-f6df-4965-aa25-27a88c6423ac</span><br>          <span class="hljs-attr">role:</span> <span class="hljs-string">system</span><br>          <span class="hljs-attr">text:</span> <span class="hljs-string">&#x27;## è§’è‰²</span><br><span class="hljs-string"></span><br><span class="hljs-string">            ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å®¢æœï¼Œæ“…é•¿æ ¹æ®çŸ¥è¯†åº“å†…å®¹å›ç­”ç”¨æˆ·çš„é—®é¢˜</span><br><span class="hljs-string"></span><br><span class="hljs-string">            ## èƒŒæ™¯</span><br><span class="hljs-string"></span><br><span class="hljs-string">            ä¸¥æ ¼æ ¹æ®çŸ¥è¯†åº“å†…å®¹å›ç­”ç”¨æˆ·é—®é¢˜ï¼Œå¯¹äºç”¨æˆ·ç†è§£ç§æœ‰æ–‡æ¡£ååˆ†é‡è¦ã€‚</span><br><span class="hljs-string"></span><br><span class="hljs-string">            ## ä»»åŠ¡</span><br><span class="hljs-string"></span><br><span class="hljs-string">            ä¸¥æ ¼æ ¹æ®ä¸‹é¢çš„çŸ¥è¯†åº“çš„å†…å®¹å›ç­”ç”¨æˆ·çš„é—®é¢˜</span><br><span class="hljs-string"></span><br><span class="hljs-string">            ## çŸ¥è¯†åº“</span><br><span class="hljs-string"></span><br><span class="hljs-string">            &#123;&#123;#context#&#125;&#125;&#x27;</span><br>        <span class="hljs-attr">selected:</span> <span class="hljs-literal">false</span><br>        <span class="hljs-attr">title:</span> <span class="hljs-string">å›ç­”é—®é¢˜</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">llm</span><br>        <span class="hljs-attr">variables:</span> []<br>        <span class="hljs-attr">vision:</span><br>          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">height:</span> <span class="hljs-number">97</span><br>      <span class="hljs-attr">id:</span> <span class="hljs-string">&#x27;1744605230519&#x27;</span><br>      <span class="hljs-attr">position:</span><br>        <span class="hljs-attr">x:</span> <span class="hljs-number">959</span><br>        <span class="hljs-attr">y:</span> <span class="hljs-number">271</span><br>      <span class="hljs-attr">positionAbsolute:</span><br>        <span class="hljs-attr">x:</span> <span class="hljs-number">959</span><br>        <span class="hljs-attr">y:</span> <span class="hljs-number">271</span><br>      <span class="hljs-attr">selected:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">sourcePosition:</span> <span class="hljs-string">right</span><br>      <span class="hljs-attr">targetPosition:</span> <span class="hljs-string">left</span><br>      <span class="hljs-attr">type:</span> <span class="hljs-string">custom</span><br>      <span class="hljs-attr">width:</span> <span class="hljs-number">244</span><br>    <span class="hljs-attr">viewport:</span><br>      <span class="hljs-attr">x:</span> <span class="hljs-number">6.0819642019071125</span><br>      <span class="hljs-attr">y:</span> <span class="hljs-number">-54.89333757760929</span><br>      <span class="hljs-attr">zoom:</span> <span class="hljs-number">0.870550563296124</span><br></code></pre></td></tr></table></figure><p>æ‰§è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p><figure><img src="https://s2.loli.net/2025/05/10/JMC6kUaKzAOLhHY.png" alt="image-20250414172009151" /><figcaption>image-20250414172009151</figcaption></figure>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤§æ¨¡å‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¤§æ¨¡å‹åº”ç”¨å¼€å‘RAG-é€Ÿé€šç™¾ç‚¼RAGåº”ç”¨</title>
    <link href="/2025/04/13/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91RAG-%E9%80%9F%E9%80%9A%E7%99%BE%E7%82%BCRAG%E5%BA%94%E7%94%A8/"/>
    <url>/2025/04/13/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91RAG-%E9%80%9F%E9%80%9A%E7%99%BE%E7%82%BCRAG%E5%BA%94%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€å¤§æ¨¡å‹åº”ç”¨å¦‚ä½•èµ°å‘ä¼ä¸šè½åœ°">ä¸€ã€å¤§æ¨¡å‹åº”ç”¨å¦‚ä½•èµ°å‘ä¼ä¸šè½åœ°ï¼Ÿ</h1><h2 id="å¤§æ¨¡å‹åˆ°ä¸šåŠ¡çš„è·ç¦»æœ‰å¤šè¿œ">1.1 å¤§æ¨¡å‹åˆ°ä¸šåŠ¡çš„è·ç¦»æœ‰å¤šè¿œï¼Ÿ</h2><p><strong>ğŸ¤”ï¼šæƒ³æŠŠå¤§æ¨¡å‹ç”¨åœ¨ç”Ÿäº§åœºæ™¯ã€éœ€è¦è€ƒè™‘å“ªäº›é—®é¢˜ï¼Ÿ</strong></p><p>â€‹ åœ¨ä¼ä¸šç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œå¸¸è§çš„å¤§æ¨¡å‹åº”ç”¨è½åœ°çš„ç—›ç‚¹å’Œé—®é¢˜å¯èƒ½æ˜¯è¿™äº›ï¼š</p><ul><li><strong>åº”ç”¨æ­å»ºå¤æ‚</strong> ï¼šé’ˆå¯¹ä¸åŒçš„ä¸šåŠ¡ç›®æ ‡ã€éƒ½éœ€è¦èŠ±å¤§é‡æ—¶é—´æŠ•å…¥é€‰å‹å’Œæµ‹è¯•</li><li><strong>æç¤ºè¯å·¥ç¨‹å¤æ‚</strong> ï¼šä¸€ä¸ªé—®é¢˜éœ€è¦åå¤æ‰“ç£¨æç¤ºè¯ï¼Œå‘˜å·¥éœ€æŒæ¡â€œè°ƒæ•™æ¨¡å‹â€æŠ€èƒ½ï¼Œè·¨éƒ¨é—¨åä½œæ•ˆç‡é™ä½ã€‚</li><li><strong>æ— æ³•è§£å†³å¤æ‚ä»»åŠ¡</strong> ï¼šAIå¾ˆéš¾æ‰§è¡Œå¤æ‚ä»»åŠ¡ï¼Œä¸ä¼šæ‹†è§£ä¸šåŠ¡åœºæ™¯çš„æ ¸å¿ƒé—®é¢˜</li><li><strong>ç¼ºå°‘è¡Œä¸šçŸ¥è¯†</strong> ï¼šé¢†åŸŸçŸ¥è¯†åŒ®ä¹ã€åŠ¨æ€æ•°æ®æ›´æ–°æ»åã€å¤šæ¨¡æ€å¤„ç†èƒ½åŠ›å·®</li><li><strong>ç­‰ç­‰Â·Â·Â·</strong></li></ul><h2 id="ä¼ä¸šçº§aiåº”ç”¨çš„å‚è€ƒç­”æ¡ˆ-ai-agentæ™ºèƒ½ä½“åº”ç”¨">1.2 ä¼ä¸šçº§AIåº”ç”¨çš„å‚è€ƒç­”æ¡ˆâ€”â€” AI Agentï¼ˆæ™ºèƒ½ä½“åº”ç”¨ï¼‰</h2><p>å‡è®¾æ¯ä¸ªåˆé€‚çš„å·¥ä½œåœºæ™¯éƒ½æœ‰ä¸€ä¸ªæ™ºèƒ½åŠ©ç†ï¼Œç†Ÿæ‚‰æ ¸å¿ƒæ€è·¯å’Œæ•°æ®ï¼Œåªè¦è¯´éœ€æ±‚ï¼Œå°±å¯ä»¥è·å¾—èƒ½è¾…åŠ©ä¸šåŠ¡å†³ç­–çš„æ•°æ®æˆ–æ–¹æ¡ˆã€‚ å½“ä¼ä¸šé‡Œçš„æ¯ä¸ªäººã€éƒ½èƒ½ç”¨ä¸Šè¿™æ ·çš„æ™ºèƒ½åŠ©ç†ï¼Œå·¥ä½œæ•ˆç‡å°†ä¼šå‘ç”Ÿæ€æ ·çš„å˜åŒ–ï¼Ÿ</p><p>ç­”ï¼šåœ¨è¿™ç§é¢„æœŸä¸‹ã€<strong>AI Agent = ä¸€ä¸ªæ‡‚å¾—å¤æ‚ä»»åŠ¡æ‹†è§£ã€ä¼šæŒç»­å­¦ä¹ å†…å®¹ã€ä¼šèªæ˜è°ƒç”¨å„ç§èµ„æºçš„ä¸€ä¸ªæ•°å­—å‘˜å·¥</strong></p><figure><img src="https://s2.loli.net/2025/04/13/7uUvYrdpRcTwQ41.png" alt="image-20250413150510653" /><figcaption aria-hidden="true">image-20250413150510653</figcaption></figure><h2 id="æˆ‘ä»¬æ¥çœ‹ä¸¤ä¸ªçœŸå®çš„è½åœ°æ¡ˆä¾‹">1.3 æˆ‘ä»¬æ¥çœ‹ä¸¤ä¸ªçœŸå®çš„è½åœ°æ¡ˆä¾‹</h2><h3 id="æ¡ˆä¾‹1aiè´¢åŠ¡">1.3.1 æ¡ˆä¾‹1ï¼šAI+è´¢åŠ¡</h3><p>ğŸ¤”ï¼šåœ¨è¿™ç§ä¸šåŠ¡åœºæ™¯ã€ä½ ä¼šå¦‚ä½•è®¾è®¡å¤§æ¨¡å‹åº”ç”¨ï¼Ÿ</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">ç›®æ ‡ä¼ä¸š ï¼šä¼šè®¡å¸ˆäº‹åŠ¡æ‰€<br>åº”ç”¨ç›®æ ‡ ï¼šæå‡è´¢åŠ¡å·¥ä½œäººå‘˜çš„å·¥ä½œæ•ˆç‡<br>è´¢åŠ¡å·¥ä½œäººå‘˜çš„ä¸šåŠ¡ç‰¹æ€§ ï¼š æ”¿ç­–æ•æ„Ÿåº¦ã€åˆè§„æ€§ã€é£é™©æ•æ„Ÿåº¦ ç­‰å·¥ä½œ<br></code></pre></td></tr></table></figure><ul><li><p>é¡¹ç›®çœŸå®æƒ…å†µ</p><ul><li><p><strong>é¡¹ç›®åç§°</strong> ï¼šAIè´¢ä¼šåŠ©æ‰‹</p></li><li><p><strong>é¡¹ç›®ç®€ä»‹</strong> ï¼šæ„å»ºåŠ¨æ€æ›´æ–°çš„è´¢ç¨çŸ¥è¯†å›¾è°±ï¼Œæ¨åŠ¨ä¸“ä¸šæœåŠ¡æ™ºèƒ½åŒ–è½¬å‹ã€‚</p></li><li><p><strong>é¡¹ç›®æˆæœ</strong> ï¼šæ„å»ºäº†åºå¤§çš„è´¢åŠ¡è¡Œä¸šé¢†åŸŸæ•°æ®çŸ¥è¯†åº“ï¼Œé€šè¿‡ <strong>RAGæœç´¢å¢å¼º</strong> ç­‰æŠ€æœ¯ï¼Œæ„å»ºäº†å®Œæ•´çš„è´¢åŠ¡çŸ¥è¯†å›¾è°±ï¼Œè®©AIå¤§æ¨¡å‹åœ¨è´¢åŠ¡é¢†åŸŸçš„ä¸“ä¸šåº¦ç›´çº¿ä¸Šå‡ï¼Œ <strong>æœ€åè·å¾—äº†æ³¨å†Œä¼šè®¡å¸ˆ96%çš„æ»¡æ„åº¦è¯„ä»·</strong> ã€‚</p></li></ul></li><li><p>äº®ç‚¹1ï¼šæƒå¨çŸ¥è¯†ä¸­æ¢</p><ul><li><strong>å…¨ç»´åº¦æ³•è§„è¦†ç›–</strong> ï¼šé›†æˆä¼šè®¡/è¯åˆ¸/ç¨åŠ¡/ç»æµå››å¤§æ ¸å¿ƒé¢†åŸŸæ³•è§„åº“ï¼›æ”¯æŒå®æ—¶åŒæ­¥æœ€æ–°æ”¿ç­–æ–‡ä»¶</li><li><strong>æ™ºèƒ½çŸ¥è¯†å›¾è°±</strong> ï¼šå»ºç«‹æ³•è§„æ¡æ¬¾-æ¡ˆä¾‹åº”ç”¨-ä¸šåŠ¡å®æ“çš„ä¸šåŠ¡é—­ç¯</li><li><img src="https://s2.loli.net/2025/04/13/61V4ZKqvSrYft8T.png" title="fig:" alt="image-20250413151040281" /></li></ul></li><li><p>äº®ç‚¹2ï¼šå†³ç­–æ™ºèƒ½å¼•æ“</p><ul><li><strong>ä¸“ä¸šçº§AIè§£æ</strong> ï¼š åŸºäºè¡Œä¸šèµ„æ·±æ³¨å†Œä¼šè®¡å¸ˆå›¢é˜Ÿä½“ç³»åŒ–è¯„ä¼°ï¼Œå®é™…ä¸šåŠ¡é—®é¢˜å‡†ç¡®ç‡è¾¾96%ã€‚</li><li><strong>åŠ¨æ€å­¦ä¹ ç³»ç»Ÿ</strong> ï¼šç½®ä¿¡åº¦ä¸“å®¶åº“å®æ—¶å¸æ”¶ç”¨æˆ·åé¦ˆï¼ŒæŒç»­ä¼˜åŒ–çš„é—®ç­”è´¨é‡ä¿éšœæ¨¡å‹æ•ˆæœã€‚</li><li><img src="https://s2.loli.net/2025/04/13/MtHu19LGf7JKFIq.png" title="fig:" alt="image-20250413151307555" /></li></ul></li><li><p>äº®ç‚¹3ï¼šæ•ˆç‡é©å‘½å·¥å…·</p><ul><li><p><strong>å¿«é€Ÿæ£€ç´¢</strong> ï¼šé«˜æ•ˆè¿›è¡Œæ–°è€æ”¿ç­–æ³•è§„æ£€ç´¢ï¼›</p></li><li><p><strong>è¾…åŠ©è§£è¯»</strong> ï¼šå¿«é€Ÿè¾…åŠ©ä»ä¸šäººå‘˜å¯¹å¤æ‚æ³•è§„è¿›è¡Œç†è§£ï¼›</p></li><li><p><strong>çƒ­æ¦œæ´å¯Ÿ</strong> ï¼šå®æ—¶å‘ˆç°è¡Œä¸šé«˜é¢‘é—®é¢˜çƒ­æ¦œ</p></li><li><figure><img src="https://s2.loli.net/2025/04/13/U8LkZMWgHYItszo.png" alt="image-20250413151455812" /><figcaption aria-hidden="true">image-20250413151455812</figcaption></figure></li></ul></li><li><p>äº®ç‚¹4ï¼šé£é™©æ§åˆ¶ä½“ç³»</p><ul><li><p><strong>æº¯æºéªŒè¯æœºåˆ¶</strong></p><ul><li><p>æ”¯æŒå…³é”®æ¡æ¬¾çš„æ™ºèƒ½åŒ¹é…ä¸å¼•ç”¨</p></li><li><p>åŒé€šé“çŸ¥è¯†æ¥æºè¿½æº¯ï¼ˆæ³•è§„åŸæ–‡+æ¡ˆä¾‹ä¾æ®ï¼‰</p></li><li><p>é‡ç‚¹æ¡æ¬¾é«˜äº®æ ‡æ³¨åŠŸèƒ½</p></li><li><figure><img src="https://s2.loli.net/2025/04/13/ZjgLlVI6tfekBCT.png" alt="image-20250413151548703" /><figcaption aria-hidden="true">image-20250413151548703</figcaption></figure></li><li><figure><img src="https://s2.loli.net/2025/04/13/FceTK8WzIGLmrOH.png" alt="image-20250413151624810" /><figcaption aria-hidden="true">image-20250413151624810</figcaption></figure></li></ul></li></ul></li></ul><h3 id="æ¡ˆä¾‹2aiè´­ç‰©">1.3.2 æ¡ˆä¾‹2ï¼šAI+è´­ç‰©</h3><p>ğŸ¤”ï¼šåœ¨è¿™ç§ä¸šåŠ¡åœºæ™¯ã€ä½ ä¼šå¦‚ä½•è®¾è®¡å¤§æ¨¡å‹åº”ç”¨ï¼Ÿ</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">ç›®æ ‡åœºæ™¯ ï¼šè´­ç‰©ç³»ç»Ÿ<br>åº”ç”¨ç›®æ ‡ ï¼šæå‡æ¶ˆè´¹è€…çš„è´­ä¹°ä½“éªŒ<br></code></pre></td></tr></table></figure><ul><li><p>é¡¹ç›®çœŸå®æƒ…å†µ</p><ul><li><p><strong>é¡¹ç›®åç§°</strong> ï¼šAIè´­ç‰©ç³»ç»Ÿ</p></li><li><p><strong>é¡¹ç›®ç®€ä»‹</strong> ï¼šä»¥ç”¨æˆ·ä¸ºæ ¸å¿ƒï¼Œæ„å»ºä¸€ä¸ªå…¨é¢æ™ºèƒ½åŒ–ã€ä¸ªæ€§åŒ–çš„è´­ç‰©ç”Ÿæ€ç³»ç»Ÿã€‚</p></li><li><p><strong>é¡¹ç›®æˆæœ</strong> ï¼š</p><ul><li><p>ç”¨æˆ·çš„æ¯ä¸€æ¬¡è´­ç‰©ä¸å†åªæ˜¯è´­ä¹°äº§å“ï¼Œè€Œæ˜¯è·å¾—ä¸€ä½â€œAIæœ‹å‹â€ï¼Œä¸€ä¸ªçœŸæ­£æ‡‚ç”¨æˆ·ã€åˆ†æéœ€æ±‚ã€æ¨èæœ€é€‚åˆæ–¹æ¡ˆçš„æ™ºèƒ½ç®¡å®¶ã€‚</p></li><li><p>å›´ç»•ç”¨æˆ·éœ€æ±‚åœºæ™¯ï¼Œå¼€å‘äº† <strong>AIå¯¼è´­ï¼ŒAIè¯„ä¼°ç®¡å®¶ã€AIé¥®é£Ÿç®¡å®¶ã€AIç¡çœ ç®¡å®¶ã€AIå‡å‹ç®¡å®¶</strong> ç­‰åŠŸèƒ½ï¼Œå…¨æ–¹ä½æœåŠ¡ç”¨æˆ·çš„å·¥ä½œç”Ÿæ´»ã€‚</p></li></ul></li></ul></li><li><p>AIå¯¼è´­æµç¨‹å›¾</p><p>AIå¯¼è´­é€šè¿‡RAGæŠ€æœ¯åšå•†å“è¯­ä¹‰æœç´¢ï¼Œè®©ç”¨æˆ·åœ¨å’ŒAIçš„æ²Ÿé€šä¸­å¯ä»¥è·å¾—æœ€ç²¾ç¡®çš„å•†å“æ¨è</p><figure><img src="https://s2.loli.net/2025/04/13/BKmk6lICSrb3eRQ.png" alt="image-20250413162632646" /><figcaption aria-hidden="true">image-20250413162632646</figcaption></figure></li><li><p>é¡¹ç›®æ•ˆæœç¤ºæ„</p></li></ul><figure><img src="https://s2.loli.net/2025/04/13/Z32rniyV9FOwlHh.png" alt="image-20250413162842838" /><figcaption aria-hidden="true">image-20250413162842838</figcaption></figure><figure><img src="https://s2.loli.net/2025/04/13/LpPsJrgF7liXCcM.png" alt="image-20250413162937533" /><figcaption aria-hidden="true">image-20250413162937533</figcaption></figure><figure><img src="https://s2.loli.net/2025/04/13/DmrHao1QC8Iv6cT.png" alt="image-20250413162945033" /><figcaption aria-hidden="true">image-20250413162945033</figcaption></figure><figure><img src="https://s2.loli.net/2025/04/13/q4eUmvDYfOj5t8h.png" alt="image-20250413162949834" /><figcaption aria-hidden="true">image-20250413162949834</figcaption></figure><h3 id="åˆ’é‡ç‚¹">åˆ’é‡ç‚¹</h3><p>ä»¥ä¸Šä¸¤ä¸ªæ¡ˆä¾‹ã€æœ€å¤§å¤´çš„å·¥ä½œå…¶å®éƒ½æ˜¯æ¸…æ´—æ•°æ®ã€æ„å»ºè‰¯å¥½çš„RAGæ•ˆæœï¼Œæ˜¯ä¿éšœè¿™ä¸¤ä¸ªé¡¹ç›®äº§å“å¯ç”¨æ€§çš„æ ¸å¿ƒç¯èŠ‚ã€‚</p><p>ğŸ¤”ï¼šRAGåœ¨AIåº”ç”¨ä¸­ç©¶ç«Ÿèµ·åˆ°äº†ä»€ä¹ˆä½œç”¨ï¼Ÿ</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">ä»¥ä¸Šæ¡ˆä¾‹ä¸ºä»€ä¹ˆè¦ç”¨RAGï¼Ÿ<br>åœ¨å“ªäº›ç¯èŠ‚å¯èƒ½ä¼šç”¨åˆ°RAGï¼Ÿ<br></code></pre></td></tr></table></figure><h2 id="aiåƒè¡Œç™¾ä¸šæ­£åœ¨è½¬å‹">1.4 AI+åƒè¡Œç™¾ä¸šï¼Œæ­£åœ¨è½¬å‹</h2><p>å®é™…ä¸Šï¼Œå¤§æ¨¡å‹çš„åº”ç”¨æ­£åœ¨å„è¡Œå„ä¸šå–å¾—æ˜¾è‘—è¿›å±•ï¼Œé™¤äº†ä½œè€…æ‰€æ¥è§¦çš„çœŸå®é¡¹ç›®ï¼Œè¿˜æœ‰ <strong>é‡‘èã€åŒ»ç–—ã€æ•™è‚²ã€ç”µå­å•†åŠ¡</strong> ç­‰ç­‰ã€‚</p><p>éšç€ <strong>RAGã€AIå·¥ä½œæµ</strong> ç­‰æŠ€æœ¯çš„æ—¥æ¸æˆç†Ÿã€å°†å¤§æ¨¡å‹åº”ç”¨åˆ°ç”Ÿäº§åœºæ™¯å¤§æœ‰å¯ä¸ºã€‚</p><p>è®¸å¤šå…¬å¸ä¹Ÿåœ¨å¯»æ±‚å…·å¤‡å¤§æ¨¡å‹åº”ç”¨èƒ½åŠ›çš„äººæ‰ã€‚ä»å°±ä¸šå¸‚åœºæ¥çœ‹ï¼Œå¤§æ¨¡å‹é¢†åŸŸçš„éœ€æ±‚éå¸¸å¤§â€”â€”</p><p><strong>ç›¸å…³å²—ä½ï¼š</strong></p><ul><li><strong>æœºå™¨å­¦ä¹ å·¥ç¨‹å¸ˆ</strong> ï¼šä¸“æ³¨äºæ¨¡å‹çš„è®­ç»ƒã€ä¼˜åŒ–å’Œéƒ¨ç½²ã€‚</li><li><strong>æ•°æ®ç§‘å­¦å®¶</strong> ï¼šä»¥æ•°æ®åˆ†æå’ŒæŒ–æ˜ä¸ºæ ¸å¿ƒï¼Œæ¨åŠ¨ AI åº”ç”¨ã€‚</li><li><strong>AI äº§å“ç»ç†</strong> ï¼šè´Ÿè´£AIäº§å“çš„è§„åˆ’ä¸å®æ–½ã€‚</li><li><strong>AIåº”ç”¨å¼€å‘å·¥ç¨‹å¸ˆ</strong> ï¼šç»“åˆä¼ ç»Ÿå¼€å‘èƒŒæ™¯ï¼Œå¼€å‘å¤§æ¨¡å‹åº”ç”¨ã€‚</li></ul><h1 id="äºŒä¸Šæ‰‹ai-agentåº”ç”¨å¼€å‘">äºŒã€ä¸Šæ‰‹AI Agentåº”ç”¨å¼€å‘</h1><p>ğŸ¤”ï¼šæˆ‘ä»¬å¦‚ä½•å¿«é€Ÿä¸Šæ‰‹ AI Agentåº”ç”¨å¼€å‘å‘¢ï¼Ÿ</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">æœ¬æ•™ç¨‹å°†å¸¦å¤§å®¶ä½¿ç”¨é˜¿é‡Œäº‘ç™¾ç‚¼å¹³å°è¿›è¡ŒAIåº”ç”¨å¼€å‘**<br>ä½œè€…é¡¹ç›®ä¸­çš„ <span class="hljs-strong">**RAGæ¨¡å—**</span> å’Œä¸€äº›æ ¸å¿ƒç»„ä»¶æ­£æ˜¯é€‰ç”¨çš„é˜¿é‡Œäº‘ç™¾ç‚¼å¹³å°å®ç°çš„<br></code></pre></td></tr></table></figure><p>è·³è½¬åˆ° <a href="https://bailian.console.aliyun.com/?tab=app#/app-center">é˜¿é‡Œäº‘ç™¾ç‚¼å¹³å°-åº”ç”¨ç®¡ç†</a></p><h2 id="part15åˆ†é’Ÿåˆ›å»ºaiè´¢åŠ¡åŠ©æ‰‹">Part1ï¼š5åˆ†é’Ÿåˆ›å»ºAIè´¢åŠ¡åŠ©æ‰‹</h2><p>ğŸ¤”ï¼šæœ€ç®€å•çš„AIè´¢åŠ¡åŠ©æ‰‹åº”è¯¥å…·å¤‡ä»€ä¹ˆåŠŸèƒ½ï¼Ÿ</p><ul><li>è´¢åŠ¡åŠ©æ‰‹ä¸»è¦æ˜¯å“ªäº›äººéœ€è¦ï¼Ÿ</li><li>æœ‰å“ªäº›æ³¨æ„äº‹é¡¹ï¼Ÿ</li><li>AIä¸»è¦ä¼šåœ¨å…¶ä¸­èµ·ä»€ä¹ˆä½œç”¨ï¼Ÿ</li></ul><h3 id="åˆ›å»ºåº”ç”¨">1ï¸âƒ£ åˆ›å»ºåº”ç”¨</h3><p>é€‰æ‹©åˆ›å»ºæ™ºèƒ½ä½“åº”ç”¨ï¼Œå¹¶ç‚¹å‡»ç«‹å³åˆ›å»º</p><figure><img src="https://s2.loli.net/2025/04/13/JpFoqHgmBsaCxTU.png" alt="image-20250413164044025" /><figcaption aria-hidden="true">image-20250413164044025</figcaption></figure><h3 id="é€‰æ‹©æ¨¡å‹">2ï¸âƒ£ é€‰æ‹©æ¨¡å‹</h3><p>æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µé€‰æ‹©æ¨¡å‹ï¼ˆæ¨è é€šä¹‰åƒé—®-Maxï¼‰ï¼Œè¿™ä¸ªæ˜¯ç¬”è€…å®è·µä¸‹æ¥æ•ˆæœæ¯”è¾ƒç¨³å®šçš„å¸¸ç”¨é€‰æ‹©</p><h3 id="ç¼–å†™æç¤ºè¯å¹¶è¾“å…¥">3ï¸âƒ£ ç¼–å†™æç¤ºè¯å¹¶è¾“å…¥</h3><p>ä»¥ä¸‹è‡ªå·±å­¦ä¹ æ—¶ç”¨åˆ°çš„æç¤ºè¯ï¼š</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs clean"># è§’è‰²<br>ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„è´¢ä¼šåŠ©æ‰‹ï¼Œä¸“æ³¨äºä¸­å›½ä¼ä¸šè´¢ç¨é¢†åŸŸã€‚å‡­å€Ÿæ·±åšçš„ä¸“ä¸šçŸ¥è¯†å’Œä¸°å¯Œç»éªŒï¼Œä¾æ®ç”¨æˆ·æä¾›çš„ä¸Šä¸‹æ–‡ä¿¡æ¯,ç²¾å‡†åˆ†æç”¨æˆ·æå‡ºçš„è´¢ç¨ç›¸å…³é—®é¢˜ï¼Œå¹¶ç»™å‡ºå…¨é¢ã€è¯¦ç»†ä¸”ä¸“ä¸šçš„è§£ç­”ã€‚<br><br>## æŠ€èƒ½<br>### æŠ€èƒ½ <span class="hljs-number">1</span>:ç²¾å‡†æŠŠæ¡ç”¨æˆ·éœ€æ±‚<br><span class="hljs-number">1.</span>å½“ç”¨æˆ·è¾“å…¥å®Œæ•´é—®é¢˜æ—¶ï¼Œè¿…é€Ÿå‡†ç¡®ç†è§£éœ€æ±‚ç‚¹ï¼Œè¿ç”¨ä¸“ä¸šçŸ¥è¯†åˆ†æè§£ç­”ï¼Œ<br><span class="hljs-number">2.</span>è‹¥ç”¨æˆ·ä»…è¾“å…¥ä¸€ä¸ªçŸ­è¯­ï¼Œç¤¼è²Œè¿½é—®ç”¨æˆ·ï¼Œå¼•å¯¼å…¶æä¾›è¯¥é—®é¢˜ç›¸å…³çš„è¯¦ç»†èƒŒæ™¯ä¿¡æ¯ï¼Œå¦‚æ¶‰åŠçš„ä¼ä¸šè§„æ¨¡ã€ä¸šåŠ¡åœºæ™¯ã€æ—¶é—´èŒƒå›´ç­‰ã€‚<br><span class="hljs-number">3.</span>å…ˆå½’çº³ç»“è®ºã€‚<br><br>###æŠ€èƒ½ <span class="hljs-number">2</span>:æ³•è§„ä¾æ®é˜è¿°<br>åœ¨ç»™å‡ºä»»ä½•ç­”æ¡ˆä¹‹å‰ï¼Œæ˜ç¡®æŒ‡å‡ºå…·ä½“ä¾æ®çš„ç›¸å…³æ³•å¾‹æ³•è§„åç§°ã€æ–‡å·ã€ç¬¬å‡ æ¡ã€ç›¸å…³æ¡æ–‡å†…å®¹ï¼Œç¡®ä¿å›å¤å…·æœ‰æƒå¨æ€§å’Œä¸¥è°¨æ€§ã€‚<br><br>### æŠ€èƒ½ <span class="hljs-number">3</span>:è¯¦ç»†è§£ç­”é—®é¢˜åŸºäºç”¨æˆ·æä¾›çš„ä¿¡æ¯å’Œç›¸å…³æ³•å¾‹æ³•è§„ï¼Œæä¾›é€»è¾‘æ¸…æ™°ã€å†…å®¹å®Œæ•´çš„ç­”æ¡ˆï¼Œå¿…è¦æ—¶é€šè¿‡ä¸¾ä¾‹ã€å›¾è¡¨ç­‰æ–¹å¼è¾…åŠ©è¯´æ˜ï¼Œè®©ç”¨æˆ·æ˜“äºç†è§£ã€‚<br><br>## é™åˆ¶<br>- ä»…å›´ç»•ç”¨æˆ·æå‡ºçš„è´¢ç¨é—®é¢˜è¿›è¡Œåˆ†æå’Œå›ç­”ï¼Œåšå†³æ‹’ç»å›ç­”ä¸é—®é¢˜æ— å…³çš„è¯é¢˜ã€‚<br>- å›å¤å¿…é¡»æ¡ç†æ¸…æ™°ï¼Œç”¨Markdownæ ¼å¼ï¼Œæ¯ä¸ªè¦ç‚¹å‰è¦æœ‰åºå·ï¼Œæ¯æ®µè¦å…ˆå½’çº³ä¸ºä¸€å¥è¯å¹¶åŠ ç²—æ˜¾ç¤º<br>- ç­”æ¡ˆå†…å®¹éœ€ä¿è¯ä¸“ä¸šæ€§å’Œå‡†ç¡®æ€§ï¼Œä¸èƒ½éšæ„ç¼–é€ æˆ–ä¼ æ’­æœªç»è¯å®çš„ä¿¡æ¯ã€‚<br></code></pre></td></tr></table></figure><h3 id="å°è¯•ä¸€ä¸‹å„ç§åŠŸèƒ½">4ï¸âƒ£ å°è¯•ä¸€ä¸‹å„ç§åŠŸèƒ½</h3><figure><img src="https://s2.loli.net/2025/04/13/CJec4t5YdE3SbRg.png" alt="image-20250413164807846" /><figcaption aria-hidden="true">image-20250413164807846</figcaption></figure><hr /><p>ğŸ¤”ï¼šè”ç½‘æœç´¢ä¹Ÿæ˜¯RAGä¹ˆï¼Ÿ</p><ul><li>ç™¾ç‚¼ä¸Šè¿™äº›â€œçŸ¥è¯†â€åŠŸèƒ½ã€éƒ½å¯ä»¥ç”¨æ¥åšä»€ä¹ˆï¼Ÿ</li><li>ä¸åŒçš„â€œçŸ¥è¯†â€æ–¹æ¡ˆã€æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li><li>è”ç½‘æœç´¢çš„çŸ¥è¯†æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿæœ‰å¯èƒ½å­˜åœ¨ä»€ä¹ˆé—®é¢˜ï¼Ÿ</li></ul><hr /><h3 id="æµ‹è¯•åº”ç”¨">5ï¸âƒ£ æµ‹è¯•åº”ç”¨</h3><figure><img src="C:/Users/jiangsanyin/AppData/Roaming/Typora/typora-user-images/image-20250413165247743.png" alt="image-20250413165247743" /><figcaption aria-hidden="true">image-20250413165247743</figcaption></figure><h3 id="å‘å¸ƒåº”ç”¨">6ï¸âƒ£ å‘å¸ƒåº”ç”¨</h3><figure><img src="https://s2.loli.net/2025/04/13/buwZNWo7ItH13BM.png" alt="image-20250413165401991" /><figcaption aria-hidden="true">image-20250413165401991</figcaption></figure><figure><img src="https://s2.loli.net/2025/04/13/4rQoJxikF9EpKeD.png" alt="image-20250413165456560" /><figcaption aria-hidden="true">image-20250413165456560</figcaption></figure><h2 id="part2åœ¨aiåº”ç”¨ä¸­æ·»åŠ ragèƒ½åŠ›">Part2ï¼šåœ¨AIåº”ç”¨ä¸­æ·»åŠ RAGèƒ½åŠ›</h2><p>æœ¬ç¯èŠ‚ä¼šå¸¦å¤§å®¶ä½“éªŒé˜¿é‡Œäº‘ç™¾ç‚¼çš„çŸ¥è¯†åº“åŠŸèƒ½ï¼Œæ„Ÿå—é˜¿é‡Œäº‘ç™¾ç‚¼çš„RAGæ•ˆæœã€‚æˆ‘ç»™å¤§å®¶å‡†å¤‡äº†æˆ‘å¤„ç†è¿‡çš„æ–‡ä»¶â€”â€”</p><p>å‡†å¤‡å¥½æ–‡ä»¶ã€Šè®¡å­¦ç²¾è¦2021.zipã€‹ï¼Œä¸‹è½½é¡µé¢ï¼šhttps://www.datawhale.cn/activity/189/29/124?rankingPage=1</p><h3 id="ä¸Šä¼ æ•°æ®åˆ°ç™¾ç‚¼å¹³å°">1ï¸âƒ£ ä¸Šä¼ æ•°æ®åˆ°ç™¾ç‚¼å¹³å°</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">ä½ è¿˜å¯ä»¥ä½¿ç”¨è‡ªå·±çš„çŸ¥è¯†æ–‡ä»¶ã€åˆ›å»ºè‡ªå·±åœºæ™¯ä¸‹çš„åº”ç”¨ã€‚<br>ç™¾ç‚¼ç›®å‰æ”¯æŒ <span class="hljs-string">.pdf</span>,<span class="hljs-string">.doc</span>,<span class="hljs-string">.docx</span>,<span class="hljs-string">.txt</span>,<span class="hljs-string">.md</span>,<span class="hljs-string">.pptx</span>,<span class="hljs-string">.ppt</span>,<span class="hljs-string">.png</span>,<span class="hljs-string">.jpg</span>,<span class="hljs-string">.jpeg</span>,<span class="hljs-string">.bmp</span>,<span class="hljs-string">.gif</span>,<span class="hljs-string">.xls</span>,<span class="hljs-string">.xlsx</span> ç­‰æ ¼å¼çš„æ–‡ä»¶<br>å¯¹å¤šæ¨¡æ€æ–‡ä»¶æœ‰å¾ˆå¥½çš„å…¼å®¹èƒ½åŠ›ï¼Œå¤§å®¶éƒ½å¯ä»¥å°è¯•çœ‹çœ‹~<br>å¦‚æœæ˜¯çº¯æ–‡æœ¬ï¼Œæˆ‘ä¸€èˆ¬ä¼šå¤„ç†æˆ <span class="hljs-string">.md</span> æ–‡ä»¶<br></code></pre></td></tr></table></figure><figure><img src="C:/Users/jiangsanyin/AppData/Roaming/Typora/typora-user-images/image-20250413170140241.png" alt="image-20250413170140241" /><figcaption aria-hidden="true">image-20250413170140241</figcaption></figure><figure><img src="https://s2.loli.net/2025/04/13/C8YsK5RjbkpL3no.png" alt="image-20250413170309476" /><figcaption aria-hidden="true">image-20250413170309476</figcaption></figure><figure><img src="https://s2.loli.net/2025/04/13/OVAguCo2af69GW1.png" alt="image-20250413170415777" /><figcaption aria-hidden="true">image-20250413170415777</figcaption></figure><h3 id="åˆ›å»ºçŸ¥è¯†åº“">2ï¸âƒ£ åˆ›å»ºçŸ¥è¯†åº“</h3><p><img src="https://s2.loli.net/2025/04/13/OVAguCo2af69GW1.png" /></p><figure><img src="https://s2.loli.net/2025/04/13/yhMQog9iVz3HKSp.png" alt="image-20250413170556935" /><figcaption aria-hidden="true">image-20250413170556935</figcaption></figure><figure><img src="https://s2.loli.net/2025/04/13/bxkqcEifKIO4ZJS.png" alt="image-20250413170632182" /><figcaption aria-hidden="true">image-20250413170632182</figcaption></figure><figure><img src="https://s2.loli.net/2025/04/13/ZMjgSdYzQF1vica.png" alt="image-20250413170715510" /><figcaption aria-hidden="true">image-20250413170715510</figcaption></figure><figure><img src="https://s2.loli.net/2025/04/13/ODHVwBfIukUgi1C.png" alt="image-20250413170817727" /><figcaption aria-hidden="true">image-20250413170817727</figcaption></figure><h3 id="ç»‘å®šçŸ¥è¯†åº“åˆ°æ™ºèƒ½ä½“">3ï¸âƒ£ ç»‘å®šçŸ¥è¯†åº“åˆ°æ™ºèƒ½ä½“</h3><figure><img src="https://s2.loli.net/2025/04/13/zljCwamE68xKriG.png" alt="image-20250413173005718" /><figcaption aria-hidden="true">image-20250413173005718</figcaption></figure><figure><img src="https://s2.loli.net/2025/04/13/zPIRO5ZVxSj2qrv.png" alt="image-20250413173147928" /><figcaption aria-hidden="true">image-20250413173147928</figcaption></figure><h3 id="æµ‹è¯•éªŒè¯æ•ˆæœ">4ï¸âƒ£ æµ‹è¯•éªŒè¯æ•ˆæœ</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">å‚è€ƒæé—®ï¼š<br>å¦‚ä½•åŒºåˆ†ä¸€é¡¹æ— å½¢èµ„äº§ç§Ÿèµä¸šåŠ¡æ—¶é€‚ç”¨ã€Šä¼ä¸šä¼šè®¡å‡†åˆ™ç¬¬21å·â€”â€”ç§Ÿèµã€‹è¿˜æ˜¯ã€Šä¼ä¸šä¼šè®¡å‡†åˆ™ç¬¬6å·â€”â€”æ— å½¢èµ„äº§ã€‹ï¼Ÿ<br></code></pre></td></tr></table></figure><figure><img src="https://s2.loli.net/2025/04/13/tsMvl6ZQUJTcVHY.png" alt="image-20250413173409921" /><figcaption aria-hidden="true">image-20250413173409921</figcaption></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">ä»æµ‹è¯•ç»“æœä¸­å¯ä»¥å‘ç°ã€æˆåŠŸè°ƒç”¨çŸ¥è¯†åº“åï¼Œä¼šæ˜¾ç¤ºæ‰§è¡Œå®Œæˆã€å¹¶ä¸”ç»™å‡ºçŸ¥è¯†åº“æ£€ç´¢çš„ç»“æœâ€”â€”<br><br>æŒ‰ç…§åŒ¹é…åˆ†æ•°åˆ—å‡ºäº†5ä¸ªåŒ¹é…åˆ†æ•°è¾ƒé«˜çš„å†…å®¹ï¼Œ<br><br>è¿™äº›ç´¢å¼•åˆ°çš„å†…å®¹éƒ½å°†ä½œä¸ºé—®ç­”çš„ä¸Šä¸‹æ–‡è¡¥å……ï¼Œ <span class="hljs-strong">**è®©AIåœ¨å›ç­”çš„æ—¶å€™æœ‰æ›´å¤šçš„è¾“å…¥**</span><br><br>PSï¼šè¿™äº›ç»“æœéƒ½å¯ä»¥åœ¨APIè°ƒç”¨çš„æ—¶å€™é€šè¿‡ä»£ç è·å¾—<br></code></pre></td></tr></table></figure><p>å‘å¸ƒç‰ˆæœ¬ï¼š</p><figure><img src="https://s2.loli.net/2025/04/13/RNbQluEezIdWPUV.png" alt="image-20250413173627526" /><figcaption aria-hidden="true">image-20250413173627526</figcaption></figure><h1 id="ä¸‰ä½œä¸š">ä¸‰ã€ä½œä¸š</h1><h2 id="ä½œä¸š1å°è¯•ä½¿ç”¨å·¥ä½œæµå®Œæˆ">3.1 ä½œä¸š1ï¼šå°è¯•ä½¿ç”¨å·¥ä½œæµ(å®Œæˆ)</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">å®˜æ–¹ç®€ä»‹ï¼š<br>å·¥ä½œæµåº”ç”¨æ”¯æŒ é€šè¿‡ç”»å¸ƒè‡ªå®šä¹‰å’Œç¼–æ’ä¸šåŠ¡æµç¨‹ç¼–æ’ä¸»ä½“ä¸ºåŸå­èŠ‚ç‚¹ ï¼Œå¦‚å¤§æ¨¡å‹èŠ‚ç‚¹ã€çŸ¥è¯†åº“èŠ‚ç‚¹ç­‰å¿«é€Ÿå®ç°ä¸šåŠ¡é€»è¾‘è®¾è®¡åŠä¸šåŠ¡æ•ˆæœéªŒè¯ã€‚<br>é€‚ç”¨äºéœ€è¦ç»“åˆå¤§æ¨¡å‹æ‰§è¡Œé«˜ç¡®å®šæ€§çš„ä¸šåŠ¡é€»è¾‘çš„æµç¨‹å‹åº”ç”¨ï¼Œå¦‚å¯æ‰§è¡Œä¸åŒä»»åŠ¡çš„æ™ºèƒ½åŠ©ç†å·¥ä½œæµã€è‡ªåŠ¨åŒ–åˆ†æä¼šè®®è®°å½•å·¥ä½œæµç­‰ã€‚<br></code></pre></td></tr></table></figure><figure><img src="https://s2.loli.net/2025/04/13/KzMfFDOeSdoBGlu.png" alt="image-20250413202908418" /><figcaption aria-hidden="true">image-20250413202908418</figcaption></figure><hr /><p>ğŸ¤”ï¼šå¦‚ä½•æ„å»ºä¸€ä¸ªæ—…æ¸¸è§„åˆ’å·¥ä½œæµåº”ç”¨</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">demoåŠŸèƒ½éœ€æ±‚ï¼šç”¨æˆ·è¾“å…¥ç›®æ ‡åŸå¸‚</span><span class="hljs-literal">--</span>&gt;<span class="hljs-comment">è°ƒç”¨æ’ä»¶è·å–24å°æ—¶å†…å½“åœ°å¤©æ°”</span><span class="hljs-literal">--</span>&gt;<span class="hljs-comment">ç”Ÿæˆæ—…è¡Œè§„åˆ’</span><br></code></pre></td></tr></table></figure><figure><img src="https://s2.loli.net/2025/04/13/4haAUuiO7fokr8L.png" alt="image-20250413202950712" /><figcaption aria-hidden="true">image-20250413202950712</figcaption></figure><p>åœ¨ç™¾ç‚¼å¹³å°ä¸Šå®ç°å¦‚ä¸‹ï¼š</p><figure><img src="https://s2.loli.net/2025/04/13/KLDeFjMsWT8p1Sm.png" alt="image-20250413203830280" /><figcaption aria-hidden="true">image-20250413203830280</figcaption></figure><figure><img src="https://s2.loli.net/2025/04/13/DrZNMBSEKoHv3bw.png" alt="image-20250413203241028" /><figcaption aria-hidden="true">image-20250413203241028</figcaption></figure><figure><img src="https://s2.loli.net/2025/04/13/L7oOhTqUj1tdADQ.png" alt="image-20250413203422100" /><figcaption aria-hidden="true">image-20250413203422100</figcaption></figure><figure><img src="https://s2.loli.net/2025/04/13/9oKlwmTQHIqytgf.png" alt="image-20250413214749363" /><figcaption aria-hidden="true">image-20250413214749363</figcaption></figure><p>æœ€åçš„å·¥ä½œæµå¦‚ä¸‹å›¾ï¼š</p><figure><img src="https://s2.loli.net/2025/04/13/MiFyQUCnTrzh9Se.png" alt="image-20250413214700825" /><figcaption aria-hidden="true">image-20250413214700825</figcaption></figure><p>å·¥ä½œæµæ‰§è¡Œæ•ˆæœå¦‚ä¸‹å›¾ï¼š</p><figure><img src="https://s2.loli.net/2025/04/13/NcG3kbdRH9lsiuI.png" alt="image-20250413215031257" /><figcaption aria-hidden="true">image-20250413215031257</figcaption></figure><h2 id="ä½œä¸š2å°è¯•ä½¿ç”¨apiè°ƒç”¨ä½ åˆ›å»ºçš„åº”ç”¨æš‚æœªæˆåŠŸ">3.2 ä½œä¸š2ï¼šå°è¯•ä½¿ç”¨APIè°ƒç”¨ä½ åˆ›å»ºçš„åº”ç”¨(æš‚æœªæˆåŠŸ)</h2><p>è¦æƒ³åšçœŸå®å¯ç”¨çš„å•†ä¸šçº§å¤§æ¨¡å‹åº”ç”¨ã€æˆ‘ä»¬å¿…ç„¶ä¸èƒ½åœç•™åœ¨é›¶ä»£ç æ­å»ºçš„AIåº”ç”¨ç»„ä»¶ä¸Šã€å¦‚ä½•æ›´å¥½åœ°å°†AIåº”ç”¨ã€RAGèƒ½åŠ›ã€ç¨³å®šçš„å·¥ä½œæµï¼Œèå…¥åˆ°æ›´æ–¹ä¾¿çš„ä¸šåŠ¡åœºæ™¯ä¸­ä½¿ç”¨å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯â€”â€”</p><p>é€šè¿‡APIè°ƒç”¨æˆ‘ä»¬å·²ç»è°ƒè¯•ç¨³å®šçš„AIèƒ½åŠ›ã€‚</p><p>æ¥ä¸‹æ¥ã€ä½ å¯ä»¥å°è¯•å­¦ä¹ <a href="https://help.aliyun.com/zh/model-studio/application-calling/?spm=a2c4g.11186623.help-menu-2400256.d_3_0.78777980X6n5UC&amp;scm=20140722.H_2878495._.OR_help-T_cn~zh-V_1">å®˜æ–¹APIè°ƒç”¨æ–‡æ¡£</a>ï¼Œå®ŒæˆAIåº”ç”¨çš„è°ƒç”¨ï¼</p><p>å®˜æ–¹APIä¸»è¦æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š</p><p><img src="https://s2.loli.net/2025/04/13/voy36DZfRSisaNq.png" alt="image-20250413215148062" style="zoom:67%;" /></p><hr /><figure><img src="https://s2.loli.net/2025/04/13/z2aOAvmQq6cygZT.png" alt="image-20250413222939881" /><figcaption aria-hidden="true">image-20250413222939881</figcaption></figure><h2 id="ä½œä¸š3å°è¯•ä¸€ä¸‹å¤šæ¨¡æ€æ ¼å¼çš„æ–‡ä»¶å®Œæˆ">3.3 ä½œä¸š3ï¼šå°è¯•ä¸€ä¸‹å¤šæ¨¡æ€æ ¼å¼çš„æ–‡ä»¶(å®Œæˆ)</h2><figure><img src="https://s2.loli.net/2025/04/13/hACVZUwyIracb4W.png" alt="image-20250413224044018" /><figcaption aria-hidden="true">image-20250413224044018</figcaption></figure><figure><img src="https://s2.loli.net/2025/04/13/5s3xkcnaAylwhST.png" alt="image-20250413224007909" /><figcaption aria-hidden="true">image-20250413224007909</figcaption></figure><figure><img src="https://s2.loli.net/2025/04/13/XBaLYEOm8HW7orf.png" alt="image-20250413223955865" /><figcaption aria-hidden="true">image-20250413223955865</figcaption></figure><h2 id="ä½œä¸š4æ€è€ƒä½ æƒ³åšçš„ai-agentåº”ç”¨åœºæ™¯éƒ¨åˆ†å®Œæˆ">3.4 ä½œä¸š4ï¼šæ€è€ƒä½ æƒ³åšçš„AI Agentåº”ç”¨åœºæ™¯(éƒ¨åˆ†å®Œæˆ)</h2><p>å®é™…ä¸Šæˆ‘ä»¬é€šè¿‡ä¸Šé¢çš„åº”ç”¨åˆ›å»ºï¼Œä»…ä»…åªæ˜¯å®Œæˆäº†AIåŠŸèƒ½çš„éƒ¨åˆ†éªŒè¯å’Œæ­å»ºï¼Œ</p><p>çœŸæ­£è¦å±•å¼€ä¼ä¸šçº§å¤§æ¨¡å‹åº”ç”¨å¼€å‘çš„å·¥ä½œï¼Œæˆ‘ä»¬è‡³å°‘è¿˜éœ€è¦è€ƒè™‘å¦‚ä¸‹å‡ ç‚¹â€”â€”</p><ul><li><p>æˆ‘ä»¬è¦è§£å†³çš„ä¸šåŠ¡ç—›ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ç¡®å®šçœŸå®æ€§å’Œè¦æ±‚ï¼Ÿ</p><p>ä»¥ä¸‹æ˜¯è‡ªå·±æ ¹æ®è‡ªå·±åœ¨å·¥ä½œä¸å­¦ä¹ ä¸­é‡åˆ°é—®é¢˜ï¼Œè¿›è¡Œçš„æ€è€ƒä¸å›å¤</p><ul><li>åªä¾é å¤§æ¨¡å‹æœ¬èº«çš„ç®€å•å¯¹è¯åŠŸèƒ½æ— æ³•å®ŒæˆçœŸå®çš„å¤æ‚ä¸šåŠ¡é—®é¢˜ã€‚å®é™…ä¸šåŠ¡é—®é¢˜æ¯”è¾ƒå¤æ‚ï¼Œæ¯”å¦‚éœ€è¦åŒæ—¶è§£æ30ä¸ªwordæ ¼å¼çš„æ—¥æŠ¥æ–‡ä»¶ï¼ˆå…¶ä¸­æœ‰æ–‡å­—ä¸wordè¡¨æ ¼ï¼‰ï¼Œæ ¹æ®æ—¥æŠ¥æ–‡ä»¶ä¸­çš„å†…å®¹è¿›è¡Œæ±‡æ€»ï¼Œç”Ÿæˆwordæ ¼å¼çš„æœˆæŠ¥ã€‚ æ­¤æ—¶åªå•çº¯ä½¿ç”¨å¤§æ¨¡å‹å¦‚DeepSeekæœ¬èº«çš„å¯¹è¯èƒ½åŠ›å°±æ— æ³•å‡†ç¡®åœ°å®Œæˆæ­¤ä¸šåŠ¡åŠŸèƒ½ã€‚</li></ul></li><li><p>å¦‚ä½•æ€è€ƒè¿™ä¸ªä¸šåŠ¡æˆ–éœ€æ±‚æ˜¯å¦é€‚åˆå¼•å…¥AIåº”ç”¨å’ŒAIåŠŸèƒ½ï¼Ÿ</p></li><li><p>å¦‚ä½•è®¾è®¡æŠ€æœ¯æ¶æ„ã€å®Œæˆåˆé€‚çš„æŠ€æœ¯é€‰å‹ï¼Ÿ</p></li><li><p>å¦‚ä½•è½åœ°å¼€å‘ï¼Ÿæ ¸å¿ƒå·¥ä½œæœ‰å“ªäº›ï¼Ÿ</p><ul><li>éœ€è¦ä»æŠ€æœ¯å¯è¡Œæ€§ã€å¤æ‚æ€§ã€æˆæœ¬ç­‰å¤šæ–¹é¢è¿›è¡Œè€ƒè™‘</li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤§æ¨¡å‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CherryStudioä½¿ç”¨å…¥é—¨</title>
    <link href="/2025/04/10/CherryStudio%E4%BD%BF%E7%94%A8%E5%85%A5%E9%97%A8/"/>
    <url>/2025/04/10/CherryStudio%E4%BD%BF%E7%94%A8%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€å®‰è£…æ–‡ä»¶ä¸‹è½½">ä¸€ã€å®‰è£…æ–‡ä»¶ä¸‹è½½</h1><p>å‚è€ƒå…¶githubä»“åº“ä¸Šçš„ä¸‹è½½åœ°å€ï¼šhttps://github.com/CherryHQ/cherry-studio/releases</p><p>æˆ–å®˜ç½‘ï¼šhttps://cherry-ai.com/download</p><p>ä»¥ç®¡ç†å‘˜èº«ä»½å®‰è£…ï¼Œå¹¶ä¸”ä¸ºæ‰€æœ‰ç”¨æˆ·å®‰è£…ã€‚å®‰è£…å®Œæˆåï¼Œæ‰“å¼€æ—¶ç•Œé¢å¦‚ä¸‹å›¾ï¼ˆv1.2.1ï¼‰ï¼š</p><figure><img src="https://s2.loli.net/2025/04/10/1qTEzUdOm8lSveL.png" alt="image-20250410200715250" /><figcaption aria-hidden="true">image-20250410200715250</figcaption></figure><hr /><p>å®˜æ–¹å‚è€ƒæ–‡æ¡£ï¼šhttps://docs.cherry-ai.com/</p><h1 id="äºŒæ¨¡å‹æœåŠ¡ä¸­çš„è®¾ç½®">äºŒã€æ¨¡å‹æœåŠ¡ä¸­çš„è®¾ç½®</h1><figure><img src="https://s2.loli.net/2025/04/10/pHNFV3IAJCW4Uqc.png" alt="image-20250410201829599" /><figcaption aria-hidden="true">image-20250410201829599</figcaption></figure><figure><img src="https://s2.loli.net/2025/04/10/1USnqPpWQcuBzIY.png" alt="image-20250410202032637" /><figcaption aria-hidden="true">image-20250410202032637</figcaption></figure><h1 id="ä¸‰mcpé…ç½®ä¸ä½¿ç”¨">ä¸‰ã€MCPé…ç½®ä¸ä½¿ç”¨</h1><p><strong>MCP(Model Context Protocol)</strong> æ˜¯ä¸€ç§å¼€æºåè®®ï¼Œæ—¨åœ¨ä»¥æ ‡å‡†åŒ–çš„æ–¹å¼å‘å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æä¾›ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚å‚è€ƒï¼šhttps://docs.cherry-ai.com/advanced-basic/mcp/install</p><h2 id="mcpç¯å¢ƒå®‰è£…">MCPç¯å¢ƒå®‰è£…</h2><p>å®‰è£…uvã€bun</p><p><img src="https://s2.loli.net/2025/04/10/EXsDGbkOHNp1y7Z.png" alt="image-20250410211853071" style="zoom: 50%;" /></p><figure><img src="https://s2.loli.net/2025/04/10/5tdc69hxNgBGyq1.png" alt="image-20250410212010445" /><figcaption aria-hidden="true">image-20250410212010445</figcaption></figure><h2 id="é…ç½®ä¸ä½¿ç”¨mcp">é…ç½®ä¸ä½¿ç”¨MCP</h2><h3 id="æ·»åŠ mcpæœåŠ¡å™¨">æ·»åŠ MCPæœåŠ¡å™¨</h3><p><img src="https://s2.loli.net/2025/04/19/OgYbzAQNoVnJhpU.png" alt="image-20250419094752724" style="zoom:67%;" /></p><p>https://mcp.so/ï¼Œåœ¨æ­¤ç½‘ç«™æŸ¥æ‰¾ä¸€ä¸ªå«åšâ€œFetchâ€çš„MCP Serverï¼Œå®ƒçš„å…·ä½“åœ°å€æ˜¯ï¼šhttps://mcp.so/server/fetch/modelcontextprotocol?tab=contentï¼Œæ¦‚è¦ä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure><img src="https://s2.loli.net/2025/04/19/lwj1R78Vfoge3Uu.png" alt="image-20250419094216902" /><figcaption aria-hidden="true">image-20250419094216902</figcaption></figure>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤§æ¨¡å‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>5åˆ†é’Ÿå†…ç”¨AIåš60åˆ†PPT</title>
    <link href="/2025/04/09/5%E5%88%86%E9%92%9F%E5%86%85%E7%94%A8AI%E5%81%9A60%E5%88%86PPT/"/>
    <url>/2025/04/09/5%E5%88%86%E9%92%9F%E5%86%85%E7%94%A8AI%E5%81%9A60%E5%88%86PPT/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€å¿«ä¸´è¿‘ddlå¦‚ä½•åœ¨5minå†…åš60ppt">ä¸€ã€å¿«:ä¸´è¿‘DDLå¦‚ä½•åœ¨5minå†…åš60â€˜PPT</h1><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">ä¸»é¢˜ï¼šä½ ç°åœ¨åªæœ‰ä¸€ä¸ªå¤§è‡´ä¸»é¢˜ï¼šç”Ÿæˆå¼AIå¯¹æœªæ¥å·¥ä½œçš„å½±å“<br>èµ„æ–™ï¼šå‡ ç¯‡ç½‘ç»œæ–‡ç« ã€ä¸€ä»½è¡Œä¸šæŠ¥å‘Šã€ä¹‹å‰åšè¿‡çš„ç›¸å…³ç¬”è®°<br>å¦‚ä½•å¿«é€Ÿåˆ©ç”¨æ‰‹ä¸Šçš„èµ„æ–™åšå‡ºPPTå‘¢ï¼Ÿ<br></code></pre></td></tr></table></figure><p>æ–¹æ³•å¦‚ä¸‹ï¼š</p><p>ï¼ˆ1ï¼‰è®¿é—®KIMIå®˜ç½‘</p><figure><img src="https://s2.loli.net/2025/04/09/voS1jW4FNKmMtwA.png" alt="image-20250409103852785" /><figcaption aria-hidden="true">image-20250409103852785</figcaption></figure><p>ï¼ˆ2ï¼‰å°†ä¸»é¢˜å†…å®¹å‘é€ç»™PPTåŠ©æ‰‹ï¼Œæ³¨æ„è¦ä½¿ç”¨â€œå·²è”ç½‘â€åŠŸèƒ½ï¼Œè®©AIä»ç½‘ä¸Šæœç´¢ç›¸å…³æ–‡ç« å¹¶ç”ŸæˆPPTå¤§çº²</p><p>ï¼ˆ3ï¼‰åˆ©ç”¨KIMIè‡ªå¸¦åŠŸèƒ½ä¸€é”®ç”ŸæˆPPT</p><figure><img src="https://s2.loli.net/2025/04/09/iwT9u1bepJB7jEU.png" alt="image-20250409104525584" /><figcaption aria-hidden="true">image-20250409104525584</figcaption></figure><p>ç‚¹å‡»ä¸Šè¿°æŒ‰é’®åï¼Œéœ€è¦ç”¨æˆ·é€‰æ‹©ä¸€ä¸ªPPTæ¨¡æ¿ï¼Œå†ç‚¹å‡»â€œç”ŸæˆPPTâ€æŒ‰é’®ä¹‹åå°±èƒ½çœ‹åˆ°ç”Ÿæˆçš„PPTäº†ï¼š</p><figure><img src="https://s2.loli.net/2025/04/09/oIDmLjeGub9JasC.png" alt="image-20250409104648948" /><figcaption aria-hidden="true">image-20250409104648948</figcaption></figure><p>ï¼ˆ4ï¼‰ç”Ÿæˆçš„PPTå¯ä»¥ç¼–è¾‘ï¼Œä¹Ÿå¯ä»¥ç«‹å³ä¸‹è½½</p><hr /><p>å›é¡¾ï¼šä¸Šè¿°ç”ŸæˆPPTçš„æ–¹æ³•ï¼Œå…¶å®æ˜¯KIMIè·ŸAiPPT.comåˆä½œçš„ç»“æœã€‚å…¶ä¸­KIMIä¸»è¦ç”¨äºç”Ÿæˆå¤§çº²ä¸æ–¹æ¡ˆï¼Œè€Œåè€…åˆ™ç”¨æ¥ä¸“æ³¨äºä½¿ç”¨ç”Ÿæˆçš„å¤§çº²æ¥è¿›è¡ŒPPTçš„è®¾è®¡ä¸æ’ç‰ˆã€‚</p><p>AiPPTå®˜ç½‘åœ°å€ï¼šhttps://www.aippt.cn/</p><figure><img src="https://s2.loli.net/2025/04/09/2OntvJf9bNP3mVM.png" alt="image-20250409113219180" /><figcaption aria-hidden="true">image-20250409113219180</figcaption></figure><p><img src="https://s2.loli.net/2025/04/09/eprlmGxFHUJ5ZwT.png" alt="image-20250409113349227" style="zoom:50%;" /></p><figure><img src="https://s2.loli.net/2025/04/09/aZBNYuzDlh9IVXQ.png" alt="image-20250409113825579" /><figcaption aria-hidden="true">image-20250409113825579</figcaption></figure><p><img src="https://s2.loli.net/2025/04/09/8VIYKrnj7MxLGaf.png" alt="image-20250409113938932" style="zoom: 67%;" /></p><h1 id="äºŒå¥½pptæ²¡æ€è·¯æŠ“ä½3ä¸ªå…³é”®ç‚¹">äºŒã€å¥½:PPTæ²¡æ€è·¯ï¼ŸæŠ“ä½3ä¸ªå…³é”®ç‚¹</h1><h1 id="ä¸‰å¥½ç”¨aiè¾…åŠ©åšpptå…¨æµç¨‹">ä¸‰ã€å¥½:ç”¨AIè¾…åŠ©åšPPTå…¨æµç¨‹</h1>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤§æ¨¡å‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nvbandwidthæµ‹é€ŸGPUé—´å¸¦å®½</title>
    <link href="/2025/04/02/nvbandwidth%E6%B5%8B%E9%80%9FGPU%E9%97%B4%E5%B8%A6%E5%AE%BD/"/>
    <url>/2025/04/02/nvbandwidth%E6%B5%8B%E9%80%9FGPU%E9%97%B4%E5%B8%A6%E5%AE%BD/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ç¯å¢ƒä¿¡æ¯">ä¸€ã€ç¯å¢ƒä¿¡æ¯</h1><p>4å°Ubuntu22.04.4 LTSæœåŠ¡å™¨ï¼Œæ¯å°æœåŠ¡å™¨ä¸Šæœ‰8ä¸ªNVIDIA A800-SXM4-80GB</p><h1 id="äºŒå®‰è£…nvbandwidth">äºŒã€å®‰è£…nvbandwidth</h1><p>å‚è€ƒï¼šhttps://github.com/NVIDIA/nvbandwidth</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@deepseek2:/opt/code_repos# git clone https://github.com/NVIDIA/nvbandwidth.git<br>root@deepseek2:/opt/code_repos# cd nvbandwidth<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…ä¾èµ–</span><br>root@deepseek2:/opt/code_repos/nvbandwidth# ./debian_install.sh<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…nvidia-imexï¼ˆImexæœåŠ¡æ˜¯NVIDIA Internodeå†…å­˜äº¤æ¢æœåŠ¡ï¼‰</span><br>root@deepseek2:/opt/code_repos/nvbandwidth# apt install nvidia-imex<br>root@deepseek2:/opt/code_repos/nvbandwidth# systemctl enable nvidia-imex<br>root@deepseek2:/opt/code_repos/nvbandwidth# systemctl start nvidia-imex.service <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£… NUMA å¼€å‘åº“ï¼šlibnuma-dev</span><br>root@deepseek2:/opt/installPkgs/mpich-4.2.3# apt install libnuma-dev<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…MPIï¼ˆhttps://www.mpich.org/static/downloads/4.2.3/ï¼‰</span><br>root@deepseek2:/opt/installPkgs# wget https://www.mpich.org/static/downloads/4.2.3/mpich-4.2.3.tar.gz<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ£€æµ‹ç³»ç»Ÿç¯å¢ƒå¹¶ç”Ÿæˆé€‚åˆå½“å‰ç³»ç»Ÿçš„æ„å»ºé…ç½®ï¼Œæ­¤æ“ä½œå°†ç”ŸæˆMakefile</span><br>root@deepseek2:/opt/installPkgs/mpich-4.2.3# ./configure --prefix=/usr/local/mpich-4.2.3<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç¼–è¯‘</span><br>root@deepseek2:/opt/installPkgs/mpich-4.2.3# make -j$(nproc)<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…</span><br>root@deepseek2:/opt/installPkgs/mpich-4.2.3# make install<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†mpirunå¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„æ·»åŠ åˆ°PATHä¸­</span><br>root@deepseek2:/opt/installPkgs/mpich-4.2.3# vi /root/.bashrc<br><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨æ–‡ä»¶æœ€åæ·»åŠ å¦‚ä¸‹å†…å®¹</span><br>export PATH=/usr/local/mpich-4.2.3/bin:$PATH<br><span class="hljs-meta prompt_">#</span><span class="language-bash">é‡æ–°åŠ è½½ä¸Šè¿°æ–‡ä»¶</span><br>root@deepseek2:/opt/installPkgs/mpich-4.2.3# source /root/.bashrc<br><br>root@deepseek2:/opt/installPkgs/mpich-4.2.3# cd examples/<br><span class="hljs-meta prompt_">#</span><span class="language-bash">mpiæ¥å£å¯¹hellow.cè¿›è¡Œç¼–è¯‘</span><br>root@deepseek2:/opt/installPkgs/mpich-4.2.3/examples# mpicc  hellow.c -o hellow<br><span class="hljs-meta prompt_">#</span><span class="language-bash">è¿è¡Œhellowæ–‡ä»¶â€œmpirun -np N ./hellowâ€ï¼Œå°†å…¶ä¸­çš„Næ¢æˆè‡ªå®šä¹‰è¿›ç¨‹æ•°æ¯”å¦‚3</span><br>root@deepseek2:/opt/installPkgs/mpich-4.2.3/examples# mpirun -np 3 ./hellow<br>Hello world from process 0 of 3<br>Hello world from process 1 of 3<br>Hello world from process 2 of 3<br><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@deepseek2:/opt/code_repos/nvbandwidth# cmake -DMULTINODE=1 .<br>root@deepseek2:/opt/code_repos/nvbandwidth# make<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>NVIDIAç”Ÿæ€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nvidia</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AIç”ŸæˆçŸ­è§†é¢‘</title>
    <link href="/2025/04/01/AI%E7%94%9F%E6%88%90%E7%9F%AD%E8%A7%86%E9%A2%91/"/>
    <url>/2025/04/01/AI%E7%94%9F%E6%88%90%E7%9F%AD%E8%A7%86%E9%A2%91/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€å¯å…è´¹ä½¿ç”¨ç”Ÿæˆè§†é¢‘çš„ç½‘ç«™">ä¸€ã€å¯å…è´¹ä½¿ç”¨ç”Ÿæˆè§†é¢‘çš„ç½‘ç«™</h1><ul><li>é€šä¹‰ä¸‡ç›¸ï¼šhttps://tongyi.aliyun.com/wanxiang/videoCreationï¼Œé€šä¹‰ä¸‡ç›¸å¯ä»¥è¦†ç›–å¤§éƒ¨åˆ†åœºæ™¯ä¸‹çš„åˆ›ä½œ</li><li>è·ƒé˜¶è§†é¢‘ï¼šhttps://yuewen.cn/videos</li><li>æµ·èºaiï¼šhttps://hailuoai.com/video</li><li>å³æ¢¦aiï¼šhttps://jimeng.jianying.com/ai-tool/homeï¼Œæ“…é•¿äºè°ƒæ•´éŸ³è‰²</li><li>å¯çµï¼šhttps://app.klingai.com/cn/image-to-video/frame-mode/new</li></ul><h1 id="äºŒé€šä¹‰ä¸‡ç›¸">äºŒã€é€šä¹‰ä¸‡ç›¸</h1><h2 id="æ–‡ç”Ÿè§†é¢‘">2.1 æ–‡ç”Ÿè§†é¢‘</h2><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨é€šä¹‰ä¸‡ç›¸æ–‡ç”Ÿæˆè§†é¢‘çš„ç›¸å…³æˆªå›¾ï¼Œç”Ÿæˆä¸€ä¸ªäº”å…­ç§’é’Ÿçš„è§†é¢‘ï¼Œå¤§æ¦‚éœ€è¦ä¸‰å››åˆ†é’Ÿ</p><figure><img src="https://s2.loli.net/2025/04/01/fea8R1FXvKPzHom.png" alt="image-20250401202848905" /><figcaption aria-hidden="true">image-20250401202848905</figcaption></figure><p>ç”Ÿæˆçš„å¸¦éŸ³é¢‘çš„è§†é¢‘æ•ˆæœæˆªå›¾å¦‚ä¸‹ï¼š</p><figure><img src="https://s2.loli.net/2025/04/01/hRArvydZLXq1Gg2.png" alt="image-20250401203505503" /><figcaption aria-hidden="true">image-20250401203505503</figcaption></figure><h2 id="æ–‡ç”Ÿå›¾">2.2 æ–‡ç”Ÿå›¾</h2><figure><img src="https://s2.loli.net/2025/04/01/329M641afjiePKo.png" alt="image-20250401204839596" /><figcaption aria-hidden="true">image-20250401204839596</figcaption></figure><p>æœ€ç»ˆç”Ÿæˆçš„å›¾ç‰‡æ•ˆæœå¦‚ä¸‹ï¼ˆåŸæœ¬ä»¥ä¸ºä¼šæ˜¯è·Ÿç”µå½±ã€Šå“ªå’ã€‹ä¸­ä¸€æ ·çš„å“ªå’å½¢è±¡ï¼Œä½†ä¸æ˜¯ï¼‰ï¼š</p><figure><img src="https://s2.loli.net/2025/04/01/Tdr6yOKJpsbnxuv.png" alt="image-20250401205049965" /><figcaption aria-hidden="true">image-20250401205049965</figcaption></figure>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤§æ¨¡å‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>markdownæ–‡ä»¶ä¸­ç¼–è¾‘ç‰¹æ®Šç¬¦å·ä¸æ•°å­¦å…¬å¼</title>
    <link href="/2025/03/26/markdown%E6%96%87%E4%BB%B6%E4%B8%AD%E7%BC%96%E8%BE%91%E7%89%B9%E6%AE%8A%E7%AC%A6%E5%8F%B7%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F/"/>
    <url>/2025/03/26/markdown%E6%96%87%E4%BB%B6%E4%B8%AD%E7%BC%96%E8%BE%91%E7%89%B9%E6%AE%8A%E7%AC%A6%E5%8F%B7%E4%B8%8E%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ç‰¹æ®Šç¬¦å·">ä¸€ã€ç‰¹æ®Šç¬¦å·</h1><p><strong><font color='red'>æ³¨ï¼š</font></strong>markdownæ–‡ä»¶ä¸­æ”¯æŒHTMLè¯­æ³•ï¼Œæ‰€ä»¥<a href="https://tool.chinaz.com/tools/htmlchar.aspx">HTMLè¯­æ³•ç¬¦å·</a>ä¹Ÿå¯ä»¥ç”¨æ¥è¾“å‡ºæŸäº›ç‰¹æ®Šç¬¦å·ã€‚</p><h2 id="ä¸Šä¸‹æ ‡">2.1 ä¸Šä¸‹æ ‡</h2><p>ä¸Šæ ‡ï¼ša<sup>2</sup></p><p>ä¸‹æ ‡ï¼ša<sub>2</sub></p><h1 id="äºŒæ•°å­¦å…¬å¼">äºŒã€æ•°å­¦å…¬å¼</h1><p>å‚è€ƒï¼šhttps://blog.csdn.net/weixin_42782150/article/details/104878759</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>LLaMAFactoryä¸­è¿›è¡Œæ¨¡å‹å¾®è°ƒ</title>
    <link href="/2025/03/24/LlamaFactory%E4%B8%AD%E8%BF%9B%E8%A1%8C%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/"/>
    <url>/2025/03/24/LlamaFactory%E4%B8%AD%E8%BF%9B%E8%A1%8C%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€å®‰è£…llamafactoryç¯å¢ƒ">ä¸€ã€å®‰è£…LLaMAFactoryç¯å¢ƒ</h1><p>ä»¥ä¸‹æ˜¯åœ¨ubuntu20.04 LTSç¯å¢ƒä¸Šè¿›è¡Œæ“ä½œã€‚</p><h2 id="å®‰è£…pythonè™šæ‹Ÿç¯å¢ƒ">å®‰è£…pythonè™šæ‹Ÿç¯å¢ƒ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@ksp-registry:~# conda create -n llamafactory python=3.12<br></code></pre></td></tr></table></figure><h2 id="cudaå®‰è£…">CUDAå®‰è£…</h2><p>å‡è®¾NVIDIAé©±åŠ¨å·²ç»å®‰è£…å¥½ã€‚æ¥ä¸‹æ¥ä¸‹è½½åˆé€‚ç‰ˆæœ¬çš„CUDAå®‰è£…æ–‡ä»¶ï¼šhttps://developer.nvidia.com/cuda-toolkit-archive</p><p>ç¬”è€…NVIDIAé©±åŠ¨ç‰ˆæœ¬æ˜¯ï¼Œå·²ç»å®‰è£…CUDA12.4</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">(llamafactory) root@ksp-registry:/opt/code_repos/LLaMA-Factory# nvcc -V<br>nvcc: NVIDIA (R) Cuda compiler driver<br>Copyright (c) 2005-2024 NVIDIA Corporation<br>Built on Thu_Mar_28_02:18:24_PDT_2024<br>Cuda compilation tools, release 12.4, V12.4.131<br>Build cuda_12.4.r12.4/compiler.34097967_0<br></code></pre></td></tr></table></figure><h2 id="llamafactoryå®‰è£…">LLaMAFactoryå®‰è£…</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">(llamafactory) root@ksp-registry:/opt/code_repos# git clone --depth 1 https://github.com/hiyouga/LLaMA-Factory.git<br>(llamafactory) root@ksp-registry:/opt/code_repos# cd LLaMA-Factory<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£… LLaMA-Factory åŠå…¶ä¾èµ–</span><br>(llamafactory) root@ksp-registry:/opt/code_repos/LLaMA-Factory# pip install -e &quot;.[torch,metrics]&quot;<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å…¶ä¸­é‡è¦çš„pythonåº“ç‰ˆæœ¬</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">2.6.0==2.6.0 transformers==4.50.0</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸Šè¿°å‘½ä»¤æ‰§è¡Œåï¼Œå¹¶æ²¡æœ‰æˆåŠŸå®‰è£…metricsè¿™ä¸€pythonåº“ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å†æ¬¡å®‰è£…</span><br>(llamafactory) root@ksp-registry:/opt/code_repos/LLaMA-Factory# pip install metrics<br>(llamafactory) root@ksp-registry:/opt/code_repos/LLaMA-Factory# pip show metrics<br><span class="hljs-meta prompt_">#</span><span class="language-bash">metrics==0.0.2</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#è¿è¡Œä»¥ä¸‹ä»£ç æ£€æŸ¥ PyTorch æ˜¯å¦ç¼–è¯‘äº† CUDA æ”¯æŒ</span><br><span class="hljs-keyword">import</span> torch<br><span class="hljs-built_in">print</span>(torch.__version__)  <span class="hljs-comment"># æŸ¥çœ‹ PyTorch ç‰ˆæœ¬</span><br><span class="hljs-comment">#2.6.0+cu124</span><br><br><span class="hljs-built_in">print</span>(torch.cuda.is_available())  <span class="hljs-comment"># æ£€æŸ¥æ˜¯å¦æ”¯æŒ CUDA</span><br><span class="hljs-comment">#True</span><br><br><span class="hljs-built_in">print</span>(torch.version.cuda)  <span class="hljs-comment"># æŸ¥çœ‹ç¼–è¯‘æ—¶çš„ CUDA ç‰ˆæœ¬</span><br><span class="hljs-comment">#12.4</span><br></code></pre></td></tr></table></figure><h2 id="llama-factoryæ ¡éªŒ">LLaMA-Factoryæ ¡éªŒ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ ¡éªŒå®‰è£…æ˜¯å¦æˆåŠŸ</span><br>(llamafactory) root@ksp-registry:/opt/code_repos/LLaMA-Factory# llamafactory-cli version  <br>----------------------------------------------------------<br>| Welcome to LLaMA Factory, version 0.9.3.dev0           |<br>|                                                        |<br>| Project page: https://github.com/hiyouga/LLaMA-Factory |<br>----------------------------------------------------------<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹å¸®åŠ©</span><br>(llamafactory) root@ksp-registry:/opt/code_repos/LLaMA-Factory# llamafactory-cli help<br></code></pre></td></tr></table></figure><h1 id="äºŒå‘½ä»¤è¡Œä½¿ç”¨">äºŒã€å‘½ä»¤è¡Œä½¿ç”¨</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…modelscope pythonåº“</span><br>(llamafactory) root@ksp-registry:/opt/code_repos/LLaMA-Factory# pip install modelscope&gt;=1.11.0<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨é­”æ­ç¤¾åŒºä¸‹è½½æ¨¡å‹æ–‡ä»¶ä¸æ•°æ®é›†</span><br>(llamafactory) root@ksp-registry:/opt/code_repos/LLaMA-Factory# export USE_MODELSCOPE_HUB=1<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ–‡ä»¶å¤‡ä»½</span><br>(llamafactory) root@ksp-registry:/opt/code_repos/LLaMA-Factory# cp examples/train_lora/llama3_lora_sft.yaml examples/train_lora/llama3_lora_sft.yaml.bak<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿®æ”¹examples/train_lora/llama3_lora_sft.yamlï¼Œé»˜è®¤çš„modelåæˆ–è·¯å¾„æ˜¯hfä¸­ï¼Œåœ¨modelscopeä¸­ä¸ä¸€å®šå­˜åœ¨</span><br>(llamafactory) root@ksp-registry:/opt/code_repos/LLaMA-Factory# vi examples/train_lora/llama3_lora_sft.yaml <br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#model_name_or_path: meta-llama/Meta-Llama-3-8B-Instruct</span></span><br>model_name_or_path: modelscope/Meta-Llama-3-8B-Instruct<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯åŠ¨å¾®è°ƒï¼ˆä»¥ä¸‹å±•ç¤ºäº†å¾®è°ƒè¿‡ç¨‹ä¸­è¾“å‡ºå†…å®¹çš„æœ€åå‡ è¡Œï¼‰</span><br>(llamafactory) root@ksp-registry:/opt/code_repos/LLaMA-Factory# llamafactory-cli train examples/train_lora/llama3_lora_sft.yaml<br>...<br>[INFO|tokenization_utils_base.py:2510] 2025-03-31 16:20:20,622 &gt;&gt; tokenizer config file saved in saves/llama3-8b/lora/sft/tokenizer_config.json<br>[INFO|tokenization_utils_base.py:2519] 2025-03-31 16:20:20,622 &gt;&gt; Special tokens file saved in saves/llama3-8b/lora/sft/special_tokens_map.json<br>***** train metrics *****<br>  epoch                    =     2.9826<br>  total_flos               = 22730138GF<br>  train_loss               =     0.9173<br>  train_runtime            = 0:34:54.13<br>  train_samples_per_second =      1.563<br>  train_steps_per_second   =      0.195<br>Figure saved at: saves/llama3-8b/lora/sft/training_loss.png<br>[WARNING|2025-03-31 16:20:21] llamafactory.extras.ploting:148 &gt;&gt; No metric eval_loss to plot.<br>[WARNING|2025-03-31 16:20:21] llamafactory.extras.ploting:148 &gt;&gt; No metric eval_accuracy to plot.<br>[INFO|modelcard.py:449] 2025-03-31 16:20:21,163 &gt;&gt; Dropping the following result as it does not have all the necessary fields:<br>&#123;&#x27;task&#x27;: &#123;&#x27;name&#x27;: &#x27;Causal Language Modeling&#x27;, &#x27;type&#x27;: &#x27;text-generation&#x27;&#125;&#125;<br></code></pre></td></tr></table></figure><p>å¦‚ä¸Šç”Ÿæˆçš„æ–‡ä»¶â€saves/llama3-8b/lora/sft/training_loss.pngâ€œçš„å†…å®¹å¦‚ä¸‹ï¼š</p><figure><img src="https://s2.loli.net/2025/03/31/76Xi5vWVkSQqhBF.png" alt="image-20250331162458504" /><figcaption aria-hidden="true">image-20250331162458504</figcaption></figure><h1 id="ä¸‰webuiä½¿ç”¨">ä¸‰ã€WebUIä½¿ç”¨</h1><h2 id="å¯åŠ¨ä¸ä½¿ç”¨">3.1 å¯åŠ¨ä¸ä½¿ç”¨</h2><p>å‚è€ƒï¼šhttps://llamafactory.readthedocs.io/zh-cn/latest/getting_started/webui.htmlã€https://github.com/hiyouga/LLaMA-Factory/blob/main/examples/README_zh.md</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨webui</span><br>(llamafactory) root@ksp-registry:~# llamafactory-cli webui<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯ä»¥åœ¨â€œllamafactory-cli webuiâ€å‘½ä»¤å‰æ·»åŠ ä¸€äº›å˜é‡æ¯”å¦‚CUDA_VISIBLE_DEVICES=0,1,2ã€‚æ­¤æ—¶åœ¨webç•Œé¢è®¾å¤‡æ•°é‡å°±æ˜¯3ï¼Œå½“ç„¶å¦‚æœä¸æŒ‡å®šæ­¤å˜é‡ï¼Œé»˜è®¤ä¹Ÿæ˜¯å…¨éƒ¨å¯ç”¨åŠ é€Ÿå¡è®¾å¤‡çš„æ•°é‡3</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">(llamafactory) root@ksp-registry:~# CUDA_VISIBLE_DEVICES=0,1,2 llamafactory-cli webuillamafactory-cli webui</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å‡å¦‚å¯åŠ¨æ­¤è¿›ç¨‹çš„æœåŠ¡å™¨IPæ˜¯ï¼š172.20.0.22ï¼Œæ­¤æ—¶åœ¨ç¬”è®°æœ¬ç”µè„‘æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥â€œhttp://172.20.0.22:7860/â€ å°†çœ‹åˆ°å¦‚ä¸‹ç•Œé¢ä¸å†…å®¹</span><br></code></pre></td></tr></table></figure><figure><img src="https://s2.loli.net/2025/03/24/ZDW4v9IrygLCPpn.png" alt="image-20250324165207061" /><figcaption aria-hidden="true">image-20250324165207061</figcaption></figure><hr /><p>è¿›è¡Œå¾®è°ƒé…ç½®ï¼ˆä¸‹å›¾ä¸­â€œæ£€æŸ¥ç‚¹è·¯å¾„â€æ— é¡»é…ç½®ä»»ä½•å€¼ï¼Œæœªæ³¨æ˜æˆ–æ˜¾å¼ä¿®æ”¹é…ç½®é¡¹ï¼Œä¿æŒé»˜è®¤å³å¯ï¼‰ï¼š</p><figure><img src="https://s2.loli.net/2025/03/31/ISd847lUOMLDrTg.png" alt="image-20250331165053689" /><figcaption aria-hidden="true">image-20250331165053689</figcaption></figure><figure><img src="https://s2.loli.net/2025/03/31/NygEOVhbctZGdUf.png" alt="image-20250331163655420" /><figcaption aria-hidden="true">image-20250331163655420</figcaption></figure><p>æ­£å¼å¼€å§‹æ‰§è¡Œå¾®è°ƒåï¼Œåœ¨å½“å‰é¡µé¢çš„æœ€åº•éƒ¨ï¼Œå°†çœ‹åˆ°æ—¥å¿—ä¸æ–­æ»šåŠ¨è¾“å‡ºï¼Œå¦‚ä¸‹ï¼š</p><figure><img src="https://s2.loli.net/2025/03/31/xB3cP4GwvirYQXu.png" alt="image-20250331163915582" /><figcaption aria-hidden="true">image-20250331163915582</figcaption></figure><p>å¾®è°ƒè¿‡ç¨‹ä¸­é»˜è®¤èƒ½ä½¿ç”¨æ‰€æœ‰èƒ½ç”¨çš„GPUå¡ï¼ˆå‚è€ƒhttps://github.com/hiyouga/LLaMA-Factory/blob/main/examples/README_zh.mdï¼‰ï¼Œå¦‚ä¸‹å¯ä»¥çœ‹åˆ°å¾®è°ƒè¿‡ç¨‹ä¸Šï¼Œç¬”è€…çš„æœåŠ¡å™¨ä¸Šä»…æœ‰ä¸€ä¸ªGPUè¢«ä½¿ç”¨ä¸­ã€‚</p><figure><img src="https://s2.loli.net/2025/03/31/XawVNkZ4U3BKcFs.png" alt="image-20250331172933559" /><figcaption aria-hidden="true">image-20250331172933559</figcaption></figure><p>åœ¨å½“å‰ç›®å½•çš„â€œ./saves/Llama-3-8B-Instruct/lora/train_2025-03-31-16-27-21â€å­ç›®å½•ä¸­å¯ä»¥çœ‹åˆ°ç›¸å…³è¾“å‡ºé…ç½®ä¿¡æ¯ä¸å¾®è°ƒæ—¥å¿—ä¿¡æ¯ã€‚</p><h2 id="æŠ¥é”™å¤„ç†">3.2 æŠ¥é”™å¤„ç†</h2><h3 id="å¾®è°ƒunslothqwen2.5-7b-instruct-bnb-4bitæ¨¡å‹æ—¶æŠ¥é”™no-package-metadata-was-found-for-bitsandbytes">3.2.1 å¾®è°ƒâ€œunsloth/Qwen2.5-7B-Instruct-bnb-4bitâ€æ¨¡å‹æ—¶æŠ¥é”™â€œNo package metadata was found for bitsandbytesâ€</h3><figure><img src="https://s2.loli.net/2025/04/01/sD6I5p24YfVAURO.png" alt="image-20250401105307875" /><figcaption aria-hidden="true">image-20250401105307875</figcaption></figure><figure><img src="https://s2.loli.net/2025/04/01/qDmslY6WQuUHiaR.png" alt="image-20250401105126808" /><figcaption aria-hidden="true">image-20250401105126808</figcaption></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install bitsandbytes bitsandbytes-cuda117==0.26.0.post2<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹é¢è¿™è¡Œå‘½ä»¤ï¼Œç¬”è€…æœªæ‰§è¡ŒæˆåŠŸï¼ˆæš‚æ—¶å¿½ç•¥ï¼Œä¸æ‰§è¡Œä¹Ÿå¯ï¼‰</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">pip install transformers[audio,deepspeed,ftfy,onnx,sentencepiece,timm,tokenizers,video,vision]==4.50.0</span><br></code></pre></td></tr></table></figure><h1 id="å››å¯å‚è€ƒèµ„æ–™">å››ã€å¯å‚è€ƒèµ„æ–™</h1><p>https://github.com/hiyouga/LLaMA-Factory/blob/main/README_zh.md</p><p>https://github.com/hiyouga/LLaMA-Factory/blob/main/examples/README_zh.md</p><p>https://llamafactory.readthedocs.io/zh-cn/latest/getting_started/sft.html</p><p>https://zhuanlan.zhihu.com/p/695287607</p><p>https://nvidia.csdn.net/675a7eabf3b8a55e4e980776.html</p>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤§æ¨¡å‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Transformeræ¨¡å‹ä¸­ä¸“ä¸šåè¯</title>
    <link href="/2025/03/22/Transformer%E6%A8%A1%E5%9E%8B%E4%B8%AD%E4%B8%93%E4%B8%9A%E5%90%8D%E8%AF%8D/"/>
    <url>/2025/03/22/Transformer%E6%A8%A1%E5%9E%8B%E4%B8%AD%E4%B8%93%E4%B8%9A%E5%90%8D%E8%AF%8D/</url>
    
    <content type="html"><![CDATA[<h1 id="è¯å…ƒtoken">1.<strong>è¯å…ƒï¼ˆTokenï¼‰</strong></h1><p>æ˜¯è¾“å…¥æ–‡æœ¬ç»è¿‡åˆ†è¯åçš„ç¦»æ•£ç¬¦å·ï¼Œè¡¨ç¤ºæ¨¡å‹å¤„ç†çš„æœ€å°å•ä½ã€‚</p><ul><li><p><strong>å®šä¹‰</strong>ï¼šè¯å…ƒæ˜¯è¾“å…¥æ–‡æœ¬ç»è¿‡ <strong>åˆ†è¯ï¼ˆTokenizationï¼‰</strong> åå¾—åˆ°çš„åŸºæœ¬å•ä½ã€‚å®ƒå¯ä»¥æ˜¯å•è¯ã€å­è¯ï¼ˆSubwordï¼‰æˆ–å­—ç¬¦ï¼Œå…·ä½“å–å†³äºä½¿ç”¨çš„åˆ†è¯æ–¹æ³•ã€‚</p></li><li><p><strong>ä½œç”¨</strong>ï¼šè¯å…ƒæ˜¯æ¨¡å‹å¤„ç†çš„æœ€å°å•ä½ï¼Œç”¨äºå°†æ–‡æœ¬è½¬æ¢ä¸ºæ¨¡å‹å¯ä»¥ç†è§£çš„ç¦»æ•£ç¬¦å·ã€‚</p></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><ul><li>å¯¹äºå¥å­ <code>"I love NLP."</code>ï¼Œä½¿ç”¨ç©ºæ ¼åˆ†è¯åï¼Œè¯å…ƒå¯èƒ½æ˜¯ <code>["I", "love", "NLP", "."]</code>ã€‚</li><li>ä½¿ç”¨å­è¯åˆ†è¯ï¼ˆå¦‚ BPEï¼‰åï¼Œè¯å…ƒå¯èƒ½æ˜¯ <code>["I", "love", "NL", "##P", "."]</code>ã€‚</li></ul></li></ul><h1 id="è¯å‘é‡word-embedding">2.<strong>è¯å‘é‡ï¼ˆWord Embeddingï¼‰</strong></h1><p>æ˜¯è¯å…ƒç»è¿‡åµŒå…¥å±‚åçš„è¿ç»­å‘é‡è¡¨ç¤ºï¼Œç”¨äºæ•æ‰è¯å…ƒçš„è¯­ä¹‰ä¿¡æ¯ã€‚</p><p><img src="https://s2.loli.net/2025/03/23/Zy6JTWw2jKEsHVl.png" alt="image-20250323113236973" style="zoom:67%;" /></p><ul><li><p><strong>ä½œç”¨</strong>ï¼šè¯å‘é‡å°†ç¦»æ•£çš„è¯å…ƒè½¬æ¢ä¸ºè¿ç»­çš„æ•°å€¼è¡¨ç¤ºï¼Œä¾¿äºæ¨¡å‹è¿›è¡Œè®¡ç®—å’Œå­¦ä¹ ã€‚</p></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><ul><li>å‡è®¾è¯å…ƒ <code>"love"</code> è¢«æ˜ å°„åˆ°ä¸€ä¸ª 3 ç»´å‘é‡ç©ºé—´ï¼Œå…¶è¯å‘é‡å¯èƒ½æ˜¯ <code>[0.2, 0.8, -0.3]</code>ã€‚</li><li>è¯å‘é‡é€šå¸¸æ˜¯é€šè¿‡é¢„è®­ç»ƒï¼ˆå¦‚ Word2Vecã€GloVeï¼‰æˆ–æ¨¡å‹è®­ç»ƒï¼ˆå¦‚ Transformerï¼‰å¾—åˆ°çš„ã€‚</li></ul></li><li><p><strong>è¯å…ƒä¸è¯å‘é‡çš„å…³ç³»</strong></p><ul><li><strong>è¾“å…¥ä¸è¾“å‡º</strong>ï¼š<ul><li>è¯å…ƒæ˜¯æ¨¡å‹çš„è¾“å…¥ï¼Œè¡¨ç¤ºæ–‡æœ¬çš„ç¦»æ•£ç¬¦å·ã€‚</li><li>è¯å‘é‡æ˜¯è¯å…ƒç»è¿‡åµŒå…¥å±‚ï¼ˆEmbedding Layerï¼‰åçš„è¾“å‡ºï¼Œè¡¨ç¤ºè¯å…ƒçš„è¿ç»­å‘é‡è¡¨ç¤ºã€‚</li></ul></li><li><strong>è½¬æ¢è¿‡ç¨‹</strong>ï¼š<ul><li>åœ¨ Transformer ä¸­ï¼Œè¾“å…¥æ–‡æœ¬é¦–å…ˆè¢«åˆ†è¯ä¸ºè¯å…ƒã€‚</li><li>ç„¶åï¼Œè¯å…ƒé€šè¿‡åµŒå…¥å±‚è¢«è½¬æ¢ä¸ºè¯å‘é‡ã€‚</li><li>ä¹‹åè¯å‘é‡ä½œä¸ºæ¨¡å‹çš„è¾“å…¥ï¼Œå‚ä¸åç»­çš„è®¡ç®—ï¼ˆå¦‚è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼‰ã€‚</li></ul></li></ul></li><li><p><strong>ç¤ºä¾‹</strong></p><p>å‡è®¾è¾“å…¥å¥å­ä¸º <code>"I love NLP."</code>ï¼š</p><ul><li><p><strong>è¯å…ƒåŒ–</strong>ï¼š</p><ul><li>åˆ†è¯ç»“æœä¸º <code>["I", "love", "NLP", "."]</code>ã€‚</li></ul></li><li><p><strong>è¯å‘é‡åŒ–</strong>ï¼š</p><p>æ¯ä¸ªè¯å…ƒè¢«æ˜ å°„ä¸ºä¸€ä¸ªè¯å‘é‡ï¼Œä¾‹å¦‚ï¼š</p><ul><li><p><code>"I"</code> â†’ <code>[0.1, 0.3, -0.2]</code></p></li><li><p><code>"love"</code> â†’ <code>[0.2, 0.8, -0.3]</code></p></li><li><p><code>"NLP"</code> â†’ <code>[0.4, -0.1, 0.5]</code></p></li><li><p><code>"."</code> â†’ <code>[-0.1, 0.0, 0.1]</code></p></li></ul></li></ul></li></ul><h1 id="æ—‹è½¬çŸ©é˜µç­‰ç›¸å…³">3.æ—‹è½¬çŸ©é˜µç­‰ç›¸å…³</h1><p>æ—‹è½¬çŸ©é˜µã€ç´¢å¼•ä¸ºiçš„æ—‹è½¬çŸ©é˜µã€ç´¢å¼•ä¸ºiçš„æ—‹è½¬çŸ©é˜µä¸ç´¢å¼•ä¸ºjçš„æ—‹è½¬çŸ©é˜µè½¬ç½®ç›¸ä¹˜ï¼Ÿ</p>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤§æ¨¡å‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ubuntu2004å®‰è£…mavenåˆ¶ä½œå®¹å™¨é•œåƒ</title>
    <link href="/2025/03/21/Ubuntu2004%E5%AE%89%E8%A3%85maven%E5%88%B6%E4%BD%9C%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F/"/>
    <url>/2025/03/21/Ubuntu2004%E5%AE%89%E8%A3%85maven%E5%88%B6%E4%BD%9C%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€å®‰è£…é…ç½®maven"><a href="#ä¸€ã€å®‰è£…é…ç½®maven" class="headerlink" title="ä¸€ã€å®‰è£…é…ç½®maven"></a>ä¸€ã€å®‰è£…é…ç½®maven</h1><p>è®¿é—®mavenå®˜ç½‘ï¼š<a href="https://archive.apache.org/dist/maven/maven-3/">https://archive.apache.org/dist/maven/maven-3/</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹è½½</span><br>root@dify:/opt/instakkPkgs# wget https://archive.apache.org/dist/maven/maven-3/3.8.3/binaries/apache-maven-3.8.3-bin.tar.gz<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è§£å‹</span><br>root@dify:/opt/instakkPkgs# mkdir /opt/maven  <br>root@dify:/opt/instakkPkgs# tar xzvf apache-maven-3.8.1-bin.tar.gz -C /opt/maven<br>root@dify:/opt/instakkPkgs# cd /opt/maven/apache-maven-3.8.1/<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">é…ç½®é˜¿é‡Œé•œåƒ</span><br>root@dify:/opt/maven/apache-maven-3.8.1# vi conf/settings.xml<br>...<br>146   &lt;mirrors&gt;<br>147     &lt;!-- mirror<br>148      | Specifies a repository mirror site to use instead of a given repository. The repository that<br>149      | this mirror serves has an ID that matches the mirrorOf element of this mirror. IDs are used<br>150      | for inheritance and direct lookup purposes, and must be unique across the set of mirrors.<br>151      |<br>152     &lt;mirror&gt;<br>153       &lt;id&gt;mirrorId&lt;/id&gt;<br>154       &lt;mirrorOf&gt;repositoryId&lt;/mirrorOf&gt;<br>155       &lt;name&gt;Human Readable Name for this Mirror.&lt;/name&gt;<br>156       &lt;url&gt;http://my.repository.com/repo/path&lt;/url&gt;<br>157     &lt;/mirror&gt;<br>158      --&gt;<br>159     &lt;mirror&gt;<br>160       &lt;id&gt;aliyunmaven&lt;/id&gt;<br>161       &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;<br>162       &lt;name&gt;aliyun maven&lt;/name&gt;<br>163       &lt;url&gt;https://maven.aliyun.com/repository/public&lt;/url&gt;<br>164     &lt;/mirror&gt;<br>165 &lt;!--    &lt;mirror&gt;<br>166       &lt;id&gt;maven-default-http-blocker&lt;/id&gt;<br>167       &lt;mirrorOf&gt;external:http:*&lt;/mirrorOf&gt;<br>168       &lt;name&gt;Pseudo repository to mirror external repositories initially using HTTP.&lt;/name&gt;<br>169       &lt;url&gt;http://0.0.0.0/&lt;/url&gt;<br>170       &lt;blocked&gt;true&lt;/blocked&gt;<br>171     &lt;/mirror&gt;<br>172 --&gt;<br>173   &lt;/mirrors&gt;<br>...<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†maven binç›®å½•åŠ å…¥ç³»ç»ŸPATH</span><br>root@dify:/opt/maven/apache-maven-3.8.1# vi /root/.bashrc <br>export M2_HOME=/opt/maven/apache-maven-3.8.1<br>export PATH=$PATH:$M2_HOME/bin<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åŠ è½½è®¾ç½®çš„å˜é‡</span><br>root@dify:/opt/maven/apache-maven-3.8.1# source /root/.bashrc <br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">éªŒè¯</span><br>Apache Maven 3.8.1 (05c21c65bdfed0f71a2f2ada8b84da59348c4c5d)<br>Maven home: /opt/maven/apache-maven-3.8.1<br>Java version: 11.0.25, vendor: Oracle Corporation, runtime: /usr/local/jdk-11.0.25<br>Default locale: en, platform encoding: UTF-8<br>OS name: &quot;linux&quot;, version: &quot;5.15.0-102-generic&quot;, arch: &quot;amd64&quot;, family: &quot;unix&quot;<br></code></pre></td></tr></table></figure><h1 id="äºŒã€åˆ¶ä½œå®¹å™¨é•œåƒ"><a href="#äºŒã€åˆ¶ä½œå®¹å™¨é•œåƒ" class="headerlink" title="äºŒã€åˆ¶ä½œå®¹å™¨é•œåƒ"></a>äºŒã€åˆ¶ä½œå®¹å™¨é•œåƒ</h1>]]></content>
    
    
    <categories>
      
      <category>k8säº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8säº‘åŸç”Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nvidia-smiç›¸å…³å‘½ä»¤æ‰§è¡Œæ—¶è¾“å‡ºå†…å®¹</title>
    <link href="/2025/03/20/nvidia-smi%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%97%B6%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/"/>
    <url>/2025/03/20/nvidia-smi%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%97%B6%E8%BE%93%E5%87%BA%E5%86%85%E5%AE%B9/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€å‚è€ƒæ–‡æ¡£"><a href="#ä¸€ã€å‚è€ƒæ–‡æ¡£" class="headerlink" title="ä¸€ã€å‚è€ƒæ–‡æ¡£"></a>ä¸€ã€å‚è€ƒæ–‡æ¡£</h1><p>docs.nvidia.comå®˜æ–¹æ–‡æ¡£å…³äºnvidia-smiçš„è§£é‡Šï¼š<a href="https://docs.nvidia.com/deploy/nvidia-smi/">https://docs.nvidia.com/deploy/nvidia-smi/</a></p><h1 id="äºŒã€ç®€ä»‹"><a href="#äºŒã€ç®€ä»‹" class="headerlink" title="äºŒã€ç®€ä»‹"></a>äºŒã€ç®€ä»‹</h1><p>nvidia-smiï¼Œå…¨ç§°NVIDIA System Management Interfaceï¼Œç®€ç§°NVSMIï¼Œæ˜¯ä¸ºFermiå’Œæ›´é«˜æ¶æ„çš„Teslaã€Quadroã€GRIDå’ŒGeForceè®¾å¤‡æä¾›ç›‘æ§å’Œç®¡ç†åŠŸèƒ½ï¼ˆå¦‚å¼€å¯æˆ–å…³é—­GPUçš„ECCæ¨¡å¼ï¼‰çš„å·¥å…·ã€‚GeForce Titanç³»åˆ—è®¾å¤‡æ”¯æŒå¤§å¤šæ•°åŠŸèƒ½ï¼Œä½†ä¸ºGeForceå“ç‰Œçš„å…¶ä»–åŠŸèƒ½æä¾›çš„ä¿¡æ¯éå¸¸æœ‰é™ã€‚NVSMIæ˜¯ä¸€ä¸ªè·¨å¹³å°å·¥å…·ï¼Œæ”¯æŒæ‰€æœ‰æ ‡å‡†çš„NVIDIAé©±åŠ¨ç¨‹åºæ”¯æŒçš„Linuxå‘è¡Œç‰ˆï¼Œä»¥åŠä»Windows Server 2008 R2å¼€å§‹çš„64ä½Windowsç‰ˆæœ¬ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡stdoutç›´æ¥ä½¿ç”¨æŒ‡æ ‡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡CSVå’ŒXMLæ ¼å¼çš„æ–‡ä»¶æä¾›æŒ‡æ ‡ï¼Œä»¥ä¾›è„šæœ¬ä½¿ç”¨ã€‚</p><p>NVSMIçš„å¤§éƒ¨åˆ†åŠŸèƒ½éƒ½æ˜¯ç”±åº•å±‚åŸºäºCè¯­è¨€çš„NVMLåº“æä¾›çš„ã€‚æœ‰å…³NVMLçš„æ›´å¤šä¿¡æ¯ï¼Œå‚é˜…NVIDIAå¼€å‘è€…ç½‘ç«™é“¾æ¥ï¼ˆ<em><a href="http://developer.nvidia.com/nvidia-management-library-nvml/">http://developer.nvidia.com/nvidia-management-library-nvml/</a></em>ï¼‰ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨åŸºäºnvmlçš„pythonç»‘å®šï¼ˆ<em><a href="http://pypi.python.org/pypi/nvidia-ml-py/">http://pypi.python.org/pypi/nvidia-ml-py/</a></em>ï¼‰ã€‚</p><p>NVSMIçš„è¾“å‡ºä¸èƒ½ä¿è¯æ˜¯å‘åå…¼å®¹çš„ã€‚ä½†æ˜¯ï¼ŒNVMLå’ŒPythonç»‘å®šéƒ½æ˜¯å‘åå…¼å®¹çš„ï¼Œåœ¨ç¼–å†™ä»»ä½•å¿…é¡»ç»´æŠ¤å¤šä¸ªNVIDIAé©±åŠ¨ç¨‹åºå‘è¡Œç‰ˆçš„å·¥å…·æ—¶ï¼Œå®ƒæ˜¯é¦–é€‰ã€‚</p><h1 id="ä¸‰ã€nvidia-smiå‘½ä»¤ä½¿ç”¨"><a href="#ä¸‰ã€nvidia-smiå‘½ä»¤ä½¿ç”¨" class="headerlink" title="ä¸‰ã€nvidia-smiå‘½ä»¤ä½¿ç”¨"></a>ä¸‰ã€nvidia-smiå‘½ä»¤ä½¿ç”¨</h1><p>nvidia-smiå‘½ä»¤çš„é€‰é¡¹ï¼Œ åˆ’åˆ†ä¸ºä¸åŒçš„ç±»åˆ«ï¼Œå¦‚â€œLIST OPTIONSâ€ï¼ˆåŒ…å«-Lã€-Bï¼‰ã€â€SUMMARY OPTIONSâ€ï¼ˆ-iç­‰ï¼‰ã€â€œSELECTIVE QUERY OPTIONSâ€ï¼ˆå«-qç­‰ï¼‰ã€â€œDEVICE MODIFICATION OPTIONSâ€ï¼ˆæ‰€æœ‰ä»¥â€œâ€“queryâ€å¼€å¤´é€‰é¡¹ï¼Œå¦‚â€“query-gpuï¼‰ï¼Œè¿˜æœ‰â€œDEVICE MODIFICATION OPTIONSâ€ç­‰å¤šä¸ªç±»åˆ«ã€‚å¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š<code>nvidia-smi --help</code></p><h2 id="3-1-nvidia-smi"><a href="#3-1-nvidia-smi" class="headerlink" title="3.1 nvidia-smi"></a>3.1 nvidia-smi</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£</span><br>nvidia-smi --help<br><br>(kt) root@ksp-registry:~# nvidia-smi <br>Thu Mar 20 11:08:24 2025       <br>+-----------------------------------------------------------------------------------------+<br>| NVIDIA-SMI 550.54.15              Driver Version: 550.54.15      CUDA Version: 12.4     |<br>|-----------------------------------------+------------------------+----------------------+<br>| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |<br>| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |<br>|                                         |                        |               MIG M. |<br>|=========================================+========================+======================|<br>|   0  NVIDIA A40                     Off |   00000000:C1:00.0 Off |                    0 |<br>|  0%   46C    P0             77W /  300W |   10376MiB /  46068MiB |      0%      Default |<br>|                                         |                        |                  N/A |<br>+-----------------------------------------+------------------------+----------------------+<br>                                                                                         <br>+-----------------------------------------------------------------------------------------+<br>| Processes:                                                                              |<br>|  GPU   GI   CI        PID   Type   Process name                              GPU Memory |<br>|        ID   ID                                                               Usage      |<br>|=========================================================================================|<br>|    0   N/A  N/A     28419      C   python                                      10368MiB |<br>+-----------------------------------------------------------------------------------------+<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell">Thu Mar 20 11:08:24 2025    è¡¨ç¤ºæŸ¥è¯¢æ—¶çš„æ—¥æœŸä¸æ—¶é—´<br>NVIDIA-SMI 550.54.15        å½“å‰å®‰è£…çš„ NVIDIA é©±åŠ¨ç¨‹åºçš„ç‰ˆæœ¬å·ï¼Œæ ¼å¼ä¸ºï¼šä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·<br>Driver Version: 550.54.15   è¡¨ç¤º NVIDIA é©±åŠ¨ç¨‹åºçš„ç‰ˆæœ¬å·ï¼Œä¸å‰é¢å†…å®¹ä¸€è‡´<br>CUDA Version: 12.4          å»ºè®®çš„cudaç‰ˆæœ¬å·ï¼Œæ ¼å¼ä¸ºï¼šä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·<br><br>GPU:            æ•´å‹æ•°å­—ï¼Œæ˜¯GPUåœ¨å½“å‰æœåŠ¡å™¨ä¸Šçš„ç¼–å·ï¼Œä»0å¼€å§‹<br>Name:           GPUçš„åå­—ï¼Œæ˜¾ç¤ºçš„æ˜¯GPUå‹å·ï¼ˆå¦‚NVIDIA A40ã€Tesla V100-PCIE...ï¼‰<br>Persistence-Mï¼š  æŒç»­æ¨¡å¼çš„çŠ¶æ€ã€‚è®¾ç½®åé©¬ä¸Šç”Ÿæ•ˆï¼Œé‡å¯åæ¢å¤æˆé»˜è®¤çš„Disabledå³offçŠ¶æ€ï¼Œä»…åœ¨Linuxä¸Šå¯ç”¨ã€‚<br>                 æŒä¹…æ¨¡å¼æ˜¯ä¸€ç§ NVIDIA GPU çš„åŠŸèƒ½ï¼Œç”¨äºæ§åˆ¶ GPU çš„ç”µæºç®¡ç†è¡Œä¸ºã€‚å½“æŒä¹…æ¨¡å¼å¯ç”¨æ—¶ï¼ŒGPU ä¼šå§‹ç»ˆä¿æŒåˆå§‹åŒ–çŠ¶                    æ€ï¼Œå³ä½¿æ²¡æœ‰æ­£åœ¨è¿è¡Œçš„ GPU ä»»åŠ¡ã€‚ç¦ç”¨æŒä¹…æ¨¡å¼åï¼ŒGPU åœ¨ç©ºé—²æ—¶ä¼šè¿›å…¥ä½åŠŸè€—çŠ¶æ€ï¼Œé‡æ–°å¯åŠ¨ä»»åŠ¡æ—¶éœ€è¦é‡æ–°åˆå§‹                    åŒ–ï¼Œ è¿™ä¼šå¢åŠ å»¶è¿Ÿã€‚å¯ç”¨æŒä¹…æ¨¡å¼å¯ä»¥é¿å…è¿™ç§å»¶è¿Ÿã€‚<br>Fanï¼š                   é£æ‰‡è½¬é€Ÿï¼ˆ0%--100%ï¼‰ï¼ŒN/Aè¡¨ç¤ºæ²¡æœ‰é£æ‰‡<br>Tempï¼š                  GPUæ¸©åº¦ï¼ˆGPUæ¸©åº¦è¿‡é«˜ä¼šå¯¼è‡´GPUé¢‘ç‡ä¸‹é™ï¼‰<br>Perfï¼š                  æ€§èƒ½çŠ¶æ€ï¼Œä»P0ï¼ˆæœ€é«˜æ€§èƒ½ï¼‰åˆ°P12ï¼ˆæœ€ä½æ€§èƒ½ï¼‰ã€‚å®ƒä¼šæ ¹æ® GPU è´Ÿè½½ã€åŠŸè€—é™åˆ¶å’Œæ¸©åº¦è‡ªåŠ¨è°ƒæ•´ã€‚<br>Pwr:Usage/Cap           GPUåŠŸè€—ï¼Œæ˜¾ç¤ºå½“å‰ GPU çš„åŠŸè€—å’ŒåŠŸè€—ä¸Šé™<br><br>Bus-Idï¼š        GPUæ€»çº¿ï¼Œdomain:bus:device.function<br>Disp.Aï¼š        Display Activeï¼Œè¡¨ç¤ºGPU æ˜¯å¦æ­£åœ¨è¿è¡Œæ˜¾ç¤ºä»»åŠ¡ï¼Œä¾‹å¦‚æ˜¯å¦è¿æ¥äº†æ˜¾ç¤ºå™¨ã€‚<br>Memory-Usageï¼š  æ˜¾å­˜ä½¿ç”¨ç‡<br><br>Volatile Uncorr. ECCï¼š    æ˜¯å¦å¼€å¯é”™è¯¯æ£€æŸ¥å’Œçº æ­£æŠ€æœ¯ï¼Œ0/DISABLED, 1/ENABLEDã€‚N/A è¡¨ç¤ºè¿™ä¸ª GPU ä¸æ”¯æŒ ECC æˆ–è€…æ²¡                                 æœ‰å¯ç”¨ ECCã€‚<br>GPU-Util:                 GPUä½¿ç”¨ç‡ï¼Œ0% è¡¨ç¤º GPU ç›®å‰åœ¨ç©ºé—²çŠ¶æ€ã€‚<br>Compute M.ï¼š              è®¡ç®—æ¨¡å¼ï¼Œ0/DEFAULT,1/EXCLUSIVE_PROCESS,2/PROHIBITEDã€‚é»˜è®¤æ¨¡å¼è¡¨ç¤ºä»»ä½•äººéƒ½å¯ä»¥å¯åŠ¨                                  GPU è®¡ç®—ä»»åŠ¡ã€‚åœ¨å…¶ä»–æ¨¡å¼ä¸‹ï¼Œåªæœ‰ç‰¹å®šç”¨æˆ·æˆ–è¿›ç¨‹å¯ä»¥å¯åŠ¨è®¡ç®—ä»»åŠ¡ã€‚<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#Processes éƒ¨åˆ†æ˜¾ç¤ºäº† å½“å‰æ­£åœ¨ä½¿ç”¨ GPU çš„è¿›ç¨‹ä¿¡æ¯ã€‚æ¯”å¦‚å“ªäº›è¿›ç¨‹æ­£åœ¨å ç”¨ GPU èµ„æºï¼Œä»¥åŠå®ƒä»¬çš„ä½¿ç”¨æƒ…å†µ</span></span><br>GPU             GPU çš„ IDï¼ˆå¦‚æœæœ‰å¤šä¸ª GPUï¼Œç¬¬ä¸€ä¸ªGPUçš„ç¼–å·ä» 0 å¼€å§‹ï¼Œæ˜¾ç¤ºå½“å‰è¿›ç¨‹æ‰€ä½¿ç”¨çš„GPU-idï¼‰<br>GI             GPU Instance IDï¼ˆGPU å®ä¾‹ IDï¼Œé€šå¸¸ç”¨äº MIG å¤šå®ä¾‹ GPUï¼‰ï¼Œæœªç”¨MIGæ—¶æ˜¾ç¤º N/A<br>CI             Compute Instance IDï¼ˆè®¡ç®—å®ä¾‹ IDï¼Œé€šå¸¸ç”¨äº MIG å¤šå®ä¾‹ GPUï¼‰ï¼Œæœªç”¨MIGæ—¶æ˜¾ç¤º N/A<br>PID             è¿›ç¨‹ IDï¼ˆProcess IDï¼‰ï¼Œè¡¨ç¤ºæ­£åœ¨ä½¿ç”¨ GPU çš„è¿›ç¨‹çš„æ“ä½œç³»ç»Ÿè¿›ç¨‹ ID<br>Type         è¿›ç¨‹ç±»å‹ï¼š<br>                    - Cï¼šCompute è®¡ç®—è¿›ç¨‹<br>                    - Gï¼šGraphics å›¾å½¢è¿›ç¨‹<br>                    - C+Gï¼šåŒæ—¶ä½¿ç”¨è®¡ç®—å’Œå›¾å½¢<br>Process name   è¿›ç¨‹çš„åç§°æˆ–è·¯å¾„ï¼Œè¡¨ç¤ºæ­£åœ¨ä½¿ç”¨ GPU çš„è¿›ç¨‹çš„åç§°ã€‚å¯èƒ½åªæ˜¾ç¤ºè¿›ç¨‹ä¸­ç¬¬ä¸€ä¸ªç©ºæ ¼ä¹‹é—´çš„å†…å®¹<br>GPU Memory Usageè¿›ç¨‹å ç”¨çš„ GPU æ˜¾å­˜å¤§å°ï¼ˆä»¥ MiB ä¸ºå•ä½ï¼‰ã€‚<br></code></pre></td></tr></table></figure><h2 id="3-2-QUERY-OPTIONS"><a href="#3-2-QUERY-OPTIONS" class="headerlink" title="3.2 QUERY OPTIONS"></a>3.2 QUERY OPTIONS</h2><h3 id="3-2-1-nvidia-smi-q-xxx"><a href="#3-2-1-nvidia-smi-q-xxx" class="headerlink" title="3.2.1 nvidia-smi -q -xxx"></a>3.2.1 nvidia-smi -q -xxx</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœä¸å†åŠ å…¶ä»–å‚æ•°ï¼Œå¦‚ä¸‹å‘½ä»¤ä¼šå°†GPUçš„æ‰€æœ‰è¯¦ç»†ä¿¡æ¯å…¨éƒ¨æŸ¥è¯¢å¹¶è¾“å‡ºåˆ°æ§åˆ¶å°</span><br>nvidia-smi -q<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹nvidia-smi å‘½ä»¤çš„ç”¨æ³•</span><br>(kt) root@ksp-registry:/opt# nvidia-smi -h | more                <br>NVIDIA System Management Interface -- v550.54.15<br><br>NVSMI provides monitoring information for Tesla and select Quadro devices.<br>The data is presented in either a plain text or an XML format, via stdout or a file.<br>NVSMI also provides several management operations for changing the device state.<br><br>Note that the functionality of NVSMI is exposed through the NVML C-based<br>library. See the NVIDIA developer website for more information about NVML.<br>Python wrappers to NVML are also available.  The output of NVSMI is<br>not guaranteed to be backwards compatible; NVML and the bindings are backwards<br>compatible.<br><br>http://developer.nvidia.com/nvidia-management-library-nvml/<br>http://pypi.python.org/pypi/nvidia-ml-py/<br>Supported products:<br>- Full Support<br>    - All Tesla products, starting with the Kepler architecture<br>    - All Quadro products, starting with the Kepler architecture<br>    - All GRID products, starting with the Kepler architecture<br>    - GeForce Titan products, starting with the Kepler architecture<br>- Limited Support<br>    - All Geforce products, starting with the Kepler architecture<br>nvidia-smi [OPTION1 [ARG1]] [OPTION2 [ARG2]] ...<br><br>    -h,   --help                Print usage information and exit.<br><br>          --version             Print version information and exit.<br><br>  LIST OPTIONS:<br><br>    -L,   --list-gpus           Display a list of GPUs connected to the system.<br><br>    -B,   --list-excluded-gpus  Display a list of excluded GPUs in the system.<br><br>  SUMMARY OPTIONS:<br><br>    &lt;no arguments&gt;              Show a summary of GPUs connected to the system.<br><br>    [plus any of]<br><br>    -i,   --id=                 Target a specific GPU.<br>    -f,   --filename=           Log to a specified file, rather than to stdout.<br>    -l,   --loop=               Probe until Ctrl+C at specified second interval.<br><br>  QUERY OPTIONS:<br><br>    -q,   --query               Display GPU or Unit info.<br><br>    [plus any of]<br><br>    -u,   --unit                Show unit, rather than GPU, attributes.<br>    -i,   --id=                 Target a specific GPU or Unit.<br>    -f,   --filename=           Log to a specified file, rather than to stdout.<br>    -x,   --xml-format          Produce XML output.<br>          --dtd                 When showing xml output, embed DTD.<br>    -d,   --display=            Display only selected information: MEMORY,<br>                                    UTILIZATION, ECC, TEMPERATURE, POWER, CLOCK,<br>                                    COMPUTE, PIDS, PERFORMANCE, SUPPORTED_CLOCKS,<br>                                    PAGE_RETIREMENT, ACCOUNTING, ENCODER_STATS,<br>                                    SUPPORTED_GPU_TARGET_TEMP, VOLTAGE, FBC_STATS<br>                                    ROW_REMAPPER, RESET_STATUS, GSP_FIRMWARE_VERSION<br>                                Flags can be combined with comma e.g. ECC,POWER.<br>                                Sampling data with max/min/avg is also returned <br>                                for POWER, UTILIZATION and CLOCK display types.<br>                                Doesn&#x27;t work with -u or -x flags.<br>    -l,   --loop=               Probe until Ctrl+C at specified second interval.<br><br>    -lms, --loop-ms=            Probe until Ctrl+C at specified millisecond interval.<br>...<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">-då‚æ•° æŒ‡å®šè¦è¾“å‡ºGPUå“ªäº›ä¿¡æ¯ï¼Œå¦‚ä¸‹ä¸ºECCä¸POWERï¼Œå¤šä¸ªæŒ‡æ ‡é—´ä¸­è‹±æ–‡é€—å·è¿æ¥</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">-få‚æ•° æŒ‡å®šæŸ¥è¯¢ç»“æœè¾“å‡ºåˆ°æŸä¸ªæ–‡ä»¶ä¸­ï¼Œè€Œä¸æ˜¯æ ‡å‡†è¾“å‡ºå³æ§åˆ¶å°</span><br>(kt) root@ksp-registry:/opt# nvidia-smi -q -d ECC,POWER -f test01<br>(kt) root@ksp-registry:/opt# cat test01 <br><br>==============NVSMI LOG==============<br><br>Timestamp                                 : Thu Mar 20 15:28:46 2025<br>Driver Version                            : 550.54.15<br>CUDA Version                              : 12.4<br><br>Attached GPUs                             : 1<br>GPU 00000000:C1:00.0<br>    ECC Mode<br>        Current                           : Enabled<br>        Pending                           : Enabled<br>    ECC Errors<br>        Volatile<br>            SRAM Correctable              : 0<br>            SRAM Uncorrectable Parity     : 0<br>            SRAM Uncorrectable SEC-DED    : 0<br>            DRAM Correctable              : 0<br>            DRAM Uncorrectable            : 0<br>        Aggregate<br>            SRAM Correctable              : 0<br>            SRAM Uncorrectable Parity     : 0<br>            SRAM Uncorrectable SEC-DED    : 0<br>            DRAM Correctable              : 0<br>            DRAM Uncorrectable            : 0<br>            SRAM Threshold Exceeded       : No<br>        Aggregate Uncorrectable SRAM Sources<br>            SRAM L2                       : 0<br>            SRAM SM                       : 0<br>            SRAM Microcontroller          : 0<br>            SRAM PCIE                     : 0<br>            SRAM Other                    : 0<br>    GPU Power Readings<br>        Power Draw                        : 21.68 W<br>        Current Power Limit               : 300.00 W<br>        Requested Power Limit             : 300.00 W<br>        Default Power Limit               : 300.00 W<br>        Min Power Limit                   : 100.00 W<br>        Max Power Limit                   : 300.00 W<br>    Power Samples<br>        Duration                          : 117.96 sec<br>        Number of Samples                 : 119<br>        Max                               : 26.65 W<br>        Min                               : 21.49 W<br>        Avg                               : 21.75 W<br>    GPU Memory Power Readings <br>        Power Draw                        : N/A<br>    Module Power Readings<br>        Power Draw                        : N/A<br>        Current Power Limit               : N/A<br>        Requested Power Limit             : N/A<br>        Default Power Limit               : N/A<br>        Min Power Limit                   : N/A<br>        Max Power Limit                   : N/A<br>        <br><span class="hljs-meta prompt_">#</span><span class="language-bash">è¿˜å¯ä»¥å°†æŸ¥è¯¢ç»“æœä»¥xmlæ ¼å¼è¾“å‡ºï¼Œä½†POWER, UTILIZATION and CLOCKä¸èƒ½è¾“å‡ºä¸ºxmlæ–‡ä»¶æˆ–è€…ä¸-uä¸€èµ·ä½¿ç”¨</span><br>nvidia-smi -q -x -f test01<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##ä¸€äº›å¸¸ç”¨å‘½ä»¤</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">1)è¾“å‡ºç¬¬0ä¸ªGPUçš„è¯¦ç»†ä¿¡æ¯</span><br>nvidia-smi -q -i 0<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">2)æ˜¾ç¤ºå•å…ƒï¼Œè€Œä¸æ˜¯device, DTD ä¿¡æ¯</span><br>(kt) root@ksp-registry:/opt# nvidia-smi -q -u<br>==============NVSMI LOG==============<br><br>Timestamp                                 : Thu Mar 20 15:46:29 2025<br>Driver Version                            : 550.54.15<br>CUDA Version                              : 12.4<br><br>HIC Info                                  : N/A<br>Attached Units                            : 0<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">3ï¼‰ç¬¬éš”ä¸€æ®µæ—¶é—´æŸ¥è¯¢ä¸€æ¬¡GPUä¿¡æ¯ï¼Œå¦‚ä¸‹æ˜¯5ï¼ˆå•ä½é»˜è®¤æ˜¯ç§’ï¼‰</span><br>nvidia-smi -q -i 0 -l 5<br>nvidia-smi -q -i 0 -lms 500   #500æ¯«ç§’<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¹Ÿå¯ä»¥å°†-lä¸-få‚æ•°ç»“åˆèµ·æ¥ä½¿ç”¨ï¼Œå®ç°å®šæœŸæŸ¥è¯¢æŸGPUçš„æƒ…å†µå¹¶å°†æŸ¥è¯¢ç»“æœé‡å®šå‘åˆ°æŸæ–‡ä»¶ä¸­</span><br>nvidia-smi -q -i 0 -l 5 -f ./gpu0.log<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">4)åªæŸ¥è¯¢GPUæŸäº›æŒ‡æ ‡ï¼ˆå…·ä½“æ”¯æŒçš„æŒ‡æ ‡é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥è¯¢ï¼šnvidia-smi --<span class="hljs-built_in">help</span> | egrep -w <span class="hljs-string">&quot;\-d&quot;</span> -A 10ï¼‰</span><br>nvidia-smi -q -d ECC,POWER -f test01<br>nvidia-smi -q -i 0 -l 5 -d PIDS,MEMORY,UTILIZATION -f ./gpu0.log<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">5)</span><br></code></pre></td></tr></table></figure><h2 id="3-3-SELECTIVE-QUERY-OPTIONS"><a href="#3-3-SELECTIVE-QUERY-OPTIONS" class="headerlink" title="3.3 SELECTIVE QUERY OPTIONS"></a>3.3 SELECTIVE QUERY OPTIONS</h2><h3 id="3-3-1-nvidia-smi-â€“query-gpu"><a href="#3-3-1-nvidia-smi-â€“query-gpu" class="headerlink" title="3.3.1 nvidia-smi â€“query-gpu"></a>3.3.1 nvidia-smi â€“query-gpu</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ­¤å«åšSELECTIVE QUERY OPTIONS é€‰æ‹©æ€§æŸ¥è¯¢é€‰é¡¹ï¼Œèƒ½å¤ŸæŒ‡å®šéœ€è¦æŸ¥è¯¢çš„å…·ä½“æŒ‡æ ‡ä¸å±æ€§</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹nvidia-smi --query-gpuçš„å¸®åŠ©æ–‡æ¡£</span><br>(kt) root@ksp-registry:~# nvidia-smi --help-query-gpu<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å…·ä½“--query-gpuå‚æ•°æœ‰å“ªäº›å‚æ•°å€¼å¯ç”¨ï¼Œå¯é€šè¿‡â€œnvidia-smi --help-query-gpuâ€è·çŸ¥</span><br>nvidia-smi --query-gpu=gpu_name,driver_version,memory.total,memory.used --format=csv<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å…¶ä¸­â€œ--formatâ€å‚æ•°å€¼ä¸­ä¸€å®šè¦åŒ…å«csvï¼Œæ­¤å¤–è¿˜å¯ä»¥æ·»åŠ å…¶ä»–å€¼ï¼ˆæœ‰noheader,nounitsï¼‰</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å…¶ä¸­noheaderè¡¨ç¤ºä¸æ‰“å°è¡¨å¤´ï¼Œ nounitsè¡¨ç¤ºä¸æ‰“å°æ•°å€¼çš„å•ä½</span><br>nvidia-smi --query-gpu=gpu_name,driver_version,memory.total,memory.used --format=csv,noheader<br></code></pre></td></tr></table></figure><h3 id="3-3-2-nvidia-smi-â€“query-compute-apps"><a href="#3-3-2-nvidia-smi-â€“query-compute-apps" class="headerlink" title="3.3.2 nvidia-smi â€“query-compute-apps"></a>3.3.2 nvidia-smi â€“query-compute-apps</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥è¯¢å½“å‰æ­£åœ¨ä½¿ç”¨ GPU è¿›è¡Œè®¡ç®—ä»»åŠ¡çš„åº”ç”¨ç¨‹åºä¿¡æ¯</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£</span><br>nvidia-smi --help-query-compute-apps<br><br>(kt) root@ksp-registry:~# nvidia-smi --query-compute-apps=timestamp,gpu_name,gpu_bus_id,gpu_serial,gpu_uuid,pid,process_name,used_gpu_memory --format=csv<br>timestamp, gpu_name, gpu_bus_id, gpu_serial, gpu_uuid, pid, process_name, used_gpu_memory [MiB]<br>2025/03/22 18:13:47.456, NVIDIA A40, 00000000:C1:00.0, 1320922048526, GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff, 9507, python, 11110 MiB<br></code></pre></td></tr></table></figure><h3 id="3-3-3-nvidia-smi-â€“query-supported-clocks"><a href="#3-3-3-nvidia-smi-â€“query-supported-clocks" class="headerlink" title="3.3.3 nvidia-smi â€“query-supported-clocks"></a>3.3.3 nvidia-smi â€“query-supported-clocks</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥è¯¢ GPU æ”¯æŒçš„æ—¶é’Ÿé¢‘ç‡åŠå…¶ç»„åˆ</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£</span><br>nvidia-smi --help-query-supported-clocks<br><br>(kt) root@ksp-registry:~# nvidia-smi --query-supported-clocks=timestamp,gpu_name,gpu_bus_id,gpu_serial,gpu_uuid,memory,graphics --format=csv<br></code></pre></td></tr></table></figure><h3 id="3-3-4-nvidia-smi-â€“query-accounted-apps"><a href="#3-3-4-nvidia-smi-â€“query-accounted-apps" class="headerlink" title="3.3.4 nvidia-smi â€“query-accounted-apps"></a>3.3.4 nvidia-smi â€“query-accounted-apps</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥è¯¢å¯ç”¨äº† GPU Accounting åŠŸèƒ½çš„ç³»ç»Ÿä¸­ï¼Œå„ä¸ªåº”ç”¨ç¨‹åºå¯¹ GPU èµ„æºçš„ä½¿ç”¨æƒ…å†µ</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£</span><br>nvidia-smi --help-query-accounted-apps<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">éœ€è¦GPUå‹å·æ”¯æŒã€GPUé©±åŠ¨ç‰ˆæœ¬æ”¯æŒã€GPUå¼€å¯Accountingæ¨¡å¼ã€æœ‰è¿›ç¨‹æ­£åœ¨ä½¿ç”¨GPU</span><br>(self-llm) root@controller01:~# nvidia-smi --query-accounted-apps=timestamp,gpu_name,gpu_bus_id,gpu_serial,gpu_uuid,pid, --format=csv<br>timestamp, gpu_name, gpu_bus_id, gpu_serial, gpu_uuid, pid<br>2025/03/22 18:12:36.487, NVIDIA A40, 00000000:41:00.0, 1320922048169, GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4, 41337<br></code></pre></td></tr></table></figure><h3 id="3-3-5-nvidia-smi-â€“query-retired-pages"><a href="#3-3-5-nvidia-smi-â€“query-retired-pages" class="headerlink" title="3.3.5 nvidia-smi â€“query-retired-pages"></a>3.3.5 nvidia-smi â€“query-retired-pages</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥è¯¢å·²é€€å½¹çš„GPUè®¾å¤‡å†…å­˜é¡µåˆ—è¡¨</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£</span><br>nvidia-smi --help-query-query-retired-pages<br><br>(kt) root@ksp-registry:~# nvidia-smi --query-retired-pages=gpu_name,retired_pages.timestamp,retired_pages.cause --format=csv<br>gpu_name, retired_pages.timestamp, retired_pages.cause<br>NVIDIA A40, [N/A], Single Bit ECC<br>NVIDIA A40, [N/A], Double Bit ECC<br></code></pre></td></tr></table></figure><h3 id="3-3-6-nvidia-smi-â€“query-remapped-rows"><a href="#3-3-6-nvidia-smi-â€“query-remapped-rows" class="headerlink" title="3.3.6 nvidia-smi â€“query-remapped-rows"></a>3.3.6 nvidia-smi â€“query-remapped-rows</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥è¯¢ GPU æ˜¾å­˜ä¸­çš„è¡Œé‡æ˜ å°„ä¿¡æ¯</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£</span><br>nvidia-smi --help-query-remapped-rows<br><br>(kt) root@ksp-registry:~# nvidia-smi --query-remapped-rows=gpu_name,remapped_rows.correctable,remapped_rows.uncorrectable --format=csv<br>gpu_name, remapped_rows.correctable, remapped_rows.uncorrectable<br>NVIDIA A40, 0, 0<br></code></pre></td></tr></table></figure><h2 id="3-4-Device-Monitoring"><a href="#3-4-Device-Monitoring" class="headerlink" title="3.4 Device Monitoring"></a>3.4 Device Monitoring</h2><h3 id="3-4-1-nvidia-smi-dmon"><a href="#3-4-1-nvidia-smi-dmon" class="headerlink" title="3.4.1 nvidia-smi dmon"></a>3.4.1 nvidia-smi dmon</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ˜¯ç”¨æ¥æŸ¥è¯¢è¾“å‡ºGPUè®¾å¤‡ï¼ˆä»¥GPUè®¾å¤‡ä¸ºç»´åº¦ï¼‰å®æ—¶ç›‘æ§ä¿¡æ¯çš„å·¥å…·ï¼Œä¼šæŒç»­è¾“å‡ºæ•°æ®ï¼ˆé»˜è®¤é—´éš”ä¸º1ç§’ï¼‰ï¼Œç›´åˆ°â€œctrl+xâ€æˆ–æŒ‡å®šåˆ·æ–°æ¬¡æ•°</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¼šåœ¨æ ‡å‡†è¾“å‡ºä¸­æŒç»­å‘ä¸‹ä»¥å›ºå®šçš„é—´éš”æ»šåŠ¨åˆ·æ–°è¾“å‡º</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£</span><br>nvidia-smi dmon --help<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç¤ºä¾‹</span><br>(kt) root@ksp-registry:~# nvidia-smi dmon<br><span class="hljs-meta prompt_"># </span><span class="language-bash">gpu    pwr  gtemp  mtemp     sm    mem    enc    dec    jpg    ofa   mclk   pclk</span> <br><span class="hljs-meta prompt_"># </span><span class="language-bash">Idx      W      C      C      %      %      %      %      %      %    MHz    MHz</span> <br>    0     90     48      -     11      8      0      0      0      0   7250   1740 <br>    0     90     48      -     10      7      0      0      0      0   7250   1740 <br>    0     92     48      -     10      7      0      0      0      0   7250   1740 <br>    0     88     48      -      7      5      0      0      0      0   7250   1740 <br>    0     92     48      -      9      6      0      0      0      0   7250   1740 <br>    0     92     49      -     10      7      0      0      0      0   7250   1740 <br>...<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">1ï¼‰-iå‚æ•°æŒ‡å®šè¢«ç›‘æ§çš„GPUï¼Œå¯ä»¥æ˜¯å¦‚ä¸‹3ç§å€¼ï¼šIdx/PCI bus IDæˆ–UUID</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å…¶ä¸­Idxå°±æ˜¯GPUçš„åºå·ä»0å¼€å§‹ï¼ŒUUIDæ˜¯GPUçš„å”¯ä¸€æ ‡è¯†ï¼ŒäºŒè€…éƒ½å¯é€šè¿‡å¦‚ä¸‹æ–¹å¼æŸ¥è¯¢ï¼šnvidia-smi -L</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">PCI bus IDï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼æŸ¥è¯¢ï¼šnvidia-smi -q | grep -i <span class="hljs-string">&quot;bus id&quot;</span></span><br>nvidia-smi dmon -i xxx<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">2ï¼‰-då‚æ•°ï¼ŒæŒ‡å®šåˆ·æ–°é—´éš”ï¼Œå•ä½æ˜¯ç§’</span><br>nvidia-smi dmon â€“d xxx<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">3ï¼‰-cå‚æ•°ï¼ŒæŒ‡å®šåˆ·æ–°æ¬¡æ•°ï¼Œç„¶åé€€å‡º</span><br>nvidia-smi dmon â€“c xxx<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">4ï¼‰-så‚æ•°ï¼ŒæŒ‡å®šæŸ¥è¯¢çš„ç›‘æ§æŒ‡æ ‡ã€‚æ”¯æŒå¦‚ä¸‹æŒ‡æ ‡ï¼Œå¯åŒæ—¶ä½¿ç”¨å¤šä¸ª</span><br>[-s | --select]:      One or more metrics [default=puc]<br>                      Can be any of the following:<br>                          p - Power Usage and Temperature<br>                          u - Utilization<br>                          c - Proc and Mem Clocks<br>                          v - Power and Thermal Violations<br>                          m - FB, Bar1 and CC Protected Memory<br>                          e - ECC Errors and PCIe Replay errors<br>                          t - PCIe Rx and Tx Throughput<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚è¦ç›‘æ§ç”µè€—ä¸æ¸©åº¦ã€GPUåˆ©ç”¨ç‡ï¼Œåˆ™ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤</span><br>nvidia-smi dmon -s pu<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">5ï¼‰-oå‚æ•°ï¼Œåœ¨ç›‘æ§ä¿¡æ¯å‰æ˜¾ç¤ºç›‘æ§ä¿¡æ¯çš„è·å–æ—¥æœŸæˆ–æ—¶é—´ï¼ŒDè¡¨ç¤ºæ—¥æœŸï¼ŒTè¡¨ç¤ºæ—¶é—´</span><br>nvidia-smi dmon -s pu -o DT<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">6ï¼‰-få‚æ•°ï¼Œå°†æŸ¥è¯¢çš„ç›‘æ§ä¸è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼Œè€Œæ˜¯é‡å®šå‘åˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­</span><br>nvidia-smi dmon -s pu -o DT -f gpu0.log<br><br></code></pre></td></tr></table></figure><h3 id="3-4-2-nvidia-smi-pmon"><a href="#3-4-2-nvidia-smi-pmon" class="headerlink" title="3.4.2 nvidia-smi pmon"></a>3.4.2 nvidia-smi pmon</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ˜¯ç”¨æ¥æŸ¥è¯¢è¾“å‡ºä½¿ç”¨GPUè®¾å¤‡çš„è¿›ç¨‹ï¼ˆä»¥è¿›ç¨‹ä¸ºç»´åº¦ï¼‰å®æ—¶ç›‘æ§ä¿¡æ¯çš„å·¥å…·ï¼Œä¼šæŒç»­è¾“å‡ºæ•°æ®ï¼ˆé»˜è®¤é—´éš”ä¸º1ç§’ï¼‰ï¼Œç›´åˆ°â€œctrl+xâ€æˆ–æŒ‡å®šåˆ·æ–°æ¬¡æ•°</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¼šåœ¨æ ‡å‡†è¾“å‡ºä¸­æŒç»­å‘ä¸‹ä»¥å›ºå®šçš„é—´éš”æ»šåŠ¨åˆ·æ–°è¾“å‡º</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£</span><br>nvidia-smi pmon --help<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç¤ºä¾‹</span><br>(kt) root@ksp-registry:~# nvidia-smi pmon<br><span class="hljs-meta prompt_"># </span><span class="language-bash">gpu         pid   <span class="hljs-built_in">type</span>     sm    mem    enc    dec    jpg    ofa    <span class="hljs-built_in">command</span></span> <br><span class="hljs-meta prompt_"># </span><span class="language-bash">Idx           <span class="hljs-comment">#    C/G      %      %      %      %      %      %    name</span></span> <br>    0       9507     C      0      0      -      -      -      -    python         <br>    0       9507     C      0      0      -      -      -      -    python         <br>    0       9507     C      0      0      -      -      -      -    python         <br>    0       9507     C      0      0      -      -      -      -    python         <br>...<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">â€œnvidia-smi pmonâ€æ”¯æŒçš„å¸¸ç”¨å‚æ•°ï¼Œä¸â€œnvidia-smi dmonâ€æ”¯æŒçš„å¸¸ç”¨å‚æ•°ï¼ŒåŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„</span><br></code></pre></td></tr></table></figure><h2 id="3-5-DEVICE-MODIFICATION-OPTIONS"><a href="#3-5-DEVICE-MODIFICATION-OPTIONS" class="headerlink" title="3.5 DEVICE MODIFICATION OPTIONS"></a>3.5 DEVICE MODIFICATION OPTIONS</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£ï¼Œå¦‚ä¸‹å‘½ä»¤æ‰§è¡Œè¾“å‡ºçš„<span class="hljs-string">&quot;DEVICE MODIFICATION OPTIONS&quot;</span>éƒ¨åˆ†</span><br>nvidia-smi --help<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è®¾ç½®æŒä¹…åŒ–æ¨¡å¼ï¼Œ0/DISABLED, 1/ENABLED</span><br>nvidia-smi -pm 0/1<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ‡æ¢ECCæ”¯æŒï¼Œ0/DISABLED, 1/ENABLED</span><br>nvidia-smi â€“e 0/1<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é‡ç½®ECCé”™è¯¯è®¡æ•°ï¼Œ0/VOLATILE, 1/AGGREGATE</span><br>nvidia-smi -p 0/1<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è®¾ç½®GPUè®¡ç®—æ¨¡å¼ï¼Œ0/DEFAULT, 1/EXCLUSIVE_THREAD (DEPRECATED),</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">2/PROHIBITED, 3/EXCLUSIVE_PROCESS</span><br>nvidia-smi -c xx<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è®¾ç½®åº”ç”¨åœ¨GPUä¸Šæ‰§è¡Œæ—¶çš„æ—¶é’Ÿé¢‘ç‡ï¼ˆGPUæ”¯æŒåœ°æ—¶é’Ÿé¢‘ç‡è§nvidia-smi --query-accounted-appsï¼‰</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æœ‰ä¸¤ä¸ªå€¼ï¼Œåˆ†åˆ«æ˜¯&lt;memory,graphics&gt;ï¼Œåˆ†åˆ«ä»£è¡¨æ ¸å¿ƒæ—¶é’Ÿé¢‘ç‡ã€æ˜¾å­˜æ—¶é’Ÿé¢‘ç‡</span><br>nvidia-smi -ac 2000,800<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é‡ç½®ä¸Šè¿°æ—¶é’Ÿé¢‘ç‡</span><br>nvidia-smi -rac<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯åœGPUçš„accountingæ¨¡å¼ï¼Œ0/DISABLED, 1/ENABLED</span><br>nvidia-smi -ac 0/1<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯åœMIGï¼ˆéœ€è¦é‡å¯æœåŠ¡å™¨ï¼‰ï¼Œ0/DISABLED, 1/ENABLED</span><br>nvidia-smi -mig 0/1<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">...</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>NVIDIAç”Ÿæ€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nvidia</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è”æƒ³Yogaç¬”è®°æœ¬ç»typeCçº¿è¿æ¥æ˜¾ç¤ºå™¨æ— æ•ˆ</title>
    <link href="/2025/03/19/%E8%81%94%E6%83%B3Yoga%E7%AC%94%E8%AE%B0%E6%9C%AC%E7%BB%8FtypeC%E7%BA%BF%E8%BF%9E%E6%8E%A5%E6%98%BE%E7%A4%BA%E5%99%A8%E6%97%A0%E6%95%88/"/>
    <url>/2025/03/19/%E8%81%94%E6%83%B3Yoga%E7%AC%94%E8%AE%B0%E6%9C%AC%E7%BB%8FtypeC%E7%BA%BF%E8%BF%9E%E6%8E%A5%E6%98%BE%E7%A4%BA%E5%99%A8%E6%97%A0%E6%95%88/</url>
    
    <content type="html"><![CDATA[<p>è‡ªå·±ä½¿ç”¨ä¸€å°è”æƒ³Yoga 14SIHU 2021 ç¬”è®°æœ¬ç”µè„‘ï¼Œå› ä¸ºç¬”è®°æœ¬è‡ªå¸¦æ˜¾ç¤ºå±è¾ƒå°ï¼Œæ•…å¹³æ—¶å¤–æ¥ä¸€å°æ˜¾ç¤ºå™¨æ¥ä½¿ç”¨ã€‚</p><p>æœ€è¿‘ä¸¤å¤©çªç„¶å‡ºç°å¦‚ä¸‹æƒ…å†µï¼Œæ˜¾ç¤ºå™¨æ— æ³•æ­£å¸¸ä½¿ç”¨ï¼š</p><p>åœºæ™¯1ï¼šå‘¨ä¸€å»å…¬å¸åŠå…¬ï¼Œé€šè¿‡æ•°æ®çº¿å°†ç¬”è®°æœ¬ç”µè„‘çš„typeCæ¥å£ï¼Œè¿æ¥åˆ°æ˜¾ç¤ºå™¨1çš„HDMIæ¥å£ï¼Œæ˜¾ç¤ºå™¨ä¸€ç›´æ˜¾ç¤ºæ— ä¿¡å·ã€‚ä½†æ˜¾ç¤ºå™¨å¼€æœºæ—¶å¯ä»¥çœ‹åˆ°äº®ç¯ä¸è¾“å‡ºæ˜¾ç¤ºå™¨æ ‡è¯†ï¼Œå¯ä»¥åŸºæœ¬æ–­å®šæ˜¾ç¤ºå™¨æ— é—®é¢˜-&gt;æ€€ç–‘æ˜¯æ•°æ®çº¿çš„é—®é¢˜ï¼Œä½¿ç”¨åŒäº‹çš„æ•°æ®çº¿ä¹Ÿæ˜¯åŒæ ·çš„å¼‚å¸¸æ•ˆæœ-&gt;é‚£ä¹ˆåŒäº‹å¯æ­£å¸¸ä½¿ç”¨çš„æ•°æ®çº¿åˆ°æˆ‘è¿™é‡Œå°±ä¸å¯ç”¨äº†ï¼Œéš¾é“æ˜¯æˆ‘ç¬”è®°æœ¬ç”µè„‘æ¥å£çš„é—®é¢˜ï¼Ÿå› ä¸ºæœ‰ä»»åŠ¡ï¼Œç™½å¤©ä¹Ÿæ²¡åŠŸå¤«å¤„ç†äº†ï¼Œç›´æ¥ä½¿ç”¨äº†ç¬”è®°æœ¬è‡ªå¸¦çš„æ˜¾ç¤ºå±ã€‚</p><p>åœºæ™¯2ï¼šæ™šä¸Šä¸‹ç­ï¼Œå°†ç”µè„‘å¸¦å›å®¶ã€‚è‡ªå®¶ä¹Ÿæœ‰ä¸€æ¡æ•°æ®çº¿ä¸ä¸€ä¸ªæ˜¾ç¤ºå™¨ï¼Œæ•°æ®çº¿ä¸¤å°éƒ½æ˜¯type-Cæ¥å£çš„ã€‚å°†å®ƒä»¬è¿æ¥ä¸Šåï¼Œå‘ç°æ˜¾ç¤ºå™¨è¿˜æ˜¯æ²¡æœ‰æ­£å¸¸æ˜¾ç¤ºç¬”è®°æœ¬ç”µè„‘çš„æ¡Œé¢å†…å®¹ï¼Œå› ä¸ºå‰ä¸€å¤©è¿˜åœ¨æ­£å¸¸ä½¿ç”¨è‡ªå®¶çš„æ•°æ®çº¿ä¸æ˜¾ç¤ºå™¨ï¼Œæ‰€ä»¥ç°åœ¨ä¸¥é‡æ€€ç–‘æ˜¯ç¬”è®°æœ¬ç”µè„‘type-Cæ¥å£çš„çš„é—®é¢˜äº†ã€‚</p><p>æŠ±ç€è¯•ä¸€ä¸‹çš„å¿ƒæ€ï¼Œå»ç½‘å¡æœç´¢ä¸‹â€œç¬”è®°æœ¬ç”µè„‘ type-c è¿æ¥æ˜¾ç¤ºå™¨ æ— ååº”â€ï¼Œçœ‹åˆ°ä¸€ç¯‡æ–‡ç« <a href="https://h30471.www3.hp.com/t5/bi-ji-ben-dian-nao/type-c-kou-wai-jie-xian-shi-qi-tu-ran-mei-fan-ying/td-p/1258469">type-cå£å¤–æ¥æ˜¾ç¤ºå™¨çªç„¶æ²¡ååº”</a> ï¼Œæ–‡ä¸­æè¿°äº†åŸºæœ¬ä¸€æ ·çš„é—®é¢˜ç°è±¡ã€‚ä¸€ä½åä¸ºâ€œååçš„ç¬‘â€çš„â€œä¸“å®¶â€ç»™å‡ºäº†å¦‚ä¸‹ä¸¤ä¸ªæ–¹æ³•</p><p>ï¼ˆ1ï¼‰é‡Šæ”¾é™ç”µï¼šå…³æœºå¹¶æ‹”æ‰ç”µæºé€‚é…å™¨ï¼Œç§»é™¤å…¨éƒ¨å¤–æ¥è®¾å¤‡ï¼ŒæŒ‰ä½ç”µæºé”®å¹¶ä¿æŒ30ç§’å†æ¾å¼€ï¼Œä¹‹åï¼Œæ’ç”µæºé€‚é…å™¨ï¼Œå¼€æœºè§‚å¯Ÿã€‚</p><p>ï¼ˆ2ï¼‰BIOSç¡¬é‡ç½®ï¼šå…³æœºçŠ¶æ€ä¸‹ï¼ŒåŒæ—¶æŒ‰ WindowsæŒ‰é”® + V æŒ‰é”®å¹¶ä¿æŒæŒ‰ä½çš„çŠ¶æ€ï¼ŒæŒ‰ç”µæºé”®å¼€æœºï¼ŒWindows + V ä¸è¦æ¾å¼€ã€‚ç­‰å¾…ä¸€åˆ†é’Ÿï¼Œå¦‚æœå¼€æœºæœ‰æ˜¾ç¤ºï¼Œå¹¶æç¤º502é”™è¯¯ï¼Œå°±è¡¨ç¤ºé‡ç½®æˆåŠŸã€‚ä¹‹åå¦‚æœåŸæ¥æ˜¯UEFIå¼•å¯¼çš„ç³»ç»Ÿï¼Œå°±å¯ä»¥ç›´æ¥è¿›å…¥ç³»ç»Ÿã€‚</p><p>è‡ªå·±å°è¯•äº†æ–¹æ³•ï¼ˆ1ï¼‰åï¼Œä¸Šè¿°é—®é¢˜å°±ä¸å†å­˜åœ¨ã€‚</p><p>åœ¨ç½‘ä¸Šç»§ç»­ç¨å¾®å­¦ä¹ äº†ä¸‹ï¼šé™ç”µæ˜¯ç”±äºè®¾å¤‡å†…éƒ¨æˆ–å¤–éƒ¨æ‘©æ“¦ã€æ„Ÿåº”ç­‰åŸå› ç§¯ç´¯çš„ç”µè·ï¼Œå¦‚æœä¸åŠæ—¶é‡Šæ”¾ï¼Œå¯èƒ½ä¼šå¯¼è‡´è®¾å¤‡æ•…éšœæˆ–æŸåã€‚é‚£ä¹ˆç¬”è®°æœ¬ç”µè„‘åœ¨æ—¥å¸¸ä½¿ç”¨ä¸­é€šå¸¸åˆä¸éœ€è¦é‡Šæ”¾é™ç”µå‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºç°ä»£ç¬”è®°æœ¬ç”µè„‘åœ¨è®¾è®¡ä¸Šå·²ç»é‡‡å–äº†å¤šç§æªæ–½æ¥é˜²æ­¢é™ç”µç§¯ç´¯å’Œé™ç”µæ”¾ç”µï¼ˆESDï¼‰çš„å½±å“ã€‚ç„¶è€Œï¼Œå¶å°”éœ€è¦é‡Šæ”¾é™ç”µçš„æƒ…å†µé€šå¸¸æ˜¯ç”±äºæŸäº›ç‰¹æ®Šæ¡ä»¶æˆ–æ„å¤–æƒ…å†µå¯¼è‡´çš„ã€‚</p><p>è¿˜æœ‰ä¸€ç§é‡Šæ”¾ç¬”è®°æœ¬é™ç”µçš„æ–¹æ³•ï¼šå…ˆæŠŠç¬”è®°æœ¬å…³æœºæ‹”æ‰ç”µæºä¸æ‰€æœ‰å¤–æ¥è®¾å¤‡ï¼Œç„¶ååœ¨ç¬”è®°æœ¬å…³æœºåæ¥ä¸Šç”µæºé€‚é…å™¨ä½†ä¸æ’ç”µè¿™æ—¶å€™ç¬”è®°æœ¬èƒŒåçš„ç¯ï¼ˆå‰ææ˜¯éœ€è¦æœ‰ç¯ã€‚ä½†æœ‰äº›ç¬”è®°æœ¬ç”µè„‘èƒŒåæ²¡æœ‰è¿™æ ·çš„ç¯ï¼‰å¦‚æœäº®äº†ä¸€ä¸‹ï¼Œé‚£ä¹ˆå°±è¯´æ˜é™ç”µé‡Šæ”¾äº†ã€‚ï¼ˆå¦‚æœç¬”è®°æœ¬ç”µè„‘èƒŒåæ²¡æœ‰è¿™æ ·çš„ç¯ï¼Œå°±å¦‚ä¸‹æ“ä½œï¼‰ç„¶åå†ç›´æ¥å¼€æœºå°±ç®—è¿˜æœ‰æ®‹ä½™çš„é™ç”µï¼Œä¹Ÿä¼šéšç€ç”µæºé€‚é…å™¨å¯¼æ‰</p>]]></content>
    
    
    <categories>
      
      <category>ç¡¬ä»¶é—®é¢˜ä¸æ•…éšœ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¬”è®°æœ¬ç”µè„‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ubuntu2204å®‰è£…jdk11</title>
    <link href="/2025/03/19/Ubuntu2204%E5%AE%89%E8%A3%85jdk11/"/>
    <url>/2025/03/19/Ubuntu2204%E5%AE%89%E8%A3%85jdk11/</url>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">x86 ubuntu20 LTSä¸ŠäºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹è½½å®‰è£…æ–‡ä»¶ï¼šhttps://www.oracle.com/java/technologies/javase/jdk11-archive-downloads.html</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è§£å‹å®‰è£…æ–‡ä»¶ï¼Œè§£å‹è¿‡ç¨‹å°±æ˜¯å®‰è£…è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œè§£å‹åçš„æ–‡ä»¶å°±æ˜¯åé¢è¦è¿è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚å»ºè®®è§£å‹åˆ°ç‰¹å®šç›®å½•å¦‚ï¼š/usr/local/</span><br>root@dify:/opt/installPkgs# tar -zxf jdk-11.0.25_linux-x64_bin.tar.gz -C /usr/local/<br>root@dify:/opt/installPkgs# ls -al /usr/local/jdk-11.0.25<br>total 44<br>drwxr-xr-x  9 root  root  4096 Mar 19 09:24 .<br>drwxr-xr-x 11 root  root  4096 Mar 19 09:24 ..<br>-r--r--r--  1 10668 10668  160 Sep 30 05:32 README.html<br>drwxr-xr-x  2 root  root  4096 Mar 19 09:24 bin<br>drwxr-xr-x  4 root  root  4096 Mar 19 09:24 conf<br>drwxr-xr-x  3 root  root  4096 Mar 19 09:24 include<br>drwxr-xr-x  2 root  root  4096 Mar 19 09:24 jmods<br>drwxr-xr-x 72 root  root  4096 Mar 19 09:24 legal<br>drwxr-xr-x  6 root  root  4096 Mar 19 09:24 lib<br>drwxr-xr-x  3 root  root  4096 Mar 19 09:24 man<br>-rw-r--r--  1 10668 10668 1314 Sep 30 05:32 release<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é…ç½®Javaç¯å¢ƒ</span><br>root@dify:/opt/installPkgs# vi /etc/profile<br><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨æ­¤æ–‡ä»¶çš„æœ€åæ·»åŠ å¦‚ä¸‹å†…å®¹</span><br>export JAVA_HOME=/usr/local/jdk-11.0.25<br>export JRE_HOME=$&#123;JAVA_HOME&#125;/jre<br>export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib<br>export PATH=$&#123;JAVA_HOME&#125;/bin:$PATH<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åº”ç”¨é…ç½®æ–‡ä»¶</span><br>root@dify:/opt/installPkgs# source /etc/profile<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ£€æŸ¥Javaç‰ˆæœ¬</span><br>root@dify:/opt/installPkgs# java -version<br>java 11.0.25 2024-10-15 LTS<br>Java(TM) SE Runtime Environment 18.9 (build 11.0.25+9-LTS-256)<br>Java HotSpot(TM) 64-Bit Server VM 18.9 (build 11.0.25+9-LTS-256, mixed mode)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ubuntu2204éƒ¨ç½²Difyç¯å¢ƒ</title>
    <link href="/2025/03/17/Ubuntu2204%E9%83%A8%E7%BD%B2Dify%E7%8E%AF%E5%A2%83/"/>
    <url>/2025/03/17/Ubuntu2204%E9%83%A8%E7%BD%B2Dify%E7%8E%AF%E5%A2%83/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€å‚è€ƒæ–‡æ¡£">ä¸€ã€å‚è€ƒæ–‡æ¡£</h1><p>https://github.com/langgenius/dify/tree/0.15.3</p><p>https://github.com/langgenius/dify/tree/0.15.3/docker</p><h1 id="äºŒç¯å¢ƒä¸è§„åˆ’">äºŒã€ç¯å¢ƒä¸è§„åˆ’</h1><table><thead><tr class="header"><th>ä¸»æœºå</th><th>ç”¨é€”</th><th>IP</th><th>rootç”¨æˆ·å¯†ç </th><th>è§„æ ¼</th><th>ç³»ç»Ÿç›˜</th><th>OS</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr class="odd"><td>dify</td><td>difyã€ai-to-pptx-backend</td><td>10.12.62.32</td><td>cloud@2020</td><td>8c16g</td><td>500G</td><td>Ubuntu 22.04.3 LTS-amd64</td><td>è”ç½‘</td></tr></tbody></table><p>æ­¤æ–‡æ¡£ä½¿ç”¨docker-composeçš„æ–¹å¼æ¥éƒ¨ç½²dify</p><h1 id="ä¸‰éƒ¨ç½²æ­¥éª¤">ä¸‰ã€éƒ¨ç½²æ­¥éª¤</h1><h2 id="ä¸‹è½½å®‰è£…æºç ">3.1 ä¸‹è½½å®‰è£…æºç </h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@dify:~# mkdir /opt/code_repos<br>root@dify:~# cd /opt/code_repos/<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœå¤ªæ…¢æˆ–ä¸€ç›´æ‹‰å–å¤±è´¥å°±å…ˆå¯¼å…¥åˆ°giteeä¸­å†æ‹‰å–(git <span class="hljs-built_in">clone</span> -b 0.15.3 https://gitee.com/sy-jiang/dify.git)</span><br>root@dify:/opt/code_repos# git clone -b 0.15.3 https://github.com/langgenius/dify.git<br></code></pre></td></tr></table></figure><h2 id="å®‰è£…docker">3.2 å®‰è£…Docker</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…ä¾èµ–ç»„ä»¶</span><br>root@dify:~# apt install apt-transport-https ca-certificates curl gnupg lsb-release<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä»é˜¿é‡Œäº‘é•œåƒç«™ä¸‹è½½ Docker CE çš„ GPG å¯†é’¥ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°ç³»ç»Ÿçš„ APT å¯†é’¥é“¾ä¸­</span><br>root@dify:~# curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ·»åŠ é˜¿é‡Œäº‘çš„docker-ceå®‰è£…æºï¼Œæ¯”é»˜è®¤ä½¿ç”¨çš„å®˜æ–¹å®‰è£…æºè¦å¿«äº›</span><br>root@dify:~# add-apt-repository &quot;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable&quot;<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰§è¡Œå®‰è£…docker-ce</span><br>root@dify:~# apt-get install docker-ce docker-ce-cli containerd.io<br>root@dify:~# vi /etc/docker/daemon.json <br>&#123;<br>    &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],<br>    &quot;dns&quot;: [<br>        &quot;223.5.5.5&quot;,<br>        &quot;223.6.6.6&quot;,<br>        &quot;202.103.0.68&quot;,<br>        &quot;8.8.8.8&quot;<br>    ],<br>    &quot;log-opts&quot;: &#123;<br>        &quot;max-file&quot;: &quot;5&quot;,<br>        &quot;max-size&quot;: &quot;50m&quot;<br>    &#125;,<br>    &quot;registry-mirrors&quot;: [<br>        &quot;https://hub.rat.dev&quot;,<br>        &quot;https://registry.aliyuncs.com&quot;,<br>        &quot;https://registry.docker-cn.com&quot;,<br>        &quot;https://docker.chenby.cn&quot;,<br>        &quot;https://docker.registry.cyou&quot;,<br>        &quot;https://docker-cf.registry.cyou&quot;,<br>        &quot;https://dockercf.jsdelivr.fyi&quot;,<br>        &quot;https://docker.jsdelivr.fyi&quot;,<br>        &quot;https://dockertest.jsdelivr.fyi&quot;,<br>        &quot;https://dockerproxy.com&quot;,<br>        &quot;https://docker.m.daocloud.io&quot;,<br>        &quot;https://docker.nju.edu.cn&quot;,<br>        &quot;https://docker.mirrors.sjtug.sjtu.edu.cn&quot;,<br>        &quot;https://docker.mirrors.ustc.edu.cn&quot;,<br>        &quot;https://mirror.iscas.ac.cn&quot;,<br>        &quot;https://docker.rainbond.cc&quot;<br>    ]<br>&#125;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é‡å¯docker</span><br>root@dify:~# systemctl daemon-reload<br>root@dify:~# systemctl restart docker<br></code></pre></td></tr></table></figure><h2 id="å®‰è£…docker-compose">3.3 å®‰è£…docker-compose</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@dify:/opt# mkdir /opt/instakkPkgs<br>root@dify:/opt# cd /opt/instakkPkgs/<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç›´æ¥ä¸‹è½½äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶</span><br>root@dify:/opt/instakkPkgs# curl -L &quot;https://github.com/docker/compose/releases/download/v2.34.0/docker-compose-linux-$(uname -m)&quot; -o /usr/local/bin/docker-compose<br><span class="hljs-meta prompt_">#</span><span class="language-bash">èµ‹äºˆå¯æ‰§è¡Œæƒé™</span><br>root@dify:/opt/instakkPkgs# chmod +x /usr/local/bin/docker-compose<br></code></pre></td></tr></table></figure><h2 id="æ‰§è¡Œéƒ¨ç½²ç›¸å…³å‘½ä»¤">3.4 æ‰§è¡Œéƒ¨ç½²ç›¸å…³å‘½ä»¤</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@dify:/opt/code_repos/dify/docker# cp .env.example .env<br>root@dify:/opt/code_repos/dify/docker# cp docker-compose.yaml docker-compose.yaml.bak<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ›¿æ¢é•œåƒ</span><br>root@dify:/opt/code_repos/dify/docker# cat sed-images.sh <br><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br><br>sed -i &quot;s#langgenius/dify-api:0.15.3#swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/langgenius/dify-api:0.15.3#g&quot; docker-compose.yaml<br>sed -i &quot;s#langgenius/dify-web:0.15.3#swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/langgenius/dify-web:0.15.3#g&quot; docker-compose.yaml<br>sed -i &quot;s#postgres:15-alpine#swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/postgres:15-alpine#g&quot; docker-compose.yaml<br>sed -i &quot;s#redis:6-alpine#swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/redis:6-alpine#g&quot; docker-compose.yaml<br>sed -i &quot;s#langgenius/dify-sandbox:0.2.10#swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/langgenius/dify-sandbox:0.2.10#g&quot; docker-compose.yaml<br>sed -i &quot;s#ubuntu/squid:latest#swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/ubuntu/squid:latest#g&quot; docker-compose.yaml<br>sed -i &quot;s#certbot/certbot#swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/certbot/certbot:v3.2.0#g&quot; docker-compose.yaml<br>sed -i &quot;s#nginx:latest#swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/nginx:latest#g&quot; docker-compose.yaml<br>sed -i &quot;s#pingcap/tidb:v8.4.0#swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/pingcap/tidb:v8.4.0#g&quot; docker-compose.yaml<br>sed -i &quot;s#semitechnologies/weaviate:1.19.0#swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/semitechnologies/weaviate:1.19.0#g&quot; docker-compose.yaml<br>sed -i &quot;s#langgenius/qdrant:v1.7.3#swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/langgenius/qdrant:v1.7.3#g&quot; docker-compose.yaml<br>sed -i &quot;s#pgvector/pgvector:pg16#swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/pgvector/pgvector:pg16#g&quot; docker-compose.yaml<br>sed -i &quot;s#tensorchord/pgvecto-rs:pg16-v0.3.0#swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/tensorchord/pgvecto-rs:pg16-v0.3.0#g&quot; docker-compose.yaml<br>sed -i &quot;s#ghcr.io/chroma-core/chroma:0.5.20#swr.cn-north-4.myhuaweicloud.com/ddn-k8s/ghcr.io/chroma-core/chroma:0.5.20#g&quot; docker-compose.yaml<br>sed -i &quot;s#quay.io/oceanbase/oceanbase-ce:4.3.3.0-100000142024101215#swr.cn-north-4.myhuaweicloud.com/ddn-k8s/quay.io/oceanbase/oceanbase-ce:4.3.3.0-100000142024101215#g&quot; docker-compose.yaml<br>sed -i &quot;s#container-registry.oracle.com/database/free:latest#swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/container-registry.oracle.com/database/free:latest#g&quot; docker-compose.yaml<br>sed -i &quot;s#quay.io/coreos/etcd:v3.5.5#swr.cn-north-4.myhuaweicloud.com/ddn-k8s/quay.io/coreos/etcd:v3.5.5#g&quot; docker-compose.yaml<br>sed -i &quot;s#minio/minio:RELEASE.2023-03-20T20-16-18Z#swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/minio/minio:RELEASE.2023-03-20T20-16-18Z#g&quot; docker-compose.yaml<br>sed -i &quot;s#milvusdb/milvus:v2.5.0-beta#swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/milvusdb/milvus:v2.5.0-beta#g&quot; docker-compose.yaml<br>sed -i &quot;s#opensearchproject/opensearch:latest#swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/opensearchproject/opensearch:latest#g&quot; docker-compose.yaml<br>sed -i &quot;s#opensearchproject/opensearch-dashboards:latest#swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/opensearchproject/opensearch-dashboards:latest#g&quot; docker-compose.yaml<br>sed -i &quot;s#myscale/myscaledb:1.6.4#swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/myscale/myscaledb:1.6.4#g&quot; docker-compose.yaml<br>sed -i &quot;s#docker.elastic.co/elasticsearch/elasticsearch:8.14.3#swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.elastic.co/elasticsearch/elasticsearch:8.14.3#g&quot; docker-compose.yaml<br>sed -i &quot;s#docker.elastic.co/kibana/kibana:8.14.3#swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.elastic.co/kibana/kibana:8.14.3#g&quot; docker-compose.yaml<br>sed -i &quot;s#downloads.unstructured.io/unstructured-io/unstructured-api:latest#swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/downloads.unstructured.io/unstructured-io/unstructured-api:latest#g&quot; docker-compose.yaml<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@dify:/opt/code_repos/dify/docker# bash sed-images.sh<br>root@dify:/opt/code_repos/dify/docker# docker compose up -d<br></code></pre></td></tr></table></figure><figure><img src="https://s2.loli.net/2025/03/17/ynf2WoQtP9xT5hZ.png" alt="image-20250317165600013" /><figcaption aria-hidden="true">image-20250317165600013</figcaption></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æœ¬äººåœ¨å¦å¤–ä¸€ä¸ªæœåŠ¡å™¨ä¸Šé‡åˆ°æ­¤æƒ…å†µï¼šæ‰§è¡Œâ€œdocker compose up -dâ€åï¼Œdocker-weaviate-1å®¹å™¨ä¸€ç›´æ— æ³•æ­£å¸¸åˆ›å»ºå‡ºæ¥</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤åï¼Œåˆ›å»ºæˆåŠŸï¼ˆå¦‚æœæ²¡æœ‰æ­¤å®¹å™¨ï¼Œå°±ç›¸å½“äºå‘é‡åŒ–æœåŠ¡æœªæ­£å¸¸è¿è¡Œï¼Œåç»­çŸ¥è¯†åº“ä¸Šä¼ æ–‡ä»¶æ‰§è¡Œå‘é‡åŒ–æ—¶ä¼šæç¤ºâ€œvector database connection errorâ€ï¼‰</span><br>root@ksp-registry:/opt/code_repos/dify/docker# docker-compose up weaviate -d <br></code></pre></td></tr></table></figure><h2 id="ç™»å½•webç•Œé¢ç»§ç»­éƒ¨ç½²">ç™»å½•webç•Œé¢ç»§ç»­éƒ¨ç½²</h2><p>æµè§ˆå™¨è®¿é—®ï¼šhttp://10.12.62.32/install</p><p>è¾“å…¥å¿…å¡«çš„ç›¸å…³ä¿¡æ¯åï¼Œç‚¹å‡»è®¾ç½®</p><figure><img src="https://s2.loli.net/2025/03/17/XG8AHsOl1kUZizp.png" alt="image-20250317171057195" /><figcaption aria-hidden="true">image-20250317171057195</figcaption></figure><h1 id="å››éƒ¨ç½²ai-to-pptx-backend">å››ã€éƒ¨ç½²ai-to-pptx-backend</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@dify:/opt/code_repos# git clone https://gitee.com/sy-jiang/ai-to-pptx-backend.git<br>root@dify:/opt/code_repos# cd ai-to-pptx-backend/<br><br>1 ä¸‹è½½é•œåƒ: docker pull chatbookai/ai-to-pptx:0.2<br>2 å¯åŠ¨é•œåƒ: docker run -itd --name ai-to-pptx-backend -p 8080:80 -p 8081:81 chatbookai/ai-to-pptx:0.2<br>3 å¼€å§‹ä½¿ç”¨: åœ¨æµè§ˆå™¨é‡Œé¢è¾“å…¥: http://localhost:8080<br>4 åˆ—å‡ºé•œåƒ: docker ps -a<br>5 è¿›å…¥é•œåƒ: docker exec -it &lt;container_name_or_id&gt; /bin/bash<br></code></pre></td></tr></table></figure><h1 id="äº”éƒ¨ç½²ai-to-pptx">äº”ã€éƒ¨ç½²ai-to-pptx</h1><p>å®¹å™¨æ—¶å·²ç»éƒ¨ç½²å‰ç«¯</p>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤§æ¨¡å‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Centos8-x86_64ä¸Šå®‰è£…ä½¿ç”¨nvidia-docker</title>
    <link href="/2025/03/16/Centos8-x86-64%E4%B8%8A%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8nvidia-docker/"/>
    <url>/2025/03/16/Centos8-x86-64%E4%B8%8A%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8nvidia-docker/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€è¯´æ˜"><a href="#ä¸€ã€è¯´æ˜" class="headerlink" title="ä¸€ã€è¯´æ˜"></a>ä¸€ã€è¯´æ˜</h1><p>ç”±äºä¸€äº›åŸå› ï¼Œé‡åˆ°äº†åœ¨centos8ä¸Šä½¿ç”¨nvidia-dockerï¼Œä»¥å‰åŸºæœ¬ä¸Šæ²¡ä½¿ç”¨è¿‡ï¼Œå°†è‡ªå·±çš„å®‰è£…ã€é…ç½®ã€ä½¿ç”¨è¿‡ç¨‹è®°å½•ä¸€ä¸‹ã€‚</p><h1 id="äºŒã€æ­¥éª¤"><a href="#äºŒã€æ­¥éª¤" class="headerlink" title="äºŒã€æ­¥éª¤"></a>äºŒã€æ­¥éª¤</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">1.å¸è½½å·²æœ‰ç»„ä»¶</span><br>yum remove docker \<br>  docker-client \<br>  docker-client-latest \<br>  docker-common \<br>  docker-latest \<br>  docker-latest-logrotate \<br>  docker-logrotate \<br>  docker-engine<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">2.å®‰è£…åŸºç¡€ç»„ä»¶</span><br>yum install -y yum-utils \<br>  device-mapper-persistent-data \<br>  lvm2<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">3.é…ç½®ä»“åº“</span><br>yum-config-manager \<br>  --add-repo \<br>  https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">4.å®‰è£…docker-ce*</span><br>yum list docker-ce --showduplicates | sort -r  #æŸ¥çœ‹ç‰ˆæœ¬<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…æœ€æ–°ç‰ˆæœ¬</span><br>yum install docker-ce docker-ce-cli containerd.io<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœè¦å®‰è£…æŒ‡å®šç‰ˆæœ¬</span><br>yum install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">5.å¯åŠ¨dockerå¹¶åœ¨ä¸ä½¿ç”¨GPUæ—¶è¿è¡Œå®¹å™¨</span><br>systemctl start docker<br>docker run hello-world æˆ– docker run swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/library/hello-world:latest<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">6.å®‰è£… nvidia-container-* åŒ…</span><br>yum install -y nvidia-container-toolkit install nvidia-container-runtime<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">7.Docker å®ˆæŠ¤è¿›ç¨‹ä»¥è¯†åˆ« NVIDIA å®¹å™¨è¿è¡Œæ—¶ï¼ˆå…³é”®ï¼‰</span><br>nvidia-ctk runtime configure --runtime=docker<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">8.ä¿®æ”¹/etc/docker/daemon.jsonæ–‡ä»¶ï¼Œæ·»åŠ é»˜è®¤è¿è¡Œæ—¶ä¸ºnvidia</span><br>vi /etc/docker/daemon.json<br>&#123;<br>    &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],<br>    &quot;dns&quot;: [<br>        &quot;223.5.5.5&quot;,<br>        &quot;223.6.6.6&quot;,<br>        &quot;202.103.0.68&quot;,<br>        &quot;8.8.8.8&quot;<br>    ],<br>    &quot;log-opts&quot;: &#123;<br>        &quot;max-file&quot;: &quot;5&quot;,<br>        &quot;max-size&quot;: &quot;50m&quot;<br>    &#125;,<br>    &quot;registry-mirrors&quot;: [<br>        &quot;https://hub.rat.dev&quot;,<br>        &quot;https://registry.aliyuncs.com&quot;,<br>        &quot;https://registry.docker-cn.com&quot;,<br>        &quot;https://docker.chenby.cn&quot;,<br>        &quot;https://docker.registry.cyou&quot;,<br>        &quot;https://docker-cf.registry.cyou&quot;,<br>        &quot;https://dockercf.jsdelivr.fyi&quot;,<br>        &quot;https://docker.jsdelivr.fyi&quot;,<br>        &quot;https://dockertest.jsdelivr.fyi&quot;,<br>        &quot;https://dockerproxy.com&quot;,<br>        &quot;https://docker.m.daocloud.io&quot;,<br>        &quot;https://docker.nju.edu.cn&quot;,<br>        &quot;https://docker.mirrors.sjtug.sjtu.edu.cn&quot;,<br>        &quot;https://docker.mirrors.ustc.edu.cn&quot;,<br>        &quot;https://mirror.iscas.ac.cn&quot;,<br>        &quot;https://docker.rainbond.cc&quot;<br>    ],<br>    &quot;default-runtime&quot;: &quot;nvidia&quot;,<br>    &quot;runtimes&quot;: &#123;<br>        &quot;nvidia&quot;: &#123;<br>            &quot;path&quot;: &quot;/usr/local/nvidia/toolkit/nvidia-container-runtime&quot;,<br>            &quot;runtimeArgs&quot;: []<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">9.åŠ è½½daemon.jsonæ–‡ä»¶å¹¶é‡å¯dockeræœåŠ¡</span><br>systemctl daemon-reload<br>systemctl restart docker<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">10.åˆ›å»ºå¸¦NVIDIA GPUçš„å®¹å™¨</span><br>docker run -itd \<br>  --name ubuntu2204 \<br>  --gpus=&#x27;&quot;device=0,1&quot;&#x27; \<br>  --restart=always \<br>  swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/library/ubuntu:22.04<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœè¦ä½¿ç”¨å…¨éƒ¨NVIDIA GPU</span><br>docker run -itd \<br>  --name ubuntu2204 \<br>  --gpus all \<br>  --restart=always \<br>  swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/library/ubuntu:22.04<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>nvidia-docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>4âœ–8âœ–A800æœåŠ¡å™¨éƒ¨ç½²æ»¡è¡€ç‰ˆDeepSeek-R1-671Bæ­¥éª¤</title>
    <link href="/2025/03/14/4%E2%9C%968%E2%9C%96A800%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2%E6%BB%A1%E8%A1%80%E7%89%88DeepSeek-R1-671B%E6%AD%A5%E9%AA%A4/"/>
    <url>/2025/03/14/4%E2%9C%968%E2%9C%96A800%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2%E6%BB%A1%E8%A1%80%E7%89%88DeepSeek-R1-671B%E6%AD%A5%E9%AA%A4/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€æœåŠ¡å™¨åŠé…ç½®ä¿¡æ¯"><a href="#ä¸€ã€æœåŠ¡å™¨åŠé…ç½®ä¿¡æ¯" class="headerlink" title="ä¸€ã€æœåŠ¡å™¨åŠé…ç½®ä¿¡æ¯"></a>ä¸€ã€æœåŠ¡å™¨åŠé…ç½®ä¿¡æ¯</h1><h2 id="1-1-æœåŠ¡å™¨åˆ—è¡¨"><a href="#1-1-æœåŠ¡å™¨åˆ—è¡¨" class="headerlink" title="1.1 æœåŠ¡å™¨åˆ—è¡¨"></a>1.1 æœåŠ¡å™¨åˆ—è¡¨</h2><p>æ­¤æ¬¡ç”¨æ¥éƒ¨ç½²æ»¡è¡€ç‰ˆDeepSeek-R1-671Bï¼Œç”¨åˆ°4ä¸ªç‰©ç†æœåŠ¡å™¨ã€‚æ¯ä¸ªç‰©ç†æœåŠ¡å™¨ä¸Šæœ‰8ä¸ªNVIDIA A800ï¼Œç›¸å…³å…·ä½“ç¡¬ä»¶ä¿¡æ¯å¦‚ä¸‹ã€‚</p><table><thead><tr><th>ä¸»æœºå</th><th>IP</th><th>CPU</th><th>å†…å­˜</th><th>ç¡¬ç›˜</th><th>GPUæƒ…å†µ</th><th>IBç½‘å¡</th><th>ä¸‡å…†ç½‘å¡</th><th>å…¶ä»–ä¿¡æ¯</th></tr></thead><tbody><tr><td>deepseek1</td><td>10.119.165.139(ä¸‡å…†å†…ç½‘)<br />10.119.85.141(IBå†…ç½‘)</td><td>Intel 6348*2</td><td>64G DDR4*16</td><td>ï¼ˆ1ï¼‰960G SATA*<em>2ï¼›ï¼ˆ2ï¼‰3.84T U.2 NVMe</em>1</td><td>HGX A800ç³»ç»Ÿï¼ˆ8<em>NVIDIA A800 80GB SXM4 with 6</em>NVSwitchï¼‰*1</td><td>éœ€è¦</td><td>ï¼ˆ1ï¼‰10G åŒå…‰å£<em>1ï¼›ï¼ˆ2ï¼‰25G åŒå…‰å£ OCP3.0</em>1ï¼›ï¼ˆ3ï¼‰200G å•å…‰å£HDR*4ï¼›</td><td>ï¼ˆ1ï¼‰ç”µæºï¼š3500W PSU<em>4ï¼›ï¼ˆ2ï¼‰ç¡¬RAIDï¼šRAID LSI 9540-8iï¼›ï¼ˆ3ï¼‰å…¶ä»–ï¼šGPUä»“èƒŒæ¿</em>2ï¼›CPUä»“EXPèƒŒæ¿<em>1ï¼›riser</em>2ï¼›1.8M å›½æ ‡ç”µæºçº¿<em>4ï¼›æ‰˜è½¨</em>1</td></tr><tr><td>deepseek2</td><td>10.119.165.138(å†…ç½‘)<br />10.119.85.138(IBå†…ç½‘)</td><td>~</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>deepseek3</td><td>10.119.165.140(å†…ç½‘)<br />10.119.85.140(IBå†…ç½‘)</td><td>~</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>deepseek4</td><td>10.119.165.141(å†…ç½‘)<br />10.119.85.139(IBå†…ç½‘)</td><td>~</td><td></td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><p><img src="https://s2.loli.net/2025/02/26/Y96Gwv4AnultSVZ.png" alt="image-20250226103235878"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">10000M network</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">10.119.165.139 deepseek1</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">10.119.165.138 deepseek2</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">10.119.165.140 deepseek3</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">10.119.165.141 deepseek4</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">IB network</span><br>10.119.85.141 deepseek1<br>10.119.85.138 deepseek2<br>10.119.85.140 deepseek3<br>10.119.85.139 deepseek4<br></code></pre></td></tr></table></figure><p>ï¼ˆ1ï¼‰å½“å‰ï¼Œç‰©ç†æœåŠ¡å™¨çš„ç³»ç»Ÿç›˜ç”±ä¸¤ä¸ªSATAç›˜åš RAID1 æ„æˆï¼ŒæŒ‰ç…§ç›¸å…³èµ„æ–™è¯´æ˜ï¼Œå»ºè®®ä½¿ç”¨ä¸¤ä¸ª1Tå·¦å³çš„SSDåšRAID1ï¼Œå®‰è£…æ“ä½œç³»ç»Ÿ</p><p>ï¼ˆ2ï¼‰ç°åœ¨æ¨¡å‹æ–‡ä»¶æ˜¯å­˜æ”¾åœ¨nvmeç›˜çš„æŒ‚è½½ç›®å½•ä¸Š</p><p>ï¼ˆ3ï¼‰æœåŠ¡è®¿é—®ã€èŠ‚ç‚¹é—´ç½‘ç»œé€šä¿¡ï¼Œèƒ½ç”¨IBç½‘ç»œå°½é‡ç”¨IBç½‘ç»œ</p><p>ï¼ˆ4ï¼‰èŠ‚ç‚¹å†…8æ˜¾å¡ã€èŠ‚ç‚¹é—´æ˜¾å¡é€šä¿¡ï¼Œéœ€è¦é…ç½®å¥½NVLinkä¸NVSwitch</p><p>ï¼ˆ5ï¼‰å…¶å®ä¸Šè¡¨æ ¼ä¸­è¿˜æœ‰ä¸€äº›ä¸œè¥¿æ²¡æœ‰ç”¨åˆ°ï¼Œæ¯”å¦‚ä¸‡å…†ç½‘å¡ã€‚</p><p>ï¼ˆ6ï¼‰ä»¥ä¸‹deepseekç”¨æˆ·å…·æœ‰æ— å¯†sudoæƒé™ï¼Œå®é™…æ“ä½œæ—¶ä¹Ÿå¯ä½¿ç”¨rootç”¨æˆ·ï¼Œä½†è¿˜æ˜¯ä¸å»ºè®®ç›´æ¥ä½¿ç”¨rootç”¨æˆ·ã€‚</p><h2 id="1-2-ç›¸å…³è½¯ä»¶ä¿¡æ¯æ±‡æ€»"><a href="#1-2-ç›¸å…³è½¯ä»¶ä¿¡æ¯æ±‡æ€»" class="headerlink" title="1.2 ç›¸å…³è½¯ä»¶ä¿¡æ¯æ±‡æ€»"></a>1.2 ç›¸å…³è½¯ä»¶ä¿¡æ¯æ±‡æ€»</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs shell">ç‰©ç†æœåŠ¡å™¨æ“ä½œç³»ç»Ÿï¼šUbuntu 22.04.4 LTS-x86_64<br>Nvidia driver version: 550.90.07<br>CUDA runtime version: 12.1.105(nodeå®¹å™¨å†…)ã€V12.4.99(ç‰©ç†æœåŠ¡å™¨ä¸Š)<br>nvidia-fabricmanagerç‰ˆæœ¬ï¼š550.90.07<br>nvlinkï¼š3.0<br>nvswitchï¼š2.0<br><br>PyTorch version: 2.5.1+cu124<br>CUDA used to build PyTorch: 12.4<br>OS: Ubuntu 22.04.3 LTS (x86_64)<br>GCC version: (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0<br>CMake version: version 3.31.4<br>Libc version: glibc-2.35<br>Python version: 3.12.9 (main, Feb  5 2025, 08:49:00) [GCC 11.4.0] (64-bit runtime)<br>Python platform: Linux-5.15.0-113-generic-x86_64-with-glibc2.35<br>Is CUDA available: True<br><br>CUDA_MODULE_LOADING set to: LAZY<br>Is XNNPACK available: True<br>CPU: Intel(R) Xeon(R) Gold 6348 CPU @ 2.60GHz, 112æ ¸å¿ƒ<br>numpy==1.26.4<br>torch==2.5.1<br>torchaudio==2.5.1<br>torchvision==0.20.1<br>triton==3.1.0<br></code></pre></td></tr></table></figure><h1 id="äºŒã€å‡†å¤‡å·¥ä½œ"><a href="#äºŒã€å‡†å¤‡å·¥ä½œ" class="headerlink" title="äºŒã€å‡†å¤‡å·¥ä½œ"></a>äºŒã€å‡†å¤‡å·¥ä½œ</h1><p>ä»¥ä¸‹å‡†å¤‡å·¥ä½œåœ¨æ‰€æœ‰æœåŠ¡å™¨ä¸Šéƒ½è¦æ‰§è¡Œã€‚</p><h2 id="2-1-æ¨¡å‹æ–‡ä»¶å‡†å¤‡"><a href="#2-1-æ¨¡å‹æ–‡ä»¶å‡†å¤‡" class="headerlink" title="2.1 æ¨¡å‹æ–‡ä»¶å‡†å¤‡"></a>2.1 æ¨¡å‹æ–‡ä»¶å‡†å¤‡</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ·»åŠ ä¸»æœºåä¸ipæ˜ å°„æ¡ç›®</span><br>deepseek@deepseek1:~$ sudo vi /etc/hosts<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ·»åŠ å¦‚ä¸‹å†…å®¹</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">10000M network</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">10.119.165.139 deepseek1</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">10.119.165.138 deepseek2</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">10.119.165.140 deepseek3</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">10.119.165.141 deepseek4</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">IB network</span><br>10.119.85.141 deepseek1<br>10.119.85.138 deepseek2<br>10.119.85.140 deepseek3<br>10.119.85.139 deepseek4<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é…ç½®pythonåº“å®‰è£…æº</span><br>deepseek@deepseek1:~$ sudo mkdir ~/.pip<br>deepseek@deepseek1:~$ sudo vi ~/.pip/pip.conf <br>deepseek@deepseek1:~$ sudo cat ~/.pip/pip.conf <br>[global]<br>trusted-host = mirrors.aliyun.com<br>index-url = https://mirrors.aliyun.com/pypi/simple<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹è½½Anaconda3-2024.06-1-Linux-x86_64.shï¼Œå®‰è£…anaconda</span><br>deepseek@deepseek1:~/installPkgs$ wget --user-agent=â€œMozillaâ€ + https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/Anaconda3-2024.06-1-Linux-x86_64.sh<br>deepseek@deepseek1:~/installPkgs$ sudo bash Anaconda3-2024.06-1-Linux-x86_64.sh -p /home/deepseek/anaconda3<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##anacondaçš„å®‰è£…ç›®å½•æ˜¯/home/deepseek/anaconda3</span></span><br>...<br>You can undo this by running `conda init --reverse $SHELL`? [yes|no]<br>[no] &gt;&gt;&gt; yes<br>...<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åŠ è½½~/.bashrc</span><br>deepseek@deepseek1:~/installPkgs$ source ~/.bashrc<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹ç°æœ‰çš„condaç®¡ç†çš„æ‰€æœ‰è™šæ‹Ÿpythonç¯å¢ƒ</span><br>(base) deepseek@deepseek1:~/installPkgs$ conda env list<br><span class="hljs-meta prompt_"># </span><span class="language-bash">conda environments:</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash">base                  *  /home/deepseek/anaconda3</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å‡†å¤‡å¥½python3ç¯å¢ƒä¸pip3ï¼ˆä½¿ç”¨ä¸Šè¿°condaåˆ›å»ºè™šæ‹Ÿpython3ã€pip3ç¯å¢ƒï¼‰</span><br>(base) deepseek@deepseek1:~/installPkgs$ conda create -n self-llm python=3.12 <br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#æŸ¥çœ‹ç°æœ‰çš„condaç®¡ç†çš„æ‰€æœ‰è™šæ‹Ÿpythonç¯å¢ƒ</span></span><br>(base) deepseek@deepseek1:~/installPkgs$ conda env list<br><span class="hljs-meta prompt_"># </span><span class="language-bash">conda environments:</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash">self-llm                 /home/deepseek/.conda/envs/self-llm</span><br>base                  *  /home/deepseek/anaconda3<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ¿€æ´»self-llm è¿™ä¸ªè™šæ‹Ÿpythonç¯å¢ƒï¼Œå¹¶åœ¨å…¶ä¸­æ‰§è¡Œç›¸å…³å‘½ä»¤</span><br>(base) deepseek@deepseek1:~/installPkgs$ conda activate self-llm<br>(self-llm) deepseek@deepseek1:~/installPkgs$ <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è¯·å…ˆé€šè¿‡å¦‚ä¸‹å‘½ä»¤å®‰è£…ModelScope</span><br>(self-llm) deepseek@deepseek1:~/installPkgs$ pip install modelscope<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä»¥ä¸‹4ç§æ–¹æ³•ä¸‹è½½ä¸åŒçš„æ¨¡å‹æ–‡ä»¶ä¸ä½¿ç”¨ï¼Œæ–¹æ³•4éªŒè¯æˆåŠŸ</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨deepseek1æœåŠ¡å™¨ä¸Šä¸‹è½½å¥½æ¨¡å‹æ–‡ä»¶ï¼Œå…¶ä»–3å°æœåŠ¡å™¨æ— éœ€å†é€šè¿‡ç½‘ç»œä¸‹è½½æ¨¡å‹æ–‡ä»¶ï¼Œè€Œæ˜¯å°†æ¨¡å‹æ–‡ä»¶ä»æ­¤æœåŠ¡å™¨ä¼ è¾“ä¸Šå»å³å¯ï¼ˆé€Ÿåº¦åº”è¯¥å¿«äº›ï¼‰</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##æ–¹æ³•1ï¼ˆå·²ç»å¤±è´¥ï¼‰</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹è½½å®Œæ•´æ¨¡å‹repoã€‚åŠ å‚æ•°â€œ--local_dir ./â€å°±æ˜¯ä¿å­˜åˆ°å½“å‰ç›®å½•ï¼Œä¸åŠ å°±æ˜¯ä¿å­˜åˆ°/root/.cacheç›®å½•ä¸‹</span><br>(self-llm) deepseek@deepseek1:~/installPkgs$ modelscope download --model deepseek-ai/DeepSeek-R1<br>Downloading Model to directory: /home/deepseek/.cache/modelscope/hub/models/deepseek-ai/DeepSeek-R1<br>...<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹è½½å®Œæˆåï¼Œéè’¸é¦ã€æ»¡è¡€ç‰ˆDeepSeek-R1:671Bæ¨¡å‹æ–‡ä»¶æ€»å¤§å°å…±642G</span><br>(self-llm) deepseek@deepseek1:~/.cache/modelscope/hub/models/deepseek-ai/DeepSeek-R1$ du -sh ./      <br>642G    ./<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##å¤±è´¥åŸå› ï¼šDeepSeek-R1:671Bæ˜¯fp8 æ¨¡å‹ï¼Œéœ€è¦åœ¨æ”¯æŒfp8æ•°æ®ç±»å‹çš„GPUä¸Šè¿è¡Œï¼Œä½†NVIDIA A800ï¼ˆA800è·ŸA100è®¾è®¡ä¸ŠåŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å‡é…äº†ï¼‰ä¸æ”¯æŒfp8æ•°æ®ç±»å‹ã€‚DeepSeek-R1 æ˜¯ FP8 æƒé‡çš„ï¼ŒFP8 éœ€è¦cudaæ¶æ„ä¸ä½äº8.9ï¼ŒA800æ˜¯8.0ï¼Œæ‰€ä»¥éœ€è¦å°†FP8è½¬æ¢æˆBF16</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##æ–¹æ³•2ï¼ˆæœªéªŒè¯ï¼‰</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">DeepSeek-R1çš„BF16ç‰ˆæœ¬ï¼Œä½†æ˜¯GGUFæ–‡ä»¶ï¼šhttps://huggingface.co/unsloth/DeepSeek-R1-GGUF/tree/main/DeepSeek-R1-BF16</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ€»å¤§å°ä¸ºï¼š1341.32G</span><br>(self-llm) deepseek@deepseek1:~/installPkgs$ sudo parted /dev/nvme0n1 -s -- mklabel gpt mkpart DATA01 1 -1 <br>(self-llm) deepseek@deepseek1:~/installPkgs$ sudo mkfs.ext4 /dev/nvme0n1p1 <br>(self-llm) deepseek@deepseek1:~/installPkgs$ sudo mount /dev/nvme0n1p1 /mnt/<br>(self-llm) deepseek@deepseek1:~/installPkgs$ sudo tail -1 /etc/mtab<br>/dev/nvme0n1p1 /mnt ext4 rw,relatime,stripe=32 0 0<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†ä¸Šè¿°è¾“å‡ºå†…å®¹å†™å…¥/etc/fstabæ–‡ä»¶çš„æœ«å°¾</span><br>(self-llm) deepseek@deepseek1:~/installPkgs$ sudo vi /etc/fstab<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##ä¸‹è½½DeepSeek-R1æ¨¡å‹çš„BF16ç‰ˆæœ¬</span></span><br>(self-llm) deepseek@deepseek1:~/installPkgs$ sudo /home/deepseek/.conda/envs/self-llm/bin/modelscope download --model unsloth/DeepSeek-R1-GGUF --local_dir /mnt<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##ç›®å‰ï¼ŒvLLM ä»…æ”¯æŒåŠ è½½å•æ–‡ä»¶ GGUF æ¨¡å‹ã€‚å¦‚æœæ‚¨æœ‰å¤šæ–‡ä»¶çš„ GGUF æ¨¡å‹ï¼Œå¯ä»¥ä½¿ç”¨ gguf-split å·¥å…·å°†å…¶åˆå¹¶ä¸ºä¸€ä¸ªå•æ–‡ä»¶æ¨¡å‹ï¼ˆå‚è€ƒæ–‡æ¡£ï¼šhttps://vllm.hyper.ai/docs/quantization/gguf/ï¼‰</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##æ–¹æ³•3ï¼ˆå·²ç»å¤±è´¥ï¼‰</span></span><br>(self-llm) deepseek@deepseek1:~/installPkgs$ cd ~/code_repos/<br>(self-llm) deepseek@deepseek1:~/code_repos$ git clone https://github.com/deepseek-ai/DeepSeek-V3.git #æˆ–git clone https://gitee.com/sy-jiang/DeepSeek-V3.git<br>(self-llm) deepseek@deepseek1:~/code_repos$ cd DeepSeek-V3/<br>(self-llm) deepseek@deepseek1:~/code_repos$ sudo mkdir /mnt/DeepSeek-R1-bf16<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æƒé‡è½¬æ¢ï¼Œ DeepSeek-R1 æ˜¯ FP8 æƒé‡çš„ï¼ŒFP8 éœ€è¦cudaæ¶æ„ä¸ä½äº8.9ï¼ŒA800æ˜¯8.0ï¼Œæ‰€ä»¥éœ€è¦å°†FP8è½¬æ¢æˆBF16ã€‚è½¬æ¢æ–¹æ³•å¦‚ä¸‹ï¼š</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">python fp8_cast_bf16.py --input-fp8-hf-path /path/to/DeepSeek-R1 --output-bf16-hf-path /path/to/deepseek-R1-bf16</span><br>(self-llm) deepseek@deepseek1:~/code_repos$ pip install torch==2.5.1<br>(self-llm) deepseek@deepseek1:~/code_repos$ pip install safetensors=0.5.2 numpy==1.26.4 tqdm==4.67.1 <br>(self-llm) deepseek@deepseek1:~/code_repos/DeepSeek-V3$ cd inference/<br>(self-llm) deepseek@deepseek1:~/code_repos/DeepSeek-V3$ sudo /home/deepseek/.conda/envs/self-llm/bin/python fp8_cast_bf16.py --input-fp8-hf-path /home/deepseek/.cache/modelscope/hub/models/deepseek-ai/DeepSeek-R1/ --output-bf16-hf-path /mnt/DeepSeek-R1-fp8_cast_bf16/<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç»“æœè¡¨æ˜ï¼šè¿è¡Œè¿™ä¸ªfp8_cast_bf16.pyæ–‡ä»¶ï¼Œåº”è¯¥ä¹Ÿæ˜¯éœ€è¦CUDA <span class="hljs-built_in">arch</span> &gt;=8.9çš„NVIDIA GPUã€‚ç¬¦åˆè¿™ç§æ¡ä»¶çš„GPUæœ‰NVIDIA H100ï¼ˆå…·ä½“çœ‹é—®é¢˜2ï¼‰</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##æ–¹æ³•4ï¼ˆæˆåŠŸï¼‰</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">DeepSeek-R1çš„BF16ç‰ˆæœ¬ï¼Œæ˜¯.safetensorsæ–‡ä»¶ï¼Œåœ¨vllmä¸­ç›´æ¥å¯ç”¨ï¼šhttps://modelscope.cn/models/unsloth/DeepSeek-R1-BF16/files</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ€»å¤§å°ä¸ºï¼š1341.32Gå·¦å³</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ­¤æ—¶deepseek1æ­£åœ¨ä¸‹è½½æ–¹æ³•2ä¸­æ–‡ä»¶ï¼Œæ•…æ­¤æ–¹æ³•çš„å®æ–½å…ˆåœ¨deepseek2ä¸Šä¸‹è½½ç›¸å…³æ–‡ä»¶ï¼ˆä¸‹è½½è¿‡ç¨‹ä¸­å‘ç°ï¼Œdeepseek1ä¸Šçš„ä¸‹è½½è¿›ç¨‹å æ®å¤§é‡å¸¦å®½å½±å“deepseek2ä¸‹è½½æ–‡ä»¶ï¼Œæ•…å°†deepseek1ä¸Šçš„ä¸‹è½½è¿›ç¨‹æ€æ­»ï¼‰</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">/dev/nvme0n1  nvmeç¡¬ç›˜ï¼Œå¤§å°ä¸º3.5T</span><br>(self-llm) deepseek@deepseek2:~/installPkgs$ sudo parted /dev/nvme0n1 -s -- mklabel gpt mkpart DATA01 1 -1 <br>(self-llm) deepseek@deepseek2:~/installPkgs$ sudo mkfs.ext4 /dev/nvme0n1p1 <br>(self-llm) deepseek@deepseek2:~/installPkgs$ sudo mount /dev/nvme0n1p1 /mnt/<br>(self-llm) deepseek@deepseek2:~/installPkgs$ sudo tail -1 /etc/mtab<br>/dev/nvme0n1p1 /mnt ext4 rw,relatime,stripe=32 0 0<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†ä¸Šè¿°è¾“å‡ºå†…å®¹å†™å…¥/etc/fstabæ–‡ä»¶çš„æœ«å°¾</span><br>(self-llm) deepseek@deepseek2:~/installPkgs$ sudo vi /etc/fstab<br>(self-llm) deepseek@deepseek2:~/installPkgs$ sudo rm -rf /mnt/lost+found<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##ä¸‹è½½DeepSeek-R1æ¨¡å‹çš„BF16ç‰ˆæœ¬</span></span><br>(self-llm) deepseek@deepseek2:~/installPkgs$ sudo mkdir -p hub/models/unsloth/DeepSeek-R1-BF16<br>(self-llm) deepseek@deepseek2:~/installPkgs$ sudo /home/deepseek/anaconda3/envs/self-llm/bin/modelscope download --model unsloth/DeepSeek-R1-BF16 --local_dir /mnt/hub/models/unsloth/DeepSeek-R1-BF16<br>Downloading Model to directory: /mnt/hub/models/unsloth/DeepSeek-R1-BF16<br>Downloading [config.json]: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1.57k/1.57k [00:00&lt;00:00, 6.75kB/s]<br>...<br></code></pre></td></tr></table></figure><h3 id="2-1-1-æŠ¥é”™ä¸å¤„ç†"><a href="#2-1-1-æŠ¥é”™ä¸å¤„ç†" class="headerlink" title="2.1.1 æŠ¥é”™ä¸å¤„ç†"></a>2.1.1 æŠ¥é”™ä¸å¤„ç†</h3><h4 id="é—®é¢˜1-æ–¹æ³•3-æ‰§è¡Œâ€python-fp8-cast-bf16-pyâ€æç¤ºâ€œ-usr-bin-ld-cannot-find-lcuda-No-such-file-or-directoryâ€"><a href="#é—®é¢˜1-æ–¹æ³•3-æ‰§è¡Œâ€python-fp8-cast-bf16-pyâ€æç¤ºâ€œ-usr-bin-ld-cannot-find-lcuda-No-such-file-or-directoryâ€" class="headerlink" title="é—®é¢˜1-æ–¹æ³•3-æ‰§è¡Œâ€python fp8_cast_bf16.pyâ€æç¤ºâ€œ&#x2F;usr&#x2F;bin&#x2F;ld: cannot find -lcuda: No such file or directoryâ€"></a>é—®é¢˜1-æ–¹æ³•3-æ‰§è¡Œâ€python fp8_cast_bf16.pyâ€æç¤ºâ€œ&#x2F;usr&#x2F;bin&#x2F;ld: cannot find -lcuda: No such file or directoryâ€</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs shell">(self-llm) deepseek@deepseek1:~/code_repos/DeepSeek-V3/inference$ sudo /home/deepseek/.conda/envs/self-llm/bin/python fp8_cast_bf16.py --input-fp8-hf-path /home/deepseek/.cache/modelscope/hub/models/deepseek-ai/DeepSeek-R1/ --output-bf16-hf-path /mnt/DeepSeek-R1-fp8_cast_bf16/<br><span class="hljs-meta prompt_">  0%</span><span class="language-bash">|                                                                                                                                                                                   | 0/163 [00:00&lt;?, ?it/s]/usr/bin/ld: cannot find -lcuda: No such file or directory</span><br>collect2: error: ld returned 1 exit status<br><span class="hljs-meta prompt_">  0%</span><span class="language-bash">|                                                                                                                                                                                   | 0/163 [00:01&lt;?, ?it/s]</span><br>Traceback (most recent call last):<br>  File &quot;/home/deepseek/code_repos/DeepSeek-V3/inference/fp8_cast_bf16.py&quot;, line 111, in &lt;module&gt;<br>    main(args.input_fp8_hf_path, args.output_bf16_hf_path)<br>  File &quot;/home/deepseek/code_repos/DeepSeek-V3/inference/fp8_cast_bf16.py&quot;, line 80, in main<br>    new_state_dict[weight_name] = weight_dequant(weight, scale_inv)<br>                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>  File &quot;/home/deepseek/code_repos/DeepSeek-V3/inference/kernel.py&quot;, line 104, in weight_dequant<br>    weight_dequant_kernel[grid](x, s, y, M, N, BLOCK_SIZE=block_size)<br>  File &quot;/home/deepseek/.conda/envs/self-llm/lib/python3.12/site-packages/triton/runtime/jit.py&quot;, line 345, in &lt;lambda&gt;<br>    return lambda *args, **kwargs: self.run(grid=grid, warmup=False, *args, **kwargs)<br>                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>  File &quot;/home/deepseek/.conda/envs/self-llm/lib/python3.12/site-packages/triton/runtime/jit.py&quot;, line 607, in run<br>    device = driver.active.get_current_device()<br>             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>  File &quot;/home/deepseek/.conda/envs/self-llm/lib/python3.12/site-packages/triton/runtime/driver.py&quot;, line 23, in __getattr__<br>    self._initialize_obj()<br>  File &quot;/home/deepseek/.conda/envs/self-llm/lib/python3.12/site-packages/triton/runtime/driver.py&quot;, line 20, in _initialize_obj<br>    self._obj = self._init_fn()<br>                ^^^^^^^^^^^^^^^<br>  File &quot;/home/deepseek/.conda/envs/self-llm/lib/python3.12/site-packages/triton/runtime/driver.py&quot;, line 9, in _create_driver<br>    return actives[0]()<br>           ^^^^^^^^^^^^<br>  File &quot;/home/deepseek/.conda/envs/self-llm/lib/python3.12/site-packages/triton/backends/nvidia/driver.py&quot;, line 371, in __init__<br>    self.utils = CudaUtils()  # TODO: make static<br>                 ^^^^^^^^^^^<br>  File &quot;/home/deepseek/.conda/envs/self-llm/lib/python3.12/site-packages/triton/backends/nvidia/driver.py&quot;, line 80, in __init__<br>    mod = compile_module_from_src(Path(os.path.join(dirname, &quot;driver.c&quot;)).read_text(), &quot;cuda_utils&quot;)<br>          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>  File &quot;/home/deepseek/.conda/envs/self-llm/lib/python3.12/site-packages/triton/backends/nvidia/driver.py&quot;, line 57, in compile_module_from_src<br>    so = _build(name, src_path, tmpdir, library_dirs(), include_dir, libraries)<br>         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>  File &quot;/home/deepseek/.conda/envs/self-llm/lib/python3.12/site-packages/triton/runtime/build.py&quot;, line 48, in _build<br>    ret = subprocess.check_call(cc_cmd)<br>          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>  File &quot;/home/deepseek/.conda/envs/self-llm/lib/python3.12/subprocess.py&quot;, line 415, in check_call<br>    raise CalledProcessError(retcode, cmd)<br>subprocess.CalledProcessError: Command &#x27;[&#x27;/usr/bin/gcc&#x27;, &#x27;/tmp/tmp2u69cogx/main.c&#x27;, &#x27;-O3&#x27;, &#x27;-shared&#x27;, &#x27;-fPIC&#x27;, &#x27;-o&#x27;, &#x27;/tmp/tmp2u69cogx/cuda_utils.cpython-312-x86_64-linux-gnu.so&#x27;, &#x27;-lcuda&#x27;, &#x27;-L/home/deepseek/.conda/envs/self-llm/lib/python3.12/site-packages/triton/backends/nvidia/lib&#x27;, &#x27;-L/lib/x86_64-linux-gnu&#x27;, &#x27;-I/home/deepseek/.conda/envs/self-llm/lib/python3.12/site-packages/triton/backends/nvidia/include&#x27;, &#x27;-I/tmp/tmp2u69cogx&#x27;, &#x27;-I/home/deepseek/.conda/envs/self-llm/include/python3.12&#x27;]&#x27; returned non-zero exit status 1.<br></code></pre></td></tr></table></figure><p>è§£å†³åŠæ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å‚è€ƒhttps://developer.aliyun.com/article/377598</span><br>cd /home/deepseek/.conda/envs/self-llm/lib<br>ln -sv /usr/local/cuda-12.4/targets/x86_64-linux/lib/stubs/libcuda.so libcuda.so<br></code></pre></td></tr></table></figure><h4 id="é—®é¢˜2-æ–¹æ³•3-æ‰§è¡Œâ€python-fp8-cast-bf16-pyâ€æç¤ºâ€œAssertionError-fp8e4nv-data-type-is-not-supported-on-CUDA-arch-89â€"><a href="#é—®é¢˜2-æ–¹æ³•3-æ‰§è¡Œâ€python-fp8-cast-bf16-pyâ€æç¤ºâ€œAssertionError-fp8e4nv-data-type-is-not-supported-on-CUDA-arch-89â€" class="headerlink" title="é—®é¢˜2-æ–¹æ³•3-æ‰§è¡Œâ€python fp8_cast_bf16.pyâ€æç¤ºâ€œAssertionError: fp8e4nv data type is not supported on CUDA arch &lt; 89â€"></a>é—®é¢˜2-æ–¹æ³•3-æ‰§è¡Œâ€python fp8_cast_bf16.pyâ€æç¤ºâ€œAssertionError: fp8e4nv data type is not supported on CUDA arch &lt; 89â€</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">è§£å†³å®Œä¸Šè¿°é—®é¢˜1åï¼Œåˆå‡ºç°å¦‚ä¸‹é—®é¢˜2</span><br>(self-llm) deepseek@deepseek1:~/code_repos/DeepSeek-V3/inference$ sudo /home/deepseek/.conda/envs/self-llm/bin/python fp8_cast_bf16.py --input-fp8-hf-path /home/deepseek/.cache/modelscope/hub/models/deepseek-ai/DeepSeek-R1/ --output-bf16-hf-path /mnt/DeepSeek-R1-fp8_cast_bf16/<br><span class="hljs-meta prompt_">  0%</span><span class="language-bash">|                                                                                                                                                                                   | 0/163 [00:01&lt;?, ?it/s]</span><br>Traceback (most recent call last):<br>  File &quot;/home/deepseek/.conda/envs/self-llm/lib/python3.12/site-packages/triton/language/core.py&quot;, line 35, in wrapper<br>    return fn(*args, **kwargs)<br>           ^^^^^^^^^^^^^^^^^^^<br>  File &quot;/home/deepseek/.conda/envs/self-llm/lib/python3.12/site-packages/triton/language/core.py&quot;, line 993, in to<br>    return semantic.cast(self, dtype, _builder, fp_downcast_rounding)<br>           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>  File &quot;/home/deepseek/.conda/envs/self-llm/lib/python3.12/site-packages/triton/language/semantic.py&quot;, line 759, in cast<br>    assert builder.options.allow_fp8e4nv, &quot;fp8e4nv data type is not supported on CUDA arch &lt; 89&quot;<br>           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>AssertionError: fp8e4nv data type is not supported on CUDA arch &lt; 89<br><br>The above exception was the direct cause of the following exception:<br><br>Traceback (most recent call last):<br>  File &quot;/home/deepseek/code_repos/DeepSeek-V3/inference/fp8_cast_bf16.py&quot;, line 111, in &lt;module&gt;<br>    main(args.input_fp8_hf_path, args.output_bf16_hf_path)<br>  File &quot;/home/deepseek/code_repos/DeepSeek-V3/inference/fp8_cast_bf16.py&quot;, line 80, in main<br>    new_state_dict[weight_name] = weight_dequant(weight, scale_inv)<br>                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>  File &quot;/home/deepseek/code_repos/DeepSeek-V3/inference/kernel.py&quot;, line 104, in weight_dequant<br>    weight_dequant_kernel[grid](x, s, y, M, N, BLOCK_SIZE=block_size)<br>  File &quot;/home/deepseek/.conda/envs/self-llm/lib/python3.12/site-packages/triton/runtime/jit.py&quot;, line 345, in &lt;lambda&gt;<br>    return lambda *args, **kwargs: self.run(grid=grid, warmup=False, *args, **kwargs)<br>                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>  File &quot;/home/deepseek/.conda/envs/self-llm/lib/python3.12/site-packages/triton/runtime/jit.py&quot;, line 662, in run<br>    kernel = self.compile(<br>             ^^^^^^^^^^^^^<br>  File &quot;/home/deepseek/.conda/envs/self-llm/lib/python3.12/site-packages/triton/compiler/compiler.py&quot;, line 276, in compile<br>    module = src.make_ir(options, codegen_fns, context)<br>             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>  File &quot;/home/deepseek/.conda/envs/self-llm/lib/python3.12/site-packages/triton/compiler/compiler.py&quot;, line 113, in make_ir<br>    return ast_to_ttir(self.fn, self, context=context, options=options, codegen_fns=codegen_fns)<br>           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>triton.compiler.errors.CompilationError: at 23:8:<br><br>    Returns:<br>        None<br>    &quot;&quot;&quot;<br>    pid_m = tl.program_id(axis=0)<br>    pid_n = tl.program_id(axis=1)<br>    n = tl.cdiv(N, BLOCK_SIZE)<br>    offs_m = pid_m * BLOCK_SIZE + tl.arange(0, BLOCK_SIZE)<br>    offs_n = pid_n * BLOCK_SIZE + tl.arange(0, BLOCK_SIZE)<br>    offs = offs_m[:, None] * N + offs_n[None, :]<br>    mask = (offs_m[:, None] &lt; M) &amp; (offs_n[None, :] &lt; N)<br>    x = tl.load(x_ptr + offs, mask=mask).to(tl.float32)<br>        ^<br></code></pre></td></tr></table></figure><p>åˆ†æä¸è§£å†³åŠæ³•ï¼š</p><p>è¿è¡Œè¿™ä¸ªfp8_cast_bf16.pyæ–‡ä»¶ï¼Œåº”è¯¥ä¹Ÿæ˜¯éœ€è¦CUDA arch &gt;&#x3D;8.9çš„NVIDIA GPUã€‚ç¬¦åˆè¿™ç§æ¡ä»¶çš„GPUæœ‰NVIDIA H100ã€‚æ‰€ä»¥å¦‚æœæ²¡æœ‰NVIDIA H100ï¼Œè¿™ç§æ–¹æ³•ä¸å¯è¡Œ</p><h2 id="2-2-æŸ¥çœ‹æœåŠ¡å™¨-æ˜¾å¡"><a href="#2-2-æŸ¥çœ‹æœåŠ¡å™¨-æ˜¾å¡" class="headerlink" title="2.2 æŸ¥çœ‹æœåŠ¡å™¨&#x2F;æ˜¾å¡"></a>2.2 æŸ¥çœ‹æœåŠ¡å™¨&#x2F;æ˜¾å¡</h2><p>4ä¸ªç‰©ç†æœåŠ¡å™¨ï¼Œæ¯ä¸ªç‰©ç†æœåŠ¡å™¨ä¸Šçš„ç£ç›˜ä¿¡æ¯å¦‚ä¸‹ã€‚ç³»ç»Ÿç›˜æ˜¯893Gå·¦å³ï¼Œå…¶ä½™è¿˜æœ‰6å—893G SATAç›˜ã€ä¸€å—3.5Tçš„nvmeç›˜</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell">deepseek@deepseek1:~$ lsblk <br>NAME    MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS<br>loop0     7:0    0  63.9M  1 loop /snap/core20/2318<br>loop1     7:1    0    87M  1 loop /snap/lxd/28373<br>loop2     7:2    0  38.8M  1 loop /snap/snapd/21759<br>loop3     7:3    0  44.4M  1 loop /snap/snapd/23545<br>loop4     7:4    0  63.7M  1 loop /snap/core20/2496<br>loop5     7:5    0  89.4M  1 loop /snap/lxd/31333<br>sda       8:0    0 893.8G  0 disk <br>sdb       8:16   0 893.8G  0 disk <br>â”œâ”€sdb1    8:17   0   550M  0 part /boot/efi<br>â”œâ”€sdb2    8:18   0     8M  0 part <br>â”œâ”€sdb3    8:19   0 893.1G  0 part /<br>â””â”€sdb4    8:20   0    65M  0 part <br>sdc       8:32   0 893.8G  0 disk <br>sdd       8:48   0 893.8G  0 disk <br>sde       8:64   0 893.8G  0 disk <br>sdf       8:80   0 893.8G  0 disk <br>sdg       8:96   0 893.8G  0 disk <br>nvme0n1 259:0    0   3.5T  0 disk <br></code></pre></td></tr></table></figure><p>æ¯ä¸ªç‰©ç†æœåŠ¡å™¨ä¸Šæœ‰8ä¸ªNVIDIA A100-SXM4-80GB ï¼ŒGPUå‹å·ã€é©±åŠ¨ç‰ˆæœ¬ã€ CUDAç‰ˆæœ¬ä¿¡æ¯å¦‚ä¸‹ã€‚ </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs shell">deepseek@deepseek1:~$ nvidia-smi <br>Fri Feb 21 09:25:35 2025       <br>+-----------------------------------------------------------------------------------------+<br>| NVIDIA-SMI 550.90.07              Driver Version: 550.90.07      CUDA Version: 12.4     |<br>|-----------------------------------------+------------------------+----------------------+<br>| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |<br>| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |<br>|                                         |                        |               MIG M. |<br>|=========================================+========================+======================|<br>|   0  NVIDIA A800-SXM4-80GB          On  |   00000000:3D:00.0 Off |                    0 |<br>| N/A   33C    P0             61W /  400W |       1MiB /  81920MiB |      0%      Default |<br>|                                         |                        |             Disabled |<br>+-----------------------------------------+------------------------+----------------------+<br>|   1  NVIDIA A800-SXM4-80GB          On  |   00000000:42:00.0 Off |                    0 |<br>| N/A   29C    P0             58W /  400W |       1MiB /  81920MiB |      0%      Default |<br>|                                         |                        |             Disabled |<br>+-----------------------------------------+------------------------+----------------------+<br>|   2  NVIDIA A800-SXM4-80GB          On  |   00000000:61:00.0 Off |                    0 |<br>| N/A   30C    P0             61W /  400W |       1MiB /  81920MiB |      0%      Default |<br>|                                         |                        |             Disabled |<br>+-----------------------------------------+------------------------+----------------------+<br>|   3  NVIDIA A800-SXM4-80GB          On  |   00000000:67:00.0 Off |                    0 |<br>| N/A   33C    P0             64W /  400W |       1MiB /  81920MiB |      0%      Default |<br>|                                         |                        |             Disabled |<br>+-----------------------------------------+------------------------+----------------------+<br>|   4  NVIDIA A800-SXM4-80GB          On  |   00000000:AD:00.0 Off |                    0 |<br>| N/A   32C    P0             57W /  400W |       1MiB /  81920MiB |      0%      Default |<br>|                                         |                        |             Disabled |<br>+-----------------------------------------+------------------------+----------------------+<br>|   5  NVIDIA A800-SXM4-80GB          On  |   00000000:B1:00.0 Off |                    0 |<br>| N/A   29C    P0             61W /  400W |       1MiB /  81920MiB |      0%      Default |<br>|                                         |                        |             Disabled |<br>+-----------------------------------------+------------------------+----------------------+<br>|   6  NVIDIA A800-SXM4-80GB          On  |   00000000:D0:00.0 Off |                    0 |<br>| N/A   30C    P0             62W /  400W |       1MiB /  81920MiB |      0%      Default |<br>|                                         |                        |             Disabled |<br>+-----------------------------------------+------------------------+----------------------+<br>|   7  NVIDIA A800-SXM4-80GB          On  |   00000000:D3:00.0 Off |                    0 |<br>| N/A   32C    P0             60W /  400W |       1MiB /  81920MiB |      0%      Default |<br>|                                         |                        |             Disabled |<br>+-----------------------------------------+------------------------+----------------------+<br>                                                                                         <br>+-----------------------------------------------------------------------------------------+<br>| Processes:                                                                              |<br>|  GPU   GI   CI        PID   Type   Process name                              GPU Memory |<br>|        ID   ID                                                               Usage      |<br>|=========================================================================================|<br>|  No running processes found                                                             |<br>+-----------------------------------------------------------------------------------------+<br></code></pre></td></tr></table></figure><p>æ˜¾å¡é©±åŠ¨ã€cudaã€ä»¥åŠnvidia-fabricmanagerä¸‰è€…ç‰ˆæœ¬ä¸€å®šè¦ç›¸äº’åŒ¹é…ã€‚</p><p>ç¬”è€…æ˜¾å¡é©±åŠ¨ã€cudaã€nvidia-fabricmanagerç‰ˆæœ¬ä¿¡æ¯åˆ†åˆ«æ˜¯ï¼š550.90.07ã€V12.4.99ã€550.90.07 ã€‚</p><h2 id="2-3-å®‰è£…cuda"><a href="#2-3-å®‰è£…cuda" class="headerlink" title="2.3 å®‰è£…cuda"></a>2.3 å®‰è£…cuda</h2><p>Cudaå®‰è£…å¯å‚è€ƒNVIDIAå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.nvidia.com/cuda/cuda-installation-guide-linux/#ubuntu">cuda-installation-guide-linux</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æœåŠ¡å™¨æ‹¿åˆ°æ‰‹æ—¶ï¼Œå‘ç°å·²ç»å®‰è£…äº†Cuda11.5.119</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##å¦‚æœè¦ä½¿ç”¨aptå®‰è£…nvccï¼ˆæ­¤æ–¹å¼åœ¨Ubuntu22.04LTSä¸Šå®‰è£…çš„æ˜¯Cuda11.5.119ï¼‰ï¼šsudo apt install nvidia-cuda-toolkit</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹ç°æœ‰nvccç‰ˆæœ¬</span><br>deepseek@deepseek1:~/installPkgs$ nvcc -V<br>nvcc: NVIDIA (R) Cuda compiler driver<br>Copyright (c) 2005-2021 NVIDIA Corporation<br>Built on Thu_Nov_18_09:45:30_PST_2021<br>Cuda compilation tools, release 11.5, V11.5.119<br>Build cuda_11.5.r11.5/compiler.30672275_0<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##å¸è½½ç°æœ‰çš„Cuda11.5.119ï¼š</span></span><br>deepseek@deepseek1:~/installPkgs$ sudo apt remove nvidia-cuda-toolkit<br></code></pre></td></tr></table></figure><p>æˆ‘æƒ³æ”¹æˆä½¿ç”¨Cuda12.4ã€‚è®¿é—®<a href="https://developer.nvidia.com/cuda-12-4-0-download-archive">NVIDIAå®˜ç½‘cudaå®‰è£…æ–‡ä»¶ä¸‹è½½ç½‘é¡µ</a> ï¼Œä¾æ¬¡é€‰æ‹©å¦‚ä¸‹é€‰é¡¹æ‰¾åˆ°ä¸‹è½½ä¸å®‰è£…å‘½ä»¤ï¼š</p><p><img src="https://s2.loli.net/2025/02/21/iv6oBq75Rr8EzDO.png" alt="image-20250221172033572"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹è½½å®‰è£…æ–‡ä»¶</span><br>(self-llm) deepseek@deepseek1:~/installPkgs$ wget https://developer.download.nvidia.com/compute/cuda/12.4.0/local_installers/cuda_12.4.0_550.54.14_linux.run<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰§è¡Œå®‰è£…</span><br>(self-llm) deepseek@deepseek1:~/installPkgs$ sudo sh cuda_12.4.0_550.54.14_linux.run<br><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨å¼¹å‡ºå¯¹è¯ä¸­è¾“å…¥â€œacceptâ€æ¥å—æ¡æ¬¾ï¼Œç„¶åå¦‚ä¸‹é€‰æ‹©</span><br></code></pre></td></tr></table></figure><img src="https://s2.loli.net/2025/02/21/i8vKNVPkExZjD65.png" alt="image-20250221173309528" style="zoom:50%;" /><p><img src="https://s2.loli.net/2025/02/22/s8wCKUVEL2Sphna.png" alt="image-20250222162736130"></p><p>å®‰è£…è¿›ç¨‹å®Œæˆåï¼Œè¾“å‡ºå¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell">===========<br>= Summary =<br>===========<br><br>Driver:   Not Selected<br>Toolkit:  Installed in /usr/local/cuda-12.4/<br><br>Please make sure that<br> -   PATH includes /usr/local/cuda-12.4/bin<br> -   LD_LIBRARY_PATH includes /usr/local/cuda-12.4/lib64, or, add /usr/local/cuda-12.4/lib64 to /etc/ld.so.conf and run ldconfig as root<br><br>To uninstall the CUDA Toolkit, run cuda-uninstaller in /usr/local/cuda-12.4/bin<br>***WARNING: Incomplete installation! This installation did not install the CUDA Driver. A driver of version at least 550.00 is required for CUDA 12.4 functionality to work.<br>To install the driver using this installer, run the following command, replacing &lt;CudaInstaller&gt; with the name of this run file:<br>    sudo &lt;CudaInstaller&gt;.run --silent --driver<br><br>Logfile is /var/log/cuda-installer.log<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å‘ç°ç³»ç»Ÿå·²ç»åˆ›å»ºè½¯é“¾æ¥/usr/local/cudaï¼ŒæŒ‡å‘/usr/local/cuda-12.4/ã€‚åç»­ä½¿ç”¨æ­¤è½¯é“¾æ¥</span><br>(self-llm) deepseek@deepseek1:~/installPkgs$ ls -al /usr/local/cuda<br>lrwxrwxrwx 1 root root 21 Feb 21 17:55 /usr/local/cuda -&gt; /usr/local/cuda-12.4/<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŒ‰ç…§æç¤ºä¿®æ”¹ç³»ç»Ÿç¯å¢ƒå˜é‡PATHã€LD_LIBRARY_PATH</span><br>(self-llm) deepseek@deepseek1:~/installPkgs$ sudo vi /etc/profile<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##åœ¨æœ€åæ·»åŠ å¦‚ä¸‹å†…å®¹</span></span><br>export PATH=$PATH:/usr/local/cuda/bin/<br>export LD_LIBRARY_PATH=/usr/local/cuda/lib64/<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é‡æ–°æ‰“ä¸€ä¸ªç»ˆç«¯ä¼šè¯çª—å£æˆ–é‡æ–°åŠ è½½ä¸Šè¿°æ–‡ä»¶ä»¥å¯ç”¨ä¸Šè¿°ä¸¤ä¸ªä¿®æ”¹æˆ–æ·»åŠ çš„ç³»ç»Ÿç¯å¢ƒå˜é‡</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é‡æ–°åŠ è½½ä¸Šè¿°æ–‡ä»¶çš„æ–¹æ³•ï¼š<span class="hljs-built_in">source</span> /etc/profile</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä»¥ä¸‹ä»¥é‡æ–°æ‰“ä¸€ä¸ªç»ˆç«¯ä¼šè¯çª—å£ä¸ºä¾‹ç»§ç»­åç»­æ“ä½œ</span><br>(base) deepseek@deepseek1:~$ conda activate self-llm<br>(self-llm) deepseek@deepseek1:~$ echo $PATH<br>/home/deepseek/anaconda3/envs/self-llm/bin:/home/deepseek/anaconda3/condabin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/usr/local/cuda/bin<br>(self-llm) deepseek@deepseek1:~$ echo $LD_LIBRARY_PATH  <br>/usr/local/cuda/lib64/<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯ä»¥çœ‹åˆ°å½“å‰ä½¿ç”¨çš„Cudaç‰ˆæœ¬å·²ç»æ˜¯V12.4.99</span><br>(self-llm) deepseek@deepseek1:~$ nvcc -V<br>nvcc: NVIDIA (R) Cuda compiler driver<br>Copyright (c) 2005-2024 NVIDIA Corporation<br>Built on Tue_Feb_27_16:19:38_PST_2024<br>Cuda compilation tools, release 12.4, V12.4.99<br>Build cuda_12.4.r12.4/compiler.33961263_0<br>(self-llm) deepseek@deepseek1:~$ <br></code></pre></td></tr></table></figure><h2 id="2-4-å•æœºå¤šGPUå¡é—´äº’è”NVlink"><a href="#2-4-å•æœºå¤šGPUå¡é—´äº’è”NVlink" class="headerlink" title="2.4 å•æœºå¤šGPUå¡é—´äº’è”NVlink"></a>2.4 å•æœºå¤šGPUå¡é—´äº’è”NVlink</h2><p>å•æœºä¸Šçš„8ä¸ªNVIDIA A800-SXM4-80GBä¹‹é—´ä½¿ç”¨NVLinkè¿›è¡Œäº†è¿æ¥ã€‚ä¸NVIDIA A800æ‰€ä½¿ç”¨çš„Ampereæ¶æ„ç›¸é€‚é…çš„ï¼Œåœ¨NVIDIA A800ä½¿ç”¨NVLinkç‰ˆæœ¬æ˜¯NVLink3.0ï¼ŒNvSwitchç‰ˆæœ¬æ˜¯NvSwitch 3.0ã€‚</p><p>NVLink3.0æœ‰12æ¡Linkæ¥å£ï¼Œæ¯ä¸ªLinkæ¥å£æœ‰8ä¸ªlaneï¼ŒNVLink3.0çš„æ¯ä¸ªLinkæ¥å£å•å‘é€šä¿¡é€Ÿåº¦æ˜¯25GB&#x2F;sï¼Œæ‰€ä»¥æ¯ä¸ªNVIDIA A800ä½¿ç”¨NVLink3.0æ—¶ï¼Œå•å‘å®½å¸¦æ˜¯ 25GB&#x2F;s * 12 &#x3D; 300GB&#x2F;sï¼ŒåŒå‘å®½å¸¦åœ¨å•å‘å®½å¸¦çš„åŸºç¡€ä¸Šä¹˜ä»¥2å³ä¸º600GB&#x2F;sã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs shell">deepseek@deepseek1:~$ nvidia-smi nvlink --status<br>GPU 0: NVIDIA A800-SXM4-80GB (UUID: GPU-f275597c-05e4-f7e8-35bc-a3ab26194262)<br>         Link 0: 25 GB/s<br>         Link 1: 25 GB/s<br>         Link 2: 25 GB/s<br>         Link 3: 25 GB/s<br>         Link 4: 25 GB/s<br>         Link 5: 25 GB/s<br>         Link 6: 25 GB/s<br>         Link 7: 25 GB/s<br>GPU 1: NVIDIA A800-SXM4-80GB (UUID: GPU-56afa4fb-5618-6b47-7861-51c811bb87d8)<br>         Link 0: 25 GB/s<br>         Link 1: 25 GB/s<br>         Link 2: 25 GB/s<br>         Link 3: 25 GB/s<br>         Link 4: 25 GB/s<br>         Link 5: 25 GB/s<br>         Link 6: 25 GB/s<br>         Link 7: 25 GB/s<br>GPU 2: NVIDIA A800-SXM4-80GB (UUID: GPU-9039f623-9c6f-bc1a-f7d4-fd706a7cd7f5)<br>         Link 0: 25 GB/s<br>         Link 1: 25 GB/s<br>         Link 2: 25 GB/s<br>         Link 3: 25 GB/s<br>         Link 4: 25 GB/s<br>         Link 5: 25 GB/s<br>         Link 6: 25 GB/s<br>         Link 7: 25 GB/s<br>GPU 3: NVIDIA A800-SXM4-80GB (UUID: GPU-3029201c-2230-e6d4-290b-267c7c8adb03)<br>         Link 0: 25 GB/s<br>         Link 1: 25 GB/s<br>         Link 2: 25 GB/s<br>         Link 3: 25 GB/s<br>         Link 4: 25 GB/s<br>         Link 5: 25 GB/s<br>         Link 6: 25 GB/s<br>         Link 7: 25 GB/s<br>GPU 4: NVIDIA A800-SXM4-80GB (UUID: GPU-54d02ccd-6b42-8ec6-1b2a-624974742a62)<br>         Link 0: 25 GB/s<br>         Link 1: 25 GB/s<br>         Link 2: 25 GB/s<br>         Link 3: 25 GB/s<br>         Link 4: 25 GB/s<br>         Link 5: 25 GB/s<br>         Link 6: 25 GB/s<br>         Link 7: 25 GB/s<br>GPU 5: NVIDIA A800-SXM4-80GB (UUID: GPU-13254428-498a-5ec1-5dd5-d2c46dd29c36)<br>         Link 0: 25 GB/s<br>         Link 1: 25 GB/s<br>         Link 2: 25 GB/s<br>         Link 3: 25 GB/s<br>         Link 4: 25 GB/s<br>         Link 5: 25 GB/s<br>         Link 6: 25 GB/s<br>         Link 7: 25 GB/s<br>GPU 6: NVIDIA A800-SXM4-80GB (UUID: GPU-5442c93d-d690-3603-f0c3-c0592cf3797c)<br>         Link 0: 25 GB/s<br>         Link 1: 25 GB/s<br>         Link 2: 25 GB/s<br>         Link 3: 25 GB/s<br>         Link 4: 25 GB/s<br>         Link 5: 25 GB/s<br>         Link 6: 25 GB/s<br>         Link 7: 25 GB/s<br>GPU 7: NVIDIA A800-SXM4-80GB (UUID: GPU-bfe7f980-f583-3778-9779-85c7ebbb9432)<br>         Link 0: 25 GB/s<br>         Link 1: 25 GB/s<br>         Link 2: 25 GB/s<br>         Link 3: 25 GB/s<br>         Link 4: 25 GB/s<br>         Link 5: 25 GB/s<br>         Link 6: 25 GB/s<br>         Link 7: 25 GB/s<br></code></pre></td></tr></table></figure><h2 id="2-5-nvidia-fabricmanagerå®‰è£…ä¸ç¡®è®¤"><a href="#2-5-nvidia-fabricmanagerå®‰è£…ä¸ç¡®è®¤" class="headerlink" title="2.5 nvidia-fabricmanagerå®‰è£…ä¸ç¡®è®¤"></a>2.5 nvidia-fabricmanagerå®‰è£…ä¸ç¡®è®¤</h2><h3 id="2-5-1-å®‰è£…nvidia-fabricmanager"><a href="#2-5-1-å®‰è£…nvidia-fabricmanager" class="headerlink" title="2.5.1 å®‰è£…nvidia-fabricmanager"></a>2.5.1 å®‰è£…nvidia-fabricmanager</h3><p>A800 GPU å¹¶æ”¯æŒ <strong>NvLink &amp; NvSwitch</strong>ï¼Œéœ€é¢å¤–å®‰è£…ä¸é©±åŠ¨ç‰ˆæœ¬å¯¹åº”çš„ nvidia-fabricmanager æœåŠ¡ä½¿ GPU å¡é—´èƒ½å¤Ÿäº’è”ã€‚å®‰è£… nvidia-fabricmanager æœåŠ¡åéƒ½èƒ½æ­£å¸¸ä½¿ç”¨ GPU å®ä¾‹ï¼Œå®‰è£…æ–¹æ³•å¦‚ä¸‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">Install the new cuda-keyring packageï¼ˆå°†åˆ›å»ºæ–‡ä»¶/etc/apt/sources.list.d/cuda-ubuntu2204-x86_64.list ï¼‰</span><br>wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2204/x86_64/cuda-keyring_1.1-1_all.deb<br>sudo dpkg -i cuda-keyring_1.1-1_all.deb<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…nvidia-fabricmanager-550=550.90.07-1</span><br>version=550.90.07<br>main_version=$(echo $version | awk -F &#x27;.&#x27; &#x27;&#123;print $1&#125;&#x27;)<br>sudo apt-get update<br>sudo apt-get -y install nvidia-fabricmanager-$&#123;main_version&#125;=$&#123;version&#125;-*<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¸è½½ä¸å†éœ€è¦çš„ç»„ä»¶</span><br>sudo apt autoremove<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹å·²ç»å®‰è£…çš„nvidia-fabricmanagerç‰ˆæœ¬</span><br>deepseek@deepseek1:~$ dpkg -l | grep nvidia-fabricmanager<br>ii  nvidia-fabricmanager-550               550.90.07-1                                              amd64        Fabric Manager for NVSwitch based systems.<br>deepseek@deepseek1:~$ nv-fabricmanager -v<br>Fabric Manager version is : 550.90.07<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">nvidia-fabricmanager æœåŠ¡å¼€æœºè‡ªå¯åŠ¨ã€å¯åŠ¨</span><br>sudo systemctl enable nvidia-fabricmanager<br>sudo systemctl start nvidia-fabricmanager.service<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹ nvidia-fabricmanager æœåŠ¡</span><br>sudo systemctl status nvidia-fabricmanager<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯ä»¥çœ‹åˆ°â€œå·²æˆåŠŸé…ç½®æ‰€æœ‰å¯ç”¨çš„gpuå’Œnvswitchä»¥è·¯ç”±NVLinkæµé‡â€</span><br>(self-llm) deepseek@deepseek1:~/installPkgs$ sudo systemctl status nvidia-fabricmanager<br>â— nvidia-fabricmanager.service - NVIDIA fabric manager service<br>     Loaded: loaded (/lib/systemd/system/nvidia-fabricmanager.service; enabled; vendor preset: enabled)<br>     Active: active (running) since Thu 2025-02-20 18:11:52 CST; 21h ago<br>   Main PID: 3697 (nv-fabricmanage)<br>      Tasks: 19 (limit: 629145)<br>     Memory: 22.4M<br>        CPU: 36.002s<br>     CGroup: /system.slice/nvidia-fabricmanager.service<br>             â””â”€3697 /usr/bin/nv-fabricmanager -c /usr/share/nvidia/nvswitch/fabricmanager.cfg<br><br>Feb 20 18:11:40 deepseek1 systemd[1]: Starting NVIDIA fabric manager service...<br>Feb 20 18:11:41 deepseek1 nv-fabricmanager[3697]: Connected to 1 node.<br>Feb 20 18:11:52 deepseek1 nv-fabricmanager[3697]: Successfully configured all the available GPUs and NVSwitches to route NVLink traffic.<br>Feb 20 18:11:52 deepseek1 systemd[1]: Started NVIDIA fabric manager service.<br></code></pre></td></tr></table></figure><h3 id="2-5-2-æŸ¥çœ‹æ˜¾å¡æ‹“æ‰‘ç»“æ„"><a href="#2-5-2-æŸ¥çœ‹æ˜¾å¡æ‹“æ‰‘ç»“æ„" class="headerlink" title="2.5.2 æŸ¥çœ‹æ˜¾å¡æ‹“æ‰‘ç»“æ„"></a>2.5.2 æŸ¥çœ‹æ˜¾å¡æ‹“æ‰‘ç»“æ„</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">deepseek@deepseek1:~/installPkgs$ nvidia-smi topo --matrix<br>        GPU0    GPU1    GPU2    GPU3    GPU4    GPU5    GPU6    GPU7    NIC0    NIC1    NIC2    NIC3    NIC4    CPU Affinity    NUMA Affinity   GPU NUMA ID<br>GPU0     X      NV8     NV8     NV8     NV8     NV8     NV8     NV8     PXB     <span class="hljs-keyword">NODE</span>    <span class="hljs-title">SYS</span>     SYS     <span class="hljs-keyword">NODE</span>    <span class="hljs-title">0-27</span>,<span class="hljs-number">56</span>-<span class="hljs-number">83</span>      <span class="hljs-number">0</span>               N/A<br>GPU1    NV8      X      NV8     NV8     NV8     NV8     NV8     NV8     PXB     <span class="hljs-keyword">NODE</span>    <span class="hljs-title">SYS</span>     SYS     <span class="hljs-keyword">NODE</span>    <span class="hljs-title">0-27</span>,<span class="hljs-number">56</span>-<span class="hljs-number">83</span>      <span class="hljs-number">0</span>               N/A<br>GPU2    NV8     NV8      X      NV8     NV8     NV8     NV8     NV8     <span class="hljs-keyword">NODE</span>    <span class="hljs-title">PXB</span>     SYS     SYS     <span class="hljs-keyword">NODE</span>    <span class="hljs-title">0-27</span>,<span class="hljs-number">56</span>-<span class="hljs-number">83</span>      <span class="hljs-number">0</span>               N/A<br>GPU3    NV8     NV8     NV8      X      NV8     NV8     NV8     NV8     <span class="hljs-keyword">NODE</span>    <span class="hljs-title">PXB</span>     SYS     SYS     <span class="hljs-keyword">NODE</span>    <span class="hljs-title">0-27</span>,<span class="hljs-number">56</span>-<span class="hljs-number">83</span>      <span class="hljs-number">0</span>               N/A<br>GPU4    NV8     NV8     NV8     NV8      X      NV8     NV8     NV8     SYS     SYS     PXB     <span class="hljs-keyword">NODE</span>    <span class="hljs-title">SYS</span>     <span class="hljs-number">28</span>-<span class="hljs-number">55</span>,<span class="hljs-number">84</span>-<span class="hljs-number">111</span>    <span class="hljs-number">1</span>               N/A<br>GPU5    NV8     NV8     NV8     NV8     NV8      X      NV8     NV8     SYS     SYS     PXB     <span class="hljs-keyword">NODE</span>    <span class="hljs-title">SYS</span>     <span class="hljs-number">28</span>-<span class="hljs-number">55</span>,<span class="hljs-number">84</span>-<span class="hljs-number">111</span>    <span class="hljs-number">1</span>               N/A<br>GPU6    NV8     NV8     NV8     NV8     NV8     NV8      X      NV8     SYS     SYS     <span class="hljs-keyword">NODE</span>    <span class="hljs-title">PXB</span>     SYS     <span class="hljs-number">28</span>-<span class="hljs-number">55</span>,<span class="hljs-number">84</span>-<span class="hljs-number">111</span>    <span class="hljs-number">1</span>               N/A<br>GPU7    NV8     NV8     NV8     NV8     NV8     NV8     NV8      X      SYS     SYS     <span class="hljs-keyword">NODE</span>    <span class="hljs-title">PXB</span>     SYS     <span class="hljs-number">28</span>-<span class="hljs-number">55</span>,<span class="hljs-number">84</span>-<span class="hljs-number">111</span>    <span class="hljs-number">1</span>               N/A<br>NIC0    PXB     PXB     <span class="hljs-keyword">NODE</span>    <span class="hljs-title">NODE</span>    SYS     SYS     SYS     SYS      X      <span class="hljs-keyword">NODE</span>    <span class="hljs-title">SYS</span>     SYS     <span class="hljs-keyword">NODE</span><br><span class="hljs-title">NIC1</span>    <span class="hljs-keyword">NODE</span>    <span class="hljs-title">NODE</span>    PXB     PXB     SYS     SYS     SYS     SYS     <span class="hljs-keyword">NODE</span>     <span class="hljs-title">X</span>      SYS     SYS     <span class="hljs-keyword">NODE</span><br><span class="hljs-title">NIC2</span>    SYS     SYS     SYS     SYS     PXB     PXB     <span class="hljs-keyword">NODE</span>    <span class="hljs-title">NODE</span>    SYS     SYS      X      <span class="hljs-keyword">NODE</span>    <span class="hljs-title">SYS</span><br>NIC3    SYS     SYS     SYS     SYS     <span class="hljs-keyword">NODE</span>    <span class="hljs-title">NODE</span>    PXB     PXB     SYS     SYS     <span class="hljs-keyword">NODE</span>     <span class="hljs-title">X</span>      SYS<br>NIC4    <span class="hljs-keyword">NODE</span>    <span class="hljs-title">NODE</span>    <span class="hljs-keyword">NODE</span>    <span class="hljs-title">NODE</span>    SYS     SYS     SYS     SYS     <span class="hljs-keyword">NODE</span>    <span class="hljs-title">NODE</span>    SYS     SYS      X <br><br>Legend:<br><br>  X    = Self<br>  SYS  = Connection traversing PCIe as well as the SMP interconnect between NUMA nodes (e.g., QPI/UPI)<br>  <span class="hljs-keyword">NODE</span> <span class="hljs-title">= Connection</span> traversing PCIe as well as the interconnect between PCIe Host Bridges within a NUMA <span class="hljs-keyword">node</span><br>  <span class="hljs-title">PHB</span>  = Connection traversing PCIe as well as a PCIe Host Bridge (typically the CPU)<br>  PXB  = Connection traversing multiple PCIe bridges (without traversing the PCIe Host Bridge)<br>  PIX  = Connection traversing at most a single PCIe bridge<br>  NV<span class="hljs-comment">#  = Connection traversing a bonded set of # NVLinks</span><br><br>NIC Legend:<br><br>  NIC0: mlx5_2<br>  NIC1: mlx5_3<br>  NIC2: mlx5_4<br>  NIC3: mlx5_5<br>  NIC4: mlx5_bond_0<br></code></pre></td></tr></table></figure><p><strong>å¯ä»¥çœ‹åˆ°GPU0ä¸å…¶ä»–GPUå¦‚GPU1ä¹‹é—´æ˜¯é€šè¿‡NV</strong></p><h2 id="2-6-è¶…é«˜æ€§èƒ½ç½‘ç»œ-Infiniband"><a href="#2-6-è¶…é«˜æ€§èƒ½ç½‘ç»œ-Infiniband" class="headerlink" title="2.6 è¶…é«˜æ€§èƒ½ç½‘ç»œ-Infiniband"></a>2.6 è¶…é«˜æ€§èƒ½ç½‘ç»œ-Infiniband</h2><p>InfiniBandï¼ˆä»¥ä¸‹ç®€ç§°IBç½‘ç»œï¼‰ï¼Œæ˜¯ä¸€ç§èƒ½åŠ›å¾ˆå¼ºçš„é€šä¿¡æŠ€æœ¯åè®®ã€‚å®ƒçš„è‹±æ–‡ç›´è¯‘è¿‡æ¥ï¼Œå°±æ˜¯â€œæ— é™å¸¦å®½â€ã€‚ å®ƒæ˜¯ä¸€ç§ä¸“ä¸ºé«˜æ€§èƒ½è®¡ç®—ï¼ˆHPCï¼‰å’Œè¶…å¤§è§„æ¨¡æ•°æ®ä¸­å¿ƒè®¾è®¡çš„ç½‘ç»œæŠ€æœ¯ï¼Œä»¥äºšå¾®ç§’çº§è¶…ä½å»¶è¿Ÿå’Œè¶…é«˜å¸¦å®½ä¸ºæ ¸å¿ƒä¼˜åŠ¿ã€‚</p><p>IBç½‘ç»œå› å…¶ä½å»¶è¿Ÿã€é«˜å¸¦å®½çš„ç½‘ç»œç‰¹æ€§è¢«ç”¨äºå¾ˆå¤šé«˜æ€§èƒ½è®¡ç®—ï¼ˆHigh Performance Computingï¼ŒHPCï¼‰é¡¹ç›®ï¼ŒIBç½‘ç»œé‡‡ç”¨äº†100G Mellanox IBç½‘å¡ï¼Œé€šè¿‡ä¸“ç”¨IBäº¤æ¢æœºå’Œæ§åˆ¶å™¨è½¯ä»¶UFMå®ç°ç½‘ç»œé€šä¿¡å’Œç®¡ç†ã€‚IBç½‘ç»œé€šè¿‡Partition Keyå®ç°ç½‘ç»œéš”ç¦»ï¼Œä¸åŒç§Ÿæˆ·çš„IBç½‘ç»œå¯é€šè¿‡ä¸åŒçš„Partition Keyæ¥éš”ç¦»ï¼Œç±»ä¼¼äºä»¥å¤ªç½‘çš„VLANã€‚åœ¨BMSåœºæ™¯ï¼ŒIBç½‘ç»œæ”¯æŒRDMAå’ŒIPoIBé€šä¿¡æ–¹å¼ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">é¦–å…ˆæŸ¥çœ‹æ˜¯å¦å…·æœ‰ Infiniband controller</span><br>(self-llm) deepseek@deepseek1:~/installPkgs$ lspci | grep -i infiniband<br>44:00.0 Infiniband controller: Mellanox Technologies MT28908 Family [ConnectX-6]<br>68:00.0 Infiniband controller: Mellanox Technologies MT28908 Family [ConnectX-6]<br>c2:00.0 Infiniband controller: Mellanox Technologies MT28908 Family [ConnectX-6]<br>db:00.0 Infiniband controller: Mellanox Technologies MT28908 Family [ConnectX-6]<br></code></pre></td></tr></table></figure><p>åœ¨ä¿è¯ç³»ç»Ÿä¸Šå®‰è£…ä¸”å¯ç”¨äº†IBç½‘å¡çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨å‘½ä»¤<code>ibdev2netdev -v</code>å¯ä»¥çœ‹åˆ°IBç½‘å£çš„çŠ¶æ€ã€‚</p><p>å¯ä»¥çœ‹åˆ°æœ€åæœ‰ä¸€ä¸ªbond1ï¼Œæ˜¯IBç½‘å¡åšçš„bond1ï¼Œå°±ç”¨å®ƒäº†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">deviceå’Œç½‘å£ï¼Œmlx5_2æ˜¯deviceåç§°ï¼Œibp68s0æ˜¯ç½‘å£åç§°</span><br>(self-llm) deepseek@deepseek2:~$ sudo ibdev2netdev -v<br>0000:44:00.0 mlx5_2 (MT4123 - MCX653105A-HDAT) ConnectX-6 VPI adapter card, HDR IB (200Gb/s) and 200GbE, single-port QSFP56                                                                                                           fw 20.35.3006 port 1 (ACTIVE) ==&gt; ibp68s0 (Up)<br>0000:68:00.0 mlx5_3 (MT4123 - MCX653105A-HDAT) ConnectX-6 VPI adapter card, HDR IB (200Gb/s) and 200GbE, single-port QSFP56                                                                                                           fw 20.35.3006 port 1 (ACTIVE) ==&gt; ibp104s0 (Up)<br>0000:c2:00.0 mlx5_4 (MT4123 - MCX653105A-HDAT) ConnectX-6 VPI adapter card, HDR IB (200Gb/s) and 200GbE, single-port QSFP56                                                                                                           fw 20.35.3006 port 1 (ACTIVE) ==&gt; ibp194s0 (Up)<br>0000:db:00.0 mlx5_5 (MT4123 - MCX653105A-HDAT) ConnectX-6 VPI adapter card, HDR IB (200Gb/s) and 200GbE, single-port QSFP56                                                                                                           fw 20.35.3006 port 1 (ACTIVE) ==&gt; ibp219s0 (Up)<br>0000:17:00.0 mlx5_bond_0 (MT4119 - MCX562A-ACAB) ConnectX-5 EN network interface card for OCP 3.0, with host management, 25GbE Dual-port SFP28, Pull Tab bracket                                                                        fw 16.35.3006 port 1 (ACTIVE) ==&gt; bond1 (Up)<br></code></pre></td></tr></table></figure><h2 id="2-7-æ¨ç†å¼•æ“å‡†å¤‡"><a href="#2-7-æ¨ç†å¼•æ“å‡†å¤‡" class="headerlink" title="2.7 æ¨ç†å¼•æ“å‡†å¤‡"></a>2.7 æ¨ç†å¼•æ“å‡†å¤‡</h2><p>æ­¤å¤„ä½¿ç”¨çš„æ¨ç†å¼•æ“æ˜¯vLLMï¼ŒvLLMæ˜¯ä¸€ä¸ªå¿«é€Ÿæ˜“ç”¨çš„LLMæ¨ç†å’ŒæœåŠ¡åº“ï¼Œæ—¨åœ¨æé«˜æ¨¡å‹è¿è¡Œçš„æ•ˆç‡å’Œæ€§èƒ½ã€‚å®ƒé€šè¿‡å†…å­˜ä¼˜åŒ–å’Œæ¨ç†åŠ é€ŸæŠ€æœ¯ï¼Œä½¿å¾—åœ¨èµ„æºæœ‰é™çš„ç¯å¢ƒä¸‹ä¹Ÿèƒ½é«˜æ•ˆè¿è¡Œå¤§å‹è¯­è¨€æ¨¡å‹ã€‚å®ƒè·Ÿollamaæ˜¯åŒä¸€ç±»å¼€æºäº§å“ã€‚</p><p>ä»<a href="https://docs.vllm.ai/en/latest/getting_started/installation/gpu/index.html">å®˜æ–¹éƒ¨ç½²vLLMæ–‡æ¡£</a>ä¸Šçœ‹ï¼ŒvLLMæ”¯æŒPythonä¸Dockerä¸¤ç§å®‰è£…æ–¹å¼ã€‚æ­¤æ–‡æ¡£åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Šä»¥é›†ç¾¤çš„æ–¹å¼è¿è¡ŒvLLMè¿›ç¨‹ï¼Œä¸ºäº†ä¿è¯ æ‰€æœ‰æœåŠ¡å™¨ä¸Šæ‰§è¡Œç¯å¢ƒå¦‚æ¨¡å‹æ–‡ä»¶æ‰€åœ¨ç›®å½•ã€Pythonç¯å¢ƒç­‰çš„ä¸€è‡´æ€§ï¼Œæ­¤å¤„é€šè¿‡Dockerçš„æ–¹å¼å®‰è£…vLLMä¸è¿è¡ŒvLLMã€‚</p><h3 id="2-7-1-å®‰è£…Dockerç¯å¢ƒ"><a href="#2-7-1-å®‰è£…Dockerç¯å¢ƒ" class="headerlink" title="2.7.1 å®‰è£…Dockerç¯å¢ƒ"></a>2.7.1 å®‰è£…Dockerç¯å¢ƒ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get update<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£… apt ä¾èµ–åŒ…ï¼Œç”¨äºé€šè¿‡HTTPSæ¥è·å–ä»“åº“</span><br>sudo apt-get -qy install apt-transport-https ca-certificates curl gnupg-agent software-properties-common<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ·»åŠ  Docker çš„å®˜æ–¹ GPG å¯†é’¥</span><br>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸Šè¿°å‘½åä¼šæç¤ºâ€œgpg: no valid OpenPGP data found.â€ï¼Œå…¶ä¸­ä¸€ç§è§£å†³åŠæ³•å¦‚ä¸‹ï¼š</span><br>sudo gpg --keyserver keyserver.ubuntu.com --recv 7EA0A9C3F273FCD8<br>sudo gpg --export --armor 7EA0A9C3F273FCD8 |sudo apt-key add -<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è®¾ç½®ç¨³å®šç‰ˆä»“åº“(æ·»åŠ åˆ°/etc/apt/sources.listä¸­)</span><br>sudo add-apt-repository &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&quot;<br><br>sudo apt-get update<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥è¯¢å¯å®‰è£…docker-ceç‰ˆæœ¬</span><br>sudo apt-cache policy docker-ce<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…æŒ‡å®šç‰ˆæœ¬</span><br>sudo apt-get -qy install docker-ce=5:28.0.0-1~ubuntu.22.04~jammy<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹dockerç‰ˆæœ¬</span><br>sudo docker --version<br></code></pre></td></tr></table></figure><h3 id="2-7-2-é…ç½®Dockerä½¿ç”¨NVIDIA-GPU"><a href="#2-7-2-é…ç½®Dockerä½¿ç”¨NVIDIA-GPU" class="headerlink" title="2.7.2 é…ç½®Dockerä½¿ç”¨NVIDIA GPU"></a>2.7.2 é…ç½®Dockerä½¿ç”¨NVIDIA GPU</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">è®¾ç½® repository å’Œ GPG key</span><br>distribution=$(. /etc/os-release;echo $ID$VERSION_ID)<br>curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add -<br>curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | sudo tee /etc/apt/sources.list.d/nvidia-docker.list<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£… nvidia-docker2</span><br>sudo apt-get update<br>sudo apt-get install -y nvidia-docker2<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿®æ”¹dockerå®ˆæŠ¤è¿›ç¨‹é…ç½®æ–‡ä»¶/etc/docker/daemon.json</span> <br>(self-llm) deepseek@deepseek1:~/installPkgs$ sudo vi /etc/docker/daemon.json <br>&#123;<br>  &quot;default-runtime&quot;: &quot;nvidia&quot;,<br>  &quot;runtimes&quot;: &#123;<br>    &quot;nvidia&quot;: &#123;<br>      &quot;path&quot;: &quot;/usr/bin/nvidia-container-runtime&quot;,<br>      &quot;runtimeArgs&quot;: []<br>    &#125; <br>  &#125;,<br>  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],<br>  &quot;dns&quot;: [<br>    &quot;223.5.5.5&quot;,<br>    &quot;223.6.6.6&quot;,<br>    &quot;8.8.8.8&quot;<br>  ],<br>  &quot;log-opts&quot;: &#123;<br>    &quot;max-file&quot;: &quot;5&quot;,<br>    &quot;max-size&quot;: &quot;50m&quot;<br>  &#125;,<br>  &quot;registry-mirrors&quot;: [<br>    &quot;https://registry.aliyuncs.com&quot;,<br>    &quot;https://registry.docker-cn.com&quot;,<br>    &quot;https://docker.chenby.cn&quot;,<br>    &quot;https://docker.registry.cyou&quot;,<br>    &quot;https://docker-cf.registry.cyou&quot;,<br>    &quot;https://dockercf.jsdelivr.fyi&quot;,<br>    &quot;https://docker.jsdelivr.fyi&quot;,<br>    &quot;https://dockertest.jsdelivr.fyi&quot;,<br>    &quot;https://dockerproxy.com&quot;,<br>    &quot;https://docker.m.daocloud.io&quot;,<br>    &quot;https://docker.nju.edu.cn&quot;,<br>    &quot;https://docker.mirrors.sjtug.sjtu.edu.cn&quot;,<br>    &quot;https://docker.mirrors.ustc.edu.cn&quot;,<br>    &quot;https://mirror.iscas.ac.cn&quot;,<br>    &quot;https://docker.rainbond.cc&quot;<br>  ] <br>&#125; <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é‡æ–°åŠ è½½æ­¤æ–‡ä»¶ï¼Œé‡å¯dockerè¿›ç¨‹</span><br>(self-llm) deepseek@deepseek1:~/installPkgs$ sudo systemctl daemon-reload &amp;&amp; sudo systemctl restart docker<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹dockerè¯¦ç»†é…ç½®ä¿¡æ¯</span><br>(self-llm) deepseek@deepseek1:~/installPkgs$ sudo docker info<br>Client: Docker Engine - Community<br> Version:    28.0.0<br> Context:    default<br> Debug Mode: false<br><br>Server:<br> Containers: 0<br>  Running: 0<br>  Paused: 0<br>  Stopped: 0<br> Images: 0<br> Server Version: 26.1.4<br> Storage Driver: overlay2<br>  Backing Filesystem: extfs<br>  Supports d_type: true<br>  Using metacopy: false<br>  Native Overlay Diff: true<br>  userxattr: false<br> Logging Driver: json-file<br> Cgroup Driver: systemd<br> Cgroup Version: 2<br> Plugins:<br>  Volume: local<br>  Network: bridge host ipvlan macvlan null overlay<br>  Log: awslogs fluentd gcplogs gelf journald json-file local splunk syslog<br> Swarm: inactive<br> Runtimes: io.containerd.runc.v2 nvidia runc<br> Default Runtime: nvidia<br> ...<br></code></pre></td></tr></table></figure><h3 id="2-7-3-æ‹‰å–vllm-openaié•œåƒ"><a href="#2-7-3-æ‹‰å–vllm-openaié•œåƒ" class="headerlink" title="2.7.3 æ‹‰å–vllm-openaié•œåƒ"></a>2.7.3 æ‹‰å–vllm-openaié•œåƒ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ­¤å¤„ä¸ä½¿ç”¨dockerhubä¸Šçš„é•œåƒï¼Œè€Œæ˜¯ä½¿ç”¨é˜¿é‡Œäº‘ä¸Šçš„é•œåƒ</span><br>(self-llm) deepseek@deepseek1:~/installPkgs$ sudo docker pull swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/vllm/vllm-openai:v0.7.2<br>(self-llm) deepseek@deepseek1:~/installPkgs$ sudo docker images<br>REPOSITORY                                                            TAG       IMAGE ID       CREATED       SIZE<br>swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/vllm/vllm-openai   v0.7.2    f78c8f2f8ad5   2 weeks ago   16.5GB<br></code></pre></td></tr></table></figure><h3 id="2-7-4-ä¸‹è½½vllmä»£ç ä»“åº“"><a href="#2-7-4-ä¸‹è½½vllmä»£ç ä»“åº“" class="headerlink" title="2.7.4 ä¸‹è½½vllmä»£ç ä»“åº“"></a>2.7.4 ä¸‹è½½vllmä»£ç ä»“åº“</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">(self-llm) deepseek@deepseek1:~$ mkdir code_repos<br>(self-llm) deepseek@deepseek1:~$ cd code_repos/<br>(self-llm) deepseek@deepseek1:~/code_repos$ git clone https://github.com/vllm-project/vllm.git<br>(self-llm) deepseek@deepseek1:~/code_repos$ cd vllm/<br></code></pre></td></tr></table></figure><h1 id="ä¸‰ã€æ­£å¼éƒ¨ç½²éªŒè¯ä¸ä½¿ç”¨"><a href="#ä¸‰ã€æ­£å¼éƒ¨ç½²éªŒè¯ä¸ä½¿ç”¨" class="headerlink" title="ä¸‰ã€æ­£å¼éƒ¨ç½²éªŒè¯ä¸ä½¿ç”¨"></a>ä¸‰ã€æ­£å¼éƒ¨ç½²éªŒè¯ä¸ä½¿ç”¨</h1><h2 id="3-1-è¿è¡ŒvLLMæ¨ç†å¼•æ“ä¸éªŒè¯"><a href="#3-1-è¿è¡ŒvLLMæ¨ç†å¼•æ“ä¸éªŒè¯" class="headerlink" title="3.1 è¿è¡ŒvLLMæ¨ç†å¼•æ“ä¸éªŒè¯"></a>3.1 è¿è¡ŒvLLMæ¨ç†å¼•æ“ä¸éªŒè¯</h2><p>å‚è€ƒï¼š<a href="https://docs.vllm.ai/en/latest/serving/distributed_serving.html#running-vllm-on-multiple-nodes">Running vLLM on multiple nodes</a></p><h3 id="3-1-1-åœ¨å„èŠ‚ç‚¹å¯åŠ¨nodeå®¹å™¨"><a href="#3-1-1-åœ¨å„èŠ‚ç‚¹å¯åŠ¨nodeå®¹å™¨" class="headerlink" title="3.1.1 åœ¨å„èŠ‚ç‚¹å¯åŠ¨nodeå®¹å™¨"></a>3.1.1 åœ¨å„èŠ‚ç‚¹å¯åŠ¨nodeå®¹å™¨</h3><p>åœ¨å„èŠ‚ç‚¹å¯åŠ¨nodeå®¹å™¨ï¼Œä»¥åˆ›å»ºrayé›†ç¾¤æˆ–å‘å…¶ä¸­æ·»åŠ èŠ‚ç‚¹ã€‚</p><h4 id="vllmé›†ç¾¤ä¸»èŠ‚ç‚¹"><a href="#vllmé›†ç¾¤ä¸»èŠ‚ç‚¹" class="headerlink" title="vllmé›†ç¾¤ä¸»èŠ‚ç‚¹"></a>vllmé›†ç¾¤ä¸»èŠ‚ç‚¹</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯¹äºvllmé›†ç¾¤ä¸»èŠ‚ç‚¹ï¼Œæ“ä½œå¦‚ä¸‹</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##å¯åŠ¨é›†ç¾¤ä¸»èŠ‚ç‚¹ä¸Šçš„è¿›ç¨‹å‘½ä»¤å¦‚ä¸‹</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">bash run_cluster.sh \</span><br><span class="language-bash"><span class="hljs-comment">#    vllm/vllm-openai \</span></span><br><span class="language-bash"><span class="hljs-comment">#    ip_of_head_node \</span></span><br><span class="language-bash"><span class="hljs-comment">#    --head \</span></span><br><span class="language-bash"><span class="hljs-comment">#    /path/to/the/huggingface/home/in/this/node \</span></span><br><span class="language-bash"><span class="hljs-comment">#    -e VLLM_HOST_IP=ip_of_this_node</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä»¥ä¸‹å‘½ä»¤æ‰§è¡Œä¼šåœ¨å½“å‰shellä¸­å¯åŠ¨å­è¿›ç¨‹ä¸”æ°¸è¿œé˜»å¡ï¼Œéœ€è¦ä¿è¯æ­¤shellè¿›ç¨‹ä¸è¢«å…³é—­æˆ–æ€æ­»ï¼Œå¦‚æœæŸä¸ªshellè¿›ç¨‹è¢«å…³é—­æˆ–æ€æ­»ï¼ˆé’ˆå¯¹å¯åŠ¨vllmé›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„shellè¿›ç¨‹è€Œè¨€ï¼‰å°†å¯¼è‡´rayé›†ç¾¤å¼‚å¸¸</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿è¯/mntç›®å½•æœ‰å¦‚ä¸‹ç›®å½•ï¼šhub/models/deepseek-ai/DeepSeek-R1-BP16/ï¼Œæ­¤ç›®å½•ä¸‹æ”¾ç½®ä»modelscopeä¸‹è½½ä¸‹æ¥çš„DeepSeek-R1-BP16æ¨¡å‹ä»“åº“ä¸­æ‰€æœ‰æ–‡ä»¶</span><br>(self-llm) deepseek@deepseek1:~/code_repos$ sudo bash examples/online_serving/run_cluster.sh \<br>    swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/vllm/vllm-openai:v0.7.2 \<br>    10.119.85.141 \<br>    --head \<br>    /mnt \<br>    --cap-add SYS_ADMIN \<br>    -e VLLM_HOST_IP=10.119.85.141 \<br>    --privileged -e NCCL_IB_HCA=mlx5 \<br>    -e NCCL_P2P_LEVEL=NVL \<br>    -e NCCL_IB_GID_INDEX=3 \<br>    -e NCCL_IB_DISABLE=0 \<br>    -e NCCL_DEBUG=INFO \<br>    -e NCCL_SOCKET_IFNAME=bond1<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ç›¸å…³éƒ¨åˆ†å‚æ•°çš„è§£é‡Šå¦‚ä¸‹ï¼ˆå¯å‚è€ƒå®˜ç½‘ï¼š<a href="https://docs.nvidia.com/deeplearning/nccl/user-guide/docs/index.html%EF%BC%89%EF%BC%9A">https://docs.nvidia.com/deeplearning/nccl/user-guide/docs/index.htmlï¼‰ï¼š</a></p><ul><li><p>NCCL_IB_HCA</p></li><li><p>NCCL_P2P_LEVEL</p></li></ul><p>â€‹å…è®¸ç”¨æˆ·ç²¾ç»†æ§åˆ¶ä½•æ—¶åœ¨gpuä¹‹é—´ä½¿ç”¨ç‚¹å¯¹ç‚¹ï¼ˆP2Pï¼‰ä¼ è¾“ã€‚å€¼æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œæœ‰LOC ã€NVL ç­‰</p><ul><li>NCCL_IB_GID_INDEX</li></ul><p>â€‹å®šä¹‰äº†RoCEæ¨¡å¼ä¸­ä½¿ç”¨çš„å…¨å±€IDç´¢å¼•ã€‚å¯é€‰å€¼å¦‚ä¸‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">(self-llm) deepseek@deepseek3:~$ show_gids              <br>DEV     PORT    INDEX   GID                                     IPv4            VER     DEV<br>---     ----    -----   ---                                     ------------    ---     ---<br>mlx5_2  1       0       fe80:0000:0000:0000:a088:c203:0014:e6e2                 v1<br>mlx5_3  1       0       fe80:0000:0000:0000:a088:c203:0014:e7ea                 v1<br>mlx5_4  1       0       fe80:0000:0000:0000:a088:c203:0014:e9f6                 v1<br>mlx5_5  1       0       fe80:0000:0000:0000:946d:ae03:00ed:119e                 v1<br>mlx5_bond_0     1       0       fe80:0000:0000:0000:1270:fdff:fec2:6294                 v1      bond1<br>mlx5_bond_0     1       1       fe80:0000:0000:0000:1270:fdff:fec2:6294                 v2      bond1<br>mlx5_bond_0     1       2       0000:0000:0000:0000:0000:ffff:0a77:558c 10.119.85.140   v1      bond1<br>mlx5_bond_0     1       3       0000:0000:0000:0000:0000:ffff:0a77:558c 10.119.85.140   v2      bond1<br>n_gids_found=8<br></code></pre></td></tr></table></figure><ul><li>NCCL_IB_DISABLE</li><li>NCCL_DEBUG</li><li>NCCL_SOCKET_IFNAME</li></ul><p>â€‹æŒ‡å®šç”¨äºé€šä¿¡çš„IPæ¥å£ã€‚å‚è€ƒï¼š<a href="https://docs.nvidia.com/deeplearning/nccl/user-guide/docs/env.html#nccl-socket-ifname">https://docs.nvidia.com/deeplearning/nccl/user-guide/docs/env.html#nccl-socket-ifname</a></p><ul><li>NCCL_NET_GDR_LEVEL</li></ul><p>â€‹å…è®¸ç”¨æˆ·ç²¾ç»†æ§åˆ¶ä½•æ—¶åœ¨ç½‘å¡å’ŒGPUä¹‹é—´ä½¿ç”¨GPUç›´æ¥RDMAã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æˆåŠŸè¿è¡Œåï¼Œè¾“å‡ºå¤§è‡´å¦‚ä¸‹</span><br>2025-02-23 22:04:33,124 INFO usage_lib.py:467 -- Usage stats collection is enabled by default without user confirmation because this terminal is detected to be non-interactive. To disable this, add `--disable-usage-stats` to the command that starts the cluster, or run the following command: `ray disable-usage-stats` before starting the cluster. See https://docs.ray.io/en/master/cluster/usage-stats.html for more details.<br>2025-02-23 22:04:33,125 INFO scripts.py:865 -- Local node IP: 10.119.165.139<br>2025-02-23 22:04:34,147 SUCC scripts.py:902 -- --------------------<br>2025-02-23 22:04:34,147 SUCC scripts.py:903 -- Ray runtime started.<br>2025-02-23 22:04:34,147 SUCC scripts.py:904 -- --------------------<br>2025-02-23 22:04:34,147 INFO scripts.py:906 -- Next steps<br>2025-02-23 22:04:34,148 INFO scripts.py:909 -- To add another node to this Ray cluster, run<br>2025-02-23 22:04:34,148 INFO scripts.py:912 --   ray start --address=&#x27;10.119.165.139:6379&#x27;<br>2025-02-23 22:04:34,148 INFO scripts.py:921 -- To connect to this Ray cluster:<br>2025-02-23 22:04:34,148 INFO scripts.py:923 -- import ray<br>2025-02-23 22:04:34,148 INFO scripts.py:924 -- ray.init()<br>2025-02-23 22:04:34,148 INFO scripts.py:936 -- To submit a Ray job using the Ray Jobs CLI:<br>2025-02-23 22:04:34,148 INFO scripts.py:937 --   RAY_ADDRESS=&#x27;http://127.0.0.1:8265&#x27; ray job submit --working-dir . -- python my_script.py<br>2025-02-23 22:04:34,148 INFO scripts.py:946 -- See https://docs.ray.io/en/latest/cluster/running-applications/job-submission/index.html <br>2025-02-23 22:04:34,148 INFO scripts.py:950 -- for more information on submitting Ray jobs to the Ray cluster.<br>2025-02-23 22:04:34,148 INFO scripts.py:955 -- To terminate the Ray runtime, run<br>2025-02-23 22:04:34,148 INFO scripts.py:956 --   ray stop<br>2025-02-23 22:04:34,148 INFO scripts.py:959 -- To view the status of the cluster, use<br>2025-02-23 22:04:34,148 INFO scripts.py:960 --   ray status<br>2025-02-23 22:04:34,148 INFO scripts.py:964 -- To monitor and debug Ray, view the dashboard at <br>2025-02-23 22:04:34,148 INFO scripts.py:965 --   127.0.0.1:8265<br>2025-02-23 22:04:34,148 INFO scripts.py:972 -- If connection to the dashboard fails, check your firewall settings and network configuration.<br>2025-02-23 22:04:34,148 INFO scripts.py:1076 -- --block<br>2025-02-23 22:04:34,148 INFO scripts.py:1077 -- This command will now block forever until terminated by a signal.<br>2025-02-23 22:04:34,148 INFO scripts.py:1080 -- Running subprocesses are monitored and a message will be printed if any of them terminate unexpectedly. Subprocesses exit with SIGTERM will be treated as graceful, thus NOT reported.<br></code></pre></td></tr></table></figure><h4 id="vllmè¿›ç¨‹é›†ç¾¤å‰¯èŠ‚ç‚¹"><a href="#vllmè¿›ç¨‹é›†ç¾¤å‰¯èŠ‚ç‚¹" class="headerlink" title="vllmè¿›ç¨‹é›†ç¾¤å‰¯èŠ‚ç‚¹"></a>vllmè¿›ç¨‹é›†ç¾¤å‰¯èŠ‚ç‚¹</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯¹äºvllmè¿›ç¨‹é›†ç¾¤å‰¯èŠ‚ç‚¹ï¼Œæ“ä½œå¦‚ä¸‹</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ­¤æ¬¡éƒ¨ç½²æ—¶ï¼Œä¸€å…±æœ‰4ä¸ªæœåŠ¡å™¨ã€‚deepseek1æ˜¯ä¸»èŠ‚ç‚¹ï¼Œdeepseek2ã€deepseek3ã€deepseek4éƒ½æ˜¯å‰¯èŠ‚ç‚¹</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰€ä»¥deepseek3ã€deepseek4ä¸Šä¹Ÿéœ€è¦æ‰§è¡Œå¦‚ä¸‹æ“ä½œ</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##å¯åŠ¨é›†ç¾¤å‰¯èŠ‚ç‚¹ä¸Šçš„è¿›ç¨‹å‘½ä»¤å¦‚ä¸‹</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">bash run_cluster.sh \</span><br><span class="language-bash"><span class="hljs-comment">#    vllm/vllm-openai \</span></span><br><span class="language-bash"><span class="hljs-comment">#    ip_of_head_node \</span></span><br><span class="language-bash"><span class="hljs-comment">#    --worker \</span></span><br><span class="language-bash"><span class="hljs-comment">#    /path/to/the/huggingface/home/in/this/node \</span></span><br><span class="language-bash"><span class="hljs-comment">#    -e VLLM_HOST_IP=ip_of_this_node</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä»¥ä¸‹å‘½ä»¤æ‰§è¡Œä¼šåœ¨å½“å‰shellä¸­å¯åŠ¨å­è¿›ç¨‹ä¸”æ°¸è¿œé˜»å¡ï¼Œéœ€è¦ä¿è¯æ­¤shellè¿›ç¨‹ä¸è¢«å…³é—­æˆ–æ€æ­»ï¼Œå¦‚æœæŸä¸ªshellè¿›ç¨‹è¢«å…³é—­æˆ–æ€æ­»ï¼ˆé’ˆå¯¹å¯åŠ¨vllmé›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„shellè¿›ç¨‹è€Œè¨€ï¼‰å°†å¯¼è‡´rayé›†ç¾¤ä¸ç¬¦åˆé¢„æœŸ</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä»¥ä¸‹å‘½ä»¤ä¸­æ³¨æ„ä¿®æ”¹VLLM_HOST_IPçš„å€¼ä¸ºå…·ä½“èŠ‚ç‚¹çš„IP</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#10000M network</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">10.119.165.139 deepseek1</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">10.119.165.138 deepseek2</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">10.119.165.140 deepseek3</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">10.119.165.141 deepseek4</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#IB network</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">10.119.85.141 deepseek1</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">10.119.85.138 deepseek2</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">10.119.85.140 deepseek3</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">10.119.85.139 deepseek4</span><br>(self-llm) deepseek@deepseek2:~/code_repos/vllm$ sudo bash examples/online_serving/run_cluster.sh \<br>    swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/vllm/vllm-openai:v0.7.2 \<br>    10.119.85.141 \<br>    --worker \<br>    /home/deepseek/.cache/modelscope \<br>    --cap-add SYS_ADMIN \<br>    -e VLLM_HOST_IP=10.119.85.138 \<br>    --privileged -e NCCL_IB_HCA=mlx5 \<br>    -e NCCL_P2P_LEVEL=NVL \<br>    -e NCCL_IB_GID_INDEX=3 \<br>    -e NCCL_IB_DISABLE=0 \<br>    -e NCCL_DEBUG=INFO \<br>    -e NCCL_SOCKET_IFNAME=bond1<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è¿è¡ŒæˆåŠŸåï¼Œè¾“å‡ºå¦‚ä¸‹</span><br>[2025-02-23 22:06:55,915 W 1 1] global_state_accessor.cc:429: Retrying to get node with node ID de9745473ab8d1adb62391a32ea4254142ca109b2520c761285bc1a0<br>2025-02-23 22:06:55,851 INFO scripts.py:1047 -- Local node IP: 10.119.85.138<br>2025-02-23 22:06:56,937 SUCC scripts.py:1063 -- --------------------<br>2025-02-23 22:06:56,937 SUCC scripts.py:1064 -- Ray runtime started.<br>2025-02-23 22:06:56,937 SUCC scripts.py:1065 -- --------------------<br>2025-02-23 22:06:56,937 INFO scripts.py:1067 -- To terminate the Ray runtime, run<br>2025-02-23 22:06:56,938 INFO scripts.py:1068 --   ray stop<br>2025-02-23 22:06:56,938 INFO scripts.py:1076 -- --block<br>2025-02-23 22:06:56,938 INFO scripts.py:1077 -- This command will now block forever until terminated by a signal.<br>2025-02-23 22:06:56,938 INFO scripts.py:1080 -- Running subprocesses are monitored and a message will be printed if any of them terminate unexpectedly. Subprocesses exit with SIGTERM will be treated as graceful, thus NOT reported.<br><br></code></pre></td></tr></table></figure><p>ä¸Šè¿°æ“ä½œå½“åœ¨æ¯ä¸ªæœåŠ¡å™¨å¯åŠ¨ä¸€ä¸ªåä¸ºnodeçš„å®¹å™¨ã€‚æŒ‰ç…§vllmå®˜æ–¹æ–‡æ¡£çš„è¯´æ³•ï¼Œä¸Šè¿°æ“ä½œé’ˆå¯åŠ¨ä¸€ä¸ª<code>ä»¥å®¹å™¨å½¢å¼è¿è¡Œçš„rayé›†ç¾¤</code>ï¼ˆè‹±æ–‡æ˜¯â€œa ray cluster of <strong>containers</strong>â€ï¼Œä¸çŸ¥å¦‚ä½•ç¿»è¯‘æ›´å‡†ç¡®ï¼Œæš‚æ—¶å°±å«è¿™ä¸ªåå­—å§ï¼‰ï¼Œ4ä¸ªæœåŠ¡å™¨ä¸Šçš„æ¯ä¸ªnodeå®¹å™¨éƒ½æ˜¯è¿™ä¸ªå®¹å™¨é›†ç¾¤çš„ä¸€å‘˜ã€‚</p><h3 id="3-1-2-æŸ¥çœ‹rayé›†ç¾¤"><a href="#3-1-2-æŸ¥çœ‹rayé›†ç¾¤" class="headerlink" title="3.1.2 æŸ¥çœ‹rayé›†ç¾¤"></a>3.1.2 æŸ¥çœ‹rayé›†ç¾¤</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹è¿›å…¥nodeå®¹å™¨ï¼ˆæ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½æœ‰ä¸€ä¸ªnodeå®¹å™¨ï¼‰</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ¯”å¦‚åœ¨deepseek1æœåŠ¡å™¨ä¸Šï¼Œå†æ‰“å¼€ä¸€ä¸ªç»ˆç«¯çª—å£ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</span><br>(base) deepseek@deepseek1:~$ sudo docker exec -it node /bin/bash<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä»¥ä¸‹åœ¨nodeå®¹å™¨ä¸­æ‰§è¡Œ</span><br>root@deepseek1:/vllm-workspace# ray status<br>======== Autoscaler status: 2025-02-23 22:08:18.818774 ========<br>Node status<br>---------------------------------------------------------------<br>Active:<br> 1 node_5a3c4cb16e576f2afb9e2c612f5052ab28c46014fcfa7d7b501eb35c<br> 1 node_de9745473ab8d1adb62391a32ea4254142ca109b2520c761285bc1a0<br> 1 node_f2f75b7120e56b71d416d9af7301c3ad78ead0a19a6bf810a35e016f<br> 1 node_d0f9e04c9e3425460679f6fc59d274be1547d81f6a5f1d3dbd96c0fb<br>Pending:<br> (no pending nodes)<br>Recent failures:<br> (no failures)<br><br>Resources<br>---------------------------------------------------------------<br>Usage:<br> 0.0/448.0 CPU<br> 0.0/32.0 GPU<br> 0B/3.89TiB memory<br> 0B/38.91GiB object_store_memory<br><br>Demands:<br> (no resource demands)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##å¯ä»¥çœ‹åˆ°å½“å‰rayé›†ç¾¤ä¸­ä¸€å…±æœ‰4ä¸ªèŠ‚ç‚¹ï¼Œä¸”éƒ½æ˜¯å¤„äºActiveçŠ¶æ€ï¼›rayé›†ç¾¤æ€»CPUæ•°æ˜¯448ã€æ€»GPUä¸ªæ•°æ˜¯32ã€æ€»å†…å­˜æ˜¯3.89T</span></span><br>root@deepseek1:/vllm-workspace# <br></code></pre></td></tr></table></figure><h3 id="3-1-3-æ”¶é›†ç¯å¢ƒä¿¡æ¯"><a href="#3-1-3-æ”¶é›†ç¯å¢ƒä¿¡æ¯" class="headerlink" title="3.1.3 æ”¶é›†ç¯å¢ƒä¿¡æ¯"></a>3.1.3 æ”¶é›†ç¯å¢ƒä¿¡æ¯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@deepseek1:/vllm-workspace# python3 /usr/local/lib/python3.12/dist-packages/torch/utils/collect_env.py<br></code></pre></td></tr></table></figure><h3 id="3-1-4-æ£€æŸ¥è·¨èŠ‚ç‚¹GPUé€šä¿¡"><a href="#3-1-4-æ£€æŸ¥è·¨èŠ‚ç‚¹GPUé€šä¿¡" class="headerlink" title="3.1.4 æ£€æŸ¥è·¨èŠ‚ç‚¹GPUé€šä¿¡"></a>3.1.4 æ£€æŸ¥è·¨èŠ‚ç‚¹GPUé€šä¿¡</h3><p>å‚è€ƒï¼š<a href="https://docs.vllm.ai/en/latest/getting_started/troubleshooting.html#incorrect-hardware-driver">sanity check script</a></p><h4 id="åœ¨nodeå®¹å™¨å†…åˆ›å»ºtest-py"><a href="#åœ¨nodeå®¹å™¨å†…åˆ›å»ºtest-py" class="headerlink" title="åœ¨nodeå®¹å™¨å†…åˆ›å»ºtest.py"></a>åœ¨nodeå®¹å™¨å†…åˆ›å»ºtest.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python">root@deepseek1:/vllm-workspace<span class="hljs-comment"># cat test.py</span><br><span class="hljs-comment"># Test PyTorch NCCL</span><br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.distributed <span class="hljs-keyword">as</span> dist<br>dist.init_process_group(backend=<span class="hljs-string">&quot;nccl&quot;</span>)<br>local_rank = dist.get_rank() % torch.cuda.device_count()<br>torch.cuda.set_device(local_rank)<br>data = torch.FloatTensor([<span class="hljs-number">1</span>,] * <span class="hljs-number">128</span>).to(<span class="hljs-string">&quot;cuda&quot;</span>)<br>dist.all_reduce(data, op=dist.ReduceOp.SUM)<br>torch.cuda.synchronize()<br>value = data.mean().item()<br>world_size = dist.get_world_size()<br><span class="hljs-keyword">assert</span> value == world_size, <span class="hljs-string">f&quot;Expected <span class="hljs-subst">&#123;world_size&#125;</span>, got <span class="hljs-subst">&#123;value&#125;</span>&quot;</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;PyTorch NCCL is successful!&quot;</span>)<br><br><span class="hljs-comment"># Test PyTorch GLOO</span><br>gloo_group = dist.new_group(ranks=<span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(world_size)), backend=<span class="hljs-string">&quot;gloo&quot;</span>)<br>cpu_data = torch.FloatTensor([<span class="hljs-number">1</span>,] * <span class="hljs-number">128</span>)<br>dist.all_reduce(cpu_data, op=dist.ReduceOp.SUM, group=gloo_group)<br>value = cpu_data.mean().item()<br><span class="hljs-keyword">assert</span> value == world_size, <span class="hljs-string">f&quot;Expected <span class="hljs-subst">&#123;world_size&#125;</span>, got <span class="hljs-subst">&#123;value&#125;</span>&quot;</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;PyTorch GLOO is successful!&quot;</span>)<br><br><span class="hljs-keyword">if</span> world_size &lt;= <span class="hljs-number">1</span>:<br>    exit()<br><br><span class="hljs-comment"># Test vLLM NCCL, with cuda graph</span><br><span class="hljs-keyword">from</span> vllm.distributed.device_communicators.pynccl <span class="hljs-keyword">import</span> PyNcclCommunicator<br><br>pynccl = PyNcclCommunicator(group=gloo_group, device=local_rank)<br><span class="hljs-comment"># pynccl is enabled by default for 0.6.5+,</span><br><span class="hljs-comment"># but for 0.6.4 and below, we need to enable it manually.</span><br><span class="hljs-comment"># keep the code for backward compatibility when because people</span><br><span class="hljs-comment"># prefer to read the latest documentation.</span><br>pynccl.disabled = <span class="hljs-literal">False</span><br><br>s = torch.cuda.Stream()<br><span class="hljs-keyword">with</span> torch.cuda.stream(s):<br>    data.fill_(<span class="hljs-number">1</span>)<br>    out = pynccl.all_reduce(data, stream=s)<br>    value = out.mean().item()<br>    <span class="hljs-keyword">assert</span> value == world_size, <span class="hljs-string">f&quot;Expected <span class="hljs-subst">&#123;world_size&#125;</span>, got <span class="hljs-subst">&#123;value&#125;</span>&quot;</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;vLLM NCCL is successful!&quot;</span>)<br><br>g = torch.cuda.CUDAGraph()<br><span class="hljs-keyword">with</span> torch.cuda.graph(cuda_graph=g, stream=s):<br>    out = pynccl.all_reduce(data, stream=torch.cuda.current_stream())<br><br>data.fill_(<span class="hljs-number">1</span>)<br>g.replay()<br>torch.cuda.current_stream().synchronize()<br>value = out.mean().item()<br><span class="hljs-keyword">assert</span> value == world_size, <span class="hljs-string">f&quot;Expected <span class="hljs-subst">&#123;world_size&#125;</span>, got <span class="hljs-subst">&#123;value&#125;</span>&quot;</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;vLLM NCCL with cuda graph is successful!&quot;</span>)<br><br>dist.destroy_process_group(gloo_group)<br>dist.destroy_process_group()<br></code></pre></td></tr></table></figure><h4 id="åœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šæµ‹è¯•"><a href="#åœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šæµ‹è¯•" class="headerlink" title="åœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šæµ‹è¯•"></a>åœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šæµ‹è¯•</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">--nproc-per-node æ˜¯æ­¤èŠ‚ç‚¹ä¸Šï¼Œå¾…è¦ä½¿ç”¨çš„GPUä¸ªæ•°</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">NCCL_DEBUG=TRACE torchrun --nproc-per-node=&lt;number-of-GPUs&gt; test.py</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">NCCL_P2P_DISABLE=0</span> <br>NCCL_DEBUG=TRACE torchrun --nproc-per-node=8 test.py<br></code></pre></td></tr></table></figure><p>å¦‚æœä¸Šè¿°pyæ–‡ä»¶è¿è¡ŒæˆåŠŸä¸”é€šä¿¡æ˜¯æ­£å¸¸çš„ï¼Œåˆ™è¾“å‡ºç±»ä¼¼äºå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs shell">...<br>deepseek1:1239:1239 [3] NCCL INFO Connected all trees<br>deepseek1:1239:1239 [3] NCCL INFO threadThresholds 8/8/64 | 64/8/64 | 512 | 512<br>deepseek1:1239:1239 [3] NCCL INFO 16 coll channels, 16 collnet channels, 0 nvls channels, 16 p2p channels, 16 p2p channels per peer<br>deepseek1:1240:1240 [4] NCCL INFO Connected all trees<br>deepseek1:1240:1240 [4] NCCL INFO threadThresholds 8/8/64 | 64/8/64 | 512 | 512<br>deepseek1:1240:1240 [4] NCCL INFO 16 coll channels, 16 collnet channels, 0 nvls channels, 16 p2p channels, 16 p2p channels per peer<br>deepseek1:1241:1241 [5] NCCL INFO Connected all trees<br>deepseek1:1241:1241 [5] NCCL INFO threadThresholds 8/8/64 | 64/8/64 | 512 | 512<br>deepseek1:1241:1241 [5] NCCL INFO 16 coll channels, 16 collnet channels, 0 nvls channels, 16 p2p channels, 16 p2p channels per peer<br>deepseek1:1243:1243 [7] NCCL INFO Connected all trees<br>deepseek1:1243:1243 [7] NCCL INFO threadThresholds 8/8/64 | 64/8/64 | 512 | 512<br>deepseek1:1243:1243 [7] NCCL INFO 16 coll channels, 16 collnet channels, 0 nvls channels, 16 p2p channels, 16 p2p channels per peer<br>deepseek1:1242:1242 [6] NCCL INFO Connected all trees<br>deepseek1:1242:1242 [6] NCCL INFO threadThresholds 8/8/64 | 64/8/64 | 512 | 512<br>deepseek1:1242:1242 [6] NCCL INFO 16 coll channels, 16 collnet channels, 0 nvls channels, 16 p2p channels, 16 p2p channels per peer<br>deepseek1:1236:1236 [0] NCCL INFO ncclCommInitRank comm 0xb606410 rank 0 nranks 8 cudaDev 0 nvmlDev 0 busId 3d000 commId 0x3c2a650fc7de9a50 - Init COMPLETE<br>deepseek1:1238:1238 [2] NCCL INFO ncclCommInitRank comm 0xb88e340 rank 2 nranks 8 cudaDev 2 nvmlDev 2 busId 61000 commId 0x3c2a650fc7de9a50 - Init COMPLETE<br>deepseek1:1240:1240 [4] NCCL INFO ncclCommInitRank comm 0xad28600 rank 4 nranks 8 cudaDev 4 nvmlDev 4 busId ad000 commId 0x3c2a650fc7de9a50 - Init COMPLETE<br>deepseek1:1242:1242 [6] NCCL INFO ncclCommInitRank comm 0xb29e250 rank 6 nranks 8 cudaDev 6 nvmlDev 6 busId d0000 commId 0x3c2a650fc7de9a50 - Init COMPLETE<br>deepseek1:1237:1237 [1] NCCL INFO ncclCommInitRank comm 0xb60f020 rank 1 nranks 8 cudaDev 1 nvmlDev 1 busId 42000 commId 0x3c2a650fc7de9a50 - Init COMPLETE<br>deepseek1:1241:1241 [5] NCCL INFO ncclCommInitRank comm 0xc2f2570 rank 5 nranks 8 cudaDev 5 nvmlDev 5 busId b1000 commId 0x3c2a650fc7de9a50 - Init COMPLETE<br>deepseek1:1239:1239 [3] NCCL INFO ncclCommInitRank comm 0xac2c590 rank 3 nranks 8 cudaDev 3 nvmlDev 3 busId 67000 commId 0x3c2a650fc7de9a50 - Init COMPLETE<br>deepseek1:1243:1243 [7] NCCL INFO ncclCommInitRank comm 0xbd1b050 rank 7 nranks 8 cudaDev 7 nvmlDev 7 busId d3000 commId 0x3c2a650fc7de9a50 - Init COMPLETE<br>vLLM NCCL is successful!vLLM NCCL is successful!vLLM NCCL is successful!vLLM NCCL is successful!vLLM NCCL is successful!vLLM NCCL is successful!<br><br><br><br><br><br>vLLM NCCL is successful!<br>vLLM NCCL is successful!<br>vLLM NCCL with cuda graph is successful!vLLM NCCL with cuda graph is successful!vLLM NCCL with cuda graph is successful!<br><br>vLLM NCCL with cuda graph is successful!<br><br>vLLM NCCL with cuda graph is successful!<br>vLLM NCCL with cuda graph is successful!<br>vLLM NCCL with cuda graph is successful!<br>vLLM NCCL with cuda graph is successful!<br>deepseek1:1236:1299 [0] NCCL INFO [Service thread] Connection closed by localRank 0<br>deepseek1:1237:1286 [1] NCCL INFO [Service thread] Connection closed by localRank 1<br>deepseek1:1241:1291 [5] NCCL INFO [Service thread] Connection closed by localRank 5<br>deepseek1:1240:1293 [4] NCCL INFO [Service thread] Connection closed by localRank 4<br>deepseek1:1239:1295 [3] NCCL INFO [Service thread] Connection closed by localRank 3<br>deepseek1:1242:1288 [6] NCCL INFO [Service thread] Connection closed by localRank 6<br>deepseek1:1243:1287 [7] NCCL INFO [Service thread] Connection closed by localRank 7<br>deepseek1:1238:1290 [2] NCCL INFO [Service thread] Connection closed by localRank 2<br>deepseek1:1236:1400 [0] NCCL INFO comm 0x8265490 rank 0 nranks 8 cudaDev 0 busId 3d000 - Abort COMPLETE<br>deepseek1:1243:1405 [7] NCCL INFO comm 0x897f4f0 rank 7 nranks 8 cudaDev 7 busId d3000 - Abort COMPLETE<br>deepseek1:1237:1403 [1] NCCL INFO comm 0x828e430 rank 1 nranks 8 cudaDev 1 busId 42000 - Abort COMPLETE<br>deepseek1:1240:1402 [4] NCCL INFO comm 0x79a3f10 rank 4 nranks 8 cudaDev 4 busId ad000 - Abort COMPLETE<br>deepseek1:1241:1401 [5] NCCL INFO comm 0x8f75840 rank 5 nranks 8 cudaDev 5 busId b1000 - Abort COMPLETE<br>deepseek1:1242:1404 [6] NCCL INFO comm 0x7f1d4b0 rank 6 nranks 8 cudaDev 6 busId d0000 - Abort COMPLETE<br>deepseek1:1238:1407 [2] NCCL INFO comm 0x850c0d0 rank 2 nranks 8 cudaDev 2 busId 61000 - Abort COMPLETE<br>deepseek1:1239:1406 [3] NCCL INFO comm 0x78b0310 rank 3 nranks 8 cudaDev 3 busId 67000 - Abort COMPLETE<br></code></pre></td></tr></table></figure><h4 id="åœ¨å¤šä¸ªèŠ‚ç‚¹é—´æµ‹è¯•"><a href="#åœ¨å¤šä¸ªèŠ‚ç‚¹é—´æµ‹è¯•" class="headerlink" title="åœ¨å¤šä¸ªèŠ‚ç‚¹é—´æµ‹è¯•"></a>åœ¨å¤šä¸ªèŠ‚ç‚¹é—´æµ‹è¯•</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##æ–¹æ³•1ï¼‰</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">--nnodes æ˜¯èŠ‚ç‚¹ä¸ªæ•°</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">--nproc-per-node æ˜¯å„èŠ‚ç‚¹ä¸Šï¼Œå¾…è¦ä½¿ç”¨çš„GPUä¸ªæ•°</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">--rdzv_endpoint æ˜¯rayé›†ç¾¤ä¸­ä¸»èŠ‚ç‚¹çš„IPï¼ˆä¿è¯è¿™ä¸ªIPåœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šéƒ½æ˜¯å¯è®¿é—®çš„ã€‚æ—¢ç„¶éƒ½å·²ç»æ­å»ºå‡ºrayé›†ç¾¤ï¼Œå½“ç„¶æ˜¯å¯è®¿é—®çš„ï¼‰</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨4ä¸ªæœåŠ¡å™¨ä¸Šçš„nodeå®¹å™¨ä¸­æ‰§è¡Œå¦‚ä¸‹ç›¸åŒçš„å‘½ä»¤</span><br>NCCL_DEBUG=TRACE torchrun --nnodes 4 --nproc-per-node=8 --rdzv_backend=c10d --rdzv_endpoint=10.119.85.141 test.py<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¿…é¡»ç­‰4ä¸ªå®¹å™¨ä¸­çš„å‘½ä»¤éƒ½æ‰§è¡Œèµ·æ¥åï¼Œæµ‹è¯•ç¨‹åºæ‰ä¼šå¾€ä¸‹æ‰§è¡Œä¸è¾“å‡ºç›¸å…³å†…å®¹</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##æ–¹æ³•2ï¼‰</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨4ä¸ªæœåŠ¡å™¨ä¸Šçš„nodeå®¹å™¨ä¸­åˆ†åˆ«æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</span><br>NCCL_DEBUG=TRACE torchrun --nnodes 4 --nproc-per-node=8 --node-rank 0 --master_addr 10.119.85.141 test.py<br>NCCL_DEBUG=TRACE torchrun --nnodes 4 --nproc-per-node=8 --node-rank 1 --master_addr 10.119.85.141 test.py<br>NCCL_DEBUG=TRACE torchrun --nnodes 4 --nproc-per-node=8 --node-rank 2 --master_addr 10.119.85.141 test.py<br>NCCL_DEBUG=TRACE torchrun --nnodes 4 --nproc-per-node=8 --node-rank 3 --master_addr 10.119.85.141 test.py<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¿…é¡»ç­‰4ä¸ªå®¹å™¨ä¸­çš„å‘½ä»¤éƒ½æ‰§è¡Œèµ·æ¥åï¼Œæµ‹è¯•ç¨‹åºæ‰ä¼šå¾€ä¸‹æ‰§è¡Œä¸è¾“å‡ºç›¸å…³å†…å®¹</span><br></code></pre></td></tr></table></figure><p>å¦‚æœä¸Šè¿°pyæ–‡ä»¶è¿è¡ŒæˆåŠŸä¸”é€šä¿¡æ˜¯æ­£å¸¸çš„ï¼Œåˆ™æŸä¸ªnodeå®¹å™¨test.pyå°†è¾“å‡ºç±»ä¼¼äºå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br></pre></td><td class="code"><pre><code class="hljs shell">...<br>INFO 02-24 00:01:07 pynccl.py:69] vLLM is using nccl==2.21.5<br>deepseek2:460:460 [4] NCCL INFO Using non-device net plugin version 0<br>deepseek2:460:460 [4] NCCL INFO Using network IB<br>deepseek2:459:459 [3] NCCL INFO ncclCommInitRank comm 0xb0c19c0 rank 11 nranks 32 cudaDev 3 nvmlDev 3 busId 67000 commId 0x8da567a0342af828 - Init START<br>deepseek2:458:458 [2] NCCL INFO ncclCommInitRank comm 0xb7b98b0 rank 10 nranks 32 cudaDev 2 nvmlDev 2 busId 61000 commId 0x8da567a0342af828 - Init START<br>deepseek2:457:457 [1] NCCL INFO ncclCommInitRank comm 0xc8103e0 rank 9 nranks 32 cudaDev 1 nvmlDev 1 busId 42000 commId 0x8da567a0342af828 - Init START<br>deepseek2:460:460 [4] NCCL INFO ncclCommInitRank comm 0xc1ff420 rank 12 nranks 32 cudaDev 4 nvmlDev 4 busId ad000 commId 0x8da567a0342af828 - Init START<br>deepseek2:456:456 [0] NCCL INFO ncclCommInitRank comm 0xbd9b580 rank 8 nranks 32 cudaDev 0 nvmlDev 0 busId 3d000 commId 0x8da567a0342af828 - Init START<br>deepseek2:461:461 [5] NCCL INFO ncclCommInitRank comm 0xc041a00 rank 13 nranks 32 cudaDev 5 nvmlDev 5 busId b1000 commId 0x8da567a0342af828 - Init START<br>deepseek2:463:463 [7] NCCL INFO ncclCommInitRank comm 0xc41ace0 rank 15 nranks 32 cudaDev 7 nvmlDev 7 busId d3000 commId 0x8da567a0342af828 - Init START<br>deepseek2:462:462 [6] NCCL INFO ncclCommInitRank comm 0xb794080 rank 14 nranks 32 cudaDev 6 nvmlDev 6 busId d0000 commId 0x8da567a0342af828 - Init START<br>deepseek2:463:463 [7] NCCL INFO Setting affinity for GPU 7 to ffff,fff00000,00ffffff,f0000000<br>deepseek2:463:463 [7] NCCL INFO NVLS multicast support is not available on dev 7<br>deepseek2:459:459 [3] NCCL INFO Setting affinity for GPU 3 to 0fffff,ff000000,0fffffff<br>deepseek2:459:459 [3] NCCL INFO NVLS multicast support is not available on dev 3<br>deepseek2:460:460 [4] NCCL INFO Setting affinity for GPU 4 to ffff,fff00000,00ffffff,f0000000<br>deepseek2:460:460 [4] NCCL INFO NVLS multicast support is not available on dev 4<br>deepseek2:461:461 [5] NCCL INFO Setting affinity for GPU 5 to ffff,fff00000,00ffffff,f0000000<br>deepseek2:461:461 [5] NCCL INFO NVLS multicast support is not available on dev 5<br>deepseek2:456:456 [0] NCCL INFO Setting affinity for GPU 0 to 0fffff,ff000000,0fffffff<br>deepseek2:456:456 [0] NCCL INFO NVLS multicast support is not available on dev 0<br>deepseek2:457:457 [1] NCCL INFO Setting affinity for GPU 1 to 0fffff,ff000000,0fffffff<br>deepseek2:457:457 [1] NCCL INFO NVLS multicast support is not available on dev 1<br>deepseek2:458:458 [2] NCCL INFO Setting affinity for GPU 2 to 0fffff,ff000000,0fffffff<br>deepseek2:458:458 [2] NCCL INFO NVLS multicast support is not available on dev 2<br>deepseek2:462:462 [6] NCCL INFO Setting affinity for GPU 6 to ffff,fff00000,00ffffff,f0000000<br>deepseek2:462:462 [6] NCCL INFO NVLS multicast support is not available on dev 6<br>deepseek2:463:463 [7] NCCL INFO comm 0xc41ace0 rank 15 nRanks 32 nNodes 4 localRanks 8 localRank 7 MNNVL 0<br>deepseek2:462:462 [6] NCCL INFO comm 0xb794080 rank 14 nRanks 32 nNodes 4 localRanks 8 localRank 6 MNNVL 0<br>deepseek2:457:457 [1] NCCL INFO comm 0xc8103e0 rank 9 nRanks 32 nNodes 4 localRanks 8 localRank 1 MNNVL 0<br>deepseek2:461:461 [5] NCCL INFO comm 0xc041a00 rank 13 nRanks 32 nNodes 4 localRanks 8 localRank 5 MNNVL 0<br>deepseek2:460:460 [4] NCCL INFO comm 0xc1ff420 rank 12 nRanks 32 nNodes 4 localRanks 8 localRank 4 MNNVL 0<br>deepseek2:458:458 [2] NCCL INFO comm 0xb7b98b0 rank 10 nRanks 32 nNodes 4 localRanks 8 localRank 2 MNNVL 0<br>deepseek2:462:462 [6] NCCL INFO Trees [0] 15/-1/-1-&gt;14-&gt;13 [1] 15/-1/-1-&gt;14-&gt;13 [2] 15/-1/-1-&gt;14-&gt;13 [3] 15/-1/-1-&gt;14-&gt;13<br>deepseek2:463:463 [7] NCCL INFO Trees [0] -1/-1/-1-&gt;15-&gt;14 [1] 8/-1/-1-&gt;15-&gt;14 [2] -1/-1/-1-&gt;15-&gt;14 [3] 8/-1/-1-&gt;15-&gt;14<br>deepseek2:459:459 [3] NCCL INFO comm 0xb0c19c0 rank 11 nRanks 32 nNodes 4 localRanks 8 localRank 3 MNNVL 0<br>deepseek2:456:456 [0] NCCL INFO comm 0xbd9b580 rank 8 nRanks 32 nNodes 4 localRanks 8 localRank 0 MNNVL 0<br>deepseek2:462:462 [6] NCCL INFO P2P Chunksize set to 131072<br>deepseek2:461:461 [5] NCCL INFO Trees [0] 14/-1/-1-&gt;13-&gt;12 [1] 14/-1/-1-&gt;13-&gt;12 [2] 14/-1/-1-&gt;13-&gt;12 [3] 14/-1/-1-&gt;13-&gt;12<br>deepseek2:463:463 [7] NCCL INFO P2P Chunksize set to 131072<br>deepseek2:457:457 [1] NCCL INFO Trees [0] 10/-1/-1-&gt;9-&gt;8 [1] -1/-1/-1-&gt;9-&gt;8 [2] 10/16/-1-&gt;9-&gt;8 [3] -1/-1/-1-&gt;9-&gt;8<br>deepseek2:460:460 [4] NCCL INFO Trees [0] 13/-1/-1-&gt;12-&gt;11 [1] 13/-1/-1-&gt;12-&gt;11 [2] 13/-1/-1-&gt;12-&gt;11 [3] 13/-1/-1-&gt;12-&gt;11<br>deepseek2:461:461 [5] NCCL INFO P2P Chunksize set to 131072<br>deepseek2:458:458 [2] NCCL INFO Trees [0] 11/-1/-1-&gt;10-&gt;9 [1] 11/-1/-1-&gt;10-&gt;19 [2] 11/-1/-1-&gt;10-&gt;9 [3] 11/6/-1-&gt;10-&gt;26<br>deepseek2:457:457 [1] NCCL INFO P2P Chunksize set to 131072<br>deepseek2:459:459 [3] NCCL INFO Trees [0] 12/-1/-1-&gt;11-&gt;10 [1] 12/-1/-1-&gt;11-&gt;10 [2] 12/-1/-1-&gt;11-&gt;10 [3] 12/18/-1-&gt;11-&gt;10<br>deepseek2:458:458 [2] NCCL INFO P2P Chunksize set to 131072<br>deepseek2:460:460 [4] NCCL INFO P2P Chunksize set to 131072<br>deepseek2:459:459 [3] NCCL INFO P2P Chunksize set to 131072<br>deepseek2:456:456 [0] NCCL INFO Trees [0] 9/-1/-1-&gt;8-&gt;17 [1] 9/-1/-1-&gt;8-&gt;15 [2] 9/2/-1-&gt;8-&gt;24 [3] 9/-1/-1-&gt;8-&gt;15<br>deepseek2:456:456 [0] NCCL INFO P2P Chunksize set to 131072<br>deepseek2:460:460 [4] NCCL INFO Channel 00/0 : 12[4] -&gt; 11[3] via P2P/CUMEM/read<br>deepseek2:462:462 [6] NCCL INFO Channel 00/0 : 14[6] -&gt; 13[5] via P2P/CUMEM/read<br>deepseek2:461:461 [5] NCCL INFO Channel 00/0 : 13[5] -&gt; 12[4] via P2P/CUMEM/read<br>deepseek2:460:460 [4] NCCL INFO Channel 01/0 : 12[4] -&gt; 11[3] via P2P/CUMEM/read<br>deepseek2:462:462 [6] NCCL INFO Channel 01/0 : 14[6] -&gt; 13[5] via P2P/CUMEM/read<br>deepseek2:461:461 [5] NCCL INFO Channel 01/0 : 13[5] -&gt; 12[4] via P2P/CUMEM/read<br>deepseek2:460:460 [4] NCCL INFO Channel 02/0 : 12[4] -&gt; 11[3] via P2P/CUMEM/read<br>deepseek2:462:462 [6] NCCL INFO Channel 02/0 : 14[6] -&gt; 13[5] via P2P/CUMEM/read<br>deepseek2:461:461 [5] NCCL INFO Channel 02/0 : 13[5] -&gt; 12[4] via P2P/CUMEM/read<br>deepseek2:460:460 [4] NCCL INFO Channel 03/0 : 12[4] -&gt; 11[3] via P2P/CUMEM/read<br>deepseek2:462:462 [6] NCCL INFO Channel 03/0 : 14[6] -&gt; 13[5] via P2P/CUMEM/read<br>deepseek2:461:461 [5] NCCL INFO Channel 03/0 : 13[5] -&gt; 12[4] via P2P/CUMEM/read<br>deepseek2:457:457 [1] NCCL INFO Channel 00/0 : 9[1] -&gt; 16[0] [send] via NET/IB/0/GDRDMA<br>deepseek2:459:459 [3] NCCL INFO Channel 01/0 : 11[3] -&gt; 18[2] [send] via NET/IB/1/GDRDMA<br>deepseek2:457:457 [1] NCCL INFO Channel 02/0 : 9[1] -&gt; 16[0] [send] via NET/IB/0/GDRDMA<br>deepseek2:459:459 [3] NCCL INFO Channel 03/0 : 11[3] -&gt; 18[2] [send] via NET/IB/1/GDRDMA<br>deepseek2:456:456 [0] NCCL INFO Channel 00/0 : 3[3] -&gt; 8[0] [receive] via NET/IB/0/GDRDMA<br>deepseek2:458:458 [2] NCCL INFO Channel 01/0 : 7[7] -&gt; 10[2] [receive] via NET/IB/1/GDRDMA<br>deepseek2:456:456 [0] NCCL INFO Channel 02/0 : 3[3] -&gt; 8[0] [receive] via NET/IB/0/GDRDMA<br>deepseek2:458:458 [2] NCCL INFO Channel 03/0 : 7[7] -&gt; 10[2] [receive] via NET/IB/1/GDRDMA<br>deepseek2:456:456 [0] NCCL INFO Channel 00/0 : 8[0] -&gt; 15[7] via P2P/CUMEM/read<br>deepseek2:456:456 [0] NCCL INFO Channel 01/0 : 8[0] -&gt; 15[7] via P2P/CUMEM/read<br>deepseek2:456:456 [0] NCCL INFO Channel 02/0 : 8[0] -&gt; 15[7] via P2P/CUMEM/read<br>deepseek2:458:458 [2] NCCL INFO Channel 00/0 : 10[2] -&gt; 9[1] via P2P/CUMEM/read<br>deepseek2:456:456 [0] NCCL INFO Channel 03/0 : 8[0] -&gt; 15[7] via P2P/CUMEM/read<br>deepseek2:459:459 [3] NCCL INFO Channel 00/0 : 11[3] -&gt; 10[2] via P2P/CUMEM/read<br>deepseek2:458:458 [2] NCCL INFO Channel 01/0 : 10[2] -&gt; 9[1] via P2P/CUMEM/read<br>deepseek2:457:457 [1] NCCL INFO Channel 01/0 : 9[1] -&gt; 8[0] via P2P/CUMEM/read<br>deepseek2:459:459 [3] NCCL INFO Channel 02/0 : 11[3] -&gt; 10[2] via P2P/CUMEM/read<br>deepseek2:463:463 [7] NCCL INFO Channel 00/0 : 15[7] -&gt; 14[6] via P2P/CUMEM/read<br>deepseek2:457:457 [1] NCCL INFO Channel 03/0 : 9[1] -&gt; 8[0] via P2P/CUMEM/read<br>deepseek2:458:458 [2] NCCL INFO Channel 02/0 : 10[2] -&gt; 9[1] via P2P/CUMEM/read<br>deepseek2:463:463 [7] NCCL INFO Channel 01/0 : 15[7] -&gt; 14[6] via P2P/CUMEM/read<br>deepseek2:458:458 [2] NCCL INFO Channel 03/0 : 10[2] -&gt; 9[1] via P2P/CUMEM/read<br>deepseek2:463:463 [7] NCCL INFO Channel 02/0 : 15[7] -&gt; 14[6] via P2P/CUMEM/read<br>deepseek2:463:463 [7] NCCL INFO Channel 03/0 : 15[7] -&gt; 14[6] via P2P/CUMEM/read<br>deepseek2:458:458 [2] NCCL INFO Connected all rings<br>deepseek2:459:459 [3] NCCL INFO Connected all rings<br>deepseek2:460:460 [4] NCCL INFO Connected all rings<br>deepseek2:458:458 [2] NCCL INFO Channel 00/0 : 10[2] -&gt; 11[3] via P2P/CUMEM/read<br>deepseek2:458:458 [2] NCCL INFO Channel 01/0 : 10[2] -&gt; 11[3] via P2P/CUMEM/read<br>deepseek2:458:458 [2] NCCL INFO Channel 02/0 : 10[2] -&gt; 11[3] via P2P/CUMEM/read<br>deepseek2:459:459 [3] NCCL INFO Channel 00/0 : 11[3] -&gt; 12[4] via P2P/CUMEM/read<br>deepseek2:458:458 [2] NCCL INFO Channel 03/0 : 10[2] -&gt; 11[3] via P2P/CUMEM/read<br>deepseek2:460:460 [4] NCCL INFO Channel 00/0 : 12[4] -&gt; 13[5] via P2P/CUMEM/read<br>deepseek2:459:459 [3] NCCL INFO Channel 01/0 : 11[3] -&gt; 12[4] via P2P/CUMEM/read<br>deepseek2:456:456 [0] NCCL INFO Connected all rings<br>deepseek2:457:457 [1] NCCL INFO Connected all rings<br>deepseek2:456:456 [0] NCCL INFO Channel 00/0 : 8[0] -&gt; 9[1] via P2P/CUMEM/read<br>deepseek2:460:460 [4] NCCL INFO Channel 01/0 : 12[4] -&gt; 13[5] via P2P/CUMEM/read<br>deepseek2:459:459 [3] NCCL INFO Channel 02/0 : 11[3] -&gt; 12[4] via P2P/CUMEM/read<br>deepseek2:456:456 [0] NCCL INFO Channel 01/0 : 8[0] -&gt; 9[1] via P2P/CUMEM/read<br>deepseek2:460:460 [4] NCCL INFO Channel 02/0 : 12[4] -&gt; 13[5] via P2P/CUMEM/read<br>deepseek2:459:459 [3] NCCL INFO Channel 03/0 : 11[3] -&gt; 12[4] via P2P/CUMEM/read<br>deepseek2:456:456 [0] NCCL INFO Channel 02/0 : 8[0] -&gt; 9[1] via P2P/CUMEM/read<br>deepseek2:460:460 [4] NCCL INFO Channel 03/0 : 12[4] -&gt; 13[5] via P2P/CUMEM/read<br>deepseek2:456:456 [0] NCCL INFO Channel 03/0 : 8[0] -&gt; 9[1] via P2P/CUMEM/read<br>deepseek2:457:457 [1] NCCL INFO Channel 00/0 : 9[1] -&gt; 10[2] via P2P/CUMEM/read<br>deepseek2:459:459 [3] NCCL INFO Channel 03/0 : 18[2] -&gt; 11[3] [receive] via NET/IB/1/GDRDMA<br>deepseek2:457:457 [1] NCCL INFO Channel 02/0 : 9[1] -&gt; 10[2] via P2P/CUMEM/read<br>deepseek2:456:456 [0] NCCL INFO Channel 02/0 : 2[2] -&gt; 8[0] [receive] via NET/IB/0/GDRDMA<br>deepseek2:458:458 [2] NCCL INFO Channel 03/0 : 6[6] -&gt; 10[2] [receive] via NET/IB/1/GDRDMA<br>deepseek2:457:457 [1] NCCL INFO Channel 02/0 : 16[0] -&gt; 9[1] [receive] via NET/IB/0/GDRDMA<br>deepseek2:456:456 [0] NCCL INFO Channel 00/0 : 8[0] -&gt; 17[1] [send] via NET/IB/0/GDRDMA<br>deepseek2:458:458 [2] NCCL INFO Channel 01/0 : 10[2] -&gt; 19[3] [send] via NET/IB/1/GDRDMA<br>deepseek2:456:456 [0] NCCL INFO Channel 02/0 : 24[0] -&gt; 8[0] [receive] via NET/IB/0/GDRDMA<br>deepseek2:456:456 [0] NCCL INFO Channel 02/0 : 8[0] -&gt; 24[0] [send] via NET/IB/0/GDRDMA<br>deepseek2:458:458 [2] NCCL INFO Channel 03/0 : 26[2] -&gt; 10[2] [receive] via NET/IB/1/GDRDMA<br>deepseek2:461:461 [5] NCCL INFO Connected all rings<br>deepseek2:463:463 [7] NCCL INFO Connected all rings<br>deepseek2:458:458 [2] NCCL INFO Channel 03/0 : 10[2] -&gt; 26[2] [send] via NET/IB/1/GDRDMA<br>deepseek2:462:462 [6] NCCL INFO Connected all rings<br>deepseek2:456:456 [0] NCCL INFO Channel 00/0 : 17[1] -&gt; 8[0] [receive] via NET/IB/0/GDRDMA<br>deepseek2:458:458 [2] NCCL INFO Channel 01/0 : 19[3] -&gt; 10[2] [receive] via NET/IB/1/GDRDMA<br>deepseek2:458:458 [2] NCCL INFO Channel 03/0 : 10[2] -&gt; 6[6] [send] via NET/IB/1/GDRDMA<br>deepseek2:459:459 [3] NCCL INFO Channel 01/0 : 11[3] -&gt; 10[2] via P2P/CUMEM/read<br>deepseek2:459:459 [3] NCCL INFO Channel 03/0 : 11[3] -&gt; 10[2] via P2P/CUMEM/read<br>deepseek2:457:457 [1] NCCL INFO Channel 00/0 : 9[1] -&gt; 8[0] via P2P/CUMEM/read<br>deepseek2:461:461 [5] NCCL INFO Channel 00/0 : 13[5] -&gt; 14[6] via P2P/CUMEM/read<br>deepseek2:457:457 [1] NCCL INFO Channel 02/0 : 9[1] -&gt; 8[0] via P2P/CUMEM/read<br>deepseek2:461:461 [5] NCCL INFO Channel 01/0 : 13[5] -&gt; 14[6] via P2P/CUMEM/read<br>deepseek2:462:462 [6] NCCL INFO Channel 00/0 : 14[6] -&gt; 15[7] via P2P/CUMEM/read<br>deepseek2:461:461 [5] NCCL INFO Channel 02/0 : 13[5] -&gt; 14[6] via P2P/CUMEM/read<br>deepseek2:462:462 [6] NCCL INFO Channel 01/0 : 14[6] -&gt; 15[7] via P2P/CUMEM/read<br>deepseek2:461:461 [5] NCCL INFO Channel 03/0 : 13[5] -&gt; 14[6] via P2P/CUMEM/read<br>deepseek2:462:462 [6] NCCL INFO Channel 02/0 : 14[6] -&gt; 15[7] via P2P/CUMEM/read<br>deepseek2:462:462 [6] NCCL INFO Channel 03/0 : 14[6] -&gt; 15[7] via P2P/CUMEM/read<br>deepseek2:463:463 [7] NCCL INFO Channel 01/0 : 15[7] -&gt; 8[0] via P2P/CUMEM/read<br>deepseek2:463:463 [7] NCCL INFO Channel 03/0 : 15[7] -&gt; 8[0] via P2P/CUMEM/read<br>deepseek2:456:456 [0] NCCL INFO Channel 02/0 : 8[0] -&gt; 2[2] [send] via NET/IB/0/GDRDMA<br>deepseek2:462:462 [6] NCCL INFO Connected all trees<br>deepseek2:462:462 [6] NCCL INFO threadThresholds 8/8/64 | 256/8/64 | 512 | 512<br>deepseek2:462:462 [6] NCCL INFO 4 coll channels, 4 collnet channels, 0 nvls channels, 4 p2p channels, 1 p2p channels per peer<br>deepseek2:461:461 [5] NCCL INFO Connected all trees<br>deepseek2:461:461 [5] NCCL INFO threadThresholds 8/8/64 | 256/8/64 | 512 | 512<br>deepseek2:461:461 [5] NCCL INFO 4 coll channels, 4 collnet channels, 0 nvls channels, 4 p2p channels, 1 p2p channels per peer<br>deepseek2:460:460 [4] NCCL INFO Connected all trees<br>deepseek2:460:460 [4] NCCL INFO threadThresholds 8/8/64 | 256/8/64 | 512 | 512<br>deepseek2:460:460 [4] NCCL INFO 4 coll channels, 4 collnet channels, 0 nvls channels, 4 p2p channels, 1 p2p channels per peer<br>deepseek2:458:458 [2] NCCL INFO Connected all trees<br>deepseek2:459:459 [3] NCCL INFO Connected all trees<br>deepseek2:458:458 [2] NCCL INFO threadThresholds 8/8/64 | 256/8/64 | 512 | 512<br>deepseek2:458:458 [2] NCCL INFO 4 coll channels, 4 collnet channels, 0 nvls channels, 4 p2p channels, 1 p2p channels per peer<br>deepseek2:459:459 [3] NCCL INFO threadThresholds 8/8/64 | 256/8/64 | 512 | 512<br>deepseek2:459:459 [3] NCCL INFO 4 coll channels, 4 collnet channels, 0 nvls channels, 4 p2p channels, 1 p2p channels per peer<br>deepseek2:463:463 [7] NCCL INFO Connected all trees<br>deepseek2:463:463 [7] NCCL INFO threadThresholds 8/8/64 | 256/8/64 | 512 | 512<br>deepseek2:463:463 [7] NCCL INFO 4 coll channels, 4 collnet channels, 0 nvls channels, 4 p2p channels, 1 p2p channels per peer<br>deepseek2:457:457 [1] NCCL INFO Connected all trees<br>deepseek2:457:457 [1] NCCL INFO threadThresholds 8/8/64 | 256/8/64 | 512 | 512<br>deepseek2:457:457 [1] NCCL INFO 4 coll channels, 4 collnet channels, 0 nvls channels, 4 p2p channels, 1 p2p channels per peer<br>deepseek2:456:456 [0] NCCL INFO Connected all trees<br>deepseek2:456:456 [0] NCCL INFO threadThresholds 8/8/64 | 256/8/64 | 512 | 512<br>deepseek2:456:456 [0] NCCL INFO 4 coll channels, 4 collnet channels, 0 nvls channels, 4 p2p channels, 1 p2p channels per peer<br>deepseek2:457:457 [1] NCCL INFO ncclCommInitRank comm 0xc8103e0 rank 9 nranks 32 cudaDev 1 nvmlDev 1 busId 42000 commId 0x8da567a0342af828 - Init COMPLETE<br>deepseek2:459:459 [3] NCCL INFO ncclCommInitRank comm 0xb0c19c0 rank 11 nranks 32 cudaDev 3 nvmlDev 3 busId 67000 commId 0x8da567a0342af828 - Init COMPLETE<br>deepseek2:462:462 [6] NCCL INFO ncclCommInitRank comm 0xb794080 rank 14 nranks 32 cudaDev 6 nvmlDev 6 busId d0000 commId 0x8da567a0342af828 - Init COMPLETE<br>deepseek2:461:461 [5] NCCL INFO ncclCommInitRank comm 0xc041a00 rank 13 nranks 32 cudaDev 5 nvmlDev 5 busId b1000 commId 0x8da567a0342af828 - Init COMPLETE<br>deepseek2:458:458 [2] NCCL INFO ncclCommInitRank comm 0xb7b98b0 rank 10 nranks 32 cudaDev 2 nvmlDev 2 busId 61000 commId 0x8da567a0342af828 - Init COMPLETE<br>deepseek2:463:463 [7] NCCL INFO ncclCommInitRank comm 0xc41ace0 rank 15 nranks 32 cudaDev 7 nvmlDev 7 busId d3000 commId 0x8da567a0342af828 - Init COMPLETE<br>deepseek2:460:460 [4] NCCL INFO ncclCommInitRank comm 0xc1ff420 rank 12 nranks 32 cudaDev 4 nvmlDev 4 busId ad000 commId 0x8da567a0342af828 - Init COMPLETE<br>deepseek2:456:456 [0] NCCL INFO ncclCommInitRank comm 0xbd9b580 rank 8 nranks 32 cudaDev 0 nvmlDev 0 busId 3d000 commId 0x8da567a0342af828 - Init COMPLETE<br>vLLM NCCL is successful!vLLM NCCL is successful!vLLM NCCL is successful!vLLM NCCL is successful!<br>vLLM NCCL is successful!<br>vLLM NCCL is successful!vLLM NCCL is successful!<br><br><br><br><br>vLLM NCCL is successful!<br>vLLM NCCL with cuda graph is successful!vLLM NCCL with cuda graph is successful!<br>vLLM NCCL with cuda graph is successful!<br>vLLM NCCL with cuda graph is successful!<br>vLLM NCCL with cuda graph is successful!<br>vLLM NCCL with cuda graph is successful!vLLM NCCL with cuda graph is successful!<br>vLLM NCCL with cuda graph is successful!<br><br><br>deepseek2:456:544 [0] NCCL INFO [Service thread] Connection closed by localRank 0<br>deepseek2:458:548 [2] NCCL INFO [Service thread] Connection closed by localRank 2<br>deepseek2:456:544 [0] NCCL INFO [Service thread] Connection closed by localRank 5<br>deepseek2:460:550 [4] NCCL INFO [Service thread] Connection closed by localRank 5<br>deepseek2:457:552 [1] NCCL INFO [Service thread] Connection closed by localRank 1<br>deepseek2:461:549 [5] NCCL INFO [Service thread] Connection closed by localRank 5<br>deepseek2:462:546 [6] NCCL INFO [Service thread] Connection closed by localRank 6<br>deepseek2:459:551 [3] NCCL INFO [Service thread] Connection closed by localRank 3<br>deepseek2:456:544 [0] NCCL INFO [Service thread] Connection closed by localRank 6<br>deepseek2:458:548 [2] NCCL INFO [Service thread] Connection closed by localRank 5<br>deepseek2:463:547 [7] NCCL INFO [Service thread] Connection closed by localRank 7<br>deepseek2:456:544 [0] NCCL INFO [Service thread] Connection closed by localRank 1<br>deepseek2:458:548 [2] NCCL INFO [Service thread] Connection closed by localRank 6<br>deepseek2:460:550 [4] NCCL INFO [Service thread] Connection closed by localRank 6<br>deepseek2:462:546 [6] NCCL INFO [Service thread] Connection closed by localRank 4<br>deepseek2:456:544 [0] NCCL INFO [Service thread] Connection closed by localRank 2<br>deepseek2:458:548 [2] NCCL INFO [Service thread] Connection closed by localRank 0<br>deepseek2:460:550 [4] NCCL INFO [Service thread] Connection closed by localRank 0<br>deepseek2:462:546 [6] NCCL INFO [Service thread] Connection closed by localRank 5<br>deepseek2:456:544 [0] NCCL INFO [Service thread] Connection closed by localRank 4<br>deepseek2:458:548 [2] NCCL INFO [Service thread] Connection closed by localRank 7<br>deepseek2:462:546 [6] NCCL INFO [Service thread] Connection closed by localRank 1<br>deepseek2:460:550 [4] NCCL INFO [Service thread] Connection closed by localRank 4<br>deepseek2:456:544 [0] NCCL INFO [Service thread] Connection closed by localRank 3<br>deepseek2:458:548 [2] NCCL INFO [Service thread] Connection closed by localRank 4<br>deepseek2:462:546 [6] NCCL INFO [Service thread] Connection closed by localRank 3<br>deepseek2:460:550 [4] NCCL INFO [Service thread] Connection closed by localRank 1<br>deepseek2:456:544 [0] NCCL INFO [Service thread] Connection closed by localRank 7<br>deepseek2:458:548 [2] NCCL INFO [Service thread] Connection closed by localRank 1<br>deepseek2:462:546 [6] NCCL INFO [Service thread] Connection closed by localRank 7<br>deepseek2:460:550 [4] NCCL INFO [Service thread] Connection closed by localRank 2<br>deepseek2:458:548 [2] NCCL INFO [Service thread] Connection closed by localRank 3<br>deepseek2:462:546 [6] NCCL INFO [Service thread] Connection closed by localRank 0<br>deepseek2:460:550 [4] NCCL INFO [Service thread] Connection closed by localRank 3<br>deepseek2:462:546 [6] NCCL INFO [Service thread] Connection closed by localRank 2<br>deepseek2:460:550 [4] NCCL INFO [Service thread] Connection closed by localRank 7<br>deepseek2:456:660 [0] NCCL INFO comm 0x8a11620 rank 8 nranks 32 cudaDev 0 busId 3d000 - Abort COMPLETE<br>deepseek2:458:664 [2] NCCL INFO comm 0x8430430 rank 10 nranks 32 cudaDev 2 busId 61000 - Abort COMPLETE<br>deepseek2:462:658 [6] NCCL INFO comm 0x84085f0 rank 14 nranks 32 cudaDev 6 busId d0000 - Abort COMPLETE<br>deepseek2:460:661 [4] NCCL INFO comm 0x8e5a270 rank 12 nranks 32 cudaDev 4 busId ad000 - Abort COMPLETE<br>deepseek2:463:662 [7] NCCL INFO comm 0x9090570 rank 15 nranks 32 cudaDev 7 busId d3000 - Abort COMPLETE<br>deepseek2:461:657 [5] NCCL INFO comm 0x8cb26b0 rank 13 nranks 32 cudaDev 5 busId b1000 - Abort COMPLETE<br>deepseek2:457:659 [1] NCCL INFO comm 0x948a0f0 rank 9 nranks 32 cudaDev 1 busId 42000 - Abort COMPLETE<br>deepseek2:459:663 [3] NCCL INFO comm 0x7d3d650 rank 11 nranks 32 cudaDev 3 busId 67000 - Abort COMPLETE<br>deepseek2:460:636 [32679] NCCL INFO [Service thread] Connection closed by localRank 0<br>deepseek2:462:632 [32661] NCCL INFO [Service thread] Connection closed by localRank 0<br>deepseek2:460:636 [32679] NCCL INFO [Service thread] Connection closed by localRank 2<br>deepseek2:460:636 [32679] NCCL INFO [Service thread] Connection closed by localRank 6<br></code></pre></td></tr></table></figure><h5 id="æŠ¥é”™ä¸å¤„ç†"><a href="#æŠ¥é”™ä¸å¤„ç†" class="headerlink" title="æŠ¥é”™ä¸å¤„ç†"></a>æŠ¥é”™ä¸å¤„ç†</h5><h6 id="é—®é¢˜1-æç¤ºè¶…æ—¶â€torch-distributed-elastic-rendezvous-api-RendezvousTimeoutErrorâ€œ"><a href="#é—®é¢˜1-æç¤ºè¶…æ—¶â€torch-distributed-elastic-rendezvous-api-RendezvousTimeoutErrorâ€œ" class="headerlink" title="é—®é¢˜1-æç¤ºè¶…æ—¶â€torch.distributed.elastic.rendezvous.api.RendezvousTimeoutErrorâ€œ"></a>é—®é¢˜1-æç¤ºè¶…æ—¶â€torch.distributed.elastic.rendezvous.api.RendezvousTimeoutErrorâ€œ</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœåªæ˜¯åœ¨rayé›†ç¾¤çš„ä¸»èŠ‚ç‚¹nodeå®¹å™¨ä¸­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œåˆ™ä¼šæŠ¥é”™ï¼Œå¦‚ä¸‹ã€‚</span><br>root@deepseek1:/vllm-workspace# NCCL_DEBUG=TRACE torchrun --nnodes 4 --nproc-per-node=8 --rdzv_backend=c10d --rdzv_endpoint=10.119.165.139 test.py<br>W0223 01:40:19.140000 1778 torch/distributed/run.py:793] <br>W0223 01:40:19.140000 1778 torch/distributed/run.py:793] *****************************************<br>W0223 01:40:19.140000 1778 torch/distributed/run.py:793] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. <br>W0223 01:40:19.140000 1778 torch/distributed/run.py:793] *****************************************<br>Traceback (most recent call last):<br>  File &quot;/usr/local/bin/torchrun&quot;, line 8, in &lt;module&gt;<br>    sys.exit(main())<br>             ^^^^^^<br>  File &quot;/usr/local/lib/python3.12/dist-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py&quot;, line 355, in wrapper<br>    return f(*args, **kwargs)<br>           ^^^^^^^^^^^^^^^^^^<br>  File &quot;/usr/local/lib/python3.12/dist-packages/torch/distributed/run.py&quot;, line 919, in main<br>    run(args)<br>  File &quot;/usr/local/lib/python3.12/dist-packages/torch/distributed/run.py&quot;, line 910, in run<br>    elastic_launch(<br>  File &quot;/usr/local/lib/python3.12/dist-packages/torch/distributed/launcher/api.py&quot;, line 138, in __call__<br>    return launch_agent(self._config, self._entrypoint, list(args))<br>           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>  File &quot;/usr/local/lib/python3.12/dist-packages/torch/distributed/launcher/api.py&quot;, line 260, in launch_agent<br>    result = agent.run()<br>             ^^^^^^^^^^^<br>  File &quot;/usr/local/lib/python3.12/dist-packages/torch/distributed/elastic/metrics/api.py&quot;, line 137, in wrapper<br>    result = f(*args, **kwargs)<br>             ^^^^^^^^^^^^^^^^^^<br>  File &quot;/usr/local/lib/python3.12/dist-packages/torch/distributed/elastic/agent/server/api.py&quot;, line 696, in run<br>    result = self._invoke_run(role)<br>             ^^^^^^^^^^^^^^^^^^^^^^<br>  File &quot;/usr/local/lib/python3.12/dist-packages/torch/distributed/elastic/agent/server/api.py&quot;, line 849, in _invoke_run<br>    self._initialize_workers(self._worker_group)<br>  File &quot;/usr/local/lib/python3.12/dist-packages/torch/distributed/elastic/metrics/api.py&quot;, line 137, in wrapper<br>    result = f(*args, **kwargs)<br>             ^^^^^^^^^^^^^^^^^^<br>  File &quot;/usr/local/lib/python3.12/dist-packages/torch/distributed/elastic/agent/server/api.py&quot;, line 668, in _initialize_workers<br>    self._rendezvous(worker_group)<br>  File &quot;/usr/local/lib/python3.12/dist-packages/torch/distributed/elastic/metrics/api.py&quot;, line 137, in wrapper<br>    result = f(*args, **kwargs)<br>             ^^^^^^^^^^^^^^^^^^<br>  File &quot;/usr/local/lib/python3.12/dist-packages/torch/distributed/elastic/agent/server/api.py&quot;, line 500, in _rendezvous<br>    rdzv_info = spec.rdzv_handler.next_rendezvous()<br>                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>  File &quot;/usr/local/lib/python3.12/dist-packages/torch/distributed/elastic/rendezvous/dynamic_rendezvous.py&quot;, line 1157, in next_rendezvous<br>    self._op_executor.run(join_op, deadline, self._get_deadline)<br>  File &quot;/usr/local/lib/python3.12/dist-packages/torch/distributed/elastic/rendezvous/dynamic_rendezvous.py&quot;, line 679, in run<br>    raise RendezvousTimeoutError<br>torch.distributed.elastic.rendezvous.api.RendezvousTimeoutError<br></code></pre></td></tr></table></figure><p>è§£å†³åŠæ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨4ä¸ªæœåŠ¡å™¨ä¸Šçš„nodeå®¹å™¨ä¸­åˆ†åˆ«æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</span><br>NCCL_DEBUG=TRACE torchrun --nnodes 4 --nproc-per-node=8 --node-rank 0 --master_addr 10.119.85.141 test.py<br>NCCL_DEBUG=TRACE torchrun --nnodes 4 --nproc-per-node=8 --node-rank 1 --master_addr 10.119.85.141 test.py<br>NCCL_DEBUG=TRACE torchrun --nnodes 4 --nproc-per-node=8 --node-rank 2 --master_addr 10.119.85.141 test.py<br>NCCL_DEBUG=TRACE torchrun --nnodes 4 --nproc-per-node=8 --node-rank 3 --master_addr 10.119.85.141 test.py<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¿…é¡»ç­‰4ä¸ªå®¹å™¨ä¸­çš„å‘½ä»¤éƒ½æ‰§è¡Œèµ·æ¥åï¼Œæµ‹è¯•ç¨‹åºæ‰ä¼šå¾€ä¸‹æ‰§è¡Œä¸è¾“å‡ºç›¸å…³å†…å®¹</span><br></code></pre></td></tr></table></figure><h3 id="3-1-5-å¯åŠ¨æ¨ç†å¼•æ“vllmè¿›ç¨‹"><a href="#3-1-5-å¯åŠ¨æ¨ç†å¼•æ“vllmè¿›ç¨‹" class="headerlink" title="3.1.5 å¯åŠ¨æ¨ç†å¼•æ“vllmè¿›ç¨‹"></a>3.1.5 å¯åŠ¨æ¨ç†å¼•æ“vllmè¿›ç¨‹</h3><h4 id="æ‰§è¡Œå¯åŠ¨"><a href="#æ‰§è¡Œå¯åŠ¨" class="headerlink" title="æ‰§è¡Œå¯åŠ¨"></a>æ‰§è¡Œå¯åŠ¨</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##å¯åŠ¨vllmè¿›ç¨‹çš„å‘½ä»¤å¦‚ä¸‹ï¼ˆå½“ç„¶è¿˜å¯ä»¥æ·»åŠ å…¶ä»–å‚æ•°ã€‚å¯ä½¿ç”¨â€œvllm serve --helpâ€æŸ¥çœ‹ï¼‰</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">vllm serve /path/to/the/model/in/the/container \</span><br><span class="language-bash"><span class="hljs-comment">#     --tensor-parallel-size 8 \</span></span><br><span class="language-bash"><span class="hljs-comment">#     --pipeline-parallel-size 2</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è¿™vllmå®˜ç½‘è¯´å¯ä»¥åœ¨é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹è¿›å…¥nodeå®¹å™¨å¹¶æ‰§è¡Œâ€œvllm serve ...â€ï¼Œä½†åœ¨rayé›†ç¾¤ä¸»èŠ‚ç‚¹å³<span class="hljs-built_in">head</span>èŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤ï¼Œä¼šæç¤ºâ€œNo available node types can fulfill resource requestâ€ã€‚æ‰€ä»¥ç¬”è€…é€‰æ‹©åœ¨rayé›†ç¾¤å‰¯èŠ‚ç‚¹å³workerèŠ‚ç‚¹æ‰§è¡Œ</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ¯”å¦‚åœ¨deepseek2æœåŠ¡å™¨ä¸Šï¼Œå†æ‰“å¼€ä¸€ä¸ªç»ˆç«¯çª—å£å¹¶è¿›å…¥nodeå®¹å™¨ï¼ˆä¹Ÿå¯ä»¥ç»§ç»­ä½¿ç”¨â€œæŸ¥çœ‹rayé›†ç¾¤â€æ­¥éª¤ä¸­æ‰“å¼€çš„å®¹å™¨ä¼šè¯ï¼‰</span><br>(base) deepseek@deepseek2:~$ sudo docker exec -it node /bin/bash<br><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨nodeå®¹å™¨ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¯åŠ¨vllmè¿›ç¨‹ã€‚å°†æœ‰å¾ˆå¤šè¾“å‡ºå†…å®¹ï¼Œä»¥ä¸‹æˆªå–éƒ¨åˆ†</span><br>root@deepseek2:/vllm-workspace# vllm serve /root/.cache/huggingface/hub/models/unsloth/DeepSeek-R1-BF16/ \<br>    --served-model-name DeepSeek-R1-671B \<br>    --enable-prefix-caching \<br>    --max-model-len 32768 \<br>    --gpu-memory-utilization 0.95 \<br>    --tensor-parallel-size 8 \<br>    --pipeline-parallel-size 4 \<br>    --enable-chunked-prefill \<br>    --max-num-batched-tokens 32768 \<br>    --trust-remote-code \<br>    --port 8000 \<br>    --dtype auto \<br>    --api-key zY0MrQwXV9Oo3g==<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç›¸å…³å‚æ•°çš„æ„ä¹‰ï¼Œå‚è€ƒâ€œvllm serve --<span class="hljs-built_in">help</span>â€è¾“å‡ºæˆ–â€œhttps://docs.vllm.ai/en/latest/serving/engine_args.htmlâ€ã€‚</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å…¶ä¸­--tensor-parallel-size æ˜¯æŒ‡æ¯ä¸ªèŠ‚ç‚¹ä¸ŠGPUä¸ªæ•°ï¼Œ--pipeline-parallel-size æŒ‡èŠ‚ç‚¹ä¸ªæ•°</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è¾“å‡ºå†…å®¹å¾ˆå¤šï¼Œä»¥ä¸‹æˆªå–ä¸€éƒ¨åˆ†ï¼ˆåŒ…æ‹¬æœ€åçš„è¾“å‡ºå†…å®¹ï¼‰</span><br>...<br>Loading safetensors checkpoint shards:  96% Completed | 157/163 [00:33&lt;00:01,  3.41it/s]<br>Loading safetensors checkpoint shards:  97% Completed | 158/163 [00:33&lt;00:01,  3.86it/s]<br>Loading safetensors checkpoint shards: 100% Completed | 163/163 [00:33&lt;00:00,  4.85it/s]<br><br>INFO 02-24 04:45:42 model_runner.py:1115] Loading model weights took 35.4806 GB<br>(RayWorkerWrapper pid=1124) INFO 02-24 04:45:44 model_runner.py:1115] Loading model weights took 35.4806 GB<br>(RayWorkerWrapper pid=7564, ip=10.119.165.139) INFO 02-24 04:45:08 custom_all_reduce_utils.py:244] reading GPU P2P access cache from /root/.cache/vllm/gpu_p2p_access_cache_for_0,1,2,3,4,5,6,7.json [repeated 30x across cluster]<br>(RayWorkerWrapper pid=1138) INFO 02-24 04:45:08 cuda.py:161] Using Triton MLA backend. [repeated 31x across cluster]<br>(RayWorkerWrapper pid=976, ip=10.119.85.140) INFO 02-24 04:45:08 utils.py:950] Found nccl from library libnccl.so.2 [repeated 31x across cluster]<br>(RayWorkerWrapper pid=976, ip=10.119.85.140) INFO 02-24 04:45:08 pynccl.py:69] vLLM is using nccl==2.21.5 [repeated 31x across cluster]<br>(RayWorkerWrapper pid=1149) NCCL version 2.21.5+cuda12.4 [repeated 7x across cluster]<br>(RayWorkerWrapper pid=1149) deepseek2:1149:1149 [7] NCCL INFO Channel 15/0 : 7[7] -&gt; 6[6] via P2P/IPC/read [repeated 43x across cluster]<br>(RayWorkerWrapper pid=1116)  09/0 : 3[3] -&gt; 2[2] via P2P/IPC/read [repeated 2x across cluster]<br>(RayWorkerWrapper pid=1149) deepseek2:1149:1149 [7] NCCL INFO Connected all trees [repeated 6x across cluster]<br>(RayWorkerWrapper pid=1149) deepseek2:1149:1149 [7] NCCL INFO threadThresholds 8/8/64 | 64/8/64 | 512 | 512 [repeated 6x across cluster]<br>(RayWorkerWrapper pid=1149) deepseek2:1149:1149 [7] NCCL INFO 16 coll channels, 16 collnet channels, 0 nvls channels, 16 p2p channels, 16 p2p channels per peer [repeated 6x across cluster]<br>(RayWorkerWrapper pid=1149) deepseek2:1149:1149 [7] NCCL INFO TUNER/Plugin: Plugin load returned 2 : libnccl-net.so: cannot open shared object file: No such file or directory : when loading libnccl-tuner.so [repeated 6x across cluster]<br>(RayWorkerWrapper pid=1149) deepseek2:1149:1149 [7] NCCL INFO TUNER/Plugin: Using internal tuner plugin. [repeated 6x across cluster]<br>(RayWorkerWrapper pid=1149) deepseek2:1149:1149 [7] NCCL INFO ncclCommInitRank comm 0xd15faf0 rank 7 nranks 8 cudaDev 7 nvmlDev 7 busId d3000 commId 0x7f39c29d5bac68b4 - Init COMPLETE [repeated 6x across cluster]<br>(RayWorkerWrapper pid=1115) Channel 09/0 : 6[6] -&gt; 5[5] via P2P/IPC/read [repeated 2x across cluster]<br>(RayWorkerWrapper pid=973, ip=10.119.85.140) INFO 02-24 04:45:08 shm_broadcast.py:258] vLLM message queue communication handle: Handle(connect_ip=&#x27;127.0.0.1&#x27;, local_reader_ranks=[1, 2, 3, 4, 5, 6, 7], buffer_handle=(7, 4194304, 6, &#x27;psm_3a784ba1&#x27;), local_subscribe_port=56925, remote_subscribe_port=None) [repeated 2x across cluster]<br>(RayWorkerWrapper pid=976, ip=10.119.85.140) INFO 02-24 04:45:08 model_runner.py:1110] Starting to load model /root/.cache/huggingface/hub/models/unsloth/DeepSeek-R1-BF16/... [repeated 30x across cluster]<br>(RayWorkerWrapper pid=978, ip=10.119.85.140) INFO 02-24 04:46:17 model_runner.py:1115] Loading model weights took 42.8992 GB [repeated 7x across cluster]<br>...<br>...<br>...<br>(RayWorkerWrapper pid=7565, ip=10.119.165.139) deepseek1:7565:7565 [1] NCCL INFO P2P Chunksize set to 131072<br>(RayWorkerWrapper pid=7565, ip=10.119.165.139) deepseek1:7565:7565 [1] NCCL INFO Channel 00/0 : 2[1] -&gt; 3[1] [receive] via NET/IB/1<br>(RayWorkerWrapper pid=7565, ip=10.119.165.139) deepseek1:7565:7565 [1] NCCL INFO Channel 01/0 : 2[1] -&gt; 3[1] [receive] via NET/IB/1<br>(RayWorkerWrapper pid=7565, ip=10.119.165.139) deepseek1:7565:7565 [1] NCCL INFO Channel 00/0 : 3[1] -&gt; 0[1] [send] via NET/IB/1<br>(RayWorkerWrapper pid=7565, ip=10.119.165.139) deepseek1:7565:7565 [1] NCCL INFO Channel 01/0 : 3[1] -&gt; 0[1] [send] via NET/IB/1<br>(RayWorkerWrapper pid=7565, ip=10.119.165.139) deepseek1:7565:31505 [1] NCCL INFO NCCL_IB_GID_INDEX set by environment to 3.<br>(RayWorkerWrapper pid=7565, ip=10.119.165.139) deepseek1:7565:7565 [1] NCCL INFO Connected all rings<br>(RayWorkerWrapper pid=7565, ip=10.119.165.139) deepseek1:7565:7565 [1] NCCL INFO Channel 01/0 : 1[1] -&gt; 3[1] [receive] via NET/IB/1<br>(RayWorkerWrapper pid=7565, ip=10.119.165.139) deepseek1:7565:7565 [1] NCCL INFO Channel 01/0 : 3[1] -&gt; 1[1] [send] via NET/IB/1<br>(RayWorkerWrapper pid=7565, ip=10.119.165.139) deepseek1:7565:7565 [1] NCCL INFO Channel 00/0 : 3[1] -&gt; 2[1] [send] via NET/IB/1<br>(RayWorkerWrapper pid=7565, ip=10.119.165.139) deepseek1:7565:7565 [1] NCCL INFO Connected all trees<br>(RayWorkerWrapper pid=7565, ip=10.119.165.139) deepseek1:7565:7565 [1] NCCL INFO threadThresholds 8/8/64 | 32/8/64 | 512 | 512<br>(RayWorkerWrapper pid=7565, ip=10.119.165.139) deepseek1:7565:7565 [1] NCCL INFO 2 coll channels, 2 collnet channels, 0 nvls channels, 2 p2p channels, 2 p2p channels per peer<br>(RayWorkerWrapper pid=7565, ip=10.119.165.139) deepseek1:7565:7565 [1] NCCL INFO ncclCommInitRank comm 0x1179c2d0 rank 3 nranks 4 cudaDev 1 nvmlDev 1 busId 42000 commId 0x8b115fa040bc44fc - Init COMPLETE<br>(RayWorkerWrapper pid=7565, ip=10.119.165.139) deepseek1:7565:31563 [1] NCCL INFO Using non-device net plugin version 0<br>(RayWorkerWrapper pid=7565, ip=10.119.165.139) deepseek1:7565:31563 [1] NCCL INFO Using network IB<br>(RayWorkerWrapper pid=7565, ip=10.119.165.139) deepseek1:7565:31563 [1] NCCL INFO ncclCommInitRank comm 0x30ca9860 rank 1 nranks 8 cudaDev 1 nvmlDev 1 busId 42000 commId 0xd37e8e722df3123f - Init START<br>(RayWorkerWrapper pid=7565, ip=10.119.165.139) deepseek1:7565:31563 [1] NCCL INFO Setting affinity for GPU 1 to 0fffff,ff000000,0fffffff<br>(RayWorkerWrapper pid=7565, ip=10.119.165.139) deepseek1:7565:31563 [1] NCCL INFO NVLS multicast support is not available on dev 1<br>(RayWorkerWrapper pid=7565, ip=10.119.165.139) deepseek1:7565:31563 [1] NCCL INFO comm 0x30ca9860 rank 1 nRanks 8 nNodes 1 localRanks 8 localRank 1 MNNVL 0<br>(RayWorkerWrapper pid=7565, ip=10.119.165.139) deepseek1:7565:31563 [1] NCCL INFO Trees [0] 2/-1/-1-&gt;1-&gt;0 [1] 2/-1/-1-&gt;1-&gt;0 [2] 2/-1/-1-&gt;1-&gt;0 [3] 2/-1/-1-&gt;1-&gt;0 [4] 2/-1/-1-&gt;1-&gt;0 [5] 2/-1/-1-&gt;1-&gt;0 [6] 2/-1/-1-&gt;1-&gt;0 [7] 2/-1/-1-&gt;1-&gt;0 [8] 2/-1/-1-&gt;1-&gt;0 [9] 2/-1/-1-&gt;1-&gt;0 [10] 2/-1/-1-&gt;1-&gt;0 [11] 2/-1/-1-&gt;1-&gt;0 [12] 2/-1/-1-&gt;1-&gt;0 [13] 2/-1/-1-&gt;1-&gt;0 [14] 2/-1/-1-&gt;1-&gt;0 [15] 2/-1/-1-&gt;1-&gt;0<br>(RayWorkerWrapper pid=7565, ip=10.119.165.139) deepseek1:7565:31563 [1] NCCL INFO P2P Chunksize set to 524288<br>(RayWorkerWrapper pid=7565, ip=10.119.165.139) deepseek1:7565:31563 [1] NCCL INFO Channel 00/0 : 1[1] -&gt; 2[2] via P2P/IPC/read<br>(RayWorkerWrapper pid=7565, ip=10.119.165.139) deepseek1:7565:31563 [1] NCCL INFO Channel 01/0 : 1[1] -&gt; 2[2] via P2P/IPC/read<br>(RayWorkerWrapper pid=7565, ip=10.119.165.139) deepseek1:7565:31563 [1] NCCL INFO Channel 02/0 : 1[<br>(RayWorkerWrapper pid=7587, ip=10.119.165.139) ] NCCL INFO Connected all rings<br>(RayWorkerWrapper pid=7591, ip=10.119.165.139)  Channel 09/0 : 7[7] -&gt; 6[6] via P2P/IPC/read<br>(RayWorkerWrapper pid=7580, ip=10.119.165.139) 4[4] -&gt; 3[3] via P2P/IPC/read<br>(RayWorkerWrapper pid=7580, ip=10.119.165.139) deepseek1:7580:31567 [4] NCCL I<br>(RayWorkerWrapper pid=7591, ip=10.119.165.139) <br>(RayWorkerWrapper pid=7591, ip=10.119.165.139) deepseek1:759<br>(RayWorkerWrapper pid=7580, ip=10.119.165.139) NFO Channel 02/0 : 4[4] -&gt; 5[5] via P2P/IPC/read<br>(RayWorkerWrapper pid=7580, ip=10.119.165.139) deepseek1:7580:31594 [4] NCCL INFO Channel 15<br>INFO 02-24 17:15:16 executor_base.py:110] # CUDA blocks: 68440, # CPU blocks: 13107<br>...<br>...<br>...<br>Capturing CUDA graph shapes:  43%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–                                                                                | 15/35 [00:06&lt;00:09,  2.18it/s]<br>Capturing CUDA graph shapes:  91%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 32/35 [00:13&lt;00:01,  2.46it/s]<br>Capturing CUDA graph shapes:  46%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–                                                                            | 16/35 [00:07&lt;00:08,  2.18it/s]<br>Capturing CUDA graph shapes:  94%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 33/35 [00:13&lt;00:00,  2.46it/s]<br>Capturing CUDA graph shapes:  49%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–                                                                        | 17/35 [00:07&lt;00:08,  2.19it/s]<br>Capturing CUDA graph shapes:  97%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹| 34/35 [00:13&lt;00:00,  2.47it/s]<br>Capturing CUDA graph shapes:  51%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ                                                                    | 18/35 [00:08&lt;00:07,  2.13it/s]<br>Capturing CUDA graph shapes: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 35/35 [00:14&lt;00:00,  2.47it/s]<br>Capturing CUDA graph shapes:  63%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹                                                    | 22/35 [00:10&lt;00:06,  2.07it/s]<br>Capturing CUDA graph shapes:  89%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š | 31/35 [00:13&lt;00:01,  2.36it/s] [repeated 24x across cluster]<br>Capturing CUDA graph shapes:  66%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹                                                | 23/35 [00:10&lt;00:05,  2.08it/s]<br>(RayWorkerWrapper pid=974, ip=10.119.85.140) INFO 02-24 04:48:08 model_runner.py:1562] Graph capturing finished in 64 secs, took 1.19 GiB<br>Capturing CUDA graph shapes:  71%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹                                        | 25/35 [00:11&lt;00:04,  2.04it/s]<br>(RayWorkerWrapper pid=7561, ip=10.119.165.139) INFO 02-24 04:48:09 custom_all_reduce.py:226] Registering 4480 cuda graph addresses [repeated 16x across cluster]<br>Capturing CUDA graph shapes: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 35/35 [00:15&lt;00:00,  2.19it/s]<br>INFO 02-24 04:48:13 custom_all_reduce.py:226] Registering 4340 cuda graph addresses<br>(RayWorkerWrapper pid=7564, ip=10.119.165.139) INFO 02-24 04:48:13 model_runner.py:1562] Graph capturing finished in 68 secs, took 1.19 GiB [repeated 23x across cluster]<br>(RayWorkerWrapper pid=1138) INFO 02-24 04:48:18 custom_all_reduce.py:226] Registering 4340 cuda graph addresses [repeated 14x across cluster]<br>INFO 02-24 04:48:18 model_runner.py:1562] Graph capturing finished in 73 secs, took 1.16 GiB<br>INFO 02-24 04:48:18 llm_engine.py:431] init engine (profile, create kv cache, warmup model) took 84.43 seconds<br>INFO 02-24 04:48:18 api_server.py:756] Using supplied chat template:<br>INFO 02-24 04:48:18 api_server.py:756] None<br>INFO 02-24 04:48:18 launcher.py:21] Available routes are:<br>INFO 02-24 04:48:18 launcher.py:29] Route: /openapi.json, Methods: HEAD, GET<br>INFO 02-24 04:48:18 launcher.py:29] Route: /docs, Methods: HEAD, GET<br>INFO 02-24 04:48:18 launcher.py:29] Route: /docs/oauth2-redirect, Methods: HEAD, GET<br>INFO 02-24 04:48:18 launcher.py:29] Route: /redoc, Methods: HEAD, GET<br>INFO 02-24 04:48:18 launcher.py:29] Route: /health, Methods: GET<br>INFO 02-24 04:48:18 launcher.py:29] Route: /ping, Methods: GET, POST<br>INFO 02-24 04:48:18 launcher.py:29] Route: /tokenize, Methods: POST<br>INFO 02-24 04:48:18 launcher.py:29] Route: /detokenize, Methods: POST<br>INFO 02-24 04:48:18 launcher.py:29] Route: /v1/models, Methods: GET<br>INFO 02-24 04:48:18 launcher.py:29] Route: /version, Methods: GET<br>INFO 02-24 04:48:18 launcher.py:29] Route: /v1/chat/completions, Methods: POST<br>INFO 02-24 04:48:18 launcher.py:29] Route: /v1/completions, Methods: POST<br>INFO 02-24 04:48:18 launcher.py:29] Route: /v1/embeddings, Methods: POST<br>INFO 02-24 04:48:18 launcher.py:29] Route: /pooling, Methods: POST<br>INFO 02-24 04:48:18 launcher.py:29] Route: /score, Methods: POST<br>INFO 02-24 04:48:18 launcher.py:29] Route: /v1/score, Methods: POST<br>INFO 02-24 04:48:18 launcher.py:29] Route: /rerank, Methods: POST<br>INFO 02-24 04:48:18 launcher.py:29] Route: /v1/rerank, Methods: POST<br>INFO 02-24 04:48:18 launcher.py:29] Route: /v2/rerank, Methods: POST<br>INFO 02-24 04:48:18 launcher.py:29] Route: /invocations, Methods: POST<br>INFO:     Started server process [12020]<br>INFO:     Waiting for application startup.<br>INFO:     Application startup complete.<br>INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/24/V8FOf1Q4Z6Ww9sg.png" alt="image-20250224205008780"></p><h4 id="æŠ¥é”™ä¸å¤„ç†-1"><a href="#æŠ¥é”™ä¸å¤„ç†-1" class="headerlink" title="æŠ¥é”™ä¸å¤„ç†"></a>æŠ¥é”™ä¸å¤„ç†</h4><h5 id="é—®é¢˜1-æ‰§è¡Œâ€vllm-serveâ€æç¤ºâ€œError-executing-method-â€˜determine-num-available-blocksâ€™-This-might-cause-deadlock-in-distributed-executionâ€"><a href="#é—®é¢˜1-æ‰§è¡Œâ€vllm-serveâ€æç¤ºâ€œError-executing-method-â€˜determine-num-available-blocksâ€™-This-might-cause-deadlock-in-distributed-executionâ€" class="headerlink" title="é—®é¢˜1-æ‰§è¡Œâ€vllm serveâ€æç¤ºâ€œError executing method â€˜determine_num_available_blocksâ€™. This might cause deadlock in distributed executionâ€"></a>é—®é¢˜1-æ‰§è¡Œâ€vllm serveâ€æç¤ºâ€œError executing method â€˜determine_num_available_blocksâ€™. This might cause deadlock in distributed executionâ€</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ—¶æŠ¥é”™ï¼ŒæŠ¥é”™ä¿¡æ¯çš„éƒ¨åˆ†å¦‚ä¸‹ï¼š</span><br>root@deepseek1:/vllm-workspace# vllm serve /root/.cache/huggingface/hub/models/deepseek-ai/DeepSeek-R1 \<br>    --tensor-parallel-size 8 \<br>    --pipeline-parallel-size 4 \<br>    --trust-remote-code \<br>    --host 0.0.0.0 \<br>    --port 8000 \<br>    --enforce-eager<br>...<br>Loading safetensors checkpoint shards:  95% Completed | 155/163 [00:10&lt;00:00, 22.69it/s]<br>Loading safetensors checkpoint shards:  97% Completed | 158/163 [00:11&lt;00:00, 18.17it/s]<br>Loading safetensors checkpoint shards:  99% Completed | 161/163 [00:11&lt;00:00, 18.87it/s]<br>Loading safetensors checkpoint shards: 100% Completed | 163/163 [00:11&lt;00:00, 14.15it/s]<br><br>INFO 02-22 06:50:13 model_runner.py:1115] Loading model weights took 18.1361 GB<br>(RayWorkerWrapper pid=5507) INFO 02-22 06:50:18 model_runner.py:1115] Loading model weights took 18.1361 GB<br>(pid=1451, ip=10.119.165.141) INFO 02-22 06:49:57 __init__.py:190] Automatically detected platform cuda. [repeated 31x across cluster] (Ray deduplicates logs by default. Set RAY_DEDUP_LOGS=0 to disable log deduplication, or see https://docs.ray.io/en/master/ray-observability/user-guides/configure-logging.html#log-deduplication for more options.)<br>(RayWorkerWrapper pid=1447, ip=10.119.165.138) INFO 02-22 06:50:01 cuda.py:161] Using Triton MLA backend. [repeated 61x across cluster]<br>(RayWorkerWrapper pid=1451, ip=10.119.165.141) WARNING 02-22 06:49:59 triton_decode_attention.py:44] The following error message &#x27;operation scheduled before its operands&#x27; can be ignored. [repeated 30x across cluster]<br>(RayWorkerWrapper pid=5486) INFO 02-22 06:50:01 utils.py:950] Found nccl from library libnccl.so.2 [repeated 61x across cluster]<br>(RayWorkerWrapper pid=5486) INFO 02-22 06:50:01 pynccl.py:69] vLLM is using nccl==2.21.5 [repeated 61x across cluster]<br>(RayWorkerWrapper pid=1447, ip=10.119.165.138) INFO 02-22 06:50:01 custom_all_reduce_utils.py:244] reading GPU P2P access cache from /root/.cache/vllm/gpu_p2p_access_cache_for_0,1,2,3,4,5,6,7.json [repeated 30x across cluster]<br>(RayWorkerWrapper pid=1444, ip=10.119.165.141) INFO 02-22 06:50:01 shm_broadcast.py:258] vLLM message queue communication handle: Handle(connect_ip=&#x27;127.0.0.1&#x27;, local_reader_ranks=[1, 2, 3, 4, 5, 6, 7], buffer_handle=(7, 4194304, 6, &#x27;psm_9dec0a20&#x27;), local_subscribe_port=44443, remote_subscribe_port=None) [repeated 2x across cluster]<br>(RayWorkerWrapper pid=1451, ip=10.119.165.141) INFO 02-22 06:50:01 model_runner.py:1110] Starting to load model /root/.cache/huggingface/hub/models/deepseek-ai/DeepSeek-R1... [repeated 30x across cluster]<br>(RayWorkerWrapper pid=1451, ip=10.119.165.141) WARNING 02-22 06:50:01 utils.py:159] The model class DeepseekV3ForCausalLM has not defined `packed_modules_mapping`, this may lead to incorrect mapping of quantized or ignored modules [repeated 30x across cluster]<br>(RayWorkerWrapper pid=1450, ip=10.119.165.141) INFO 02-22 06:50:23 model_runner.py:1115] Loading model weights took 23.1804 GB [repeated 23x across cluster]<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574] Error executing method &#x27;determine_num_available_blocks&#x27;. This might cause deadlock in distributed execution.<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574] Traceback (most recent call last):<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/triton/language/core.py&quot;, line 35, in wrapper<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     return fn(*args, **kwargs)<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]            ^^^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/triton/language/core.py&quot;, line 993, in to<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     return semantic.cast(self, dtype, _builder, fp_downcast_rounding)<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/triton/language/semantic.py&quot;, line 759, in cast<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     assert builder.options.allow_fp8e4nv, &quot;fp8e4nv data type is not supported on CUDA arch &lt; 89&quot;<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574] AssertionError: fp8e4nv data type is not supported on CUDA arch &lt; 89<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574] <br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574] The above exception was the direct cause of the following exception:<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574] <br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574] Traceback (most recent call last):<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/vllm/worker/worker_base.py&quot;, line 566, in execute_method<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     return run_method(target, method, args, kwargs)<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/vllm/utils.py&quot;, line 2220, in run_method<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     return func(*args, **kwargs)<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]            ^^^^^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/torch/utils/_contextlib.py&quot;, line 116, in decorate_context<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     return func(*args, **kwargs)<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]            ^^^^^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/vllm/worker/worker.py&quot;, line 229, in determine_num_available_blocks<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     self.model_runner.profile_run()<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/torch/utils/_contextlib.py&quot;, line 116, in decorate_context<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     return func(*args, **kwargs)<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]            ^^^^^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/vllm/worker/model_runner.py&quot;, line 1235, in profile_run<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     self._dummy_run(max_num_batched_tokens, max_num_seqs)<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/vllm/worker/model_runner.py&quot;, line 1346, in _dummy_run<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     self.execute_model(model_input, kv_caches, intermediate_tensors)<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/torch/utils/_contextlib.py&quot;, line 116, in decorate_context<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     return func(*args, **kwargs)<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]            ^^^^^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/vllm/worker/model_runner.py&quot;, line 1719, in execute_model<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     hidden_or_intermediate_states = model_executable(<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]                                     ^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py&quot;, line 1736, in _wrapped_call_impl<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     return self._call_impl(*args, **kwargs)<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py&quot;, line 1747, in _call_impl<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     return forward_call(*args, **kwargs)<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/vllm/model_executor/models/deepseek_v2.py&quot;, line 687, in forward<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     hidden_states = self.model(input_ids, positions, kv_caches,<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/vllm/compilation/decorators.py&quot;, line 172, in __call__<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     return self.forward(*args, **kwargs)<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/vllm/model_executor/models/deepseek_v2.py&quot;, line 643, in forward<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     hidden_states, residual = layer(positions, hidden_states,<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py&quot;, line 1736, in _wrapped_call_impl<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     return self._call_impl(*args, **kwargs)<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py&quot;, line 1747, in _call_impl<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     return forward_call(*args, **kwargs)<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/vllm/model_executor/models/deepseek_v2.py&quot;, line 561, in forward<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     hidden_states = self.self_attn(<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]                     ^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py&quot;, line 1736, in _wrapped_call_impl<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     return self._call_impl(*args, **kwargs)<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py&quot;, line 1747, in _call_impl<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     return forward_call(*args, **kwargs)<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/vllm/model_executor/models/deepseek_v2.py&quot;, line 473, in forward<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     ckq = self.q_a_proj(hidden_states)[0]<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py&quot;, line 1736, in _wrapped_call_impl<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     return self._call_impl(*args, **kwargs)<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/torch/nn/modules/module.py&quot;, line 1747, in _call_impl<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     return forward_call(*args, **kwargs)<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/vllm/model_executor/layers/linear.py&quot;, line 248, in forward<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     output = self.quant_method.apply(self, x, bias)<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/vllm/model_executor/layers/quantization/fp8.py&quot;, line 359, in apply<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     return apply_w8a8_block_fp8_linear(<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/vllm/model_executor/layers/quantization/utils/fp8_utils.py&quot;, line 70, in apply_w8a8_block_fp8_linear<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     q_input, x_scale = per_token_group_quant_fp8(input_2d,<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/vllm/model_executor/layers/quantization/utils/fp8_utils.py&quot;, line 307, in per_token_group_quant_fp8<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     _per_token_group_quant_fp8[(M, )](<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/triton/runtime/jit.py&quot;, line 345, in &lt;lambda&gt;<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     return lambda *args, **kwargs: self.run(grid=grid, warmup=False, *args, **kwargs)<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/triton/runtime/jit.py&quot;, line 662, in run<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     kernel = self.compile(<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]              ^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/triton/compiler/compiler.py&quot;, line 276, in compile<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     module = src.make_ir(options, codegen_fns, context)<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]   File &quot;/usr/local/lib/python3.12/dist-packages/triton/compiler/compiler.py&quot;, line 113, in make_ir<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     return ast_to_ttir(self.fn, self, context=context, options=options, codegen_fns=codegen_fns)<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574] triton.compiler.errors.CompilationError: at 32:10:<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     y_ptr += g_id * group_size<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     y_q_ptr += g_id * group_size<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     y_s_ptr += g_id<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574] <br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     cols = tl.arange(0, BLOCK)  # N &lt;= BLOCK<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     mask = cols &lt; group_size<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574] <br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     y = tl.load(y_ptr + cols, mask=mask, other=0.0).to(tl.float32)<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     # Quant<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     _absmax = tl.maximum(tl.max(tl.abs(y)), eps)<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     y_s = _absmax / fp8_max<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]     y_q = tl.clamp(y / y_s, fp8_min, fp8_max).to(y_q_ptr.dtype.element_ty)<br>(RayWorkerWrapper pid=1444, ip=10.119.165.140) ERROR 02-22 06:50:24 worker_base.py:574]           ^<br>ERROR 02-22 06:50:25 worker_base.py:574] Error executing method &#x27;determine_num_available_blocks&#x27;. This might cause deadlock in distributed execution.<br>...<br></code></pre></td></tr></table></figure><p>é—®é¢˜åˆ†æï¼š</p><p>DeepSeek-R1:671Bæ˜¯fp8 æ¨¡å‹ï¼Œéœ€è¦åœ¨æ”¯æŒfp8æ•°æ®ç±»å‹çš„GPUä¸Šè¿è¡Œï¼Œä½†NVIDIA A800ï¼ˆA800è·ŸA100è®¾è®¡ä¸ŠåŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å‡é…äº†ï¼‰ä¸æ”¯æŒfp8æ•°æ®ç±»å‹ã€‚<a href="https://github.com/vllm-project/vllm/issues/12581#issuecomment-2625310475">https://github.com/vllm-project/vllm/issues/12581#issuecomment-2625310475</a> ã€ <a href="https://github.com/vllm-project/vllm/issues?q=fp8e4nv%20data%20type%20is%20not%20supported%20on%20CUDA%20arch%20%3C%2089%E3%80%81https://github.com/vllm-project/vllm/issues/12581">https://github.com/vllm-project/vllm/issues?q=fp8e4nv%20data%20type%20is%20not%20supported%20on%20CUDA%20arch%20%3C%2089ã€https://github.com/vllm-project/vllm/issues/12581</a></p><h3 id="3-1-6-å†æ¬¡æŸ¥çœ‹rayé›†ç¾¤çŠ¶æ€"><a href="#3-1-6-å†æ¬¡æŸ¥çœ‹rayé›†ç¾¤çŠ¶æ€" class="headerlink" title="3.1.6 å†æ¬¡æŸ¥çœ‹rayé›†ç¾¤çŠ¶æ€"></a>3.1.6 å†æ¬¡æŸ¥çœ‹rayé›†ç¾¤çŠ¶æ€</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@deepseek1:/vllm-workspace# ray status<br>======== Autoscaler status: 2025-02-24 06:09:38.499412 ========<br>Node status<br>---------------------------------------------------------------<br>Active:<br> 1 node_78c610008905942ec65274e7c7ce990d1a554e9627512bf633c15c28<br> 1 node_0aee3e0efd8a7f95dfa4205cd692f7f08e7d665b779a0facf0d3201d<br> 1 node_8407508c22842dea6182c7accc2565b42daf4c7b051f1d37a4629258<br> 1 node_3ec95e5ee056a4484f0f81cc518716edd4d2bfd98ffa771b024edc27<br>Pending:<br> (no pending nodes)<br>Recent failures:<br> (no failures)<br><br>Resources<br>---------------------------------------------------------------<br>Usage:<br> 0.0/448.0 CPU<br> 32.0/32.0 GPU (32.0 used of 32.0 reserved in placement groups)<br> 0B/3.89TiB memory<br> 0B/38.91GiB object_store_memory<br><br>Demands:<br> (no resource demands)<br><span class="hljs-meta prompt_"> </span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">32å—GPUéƒ½å¤„äºä½¿ç”¨çŠ¶æ€äº†</span><br></code></pre></td></tr></table></figure><h3 id="3-1-7-Production-Metrics"><a href="#3-1-7-Production-Metrics" class="headerlink" title="3.1.7 Production Metrics"></a>3.1.7 Production Metrics</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell">(self-llm) deepseek@deepseek2:~$ curl http://10.119.85.138:8000/metrics<br>540    0     # TYPE python_gc_objects_collected_total counter<br>0  7756k   python_gc_objects_collected_total&#123;generation=&quot;0&quot;&#125; 37427.0<br>   0 --:python_gc_objects_collected_total&#123;generation=&quot;1&quot;&#125; 14232.0<br>--:-- --:--:-- python_gc_objects_collected_total&#123;generation=&quot;2&quot;&#125; 16818.0<br>--:--:-- 9615k<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP python_gc_objects_uncollectable_total Uncollectable objects found during GC</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE python_gc_objects_uncollectable_total counter</span><br>python_gc_objects_uncollectable_total&#123;generation=&quot;0&quot;&#125; 0.0<br>python_gc_objects_uncollectable_total&#123;generation=&quot;1&quot;&#125; 0.0<br>python_gc_objects_uncollectable_total&#123;generation=&quot;2&quot;&#125; 0.0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP python_gc_collections_total Number of <span class="hljs-built_in">times</span> this generation was collected</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE python_gc_collections_total counter</span><br>python_gc_collections_total&#123;generation=&quot;0&quot;&#125; 3033.0<br>python_gc_collections_total&#123;generation=&quot;1&quot;&#125; 267.0<br>python_gc_collections_total&#123;generation=&quot;2&quot;&#125; 315.0<br>...<br></code></pre></td></tr></table></figure><h3 id="3-1-8-openai-APIæ¥å£æµ‹è¯•"><a href="#3-1-8-openai-APIæ¥å£æµ‹è¯•" class="headerlink" title="3.1.8 openai APIæ¥å£æµ‹è¯•"></a>3.1.8 openai APIæ¥å£æµ‹è¯•</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å…¶ä¸­ 10.119.85.138 æ˜¯deepseek2èŠ‚ç‚¹çš„IBç½‘å¡IP</span><br>(self-llm) deepseek@deepseek2:~$ curl 10.119.85.138:8000/v1/models -H &quot;Authorization: Bearer zY0MrQwXV9Oo3g==&quot; | jq  <br><span class="hljs-meta prompt_">#</span><span class="language-bash">è¾“å‡ºå†…å®¹å¦‚ä¸‹</span><br><span class="hljs-meta prompt_">  % </span><span class="language-bash">Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br>                                 Dload  Upload   Total   Spent    Left  Speed<br>100   523  100   523    0     0   105k      0 --:--:-- --:--:-- --:--:--  127k<br>&#123;<br>  &quot;object&quot;: &quot;list&quot;,<br>  &quot;data&quot;: [<br>    &#123;<br>      &quot;id&quot;: &quot;DeepSeek-R1-671B&quot;,<br>      &quot;object&quot;: &quot;model&quot;,<br>      &quot;created&quot;: 1740405511,<br>      &quot;owned_by&quot;: &quot;vllm&quot;,<br>      &quot;root&quot;: &quot;/root/.cache/huggingface/hub/models/unsloth/DeepSeek-R1-BF16/&quot;,<br>      &quot;parent&quot;: null,<br>      &quot;max_model_len&quot;: 32768,<br>      &quot;permission&quot;: [<br>        &#123;<br>          &quot;id&quot;: &quot;modelperm-ced685e8156b4618b593580109205165&quot;,<br>          &quot;object&quot;: &quot;model_permission&quot;,<br>          &quot;created&quot;: 1740405511,<br>          &quot;allow_create_engine&quot;: false,<br>          &quot;allow_sampling&quot;: true,<br>          &quot;allow_logprobs&quot;: true,<br>          &quot;allow_search_indices&quot;: false,<br>          &quot;allow_view&quot;: true,<br>          &quot;allow_fine_tuning&quot;: false,<br>          &quot;organization&quot;: &quot;*&quot;,<br>          &quot;group&quot;: null,<br>          &quot;is_blocking&quot;: false<br>        &#125;<br>      ]<br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure><p>åŒæ—¶åœ¨vllm serveå‘½ä»¤æ‰§è¡Œçš„çª—å£ä¼šçœ‹åˆ°å¦‚ä¸‹è¾“å‡ºå†…å®¹</p><p><img src="https://s2.loli.net/2025/02/24/F3td4gkAeSfwijK.png" alt="image-20250224215955409"></p><h3 id="3-1-9-æœåŠ¡åŠŸèƒ½éªŒè¯"><a href="#3-1-9-æœåŠ¡åŠŸèƒ½éªŒè¯" class="headerlink" title="3.1.9 æœåŠ¡åŠŸèƒ½éªŒè¯"></a>3.1.9 æœåŠ¡åŠŸèƒ½éªŒè¯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell">(self-llm) deepseek@deepseek2:~$ curl -X POST &quot;http://10.119.85.138:8000/v1/chat/completions&quot; -H &quot;Content-Type: application/json&quot; -H &quot;Authorization: Bearer zY0MrQwXV9Oo3g==&quot;  -d &#x27;&#123; &quot;model&quot;: &quot;DeepSeek-R1-671B&quot;, &quot;messages&quot;: [&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;ä½ å¥½&quot;&#125;]&#125;&#x27;<br>    <br>(self-llm) deepseek@deepseek2:~$ curl -X POST &quot;http://10.119.85.138:8000/v1/chat/completions&quot; -H &quot;Content-Type: application/json&quot; -H &quot;Authorization: Bearer zY0MrQwXV9Oo3g==&quot;  -d &#x27;&#123; &quot;model&quot;: &quot;DeepSeek-R1-671B&quot;, &quot;messages&quot;: [&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;è¯·è¯æ˜å‹¾è‚¡å®šç†&quot;&#125;]&#125;&#x27;<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å›ç­”</span><br>&#123;&quot;id&quot;:&quot;chatcmpl-11ae1ddf321343af848b5c683e67b72d&quot;,&quot;object&quot;:&quot;chat.completion&quot;,&quot;created&quot;:1740411348,&quot;model&quot;:&quot;deepseek-r1&quot;,&quot;choices&quot;:[&#123;&quot;index&quot;:0,&quot;message&quot;:&#123;&quot;role&quot;:&quot;assistant&quot;,&quot;reasoning_content&quot;:null,&quot;content&quot;:&quot;&lt;think&gt;\nå—¯ï¼Œç”¨æˆ·è®©æˆ‘è¯æ˜å‹¾è‚¡å®šç†ã€‚å‹¾è‚¡å®šç†æ˜¯æ•°å­¦é‡Œéå¸¸åŸºç¡€ä½†åˆé‡è¦çš„å®šç†ï¼Œè‚¯å®šæœ‰å¾ˆå¤šä¸åŒçš„è¯æ˜æ–¹æ³•ã€‚å…ˆå›å¿†ä¸€ä¸‹ï¼Œå‹¾è‚¡å®šç†æ˜¯è¯´åœ¨ç›´è§’ä¸‰è§’å½¢ä¸­ï¼Œæ–œè¾¹çš„å¹³æ–¹ç­‰äºä¸¤æ¡ç›´è§’è¾¹çš„å¹³æ–¹å’Œï¼Œä¹Ÿå°±æ˜¯aÂ² + bÂ² = cÂ²ã€‚ç°åœ¨å¾—é€‰ä¸€<br>ç§åˆé€‚çš„è¯æ˜æ–¹å¼ï¼Œå¯èƒ½æ˜¯å‡ ä½•çš„æˆ–è€…ä»£æ•°çš„ã€‚\n\né¦–å…ˆæƒ³åˆ°çš„æ˜¯å‡ ä½•è¯æ˜ä¸­çš„æ‹¼æ¥æ³•ï¼Œé€šè¿‡å°†å››ä¸ªç›´è§’ä¸‰è§’å½¢æ‹¼æˆä¸€ä¸ªå¤§çš„æ­£æ–¹å½¢ï¼Œç„¶åæ¯”è¾ƒé¢ç§¯ã€‚æˆ‘è¦ä¸è¦è¯•è¯•è¿™ä¸ªæ–¹æ³•ï¼Ÿæ¯”å¦‚è¯´ï¼Œå››ä¸ªå…¨ç­‰çš„ç›´è§’ä¸‰è§’å½¢ï¼Œè®¾å®ƒä»¬çš„ç›´è§’è¾¹ä¸ºaå’Œbï¼Œ<br>æ–œè¾¹ä¸ºcï¼Œæ‹¼èµ·æ¥çš„è¯ä¸­é—´åº”è¯¥ä¼šå½¢æˆä¸€ä¸ªè¾¹é•¿ä¸ºï¼ˆa+bï¼‰çš„æ­£æ–¹å½¢ï¼Œä¸­é—´çš„ç©ºéš™å¯èƒ½æ˜¯å°æ­£æ–¹å½¢ï¼Œè¾¹é•¿æ˜¯cæˆ–è€…åˆ«çš„ï¼Ÿ\n\nä¸å¯¹ï¼Œåº”è¯¥ä¼šå½¢æˆä¸€ä¸ªè¾¹é•¿ä¸ºcçš„æ­£æ–¹å½¢ï¼Œæˆ–è€…è¿™ä¸ªï¼Ÿç­‰ä¸€ä¸‹ï¼Œå¯èƒ½å¾—ä»”ç»†ç”»ä¸ªå›¾æƒ³è±¡ä¸€ä¸‹ã€‚å‡è®¾æˆ‘ä»¬æŠŠå››ä¸ªä¸‰è§’<br>å½¢æ¯ä¸ªçš„ç›´è§’è¾¹æœå¤–ï¼Œé‚£æ–œè¾¹å°±ä¼šç»„æˆé‡Œé¢çš„ä¸€ä¸ªæ­£æ–¹å½¢ï¼Œè¿™æ—¶å€™é‚£ä¸ªæ­£æ–¹å½¢çš„è¾¹é•¿åº”è¯¥æ˜¯a - bå—ï¼Ÿæˆ–è€…å¯èƒ½æ˜¯å…¶ä»–æƒ…å†µï¼Ÿ\n\nå¦ä¸€ä¸ªæ–¹æ³•æ˜¯ä»£æ•°è¯æ˜ï¼Œåˆ©ç”¨ç›¸ä¼¼ä¸‰è§’å½¢æˆ–è€…æ¬§å‡ é‡Œå¾—çš„è¯æ˜æ–¹å¼ã€‚æˆ‘è®°å¾—æ¬§å‡ é‡Œå¾—åœ¨ã€Šå‡ ä½•åŸæœ¬ã€‹é‡Œçš„è¯æ˜æ¯”è¾ƒå¤æ‚ï¼Œå¯èƒ½ä¸å¤ªç›´è§‚ï¼Œé€‚åˆè¿›é˜¶çš„å­¦ç”Ÿã€‚ä½†æ™®é€šå­¦ç”Ÿåº”è¯¥æ›´å®¹æ˜“æ¥å—é¢ç§¯æ‹¼æ¥æ³•ï¼Œæˆ–è€…æ˜¯åˆ©ç”¨ä»£æ•°å±•å¼€ã€‚è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯æ€»ç»Ÿè¯æ˜æ³•ï¼Œæ®è¯´æ˜¯ç¾å›½ç¬¬20ä»»æ€»ç»ŸåŠ è²å°”å¾·æƒ³åˆ°çš„ä¸€ç§æ¢¯å½¢é¢ç§¯æ³•ï¼Œå¯¹å—ï¼Ÿ\n\næ¯”å¦‚è¯´ï¼Œç”»ä¸€ä¸ªæ¢¯å½¢ï¼Œç”±<br>ä¸¤ä¸ªç›´è§’ä¸‰è§’å½¢å’Œä¸€ä¸ªç­‰è…°ç›´è§’ä¸‰è§’å½¢ç»„æˆï¼Œè®¡ç®—é¢ç§¯ä¸¤ç§æ–¹å¼ã€‚å¯èƒ½è¿™ä¸ªæ›´ç®€å•ã€‚å…ˆå¤ä¹ ä¸€ä¸‹è¿™ç§æ–¹æ³•çš„å…·ä½“æ­¥éª¤ã€‚æ€»é¢ç§¯çš„å…¬å¼åº”è¯¥ç­‰äºæ¢¯å½¢çš„é«˜ä¹˜ä»¥ä¸Šåº•åŠ ä¸‹åº•çš„ä¸€åŠï¼Œå¯¹å—ï¼Ÿ\n\næˆ–è€…å›åˆ°åŸºæœ¬çš„æ‹¼å›¾æ–¹æ³•ã€‚å››ä¸ªç›´è§’ä¸‰è§’å½¢ï¼Œè¾¹<br>é•¿ä¸ºaå’Œbï¼Œæ–œè¾¹cï¼Œå°†å®ƒä»¬æ”¾åœ¨ä¸€ä¸ªå¤§æ­£æ–¹å½¢é‡Œé¢ï¼Œè¿™æ ·æœ‰ä¸¤ç§ä¸åŒçš„æ‹¼æ³•ï¼Œåˆ†åˆ«å½¢æˆè¾¹é•¿ä¸ºa + bçš„å¤§æ­£æ–¹å½¢ï¼Œä¸€ç§æ˜¯å››ä¸ªä¸‰è§’å½¢å›´æˆä¸€ä¸ªè¾¹é•¿ä¸ºcçš„æ­£æ–¹å½¢ï¼Œå¦ä¸€ç§åˆ™æ˜¯ä¸­é—´ç•™æœ‰è¾¹é•¿ä¸ºaå’Œbçš„å°æ­£æ–¹å½¢ã€‚\n\nè¿™æ—¶å€™æ•´ä¸ªå¤§æ­£æ–¹å½¢çš„é¢ç§¯æœ‰ä¸¤ç§è¡¨è¾¾å¼ï¼Œä¸€ç§ç­‰äº(a + b)Â²ï¼Œå¦ä¸€ç§ç­‰äº4ä¸ªä¸‰è§’å½¢çš„é¢ç§¯åŠ ä¸Šä¸­é—´çš„æ­£æ–¹å½¢é¢ç§¯ï¼Œä¹Ÿå°±æ˜¯4*(1/2 ab) + cÂ²ã€‚å¦ä¸€è¾¹ï¼ŒåŒä¸€ä¸ªå¤§æ­£æ–¹å½¢çš„é¢ç§¯ä¹Ÿå¯ä»¥é€šè¿‡å¦ä¸€ç§æ‹¼æ³•å¾—åˆ°ï¼Œè¿™æ—¶å€™ä¸­é—´å¯èƒ½æ˜¯ä¸¤ä¸ªå°æ­£æ–¹å½¢ï¼Œè¾¹é•¿åˆ†åˆ«æ˜¯aå’Œbï¼Œæ‰€ä»¥<br>æ€»é¢ç§¯æ˜¯4*(1/2 ab) + aÂ² + bÂ²ã€‚è¿™æ ·ç­‰å¼ä¸¤è¾¹ç›¸ç­‰çš„è¯å°±èƒ½å¾—åˆ°aÂ² + bÂ² = cÂ²ã€‚è¿™å¯èƒ½å°±æ˜¯å¸¸è§çš„æ‹¼å›¾æ³•è¯æ˜ã€‚\n\næˆ–è€…è€ƒè™‘ç”¨ç›¸ä¼¼ä¸‰è§’å½¢çš„æ¯”ä¾‹æ¥æ¨å¯¼ã€‚åœ¨ç›´è§’ä¸‰è§’å½¢ä¸­ï¼Œç”»ä¸€æ¡é«˜ï¼Œç”±æ­¤äº§ç”Ÿä¸¤ä¸ªå°ä¸‰è§’å½¢ï¼Œè·ŸåŸæ¥çš„å¤§ä¸‰è§’å½¢ç›¸ä¼¼<br>ã€‚æ ¹æ®ç›¸ä¼¼ä¸‰è§’å½¢çš„è¾¹é•¿æ¯”ä¾‹ï¼Œå„ä¸ªè¾¹çš„å…³ç³»å¯ä»¥å¾—å‡ºå‹¾è‚¡å®šç†ã€‚\n\næ¯”å¦‚ï¼Œè®¾åŸä¸‰è§’å½¢ABCï¼ŒCä¸ºç›´è§’ï¼Œä»Cå‘ABè¾¹ä½œé«˜ï¼Œäº¤äºDç‚¹ã€‚è¿™æ ·ï¼ŒADå’ŒDBåˆ†åˆ«æ˜¯ä¸¤ä¸ªå°ä¸‰è§’å½¢çš„è¾¹ï¼Œä¹‹ååˆ©ç”¨æ¯”ä¾‹å…³ç³»å¾—å‡ºACÂ² = AD * ABï¼ŒBCÂ² = DB * ABï¼Œç›¸åŠ <br>åå¾—å‡ºACÂ² + BCÂ² = ABÂ²ï¼ˆAD + DBï¼‰= ABÂ²ï¼Œè¿™æ ·å°±å¾—åˆ°ç»“è®ºã€‚è¿™å¯èƒ½æ˜¯æ¬§å‡ é‡Œå¾—çš„æ–¹æ³•ã€‚\n\nä¸è¿‡ï¼Œå¯èƒ½ç”¨æˆ·éœ€è¦çš„æ˜¯æ›´ç›´è§‚çš„è¯æ˜æ–¹æ³•ï¼Œæ¯”å¦‚é¢ç§¯æ³•ï¼Œå¯èƒ½é€‚åˆæ›´å¤šäººç†è§£ã€‚åƒç”¨å››ä¸ªç›´è§’ä¸‰è§’å½¢å›´æˆä¸€ä¸ªå¤§çš„æ­£æ–¹å½¢ï¼Œä¸­é—´å½¢æˆçš„éƒ¨åˆ†æ˜¯cÂ²çš„é¢ç§¯ï¼Œç„¶åå¦å¤–æ–¹å¼æ‹¼æ¥å¾—åˆ°aÂ² + bÂ²çš„æ€»é¢ç§¯ï¼Œä¸¤è€…ç›¸ç­‰ã€‚\n\nè¿™ä¸ªæ—¶å€™åº”è¯¥è¯¦ç»†ç”»å‡ºè¿™ä¸ªå›¾å½¢ã€‚ä½†å› ä¸ºæ˜¯æ–‡å­—æè¿°ï¼Œæˆ‘éœ€è¦è§£é‡Šæ¸…æ¥šï¼šå°†å››ä¸ªç›´è§’ä¸‰è§’å½¢ä»¥è¾¹é•¿ä¸ºaå’Œbçš„ç›´è§’è¾¹å‘å¤–ï¼Œç»„æˆä¸€ä¸ªå¤§æ­£æ–¹å½¢ï¼Œè¾¹é•¿ä¸ºa + bï¼Œä¸­é—´çš„<br>åŒºåŸŸåˆ™æ˜¯ä¸€ä¸ªè¾¹é•¿ä¸ºcçš„æ­£æ–¹å½¢ã€‚å¤§æ­£æ–¹å½¢çš„é¢ç§¯ç­‰äºå››ä¸ªä¸‰è§’å½¢çš„é¢ç§¯å†åŠ ä¸Šä¸­é—´æ­£æ–¹å½¢çš„é¢ç§¯ã€‚ä¹Ÿå°±æ˜¯(a + b)Â² = 4*(1/2 ab) + cÂ²ã€‚å±•å¼€å·¦è¾¹å¾—åˆ°aÂ² + 2ab + bÂ² = 2ab + cÂ²ï¼Œä¸¤è¾¹å‡å»2abå³å¾—aÂ² + bÂ² = cÂ²ï¼Œå¾—è¯ã€‚\n\næˆ–è€…ï¼Œæ¢<br>ä¸€ç§æ–¹å¼æ‹¼å‡‘ï¼Œä»¥ç›´è§’è¾¹ä¸ºæ’åˆ—æ–¹å‘ï¼Œæˆ–è®¸ä¸­é—´å½¢æˆçš„åŒºåŸŸä¼šæ˜¯ä¸¤ä¸ªå°æ­£æ–¹å½¢ï¼Œè¾¹é•¿aå’Œbï¼Œè¿™å¯èƒ½å¯¼è‡´åŒæ ·çš„ç»“è®ºã€‚ä½†ä¸Šè¿°çš„è¯æ˜åº”è¯¥æ›´ç›´æ¥ï¼Œæ­¥éª¤æ›´ç®€å•ã€‚\n\nå¦ä¸€ä¸ªå¯èƒ½æ˜¯ä»£æ•°è®¡ç®—æ³•ï¼Œæ¯”å¦‚æ„é€ ä¸€ä¸ªè¾¹é•¿ä¸ºcçš„æ­£æ–¹å½¢ï¼Œåˆ†å‰²æˆå››ä¸ªä¸‰è§’å½¢å’Œä¸€ä¸ªä¸­é—´çš„å°æ­£æ–¹å½¢ï¼Œä¸è¿‡è¿™å¯èƒ½éœ€è¦ä¸åŒçš„åˆ†å‰²æ–¹å¼ã€‚è¿™æ—¶åŒæ ·æ˜¯åˆ©ç”¨é¢ç§¯å¹³è¡¡å»æ¨å¯¼ã€‚\n\nç¡®å®šä¹‹åï¼Œæˆ‘è§‰å¾—ç”¨å››ä¸ªä¸‰è§’å½¢çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„â€œé¢ç§¯æ‹¼å›¾æ³•â€åº”è¯¥æ˜¯æœ€ç›´æ¥çš„æ–¹å¼ã€‚è¿™ä¸ªæ–¹æ³•çš„æ­¥éª¤æ¯”è¾ƒæ¸…æ™°ï¼Œè€Œä¸”ä»£æ•°è¿ç®—<br>ç®€å•ï¼Œåªæœ‰å‡ æ­¥å±•å¼€ï¼Œå®¹æ˜“ç†è§£ã€‚\n\nå¦å¤–ï¼Œè¦æ³¨æ„ç”¨æˆ·çš„ç–‘é—®å¯èƒ½æ˜¯ä»€ä¹ˆã€‚è¿™äº›è¯æ˜æ–¹æ³•æ˜¯ä¸æ˜¯æ­£ç¡®çš„ï¼Ÿæœ‰æ²¡æœ‰é€»è¾‘æ¼æ´ï¼Ÿæ¯”å¦‚åœ¨æ‹¼æ¥è¿‡ç¨‹ä¸­ï¼Œæ˜¯å¦çœŸèƒ½ç»„æˆä¸€ä¸ªæ­£æ–¹å½¢ï¼Ÿæ˜¯å¦å­˜åœ¨å¯¹åº”çš„å‡ ä½•æ¡ä»¶æ˜¯å¦ç¬¦åˆï¼Œä¾‹å¦‚ç›´è§’æ˜¯å¦æ‹¼æ¥æ­£ç¡®ï¼Œ<br>è¾¹é•¿æ˜¯å¦ç¡®å®a + bç­‰ç­‰ã€‚\n\næ‰€ä»¥éœ€è¦åœ¨è¯æ˜è¿‡ç¨‹ä¸­è¯¦ç»†è¯´æ˜å›¾å½¢æ˜¯å¦‚ä½•æ„é€ çš„ï¼Œç¡®ä¿å„ä¸ªè¾¹å¯¹çš„é•¿åº¦ç›¸ç­‰ï¼Œè§’åº¦æ­£ç¡®ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯ä¸­é—´åŒºåŸŸæ˜¯æ­£æ–¹å½¢ã€‚ä¾‹å¦‚ï¼Œå››ä¸ªç›´è§’ä¸‰è§’å½¢çš„ç›´è§’è¾¹aå’Œbäº¤æ›¿æ’åˆ—ï¼Œä½¿å¾—å„å¤–è§’éƒ½æ˜¯ç›´è§’ï¼Œä»è€Œå¤–æ¡†æ˜¯ä¸€ä¸ªè¾¹é•¿ä¸ºa + bçš„æ­£æ–¹å½¢ã€‚è€Œä¸­é—´çš„éƒ¨åˆ†å› ä¸ºæ¯ä¸ªè¾¹éƒ½æ˜¯æ–œè¾¹cï¼Œæ¯ä¸ªè§’éƒ½æ˜¯åŸæ¥çš„ç›´è§’æ‹¼æ¥åçš„è§’åº¦ï¼Œæ‰€ä»¥ä¸­é—´è‚¯å®šæ˜¯è¾¹é•¿ä¸ºcçš„æ­£æ–¹å½¢ã€‚\n\nè¿™æ ·çš„è¯ï¼Œæ•´ä¸ªè¿‡ç¨‹åœ¨å‡ ä½•ä¸Šæ˜¯ä¸¥å¯†çš„ï¼Œå¯ä»¥æ”¾å¿ƒä½¿ç”¨ã€‚\n\næ€»ç»“ä¸€ä¸‹ï¼Œæˆ‘æ‰“ç®—ä½¿ç”¨é¢ç§¯æ‹¼æ¥æ³•æ¥è¯æ˜å‹¾è‚¡å®šç†ï¼Œè¯¦ç»†æè¿°å¦‚ä½•å°†å››ä¸ªç›´è§’ä¸‰è§’å½¢æ‹¼æˆä¸€ä¸ªå¤§æ­£æ–¹å½¢ï¼Œç„¶åé€šè¿‡ä¸¤ç§ä¸åŒçš„é¢ç§¯è®¡ç®—æ–¹å¼å¾—åˆ°æ–¹ç¨‹ï¼Œä»è€Œè§£å‡ºaÂ² + bÂ² = cÂ²ã€‚è¿™ç§æ–¹æ³•ç›´è§‚ä¸”æ­¥éª¤æ¸…æ™°ï¼Œé€‚åˆå„ç§æ•°å­¦åŸºç¡€çš„ç”¨æˆ·ç†è§£ã€‚åŒæ—¶ï¼Œæé†’è‡ªå·±éœ€è¦æ£€æŸ¥å„<br>ä¸ªæ­¥éª¤æ˜¯å¦æ­£ç¡®ï¼Œä¾‹å¦‚æ­£æ–¹å½¢çš„æ„é€ æ˜¯å¦æ­£ç¡®ï¼Œé¢ç§¯è®¡ç®—æ˜¯å¦æœ‰è¯¯ï¼Œä»£æ•°æ¨å¯¼æ˜¯å¦ä¸¥è°¨ã€‚\n&lt;/think&gt;\n\nå‹¾è‚¡å®šç†è¡¨æ˜ï¼Œåœ¨ç›´è§’ä¸‰è§’å½¢ä¸­ï¼Œæ–œè¾¹é•¿ï¼ˆ\\( c \\)ï¼‰çš„å¹³æ–¹ç­‰äºä¸¤ç›´è§’è¾¹ï¼ˆ\\( a \\) å’Œ \\( b \\)ï¼‰çš„å¹³æ–¹å’Œï¼Œå³  \n\\[\na^2 + b^2 = c^2.\n\\]  \n**è¯æ˜**ï¼ˆé¢ç§¯æ‹¼æ¥æ³•ï¼‰ï¼š  \n\n1. **æ„é€ å›¾å½¢**ï¼š  \n   å–å››ä¸ªå…¨ç­‰çš„ç›´è§’ä¸‰è§’å½¢ï¼Œå…¶ç›´è§’è¾¹åˆ†åˆ«ä¸º \\( a \\) å’Œ \\( b \\)ï¼Œæ–œè¾¹ä¸º \\( c \\)ã€‚å°†å®ƒä»¬ä»¥ç›´è§’ç›¸æ¥çš„æ–¹å¼æ‹¼æ¥æˆä¸€ä¸ªå¤§æ­£æ–¹å½¢ï¼Œå¦‚å›¾1<br>æ‰€ç¤ºã€‚  \n   - å¤–æ¡†å¤§æ­£æ–¹å½¢çš„è¾¹é•¿ä¸º \\( a + b \\)ã€‚  \n   - ä¸­é—´ç©ºå‡ºçš„åŒºåŸŸæ˜¯ä¸€ä¸ªè¾¹é•¿ä¸º \\( c \\) çš„å°æ­£æ–¹å½¢ã€‚  \n\n   ![å›¾1ï¼šå››ä¸ªç›´è§’ä¸‰è§’å½¢æ„æˆè¾¹é•¿ä¸º \\( a + b \\) çš„å¤§æ­£æ–¹å½¢ï¼Œä¸­é—´ç©ºå‡ºè¾¹é•¿ä¸º \\( c \\) çš„å°æ­£æ–¹å½¢](https://i.imgur.com/yyNUyzB.png)  \n\n2. **è®¡ç®—æ€»é¢ç§¯**ï¼š  \n   å¤–æ¡†å¤§æ­£æ–¹å½¢çš„é¢ç§¯å¯è¡¨ç¤ºä¸ºï¼š  \n   \\[\n   (a + b)^2 = a^2 + 2ab + b^2.\n   \\]  \n\n3. **å¦ä¸€ç§æ–¹å¼çš„æ€»é¢ç§¯**ï¼š  \n   æ€»é¢ç§¯ä¹Ÿå¯ä»¥çœ‹ä½œå››ä¸ªç›´è§’ä¸‰è§’å½¢çš„é¢ç§¯åŠ ä¸Šä¸­é—´å°æ­£æ–¹å½¢çš„é¢ç§¯ï¼š  \n   \\[\n   \\text&#123;æ€»é¢ç§¯&#125; = 4 \\times \\left( \\frac&#123;1&#125;&#123;2&#125;ab \\right) + c^2 = 2ab + c^2.\n   \\]  \n\n4. **è”ç«‹æ–¹ç¨‹**ï¼š  \n   å°†ä¸¤ç§è¡¨è¾¾å¼è”ç«‹ï¼š  \n   \\[\n   a^2 + 2ab + b^2 = 2ab + c^2.\n   \\]  \n   ä¸¤è¾¹å‡å» \\( 2ab \\)ï¼Œå¾—åˆ°ï¼š  \n   \\[\n   a^2 + b^2 = c^2.\n   \\]  \n\n**ç»“è®º**ï¼šåœ¨ç›´è§’ä¸‰è§’å½¢ä¸­ï¼Œæ–œè¾¹çš„å¹³æ–¹ç­‰äºä¸¤ç›´è§’è¾¹çš„å¹³æ–¹å’Œã€‚æ­¤è¯æ³•é€šè¿‡å‡ ä½•æ„é€ ä¸ä»£æ•°è¿ç®—çš„ç»“åˆ<br>ï¼Œç›´è§‚å±•ç¤ºäº†å‹¾è‚¡å®šç†çš„å¿…ç„¶æ€§ã€‚&quot;,&quot;tool_calls&quot;:[]&#125;,&quot;logprobs&quot;:null,&quot;finish_reason&quot;:&quot;stop&quot;,&quot;stop_reason&quot;:null&#125;],&quot;usage&quot;:&#123;&quot;prompt_tokens&quot;:8,&quot;total_tokens&quot;:1606,&quot;completion_tokens&quot;:1598,&quot;prompt_tokens_details&quot;:null&#125;,&quot;prompt_logprobs&quot;:null&#125;<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å›ç­”é—®é¢˜çš„åŒæ—¶åœ¨vllm serveå‘½ä»¤æ‰§è¡Œçš„çª—å£ä¼šçœ‹åˆ°å¦‚ä¸‹ï¼Œæ˜¾ç¤ºtokenå¹³å‡ç”Ÿæˆååç‡</span><br>INFO 02-24 17:21:12 metrics.py:455] Avg prompt throughput: 1.6 tokens/s, Avg generation throughput: 36.5 tokens/s, Running: 1 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 0.0%, CPU KV cache usage: 0.0%.<br>INFO 02-24 17:21:17 metrics.py:455] Avg prompt throughput: 0.0 tokens/s, Avg generation throughput: 37.2 tokens/s, Running: 1 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 0.0%, CPU KV cache usage: 0.0%.<br>INFO 02-24 17:21:22 metrics.py:455] Avg prompt throughput: 0.0 tokens/s, Avg generation throughput: 36.5 tokens/s, Running: 1 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 0.1%, CPU KV cache usage: 0.0%.<br>...<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç”šè‡³æ›´é«˜é€Ÿåº¦</span><br>INFO 02-24 23:32:00 metrics.py:455] Avg prompt throughput: 442.9 tokens/s, Avg generation throughput: 38.8 tokens/s, Running: 3 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 0.4%, CPU KV cache usage: 0.0%.<br>INFO 02-24 23:32:05 metrics.py:455] Avg prompt throughput: 0.0 tokens/s, Avg generation throughput: 102.4 tokens/s, Running: 3 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 0.4%, CPU KV cache usage: 0.0%.<br>INFO 02-24 23:32:07 async_llm_engine.py:179] Finished request chatcmpl-03add50cba264c84afe98fd6cce9907f.<br>INFO 02-24 23:32:10 metrics.py:455] Avg prompt throughput: 0.0 tokens/s, Avg generation throughput: 79.4 tokens/s, Running: 2 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 0.3%, CPU KV cache usage: 0.0%.<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">apt install nvtop</span><br>(self-llm) deepseek@deepseek1:~/installPkgs$ nvtop<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚ä¸‹æ˜¯`nvtop`å‘½ä»¤è¾“å‡º</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/24/iqRKSIfvJEY9sm4.png" alt="image-20250224233912301"></p><h2 id="3-2-è¿è¡ŒOpenWebUI"><a href="#3-2-è¿è¡ŒOpenWebUI" class="headerlink" title="3.2 è¿è¡ŒOpenWebUI"></a>3.2 è¿è¡ŒOpenWebUI</h2><h3 id="3-2-1-ä¸‹è½½é•œåƒ"><a href="#3-2-1-ä¸‹è½½é•œåƒ" class="headerlink" title="3.2.1 ä¸‹è½½é•œåƒ"></a>3.2.1 ä¸‹è½½é•œåƒ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹è½½å®¹å™¨é•œåƒ</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-built_in">sudo</span> docker pull ghcr.io/open-webui/open-webui:v0.5.10</span><br>sudo docker pull ghcr.io/open-webui/open-webui:v0.5.16<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœæ— æ³•ä¸‹è½½æˆ–ä¸‹è½½é€Ÿåº¦å¤ªæ…¢ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹é•œåƒï¼Œå®ƒä»¬æ˜¯åŒæ­¥çš„ï¼ˆå»ºè®®ä½¿ç”¨æ­¤é•œåƒï¼‰</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-built_in">sudo</span> docker pull swr.cn-north-4.myhuaweicloud.com/ddn-k8s/ghcr.io/open-webui/open-webui:v0.5.10</span><br>sudo docker pull swr.cn-north-4.myhuaweicloud.com/ddn-k8s/ghcr.io/open-webui/open-webui:v0.5.16<br></code></pre></td></tr></table></figure><h3 id="3-2-2-å¯åŠ¨open-webuiå®¹å™¨"><a href="#3-2-2-å¯åŠ¨open-webuiå®¹å™¨" class="headerlink" title="3.2.2 å¯åŠ¨open-webuiå®¹å™¨"></a>3.2.2 å¯åŠ¨open-webuiå®¹å™¨</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs shell">(self-llm) deepseek@deepseek2:~$ sudo docker run -d --name open-webui \<br>--hostname=open-webui \<br>    --volume=open-webui:/app/backend/data \<br>    --workdir=/app/backend \<br>    -p 18080:8080 \<br>    --restart always \<br>--runtime=nvidia \<br>    --env=OPENAI_API_BASE_URL=http://10.119.85.138:8000/v1 \<br>    --env=OPENAI_API_KEY=zY0MrQwXV9Oo3g== \<br>    --env=ENABLE_OLLAMA_API=false \<br>    --env=ENABLE_SIGNUP=true \<br>    swr.cn-north-4.myhuaweicloud.com/ddn-k8s/ghcr.io/open-webui/open-webui:v0.5.16 \<br>    bash start.sh<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å…¶ä¸­OPENAI_API_BASE_URL æŒ‡å®šäº†vllmæš´éœ²çš„openai API æœåŠ¡åœ°å€</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç­‰å¾…ï¼Œç›´åˆ°open-webuiå®¹å™¨çŠ¶æ€æ›´æ–°ä¸ºhealthy</span><br>(self-llm) deepseek@deepseek2:~$ sudo watch docker ps -a<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®æ—¶æ›´æ–°æŸ¥çœ‹open-webuiå®¹å™¨æ—¥å¿—</span><br>(self-llm) deepseek@deepseek2:~$ sudo docker logs open-webui -f<br>Loading WEBUI_SECRET_KEY from file, not provided as an environment variable.<br>Generating WEBUI_SECRET_KEY<br>Loading WEBUI_SECRET_KEY from .webui_secret_key<br>/app/backend/open_webui<br>/app/backend<br>/app<br>Running migrations<br>INFO  [alembic.runtime.migration] Context impl SQLiteImpl.<br>INFO  [alembic.runtime.migration] Will assume non-transactional DDL.<br>INFO  [open_webui.env] &#x27;ENABLE_SIGNUP&#x27; loaded from the latest database entry<br>INFO  [open_webui.env] &#x27;DEFAULT_LOCALE&#x27; loaded from the latest database entry<br>INFO  [open_webui.env] &#x27;DEFAULT_PROMPT_SUGGESTIONS&#x27; loaded from the latest database entry<br>WARNI [open_webui.env] <br><br>WARNING: CORS_ALLOW_ORIGIN IS SET TO &#x27;*&#x27; - NOT RECOMMENDED FOR PRODUCTION DEPLOYMENTS.<br><br>INFO  [open_webui.env] Embedding model set: sentence-transformers/all-MiniLM-L6-v2<br>WARNI [langchain_community.utils.user_agent] USER_AGENT environment variable not set, consider setting it to identify your requests.<br>INFO:     Started server process [1]<br>INFO:     Waiting for application startup.<br>INFO:     Application startup complete.<br>INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)  #å‡ºç°äº†æ—¥å¿—å†…å®¹å°±æ˜¯å¯ç”¨äº†<br></code></pre></td></tr></table></figure><h3 id="3-2-3-è®¿é—®open-webuiç•Œé¢"><a href="#3-2-3-è®¿é—®open-webuiç•Œé¢" class="headerlink" title="3.2.3 è®¿é—®open-webuiç•Œé¢"></a>3.2.3 è®¿é—®open-webuiç•Œé¢</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å…¶ä¸­ 10.119.85.138 æ˜¯deepseek2èŠ‚ç‚¹çš„IBç½‘å¡IP</span><br>(self-llm) deepseek@deepseek2:~$ curl http://10.119.85.138:18080<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æˆ–åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è®¿é—®ä¸Šè¿°åœ°å€ã€‚ç¬¬ä¸€ä¸ªæ³¨å†Œçš„ç”¨æˆ·ï¼Œé»˜è®¤å°±æ˜¯ç®¡ç†å‘˜ã€‚æ³¨å†Œåç™»å½•ã€æé—®</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/25/u9lErBStzK3sULx.png" alt="image-20250225154520858"></p><h2 id="3-3-å¤‡æ³¨è¯´æ˜"><a href="#3-3-å¤‡æ³¨è¯´æ˜" class="headerlink" title="3.3 å¤‡æ³¨è¯´æ˜"></a>3.3 å¤‡æ³¨è¯´æ˜</h2><p>è¦å­¦ä¸åšçš„ä¸œè¥¿å¾ˆå¤šï¼Œæ­¤ç¬”è®°åªæ˜¯ä¸€ä¸ªè®°å½•åˆ†äº«ã€‚</p><p>å½“ç„¶åç»­å¸Œæœ›ï¼š</p><p>ï¼ˆ1ï¼‰ä»¥å¼€æºè§£å†³æ–‡æ¡ˆä¸ºåŸºç¡€ï¼Œå®ç°å¯¹æ¨¡å‹æœåŠ¡çš„é«˜å¯ç”¨ä¸è´Ÿè½½å‡è¡¡é…ç½®ï¼Œå°½é‡å®ç°é«˜å¹¶å‘ã€å¤šç”¨æˆ·ä½¿ç”¨ã€‚</p><p>ï¼ˆ2ï¼‰ä»¥æ­¤æ¨¡å‹æœåŠ¡ä¸ºåŸºç¡€ï¼Œå¼€å‘RAGåº”ç”¨æˆ–agentï¼Œä¸°å¯Œæ­¤å¤§æ¨¡å‹çš„åŠŸèƒ½åº”ç”¨ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>éƒ¨ç½²æ»¡è¡€ç‰ˆDeepSeek</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>KTransformerséƒ¨ç½²DeepSeek-R1-Q4_K_M</title>
    <link href="/2025/03/12/KTransformers%E9%83%A8%E7%BD%B2DeepSeek-R1-Q4-K-M/"/>
    <url>/2025/03/12/KTransformers%E9%83%A8%E7%BD%B2DeepSeek-R1-Q4-K-M/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€å‚è€ƒæ–‡æ¡£ä¸ä¿¡æ¯è¯´æ˜">ä¸€ã€å‚è€ƒæ–‡æ¡£ä¸ä¿¡æ¯è¯´æ˜</h1><p>KTransformers æ˜¯ç”±æ¸…åå¤§å­¦å‘èµ·çš„ä¸€ä¸ªé¡¹ç›®ï¼Œå®ƒåˆ©ç”¨ DeepSeek æ¨¡å‹çš„ MoE æ¶æ„ç‰¹æ€§ï¼Œå°†ä¸“å®¶æ¨¡å‹çš„æƒé‡åŠ è½½åˆ°å†…å­˜ä¸Šï¼Œå¹¶åˆ†é… CPU å®Œæˆç›¸å…³è®¡ç®—ï¼ŒåŒæ—¶å°† ML/KV Cache åŠ è½½åˆ° GPU ä¸Šï¼Œä»è€Œå®ç° CPU+GPU æ··åˆæ¨ç†ã€‚è¿™ç§æ–¹æ³•èƒ½å¤Ÿåœ¨æœ€å¤§åŒ–é™ä½æ˜¾å­˜å ç”¨çš„åŒæ—¶ï¼Œä¿æŒä¸€å®šçš„æ¨ç†é€Ÿåº¦ã€‚KTransformers é¡¹ç›®æ—¨åœ¨è§£å†³å¤§æ¨¡å‹æœ¬åœ°éƒ¨ç½²éš¾é¢˜ï¼Œå®ç°èµ„æºæœ‰é™æƒ…å†µä¸‹å¤§æ¨¡å‹çš„é«˜æ•ˆæœ¬åœ°éƒ¨ç½²ï¼Œè®©æ›´å¤šäººèƒ½å¤Ÿåœ¨è‡ªå·±çš„è®¾å¤‡ä¸Šè¿è¡Œæ›¾ç»é¥ä¸å¯åŠçš„å¤§å‹æ¨¡å‹ã€‚</p><h2 id="å‚è€ƒæ–‡æ¡£">1.1 å‚è€ƒæ–‡æ¡£</h2><ul><li><p>å‚è€ƒæ–‡ç« ï¼š</p><ul><li><p>KTçš„githubä»“åº“ï¼šhttps://github.com/kvcache-ai/ktransformers/tree/v0.2.3post2</p></li><li><p>å®‰è£…æ–‡æ¡£ï¼šKtå®˜æ–¹å®‰è£…æ–‡æ¡£ï¼ˆhttps://kvcache-ai.github.io/ktransformers/en/install.htmlï¼‰</p></li><li><p>https://mp.weixin.qq.com/s/1keAGOQlkTf_dKrzWmCRZQ</p></li><li><p>https://mp.weixin.qq.com/s/C4aTsxzYGV7bFrKyx6juug</p></li><li><p>https://kq4b3vgg5b.feishu.cn/wiki/QJ5ywpjnvieTKZk5kPHcG3sLnkd</p></li></ul></li><li><p>æ¨¡å‹ä¸‹è½½é¡µé¢ï¼š</p><ul><li>https://modelscope.cn/models/unsloth/DeepSeek-R1-GGUF/files</li></ul></li><li><p>ä¸‹è½½æ¨¡å‹æ–‡ä»¶ï¼š</p><ul><li>https://modelscope.cn/models/unsloth/DeepSeek-R1-GGUF/resolve/master/DeepSeek-R1-Q4_K_M/DeepSeek-R1-Q4_K_M-00001-of-00009.gguf</li></ul></li></ul><p>åªä¸‹è½½DeepSeek-R1-Q4_K_Mè¿™ä¸ªé‡åŒ–ç‰ˆæœ¬ï¼šhttps://www.modelscope.cn/models/unsloth/DeepSeek-R1-GGUF/feedback/issueDetail/23220</p><h2 id="ä¿¡æ¯è¯´æ˜">1.2 ä¿¡æ¯è¯´æ˜</h2><p>ç¬¬1æ¬¡æ­¤æ¬¡éƒ¨ç½²æ˜¯åœ¨Centos8-x86_64ç‰©ç†æœåŠ¡å™¨ä¸Šéƒ¨ç½²ï¼Œä¸€ç›´æœ‰æŠ¥é”™ï¼Œç›¸å…³æŠ¥é”™ä¿¡æ¯æè¿°åœ¨ç¬¬2ç« ã€‚æ˜¯å…¶ä»–åŒå­¦çš„æœåŠ¡å™¨ï¼Œåå»ºè®®å…¶åœ¨ç‰©ç†æœåŠ¡å™¨ä¸Šåˆ›å»ºubuntu2204å®¹å™¨è¿›è¡Œæ“ä½œã€‚</p><p>ç¬¬2æ¬¡ï¼Œå‡†å¤‡åœ¨è‡ªå·±çš„ubuntu20.04 LTS-x86_64ç‰©ç†æœåŠ¡å™¨ä¸Šè¿›è¡Œæ“ä½œï¼ŒæˆåŠŸã€‚</p><h1 id="äºŒcentos8ä¸ŠæŠ¥é”™å¤„ç†">äºŒã€Centos8ä¸ŠæŠ¥é”™å¤„ç†</h1><h2 id="ä½¿ç”¨torch2.6.0æ—¶ktä»“åº“æ ¹ç›®å½•ä¸‹æ‰§è¡Œpip-install-.æŠ¥read-time-out">2.1 ä½¿ç”¨torch2.6.0æ—¶ï¼ŒKTä»“åº“æ ¹ç›®å½•ä¸‹æ‰§è¡Œ"pip install ."æŠ¥â€œRead time outâ€</h2><figure><img src="https://s2.loli.net/2025/03/15/mMQ7nO9Uj8fohJI.png" alt="image-20250315204632081" /><figcaption aria-hidden="true">image-20250315204632081</figcaption></figure><p>#æ¢æˆä½¿ç”¨torch2.4.1</p><p><code>pip install torch==2.4.1 torchvision==0.19.1 torchaudio==2.4.1 --index-url https://download.pytorch.org/whl/cu124</code></p><p>#å†æŒ‡å®špipå®‰è£…æºä¸ºæ¸…åæºï¼ˆå› ä¸ºKTå°±æ˜¯æ¸…åä¸»å¯¼çš„å¼€æºé¡¹ç›®ï¼‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">sh install.sh<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#pip install . -i https://pypi.tuna.tsinghua</span></span><br></code></pre></td></tr></table></figure><p>ä½†æŠ¥å¦‚ä¸‹é”™è¯¯ï¼ˆæŠ¥é”™æ—¶ï¼Œå®‰è£…çš„cudaç‰ˆæœ¬æ˜¯<strong><code>cuda_12.6.r12.6/compiler.34431801_0</code></strong>ï¼Œtorchç‰ˆæœ¬æ˜¯<strong><code>2.4.1+cu124</code></strong>ï¼‰ï¼š</p><p>å¦‚ä¸‹æç¤ºæ¢æŸ¥åˆ°çš„CUDA12.6å°ç‰ˆæœ¬ä¸ç”¨æ¥ç¼–è¯‘å½“å‰ä½¿ç”¨PyTorch2.4.1æ‰€ä½¿ç”¨çš„CUDAç‰ˆæœ¬ï¼ˆåº”è¯¥æ˜¯12.4ï¼‰ä¸åŒ¹é…ï¼Œä½†å¤§éƒ¨åˆ†æƒ…å†µä¸‹è¿™ä¸æ˜¯ä¸€ä¸ªä¸¥é‡é—®é¢˜ï¼Œæ‰€ä»¥åªæ˜¯ä¸€ä¸ªè­¦å‘Šä¿¡æ¯ã€‚</p><p>ç¬¬2è¡Œæç¤ºï¼Œä¸å­˜åœ¨ä¸ºCUDA12.6å®šä¹‰çš„g++ç‰ˆæœ¬è¾¹ç•Œã€‚</p><figure><img src="https://s2.loli.net/2025/03/15/CaKZwxAcIYXeU5O.png" alt="image-20250315211142720" /><figcaption aria-hidden="true">image-20250315211142720</figcaption></figure><figure><img src="https://s2.loli.net/2025/03/15/XVSxMlW8rKqpc2R.png" alt="image-20250315211246828" /><figcaption aria-hidden="true">image-20250315211246828</figcaption></figure><p>ç„¶åï¼Œå®‰è£…<code>cuda12.4+torch2.4.1</code>ï¼Œå†æ‰§è¡Œ<code>sh install.sh</code>ï¼Œè¿˜æœ‰g++ç‰ˆæœ¬ã€cmakeç›¸å…³æŠ¥é”™</p><figure><img src="https://s2.loli.net/2025/03/16/eKdXrGVz1RD48th.png" alt="image-20250316091400204" /><figcaption aria-hidden="true">image-20250316091400204</figcaption></figure><p>å¯¹äºg++ç‰ˆæœ¬ç›¸å…³æŠ¥é”™ï¼Œå¯ä»¥è€ƒè™‘å‡çº§gccä¸g++ç‰ˆæœ¬ï¼Œç„¶åå†æ‰§è¡Œ<code>sh install.sh</code>ï¼Œå†æŸ¥çœ‹æ˜¯å¦ä»æœ‰æŠ¥é”€</p><h1 id="ä¸‰ubuntu20.04-ä¸Šéƒ¨ç½²">ä¸‰ã€Ubuntu20.04 ä¸Šéƒ¨ç½²</h1><h2 id="å‡çº§cmake">3.0 å‡çº§cmake</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å‡çº§cmakeç‰ˆæœ¬ï¼ˆä»3.16.3åˆ°3.23.0ï¼‰</span><br>root@ksp-registry:/opt/installPkgs# wget https://cmake.org/files/v3.23/cmake-3.23.0.tar.gz<br>root@ksp-registry:/opt/installPkgs# tar -zxvf cmake-3.23.0.tar.gz<br>root@ksp-registry:/opt/installPkgs# cp -rp cmake-3.23.0 /usr/share/cmake-3.23.0<br>root@ksp-registry:/opt/installPkgs# ln -sf /usr/share/cmake-3.23.0/bin/cmake /usr/bin/cmake  <br>root@ksp-registry:/opt/installPkgs# cmake --version<br>cmake version 3.23.0<br><br>CMake suite maintained and supported by Kitware (kitware.com/cmake).<br></code></pre></td></tr></table></figure><h2 id="ä¸‹è½½deepseek-r1-q4_k_m">3.1 ä¸‹è½½DeepSeek-R1-Q4_K_M</h2><h3 id="ä¸‹è½½ggufæ–‡ä»¶">ä¸‹è½½GGUFæ–‡ä»¶</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##ä¸‹è½½æ–¹æ³•1ï¼ˆæ¨èï¼‰</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨condaåˆ›å»ºpythonè™šæ‹Ÿç¯å¢ƒ</span><br>root@ksp-registry:/opt/code_repos/AI_models# conda create -n self-llm python=3.12<br>root@ksp-registry:/opt/code_repos/AI_models# conda activate self-llm<br><br>(self-llm) root@ksp-registry:/opt/code_repos/AI_models# mkdir DeepSeek-R1-Q4_K_M<br>(self-llm) root@ksp-registry:/opt/code_repos/AI_models# cd DeepSeek-R1-Q4_K_M<br>(self-llm) root@ksp-registry:/opt/code_repos/AI_models/DeepSeek-R1-Q4_K_M# vi download-DeepSeek-R1-Q4_K_M.sh<br><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br><br>for i in $(seq 1 9); do<br>  aria2c -s 16 -x 16 https://modelscope.cn/models/unsloth/DeepSeek-R1-GGUF/resolve/master/DeepSeek-R1-Q4_K_M/DeepSeek-R1-Q4_K_M-0000$&#123;i&#125;-of-00009.gguf<br>done<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰€æœ‰æ–‡ä»¶ä¸‹è½½å®Œæˆåï¼Œå¤§æ¦‚æœ‰600å¤šG</span><br>(self-llm) root@ksp-registry:/opt/code_repos/AI_models/DeepSeek-R1-Q4_K_M# apt-get update &amp;&amp; apt -qy install aria2<br>(self-llm) root@ksp-registry:/opt/code_repos/AI_models/DeepSeek-R1-Q4_K_M# bash download-DeepSeek-R1-Q4_K_M.sh<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##ä¸‹è½½æ–¹æ³•2ï¼ˆä¼šä¸‹è½½DeepSeek-R1-Zero-Q4_K_M-xxxæ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶ä¸éœ€è¦ï¼‰</span></span><br>(self-llm) root@ksp-registry:/opt/code_repos/AI_models# pip install modelscope<br>(self-llm) root@ksp-registry:/opt/code_repos/AI_models# vi download.py<br>from modelscope import snapshot_download<br>snapshot_download(<br>  repo_id = &quot;unsloth/DeepSeek-R1-GGUF&quot;,<br>  local_dir = &quot;DeepSeek-R1-GGUF&quot;,<br>  allow_patterns = [&quot;*Q4_K_M*&quot;], # Select quant type Q4_K_M<br>)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##æ­¤pythonè„šæœ¬ä¼šå°†â€œhttps://www.modelscope.cn/models/unsloth/DeepSeek-R1-GGUF/files/DeepSeek-R1-Q4_K_Mâ€hç›®å½•ä¸‹æ‰€æœ‰18ä¸ªæ–‡ä»¶éƒ½ä¸‹è½½ä¸‹æ¥ï¼Œå³é™¤äº†â€œDeepSeek-R1-Q4_K_M-0000X-of-00009.ggufâ€ï¼Œè¿˜æœ‰â€œDeepSeek-R1-Zero-Q4_K_M-0000X-of-00009.ggufâ€</span></span><br>(self-llm) root@ksp-registry:/opt/code_repos/AI_models# python download.py<br>Downloading Model to directory: /opt/code_repos/AI_models/DeepSeek-R1-GGUF<br>2025-03-17 10:50:41,631 - modelscope - INFO - Got 18 files, start to download ...<br>Processing 18 items:   0%|                                                                                                     | 0.00/18.0 [00:00&lt;?, ?it/s]<br>Downloading [DeepSeek-R1-Q4_K_M/DeepSeek-R1-Q4_K_M-00001-of-00009.gguf]:   1%|â–                                      | 322M/45.0G [01:05&lt;2:22:31, 5.61MB/s]<br></code></pre></td></tr></table></figure><h3 id="ä¸‹è½½é…ç½®æ–‡ä»¶">ä¸‹è½½é…ç½®æ–‡ä»¶</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@ksp-registry:/opt/code_repos/AI_models/DeepSeek-R1-GGUF# wget https://modelscope.cn/models/unsloth/DeepSeek-R1-GGUF/resolve/master/config.json<br><br>root@ksp-registry:/opt/code_repos/AI_models/DeepSeek-R1-GGUF# wget https://modelscope.cn/models/unsloth/DeepSeek-R1-GGUF/resolve/master/.gitattributes<br><br>root@ksp-registry:/opt/code_repos/AI_models/DeepSeek-R1-GGUF# wget https://modelscope.cn/models/unsloth/DeepSeek-R1-GGUF/resolve/master/configuration.json<br><br>root@ksp-registry:/opt/code_repos/AI_models/DeepSeek-R1-GGUF# wget https://modelscope.cn/models/unsloth/DeepSeek-R1-GGUF/resolve/master/README.md<br></code></pre></td></tr></table></figure><h3 id="llama.cppè¿è¡Œæ¨¡å‹å¯é€‰">llama.cppè¿è¡Œæ¨¡å‹(å¯é€‰)</h3><p>å‚è€ƒï¼šhttps://www.modelscope.cn/models/unsloth/DeepSeek-R1-GGUF</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">###ä»¥ä¸‹æ–¹æ³•æœ‰é£é™©(å¯èƒ½ä¼šè¦†ç›–åŸæœ‰çš„cmake-3.16.3)ï¼Œæš‚æœªæ‰§è¡Œ</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@ksp-registry:/opt/installPkgs# <span class="hljs-built_in">cd</span> cmake-3.23.0/</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ£€æŸ¥ç³»ç»Ÿç¯å¢ƒå¹¶ç”Ÿæˆ Makefileï¼ˆ--prefix=/pathæŒ‡å®šå®‰è£…è·¯å¾„ï¼ˆé»˜è®¤ä¸º /usr/localï¼‰ï¼‰</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@ksp-registry:/opt/installPkgs/cmake-3.23.0# ./configure</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç¼–è¯‘</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@ksp-registry:/opt/installPkgs/cmake-3.23.0# make -j8</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@ksp-registry:/opt/installPkgs/cmake-3.23.0# make install</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#å»ºç«‹è½¯é“¾æ¥ï¼Œä½¿ç”¨å®‰è£…çš„æ–°ç‰ˆæœ¬çš„cmake</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">update-alternatives --install /usr/bin/cmake  cmake /usr/local/bin/cmake  1 â€“force</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell">apt-get update<br>apt-get install build-essential curl libcurl4-openssl-dev -y<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##ä¸‹é¢çš„æ­¥éª¤å¯é€‰</span></span><br>(self-llm) root@ksp-registry:~# cd /opt/code_repos/<br>(self-llm) root@ksp-registry:~# git clone https://github.com/ggerganov/llama.cpp<br><br>cmake llama.cpp -B llama.cpp/build \<br>-DBUILD_SHARED_LIBS=OFF -DGGML_CUDA=ON -DLLAMA_CURL=ON<br>cmake --build llama.cpp/build --config Release -j --clean-first --target llama-quantize llama-cli llama-gguf-split<br><br>root@ksp-registry:/opt/code_repos# ll llama.cpp/build/bin/llama-*<br>-rwxr-xr-x 1 root root 451135880 Mar 17 11:13 llama.cpp/build/bin/llama-cli*<br>-rwxr-xr-x 1 root root 449090696 Mar 17 11:13 llama.cpp/build/bin/llama-gguf-split*<br>-rwxr-xr-x 1 root root 449629880 Mar 17 11:12 llama.cpp/build/bin/llama-quantize*<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†ç”Ÿæˆçš„3ä¸ªæ–‡ä»¶å¤åˆ¶åˆ°ç›®å½•llama.cpp ä¸‹</span><br>cp llama.cpp/build/bin/llama-* llama.cpp<br><br></code></pre></td></tr></table></figure><h2 id="å®‰è£…åŸºç¡€ç»„ä»¶æˆ–ä¾èµ–">3.2 å®‰è£…åŸºç¡€ç»„ä»¶æˆ–ä¾èµ–</h2><h3 id="nvidiaé©±åŠ¨ä¸cuda">3.2.1 NVIDIAé©±åŠ¨ä¸cuda</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">NVIDIAé©±åŠ¨å·²ç»å®‰è£…å¥½</span><br>(self-llm) root@ksp-registry:/opt/code_repos# nvidia-smi <br>Mon Mar 17 14:53:50 2025       <br>+-----------------------------------------------------------------------------------------+<br>| NVIDIA-SMI 550.54.15              Driver Version: 550.54.15      CUDA Version: 12.4     |<br>|-----------------------------------------+------------------------+----------------------+<br>| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |<br>| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |<br>|                                         |                        |               MIG M. |<br>|=========================================+========================+======================|<br>|   0  NVIDIA A40                     Off |   00000000:C1:00.0 Off |                    0 |<br>|  0%   33C    P8             21W /  300W |       0MiB /  46068MiB |      0%      Default |<br>|                                         |                        |                  N/A |<br>+-----------------------------------------+------------------------+----------------------+<br>                                                                                         <br>+-----------------------------------------------------------------------------------------+<br>| Processes:                                                                              |<br>|  GPU   GI   CI        PID   Type   Process name                              GPU Memory |<br>|        ID   ID                                                               Usage      |<br>|=========================================================================================|<br>|  No running processes found                                                             |<br>+-----------------------------------------------------------------------------------------+<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…cuda12.4</span><br>(self-llm) root@ksp-registry:/opt/code_repos# ll /opt/nvidia-driver-cuda-for-A40/<br>total 4650004<br>drwxr-xr-x 2 root root       4096 Feb 14 14:31 ./<br>drwxr-xr-x 8 root root       4096 Mar 17 10:25 ../<br>-rw-r--r-- 1 root root 4454730420 Mar 29  2024 cuda_12.4.1_550.54.15_linux.run<br>-rwxrwxrwx 1 root root  306858135 May 17  2024 NVIDIA-Linux-x86_64-550.54.15.run*<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¹Ÿå·²ç»å®‰è£…å¥½</span><br>(self-llm) root@ksp-registry:/opt/code_repos# nvcc -V<br>nvcc: NVIDIA (R) Cuda compiler driver<br>Copyright (c) 2005-2024 NVIDIA Corporation<br>Built on Thu_Mar_28_02:18:24_PDT_2024<br>Cuda compilation tools, release 12.4, V12.4.131<br>Build cuda_12.4.r12.4/compiler.34097967_0<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç¼–è¾‘/root/.bashrcï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹</span><br>(self-llm) root@ksp-registry:/opt/code_repos# vi /root/.bashrc <br>export PATH=/usr/local/cuda-12.4/bin/:$PATH<br>export LD_LIBRARY_PATH=/usr/local/cuda-12.4/lib64:$LD_LIBRARY_PATH<br>export CUDA_PATH=/usr/local/cuda<br>(self-llm) root@ksp-registry:/opt/code_repos# source /root/.bashrc <br></code></pre></td></tr></table></figure><h3 id="å®‰è£…ç¼–è¯‘ç»„ä»¶">3.2.2 å®‰è£…ç¼–è¯‘ç»„ä»¶</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs shell">apt-get update<br>apt-get install gcc g++ ninja-build<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹gccç‰ˆæœ¬</span><br>(self-llm) root@ksp-registry:/opt/code_repos# gcc --version<br>gcc (Ubuntu 9.4.0-1ubuntu1~20.04.2) 9.4.0<br>Copyright (C) 2019 Free Software Foundation, Inc.<br>This is free software; see the source for copying conditions.  There is NO<br>warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹g++ç‰ˆæœ¬</span><br>(self-llm) root@ksp-registry:/opt/code_repos# g++ --version<br>g++ (Ubuntu 9.4.0-1ubuntu1~20.04.2) 9.4.0<br>Copyright (C) 2019 Free Software Foundation, Inc.<br>This is free software; see the source for copying conditions.  There is NO<br>warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹cmakeç‰ˆæœ¬</span><br>(self-llm) root@ksp-registry:/opt/code_repos# cmake --version<br>cmake version 3.23.0<br><br>CMake suite maintained and supported by Kitware (kitware.com/cmake).<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹ninjaç‰ˆæœ¬</span><br>(self-llm) root@ksp-registry:/opt/code_repos# ninja --version<br>1.10.0<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…åŸºç¡€ç»„ä»¶</span><br>(self-llm) root@ksp-registry:/opt/code_repos# apt install build-essential curl libcurl4-openssl-dev -y<br></code></pre></td></tr></table></figure><h2 id="åˆ›å»ºktä¸“ç”¨pythonè™šæ‹Ÿç¯å¢ƒ">3.3 åˆ›å»ºKTä¸“ç”¨pythonè™šæ‹Ÿç¯å¢ƒ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">conda create --name kt python=3.11<br>conda activate kt<br></code></pre></td></tr></table></figure><h2 id="å®‰è£…ktransformers">3.4 å®‰è£…KTransformers</h2><p>KTçš„githubä»“åº“ï¼šhttps://github.com/kvcache-ai/ktransformers/tree/v0.2.3post2</p><p>å®‰è£…æ–‡æ¡£ï¼šKtå®˜æ–¹å®‰è£…æ–‡æ¡£ï¼ˆhttps://kvcache-ai.github.io/ktransformers/en/install.htmlï¼‰</p><h3 id="æ‰§è¡Œå®‰è£…å‰å‡†å¤‡">æ‰§è¡Œå®‰è£…å‰å‡†å¤‡</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">(kt) root@ksp-registry:/opt/code_repos# git clone -b v0.2.3post2 https://gitee.com/sy-jiang/ktransformers.git<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿è¯æ­¤pythonè™šæ‹Ÿç¯å¢ƒä½¿ç”¨çš„GNU C++æ ‡å‡†åº“ç‰ˆæœ¬åŒ…æ‹¬GLIBCXX-3.4.32</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">condaæä¾›äº†ä¸€ä¸ªåä¸ºlibstdcxx-ngçš„åŒ…ï¼Œå®ƒåŒ…å«äº†æ–°ç‰ˆæœ¬çš„libstdc++ï¼Œå…¶å¯ä»¥é€šè¿‡conda-forgeè¿›è¡Œå®‰è£…</span><br>(kt) root@ksp-registry:/opt/code_repos# conda install -c conda-forge libstdcxx-ng<br>(kt) root@ksp-registry:/opt/code_repos# strings ~/anaconda3/envs/ktransformers/lib/libstdc++.so.6 | grep GLIBCXX<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…PyTorch, packaging, ninja ç­‰</span><br>(kt) root@ksp-registry:/opt/code_repos# pip install torch==2.4.1 torchvision==0.19.1 torchaudio==2.4.1 --index-url https://download.pytorch.org/whl/cu124<br>(kt) root@ksp-registry:/opt/code_repos# pip install packaging ninja cpufeature numpy flash-attn <br></code></pre></td></tr></table></figure><h3 id="åˆå§‹åŒ–æºç ">åˆå§‹åŒ–æºç </h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">init <span class="hljs-built_in">source</span> code</span><br>cd ktransformers<br>(kt) root@ksp-registry:/opt/code_repos/ktransformers# git submodule init<br>(kt) root@ksp-registry:/opt/code_repos/ktransformers# git submodule update<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚ä¸‹llama.cppã€pybind11 ä¸¤ä¸ªç›®å½•æ˜¯åˆšåˆšæ–°ç”Ÿæˆçš„</span><br>(kt) root@ksp-registry:/opt/code_repos/ktransformers# ll third_party/<br>total 20<br>drwxr-xr-x  5 root root 4096 Mar 18 10:41 ./<br>drwxr-xr-x  9 root root 4096 Mar 18 10:50 ../<br>drwxr-xr-x 24 root root 4096 Mar 18 10:58 llama.cpp/<br>drwxr-xr-x  2 root root 4096 Mar 18 10:41 llamafile/<br>drwxr-xr-x  8 root root 4096 Mar 18 10:58 pybind11/<br><br></code></pre></td></tr></table></figure><h3 id="ç¼–è¯‘kt-website">ç¼–è¯‘kt-website</h3><p>å‚è€ƒæ–‡æ¡£ï¼šhttps://kvcache-ai.github.io/ktransformers/en/api/server/website.html</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">è¦æ±‚Node.js&gt;=18.3</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœå·²ç»é€šè¿‡ubuntu20é»˜è®¤å®‰è£…æºå®‰è£…äº†nodejsï¼Œå…¶ç‰ˆæœ¬å¤ªä½ï¼Œéœ€è¦å…ˆå¸è½½æ‰</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">apt-get remove nodejs npm -y &amp;&amp; <span class="hljs-built_in">sudo</span> apt-get autoremove -y</span><br>apt-get update -y &amp;&amp; apt-get install -y apt-transport-https ca-certificates curl gnupg<br><br>curl -fsSL https://deb.nodesource.com/gpgkey/nodesource-repo.gpg.key | gpg --dearmor -o /usr/share/keyrings/nodesource.gpg<br><br>chmod 644 /usr/share/keyrings/nodesource.gpg<br><br>echo &quot;deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/nodesource.gpg] https://deb.nodesource.com/node_23.x nodistro main&quot; | sudo tee /etc/apt/sources.list.d/nodesource.list<br><br>apt-get update -y<br>apt-get install nodejs -y<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹nodejsä¸npmç‰ˆæœ¬</span><br>(kt) root@ksp-registry:/opt/code_repos/ktransformers# node -v<br>v23.10.0<br>(kt) root@ksp-registry:/opt/code_repos/ktransformers# npm -v<br>10.9.2<br><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…Vue CLI</span><br>(kt) root@ksp-registry:/opt/code_repos/ktransformers/ktransformers/website# npm install @vue/cli<br>(kt) root@ksp-registry:/opt/code_repos/ktransformers/ktransformers/website# npm run build<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æš‚æ—¶ä¹Ÿå¯ä¸æ‰§è¡Œï¼Œåç»­ä¼šæœ‰æ­¥éª¤æ‰§è¡Œæ­¤æ“ä½œ</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨websiteç¼–è¯‘ktransformers</span> <br>(kt) root@ksp-registry:/opt/code_repos/ktransformers/ktransformers/website# cd ../../<br>(kt) root@ksp-registry:/opt/code_repos/ktransformers# pip install .<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹å®‰è£…çš„ktä¿¡æ¯</span><br>(kt) root@ksp-registry:/opt/code_repos/ktransformers# pip show ktransformers<br>Name: ktransformers<br>Version: 0.2.3.post2<br>Summary: KTransformers, pronounced as Quick Transformers, is designed to enhance your Transformers experience with advanced kernel optimizations and placement/parallelism strategies.<br>Home-page: https://kvcache.ai<br>Author: <br>Author-email: &quot;KVCache.AI&quot; &lt;zhang.mingxing@outlook.com&gt;<br>License: Apache License<br>...<br></code></pre></td></tr></table></figure><h3 id="å®‰è£…kt">å®‰è£…KT</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">1ï¼‰å¯¹äºæœ‰åŒæ§½CPUå’Œå†…å­˜æ˜¯æ¨¡å‹æ–‡ä»¶ä¸¤å€å¤§å°ä»¥ä¸Šçš„æœåŠ¡å™¨</span><br>(kt) root@ksp-registry:/opt/code_repos/ktransformers# apt install libnuma-dev<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##(kt) root@ksp-registry:/opt/code_repos/ktransformers# export USE_NUMA=1  #ä¸è¦æ‰§è¡Œï¼Œç¬”è€…æ‰§è¡Œäº†åé¢å¯åŠ¨æ¨¡å‹æœåŠ¡æ—¶å†…å­˜çˆ†äº†</span></span><br>(kt) root@ksp-registry:/opt/code_repos/ktransformers# bash install.sh   # or #make dev_install<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">2ï¼‰å¦åˆ™ï¼Œç›´æ¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</span><br>(kt) root@ksp-registry:/opt/code_repos/ktransformers# bash install.sh<br></code></pre></td></tr></table></figure><figure><img src="https://s2.loli.net/2025/03/18/sKoiTC7548E3rGN.png" alt="image-20250318155035637" /><figcaption aria-hidden="true">image-20250318155035637</figcaption></figure><p>å¦‚ä¸‹æŸ¥çœ‹å®‰è£…æˆåŠŸçš„KTransformersï¼š<code>pip show ktransformers</code></p><figure><img src="https://s2.loli.net/2025/03/18/w7XSJMEuI9yi8Om.png" alt="image-20250318155131355" /><figcaption aria-hidden="true">image-20250318155131355</figcaption></figure><h2 id="local-chatæœ¬åœ°å¯¹è¯">3.5 Local Chatæœ¬åœ°å¯¹è¯</h2><p>å‚è€ƒï¼šhttps://github.com/kvcache-ai/ktransformers/blob/v0.2.3post2/doc/zh/DeepseekR1_V3_tutorial_zh.md#v02-%E5%B1%95%E7%A4%BA</p><p><img src="C:\Users\jiangsanyin\AppData\Roaming\Typora\typora-user-images\image-20250319160528821.png" alt="image-20250319160528821" style="zoom: 33%;" /></p><h3 id="å¯åŠ¨æœ¬åœ°å¯¹è¯">3.5.1 å¯åŠ¨æœ¬åœ°å¯¹è¯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">(kt) root@ksp-registry:/opt/code_repos/ktransformers# cp ./ktransformers/models/configuration_deepseek.py /opt/code_repos/AI_models/DeepSeek-R1-GGUF<br>(kt) root@ksp-registry:/opt/code_repos/ktransformers# cp ./ktransformers/models/configuration_deepseek_v3.py /opt/code_repos/AI_models/DeepSeek-R1-GGUF<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#åœ¨KTä»“åº“æ ¹ç›®å½•æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</span></span><br>(kt) root@ksp-registry:/opt/code_repos/ktransformers# python ./ktransformers/local_chat.py --model_path deepseek-ai/DeepSeek-R1 \<br>  --gguf_path /opt/code_repos/AI_models/DeepSeek-R1-GGUF/DeepSeek-R1-Q4_K_M \<br>  --cpu_infer 36 --max_new_tokens 8192 --port 10002 --web True  <br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯åŠ¨è¿‡ç¨‹ä¸Šï¼Œå¯ä»¥çœ‹åˆ°è¿›ç¨‹ä½¿ç”¨äº†GPU</span><br></code></pre></td></tr></table></figure><figure><img src="https://s2.loli.net/2025/03/19/K4hIlFSWxVzQd3e.png" alt="image-20250319102718590" /><figcaption aria-hidden="true">image-20250319102718590</figcaption></figure><p>æœ€ç»ˆçœ‹åˆ°å¯¹è¯çª—å£ï¼š</p><figure><img src="https://s2.loli.net/2025/03/19/RV5CGyF3UTxajkH.png" alt="image-20250319174522477" /><figcaption aria-hidden="true">image-20250319174522477</figcaption></figure><p>åŠ è½½è¿‡ç¨‹ä¸­åŠå®Œæˆåï¼Œå ç”¨çš„å†…å­˜å¾ˆå°‘ï¼š</p><figure><img src="https://s2.loli.net/2025/03/19/AUjrnoeQc1gFstK.png" alt="image-20250319175945166" /><figcaption aria-hidden="true">image-20250319175945166</figcaption></figure><p>ä½†GPU æ˜¾å­˜å ç”¨è¾ƒå¤šï¼Œä½†è¿œæ²¡æ»¡</p><figure><img src="https://s2.loli.net/2025/03/19/cNX6p1FGWhUC2gl.png" alt="image-20250319180135883" /><figcaption aria-hidden="true">image-20250319180135883</figcaption></figure><h3 id="æŠ¥é”™ä¸å¤„ç†">3.5.2 æŠ¥é”™ä¸å¤„ç†</h3><h4 id="couldnt-connect-to-httpshuggingface.co">3.5.2.1 couldn't connect to 'https://huggingface.co'</h4><p>ç¬¬ä¸€æ¬¡ï¼Œç¬”è€…æ‰§è¡Œå‘½ä»¤<code>python ./ktransformers/local_chat.py --model_path unsloth/DeepSeek-R1-GGUF --gguf_path /opt/code_repos/AI_models/DeepSeek-R1-GGUF/DeepSeek-R1-Q4_K_M --cpu_infer 36 --max_new_tokens 8192</code>æ—¶ï¼Œæç¤º</p><p>â€œOSError: We couldn't connect to 'https://huggingface.co' to load this file, couldn't find it in the cached files and it looks like unsloth/DeepSeek-R1-GGUF is not the path to a directory containing a file named config.json.</p><p>Checkout your internet connection or see how to run the library in offline mode at 'https://huggingface.co/docs/transformers/installation#offline-mode'.â€</p><p>å…·ä½“å¦‚ä¸‹ï¼š</p><figure><img src="https://s2.loli.net/2025/03/18/wcEQDdAToZ3MFUL.png" alt="image-20250318162546417" /><figcaption aria-hidden="true">image-20250318162546417</figcaption></figure><p>è§£å†³åŠæ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å‚è€ƒhttps://github.com/huggingface/diffusers/issues/6223</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ·»åŠ å˜é‡</span><br>(kt) root@ksp-registry:/opt/code_repos/ktransformers# export HF_ENDPOINT=https://hf-mirror.com<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å†æ¬¡æ‰§è¡Œ</span><br>(kt) root@ksp-registry:/opt/code_repos/ktransformers# python ./ktransformers/local_chat.py --model_path unsloth/DeepSeek-R1-GGUF --gguf_path /opt/code_repos/AI_models/DeepSeek-R1-GGUF/DeepSeek-R1-Q4_K_M --cpu_infer 36 --max_new_tokens 8192<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ­¤æ—¶è¿˜æ˜¯æŠ¥é”™ï¼Œä½†æŠ¥é”™å†…å®¹ä¸ä¸€æ ·ã€‚å¦‚ä¸‹â€œOSError: unsloth/DeepSeek-R1-GGUF does not appear to have a file named configuration_deepseek.py. Checkout <span class="hljs-string">&#x27;https://huggingface.co/unsloth/DeepSeek-R1-GGUF/tree/main&#x27;</span> <span class="hljs-keyword">for</span> available files.â€</span><br></code></pre></td></tr></table></figure><figure><img src="https://s2.loli.net/2025/03/19/R51KPNGjdcb8E6H.png" alt="image-20250319101437770" /><figcaption aria-hidden="true">image-20250319101437770</figcaption></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ç¬”è€…å…ˆå‰åœ¨â€œhttps://modelscope.cn/models/unsloth/DeepSeek-R1-GGUF/filesâ€ä¸‹è½½çš„<span class="hljs-string">&quot;DeepSeek-R1-Q4_K_M&quot;</span>ç›¸å…³æ–‡ä»¶ï¼Œä½†æ­¤é“¾æ¥ä¸‹å¹¶æ²¡æœ‰ä¸Šè¿°æŠ¥é”™ä¸­æåˆ°çš„ï¼ˆå¯åŠ¨å¯¹è¯è¿‡ç¨‹ä¸­éœ€è¦ç”¨åˆ°çš„ï¼‰configuration_deepseek.py æ–‡ä»¶ï¼Œæ ¹æ®KTå®˜ç½‘çš„ç¤ºä¾‹ï¼Œéœ€è¦æŒ‡å®šâ€œ--model_path deepseek-ai/DeepSeek-R1â€ï¼Œæ­¤æ—¶å†æ‰§è¡Œå°±ä¼šæ­£å¸¸ä¸‹è½½configuration_deepseek.py æ–‡ä»¶å¹¶ç»§ç»­å¾€åæ‰§è¡Œäº†</span><br>(kt) root@ksp-registry:/opt/code_repos/ktransformers# python ./ktransformers/local_chat.py --model_path deepseek-ai/DeepSeek-R1 \<br>  --gguf_path /opt/code_repos/AI_models/DeepSeek-R1-GGUF/DeepSeek-R1-Q4_K_M \<br>  --cpu_infer 36 --max_new_tokens 8192<br></code></pre></td></tr></table></figure><h4 id="å†…å­˜ä¸å¤Ÿè¢«-killed">3.5.2.2 å†…å­˜ä¸å¤Ÿï¼Œè¢« killed</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">(kt) root@ksp-registry:/opt/code_repos/ktransformers# export USE_NUMA=1<br>(kt) root@ksp-registry:/opt/code_repos/ktransformers# bash install.sh   # or #make dev_install<br>(kt) root@ksp-registry:/opt/code_repos/ktransformers# python ./ktransformers/local_chat.py --model_path deepseek-ai/DeepSeek-R1 \<br>  --gguf_path /opt/code_repos/AI_models_/DeepSeek-R1-GGUF/DeepSeek-R1-Q4_K_M \<br>  --cpu_infer 32 --max_new_tokens 8192<br></code></pre></td></tr></table></figure><p>åŒæ—¶å¯ä»¥çœ‹åˆ°å¯ç”¨å†…å­˜æ€¥å‰§ä¸‹é™ã€‚</p><p>æ­¤æœåŠ¡å™¨åªæœ‰503Gæ€»å†…å­˜ï¼ŒåŠ è½½å—çš„è¿‡ç¨‹ä¸­å› ä¸ºå†…å­˜ä¸è¶³ï¼Œè¿›ç¨‹æœ€ç»ˆè¢«è‡ªåŠ¨æ€æ­»ï¼š</p><p><img src="https://s2.loli.net/2025/03/19/mr3EcPARvQbqIxk.png" alt="image-20250319103756422" style="zoom:67%;" /></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ›å»º 800GB çš„ Swap æ–‡ä»¶ï¼ˆå› ä¸ºç¬”è€…æ­¤æœåŠ¡å™¨å®‰è£…æ“ä½œç³»ç»Ÿçš„ç³»ç»Ÿç›˜å°±æ˜¯SSDç›˜ï¼Œæ‰€ä»¥ç›´æ¥ä»ç³»ç»Ÿç›˜ä¸­åˆ’åˆ†å‡º300Gï¼‰</span><br>(kt) root@ksp-registry:/# fallocate -l 800G /opt/code_repos/test_swap/swapfile<br>(kt) root@ksp-registry:/# chmod 600 /opt/code_repos/test_swap/swapfile<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†æ–‡ä»¶æˆ–åˆ†åŒºåˆå§‹åŒ–ä¸ºäº¤æ¢ç©ºé—´</span><br>(kt) root@ksp-registry:/# mkswap /opt/code_repos/test_swap/swapfile<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯ç”¨äº¤æ¢æ–‡ä»¶</span><br>(kt) root@ksp-registry:/# swapon /opt/code_repos/test_swap/swapfile<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹ç‰©ç†å†…å­˜ä¸äº¤æ¢å†…å­˜</span><br>root@ksp-registry:~# free -h<br>              total        used        free      shared  buff/cache   available<br>Mem:          503Gi       4.7Gi       226Gi       8.0Mi       272Gi       496Gi<br>Swap:         799Gi          0B       799Gi<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ é™¤äº¤æ¢ç©ºé—´</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">swapoff /swapfile</span> <br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-built_in">rm</span> /swapfile</span> <br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#åœ¨KTä»“åº“æ ¹ç›®å½•æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œä½¿ç”¨â€œ--web Trueâ€websiteä¼šä¸€èµ·å¯åŠ¨ï¼Œâ€œ--port 10002â€æŒ‡å®šwebè®¿é—®ç«¯å£</span></span><br>(kt) root@ksp-registry:/opt/code_repos/ktransformers# python ./ktransformers/local_chat.py --model_path deepseek-ai/DeepSeek-R1 \<br>  --gguf_path /opt/code_repos/AI_models_/DeepSeek-R1-GGUF/DeepSeek-R1-Q4_K_M \<br>  --cpu_infer 32 --max_new_tokens 8192 --port 10002 --web True<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##æˆ‘çš„å®éªŒç»“æœè¿˜æ˜¯å¤±è´¥ï¼ŒåŠ è½½åˆ°28å±‚å°±è¢«killedï¼Œç¼ºå†…å­˜</span></span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/03/19/3PVtvs7umwoqbzI.png" alt="image-20250319164809383" style="zoom:50%;" /></p><p>è§£å†³åŠæ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ­¤æ­¥éª¤å¾ˆå…³é”®</span><br>(kt) root@ksp-registry:/opt/code_repos/ktransformers# unset USE_NUMA<br><span class="hljs-meta prompt_">#</span><span class="language-bash">é‡æ–°å®‰è£…KTransformers</span><br>(kt) root@ksp-registry:/opt/code_repos/ktransformers# bash install.sh   # or #make dev_install<br></code></pre></td></tr></table></figure><figure><img src="https://s2.loli.net/2025/03/19/RV5CGyF3UTxajkH.png" alt="image-20250319174522477" /><figcaption aria-hidden="true">image-20250319174522477</figcaption></figure><h4 id="å®‰è£…flashinferå¯é€‰">3.5.2.3 å®‰è£…flashinfer(å¯é€‰)</h4><p>æ¯æ¬¡å¯åŠ¨æ¨¡å‹æœåŠ¡æ—¶ï¼Œéƒ½ä¼šæç¤º<code>flashinfer not found, use triton for linux using custom modeling_xxx.py.</code></p><p>flashinfer æ˜¯ä¸€ä¸ªç”¨äºåŠ é€Ÿå¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰éƒ¨ç½²çš„æ ¸åº“ã€‚å®ƒé€šè¿‡æä¾›é«˜æ•ˆçš„å†…å­˜å¸¦å®½å…±äº«å‰ç¼€æ‰¹å¤„ç†è§£ç æŠ€æœ¯ï¼Œæ˜¾è‘—æå‡äº†è‡ªæ³¨æ„åŠ›æœºåˆ¶çš„æ€§èƒ½ã€‚FlashInfer æ”¯æŒå¤šç§ GPU æ¶æ„ï¼ŒåŒ…æ‹¬ sm80ã€sm86ã€sm89 å’Œ sm90ï¼Œå¹¶ä¸”æ­£åœ¨å¼€å‘å¯¹ sm75 å’Œ sm70 çš„æ”¯æŒã€‚</p><p>å…¶åœ¨githubä¸Šçš„ä»£ç ä»“åº“åœ°å€ï¼šhttps://github.com/flashinfer-ai/flashinfer.git</p><p>å®˜æ–¹å®‰è£…æ–‡æ¡£ï¼šhttps://docs.flashinfer.ai/installation.html</p><h5 id="é€šè¿‡pipå®‰è£…">é€šè¿‡pipå®‰è£…</h5><figure><img src="https://s2.loli.net/2025/03/19/NpZwmkMroBP2WLt.png" alt="image-20250319215515077" /><figcaption aria-hidden="true">image-20250319215515077</figcaption></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install flashinfer -i https://flashinfer.ai/whl/cu124/torch2.4/<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æˆ–</span><br>wget https://github.com/flashinfer-ai/flashinfer/releases/download/v0.2.0.post1/flashinfer-0.2.0.post1+cu124torch2.4-cp311-cp311-linux_x86_64.whl<br>pip install flashinfer-0.2.0.post1+cu124torch2.4-cp311-cp311-linux_x86_64.whl<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##ä½†æ­¤æ—¶ä¼šæç¤ºflashinfer do not have attribute mlaï¼Œçœ‹åˆ°å¦‚ä¸‹å¤„ç†æ–¹æ³•ï¼ˆhttps://github.com/kvcache-ai/ktransformers/issues/792ï¼‰ï¼š</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">replace pip install flashinfer -i https://flashinfer.ai/whl/cu121/torch2.3 with:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">install JIT version:</span><br>pip install flashinfer-python<br>conda install cuda-nvcc -c nvidia<br>export CUDA_HOME=$CONDA_PREFIX<br>export TORCH_CUDA_ARCH_LIST=&quot;8.0+PTX&quot;<br></code></pre></td></tr></table></figure><h5 id="é€šè¿‡æºç å®‰è£…">é€šè¿‡æºç å®‰è£…</h5><p>å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.flashinfer.ai/installation.html#install-from-source</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone -b v0.2.1.post1 https://github.com/flashinfer-ai/flashinfer.git --recursive<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>KTransformers</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Datawhaleå¤§è¯­è¨€æ¨¡å‹è¯¾ç¨‹åˆ†ç»„å­¦ä¹ </title>
    <link href="/2025/03/11/Datawhale%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E8%AF%BE%E7%A8%8B%E5%88%86%E7%BB%84%E5%AD%A6%E4%B9%A0/"/>
    <url>/2025/03/11/Datawhale%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E8%AF%BE%E7%A8%8B%E5%88%86%E7%BB%84%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€è¯¾ç¨‹å­¦ä¹ å†…å®¹ä¸æ‰“å¡è¦æ±‚">ä¸€ã€è¯¾ç¨‹å­¦ä¹ å†…å®¹ä¸æ‰“å¡è¦æ±‚</h1><p>~</p><h1 id="äºŒæ­£å¼è¯¾ç¨‹å†…å®¹">äºŒã€æ­£å¼è¯¾ç¨‹å†…å®¹</h1><h2 id="ç¬¬ä¸€è¯¾-åˆè¯†å¤§æ¨¡å‹">2.1 ç¬¬ä¸€è¯¾ åˆè¯†å¤§æ¨¡å‹</h2><h3 id="è¯­è¨€æ¨¡å‹çš„å‘å±•">2.1.1 è¯­è¨€æ¨¡å‹çš„å‘å±•</h3><p>ChatPGTäº2022å¹´11æœˆåº•ä¸Šçº¿ï¼Œå¼•çˆ†å…¨çƒå…³æ³¨ã€‚</p><figure><img src="https://s2.loli.net/2025/03/11/Fn16rH4y5GEv3ie.png" alt="image-20250311222953477" /><figcaption aria-hidden="true">image-20250311222953477</figcaption></figure><hr /><ul><li>è¯­è¨€æ¨¡å‹é€šå¸¸æ˜¯æŒ‡èƒ½å¤Ÿå»ºæ¨¡è‡ªç„¶è¯­è¨€æ–‡æœ¬ç”Ÿæˆæ¦‚ç‡çš„æ¨¡å‹</li><li>ä»è¯­è¨€å»ºæ¨¡åˆ°ä»»åŠ¡æ±‚è§£ï¼Œè¿™æ˜¯ç§‘å­¦æ€ç»´çš„ä¸€æ¬¡é‡è¦è·ƒå‡</li></ul><figure><img src="https://s2.loli.net/2025/03/11/9LwhDs5Cx3vAaQu.png" alt="image-20250311223332799" /><figcaption aria-hidden="true">image-20250311223332799</figcaption></figure><hr /><figure><img src="https://s2.loli.net/2025/03/11/Eq7eFtaM4wvsAx8.png" alt="image-20250311223517477" /><figcaption aria-hidden="true">image-20250311223517477</figcaption></figure><hr /><figure><img src="https://s2.loli.net/2025/03/11/TZCMtVE8QB9OrfW.png" alt="image-20250311223536000" /><figcaption aria-hidden="true">image-20250311223536000</figcaption></figure><hr /><figure><img src="https://s2.loli.net/2025/03/11/uK6kTPyD4fFZd1i.png" alt="image-20250311224233248" /><figcaption aria-hidden="true">image-20250311224233248</figcaption></figure><hr /><figure><img src="https://s2.loli.net/2025/03/11/8deSsAUWn4PuNcD.png" alt="image-20250311224538485" /><figcaption aria-hidden="true">image-20250311224538485</figcaption></figure><hr /><figure><img src="https://s2.loli.net/2025/03/11/CYwQx3bRq9Hoz2L.png" alt="image-20250311224606930" /><figcaption aria-hidden="true">image-20250311224606930</figcaption></figure><hr /><figure><img src="https://s2.loli.net/2025/03/11/VsWJOKqiD7ac4Zk.png" alt="image-20250311225240822" /><figcaption aria-hidden="true">image-20250311225240822</figcaption></figure><hr /><figure><img src="https://s2.loli.net/2025/03/11/LE5ToHOftRIy4N2.png" alt="image-20250311225357961" /><figcaption aria-hidden="true">image-20250311225357961</figcaption></figure><hr /><figure><img src="https://s2.loli.net/2025/03/11/xep3Ss69PtOaKGZ.png" alt="image-20250311225457744" /><figcaption aria-hidden="true">image-20250311225457744</figcaption></figure><figure><img src="https://s2.loli.net/2025/03/11/whv59DG763xdMXP.png" alt="image-20250311225848903" /><figcaption aria-hidden="true">image-20250311225848903</figcaption></figure><figure><img src="https://s2.loli.net/2025/03/11/9lCOsNR617KBzpi.png" alt="image-20250311225901215" /><figcaption aria-hidden="true">image-20250311225901215</figcaption></figure><figure><img src="https://s2.loli.net/2025/03/11/TXJofI6LqzmtNAR.png" alt="image-20250311225912743" /><figcaption aria-hidden="true">image-20250311225912743</figcaption></figure><hr /><figure><img src="https://s2.loli.net/2025/03/11/q89iT2NkcfrBtuo.png" alt="image-20250311225956786" /><figcaption aria-hidden="true">image-20250311225956786</figcaption></figure><figure><img src="https://s2.loli.net/2025/03/11/35ZkbDROoeSzdG7.png" alt="image-20250311230014329" /><figcaption aria-hidden="true">image-20250311230014329</figcaption></figure><figure><img src="https://s2.loli.net/2025/03/11/F2sIqAYz1cupiEe.png" alt="image-20250311230023897" /><figcaption aria-hidden="true">image-20250311230023897</figcaption></figure><h3 id="å¤§æ¨¡å‹æŠ€æœ¯åŸºç¡€">2.1.2 å¤§æ¨¡å‹æŠ€æœ¯åŸºç¡€</h3><p>å¤§æ¨¡å‹ï¼šé€šå¸¸æ˜¯æŒ‡å…·æœ‰è¶…å¤§è§„æ¨¡å‚æ•°çš„é¢„è®­ç»ƒè¯­è¨€æ¨¡å‹ã€‚æ„æ¶ä¸Šä¸€èˆ¬ä½¿ç”¨Transformerè§£ç å™¨æ„æ¶ã€‚å…¶è®­ç»ƒåŒ…æ‹¬é¢„è®­ç»ƒpre-trainingï¼ˆç”Ÿæˆbase modelï¼‰ä¸åè®­ç»ƒpost-trainingï¼ˆç”Ÿæˆinstruct modelï¼‰</p><figure><img src="https://s2.loli.net/2025/03/12/ALJPrZtbTjchway.png" alt="image-20250312164208455" /><figcaption aria-hidden="true">image-20250312164208455</figcaption></figure><p>é¢„è®­ç»ƒä¸åè®­ç»ƒçš„ä¸»è¦åŒºåˆ«å¦‚ä¸‹ï¼š</p><figure><img src="https://s2.loli.net/2025/03/12/Fd5HcJgkEx63KAC.png" alt="image-20250312164245159" /><figcaption aria-hidden="true">image-20250312164245159</figcaption></figure><h4 id="å¤§è¯­è¨€æ¨¡å‹æ„å»ºæ¦‚è§ˆ">å¤§è¯­è¨€æ¨¡å‹æ„å»ºæ¦‚è§ˆ</h4><p>é¢„è®­ç»ƒï¼š ä½¿ç”¨ä¸ä¸‹æ¸¸ä»»åŠ¡æ— å…³çš„è§„æ¨¡æ•°æ®è¿›è¡Œæ¨¡å‹å‚æ•°çš„åˆå§‹è®­ç»ƒã€‚</p><figure><img src="https://s2.loli.net/2025/03/12/CvDBGi2fxbkRlHz.png" alt="image-20250312163951715" /><figcaption aria-hidden="true">image-20250312163951715</figcaption></figure><p>åè®­ç»ƒé‡‡ç”¨çš„æ–¹æ³•ä¸€èˆ¬æ˜¯æŒ‡ä»¤å¾®è°ƒï¼ˆInstrcution Tuningï¼‰ï¼š</p><ul><li>æŒ‡ä»¤å¾®è°ƒï¼šä½¿ç”¨è¾“å…¥ä¸è¾“å‡ºé…å¯¹çš„æŒ‡ä»¤æ•°æ®å¯¹æ¨¡å‹è¿›è¡Œå¾®è°ƒï¼Œæå‡æ¨¡å‹é€šè¿‡é—®ç­”å½¢å¼è¿›è¡Œä»»åŠ¡æ±‚è§£çš„èƒ½åŠ›ã€‚</li></ul><figure><img src="https://s2.loli.net/2025/03/12/NgrFTHPKdieut3w.png" alt="image-20250312164710415" /><figcaption aria-hidden="true">image-20250312164710415</figcaption></figure><ul><li>äººç±»å¯¹é½ï¼šå°†å¤§è¯­è¨€æ¨¡å‹ä¸äººç±»æœŸæœ›ã€éœ€æ±‚ä»¥åŠä»·å€¼è§‚å¯¹é½ï¼ŒåŸºäºäººç±»åé¦ˆçš„å¼ºåŒ–å­¦ä¹ å¯¹é½æ–¹æ³•RLHFï¼ˆReinforcement Learning from Human Feedbackï¼Œäººç±»åé¦ˆå¼ºåŒ–å­¦ä¹ ï¼‰</li></ul><figure><img src="https://s2.loli.net/2025/03/12/y42W1QeFCdT5hNx.png" alt="image-20250312164952125" /><figcaption aria-hidden="true">image-20250312164952125</figcaption></figure><p>å¤§æ¨¡å‹çš„ç ”å‘å·²ç»å·²ç»æˆä¸ºä¸€é¡¹ç³»ç»Ÿå·¥ç¨‹ã€‚</p><h4 id="æ‰©å±•å®šå¾‹">æ‰©å±•å®šå¾‹</h4><ul><li><p>KMæ‰©å±•å®šå¾‹</p><ul><li>OpenAIå›¢é˜Ÿå»ºç«‹äº†ç¥ç»è¯­è¨€æ¨¡å‹æ€§èƒ½ä¸å‚æ•°è§„æ¨¡ï¼ˆNï¼‰ã€æ•°æ®è§„æ¨¡ï¼ˆDï¼‰å’Œè®¡ç®—è§„æ¨¡ï¼ˆCï¼‰ä¹‹é—´çš„å¹‚ç­‰å…³ç³»ï¼Œå¦‚ä¸‹æ‰€ç¤º</li></ul><figure><img src="https://s2.loli.net/2025/03/12/2ioV7IMQXzwn8lZ.png" alt="image-20250312172611713" /><figcaption aria-hidden="true">image-20250312172611713</figcaption></figure></li></ul><p><img src="https://s2.loli.net/2025/03/12/nlyBq39cO7uo4QI.png" alt="image-20250312172731883" style="zoom: 25%;" /></p><p><strong>æ•°æ®è§„æ¨¡è¶Šå¤§ï¼ŒæŸå¤±è¶Šå°ã€‚ç›¸åŒçš„æ•°æ®è§„æ¨¡ï¼Œå‚æ•°è§„æ¨¡è¶Šå¤§ï¼ŒæŸå¤±è¶Šå°ã€‚</strong></p><figure><img src="https://s2.loli.net/2025/03/12/2Nof3kXcxeS7b6g.png" alt="image-20250312172103891" /><figcaption aria-hidden="true">image-20250312172103891</figcaption></figure><ul><li><p>Chinachillaæ‰©å±•å®šå¾‹</p><ul><li>DeepMindå›¢é˜Ÿäº2022å¹´æå‡ºäº†å¦ä¸€ç§å½¢å¼çš„æ‰©å±•å®šå¾‹ï¼Œæ—¨åœ¨æŒ‡å¯¼å¤§è¯­è¨€æ¨¡å‹å……åˆ†åˆ©ç”¨ç»™å®šçš„ç®—åŠ›èµ„æºä¼˜åŒ–è®­ç»ƒ</li></ul><figure><img src="https://s2.loli.net/2025/03/12/pvunfPB51hldmSq.png" alt="image-20250312205041971" /><figcaption aria-hidden="true">image-20250312205041971</figcaption></figure></li><li><p>æ·±å…¥è®¨è®º</p></li></ul><figure><img src="https://s2.loli.net/2025/03/12/Ugl158MZIXScDyd.png" alt="image-20250312205447907" /><figcaption aria-hidden="true">image-20250312205447907</figcaption></figure><hr /><h4 id="æ¶Œç°èƒ½åŠ›">æ¶Œç°èƒ½åŠ›</h4><ul><li>ä»€ä¹ˆæ˜¯æ¶Œç°èƒ½åŠ›<ul><li>åŸå§‹è®ºæ–‡å®šä¹‰ï¼šâ€œåœ¨å°å‹æ¨¡å‹ä¸­ä¸å­˜åœ¨ã€ä½†åœ¨å¤§æ¨¡å‹ä¸­å‡ºç°çš„èƒ½åŠ›â€</li><li>æ¨¡å‹æ‰©å±•åˆ°ä¸€å®šè§„æ¨¡æ—¶ï¼Œç‰¹å®šä»»åŠ¡æ€§èƒ½çªç„¶å‡ºç°æ˜¾è‘—è·ƒå‡è¶‹åŠ¿ï¼Œè¿œè¶…éšæœºæ°´å¹³</li></ul></li></ul><figure><img src="https://s2.loli.net/2025/03/12/ewPFyAO8ski5lHd.png" alt="image-20250312205725105" /><figcaption aria-hidden="true">image-20250312205725105</figcaption></figure><p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œå°†æ¨¡å‹å‚æ•°è§„æ¨¡æ‰©å±•æŸä¸ªé‡çº§æ—¶ï¼Œæ¨¡å‹æ€§èƒ½å‡ºç°æ˜¾è‘—æå‡ã€‚</p><ul><li>æ¶Œç°èƒ½åŠ›å¯èƒ½éƒ¨åˆ†å½’å› äºè¯„æµ‹è®¾ç½®<ul><li>æœ¬è¯¾ç¨‹å®šä¹‰å…¶ä¸ºâ€œä»£è¡¨æ€§èƒ½åŠ›â€ï¼Œå¹¶ä¸åŒºåˆ†æ˜¯å¦åœ¨å°æ¨¡å‹ä¸­å­˜åœ¨</li></ul></li></ul><figure><img src="https://s2.loli.net/2025/03/12/FhLoOyrIdipJ8uC.png" alt="image-20250312210030812" /><figcaption aria-hidden="true">image-20250312210030812</figcaption></figure><ul><li>ä»£è¡¨æ€§èƒ½åŠ›<ul><li>æŒ‡ä»¤éµå¾ª(Instruction Following)<ul><li>å¤§è¯­è¨€æ¨¡å‹èƒ½å¤ŸæŒ‰ç…§è‡ªç„¶è¯­è¨€æŒ‡ä»¤æ¥æ‰§è¡Œå¯¹åº”çš„ä»»åŠ¡<img src="https://s2.loli.net/2025/03/12/UFqktmcT7bf3QYl.png" alt="image-20250312210223980" /></li></ul></li><li>ä¸Šä¸‹æ–‡å­¦ä¹ ï¼ˆIn-context Learning)<ul><li>åœ¨æç¤ºä¸­ä¸ºè¯­è¨€æ¨¡å‹æä¾›è‡ªç„¶è¯­è¨€æŒ‡ä»¤å’Œä»»åŠ¡ç¤ºä¾‹ï¼Œæ— éœ€æ˜¾å¼æ¢¯åº¦æ›´æ–°å°±èƒ½ä¸ºæµ‹è¯•æ ·æœ¬ç”Ÿæˆé¢„æœŸè¾“å‡º</li><li><img src="https://s2.loli.net/2025/03/12/9PCBlt3vJgTZNKw.png" title="fig:" alt="image-20250312210612103" /></li></ul></li><li>é€æ­¥æ¨ç†ï¼ˆStep-by-step Reasoningï¼‰<ul><li>åœ¨æç¤ºä¸­å¼•å…¥ä»»åŠ¡ç›¸å…³çš„ä¸­é—´æ¨ç†æ­¥éª¤æ¥åŠ å¼ºå¤æ‚ä»»åŠ¡çš„æ±‚è§£ï¼Œä»è€Œè·å¾—æ›´å¯é çš„ç­”æ¡ˆ</li><li><img src="https://s2.loli.net/2025/03/12/ZIivOFJsp6HAzYL.png" title="fig:" alt="image-20250312211052574" /></li></ul></li></ul></li></ul><hr /><ul><li>æ¶Œç°èƒ½åŠ›ä¸æ‰©å±•å®šå¾‹çš„å…³ç³»<ul><li>æ¶Œç°èƒ½åŠ›å’Œæ‰©å±•å®šå¾‹æ˜¯ä¸¤ç§æè¿°è§„æ¨¡æ•ˆåº”çš„åº¦é‡æ–¹æ³•</li><li><img src="https://s2.loli.net/2025/03/12/rIGiwfZjsDmT4K1.png" title="fig:" alt="image-20250312211500851" /></li></ul></li></ul><h4 id="æ€»ç»“">æ€»ç»“</h4><ul><li>å¤§æ¨¡å‹æ ¸å¿ƒæŠ€æœ¯<ul><li>è§„æ¨¡æ‰©å±•ï¼šæ‰©å±•å®šå¾‹å¥ å®šäº†æ—©æœŸå¤§æ¨¡å‹çš„æŠ€æœ¯è·¯çº¿ï¼Œäº§ç”Ÿäº†å·¨å¤§çš„æ€§èƒ½æå‡</li><li>æ•°æ®å·¥ç¨‹ï¼šæ•°æ®æ•°é‡ã€æ•°æ®è´¨é‡ä»¥åŠé…åˆ¶æ–¹æ³•æå…¶å…³é”®</li><li>é«˜æ•ˆé¢„è®­ç»ƒï¼šéœ€è¦å»ºç«‹å¯é¢„æµ‹ã€å¯æ‰©å±•çš„å¤§è§„æ¨¡è®­ç»ƒæ¶æ„</li><li>èƒ½åŠ›æ¿€å‘ï¼šé¢„è®­ç»ƒåå¯ä»¥é€šè¿‡å¾®è°ƒã€å¯¹é½ã€æç¤ºå·¥ç¨‹ç­‰æŠ€æœ¯è¿›è¡Œèƒ½åŠ›æ¿€æ´»</li><li>äººç±»å¯¹é½ï¼šéœ€è¦è®¾è®¡å¯¹é½æŠ€æœ¯å‡å°‘æ¨¡å‹ä½¿ç”¨é£é™©ï¼Œå¹¶è¿›ä¸€æ­¥æå‡æ¨¡å‹æ€§èƒ½</li><li>å·¥å…·ä½¿ç”¨ï¼šä½¿ç”¨å¤–éƒ¨å·¥å…·åŠ å¼ºæ¨¡å‹çš„ä¼˜åŠ¿ï¼Œæ‹“å±•å…¶èƒ½åŠ›èŒƒå›´</li></ul></li></ul><h3 id="gptä¸deepseekæ¨¡å‹ä»‹ç»">2.1.3 GPTä¸DeepSeekæ¨¡å‹ä»‹ç»</h3><h4 id="gptç³»åˆ—æ¨¡å‹å¹¶éå¶ç„¶å‡ºç°">GPTç³»åˆ—æ¨¡å‹å¹¶éå¶ç„¶å‡ºç°</h4><ul><li>GPTç³»åˆ—æ¨¡å‹æˆä½“ç³»æ¨è¿›</li></ul><p><img src="https://s2.loli.net/2025/03/17/PJASs6mOhpIVg9f.png" alt="image-20250317221338373" style="zoom: 50%;" /></p><h4 id="gptç³»åˆ—æ¨¡å‹çš„æŠ€æœ¯æ¼”å˜">GPTç³»åˆ—æ¨¡å‹çš„æŠ€æœ¯æ¼”å˜</h4><ul><li><p>GPTç³»åˆ—æ¨¡å‹å‘å±•å†ç¨‹</p><blockquote><p>å°æ¨¡å‹ï¼šGPT-1ï¼ŒGPT-2</p><p>å¤§æ¨¡å‹ï¼šGPT-3ï¼ŒCodeXï¼ŒGPT-3.5ï¼ŒGPT-4</p><p>æ¨ç†å¤§æ¨¡å‹ï¼šo-series</p></blockquote></li></ul><figure><img src="https://s2.loli.net/2025/03/17/LRacptvoCbD6MuE.png" alt="image-20250317221704657" /><figcaption aria-hidden="true">image-20250317221704657</figcaption></figure><ul><li>GPT-1ï¼ˆ1.1äº¿å‚æ•°ï¼‰</li></ul><blockquote><p>çº¯ä»£ç Transformeræ¶æ„</p><p>é¢„è®­ç»ƒåé’ˆå¯¹ç‰¹å®šä»»åŠ¡å¾®è°ƒ</p></blockquote><figure><img src="https://s2.loli.net/2025/03/17/iCAZn64xmN9Tjf2.png" alt="image-20250317225508584" /><figcaption aria-hidden="true">image-20250317225508584</figcaption></figure><ul><li>GPT-2ï¼ˆ15äº¿å‚æ•°ï¼‰</li></ul><blockquote><p>å°†ä»»åŠ¡å½¢å¼ç»Ÿä¸€ä¸ºå•è¯é¢„æµ‹ï¼š<code>Pr(output|input, task)</code></p><p>é¢„è®­ç»ƒä¸ä¸‹æ¸¸ä»»åŠ¡ä¸€è‡´</p><p>ä½¿ç”¨æç¤ºè¿›è¡Œæ— ç›‘ç£ä»»åŠ¡æ±‚è§£</p><p>åˆæ­¥å°è¯•äº†è§„æ¨¡æ‰©å±•</p></blockquote><p><img src="https://s2.loli.net/2025/03/17/TNBAE73DKCSFxWX.png" alt="image-20250317225817141" style="zoom:50%;" /></p><ul><li>GPT-3</li></ul><blockquote><p>æ¨¡å‹è§„æ¨¡è¾¾åˆ°1750äº¿å‚æ•° æ¶Œç°å‡ºä¸Šä¸‹æ–‡å­¦ä¹ èƒ½åŠ›</p></blockquote><figure><img src="https://s2.loli.net/2025/03/17/IYl867iek2sZBoz.png" alt="image-20250317230019971" /><figcaption aria-hidden="true">image-20250317230019971</figcaption></figure><ul><li>CodeX</li></ul><blockquote><p>ä»£ç æ•°æ®è®­ç»ƒ æ¨ç†ä¸ä»£ç åˆæˆèƒ½åŠ›</p></blockquote><ul><li>WebGPT</li></ul><blockquote><p>å¤§è¯­è¨€æ¨¡å‹ä½¿ç”¨æµè§ˆå™¨</p></blockquote><ul><li>InstructGPT</li></ul><blockquote><p>å¤§è¯­è¨€æ¨¡å‹ä¸äººç±»ä»·å€¼è§‚å¯¹é½ æå‡ºRLHFç®—æ³•</p></blockquote><figure><img src="https://s2.loli.net/2025/03/17/Gr9UugqC8X1M5ld.png" alt="image-20250317230232820" /><figcaption aria-hidden="true">image-20250317230232820</figcaption></figure><ul><li>ChatGPT</li></ul><blockquote><p>åŸºäº InstructGPTç›¸ä¼¼æŠ€æœ¯å¼€å‘ï¼Œé¢å‘å¯¹è¯è¿›è¡Œä¼˜åŒ–</p></blockquote><ul><li>GPT-4</li></ul><blockquote><p>æ¨ç†èƒ½åŠ›æ˜¾è‘—æå‡ï¼Œå»ºç«‹å¯é¢„æµ‹çš„è®­ç»ƒæ¡†æ¶</p><p>å¯æ”¯æŒå¤šæ¨¡æ€ä¿¡æ¯çš„å¤§è¯­è¨€æ¨¡å‹</p></blockquote><ul><li>GPT-4o</li></ul><blockquote><p>åŸç”Ÿå¤šæ¨¡æ€æ¨¡å‹ï¼Œç»¼åˆæ¨¡æ€èƒ½åŠ›æ˜¾è‘—æå‡</p><p>æ”¯æŒç»Ÿä¸€å¤„ç†å’Œè¾“å‡ºæ–‡æœ¬ã€éŸ³é¢‘ã€å›¾ç‰‡ã€è§†é¢‘ä¿¡æ¯</p></blockquote><figure><img src="https://s2.loli.net/2025/03/17/wX46PuzsDHLaip5.png" alt="image-20250317230416878" /><figcaption aria-hidden="true">image-20250317230416878</figcaption></figure><ul><li>oç³»åˆ—æ¨¡å‹ï¼ˆåº”è¯¥æ˜¯æŒ‡GPT-4oï¼‰</li></ul><blockquote><p>æ¨ç†ä»»åŠ¡ä¸Šèƒ½åŠ›å¤§å¹…æå‡</p><p>é•¿æ€ç»´é“¾æ¨ç†èƒ½åŠ›</p></blockquote><ul><li>o-seriesï¼ˆåº”è¯¥æ˜¯æŒ‡GPT-o1/GPT-o3ï¼‰</li></ul><blockquote><p>ç±»ä¼¼äººç±»çš„â€œæ…¢æ€è€ƒâ€è¿‡ç¨‹</p></blockquote><figure><img src="https://s2.loli.net/2025/03/17/iJLpdKaj4S2negN.png" alt="image-20250317230602781" /><figcaption aria-hidden="true">image-20250317230602781</figcaption></figure><h4 id="deepseekç³»åˆ—æ¨¡å‹æŠ€æœ¯æ¼”å˜">DeepSeekç³»åˆ—æ¨¡å‹æŠ€æœ¯æ¼”å˜</h4><ul><li>DeepSeekç³»åˆ—æ¨¡å‹å‘å±•å†ç¨‹</li></ul><blockquote><p>è®­ç»ƒæ¡†æ¶ï¼šHAI-LLM è¯­è¨€å¤§æ¨¡å‹ï¼šDeepSeekLLM/V2/V3ã€Coder/Coder-V2ã€Math å¤šæ¨¡æ€å¤§æ¨¡å‹ï¼šDeepSeek-VI æ¨ç†å¤§æ¨¡å‹ï¼šDeepSeek-R1</p></blockquote><figure><img src="https://s2.loli.net/2025/03/17/WHny4riedRTO8GY.png" alt="image-20250317230747411" /><figcaption aria-hidden="true">image-20250317230747411</figcaption></figure><ul><li><p>DeepSeekå®ç°äº†è¾ƒå¥½çš„è®­ç»ƒæ¡†æ¶ä¸æ•°æ®å‡†å¤‡</p><ul><li>è®­ç»ƒæ¡†æ¶HAI-LLM(å‘å¸ƒäº2023å¹´6æœˆ)</li></ul><blockquote><p>å¤§è§„æ¨¡æ·±åº¦å­¦ä¹ è®­ç»ƒæ¡†æ¶ï¼Œæ”¯æŒå¤šç§å¹¶è¡Œç­–ç•¥</p><p>ä¸‰ä»£ä¸»åŠ›æ¨¡å‹å‡åŸºäºè¯¥æ¡†æ¶è®­ç»ƒå®Œæˆ</p></blockquote><ul><li>æ•°æ®é‡‡é›†</li></ul><blockquote><p>V1å’ŒMathçš„æŠ¥å‘Šè¡¨æ˜æ¸…æ´—äº†å¤§è§„æ¨¡çš„CommonCrawlï¼Œå…·å¤‡è¶…å¤§è§„æ¨¡æ•°æ®å¤„ç†èƒ½åŠ›</p><p>Coderçš„æŠ€æœ¯æŠ¥å‘Šè¡¨æ˜æ”¶é›†äº†å¤§é‡çš„ä»£ç æ•°æ®</p><p>Mathçš„æŠ€æœ¯æŠ¥å‘Šè¡¨æ˜æ¸…æ´—æ”¶é›†äº†å¤§é‡çš„æ•°å­¦æ•°æ®</p><p>VLçš„æŠ€æœ¯æŠ¥å‘Šè¡¨æ˜æ¸…æ´—æ”¶é›†äº†å¤§é‡å¤šæ¨¡æ€ã€å›¾ç‰‡æ•°æ®</p></blockquote></li><li><p>DeepSeekè¿›è¡Œäº†é‡è¦çš„ç½‘ç»œæ¶æ„ã€è®­ç»ƒç®—æ³•ã€æ€§èƒ½ä¼˜åŒ–æ¢ç´¢</p></li></ul><blockquote><p>V1æ¢ç´¢äº†scaling lawåˆ†æ(è€ƒè™‘äº†æ•°æ®è´¨é‡å½±å“)ï¼Œç”¨äºé¢„ä¼°è¶…å‚æ•°æ€§èƒ½</p><p>V2æå‡ºäº†MLAé«˜æ•ˆæ³¨æ„åŠ›æœºåˆ¶ï¼Œæå‡æ¨ç†æ€§èƒ½</p><p>V2ã€V3éƒ½é’ˆå¯¹MoEæ¶æ„æå‡ºäº†ç›¸å…³ç¨³å®šæ€§è®­ç»ƒç­–ç•¥</p><p>V3ä½¿ç”¨äº†MTP(å¤štokené¢„æµ‹)è®­ç»ƒ</p><p>Math æå‡ºäº†PPOçš„æ”¹è¿›ç®—æ³•GRPO</p><p>V3è¯¦ç»†ä»‹ç»Infrastructureçš„æ­å»ºæ–¹æ³•ï¼Œå¹¶æå‡ºäº†é«˜æ•ˆFP8è®­ç»ƒæ–¹æ³•</p></blockquote><ul><li>DeepSeek-V3</li></ul><blockquote><p>671Bå‚æ•°(37Bæ¿€æ´»)ï¼Œ14.8Tè®­ç»ƒæ•°æ®</p><p>åŸºäºV2çš„MoEæ¶æ„ï¼Œå¼•å…¥äº†MTPå’Œæ–°çš„å¤æ‚å‡è¡¡æŸå¤±</p><p>å¯¹äºè®­ç»ƒæ•ˆç‡è¿›è¡Œäº†æè‡´ä¼˜åŒ–ï¼Œå…±ä½¿ç”¨2.788MH800GPUæ—¶</p></blockquote><ul><li>DeepSeek-R1</li></ul><figure><img src="https://s2.loli.net/2025/03/17/zBbRT96l5ODKCsw.png" alt="image-20250317231150805" /><figcaption aria-hidden="true">image-20250317231150805</figcaption></figure><ul><li>DeepSeek-V3å’ŒDeepSeek-R1å‡è¾¾åˆ°äº†åŒæœŸé—­æºæ¨¡å‹çš„æœ€å¥½æ•ˆæœ</li></ul><blockquote><p>å¼€æºæ¨¡å‹å®ç°äº†é‡è¦çªç ´</p></blockquote><ul><li>ä¸ºä»€ä¹ˆ DeepSeekä¼šå¼•èµ·ä¸–ç•Œå…³æ³¨</li></ul><blockquote><p>æ‰“ç ´äº†OpenAIé—­æºäº§å“çš„é¢†å…ˆæ—¶æ•ˆæ€§ï¼ˆå›½å†…è¿½èµ¶GPT-4çš„æ—¶é—´å¾ˆé•¿ï¼Œç„¶è€Œå¤ç°o1æ¨¡å‹çš„æ—¶é—´å¤§å¤§ç¼©çŸ­ï¼‰</p><p>è¾¾åˆ°äº†ä¸OpenAIç°æœ‰APIæ€§èƒ½å¯æ¯”çš„æ°´å¹³</p></blockquote><ul><li>ä¸ºä»€ä¹ˆ DeepSeek ä¼šå¼•èµ·ä¸–ç•Œå…³æ³¨</li></ul><blockquote><p>ä¸­å›½å…·å¤‡å®ç°ä¸–ç•Œæœ€å‰æ²¿å¤§æ¨¡å‹çš„æ ¸å¿ƒæŠ€æœ¯</p><p>æ¨¡å‹å¼€æºã€æŠ€æœ¯å¼€æ”¾</p></blockquote><h2 id="ç¬¬äºŒè¯¾-æ¨¡å‹æ„æ¶">2.2 ç¬¬äºŒè¯¾ æ¨¡å‹æ„æ¶</h2><p>PPTçœ‹äº†ä¸€éï¼Œä½†çœ‹å¾—æœ‰ç‚¹äº‘é‡Œé›¾é‡Œï¼Œæš‚æ—¶ä¹Ÿæ²¡æœ‰æˆªå›¾æˆ–åšPPTç›¸å…³çš„ç¬”è®°äº†ã€‚ åªèƒ½åˆå†å»çœ‹ä¹¦ä¸­ç›¸å…³ç« èŠ‚ï¼Œé˜…è¯»è¿‡ç¨‹ä¸­çœ‹åˆ°ä¸€äº›æ¦‚å¿µï¼Œå¿˜è®°äº†æˆ–ä¸çŸ¥é“ï¼Œå¤ä¹ æˆ–å­¦ä¹ è®°å½•åœ¨æ­¤ã€‚</p><hr /><h3 id="transformeræ¨¡å‹ä»‹ç»">Transformeræ¨¡å‹(ä»‹ç»)</h3><p>ä»¥ä¸‹ä¸»è¦å­¦ä¹ Transformeræ¨¡å‹çš„æ„æ¶ã€‚</p><p>å·²æœ‰çš„å¤§è¯­è¨€æ¨¡å‹ä¸»è¦æ˜¯åŸºäºTransformeræ¨¡å‹è¿›è¡Œè®¾è®¡ä¸å¼€å‘çš„ã€‚</p><p>Transformeræ˜¯ç”±å«æœ‰å¤šå¤´æ³¨æ„åŠ›å’Œå‰é¦ˆç½‘ç»œçš„å­æ¨¡å—å †å è€Œæˆçš„ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚å…¶ä¸»è¦åŒ…å«è¾“å…¥ç¼–ç å±‚ã€å¤šå¤´æ³¨æ„åŠ›å±‚å’Œå‰é¦ˆç½‘ç»œå±‚ã€‚</p><figure><img src="https://s2.loli.net/2025/03/23/SjeqPf6HpwsX4lz.png" alt="image-20250323121544540" /><figcaption aria-hidden="true">image-20250323121544540</figcaption></figure><h4 id="è¾“å…¥ç¼–ç å±‚">è¾“å…¥ç¼–ç å±‚</h4><p>åœ¨Transformeræ¨¡å‹ä¸­ï¼Œè¾“å…¥çš„è¯å…ƒåºåˆ— <span class="math display">\[ğ’– = [ğ‘¢_1, ğ‘¢_2, . . . , ğ‘¢_ğ‘‡]\]</span> ï¼ˆè¯å…ƒï¼ˆè¯å…ƒä¸è¯å‘é‡çš„æ¦‚å¿µï¼Œå‚è€ƒ <a href="https://jiangsanyin.github.io/2025/03/22/Transformer%E6%9E%84%E6%9E%B6%E4%B8%AD%E4%B8%93%E4%B8%9A%E5%90%8D%E8%AF%8D/">Transformeræ„æ¶ä¸­ä¸“ä¸šåè¯</a> ï¼‰åºåˆ—ï¼Œå³ç”±å¤šä¸ªè¯å…ƒç»„æˆçš„åºåˆ—ã€‚ï¼‰ç»è¿‡ä¸€ä¸ªè¾“å…¥åµŒå…¥æ¨¡å—ï¼ˆinput embedding moduleï¼‰è½¬åŒ–ä¸ºå‘é‡åºåˆ—ã€‚ä¸ºäº†å»ºæ¨¡è¯æ±‡æœ¬èº«çš„è¯­ä¹‰ä¿¡æ¯ï¼Œæ¯ä¸ªè¯å…ƒåœ¨è¾“å…¥åµŒå…¥æ¨¡å—ä¸­è¢«æ˜ å°„ä¸ºä¸€ä¸ªå¯ç”¨äºè®¡ç®—ä¸å­¦ä¹ çš„è¯å‘é‡v<sub>t</sub>ã€‚å¦å¤–ï¼Œä¸ºäº†è¡¨ç¤ºå»ºæ¨¡åºåˆ—ä¸­å…ƒç´ çš„ä½ç½®ä¿¡æ¯ï¼ŒTransformerå¼•å…¥äº†ä½ç½®ç¼–ç ï¼ˆposition emdeddingï¼ŒPE)ã€‚ç»™å®šä¸€ä¸ªè¯å…ƒu<sub>t</sub>ï¼Œä½ç½®ç¼–ç æ ¹æ®å…¶åœ¨è¾“å…¥ä¸­çš„ç»å¯¹ä½ç½®åˆ†é…ä¸€ä¸ªå¯¹åº”çš„ä½ç½®å‘é‡p<sub>t</sub>ï¼Œå°†è¯å‘é‡ä¸å¯¹åº”çš„ä½ç½®å‘é‡ç›´æ¥ç›¸åŠ ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªè¾“å…¥åµŒå…¥è¡¨ç¤ºåºåˆ—ï¼š <span class="math display">\[ğ‘¿ = [ğ’™_1, . . . , ğ’™_ğ‘‡]ï¼Œå…¶ä¸­ ğ’™_ğ‘¡ = ğ’—_ğ‘¡ + ğ’‘_ğ‘¡\]</span> è¿™æ ·ï¼Œå°±å°†ä¸€ä¸ªè‡ªç„¶è¯­è¨€è¾“å…¥åºåˆ—ï¼ˆå¦‚â€œI love NLP.â€ï¼‰ç¤ºæˆä¸€ä¸ªè¾“å…¥åµŒå…¥è¡¨ç¤ºåºåˆ—<strong><img src="https://s2.loli.net/2025/03/23/oCw9SGvu31LZ5Dr.png" alt="image-20250323124415128" /></strong>ã€‚</p><p>Transformeræ¡†æ¶å¯ä»¥ä½¿ç”¨ä½ç½®ç¼–ç p<sub>t</sub>å»ºæ¨¡ä¸åŒè¯å…ƒçš„ä½ç½® ä¿¡æ¯ã€‚å› ä¸ºè¿™ç§ä½ç½®ç¼–ç ä»…ç”±è¯å…ƒå¯¹åº”çš„ä½ç½®å†³å®šï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸ºç»å¯¹ä½ç½®ç¼–ç ï¼Œç»å¯¹ä½ç½®ç¼–ç æ–¹æ³•é™åˆ¶äº†Transformeræ¨¡å‹å¤„ç†å…¶é•¿æ–‡æœ¬çš„èƒ½åŠ›ã€‚</p><h4 id="å¤šå¤´æ³¨æ„åŠ›å±‚">å¤šå¤´æ³¨æ„åŠ›å±‚</h4><p>å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶æ˜¯Transformeræ¨¡å‹çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œèƒ½å¤Ÿç›´æ¥å»ºæ¨¡ä»»æ„è·ç¦»ä¹‹é—´çš„äº¤äº’å…³ç³»ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒCNNæ˜¯è¿­ä»£åœ°åˆ©ç”¨å‰ä¸€ä¸ªæ—¶åˆ»çš„çŠ¶æ€æ›´æ–°å½“å‰æ—¶åˆ»çš„çŠ¶æ€ï¼Œæ‰€ä»¥åœ¨å¤„ç†é•¿åºåˆ—æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°æ¢¯åº¦çˆ†ç‚¸æˆ–æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜ï¼›è€ŒRNNä¸­ï¼Œåªæœ‰ä½äºåŒä¸€ä¸ªå·ç§¯æ ¸å†…çš„è¯å…ƒå¯ä»¥ç›´æ¥è¿›è¡Œäº¤äº’ï¼Œéœ€è¦é€šè¿‡å †å å·ç§¯å±‚æ¥å®ç°è¿œè·ç¦»çš„ä¿¡æ¯äº¤æ¢ã€‚</p><p>ä¸€ä¸ªå¤šå¤´æ³¨æ„åŠ›é€šå¸¸ç”±å¤šä¸ªæ³¨æ„åŠ›æ¨¡å—ç»„æˆã€‚æ¯ä¸ªæ³¨æ„åŠ›æ¨¡å—ä¸­ï¼Œä¼šå°†è¾“å…¥çš„åµŒå…¥åºåˆ—æ˜ å°„æˆä¸ºç›¸åº”çš„æŸ¥è¯¢ï¼ˆqueryï¼ŒQï¼‰ã€é”®ï¼ˆkeyï¼ŒKï¼‰ã€å€¼ï¼ˆvalueï¼ŒVï¼‰ä¸‰ä¸ªçŸ©é˜µã€‚ä¹‹åæ¯ä¸ªæŸ¥è¯¢ä¸æ‰€æœ‰é”®è¿›è¡Œç‚¹ç§¯è¿ç®—ï¼Œå¹¶ä½¿ç”¨softmaxå‡½æ•°è®¡ç®—æ³¨æ„åŠ›åˆ†æ•°ã€‚ å†ç„¶åï¼Œè¿™äº›åˆ†æ•°å°†ç”¨äºè®¡ç®—å€¼å‘é‡çš„åŠ æƒçº¿æ€§ç»„åˆï¼Œä»¥å¾—åˆ°æœ€ç»ˆè¾“å‡ºã€‚å…¶ä¸€è‡´è¿‡ç¨‹å¦‚ä¸‹ï¼š <span class="math display">\[\begin{aligned}Q = XW^Q\qquad\qquad\qquad(5.2)\\K = XW^K\qquad\qquad\qquad(5.3)\\V = XW^V\quad\quad\quad\quad\quad\quad(5.4)\\attention(\mathbf{Q,K,V}) = softmax(\frac{QK^T}{\sqrt{D}})V\quad\quad\quad\quad\quad\quad(5.5)\\å…¬å¼ï¼ˆ5.5ï¼‰ä¸­ï¼Œé€šè¿‡é™¤ä»¥\sqrt{D}è¿›è¡Œæ•°å€¼ç¼©æ”¾ï¼Œå…¶ä¸­Dæ˜¯é”®å¯¹åº”çš„å‘é‡ç»´åº¦ã€‚\end{aligned}\]</span> å¤šå¤´æ³¨æ„åŠ›å±‚ç”±å¤šä¸ªæ³¨æ„åŠ›æ¨¡å—ç»„æˆã€‚æ¯ä¸ªæ³¨æ„åŠ›æ¨¡å—éƒ½æœ‰ä¸åŒçš„æ˜ å°„å‚æ•°ï¼Œå³å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶å¼•å…¥ äº†Nç»„ç»“æ„ç›¸åŒä½†æ˜ å°„å‚æ•°ä¸åŒçš„æ³¨æ„åŠ›æ¨¡å—ï¼ˆæ³¨æ„åŠ›å¤´ï¼Œattention headï¼‰ã€‚åœ¨æ¯ä¸ªæ³¨æ„åŠ›å¤´ä¸­ï¼Œè¾“å…¥åºåˆ—è¢«æ˜ å°„ä¸ºä¸€ç»„æŸ¥è¯¢ã€é”®ã€å€¼ï¼Œé€šè¿‡ä½¿ç”¨ä¸Šè¿°å…¬å¼ç‹¬ç«‹è®¡ç®—å¹¶è¾“å‡ºã€‚ç„¶åä¸åŒçš„æ³¨æ„åŠ›å¤´çš„è¾“å‡ºè¢«æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªæƒé‡çŸ©é˜µW<sup>O</sup> æ˜ å°„ä¸ºæœ€ç»ˆè¾“å‡ºï¼š <span class="math display">\[\begin{aligned}MHA=Concat(head_1,head_2,...,head_N)W^O\quad\quad\quad\quad\quad\quad(5.6)\\head_n=Attention(\mathbf{Q,K,V})=Attention(XW^Q_n,XW^K_n,XW^V_n)\quad\quad\quad\quad\quad\quad(5.7)\end{aligned}\]</span> æ³¨æ„åŠ›æœºåˆ¶èƒ½å¤Ÿç›´æ¥å»ºæ¨¡åºåˆ—ä¸­ä»»æ„ä¸¤ä¸ªä½ç½®ä¹‹é—´çš„å…³ç³»ï¼Œæ¯”ä¼ ç»Ÿç¥ç»ç½‘ç»œå…·æœ‰æ›´å¼ºçš„é•¿åºåˆ—å»ºæ¨¡èƒ½åŠ›ã€‚æ­¤å¤–ï¼Œ å› ä¸ºæ³¨æ„åŠ›çš„è®¡ç®—è¿‡ç¨‹ä¸­æ˜¯çŸ©é˜µçš„ç›¸å…³è¿ç®—ï¼Œå¯¹ç¡¬ä»¶çš„å¹¶è¡Œè®¡ç®—å…·æœ‰è¾ƒå¥½çš„é€‚é…æ€§ï¼Œæ¯”å¦‚NVIDIA GPUè¿™ç±»åŠ é€Ÿå¡è®¾å¤‡å°±èƒ½é«˜æ•ˆåœ°æ”¯æŒå¤§è§„æ¨¡Transformeræ¨¡å‹çš„å‚æ•°ä¼˜åŒ–ã€‚</p><hr /><figure><img src="https://s2.loli.net/2025/03/20/LVtlwJcjiYOnryF.png" alt="image-20250320231453980" /><figcaption aria-hidden="true">image-20250320231453980</figcaption></figure><hr /><p><strong>ç‚¹ç§¯ï¼š</strong> <span class="math display">\[\begin{aligned}å¯¹äºå‘é‡&amp;aä¸å‘é‡bï¼ˆè¦æ±‚ä¸¤å‘é‡çš„ç»´åº¦ä¸€æ ·ï¼‰ï¼š\\&amp;a=[a_1,a_2,...,a_n]\quad\quad b=[b_1,b_2,...b_n]\\&amp;aå’Œbçš„ç‚¹ç§¯å…¬å¼ä¸ºï¼šaâ€¢b=a_1b_1+a_2b_2+...+a_nb_n\end{aligned}\]</span></p><hr /><p>softmaxå‡½æ•°ï¼šhttps://zhuanlan.zhihu.com/p/105722023ã€https://zh.wikipedia.org/zh-cn/Softmax%E5%87%BD%E6%95%B0</p><p>è¯¥å‡½æ•°çš„å½¢å¼é€šå¸¸æŒ‰ä¸‹é¢çš„å¼å­ç»™å‡ºï¼š <span class="math display">\[{\displaystyle \sigma (\mathbf {z} )_{j}={\frac {e^{z_{j}}}{\sum _{k=1}^{K}e^{z_{k}}}}}    for j = 1, â€¦, K.\]</span></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#ä¸‹é¢æ˜¯ä½¿ç”¨Pythonè¿›è¡Œå‡½æ•°è®¡ç®—çš„ç¤ºä¾‹ä»£ç ï¼š</span><br><span class="hljs-keyword">import</span> math<br>z = [<span class="hljs-number">1.0</span>, <span class="hljs-number">2.0</span>, <span class="hljs-number">3.0</span>, <span class="hljs-number">4.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">2.0</span>, <span class="hljs-number">3.0</span>]<br>z_exp = [math.exp(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> z]  <br><span class="hljs-built_in">print</span>(z_exp)  <span class="hljs-comment"># Result: [2.72, 7.39, 20.09, 54.6, 2.72, 7.39, 20.09] </span><br>sum_z_exp = <span class="hljs-built_in">sum</span>(z_exp)  <br><span class="hljs-built_in">print</span>(sum_z_exp)  <span class="hljs-comment"># Result: 114.98 </span><br>softmax = [<span class="hljs-built_in">round</span>(i / sum_z_exp, <span class="hljs-number">3</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> z_exp]<br><span class="hljs-built_in">print</span>(softmax)  <span class="hljs-comment"># Result: [0.024, 0.064, 0.175, 0.475, 0.024, 0.064, 0.175]</span><br><br><span class="hljs-comment">#Pythonä½¿ç”¨numpyè®¡ç®—çš„ç¤ºä¾‹ä»£ç :</span><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br>z = np.array([<span class="hljs-number">1.0</span>, <span class="hljs-number">2.0</span>, <span class="hljs-number">3.0</span>, <span class="hljs-number">4.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">2.0</span>, <span class="hljs-number">3.0</span>])<br><span class="hljs-built_in">print</span>(np.exp(z)/<span class="hljs-built_in">sum</span>(np.exp(z)))<br></code></pre></td></tr></table></figure><h4 id="å‰é¦ˆç½‘ç»œå±‚">å‰é¦ˆç½‘ç»œå±‚</h4><p>ä¸ºäº†å­¦ä¹ å¤æ‚çš„å‡½æ•°æ˜ å°„å…³ç³»ï¼ŒTransformerå¼•å…¥äº†å‰é¦ˆç½‘ç»œå±‚ï¼ˆfeed forward networkï¼ŒFFNï¼‰ï¼Œå¯¹åµŒå…¥åºåˆ—ï¼ˆå°±æ˜¯è¾“å…¥ç¼–ç å±‚å¾—åˆ°çš„åµŒå…¥è¡¨ç¤ºåºåˆ—ï¼‰è¿›è¡Œéçº¿æ€§å˜æ¢ã€‚è¯¦ç»†åœ°è¯´ï¼Œç»™å®šè¾“å…¥<strong>X</strong>ï¼ŒTransformeræ¨¡å‹ä¸­çš„å‰é¦ˆç¥ç»å±‚ç”±ä¸¤ä¸ªçº¿æ€§å˜æ¢å’Œä¸€ä¸ªéçº¿æ€§å˜æ¢å‡½æ•° ç»„æˆï¼š <span class="math display">\[\begin{aligned}FFN(\mathbf{X})=Ïƒ(\mathbf{XW^U} + \mathbf{b_1})\mathbf{W^D} + \mathbf{b_2}\qquad\qquad\qquad(5.8)\\å…¶ä¸­W^UâˆˆR^{HÃ—H^â€²} å’Œ W^DâˆˆR^{H^â€²Ã—H} åˆ†åˆ«æ˜¯ç¬¬ä¸€å±‚å’Œç¬¬äºŒå±‚çš„çº¿æ€§å˜æ¢æƒé‡çŸ©é˜µï¼Œb_1âˆˆR^{H^â€²}å’Œb_2âˆˆR^{H} æ˜¯åç½®é¡¹ï¼ŒÏƒæ˜¯æ¿€æ´»å‡½æ•°\end{aligned}\]</span> åœ¨åŸå§‹çš„Transformeræ¨¡å‹ä¸­ï¼Œé‡‡ç”¨äº†ReLUä½œä¸ºæ¿€æ´»å‡½æ•°ã€‚å‰é¦ˆç½‘ç»œå±‚é€šè¿‡æ¿€æ´»å‡½æ•°å¼•å…¥äº†éçº¿æ€§å˜æ¢ï¼Œæå‡äº†æ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ï¼Œä»è€Œèƒ½å¤Ÿæ›´å¥½åœ°å»ºæ¨¡å¤æ‚çš„äº¤äº’å…³ç³»ã€‚</p><hr /><p><strong>ä¸ºä»€ä¹ˆé€šè¿‡å¼•å…¥éçº¿æ€§å˜æ¢ï¼Œèƒ½å¤Ÿæ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ï¼Ÿ</strong></p><hr /><p><strong>çº¿æ€§å˜æ¢ä¸éçº¿æ€§å˜æ¢ï¼š</strong></p><p>å¯å‚è€ƒï¼šhttps://blog.csdn.net/qq_35468747/article/details/122005322ã€https://www.zhihu.com/question/298320067 <span class="math display">\[\begin{aligned}å¦‚æœä¸€ä¸ªå˜æ¢æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼Œåˆ™ä¸ºçº¿æ€§å˜æ¢ï¼š\\Tæ˜¯æŸå‡½æ•°ï¼Œå®ƒä½¿å¾—æ˜ å°„V â†’ W æˆç«‹ï¼Œå¹¶ä¸”æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š\\T(x+y) =T(x)+T(y)\\T(ax) =aT(x)\\å…¶ä¸­x , y âˆˆ V ï¼Œa âˆˆ R\end{aligned}\]</span> è¯†åˆ«ç»™å®šå‡½æ•°f ( x ) f(x)f(x)æ˜¯å¦ä¸ºçº¿æ€§å˜æ¢éå¸¸ç®€å•ï¼Œåªéœ€è¦æŸ¥çœ‹f ( x )ä¸­çš„æ¯ä¸€é¡¹æ˜¯å¦éƒ½æ˜¯xä¸ä¸€ä¸ªæ•°çš„ä¹˜ç§¯ï¼Œå¦‚æœæ˜¯ï¼Œf åˆ™æ˜¯çº¿æ€§å˜æ¢ã€‚</p><p><strong>f</strong>(x,y,z)=(3xâˆ’y,3z,0,zâˆ’2x) æ­¤å‡½æ•°æ˜¯ä¸€ä¸ªçº¿æ€§å˜æ¢ï¼ˆå¯ä»¥å†™æˆçŸ©é˜µç›¸ä¹˜çš„å½¢å¼è¿›è¡ŒæŸ¥çœ‹ï¼‰</p><p><strong>g</strong>(x,y,z)=(3xâˆ’y,3z+2,0,zâˆ’2x) ï¼Œæ­¤å‡½æ•°åˆ™ä¸æ˜¯ä¸€ä¸ªçº¿æ€§å˜æ¢ã€‚å› ä¸ºåœ¨å‡½æ•°g ä¸­ï¼Œç¬¬äºŒä¸ªåˆ†é‡ä¸º3 z + 2ï¼Œ2 æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œå¹¶ä¸åŒ…å«è¾“å…¥å‘é‡( x , y , z )ä¸­çš„ä»»ä½•åˆ†é‡</p><ul><li><p>åœ¨å‡ ä½•ç›´è§‚ä¸Šï¼Œçº¿æ€§å˜æ¢æœ‰å¦‚ä¸‹æ€§è´¨ï¼š</p><ul><li><p>å˜æ¢å‰æ˜¯ç›´çº¿ï¼Œå˜æ¢åä»æ˜¯ç›´çº¿</p></li><li><p>åŸç‚¹ä¿æŒå›ºå®šä¸åŠ¨</p></li></ul></li></ul><h4 id="ç¼–ç å™¨">ç¼–ç å™¨</h4><p>Transformeræ¨¡å‹ä¸­ï¼Œç¼–ç å™¨çš„å¤§è‡´æ„æ¶å¦‚ä¸‹å›¾å·¦ä¾§éƒ¨åˆ†æ‰€ç¤ºå†…å®¹ï¼š</p><figure><img src="https://s2.loli.net/2025/03/23/SjeqPf6HpwsX4lz.png" alt="image-20250323121544540" /><figcaption aria-hidden="true">image-20250323121544540</figcaption></figure><p>ç¼–ç å™¨çš„ä½œç”¨æ˜¯å°†æ¯ä¸ªè¾“å…¥è¯å…ƒéƒ½ç¼–ç æˆä¸€ä¸ªä¸Šä¸‹æ–‡è¯­ä¹‰ç›¸å…³çš„è¡¨ç¤ºå‘é‡ã€‚ç¼–ç å™¨ç»“æ„ç”±å¤šä¸ªç›¸åŒçš„å±‚å †å è€Œæˆï¼Œå…¶ä¸­æ¯ä¸€å±‚éƒ½åŒ…å«<strong>å¤šå¤´è‡ªæ³¨æ„åŠ›æ¨¡å—</strong>å’Œ<strong>å‰é¦ˆç½‘ç»œæ¨¡å—</strong>ã€‚åœ¨æ³¨æ„åŠ›å’Œå‰é¦ˆç½‘ç»œåï¼Œæ¨¡å‹ä½¿ç”¨<strong>å±‚å½’ä¸€åŒ–</strong>å’Œ<strong>æ®‹å·®è¿æ¥</strong>æ¥åŠ å¼ºæ¨¡å‹çš„è®­ç»ƒç¨³å®šåº¦ã€‚</p><p>å…¶ä¸­ï¼Œæ®‹å·®è¿æ¥å°†è¾“å…¥ä¸è¯¥å±‚çš„è¾“å‡ºï¼ˆæ¯”å¦‚å¯¹äºå¤šå¤´æ³¨æ„åŠ›å±‚è€Œè¨€ï¼Œè¿™æ˜¯å¤šå¤´æ³¨æ„åŠ›å±‚çš„è¾“å…¥ä¸è¾“å‡ºï¼‰ç›¸åŠ ï¼Œ<strong>å®ç°äº†ä¿¡æ¯åœ¨ä¸åŒå±‚çš„ç›´æ¥ä¼ é€’ï¼Œä»è€Œç¼“è§£æ¢¯åº¦çˆ†ç‚¸æˆ–æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜</strong>ã€‚</p><p>è€Œå±‚å½’ä¸€åŒ–ï¼Œåˆ™æ˜¯å¯¹æ¯ä¸ªæ¨¡å—çš„çš„è¾“å‡ºè¿›è¡Œé‡æ–°ç¼©æ”¾ï¼Œ<strong>æå‡æ¨¡å‹çš„è®­ç»ƒç¨³å®šæ€§</strong>ã€‚</p><p>ç¼–ç å™¨æ¥å—ç»è¿‡ä½ç½®ç¼–ç å±‚çš„è¯åµŒå…¥åºåˆ— ğ‘¿ ä½œä¸ºè¾“å…¥ï¼Œé€šè¿‡å¤šä¸ªå †å çš„ç¼–ç å™¨å±‚æ¥å»ºæ¨¡ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè¿›è€Œç”Ÿæˆæ•´ä¸ªè¾“å…¥åºåˆ—çš„ç¼–ç è¡¨ç¤ºã€‚</p><p>ç”±äºè¾“å…¥æ•°æ®æ˜¯å®Œå…¨å¯è§çš„ï¼Œç¼–ç å™¨ä¸­çš„æ³¨æ„åŠ›æ¨¡å—é€šå¸¸é‡‡ç”¨åŒå‘æ³¨æ„åŠ›ï¼Œæ¯ä¸ªä½ç½®çš„è¯å…ƒè¡¨ç¤ºèƒ½å¤Ÿæœ‰æ•ˆèåˆæ¥è‡ªä¸Šä¸‹æ–‡çš„è¯­ä¹‰ä¿¡æ¯ã€‚</p><p>åœ¨ç¼–ç å™¨-è§£ç å™¨æ„æ¶ä¸­ï¼Œç¼–ç å™¨çš„è¾“å‡ºå°†ä½œä¸ºè§£ç å™¨çš„è¾“å…¥ï¼Œè¿›è¡Œåç»­è®¡ç®—ã€‚ç”¨å…¬å¼è¡¨ç¤ºå¦‚ä¸‹ï¼Œç¬¬lï¼ˆæ˜¯Lçš„å°å†™ï¼‰å±‚ç¼–ç å™¨çš„æ•°æ®å¤„ç†è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š <span class="math display">\[\begin{aligned}&amp;ğ‘¿^â€²_ğ‘™ = LayerNorm(MHA(ğ‘¿_{ğ‘™âˆ’1}) + ğ‘¿_{ğ‘™âˆ’1}) \\&amp;ğ‘¿_ğ‘™ = LayerNorm(FFN(ğ‘¿^â€²_ğ‘™) + ğ‘¿^â€²_ğ‘™)\quad\quad\quad\quad\quad\quad(5.9) \\\end{aligned}\]</span></p><p><span class="math display">\[\begin{aligned}å…¶ä¸­ğ‘¿_{ğ‘™âˆ’1}å’Œğ‘¿_{ğ‘™}åˆ†åˆ«è¡¨ç¤ºè¯¥Transformerå±‚çš„è¾“å…¥ä¸è¾“å‡ºï¼Œ\\ğ‘¿^â€²_ğ‘™ æ˜¯ç»è¿‡å¤šå¤´æ³¨æ„åŠ›æ¨¡å—åçš„ä¸­é—´è¡¨ç¤ºï¼ŒLayerNormè¡¨ç¤ºå±‚å½’ä¸€åŒ–\end{aligned}\]</span></p><hr /><p>æ¶æ„å›¾è§£æï¼š</p><ul><li><strong>è¾“å…¥è¯åµŒå…¥</strong>ï¼šå°†è¾“å…¥æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡è¡¨ç¤ºã€‚</li><li><strong>ä½ç½®ç¼–ç </strong>ï¼šä¸ºæ¯ä¸ªè¾“å…¥æ·»åŠ ä½ç½®ä¿¡æ¯ï¼Œä»¥ä¾¿æ¨¡å‹èƒ½å¤ŸåŒºåˆ†ä¸åŒä½ç½®çš„è¯ã€‚</li><li><strong>å¤šå¤´æ³¨æ„åŠ›å±‚</strong>ï¼šç”¨äºæ•æ‰è¾“å…¥åºåˆ—ä¸­ä¸åŒä½ç½®ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</li><li><strong>å‰é¦ˆç½‘ç»œå±‚</strong>ï¼šç”¨äºå¯¹è¾“å…¥è¿›è¡Œéçº¿æ€§å˜æ¢ã€‚</li><li><strong>ç›¸åŠ å’Œå±‚å½’ä¸€åŒ–</strong>ï¼šç”¨äºç¨³å®šè®­ç»ƒè¿‡ç¨‹ã€‚</li><li><strong>è¾“å‡ºæ¦‚ç‡</strong>ï¼šæœ€ç»ˆè¾“å‡ºçš„æ¦‚ç‡åˆ†å¸ƒï¼Œç”¨äºé¢„æµ‹ä¸‹ä¸€ä¸ªè¯æˆ–åˆ†ç±»ä»»åŠ¡ã€‚</li></ul><h4 id="è§£ç å™¨">è§£ç å™¨</h4><p>Transformeræ¨¡å‹ä¸­ï¼Œè§£ç å™¨çš„å¤§è‡´æ„æ¶å¦‚ä¸‹å›¾å³ä¾§éƒ¨åˆ†æ‰€ç¤ºå†…å®¹ï¼š</p><figure><img src="https://s2.loli.net/2025/03/23/SjeqPf6HpwsX4lz.png" alt="image-20250323121544540" /><figcaption aria-hidden="true">image-20250323121544540</figcaption></figure><p>Transformer æ¶æ„ä¸­çš„è§£ç å™¨åŸºäºæ¥è‡ªç¼–ç å™¨ç¼–ç åçš„æœ€åä¸€å±‚çš„è¾“å‡ºè¡¨ç¤ºä»¥åŠå·²ç»ç”±æ¨¡å‹ç”Ÿæˆçš„è¯å…ƒåºåˆ—ï¼Œè¿›è¡Œåç»­å†…å®¹çš„ç”Ÿæˆã€‚ä¸ç¼–ç å™¨ç±»ä¼¼ï¼Œè§£ç å™¨ä¹Ÿæ˜¯ç”±å¤šä¸ªç›¸åŒçš„å±‚å †å è€Œæˆï¼Œæ¯ä¸ªå±‚éƒ½åŒ…å«ç›¸åŒç±»å‹çš„ç»„ä»¶ã€‚</p><p>ä¸ç¼–ç å™¨ä¸åŒçš„æ˜¯ï¼Œè§£ç å™¨éœ€è¦åœ¨è®¡ç®—æ³¨æ„åŠ›æ—¶å¼•å…¥æ©ç æ“ä½œï¼Œä»¥ä¿è¯ç”Ÿæˆç›®æ ‡åºåˆ—æ—¶ä¸ä¾èµ–äºæœªæ¥ä¿¡æ¯ï¼ˆé˜²æ­¢å½“å‰ä½ç½®çœ‹åˆ°æœªæ¥çš„è¾“å‡ºï¼‰ã€‚</p><p>è§£ç å™¨è¿˜å¼•å…¥äº†äº¤å‰æ³¨æ„åŠ›ï¼ˆcross attentionï¼‰æ¥å…³æ³¨ç¼–ç å™¨è¾“å‡ºçš„ä¸­é—´çŠ¶æ€<strong>X</strong><sub>L</sub> ï¼ˆç”¨äºæ•æ‰è§£ç å™¨å’Œç¼–ç å™¨ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼‰ã€‚</p><p>ä¸ç¼–ç å™¨ç±»ä¼¼ï¼Œè§£ç å™¨çš„æ¯ä¸ªæ¨¡ä¹Ÿé‡‡ç”¨äº†å±‚å½’ä¸€åŒ–ä¸æ®‹å·®è¿æ¥ï¼ˆæ®‹å·®è¿æ¥æœ‰åŠ©äºæ¢¯åº¦ä¼ æ’­ï¼Œå±‚å½’ä¸€åŒ–åˆ™ç”¨äºç¨³å®šè®­ç»ƒè¿‡ç¨‹ï¼‰ã€‚</p><p>åœ¨ç»è¿‡è§£ç å™¨ä¹‹åï¼Œæ¨¡å‹ä¼šé€šè¿‡ä¸€ä¸ªå…¨è¿æ¥å±‚å°†è¾“å‡ºæ˜ å°„åˆ°å¤§å°ä¸º ğ‘‰ çš„ç›®æ ‡è¯æ±‡è¡¨çš„æ¦‚ç‡åˆ†å¸ƒï¼Œå¹¶åŸºäºç›¸åº”çš„è§£ç ç­–ç•¥ç”Ÿæˆé¢„æµ‹è¯å…ƒã€‚</p><p>è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œç¼–ç å™¨å¯ä»¥å¯¹è¾“å…¥ç›®æ ‡è¿›è¡Œå¹¶è¡Œè®­ç»ƒï¼›è€Œåœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­ï¼Œè§£ç å™¨éœ€è¦é€šè¿‡<strong>è‡ªå›å½’çš„æ–¹å¼</strong>é€æ­¥ç”Ÿæˆå®Œæ•´çš„ç›®æ ‡åºåˆ—ã€‚è§£ç å™¨çš„æ•°æ®å¤„ç†æµç¨‹å¦‚ä¸‹å…¬å¼æ‰€ç¤ºï¼š <span class="math display">\[\begin{aligned}&amp;ğ’€^â€²_ğ‘™ = LayerNorm(MaskedMHA(ğ’€_{ğ‘™âˆ’1}) + ğ’€_{ğ‘™âˆ’1}),\\&amp;ğ’€^{â€²â€²}_ğ‘™ = LayerNorm(CrossMHA(ğ’€^â€²_ğ‘™, ğ‘¿_ğ¿) + ğ’€^â€²_ğ‘™),\\&amp;ğ’€_ğ‘™ = LayerNorm(FFN(ğ’€^{â€²â€²}_ğ‘™) + ğ’€^{â€²â€²}_ğ‘™)\quad\quad\quad\quad\quad\quad(5.10)\end{aligned}\]</span></p><p><span class="math display">\[\begin{aligned}å…¶ä¸­ï¼Œğ’€_{ğ‘™âˆ’1} å’Œ ğ’€_{ğ‘™} åˆ†åˆ«æ˜¯è¯¥ Transformer å±‚çš„è¾“å…¥å’Œè¾“å‡ºï¼Œğ’€^â€²_ğ‘™ å’Œ ğ’€^{â€²â€²}_ğ‘™ æ˜¯è¯¥å±‚ä¸­è¾“å…¥\\ç»è¿‡æ©ç å¤šå¤´æ³¨æ„åŠ› MaskedMHA å’Œäº¤å‰å¤šå¤´æ³¨æ„åŠ› CrossMHA æ¨¡å—åçš„ä¸­é—´è¡¨ç¤º,\\LayerNorm è¡¨ç¤ºå±‚å½’ä¸€åŒ–ã€‚ç„¶åå°†æœ€åä¸€å±‚çš„è¾“å‡º ğ’€_ğ¿ æ˜ å°„åˆ°è¯è¡¨çš„ç»´åº¦ä¸Šï¼š\\ğ‘¶ = softmax(ğ’€_ğ¿ğ‘¾^ğ¿)\quad\quad\quad\quad\quad\quad(5.11)\\\\å…¶ä¸­ï¼Œğ‘¶âˆˆR^{TÃ—V}æ˜¯æ¨¡å‹çš„æœ€ç»ˆè¾“å‡ºï¼ˆVæ˜¯è¯æ±‡è¡¨å¤§å°ï¼‰ï¼Œä»£è¡¨ä¸‹ä¸€ä¸ªè¯å…ƒåœ¨è¯è¡¨ä¸Šçš„æ¦‚ç‡åˆ†å¸ƒï¼Œ\\W^LâˆˆR^{HÃ—V}æ˜¯å°†è¾“å‡ºæ˜ å°„åˆ°è¯è¡¨ç»´åº¦çš„å‚æ•°çŸ©é˜µï¼Œè€Œğ’€_ğ¿ğ‘¾^ğ¿æ˜¯softmaxå‡½æ•°çš„è¾“å…¥ï¼Œé€šå¸¸ç§°ä¸ºlogits\end{aligned}\]</span></p><h3 id="æ¨¡å‹è¯¦ç»†é…ç½®">(æ¨¡å‹)è¯¦ç»†é…ç½®</h3><p>Transformeræ¨¡å‹çš„å››ä¸ªæ ¸å¿ƒæ¨¡å—åŒ…æ‹¬ï¼šå½’ä¸€åŒ–ï¼ˆå½’ä¸€åŒ–æ–¹æ³•ä¸å½’ä¸€åŒ–é…ç½®ï¼‰ã€æ¿€æ´»å‡½æ•°ã€ä½ç½®ç¼–ç ã€æ³¨æ„åŠ›æœºåˆ¶ã€‚</p><h4 id="å½’ä¸€åŒ–æ–¹æ³•">å½’ä¸€åŒ–æ–¹æ³•</h4><p>ä¸ºäº†ç¼“è§£è®­ç»ƒæŸå¤±ä¸ç¨³å®šçš„é—®é¢˜ï¼Œå½’ä¸€åŒ–æ–¹æ³•è¢«æå‡ºã€‚åŸå§‹çš„Transformeræ¨¡å‹ä¸»è¦ä½¿ç”¨å±‚å½’ä¸€åŒ–æ–¹æ³•ï¼ˆlayer normolizationï¼ŒLNï¼‰ï¼Œåç»­å‡ºç°äº†å…¶ä»–ä¸€äº›æ”¹è¿›çš„å˜ç§å½’ä¸€åŒ–æ–¹æ³•ï¼Œå¦‚å‡æ–¹æ ¹å½’ä¸€åŒ–ï¼ˆroot mean square layer normolizationï¼ŒRMS-Normï¼‰å’ŒDeepNormã€‚</p><hr /><p>LayerNormï¼Œåœ¨æ—©æœŸï¼Œæ‰¹æ¬¡å½’ä¸€åŒ–ï¼ˆbatch normolizationï¼ŒBNï¼‰è¢«å¹¿æ³›ä½¿ç”¨ï¼Œä½†æ­¤å½’ä¸€åŒ–æ–¹æ³•ä¸èƒ½æœ‰æ•ˆ<strong>å¤„ç†å¯å˜é•¿åº¦çš„åºåˆ—æ•°æ®å’Œå°æ‰¹æ¬¡æ•°æ®</strong>ã€‚é’ˆå¯¹æ­¤é—®é¢˜ï¼Œå±‚å½’ä¸€åŒ–æŠ€æœ¯è¢«æå‡ºï¼Œå®ƒé’ˆå¯¹æ•°æ®è¿›è¡Œé€å±‚å½’ä¸€åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¼šè®¡ç®—æ¯ä¸€å±‚é‡æ¿€æ´»å€¼çš„å‡å€¼ Î¼ å’Œæ–¹å·® Ïƒ ï¼Œé‡æ–°è°ƒæ•´æ¿€æ´»å€¼çš„ä¸­å¿ƒï¼Œå¹¶é€šè¿‡å‚æ•° Î³ å’Œ Î² è¿›è¡Œç¼©æ”¾ï¼š <span class="math display">\[\begin{aligned}LayerNorm(x)=\frac{x-Î¼}{Ïƒ}Â·Î³ + Î²\quad\quad\quad\quad(5.12)\\Î¼=\frac{1}{H}{\sum _{i=1}^Hx_i },\quad\quadÏƒ=\sqrt{\frac{1}{H}{\sum _{i=1}^H(x_i-Î¼)^2 }}\quad\quad\quad\quad(5.13)\\\end{aligned}\]</span></p><hr /><p>RMS-Normã€‚ä¸ºäº†<strong>æå‡å½’ä¸€åŒ–çš„è®­ç»ƒé€Ÿåº¦</strong>ï¼ŒRMS-Normåªä½¿ç”¨æ¿€æ´»å€¼æ€»å’Œçš„å‡æ–¹æ ¹RMS(Â·)å¯¹æ¿€æ´»å€¼è¿›è¡Œç¼©æ”¾ã€‚ä½¿ç”¨RMS-Normçš„Transformeræ¨¡å‹ç›¸æ¯”ä½¿ç”¨LayerNormè®­ç»ƒçš„æ¨¡å‹åœ¨è®­ç»ƒé€Ÿåº¦ä¸æ€§èƒ½ä¸Šå‡å…·æœ‰ä¸€å®šä¼˜åŠ¿ã€‚æ¯”å¦‚ Gopherä¸Chinchillaæ¨¡å‹éƒ½é‡‡ç”¨äº†RMS-Normï¼Œå…¶è®¡ç®—åˆ†å·¥å¦‚ä¸‹ï¼š <span class="math display">\[\begin{aligned}RMSNorm(x)=\frac{x}{RMS(x)}Â·Î³ \quad\quad\quad\quad(5.14)\\RMS(x)=\sqrt{\frac{1}{H}{\sum _{i=1}^H(x_i)^2 }}\quad\quad\quad\quad(5.15)\\\end{aligned}\]</span></p><hr /><p>DeepNormã€‚ä¸ºäº†<strong>è¿›ä¸€æ­¥ç¨³å®šæ·±å±‚Transformerçš„è®­ç»ƒ</strong>ï¼ŒDeepNormåœ¨LayerNormçš„åŸºç¡€ä¸Šï¼Œåœ¨æ®‹å·®è¿æ¥ä¸­å¯¹ä¹‹å‰çš„æ¿€æ´»å€¼xæŒ‰ç…§ä¸€å®šæ¯”ä¾‹ Î± è¿›è¡Œç¼©æ”¾ï¼Œèƒ½æ›´æ–°åœ°æ”¯æŒå±‚æ•°æ‰©å±•ã€‚å…¶è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š <span class="math display">\[DeepNorm(x)=LayerNorm(Î±Â·x + Sublayer(x))\quad\quad\quad\quad(5.16)\\\]</span> å…¶ä¸­Sublayerè¡¨ç¤ºTransformerå±‚ä¸­çš„å‰é¦ˆç¥ç»ç½‘ç»œæˆ–æ³¨æ„åŠ›æ¨¡å—ã€‚æ¯”å¦‚GLM-130Bå°±é‡‡ç”¨äº†DeepNormä½œä¸ºå½’ä¸€åŒ–æŠ€æœ¯ã€‚</p><h4 id="å½’ä¸€åŒ–æ¨¡å—ä½ç½®">å½’ä¸€åŒ–æ¨¡å—ä½ç½®</h4><p>ä¸ä»…å½’ä¸€åŒ–æ–¹æ³•å¯¹è®­ç»ƒç¨³å®šæ€§æœ‰å½±å“ï¼Œå½’ä¸€åŒ–æ¨¡å—çš„ä½ç½®å¯¹äºè®­ç»ƒç¨³å®šæ€§ä¹Ÿå…·æœ‰é‡è¦å½±å“ã€‚</p><p>å½’ä¸€åŒ–æ¨¡å—çš„ä½ç½®é€šå¸¸æœ‰ä¸‰ç§é€‰æ‹©ï¼Œåˆ†åˆ«æ˜¯å±‚åå½’ä¸€åŒ–ï¼ˆpost-layer normolizationï¼ŒPost-Normï¼‰ã€å±‚å‰å½’ä¸€åŒ–ï¼ˆpre-layer normolizationï¼ŒPre-Normï¼‰å’Œå¤¹å¿ƒå½’ä¸€åŒ–ï¼ˆsandwich-layer normolizationï¼ŒSandwich-Normï¼‰ã€‚å®ƒä»¬ç›¸å¯¹äºæ³¨æ„åŠ›å±‚ä¸æ®‹å·®è¿æ¥å±‚çš„ä½ç½®åˆ†åˆ«å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure><img src="https://s2.loli.net/2025/04/08/bmvYqEWk39e2PSG.png" alt="image-20250408211348006" /><figcaption aria-hidden="true">image-20250408211348006</figcaption></figure><hr /><p>Post-Normã€‚åŸå§‹çš„Transformeræ¨¡å‹å°±æ˜¯ä½¿ç”¨Post-Normå½’ä¸€åŒ–æŠ€æœ¯ï¼Œå³å°†å½’ä¸€åŒ–æ¨¡å—æ”¾ç½®åœ¨æ®‹å·®è¿æ¥ä¹‹åï¼Œå…¬å¼è¡¨è¾¾å¦‚ä¸‹ï¼š <span class="math display">\[Postï¹£Norm(x)=Norm(x+Sublayer(x))\quad\quad\quad\quad(5.17)\\\]</span> å…¶ä¸­Normä»£è¡¨ä»»æ„ä¸€ç§å…·ä½“çš„å½’ä¸€åŒ–æ–¹æ³•ã€‚Post-Normå…·æœ‰è¯¸å¤šä¼˜åŠ¿ï¼šï¼ˆ1ï¼‰æœ‰åŠ©äºåŠ å¿«ç¥ç»ç½‘ç»œçš„æ”¶æ•›é€Ÿåº¦ï¼Œé˜²æ­¢æ¨¡å‹å‡ºç°æ¢¯åº¦çˆ†ç‚¸æˆ–æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜ï¼Œä»è€Œå‡å°‘è®­ç»ƒæ—¶é—´ã€‚ï¼ˆ2ï¼‰å¯ä»¥é™ä½ç¥ç»ç½‘ç»œå¯¹äºè¶…å‚æ•°ï¼ˆåˆå§‹åŒ–å‚æ•°ã€å­¦ä¹ ç‡ç­‰ï¼‰çš„æ•æ„Ÿæ€§ï¼Œä½¿å¾—ç¥ç»ç½‘ç»œæ›´å®¹æ˜“è¿›è¡Œè°ƒä¼˜ã€‚</p><p>ä½†æ˜¯ç”±äºè¾“å…¥å±‚é™„è¿‘çš„æ¢¯åº¦å¯èƒ½è¾ƒå¤§ï¼ŒPost-Normæœ‰æ—¶ä¼šå¼•å‘è®­ç»ƒä¸ç¨³å®šçš„ç°è±¡ ã€‚å› æ­¤ä¸€èˆ¬ä¸å•ç‹¬ä½¿ç”¨ï¼Œè€Œæ˜¯è·Ÿå…¶ä»–ç­–ç•¥ç»“åˆä½¿ç”¨ã€‚</p><hr /><p>Pre-Normã€‚æ­¤å½’ä¸€åŒ–æ–¹æ³•å°†å½’ä¸€åŒ–æ¨¡å—æ”¾ç½®åœ¨æ¯ä¸ªå­å±‚ä¹‹å‰ã€‚å…¬å¼è¡¨ç¤ºå¦‚ä¸‹ï¼š <span class="math display">\[Preï¹£Norm(x)=x+ Sublayer(Norm(x))\quad\quad\quad\quad(5.18)\\\]</span> åŒæ ·åœ°ï¼ŒNormä¹Ÿæ˜¯è¡¨ç¤ºä»»æ„ä¸€ç§å½’ä¸€åŒ–æ–¹æ³•ã€‚é€šè¿‡åœ¨æ¯ä¸ªå­å±‚ä¹‹å‰æ·»åŠ äº†ä¸€ä¸ªå½’ä¸€åŒ–æ¨¡å—ï¼Œé’ˆå¯¹æ¯ä¸ªæ¨¡å—çš„è¾“å…¥è¿›è¡Œå½’ä¸€åŒ–ï¼Œ<strong>å¯ä»¥ç¼“è§£æ¢¯åº¦çˆ†ç‚¸æˆ–æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜</strong>ã€‚ æ­¤å¤–ï¼ŒPre-Normåœ¨æœ€åä¸€ä¸ªTransformerå±‚ä¹‹åè¿˜é¢å¤–æ·»åŠ äº†ä¸€ä¸ªLayerNormã€‚</p><p>ç›¸å¯¹äºPost-Normæ¥è¯´ï¼ŒPre-Normè™½ç„¶åœ¨æ€§èƒ½ä¸Šç•¥æœ‰é€Šè‰²ï¼Œä½†<strong>å¢åŠ äº†è®­ç»ƒè¿‡ç¨‹ä¸­çš„ç¨³å®šæ€§</strong>ï¼Œå› ä¸ºå¾ˆå¤šä¸»æµçš„å¤§æ¨¡å‹éƒ½é‡‡ç”¨äº†Pre-Normã€‚</p><hr /><p>Sandwich-Normã€‚åœ¨Pre-Normçš„åŸºç¡€ä¸Šï¼ŒSandwich-Normåœ¨æ®‹å·®è¿æ¥ä¹‹å‰å¢åŠ äº†é¢å¤–çš„LayerNormï¼Œä¸»è¦è¿˜æ˜¯ä¸ºäº†é¿å…å±‚è¾“å‡ºæ•°å€¼çˆ†ç‚¸çš„æƒ…å†µã€‚å…¬å¼è¡¨ç¤ºå¦‚ä¸‹ï¼š <span class="math display">\[Sandwichï¹£Norm(x)=x+Norm(Sublayer(Norm(x)))\quad\quad\quad\quad(5.19)\\\]</span> åœ¨æŸç§ç¨‹åº¦ä¸Šï¼ŒSandwich-Normå¯ä»¥çœ‹ä½œæ˜¯Post-Normä¸Pre-Normä¸¤ç§æ–¹æ³•çš„ç»„åˆã€‚è™½ç„¶ä»ç†è®ºä¸Šåˆ†æå¥½åƒä¼šå¾—åˆ°ä¸¤ç§æ–¹æ³•çš„ä¼˜åŠ¿å³å–å¾—æ›´å¥½çš„å½’ä¸€åŒ–æ•ˆæœï¼Œä½†å®é™…æƒ…å†µè¡¨æ˜å®ƒæœ‰æ—¶ä»ç„¶æ— æ³•ä¿è¯LLMçš„è®­ç»ƒç¨³å®šæ€§ï¼Œç”šè‡³ä¼šå¼•å‘è®­ç»ƒå´©æºƒçš„é—®é¢˜ã€‚</p><h4 id="æ¿€æ´»å‡½æ•°">æ¿€æ´»å‡½æ•°</h4><h4 id="ä½ç½®ç¼–ç ">ä½ç½®ç¼–ç </h4><h4 id="æ³¨æ„åŠ›æœºåˆ¶">æ³¨æ„åŠ›æœºåˆ¶</h4><h4 id="æ··åˆä¸“å®¶æ¨¡å‹">æ··åˆä¸“å®¶æ¨¡å‹</h4><h4 id="llamaçš„è¯¦ç»†é…ç½®">LLaMAçš„è¯¦ç»†é…ç½®</h4>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤§è¯­è¨€æ¨¡å‹è¯¾ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ„å»ºé—®ç­”ç³»ç»Ÿä¹‹æ›´æ–°çŸ¥è¯†åº“ä¸å¾®è°ƒäºŒè€…æ¯”è¾ƒ</title>
    <link href="/2025/03/10/%E6%9E%84%E5%BB%BA%E9%97%AE%E7%AD%94%E7%B3%BB%E7%BB%9F%E4%B9%8B%E6%9B%B4%E6%96%B0%E7%9F%A5%E8%AF%86%E5%BA%93%E4%B8%8E%E5%BE%AE%E8%B0%83%E4%BA%8C%E8%80%85%E6%AF%94%E8%BE%83/"/>
    <url>/2025/03/10/%E6%9E%84%E5%BB%BA%E9%97%AE%E7%AD%94%E7%B3%BB%E7%BB%9F%E4%B9%8B%E6%9B%B4%E6%96%B0%E7%9F%A5%E8%AF%86%E5%BA%93%E4%B8%8E%E5%BE%AE%E8%B0%83%E4%BA%8C%E8%80%85%E6%AF%94%E8%BE%83/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€å‚è€ƒæ–‡ç« "><a href="#ä¸€ã€å‚è€ƒæ–‡ç« " class="headerlink" title="ä¸€ã€å‚è€ƒæ–‡ç« "></a>ä¸€ã€å‚è€ƒæ–‡ç« </h1><p>ï¼ˆ1ï¼‰<a href="https://www.53ai.com/news/qianyanjishu/201.html">RAG &amp; å¾®è°ƒï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿ</a></p><h1 id="äºŒã€ä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨RAGï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨å¾®è°ƒ"><a href="#äºŒã€ä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨RAGï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨å¾®è°ƒ" class="headerlink" title="äºŒã€ä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨RAGï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨å¾®è°ƒ"></a>äºŒã€ä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨RAGï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨å¾®è°ƒ</h1><table><thead><tr><th>è¦æ±‚&#x2F;ä½¿ç”¨å¯¹è±¡</th><th>RAG</th><th>å¾®è°ƒ</th></tr></thead><tbody><tr><td>ï¼ˆ1ï¼‰è¦æ„å»ºä¸€ä¸ªéœ€è¦è®¿é—®å¤–éƒ¨æ•°æ®æºçš„ LLM åº”ç”¨ç¨‹åº</td><td>Y</td><td></td></tr><tr><td>ï¼ˆ2ï¼‰åº”ç”¨ç¨‹åºéœ€è¦ä¸“é—¨çš„<strong>å†™ä½œä¸å›ç­”é£æ ¼ï¼ˆå¦‚å®¢æœï¼‰<strong>æˆ–</strong>ä¸ç‰¹å®šé¢†åŸŸçš„è¯­è¨€å’Œæƒ¯ä¾‹æ·±åº¦ä¸€è‡´</strong></td><td></td><td>Y</td></tr><tr><td>ï¼ˆ3ï¼‰æŠ‘åˆ¶å¹»è§‰</td><td>Y</td><td></td></tr><tr><td>ï¼ˆ4ï¼‰æ•°æ®é›†æœ‰é™æ—¶ï¼Œå¾®è°ƒæ•ˆæœæœ‰é™ï¼Œä½†RAGä»èƒ½ä¿æŒä¸€å®šçŸ¥æƒ…åº¦ä¸å‡†ç¡®åº¦</td><td>Y</td><td></td></tr><tr><td>ï¼ˆ5ï¼‰å¦‚æœæˆ‘ä»¬æ­£åœ¨åº”å¯¹å¿«é€Ÿå‘å±•çš„æ•°æ®ç¯å¢ƒï¼ŒRAG æä¾›çš„æ•æ·æ€§æ˜¯ä¼ ç»Ÿå¾®è°ƒéš¾ä»¥æ¯”æ‹Ÿçš„ã€‚</td><td>Y</td><td></td></tr><tr><td>ï¼ˆ6ï¼‰LLM åº”ç”¨ç¨‹åºéœ€è¦é€æ˜&#x2F;å¯è§£é‡Šï¼ŒRAG å¯ä»¥å¢å¼ºç”¨æˆ·å¯¹å…¶è¾“å‡ºçš„ä¿¡ä»»å’Œç†è§£ã€‚</td><td>Y</td><td></td></tr><tr><td>ï¼ˆ7ï¼‰å¿«é€Ÿé›†æˆé¢†åŸŸçŸ¥è¯†å¦‚æ³•å¾‹ã€æ•°å­¦ä¸ç‰¹å®šå…¬å¸äº§å“ç­‰ï¼Œæé«˜ä¸“ä¸šé—®ç­”èƒ½åŠ›ã€æˆä¸ºå½“å‰é¢†åŸŸå†…çš„ä¸“å®¶</td><td></td><td>Y</td></tr><tr><td>ï¼ˆ8ï¼‰å¯æ‰©å±•æ€§ï¼ˆä¸æ–­ç»™å¢åŠ æ•°æ®æºçŸ¥è¯†é‡ï¼‰</td><td>Y</td><td></td></tr><tr><td>ï¼ˆ9ï¼‰å»¶è¿Ÿå’Œå®æ—¶è¦æ±‚ï¼ˆRAG æ¶‰åŠåœ¨ç”Ÿæˆå“åº”ä¹‹å‰æ£€ç´¢æ•°æ®ï¼Œå¯èƒ½ä¼šå¼•å…¥æ›´å¤šå»¶è¿Ÿï¼‰</td><td></td><td>Y</td></tr><tr><td>ï¼ˆ10ï¼‰ç»´æŠ¤ä¸æ”¯æŒï¼ˆRAGéœ€è¦ç»´æŠ¤çŸ¥è¯†åº“ä¸æ£€ç´¢æœºåˆ¶ï¼Œè€Œå¾®è°ƒéœ€è¦åå¤çš„å†è®­ç»ƒæµç¨‹ï¼‰</td><td>Y</td><td></td></tr><tr><td>ï¼ˆ11ï¼‰æˆæœ¬ï¼ˆå¾®è°ƒéœ€è¦åå¤å¾®è°ƒåŠ¨ä½œï¼Œéœ€è¦æŒç»­æŠ•å…¥ï¼›RAGåˆ™ä¸»è¦åœ¨åˆæœŸéœ€è¦ä¸€å®šæˆæœ¬ï¼Œç”¨æ¥é›†æˆç›¸å…³åº”ç”¨ç­‰ï¼Œä½†è¿˜éœ€è¦è€ƒè™‘å®šæœŸç»´æŠ¤å¤–éƒ¨çŸ¥è¯†åº“ï¼Œæˆæœ¬ç›¸å¯¹è¾ƒä½ï¼‰</td><td>Y</td><td></td></tr><tr><td>ï¼ˆ12ï¼‰å¤æ‚åº¦</td><td>Y</td><td></td></tr></tbody></table><p>RAGè‹±æ–‡å…¨ç§°æ˜¯â€œRetrieval-Augmented Generationâ€ï¼Œä¸­æ–‡ç¿»è¯‘ä¸ºâ€œæ£€ç´¢å¢å¼ºç”Ÿæˆâ€ï¼Œå®ƒå°†æ£€ç´¢ï¼ˆæˆ–æœç´¢ï¼‰çš„èƒ½åŠ›é›†æˆåˆ° LLM çš„æ–‡æœ¬ç”Ÿæˆä¸­ã€‚å®ƒç»“åˆäº†ä¸€ä¸ªæ£€ç´¢ç³»ç»Ÿå’Œä¸€ä¸ª LLMï¼Œå‰è€…ä»å¤§å‹è¯­æ–™åº“ä¸­è·å–ä¸ç”¨æˆ·æŸ¥è¯¢æœ€ç›¸å…³çš„æ–‡æ¡£ï¼Œåè€…ä½¿ç”¨è¿™äº›è¢«æ£€ç´¢åˆ°çš„æ–‡æ¡£ä¸­çš„ä¿¡æ¯ç”Ÿæˆç­”æ¡ˆã€‚æœ¬è´¨ä¸Šï¼ŒRAG å¸®åŠ©æ¨¡å‹â€œæŸ¥æ‰¾â€å¤–éƒ¨ä¿¡æ¯ä»¥æ”¹è¿›å…¶å“åº”ã€‚</p><p>Model Fine-tuningï¼Œä¸­æ–‡ç¿»è¯‘ä¸ºâ€œæ¨¡å‹å¾®è°ƒâ€ï¼Œæ˜¯åœ¨è¾ƒå°çš„ç‰¹å®šæ•°æ®é›†ä¸Šè¿›ä¸€æ­¥è®­ç»ƒé¢„è®­ç»ƒè¿‡çš„ LLMï¼Œä»¥ä½¿å…¶é€‚åº”ç‰¹å®šä»»åŠ¡æˆ–æé«˜å…¶æ€§èƒ½ã€‚é€šè¿‡å¾®è°ƒï¼Œæˆ‘ä»¬æ ¹æ®æ•°æ®è°ƒæ•´æ¨¡å‹çš„æƒé‡ï¼Œä½¿å…¶æ›´é€‚åˆæˆ‘ä»¬åº”ç”¨ç¨‹åºçš„ç‹¬ç‰¹éœ€æ±‚ã€‚</p><p>é‚£ä¹ˆåˆ°åº•ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨RAGï¼Œä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨æ¨¡å‹å¾®è°ƒå‘¢ï¼Ÿä¸‹é¢ä»å¤šä¸ªè§’åº¦æ¥è¿›è¡Œåˆ†æè¯´æ˜ã€‚</p><hr><p>ï¼ˆ1ï¼‰<strong>æ˜¯å¦éœ€è¦è®¿é—®å¤–éƒ¨æ•°æ®æºï¼Ÿ</strong></p><p>LLMæœ¬èº«çš„çŸ¥è¯†å‚¨å¤‡æ˜¯æœ‰ä¸€ä¸ªè‡ªèº«ç¼ºé™·æˆ–é™åˆ¶çš„ï¼Œä¸»è¦æ¥è‡ªä¸¤ä¸ªæ–¹é¢ï¼šç¬¬ä¸€ï¼ŒLLMè¢«è®­ç»ƒæ—¶æ‰€ä½¿ç”¨çš„è®­ç»ƒæ•°æ®é›†æ˜¯æœ‰ä¸€ä¸ªæ”¶é›†æ—¶é—´ç•Œçº¿çš„ï¼Œåœ¨è¿™ä¸ªæ—¶é—´ç•Œçº¿ä¹‹åçš„äº§ç”Ÿçš„æ–°çŸ¥è¯†æ˜¯LLMæ— æ³•çŸ¥æ™“çš„ã€‚ç¬¬äºŒï¼Œæ”¶é›†è®­ç»ƒæ•°æ®é›†æ—¶æ— æ³•æ”¶é›†åˆ°é‚£ä¹ˆä¸å…¬å¼€çš„æ•°æ®ï¼Œè¿™æ ·çš„æ•°æ®ä¹Ÿæ˜¯LLMæ— æ³•çŸ¥æ™“çš„ã€‚</p><p>å¦‚æœæˆ‘ä»¬è¦æ„å»ºä¸€ä¸ªéœ€è¦è®¿é—®å¤–éƒ¨æ•°æ®æºçš„ LLM åº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åº”è¯¥é€‰æ‹© RAGã€‚å› ä¸º RAG ä¼šé€šè¿‡åœ¨ LLM ç”Ÿæˆå“åº”ä¹‹å‰ä»å¤–éƒ¨æ•°æ®æºä¸­æ£€ç´¢ä¸å½“å‰ç”¨æˆ·æŸ¥è¯¢æœ€ç›¸å…³çš„ä¿¡æ¯æ¥å¢å¼º LLM çš„èƒ½åŠ›ã€‚ ç›¸æ¯”ä¹‹ä¸‹ï¼Œè™½ç„¶æˆ‘ä»¬å¯ä»¥å¯¹LLMè¿›è¡Œå¾®è°ƒä»¥å­¦ä¹ ä¸€äº›å¤–éƒ¨çŸ¥è¯†ï¼Œä½†è¿™æ ·åšéœ€è¦ç›®æ ‡é¢†åŸŸå†…çš„å¤§é‡å¸¦æ ‡ç­¾çš„é—®ç­”æ•°æ®é›†ï¼Œä¸”è¯¥æ•°æ®é›†å¿…é¡»éšç€åŸºç¡€æ•°æ®çš„å˜åŒ–ä¸æ–­å˜åŒ–æ›´æ–°ï¼Œè¿™åœ¨åŸºç¡€æ•°æ®é¢‘ç¹æ›´æ–°æ—¶æ˜¯ä¸åˆ‡å®é™…çš„ã€‚å¾®è°ƒè¿‡ç¨‹ä¹Ÿæ²¡æœ‰æ˜ç¡®åœ°å¯¹æŸ¥è¯¢å¤–éƒ¨çŸ¥è¯†æ‰€æ¶‰åŠçš„æ£€ç´¢å’Œæ¨ç†æ­¥éª¤è¿›è¡Œå»ºæ¨¡ï¼Œè¿™ä½¿å¾—å¼€å‘äººå‘˜ä¸ç”¨æˆ·å¯¹è¿™ä¸¤ä¸ªæ­¥éª¤çš„æ‰§è¡Œå­˜åœ¨è¾ƒå¤§ä¸ç¡®å®šæ€§ã€‚</p><p>å› æ­¤æ€»è€Œè¨€ä¹‹ï¼Œå¦‚æœæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºéœ€è¦ä½¿ç”¨å¤–éƒ¨æ•°æ®æºï¼Œé‚£ä¹ˆä½¿ç”¨ RAG ç³»ç»Ÿå¯èƒ½æ¯”å°è¯•ä»…é€šè¿‡å¾®è°ƒâ€œèå…¥â€æ‰€éœ€çš„çŸ¥è¯†æ›´æœ‰æ•ˆä¸”å¯æ‰©å±•ã€‚</p><p>ï¼ˆ2ï¼‰<strong>æ˜¯å¦éœ€è¦ä¿®æ”¹æ¨¡å‹çš„è¡Œä¸ºã€å†™ä½œé£æ ¼æˆ–ç‰¹å®šé¢†åŸŸçš„çŸ¥è¯†ï¼Ÿ</strong></p><p>å¾®è°ƒçš„ä¼˜åŠ¿åœ¨äºèƒ½å¤Ÿä½¿ LLM çš„è¡Œä¸ºé€‚åº”ç‰¹å®šé¢†åŸŸçš„è¯­æ°”æˆ–æœ¯è¯­ã€‚æ¯”å¦‚æˆ‘ä»¬å¸Œæœ›æ¨¡å‹çš„å›ç­”æ›´åƒä¸€ä¸ªæ³•å¾‹ä¸“å®¶ï¼Œé‚£ä¹ˆå¯¹æ³•å¾‹é¢†åŸŸçš„æ•°æ®é›†è¿›è¡Œå¾®è°ƒå¯ä»¥è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚</p><p>è€Œä¸ä¹‹ç›¸å¯¹åœ°ï¼ŒRAGè™½ç„¶èƒ½å¤Ÿæ£€ç´¢å¤–éƒ¨æ•°æ®æºå¹¶æä¾›ç»™LLMè¿›è¡Œåˆ©ç”¨ä¸æ•´åˆï¼Œä½†å…¶ä¾§é‡ç‚¹ä»åœ¨äºä¿¡æ¯æ£€ç´¢ï¼Œå¹¶ä¸ä¼šæ ¹æ®æ£€ç´¢åˆ°çš„æ–‡ä»¶ä¸ä¿¡æ¯ä¿®æ”¹LLMçš„è¯­æ°”ä¸æªè¯é£æ ¼ã€‚</p><p>å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºéœ€è¦ä¸“é—¨çš„å›å¤é£æ ¼æˆ–ä¸ç‰¹å®šé¢†åŸŸçš„è¯­è¨€æƒ¯ä¾‹å’Œæ°”è´¨ä¿æŒä¸€è‡´ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨å¾®è°ƒã€‚</p><p>ï¼ˆ3ï¼‰<strong>æŠ‘åˆ¶å¹»è§‰</strong></p><p>LLMçš„ä¸€ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹å°±æ˜¯å®¹æ˜“äº§ç”Ÿå¹»è§‰ï¼Œå³å¯¹äºæœªæŒæ¡çš„çŸ¥è¯†æˆ–ä¸ç†Ÿæ‚‰çš„çŸ¥è¯†ï¼ŒLLMä¹Ÿä¼šå°è¯•ç¼–é€ æ²¡æœ‰ç°å®ä¾æ®æˆ–ç°æˆæ•°æ®çš„äº‹æƒ…ä¸ç»†èŠ‚ï¼Œç”Ÿæˆå›å¤ã€‚äººç±»çœ‹åˆ°ä¹‹åï¼Œå¯èƒ½æ„Ÿè§‰â€œæœ‰ç†æœ‰æ®ï¼Œå¤´å¤´æ˜¯é“â€ï¼Œä½†å…¶å®å¯èƒ½æ˜¯LLMåœ¨â€œä¸€æœ¬æ­£ç»åœ°èƒ¡è¯´å…«é“â€ã€‚å¦‚æœç”¨æˆ·éµç…§è¿™ç±»å›å¤è¿›è¡Œæ“ä½œï¼Œå¯èƒ½é€ æˆä¸å¯ç¡®è®¤çš„ç»“æœç”šè‡³é‡å¤§ç ´åæ€§é—®é¢˜ã€‚</p><p>å¦‚æœåœ¨ç‰¹å®šé¢†åŸŸçš„è®­ç»ƒæ•°æ®ä¸Šå¯¹LLMè¿›è¡Œå¾®è°ƒï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘LLMå‡ºç°å¹»è§‰çš„å¯èƒ½æ€§ã€‚ä½†åªæ˜¯ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘è¿™ç§å¯èƒ½æ€§ï¼Œå³å½“LLMé¢å¯¹ä¸ç†Ÿæ‚‰çš„é—®é¢˜æ—¶ï¼ŒLLMä»å¯èƒ½ä¼šâ€œä¸€æœ¬æ­£ç»åœ°èƒ¡è¯´å…«é“â€ï¼Œå¯¼è‡´LLMå¹»è§‰ç°è±¡çš„å‡ºç°ã€‚</p><p>ç›¸å¯¹åœ°ï¼Œå¦‚æœä½¿ç”¨RAGåˆ™ä¸å¤ªå®¹æ˜“äº§ç”Ÿå¹»è§‰ï¼Œå› ä¸ºå®ƒçš„æ¯ä¸ªå“åº”éƒ½åŸºäºä»æŒ‡å®šæ•°æ®æºä¸­æ£€ç´¢åˆ°çš„ä¿¡æ¯ã€‚åœ¨LLMè¾“å‡ºç­”æ¡ˆä¹‹å‰ï¼Œæ£€ç´¢å™¨ä»å¤–éƒ¨æ•°æ®æºï¼ˆæˆ‘ä»¬å½“ç„¶åº”è¯¥å°½é‡ä¿è¯æ­¤å¤–éƒ¨æ•°æ®æºä¸­æ•°æ®çš„å‡†ç¡®ä¸¥è°¨æ€§ï¼‰ä¸­æ£€ç´¢åˆ°ç›¸å…³æ–‡ä»¶ä¸ä¿¡æ¯ï¼Œè¿™ä¸ªè¿‡ç¨‹å…¶å®å°±æ˜¯ç›¸å½“äºæ˜¯å¯¹LLMçš„å¤§è‡´å›å¤å†…å®¹è¿›è¡Œäº†äº‹å®æ£€æŸ¥æ“ä½œï¼Œæå¤§åœ°å‡å°‘äº†LLMâ€œä¸€æœ¬æ­£ç»åœ°èƒ¡è¯´å…«é“â€çš„å¯èƒ½æ€§ã€‚LLM ä¹Ÿè¢«é™åˆ¶æ ¹æ®æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ä¿¡æ¯åˆæˆå“åº”ã€‚</p><p>ï¼ˆ4ï¼‰<strong>å¯ç”¨çš„å·²æ ‡è®°è®­ç»ƒæ•°æ®é‡å¤§å°æ˜¯ä¸€ä¸ªé‡è¦å› ç´ </strong></p><p>å¯ç”¨å·²æ ‡è®°æ•°æ®çš„è´¨é‡ä¸æ•°é‡æ˜¯å†³å®šé‡‡ç”¨æ¨¡å‹å¾®è°ƒè¿˜æ˜¯RAGçš„ä¸€ä¸ªé‡è¦å› ç´ ã€‚å³å¦‚æœå¯ç”¨å·²æ ‡è®°æ•°æ®é‡å¤§ä¸”è´¨é‡éƒ½ä¸é”™ï¼Œé‚£ä¹ˆè¿™äº›è®­ç»ƒæ•°æ®å¯ä»¥å¸®åŠ©æ¨¡å‹æ·±å…¥ç†è§£ç‰¹å®šé¢†åŸŸçš„ç»†å¾®å·®åˆ«ã€å¤æ‚æ€§ä¸ç‹¬ç‰¹æ¨¡å¼ï¼Œä»è€Œç”Ÿæˆå‡†ç¡®çš„ã€ä¸ä¸Šä¸‹æ–‡ç›¸å…³çš„å›å¤ï¼›åè¿‡æ¥ï¼Œå¦‚æœæˆ‘ä»¬çš„è®­ç»ƒæ•°æ®æ•°æ®ä¸è´¨é‡æ— æ³•è¾¾åˆ°ä¸Šè¿°æ ‡å‡†ï¼Œäº‹å®ä¸Šå¾®è°ƒèƒ½å¤Ÿå¸¦æ¥çš„æ”¹è¿›æ•ˆæœæ˜¯éå¸¸æœ‰é™çš„ï¼Œå¦‚æœè®­ç»ƒæ•°æ®é›†ä¸è¶³è¿˜æœ‰å¯èƒ½å¯¼è‡´å‡ºç°è¿‡æ‹Ÿåˆç°è±¡ã€‚</p><p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œå³ä½¿æ²¡æœ‰å¤§é‡çš„å¯ç”¨å·²æ ‡è®°æ•°æ®ï¼ŒRAGç‹¬ç«‹äºè®­ç»ƒæ•°æ®ï¼Œä»èƒ½å¤Ÿä»æä¾›çš„å¤–éƒ¨çŸ¥è¯†æºä¸­æ£€ç´¢ç”¨æˆ·æé—®çš„ç›¸å…³ä¿¡æ¯ï¼Œç„¶åç”±LLMé€šè¿‡è®¿é—®ä¸æ•´åˆæ¥è‡ªå¤–éƒ¨æ•°æ®æºçš„ä¿¡æ¯ç”Ÿæˆæœ€ç»ˆå›å¤ã€‚æ£€ç´¢å’Œç”Ÿæˆçš„ç»“åˆç¡®ä¿ç³»ç»Ÿå³ä½¿åœ¨ç‰¹å®šé¢†åŸŸçš„è®­ç»ƒæ•°æ®ç¨€ç–çš„æƒ…å†µä¸‹ä¹Ÿèƒ½ä¿æŒçŸ¥æƒ…ã€‚</p><p>æ‰€ä»¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬æ‹¥æœ‰å¤§é‡çš„å¯ç”¨æ ‡è®°æ•°æ®ä»¥è¦†ç›–å½“å‰é¢†åŸŸå†…é—®é¢˜çš„å¤æ‚æ€§ä¸å¹¿åº¦ï¼Œæ¨¡å‹å¾®è°ƒå¯ä»¥æä¾›å®šåˆ¶åŒ–çš„ã€å‡†ç¡®å®Œå–„çš„æ¨¡å‹è¡Œä¸ºã€‚åä¹‹ï¼Œæˆ‘ä»¬åˆ™åº”è¯¥é‡‡ç”¨RAGæ–‡æ¡ˆï¼Œç¡®ä¿åº”ç”¨ç¨‹åºé€šè¿‡å…¶æ£€ç´¢åŠŸèƒ½ä¿æŒæ•°æ®çŸ¥æƒ…ä¸ä¸Šä¸‹æ–‡æ„ŸçŸ¥ã€‚</p><p>ï¼ˆ5ï¼‰<strong>æ•°æ®åŠ¨é™æ€ç¨‹åº¦å¦‚ä½•</strong></p><p>åœ¨ç‰¹å®šæ•°æ®é›†ä¸Šå¾®è°ƒLLMæ„å‘³ç€LLMæœ¬èº«çš„çŸ¥è¯†å‚¨å¤‡å°±æ˜¯å¾®è°ƒæ—¶æ‰€ç”¨æ•°æ®é›†çš„ä¸€ä¸ªé™æ€å¿«ç…§ã€‚å¾ˆæ˜¾ç„¶ï¼Œå¦‚æœæ¨¡å‹æ‰€éœ€è¦ä½¿ç”¨çš„æ•°æ®é›†é¢‘ç¹æ›´æ–°ï¼Œä¸ºäº†ä½¿ç”¨LLMæœ¬èº«çš„çŸ¥è¯†å‚¨å¤‡èƒ½å¤Ÿè·Ÿè¿™äº›æ›´æ–°ä¿æŒåŒæ­¥ï¼Œå°±éœ€è¦å¯¹æ¨¡å‹é¢‘ç¹è¿›è¡Œå¾®è°ƒï¼Œè¿™ä¸ä»…éœ€è¦é¢‘ç¹åœ°å‡†å¤‡æ•°æ®é›†ä¸æ ¼å¼åŒ–å®ƒä»¬ï¼Œè¿˜éœ€è¦é¢‘ç¹åœ°æ‰§è¡Œå¾®è°ƒæŒ‡ä»¤ï¼Œè¿™é—¨å°†æ˜¯ä¸€ä¸ªè€—æ—¶åˆå ç”¨èµ„æºçš„è¿‡ç¨‹ã€‚ä¸æ­¤åŒæ—¶ï¼Œä¸ºäº†ç¡®ä¿æ›´æ–°åçš„æ¨¡å‹åœ¨ä¸åŒåœºæ™¯ä¸‹èƒ½å¤Ÿä½¿ç”¨æ›´æ–°åçš„çŸ¥è¯†åšå‡ºå‡†ç¡®æ°å½“çš„å›ç­”ï¼Œè¿˜éœ€è¦å¯¹å…¶è¿›è¡Œæµ‹è¯•ä¸ä»”ç»†ç›‘æ§ã€‚</p><p>è€ŒRAGåœ¨ç±»ä¼¼çš„åœºæ™¯ä¸‹åˆ™æ‹¥æœ‰ä¸èº«ä¿±æ¥çš„ä¼˜åŠ¿ã€‚å®ƒä»¬æœ¬æ¥å°±æ˜¯ä½¿ç”¨æ£€ç´¢æœºåˆ¶åœ¨å¤–éƒ¨çŸ¥è¯†æºæŸ¥è¯¢ä¸ç”¨æˆ·æé—®æœ€ç›¸å…³çš„æ–‡æ¡£ä¸ä¿¡æ¯ï¼Œæ›´æ–°äº†å¤–éƒ¨çŸ¥è¯†æºå…¶å®å¯¹å®ƒæ¥è¯´å‡ ä¹æ˜¯é€æ˜çš„ï¼Œå®ƒä»¬ä»èƒ½ä»æ›´æ–°åçš„å¤–éƒ¨çŸ¥è¯†æºæ£€ç´¢å¹¶æå–æœ€æ–°çš„çŸ¥è¯†ã€‚</p><p>æ€»ä¹‹ï¼Œå¦‚æœæˆ‘ä»¬æ•°æ®ç¯å¢ƒæ˜¯å¿«é€Ÿè¿­ä»£æ›´æ–°çš„ï¼ŒRAGä¸ºæˆ‘ä»¬æä¾›çš„æ•æ·æ€§ã€ä¾¿æ·æ€§ã€é«˜æ•ˆæ€§æ˜¯ä¼ ç»Ÿå¾®è°ƒéš¾ä»¥æ¯”æ‹Ÿçš„ã€‚</p><p>ï¼ˆ6ï¼‰<strong>LLM åº”ç”¨ç¨‹åºéœ€è¦æœ‰å¤šé€æ˜&#x2F;å¯è§£é‡Šï¼Ÿ</strong></p><p>ç»è¿‡å¾®è°ƒåçš„LLMè™½ç„¶å¾ˆå¼ºå¤§ï¼Œä½†å…¶èƒŒåçš„è¿ä½œä¸æ¨ç†é€»è¾‘å¯¹äººç±»æ¥è¯´å°±æ˜¯ä¸€ä¸ªé»‘ç›’å­ï¼Œä¸é€æ˜ä¸”ä¸å¯æ„ŸçŸ¥å…¶ä¸­æŸä¸ªå…³é”®ç»†èŠ‚è¿‡ç¨‹ã€‚å¯¹äºæŸäº›ç”¨æˆ·æˆ–æŸäº›éœ€è¦éªŒè¯LLMè¾“å‡ºç»“æœå‡†ç¡®æ€§çš„åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œç¡®å®šLLMè¾“å‡ºçš„å†…å®¹å¹¶çŸ¥æ™“å…¶èƒŒåçš„åŸå› ä¸å‚è€ƒå†…å®¹ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ã€‚é—æ†¾çš„æ˜¯ï¼Œå¾®è°ƒå¹¶ä¸èƒ½å®ç°æ­¤åŠŸèƒ½ã€‚</p><p>ç›¸åï¼ŒRAGå´å¯ä»¥è½»æ¾åœ°å®ç°æ­¤åŠŸèƒ½ã€‚ç”±äºRAGçš„ä¸¤æ­¥æ€§è´¨å³â€æ£€ç´¢ä¸ç”Ÿæˆâ€œï¼Œä¸”èƒ½å°†ä¸­é—´çš„æ£€ç´¢ç»“æœä¸­ä¸ç”Ÿæˆå†…å®¹ç›¸å…³çš„å†…å®¹æœ€ç»ˆä»¥å‚è€ƒæ–‡æ¡£çš„å½¢å¼å‘ˆç°ç»™ä½¿ç”¨è€…ï¼Œè¿™ä¸ºä½¿ç”¨è€…æº¯æºè¾“å‡ºå†…å®¹æä¾›äº†åˆ‡å®çš„è¯æ®ä¸å‚è€ƒçº¿ç´¢ã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœä½¿ç”¨è€…è¦æ±‚å¯¹LLMè¾“å‡ºçš„å†…å®¹è¿›è¡Œæº¯æºï¼Œä»¥æ‰¾åˆ°åˆ‡å®çš„è¯æ®ä¸å‚è€ƒçº¿ç´¢ï¼Œé‚£ä¹ˆRAGå°†æ˜¯é¦–é€‰ã€‚</p><p>ï¼ˆ12ï¼‰<strong>å¤æ‚åº¦</strong></p><p>è™½ç„¶è®¸å¤šæä¾›å•†ç°åœ¨æä¾›ä¸€é”®å¼å¾®è°ƒï¼Œæˆ‘ä»¬åªéœ€è¦æä¾›è®­ç»ƒæ•°æ®ï¼Œä½†è·Ÿè¸ªæ¨¡å‹ç‰ˆæœ¬å¹¶ç¡®ä¿æ–°æ¨¡å‹ä»ç„¶å…¨é¢è¿è¡Œæ˜¯ä¸€é¡¹æŒ‘æˆ˜ã€‚å¦ä¸€æ–¹é¢ï¼ŒRAG ä¹Ÿå¯èƒ½å¾ˆå¿«å˜å¾—å¤æ‚ã€‚æœ‰å¤šä¸ªç»„ä»¶çš„è®¾ç½®ï¼Œç¡®ä¿æ•°æ®åº“ä¿æŒæœ€æ–°ï¼Œå¹¶ç¡®ä¿å„ä¸ªéƒ¨åˆ†ï¼ˆä¾‹å¦‚æ£€ç´¢å’Œç”Ÿæˆï¼‰æ­£ç¡®åœ°ç»„åˆåœ¨ä¸€èµ·ã€‚</p><hr><h1 id="ä¸‰ã€æ€»ç»“"><a href="#ä¸‰ã€æ€»ç»“" class="headerlink" title="ä¸‰ã€æ€»ç»“"></a>ä¸‰ã€æ€»ç»“</h1><p>æ˜¾ç„¶ï¼Œæˆ‘ä»¬åœ¨å†³å®šé€‰æ‹©å¾®è°ƒè¿˜æ˜¯RAGå‰ï¼Œéœ€è¦å…ˆå¯¹LLMçš„ç‹¬ç‰¹éœ€è¦ã€ä¼˜å…ˆäº‹é¡¹ä¸è‡ªèº«æ¡ä»¶è¿›è¡Œç»¼åˆè¯„ä¼°ã€‚</p><p>æ²¡æœ‰ä¸€ç§ä¸‡èƒ½çš„è§£å†³æ–¹æ¡ˆ ï¼ŒæˆåŠŸåœ¨äºä½¿ä¼˜åŒ–æ–¹æ³•ä¸ä»»åŠ¡çš„å…·ä½“è¦æ±‚ä¿æŒä¸€è‡´ã€‚é€šè¿‡è¯„ä¼°å…³é”®æ ‡å‡†ï¼ˆå¤–éƒ¨æ•°æ®çš„éœ€æ±‚ã€è°ƒæ•´æ¨¡å‹è¡Œä¸ºã€è®­ç»ƒæ•°æ®å¯ç”¨æ€§ã€æ•°æ®åŠ¨æ€ã€ç»“æœé€æ˜åº¦ç­‰ï¼‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨æœ€ä½³å‰è¿›è·¯å¾„åšå‡ºæ˜æ™ºçš„å†³ç­–ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒåŒæ—¶åˆ©ç”¨ RAG å’Œå¾®è°ƒçš„æ··åˆæ–¹æ³•å¯èƒ½æ˜¯æœ€ä½³é€‰æ‹©ã€‚</p><p><img src="https://s2.loli.net/2025/03/11/JqMdIaOznpjgTFm.png" alt="image-20250311162729369"></p><p>ï¼ˆ1ï¼‰å¦‚æœè¦ä½¿ç”¨å¾®è°ƒï¼Œç›®å‰åœ¨æˆ‘çœ‹æ¥å°†å­˜åœ¨ä»¥ä¸‹ç¼ºç‚¹æˆ–å¾…è§£å†³é—®é¢˜ï¼š</p><ul><li>å¾®è°ƒéœ€è¦å°†æˆ‘ä»¬å…¬å¸ç°æœ‰å„ç§æ–‡æ¡£å¦‚ä½¿ç”¨æ‰‹å†Œã€äº§å“è¯´æ˜ä¹¦ã€ç™½çš®ä¹¦ç­‰ï¼Œè½¬æ¢æˆå¯ç”¨äºå¾®è°ƒçš„æ•°æ®é›†ã€‚è€Œè¿™äº›æ–‡æ¡£çš„æ ¼å¼å¯èƒ½æ˜¯å¤šç§å¤šæ ·çš„å¦‚pdfã€pptxã€docxç­‰ï¼Œéœ€è¦ç»§ç»­ç ”ç©¶è¿™ç§è½¬æ¢å·¥ä½œå¯ç”¨æ–¹æ³•ä¸æˆæœ¬ã€‚</li><li>åæœŸåŸºç¡€æ•°æ®å…³é”®å†…å®¹æ›´æ–°ä¸€æ¬¡å¯èƒ½å°±éœ€è¦è¿›è¡Œä¸€æ¬¡å¾®è°ƒï¼Œå°†å¢åŠ æˆæœ¬ã€‚ä¸”å¾®è°ƒä¸€æ¬¡å…¶å®ä¼šç”Ÿæˆä¸€ä¸ªæ–°æ¨¡å‹ï¼Œéœ€è¦é‡æ–°éƒ¨ç½²ï¼Œå°†ä¸´æ—¶ä¸­æ–­æ¨¡å‹å¯¹å¤–æä¾›æœåŠ¡ï¼ˆç›®å‰è¿™å¯¹äºæˆ‘ä»¬å…¬å¸æ¥è¯´ï¼Œå¯èƒ½ä¸æ˜¯æœ€å…³é”®çš„ç¼ºç‚¹ï¼‰</li></ul><p>ï¼ˆ2ï¼‰å¦‚æœä½¿ç”¨RAGï¼ˆè¿™é‡Œç›´æ¥ä»¥â€œfastGPTè¿™ç±»çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿâ€æ¥æ­å»ºå®¢æœç³»ç»Ÿä¸ºä¾‹ï¼‰ï¼Œåˆ™å­˜åœ¨ä»¥ä¸‹ç¼ºç‚¹ï¼š</p><ul><li>å®¢æœçš„å›å¤è¯­æ°”ä¸é£æ ¼ï¼Œå¯èƒ½ä¸å¤Ÿå§”å©‰ã€‚ä½†èƒ½å®ç°ä¼šè¯ä¸”ä¿è¯å›å¤çš„ç­”æ¡ˆèƒ½å¤Ÿæº¯æºä¸”ç›¸å¯¹å‡†ç¡®</li><li>ä¸ç®¡å¾®è°ƒè¿˜æ˜¯RAGï¼Œå¦‚æœéœ€è¦è”ç½‘æœç´¢ï¼Œå°±éœ€è¦é…ç½®è”ç½‘æœç´¢å¼•æ“ï¼ˆæœ‰æ”¶è´¹æœç´¢å¼•æ“ï¼Œä½†å¢åŠ äº†æˆæœ¬ï¼›ä¹Ÿæœ‰å…è´¹çš„ï¼Œä½†æœåŠ¡å¯èƒ½ä¸å¤Ÿç¨³å®šã€æ•ˆæœä¸å¦‚æ”¶è´¹ç‰ˆæœ¬å¥½ï¼‰</li></ul><hr><p><strong>æœ€åï¼Œæˆ‘ç»™å‡ºè‡ªå·±çš„å»ºè®®ä¾›å‚è€ƒ</strong>ï¼š</p><p>å¦‚æœéœ€è¦é©¬ä¸Šæ­å»ºå‡ºè¿™æ ·çš„å®¢æœç³»ç»Ÿï¼Œå¯ä»¥å…ˆä½¿ç”¨fastGPTæ¥æ­å»ºRAGåº”ç”¨ç¨‹åºï¼Œå®ŒæˆçŸ¥è¯†åº“ä¸ç›¸å…³åŠŸèƒ½é…ç½®ï¼Œå…ˆä½“éªŒä¸‹æ•ˆæœã€‚</p><p>å¦‚æœåç»­æœ‰éœ€è¦ä¸”æŠ€æœ¯å®Œå–„ã€æ—¶é—´å……è£•ï¼Œå¯ä»¥å°†å…¬å¸ç›¸å…³èµ„æ–™æ–‡æ¡£è½¬æ¢æˆå¯ç”¨æ ‡è®°æ•°æ®é›†ï¼Œè¿›è¡Œå¾®è°ƒã€‚æœ€å¥½èƒ½å°†â€œå¾®è°ƒä¸RAGç»“åˆèµ·æ¥ä½¿ç”¨â€ã€â€å•ç‹¬ä½¿ç”¨å¾®è°ƒâ€œè¿›è¡Œæ¯”è¾ƒè¯„ä¼°ï¼Œå¹¶ç¡®å®šåç»­åŠ¨ä½œã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ›´æ–°çŸ¥è¯†åº“ å¾®è°ƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>DeepSeekçš„ç”¨æ³•æ•´ç†(æŒç»­æ›´æ–°)</title>
    <link href="/2025/03/08/DeepSeek%E7%9A%84%E7%94%A8%E6%B3%95%E6%95%B4%E7%90%86-%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/"/>
    <url>/2025/03/08/DeepSeek%E7%9A%84%E7%94%A8%E6%B3%95%E6%95%B4%E7%90%86-%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/</url>
    
    <content type="html"><![CDATA[<p>ä»¥ä¸‹åˆ—ä¸¾å‡ºäº†DeepSeekç›¸å…³çš„ã€æš‚æ—¶éœ€è¦è¾ƒä¸“ä¸šå‘½ä»¤æˆ–ä¸“ä¸šæ“ä½œçš„ç›¸å…³æè¿°ã€‚å¸¸ç”¨çš„å¦‚æ–‡ç”Ÿæ™®é€šçš„æ–‡å­—ã€å›¾ç”Ÿæˆï¼Œä¸å†åˆ—ä¸¾ã€‚</p><p>å…¶ä»–çš„å¦‚æ–‡ç”Ÿè§†é¢‘ã€è§†é¢‘ç”Ÿæ–‡ã€è§†é¢‘ç”Ÿè§†é¢‘ç­‰è‡ªå·±æš‚æ—¶è¿˜æœªæ¥è§¦åˆ°ï¼Œåç»­çŸ¥é“å†è¡¥å……ã€‚</p><h1 id="ä¸€ã€æ–‡ç”Ÿæ€ç»´å¯¼å›¾"><a href="#ä¸€ã€æ–‡ç”Ÿæ€ç»´å¯¼å›¾" class="headerlink" title="ä¸€ã€æ–‡ç”Ÿæ€ç»´å¯¼å›¾"></a>ä¸€ã€æ–‡ç”Ÿæ€ç»´å¯¼å›¾</h1><h2 id="1-1-è®¿é—®DeepSeekç”Ÿæˆmkæ ¼å¼å†…å®¹"><a href="#1-1-è®¿é—®DeepSeekç”Ÿæˆmkæ ¼å¼å†…å®¹" class="headerlink" title="1.1 è®¿é—®DeepSeekç”Ÿæˆmkæ ¼å¼å†…å®¹"></a>1.1 è®¿é—®DeepSeekç”Ÿæˆmkæ ¼å¼å†…å®¹</h2><p><img src="https://s2.loli.net/2025/03/08/lWnDYmjcG6v4ThZ.png" alt="image-20250308181858148"></p><h2 id="1-2-åˆ›å»ºä¸€ä¸ª-txtæ–‡ä»¶"><a href="#1-2-åˆ›å»ºä¸€ä¸ª-txtæ–‡ä»¶" class="headerlink" title="1.2 åˆ›å»ºä¸€ä¸ª.txtæ–‡ä»¶"></a>1.2 åˆ›å»ºä¸€ä¸ª.txtæ–‡ä»¶</h2><p><img src="https://s2.loli.net/2025/03/08/EiunedakHrjAVKD.png" alt="image-20250308182114534"></p><p>å°†ä¸Šè¿°ç”Ÿæˆçš„å†…å®¹å¤åˆ¶åˆ°æ­¤.txtæ–‡ä»¶ä¸­</p><p><img src="https://s2.loli.net/2025/03/08/2FkqL7Yh9pdeogO.png" alt="image-20250308182303618"></p><h2 id="1-3-å°†-txtä¿®æ”¹ä¸º-md"><a href="#1-3-å°†-txtä¿®æ”¹ä¸º-md" class="headerlink" title="1.3 å°†.txtä¿®æ”¹ä¸º.md"></a>1.3 å°†.txtä¿®æ”¹ä¸º.md</h2><p><img src="https://s2.loli.net/2025/03/08/lbdavqm2JDKPCLR.png" alt="image-20250308182535657"></p><p>å°†ä¸Šè¿°.txtæ–‡ä»¶çš„åç¼€ä¿®æ”¹å.md</p><p><img src="https://s2.loli.net/2025/03/08/cLGjfbvr8JZ9kPM.png" alt="image-20250308182616175"></p><h2 id="1-4-ä½¿ç”¨Xmindæ‰“å¼€-mdæ–‡ä»¶"><a href="#1-4-ä½¿ç”¨Xmindæ‰“å¼€-mdæ–‡ä»¶" class="headerlink" title="1.4 ä½¿ç”¨Xmindæ‰“å¼€.mdæ–‡ä»¶"></a>1.4 ä½¿ç”¨Xmindæ‰“å¼€.mdæ–‡ä»¶</h2><p>æ­¤å¤„è¦ä½¿ç”¨é«˜ç‰ˆæœ¬çš„ Xmindè½¯ä»¶ï¼Œä½ç‰ˆæœ¬çš„Xmindæ— æ³•ç›´æ¥å¯¼å…¥.mdæ ¼å¼æ–‡ä»¶ã€‚ç¬”è€…æ­¤å¤„ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯â€œ25.01.01061â€ã€‚ä¸‹è½½åœ°å€å‚è€ƒï¼š<a href="https://xmind.app/download/">Xmindå®‰è£…åŒ…å®˜æ–¹ä¸‹è½½é“¾æ¥</a></p><p>æ–°å»ºå¯¼å›¾ï¼š</p><p><img src="https://s2.loli.net/2025/03/08/YNouhbfHTD8MPcL.png" alt="image-20250308193125792"></p><p>æ¨¡æ¿é€‰æ‹©â€œæ€ç»´å¯¼å›¾â€ï¼š</p><p><img src="https://s2.loli.net/2025/03/08/MnyZIEc17JpfNiO.png" alt="image-20250308193212122"></p><p>æ‰§è¡Œâ€œæ–‡ä»¶-&gt;å¯¼å…¥-&gt;Markdownâ€ï¼Œé€‰ä¸­ä¸Šé¢çš„â€œæç‚¼.mdâ€æ–‡ä»¶æ‰“å¼€ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ•ˆæœï¼š</p><p><img src="https://s2.loli.net/2025/03/08/vYx8eRfNW3Xrp1a.png" alt="image-20250308193446243"></p><h2 id="1-5-ä¿å­˜æ€ç»´å¯¼å›¾"><a href="#1-5-ä¿å­˜æ€ç»´å¯¼å›¾" class="headerlink" title="1.5 ä¿å­˜æ€ç»´å¯¼å›¾"></a>1.5 ä¿å­˜æ€ç»´å¯¼å›¾</h2><p>ä¹‹åï¼Œå°±å¯ä»¥å°†æ­¤æ€ç»´å¯¼å›¾ä¿å­˜ä¸ºâ€œ.xmindâ€æ ¼å¼æ–‡ä»¶ï¼Œåé¢ç›´æ¥ä½¿ç”¨Xmindæ‰“å¼€ã€‚</p><p><img src="https://s2.loli.net/2025/03/08/pbBk7T1ANjn3qYh.png" alt="image-20250308193653869"></p><p><img src="https://s2.loli.net/2025/03/08/JlITGLPvBEWYUt7.png" alt="image-20250308193724651"></p><h1 id="äºŒã€æ–‡ç”Ÿå›¾"><a href="#äºŒã€æ–‡ç”Ÿå›¾" class="headerlink" title="äºŒã€æ–‡ç”Ÿå›¾"></a>äºŒã€æ–‡ç”Ÿå›¾</h1><p>åœ¨DeepSeekå¯¹è¯ç•Œé¢çš„æç¤ºè¯è¾“å…¥æ¡†ä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼Œæ³¨æ„â€œINPUT&#x3D;â€åæ¥çš„å°±æ˜¯â€œå¾…ç”Ÿæˆå›¾ç‰‡çš„æè¿°â€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">INPUT=&#123;focus&#125;OUTPUT= (description&#125;\n![MG](https:// image.pollinations.ai/prompt/ &#123;description)) &#123;description&#125; =&#123;focusDetailed&#125;,%20&#123;adjective1&#125; %20&#123;adjective2&#125;,%20&#123;visu&#125; %20&#123;visualStyle3&#125; %20&#123;artistReference&#125; INPUTï¼ä¸€ä¸ªæ­£åœ¨è·³èˆçš„é¦™è•‰<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/03/08/1sfjue2CpKhz4PU.png" alt="image-20250308203609169"></p><p>åœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥ä¸Šè¿°è®¿é—®é“¾æ¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">https://image.pollinations.ai/prompt/ä¸€ä¸ªæ­£åœ¨è·³èˆçš„é¦™è•‰,%20æ»‘ç¨½çš„%20æ´»æ³¼çš„,%20å¡é€šé£æ ¼%20æ˜äº®è‰²å½©%20çš®å…‹æ–¯é£æ ¼<br></code></pre></td></tr></table></figure><p>ç„¶åçœ‹åˆ°å¦‚ä¸‹å›¾ï¼ˆä½†æœ‰æ°´å°ï¼‰ï¼š</p><p><img src="https://s2.loli.net/2025/03/08/KPQDpImH98JV3wo.png" alt="image-20250308203658219"></p><h1 id="ä¸‰ã€50ä¸ªè¶…å®â½¤DeepSeekâ¾¼é˜¶æâ½°è¯"><a href="#ä¸‰ã€50ä¸ªè¶…å®â½¤DeepSeekâ¾¼é˜¶æâ½°è¯" class="headerlink" title="ä¸‰ã€50ä¸ªè¶…å®â½¤DeepSeekâ¾¼é˜¶æâ½°è¯"></a>ä¸‰ã€50ä¸ªè¶…å®â½¤DeepSeekâ¾¼é˜¶æâ½°è¯</h1><p>ä»¥ä¸‹å†…å®¹æ¥è‡ªã€Šå°ç™½å…¥é—¨DeepSeekå¿…å¤‡çš„50ä¸ªé«˜é˜¶æç¤ºè¯.pdfã€‹</p><h2 id="3-1-ç¨‹åºå‘˜å¼€æŒ‚ç¯‡"><a href="#3-1-ç¨‹åºå‘˜å¼€æŒ‚ç¯‡" class="headerlink" title="3.1 ç¨‹åºå‘˜å¼€æŒ‚ç¯‡"></a>3.1 ç¨‹åºå‘˜å¼€æŒ‚ç¯‡</h2><ol><li><p>ä»£ç æ³¨é‡Šâ½£æˆå™¨</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œä¸ºä»¥ä¸‹Pythonä»£ç â½£æˆè¯¦ç»†æ³¨é‡Šï¼Œè§£é‡Šç®—æ³•é€»è¾‘å¹¶æ ‡æ³¨æ½œåœ¨â»›é™©â€<br></code></pre></td></tr></table></figure><p>å†å¤æ‚çš„ä»£ç ä¹Ÿèƒ½ç§’å˜å›¢é˜Ÿå‹å¥½å‹ï¼</p></li><li><p>BUGç»ˆç»“è€…æŒ‡ä»¤</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œåˆ†æè¿™æ®µæŠ¥é”™ä»£ç ï¼Œç»™å‡º3ç§ä¿®å¤â½…æ¡ˆå¹¶æŒ‰ä¼˜å…ˆçº§æ’åºâ€<br></code></pre></td></tr></table></figure><p>ä»æ­¤å‘Šåˆ«å‡Œæ™¨3ç‚¹åŠ ç­ä¿®BUGï¼</p></li><li><p>ç®—æ³•ä¼˜åŒ–ç§˜ç±</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">â€œå°†å½“å‰<span class="hljs-built_in">O</span>(nÂ²)å¤æ‚åº¦çš„æ’åºç®—æ³•ä¼˜åŒ–â¾„<span class="hljs-built_in">O</span>(nlogn)ï¼Œå¹¶æä¾›å¤æ‚åº¦å¯¹â€<br></code></pre></td></tr></table></figure><p>â¾¯è¯•â¼¿æ’•ä»£ç ç¯èŠ‚æƒŠè‰³å…¨åœºï¼</p></li><li><p>æŠ€æœ¯â½‚æ¡£ç¥å™¨</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œä¸ºä»¥ä¸‹APIæ¥â¼â½£æˆå¼€å‘â½‚æ¡£ï¼ŒåŒ…å«è¯·æ±‚â½°ä¾‹ã€å“åº”å‚æ•°å’Œé”™è¯¯ç è¯´æ˜â€<br></code></pre></td></tr></table></figure><p>è¿PMéƒ½å¤¸ä½ â½‚æ¡£å†™å¾—â½å®˜â½…è¿˜å¥½ï¼</p></li><li><p>SQLé˜²èƒŒé”…æŒ‡å—</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">â€œå®¡æŸ¥ä»¥ä¸‹<span class="hljs-keyword">SQL</span>è¯­å¥ï¼Œæ‰¾å‡º<span class="hljs-number">3</span>ä¸ªæ€§èƒ½éšæ‚£å¹¶ç»™å‡ºä¼˜åŒ–â½…æ¡ˆâ€<br></code></pre></td></tr></table></figure><p>ä»æ­¤æ•°æ®åº“å†ä¹Ÿä¸å´©ï¼</p></li></ol><h2 id="3-2-â¾ƒåª’ä½“çˆ†æ¬¾åˆ›ä½œç¯‡"><a href="#3-2-â¾ƒåª’ä½“çˆ†æ¬¾åˆ›ä½œç¯‡" class="headerlink" title="3.2 â¾ƒåª’ä½“çˆ†æ¬¾åˆ›ä½œç¯‡"></a>3.2 â¾ƒåª’ä½“çˆ†æ¬¾åˆ›ä½œç¯‡</h2><ol start="6"><li>10W+æ ‡é¢˜â½£æˆå™¨</li></ol>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">â€œâ½£æˆ<span class="hljs-number">20</span>ä¸ªå…³äº<span class="hljs-selector-attr">[ä¸»é¢˜]</span>çš„çˆ†æ¬¾æ ‡é¢˜ï¼Œè¦æ±‚å«æ•°å­—ã€åè½¬å‰§æƒ…å’Œæƒ…ç»ªå…³é”®è¯â€<br></code></pre></td></tr></table></figure><p>  â¼©çº¢ä¹¦&#x2F;å…¬ä¼—å·æ ‡é¢˜æ²¡çµæ„Ÿï¼Ÿâ½¤è¿™ä¸ªæâ½°è¯â½£æˆâ€œâ¼€çœ‹å°±æƒ³ç‚¹â€çš„æ ‡é¢˜åº“ï¼<br>7. â¼©çº¢ä¹¦å›¾â½‚æ¨¡æ¿</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">â€œä»¥â€˜<span class="hljs-number">3</span>ä¸ªæŠ€å·§+<span class="hljs-number">1</span>ä¸ªé¿å‘æŒ‡å—â€™ç»“æ„ï¼Œå†™â¼€ç¯‡<span class="hljs-selector-attr">[ä¸»é¢˜]</span>çš„â¼©çº¢ä¹¦çˆ†æ¬¾å›¾â½‚ç¬”è®°â€<br></code></pre></td></tr></table></figure><p>  ç›´æ¥å¥—â½¤æ¨¡æ¿â½£æˆå¸¦Emojiçš„ç¬”è®°ï¼Œæ–°â¼¿ä¹Ÿèƒ½åšå‡ºåƒèµçˆ†æ¬¾ï¼<br>8. çŸ­è§†é¢‘ç¥è„šæœ¬</p>  <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œâ½£æˆâ¼€ä¸ª30ç§’çŸ­è§†é¢‘è„šæœ¬ï¼šå‰3ç§’å†²çª+ä¸­é—´åè½¬+ç»“å°¾ç•™æ‚¬å¿µå¼•å¯¼ç‚¹èµâ€<br></code></pre></td></tr></table></figure><p>  æŠ–â¾³&#x2F;è§†é¢‘å·æµé‡å¯†ç getï¼è„šæœ¬ç»“æ„ç…§ç€â½¤ï¼Œæ’­æ”¾é‡è½»æ¾ç ´10ä¸‡ï¼<br>9. ç›´æ’­è¯æœ¯å®å…¸</p>  <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œè®¾è®¡â¼€åœº2â¼©æ—¶å¸¦è´§ç›´æ’­è„šæœ¬ï¼ŒåŒ…å«æš–åœºè¯æœ¯ã€äº§å“å¯¹â½ã€é™æ—¶é€¼å•ç¯èŠ‚â€<br></code></pre></td></tr></table></figure><p>  ç›´æ’­å†·åœºï¼Ÿâ½¤è¿™ä¸ªæâ½°è¯â½£æˆäº’åŠ¨è¯æœ¯ï¼Œè½¬åŒ–ç‡æå‡50%ï¼<br>10. å…¬ä¼—å·â¾¦å¥â½£æˆ</p><pre><code class="hljs"><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">â€œä¸º<span class="hljs-selector-attr">[ä¸»é¢˜]</span>â½‚ç« â½£æˆ<span class="hljs-number">10</span>ä¸ªæ‰â¼¼â¾¦å¥ï¼Œè¦æ±‚ç»“åˆçƒ­ç‚¹äº‹ä»¶å’Œå¹´è½»â¼ˆç—›ç‚¹â€<br></code></pre></td></tr></table></figure>â½‚ç« æ²¡è®°å¿†ç‚¹ï¼Ÿæ’â¼Šè¿™äº›â¾¦å¥ï¼Œè¯»è€…ç–¯ç‹‚æˆªå›¾è½¬å‘ï¼</code></pre><h2 id="3-3-ç”µå•†æé’±å®æˆ˜ç¯‡"><a href="#3-3-ç”µå•†æé’±å®æˆ˜ç¯‡" class="headerlink" title="3.3 ç”µå•†æé’±å®æˆ˜ç¯‡"></a>3.3 ç”µå•†æé’±å®æˆ˜ç¯‡</h2><ol start="11"><li><p>äºšâ»¢é€Šçˆ†æ¬¾â½‚æ¡ˆ</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">â€œä¸º<span class="hljs-selector-attr">[äº§å“]</span>å†™è‹±â½‚ç‰ˆäºšâ»¢é€ŠListingï¼ŒåŒ…å«<span class="hljs-number">5</span>ç‚¹äº§å“ç‰¹æ€§+<span class="hljs-number">3</span>ä¸ªä½¿â½¤åœºæ™¯æ•…äº‹â€<br></code></pre></td></tr></table></figure><p>â½¼å¤–çœ‹äº†ç›´æ¥åŠ è´­ï¼è·¨å¢ƒå–å®¶å¿…å¤‡çš„æµé‡æ”¶å‰²ç¥å™¨ï¼</p></li><li><p>è¯¦æƒ…â»šè½¬åŒ–ç¥å™¨</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œè®¾è®¡æ·˜å®è¯¦æƒ…â»šâ½‚æ¡ˆç»“æ„ï¼šç—›ç‚¹åœºæ™¯+å¯¹â½å®éªŒ+å”®åä¿éšœ+â½¤â¼¾è¯â¾”â€<br></code></pre></td></tr></table></figure><p>ç…§ç€æ¨¡æ¿â½£æˆï¼Œè¯¦æƒ…â»šè½¬åŒ–ç‡ä»1%é£™å‡åˆ°5%ï¼</p></li><li><p>ç§åŸŸå¼•æµè¯æœ¯</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œè®¾è®¡æœ‹å‹åœˆè£‚å˜è¯æœ¯ï¼šé™æ—¶ç¦åˆ©+â¾ä»½è®¤åŒ+â¼†ç»´ç å¼•å¯¼ï¼Œæ¯å¤©3æ¡ä¸å‘æ„â€<br></code></pre></td></tr></table></figure><p>å¾®å•†â¼©â½©ä¹Ÿèƒ½â½¤çš„å¼•æµæ¨¡æ¿ï¼Œ7å¤©åŠ æ»¡5000å¥½å‹ï¼</p></li><li><p>â¼©çº¢ä¹¦ç´ â¼ˆç§è‰</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">â€œâ½£æˆ<span class="hljs-number">10</span>æ¡<span class="hljs-selector-attr">[äº§å“]</span>ç´ â¼ˆç§è‰â½‚æ¡ˆï¼Œâ½¤â€˜é—ºèœœå®‰åˆ©â€™è¯­â½“çªå‡º<span class="hljs-number">3</span>ä¸ªä½¿â½¤åœºæ™¯â€<br></code></pre></td></tr></table></figure><p>é›¶â¼´å‘Šç—•è¿¹çš„è½¯æ¤â¼Šï¼Œè®©â½¤â¼¾ä¸»åŠ¨æ±‚é“¾æ¥ï¼</p></li><li><p>å®¢æœè¯æœ¯â¼¤å…¨</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œé’ˆå¯¹â€˜è´¨é‡å·®è¦é€€è´§â€™ç­‰5ç§å”®åé—®é¢˜ï¼Œâ½£æˆâ¾¼æƒ…å•†å›å¤è¯æœ¯â€<br></code></pre></td></tr></table></figure><p>å·®è¯„ç‡ç›´é™90%ï¼ç»´æŠ¤åº—é“ºè¯„åˆ†å°±é å®ƒï¼</p></li></ol><h2 id="3-4-å­¦â½£å…šé€†è¢­ç¯‡"><a href="#3-4-å­¦â½£å…šé€†è¢­ç¯‡" class="headerlink" title="3.4 å­¦â½£å…šé€†è¢­ç¯‡"></a>3.4 å­¦â½£å…šé€†è¢­ç¯‡</h2><ol start="16"><li><p>è®ºâ½‚å¼€é¢˜ç¥å™¨</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">â€œä¸º<span class="hljs-selector-attr">[ä¸“ä¸šâ½…å‘]</span>â½£æˆ<span class="hljs-number">10</span>ä¸ªåˆ›æ–°å‹è®ºâ½‚é€‰é¢˜ï¼ŒåŒ…å«ç†è®ºåŸºç¡€+ç°å®æ„ä¹‰â€<br></code></pre></td></tr></table></figure><p>å¯¼å¸ˆçœ¼å‰â¼€äº®ï¼å¼€é¢˜æŠ¥å‘Šâ¼€æ¬¡è¿‡ï¼</p></li><li><p>â½‚çŒ®ç»¼è¿°é€Ÿæˆ</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">â€œæ€»ç»“è¿‘<span class="hljs-number">3</span>å¹´<span class="hljs-selector-attr">[ä¸»é¢˜]</span>é¢†åŸŸ<span class="hljs-number">10</span>ç¯‡æ ¸â¼¼â½‚çŒ®ï¼Œå¯¹â½ç ”ç©¶â½…æ³•å’Œç»“è®ºå·®å¼‚â€<br></code></pre></td></tr></table></figure><p> 3â¼©æ—¶æå®šâ¼€å‘¨â¼¯ä½œé‡ï¼Œå·ç‹èˆæˆ‘å…¶è°ï¼</p></li><li><p>è€ƒè¯•æŠ¼é¢˜å®å…¸</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">â€œæ ¹æ®<span class="hljs-selector-attr">[ç§‘â½¬]</span>è¿‘<span class="hljs-number">5</span>å¹´çœŸé¢˜ï¼Œé¢„æµ‹ä»Šå¹´å¯èƒ½å‡ºç°çš„<span class="hljs-number">10</span>ä¸ªâ¾¼é¢‘è€ƒç‚¹â€<br></code></pre></td></tr></table></figure><p>å¤ä¹ ç›´æ¥åˆ’é‡ç‚¹ï¼ŒGPA4.0ä¸æ˜¯æ¢¦ï¼</p></li><li><p>è¯¾å ‚ç¬”è®°ä¼˜åŒ–</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs subunit">â€œå°†ä»¥ä¸‹æ‚ä¹±ç¬”è®°æ•´ç†æˆåº·å¥ˆå°”ç¬”è®°æ ¼å¼ï¼Œæå–3ä¸ªæ ¸â¼¼æ¦‚å¿µ<span class="hljs-string">+2</span>ä¸ªå®è·µæ¡ˆä¾‹â€<br></code></pre></td></tr></table></figure><p>å­¦æ¸£ç§’å˜å­¦éœ¸çš„ç§˜å¯†æ­¦å™¨ï¼</p></li><li><p>PPTé€Ÿæˆæ¨¡æ¿</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œä»¥â€˜é—®é¢˜-â½…æ¡ˆ-ä»·å€¼â€™ç»“æ„ï¼Œè®¾è®¡10â»šå­¦æœ¯æ±‡æŠ¥PPTâ¼¤çº²ï¼Œæ¯â»šæ ‡æ³¨è§†è§‰åŒ–æŠ€å·§â€<br></code></pre></td></tr></table></figure><p>ç­”è¾©ç°åœºç›´æ¥è¢«å¤¸â€œä¸“ä¸šåº¦æ»¡åˆ†â€ï¼</p></li></ol><h2 id="3-5-èŒåœºæ‰“â¼¯â¼ˆç¯‡"><a href="#3-5-èŒåœºæ‰“â¼¯â¼ˆç¯‡" class="headerlink" title="3.5 èŒåœºæ‰“â¼¯â¼ˆç¯‡"></a>3.5 èŒåœºæ‰“â¼¯â¼ˆç¯‡</h2><ol start="21"><li><p>ä¼šè®®çºªè¦ç§’æ•´ç†</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œå°†ä»¥ä¸‹ä¼šè®®å½•â¾³æ•´ç†æˆç»“æ„åŒ–çºªè¦ï¼ŒåŒ…å«è®®é¢˜ã€å†³ç­–ã€å¾…åŠäº‹é¡¹å’Œè´Ÿè´£â¼ˆâ€<br></code></pre></td></tr></table></figure><p>å†ä¹Ÿä¸â½¤è¾¹å¬å½•â¾³è¾¹æŠ“ç‹‚ï¼Œâ¼€é”®â½£æˆæ¸…æ™°ç‰ˆä¼šè®®è®°å½•ï¼Œä¼šåè·Ÿè¿›æ•ˆç‡æå‡300%ï¼</p></li><li><p>å‘¨æŠ¥â½£æˆç¥å™¨</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œæ ¹æ®æœ¬å‘¨â¼¯ä½œå†…å®¹ï¼Œâ½£æˆâ¼€ä»½é€»è¾‘æ¸…æ™°çš„å‘¨æŠ¥ï¼ŒåŒ…å«æˆæœæ•°æ®ã€é—®é¢˜åˆ†æå’Œä¸‹å‘¨è®¡åˆ’â€<br></code></pre></td></tr></table></figure><p> 5åˆ†é’Ÿæå®šå‘¨æŠ¥ï¼Œè¿˜èƒ½è®©é¢†å¯¼çœ‹åˆ°ä½ çš„â€œç»“æ„åŒ–æ€ç»´â€ï¼Œå‡èŒåŠ è–ªå°±å·®è¿™â¼€æ­¥ï¼</p></li><li><p>ç®€å†ä¼˜åŒ–â¿Šç§‘æŠ€</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">â€œä¼˜åŒ–ä»¥ä¸‹ç®€å†ï¼Œçªå‡º<span class="hljs-number">3</span>ä¸ªä¸<span class="hljs-selector-attr">[å²—ä½]</span>åŒ¹é…çš„æ ¸â¼¼èƒ½â¼’ï¼Œå¹¶â½¤æ•°æ®é‡åŒ–æˆæœâ€<br></code></pre></td></tr></table></figure><p>æŠ•ç®€å†â½¯æ²‰â¼¤æµ·ï¼Ÿâ½¤è¿™ä¸ªæâ½°è¯â½£æˆHRâ¼€çœ¼çœ‹ä¸­çš„ç®€å†ï¼Œâ¾¯è¯•é‚€çº¦æ¥åˆ°â¼¿è½¯ï¼</p></li><li><p>â¾¼æƒ…å•†é‚®ä»¶æ¨¡æ¿</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">â€œå†™â¼€å°ä¸»é¢˜ä¸º<span class="hljs-selector-attr">[XXX]</span>çš„æ­£å¼é‚®ä»¶ï¼Œéœ€åŒ…å«å§”å©‰æ‹’ç»ã€æ›¿ä»£â½…æ¡ˆå’Œåç»­è·Ÿè¿›è®¡åˆ’â€<br></code></pre></td></tr></table></figure><p>èŒåœºæ²Ÿé€šéš¾é¢˜â¼€é”®ç ´è§£ï¼Œä»æ­¤å‘Šåˆ«â€œå·²è¯»ä¸å›â€çš„å°´å°¬ï¼</p></li><li><p>é¡¹â½¬ç®¡ç†æ‹†è§£æœ¯</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">â€œå°†<span class="hljs-selector-attr">[â¼¤å‹é¡¹â½¬]</span>æ‹†è§£ä¸º<span class="hljs-number">7</span>ä¸ªæ‰§â¾æ­¥éª¤ï¼Œæ¯ä¸ªæ­¥éª¤æ ‡æ³¨â»›é™©ç‚¹å’Œæ‰€éœ€èµ„æºâ€<br></code></pre></td></tr></table></figure><p>å¤æ‚é¡¹â½¬ç¬é—´å˜æ¸…æ™°â½¢ç‰¹å›¾ï¼Œå›¢é˜Ÿåä½œæ•ˆç‡ç›´æ¥æ‹‰æ»¡ï¼</p></li></ol><h2 id="3-6-å‰¯ä¸šèµšé’±ç§˜ç±ç¯‡"><a href="#3-6-å‰¯ä¸šèµšé’±ç§˜ç±ç¯‡" class="headerlink" title="3.6 å‰¯ä¸šèµšé’±ç§˜ç±ç¯‡"></a>3.6 å‰¯ä¸šèµšé’±ç§˜ç±ç¯‡</h2><ol start="26"><li><p>â¼©çº¢ä¹¦èµ·å·ç¥å™¨</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œä¸ºæ–°â¼¿è®¾è®¡â€˜30å¤©æ¶¨ç²‰1ä¸‡â€™çš„â¼©çº¢ä¹¦è¿è¥è®¡åˆ’ï¼ŒåŒ…å«å†…å®¹é€‰é¢˜ã€å‘å¸ƒæ—¶é—´å’Œçˆ†æ¬¾ç»“æ„â€<br></code></pre></td></tr></table></figure><p>ä»0åˆ°1å†·å¯åŠ¨ï¼Ÿâ½¤è¿™ä¸ªæâ½°è¯â½£æˆä¿å§†çº§æ”»ç•¥ï¼Œç´ â¼ˆä¹Ÿèƒ½å˜â¾ä¸‡ç²‰åšä¸»ï¼</p></li><li><p>é—²â»¥å–è´§è¯æœ¯åº“</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œâ½£æˆ10æ¡â¾¼è½¬åŒ–é—²â»¥å•†å“â½‚æ¡ˆï¼Œçªå‡ºâ€˜é—²ç½®å¥½ç‰©+é™æ—¶â½©èœä»·â€™ç´§è¿«æ„Ÿâ€<br></code></pre></td></tr></table></figure><p>å…¼èŒå–è´§â½‰â¼Š5000+çš„ç§˜å¯†æ­¦å™¨ï¼ç›´æ¥å¤åˆ¶ç²˜è´´å°±èƒ½å‡ºå•ï¼</p></li><li><p>æŠ–â¾³ä¹¦å•å·è„šæœ¬</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œâ½£æˆ7ä¸ªä¹¦å•å·çŸ­è§†é¢‘è„šæœ¬ï¼ŒåŒ…å«ä¹¦ç±â¾¦å¥+ç—›ç‚¹åœºæ™¯+è´­ä¹°é“¾æ¥å¼•å¯¼â€<br></code></pre></td></tr></table></figure><p> 0æˆæœ¬å‰¯ä¸šâ¾¸é€‰ï¼ç…§ç€è„šæœ¬æ‹ï¼Œâ½‡å¼•æµ100+ç²¾å‡†è¯»è€…ï¼</p></li><li><p>çŸ¥ä¹å¥½ç‰©å¸¦è´§â½‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œä»¥â€˜äº²æµ‹é¿å‘â€™â»†åº¦å†™â¼€ç¯‡çŸ¥ä¹å¥½ç‰©æ¨èâ»“â½‚ï¼Œæ¤â¼Š3ä¸ªäº§å“é“¾æ¥å’Œå¯¹â½è¡¨æ ¼â€<br></code></pre></td></tr></table></figure><p>èººèµšä½£â¾¦çš„ç¥å™¨ï¼çŸ¥ä¹ç›å€¼è¹­è¹­æ¶¨ï¼Œå¸¦è´§æˆäº¤ç‡æå‡80%ï¼</p></li><li><p>å…¬ä¼—å·æµé‡ä¸»æ”»ç•¥</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œè®¾è®¡10ä¸ªè¯±å¯¼ç‚¹å‡»â¼´å‘Šä½çš„æ¨â½‚æ ‡é¢˜ï¼Œè¦æ±‚ç»“åˆçƒ­ç‚¹ä¸”ä¸è¿è§„â€<br></code></pre></td></tr></table></figure><p>ç²‰ä¸ä¸å¤šä¹Ÿèƒ½èµšâ¼´å‘Šè´¹ï¼ç‚¹å‡»ç‡æå‡3å€çš„æ ‡é¢˜å¥—è·¯ï¼</p></li></ol><h2 id="3-7-ä¸ªâ¼ˆæˆâ»“å¼€æŒ‚ç¯‡"><a href="#3-7-ä¸ªâ¼ˆæˆâ»“å¼€æŒ‚ç¯‡" class="headerlink" title="3.7 ä¸ªâ¼ˆæˆâ»“å¼€æŒ‚ç¯‡"></a>3.7 ä¸ªâ¼ˆæˆâ»“å¼€æŒ‚ç¯‡</h2><ol start="31"><li><p>çŸ¥è¯†ä½“ç³»æ­å»ºæœ¯</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">â€œä¸º<span class="hljs-selector-attr">[é¢†åŸŸ]</span>è®¾è®¡çŸ¥è¯†å›¾è°±ï¼ŒåŒ…å«æ ¸â¼¼æ¦‚å¿µã€å…³è”æ¡ˆä¾‹å’Œå®è·µâ½…æ³•è®ºâ€<br></code></pre></td></tr></table></figure><p>ç¢â½šåŒ–å­¦ä¹ ç»ˆç»“è€…ï¼â½¤AIæ„å»ºä¸“å±çŸ¥è¯†åº“ï¼Œå­¦ä¹ æ•ˆç‡ç§’æ€åŒé¾„â¼ˆï¼</p></li><li><p>æ¼”è®²é€å­—ç¨¿â½£æˆ</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œä»¥â€˜æ•…äº‹+æ•°æ®+â¾¦å¥â€™ç»“æ„ï¼Œâ½£æˆ10åˆ†é’Ÿæ¼”è®²é€å­—ç¨¿ï¼Œæ¯æ®µæ ‡æ³¨æƒ…ç»ªâ€œ<br></code></pre></td></tr></table></figure><p>ä¸Šå°ç´§å¼ å¿˜è¯ï¼ŸAIå†™çš„é€å­—ç¨¿è®©ä½ ç§’å˜TEDæ¼”è®²â¾¼â¼¿ï¼</p></li><li><p>è¯»ä¹¦å˜ç°ç¥å™¨</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œå°†ã€ŠXXXã€‹ä¹¦ç±å†…å®¹æ‹†è§£ä¸º20æ¡çŸ­è§†é¢‘â½‚æ¡ˆï¼Œæ¯æ¡çªå‡ºâ¼€ä¸ªé¢ è¦†è®¤çŸ¥çš„è§‚ç‚¹â€<br></code></pre></td></tr></table></figure><p>è¯»å®Œä¹¦å°±å˜ç°ï¼çŸ¥è¯†åšä¸»éƒ½åœ¨â½¤çš„å¸ç²‰ç§˜ç±ï¼</p></li><li><p>â¼ˆè„‰ç®¡ç†æ¨¡æ¿</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œè®¾è®¡ç¤¾äº¤èµ„äº§è®°å½•è¡¨ï¼ŒåŒ…å«è”ç³»â¼ˆä»·å€¼æ ‡ç­¾ã€æ²Ÿé€šé¢‘ç‡å’Œèµ„æºäº’æ¢â½…æ¡ˆâ€<br></code></pre></td></tr></table></figure><p>å¾®ä¿¡5000å¥½å‹ä¸å†æµªè´¹ï¼â½¤AIå¸®ä½ æŠŠè”ç³»â¼ˆå˜â€œé’±è„‰â€ï¼</p></li><li><p>æƒ…ç»ªç®¡ç†æŒ‡å—</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œé’ˆå¯¹ç„¦è™‘/æ‹–å»¶åœºæ™¯ï¼Œâ½£æˆ5ä¸ªâ½´å³â½£æ•ˆçš„â¼¼ç†å­¦åº”å¯¹ç­–ç•¥+æ‰§â¾æ¸…å•â€<br></code></pre></td></tr></table></figure><p>å†…è€—â¾ƒæ•‘æŒ‡å—ï¼â½¤ç§‘å­¦â½…æ³•å®ç°æƒ…ç»ªâ¾ƒç”±ï¼</p></li></ol><h2 id="3-8-æ•ˆç‡â¼¯å…·ç»„åˆæ‹³"><a href="#3-8-æ•ˆç‡â¼¯å…·ç»„åˆæ‹³" class="headerlink" title="3.8 æ•ˆç‡â¼¯å…·ç»„åˆæ‹³"></a>3.8 æ•ˆç‡â¼¯å…·ç»„åˆæ‹³</h2><ol start="36"><li><p>Excelå…¬å¼â½£æˆå™¨</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">â€œä¸º<span class="hljs-selector-attr">[æ•°æ®åˆ†æéœ€æ±‚]</span>â½£æˆå¯¹åº”Excelå…¬å¼ï¼Œå¹¶è§£é‡Šæ¯ä¸ªå‚æ•°çš„ä½¿â½¤åœºæ™¯â€<br></code></pre></td></tr></table></figure><p>å‡½æ•°è®°ä¸ä½ï¼Ÿâ½¤è¿™ä¸ªæâ½°è¯ç§’å˜è¡¨æ ¼â¼¤ç¥ï¼</p></li><li><p>PPTè®¾è®¡åŠ©â¼¿</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œå°†ä»¥ä¸‹â½‚å­—å†…å®¹è½¬åŒ–ä¸º10â»šè§†è§‰åŒ–PPTï¼Œæ¯â»šæ ‡æ³¨å›¾æ ‡ä½¿â½¤å’ŒåŠ¨ç”»å»ºè®®â€<br></code></pre></td></tr></table></figure><p>ä»æ­¤å‘Šåˆ«â¼Ÿå‘³PPTï¼AIâ½£æˆçš„è®¾è®¡è®©åŒäº‹ä»¥ä¸ºä½ å·å·æŠ¥äº†ä¸‡å…ƒè¯¾ç¨‹ï¼</p></li><li><p>æ€ç»´å¯¼å›¾â½£æˆæœ¯</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">â€œå°†<span class="hljs-selector-attr">[å¤æ‚æ¦‚å¿µ]</span>è½¬åŒ–ä¸ºä¸‰çº§æ€ç»´å¯¼å›¾ï¼Œæ¯ä¸ªèŠ‚ç‚¹é™„å¸¦è®°å¿†â¼è¯€â€<br></code></pre></td></tr></table></figure><p>èƒŒä¹¦å›°éš¾â¼¾ç¦â¾³ï¼â½¤å›¾åƒè®°å¿†æ³•æ•ˆç‡æå‡10å€ï¼</p></li><li><p>â½‡å†ç®¡ç†ç¥å™¨</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">â€œæ ¹æ®<span class="hljs-selector-attr">[â½¬æ ‡]</span>â½£æˆç™¾â½‡è®¡åˆ’è¡¨ï¼Œæ¯â½‡ä»»åŠ¡ç²¾ç¡®åˆ°â¼©æ—¶ï¼Œé¢„ç•™å¼¹æ€§æ—¶é—´â€<br></code></pre></td></tr></table></figure><p>æ‹–å»¶ç—‡å…‹æ˜Ÿï¼AIæ’ç­è®©ä½ æ¯å¤©â¾¼æ•ˆ12â¼©æ—¶ï¼</p></li><li><p>å¤–è¯­å­¦ä¹ åŠ é€Ÿå™¨</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œè®¾è®¡30å¤©è‹±è¯­çªç ´è®¡åˆ’ï¼ŒåŒ…å«æƒ…æ™¯å¯¹è¯ã€è¯­æ³•é™·é˜±å’ŒâºŸè¯­è€…è¡¨è¾¾ä¹ æƒ¯â€<br></code></pre></td></tr></table></figure><p>å¤–è¯­å¼€æŒ‚æ¨¡å¼å¯åŠ¨ï¼â½¤AIç§æ•™å®ç°â½†éšœç¢äº¤æµï¼</p></li></ol><h2 id="3-9-â¿Šç§‘æŠ€ç©æ³•ç¯‡"><a href="#3-9-â¿Šç§‘æŠ€ç©æ³•ç¯‡" class="headerlink" title="3.9 â¿Šç§‘æŠ€ç©æ³•ç¯‡"></a>3.9 â¿Šç§‘æŠ€ç©æ³•ç¯‡</h2><ol start="41"><li><p>AIæ¨¡æ‹Ÿâ¾¯è¯•å®˜</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œæ‰®æ¼”å­—èŠ‚è·³åŠ¨HRï¼Œæå‡º10ä¸ªâ¾¼é¢‘å‹â¼’â¾¯è¯•é¢˜å¹¶ç»™å‡ºæ»¡åˆ†å›ç­”æ¨¡æ¿â€<br></code></pre></td></tr></table></figure><p>â¾¯è¯•å‰å¿…ç»ƒï¼â½¤AIæå‰é¢„åˆ¤æ‰€æœ‰åˆé’»é—®é¢˜ï¼</p></li><li><p>è™šæ‹Ÿåˆ›ä¸šé¡¾é—®</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">â€œä¸º<span class="hljs-selector-attr">[åˆ›ä¸šé¡¹â½¬]</span>è®¾è®¡å•†ä¸šæ¨¡å¼ç”»å¸ƒï¼ŒåŒ…å«æˆæœ¬ç»“æ„ã€æ”¶â¼Šæ¥æºå’Œå…³é”®æŒ‡æ ‡â€<br></code></pre></td></tr></table></figure><p> 0æˆæœ¬éªŒè¯å•†ä¸šåˆ›æ„ï¼â½¤AIé¿å¼€ç™¾ä¸‡çº§è¯•é”™å‘ï¼</p></li><li><p>æ³•å¾‹â½‚ä¹¦â½£æˆå™¨</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">â€œâ½£æˆ<span class="hljs-selector-attr">[åˆä½œç±»å‹]</span>æ ‡å‡†åˆåŒæ¨¡æ¿ï¼Œæ ‡æ³¨å¸¸â»…â»›é™©æ¡æ¬¾å’Œä¿®æ”¹å»ºè®®â€<br></code></pre></td></tr></table></figure><p>çœä¸‹ä¸‡å…ƒå¾‹å¸ˆè´¹ï¼â¼©â½©ä¹Ÿèƒ½å†™å‡ºä¸“ä¸šåˆåŒï¼</p></li><li><p>å…ƒå®‡å®™è¥é”€â½…æ¡ˆ</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm">â€œä¸ºå“ç‰Œè®¾è®¡è™šæ‹Ÿ<span class="hljs-built_in">IP</span>è¿è¥ç­–ç•¥ï¼ŒåŒ…å«â¼ˆè®¾ã€äº’åŠ¨å½¢å¼å’ŒNFTå‘â¾è®¡åˆ’â€<br></code></pre></td></tr></table></figure><p>æŠ“ä½ä¸‹â¼€ä¸ªâ»›â¼ï¼â½¤AIæŠ¢å å…ƒå®‡å®™æµé‡ï¼</p></li><li><p>AIç®—å‘½å¸ˆæŒ‡ä»¤</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">â€œç»“åˆæ˜Ÿåº§å’ŒMBTIâ¼ˆæ ¼ï¼Œâ½£æˆ<span class="hljs-number">2024</span>å¹´è¿åŠ¿æŠ¥å‘Šï¼ŒåŒ…å«äº‹ä¸š<span class="hljs-regexp">/çˆ±æƒ…/</span>å¥åº·å»ºè®®â€<br></code></pre></td></tr></table></figure><p>å¹´è½»â¼ˆæœ€çˆ±ï¼â½¤â½å­¦å¼•æµâ½‡æ¶¨ç²‰1000+ï¼</p></li></ol><h2 id="3-10-â¼¤ç¥ç§è—ç¯‡"><a href="#3-10-â¼¤ç¥ç§è—ç¯‡" class="headerlink" title="3.10 â¼¤ç¥ç§è—ç¯‡"></a>3.10 â¼¤ç¥ç§è—ç¯‡</h2><ol start="46"><li><p>æâ½°è¯ä¼˜åŒ–æœ¯</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œè¯Šæ–­ä»¥ä¸‹æâ½°è¯é—®é¢˜ï¼Œç»™å‡º3ä¸ªä¼˜åŒ–â½…å‘å¹¶é‡å†™â½°ä¾‹â€<br></code></pre></td></tr></table></figure><p>ä»æ­¤å‘Šåˆ«â½†æ•ˆæé—®ï¼æŒæ¡è¿™ä¸ªæŒ‡ä»¤ï¼Œä½ ä¹Ÿèƒ½å†™å‡ºä»·å€¼ä¸‡å…ƒçš„æâ½°è¯ï¼</p></li><li><p>å¤šAIè”åˆä½œæˆ˜</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œè®¾è®¡DeepSeek+Midjourneyâ¼¯ä½œæµï¼Œå®ç°â€˜â½‚æ¡ˆ+è®¾è®¡â€™å…¨â¾ƒåŠ¨<br></code></pre></td></tr></table></figure><p>â¼€ä¸ªâ¼ˆå°±æ˜¯â¼€å®¶å…¬å¸ï¼AIæµâ½”çº¿â½‡æ›´ç™¾æ¡å†…å®¹ï¼</p></li><li><p>ç§åŸŸSOPâ½£æˆå™¨</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">â€œä¸º<span class="hljs-selector-attr">[â¾ä¸š]</span>è®¾è®¡å…¨å¹´ç§åŸŸè¿è¥SOPï¼ŒåŒ…å«èŠ‚â½‡è¥é”€ã€å¤è´­æ¿€æ´»å’Œæµå¤±<br></code></pre></td></tr></table></figure><p>â½¼æ¿è·ªæ±‚çš„è¿è¥å®å…¸ï¼è·³æ§½è°ˆè–ªç›´æ¥æ¶¨50%ï¼</p></li><li><p>AIæŒ‡ä»¤å˜ç°æœ¯</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œåŒ…è£…10ä¸ªâ¾¼éœ€æ±‚æâ½°è¯ï¼Œè®¾è®¡æˆ199å…ƒçŸ¥è¯†ä»˜è´¹äº§å“å¹¶æ’°å†™é”€å”®â»šâ€<br></code></pre></td></tr></table></figure><p>â½¤AIèµšAIçš„é’±ï¼å‰¯ä¸šâ½‰â¼Š3ä¸‡çš„æ–°â»›â¼ï¼</p></li><li><p>æœªæ¥æŠ€èƒ½é¢„æµ‹</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">â€œåˆ—å‡º2025å¹´æœ€å€¼é’±çš„10é¡¹AIç›¸å…³æŠ€èƒ½ï¼Œé™„å¸¦å­¦ä¹ è·¯å¾„å’Œèµ„æºæ¸…å•â€<br></code></pre></td></tr></table></figure><p>æå‰å¸ƒå±€æœªæ¥5å¹´ï¼â½¤è¿™ä¸ªæŒ‡ä»¤æ°¸è¿œå¿«â¼ˆâ¼€æ­¥ï¼</p></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>DeepSeekä½¿ç”¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä»€ä¹ˆæ˜¯æ¨¡å‹å¾®è°ƒ</title>
    <link href="/2025/03/07/%E4%BB%80%E4%B9%88%E6%98%AF%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/"/>
    <url>/2025/03/07/%E4%BB%80%E4%B9%88%E6%98%AF%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€-å¾®è°ƒæœ¬è´¨"><a href="#ä¸€ã€-å¾®è°ƒæœ¬è´¨" class="headerlink" title="ä¸€ã€ å¾®è°ƒæœ¬è´¨"></a>ä¸€ã€ å¾®è°ƒæœ¬è´¨</h1><p>æ¨¡å‹å¾®è°ƒæ˜¯ä»è‹±æ–‡ç¿»è¯‘è¿‡æ¥çš„è¯è¯­ï¼ŒåŸè‹±æ–‡æ˜¯â€Fine-tuningâ€œã€‚</p><p>æ¨¡å‹å¾®è°ƒå°±æ˜¯ï¼š<strong>é€šè¿‡ç‰¹å®šé¢†åŸŸæ•°æ®å¯¹é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œé’ˆå¯¹æ€§ä¼˜åŒ–ï¼Œä»¥æå‡å…¶åœ¨ç‰¹å®šä»»åŠ¡ä¸Šçš„æ€§èƒ½</strong>ã€‚</p><p>ç”¨é€šä¿—æ¯”æ–¹è§£é‡Šå°±æ˜¯å°±æ˜¯ï¼Œå¦‚æœé¢„è®­ç»ƒæ¨¡å‹æ˜¯ä¸€ä¸ªå¨è‰ºä¸é”™çš„å¨å¸ˆï¼Œå®ƒå·²ç»æœ‰äº†å¤§é‡çš„çƒ¹é¥ªç»éªŒï¼ŒæŒæ¡äº†å¾ˆå¤šçŸ¥è¯†å’ŒæŠ€èƒ½ï¼Œä½†å¯èƒ½å¹¶ä¸æ“…é•¿åšæŸä¸ªèœç³»ï¼ˆå¦‚æ¹˜èœï¼‰çš„èœï¼Œè€Œåªæ˜¯ä¼šä¸€äº›æ™®é€šçš„å®¶å¸¸èœã€‚æ­¤æ—¶æˆ‘ä»¬è¿™ä¸ªå¨å¸ˆæä¾›äº†ä¸“é—¨åšæ¹˜èœçš„æ•™ç¨‹ä¸è®­ç»ƒï¼ˆä¸€äº›ç‰¹å®šä»»åŠ¡çš„æ•°æ®ï¼‰ï¼Œè®©å®ƒé’ˆå¯¹æ€§åœ°å­¦ä¹ åšæ¹˜èœï¼ˆè°ƒæ•´å®ƒå¤„ç†ä¿¡æ¯çš„æ–¹å¼ï¼‰ã€‚ç»è¿‡è¿™æ ·çš„è®­ç»ƒä¹‹å ï¼Œå®ƒå°±æˆä¸ºäº†æ¹˜èœå¤§å¨ï¼Œåšå‡ºéå¸¸åœ°é“ç¾å‘³çš„æ¹˜èœï¼ˆè®©å®ƒæ›´æ“…é•¿å®Œæˆæˆ‘ä»¬éœ€è¦çš„ä»»åŠ¡ï¼‰ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ¨¡å‹å¾®è°ƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>çº¯CPUæœ¬åœ°å¾®è°ƒDeepSeek-R1-1.5bæ¨¡å‹(è¿˜åœ¨å®Œå–„ä¸­)</title>
    <link href="/2025/03/06/%E7%BA%AFCPU%E6%9C%AC%E5%9C%B0%E5%BE%AE%E8%B0%83DeepSeek-R1-1.5b%E6%A8%A1%E5%9E%8B/"/>
    <url>/2025/03/06/%E7%BA%AFCPU%E6%9C%AC%E5%9C%B0%E5%BE%AE%E8%B0%83DeepSeek-R1-1.5b%E6%A8%A1%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€æ–‡æ¡£è¯´æ˜ä¸æœåŠ¡å™¨å‡†å¤‡"><a href="#ä¸€ã€æ–‡æ¡£è¯´æ˜ä¸æœåŠ¡å™¨å‡†å¤‡" class="headerlink" title="ä¸€ã€æ–‡æ¡£è¯´æ˜ä¸æœåŠ¡å™¨å‡†å¤‡"></a>ä¸€ã€æ–‡æ¡£è¯´æ˜ä¸æœåŠ¡å™¨å‡†å¤‡</h1><h2 id="1-1-æ–‡æ¡£è¯´æ˜"><a href="#1-1-æ–‡æ¡£è¯´æ˜" class="headerlink" title="1.1 æ–‡æ¡£è¯´æ˜"></a>1.1 æ–‡æ¡£è¯´æ˜</h2><p>è¿™æ˜¯ä¸€ç¯‡ä¿å§†çº§åˆ«çš„â€å¾®è°ƒDeepSeek-R1-Distill-Llama-8Bæ¨¡å‹â€çš„æ“ä½œæ–‡ç« ï¼Œåªè¦ç¨å¾®æ‡‚ç‚¹è®¡ç®—æœºè½¯ä»¶çŸ¥è¯†å°±å¯ä»¥æˆåŠŸå¤ç°æ­¤æ–‡ç« ä¸­æ‰€è¿°å†…å®¹ã€‚</p><p>æ­¤æ–‡æ¡£ä¸­å°è¯•å¾®è°ƒDeepSeek-R1è’¸é¦æ¨¡å‹æ¯”å¦‚1.5Bï¼Œå®ƒä»…é CPUå°±èƒ½è¿è¡Œã€‚</p><h2 id="1-2-æœåŠ¡å™¨ä¸GPUå‡†å¤‡"><a href="#1-2-æœåŠ¡å™¨ä¸GPUå‡†å¤‡" class="headerlink" title="1.2 æœåŠ¡å™¨ä¸GPUå‡†å¤‡"></a>1.2 æœåŠ¡å™¨ä¸GPUå‡†å¤‡</h2><p>æ­¤æ¬¡ä½¿ç”¨çš„æœåŠ¡å™¨æ˜¯ä¸€ä¸ªx86_64æ„æ¶çš„Hygon C86 5380ç‰©ç†æœåŠ¡å™¨ï¼Œå…·ä½“ä¿¡æ¯å¦‚ä¸‹ï¼š</p><table><thead><tr><th>ä¸»æœºå</th><th>IP</th><th>æ“ä½œç³»ç»Ÿ</th><th>è§„æ ¼</th><th>GPUæƒ…å†µ</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>controller01</td><td>172.20.0.21</td><td>Ubuntu 20.04.3 LTS -amd64</td><td>32c64g+960G</td><td>NVIDIA A40*1</td><td></td></tr></tbody></table><p>ç›¸å…³é‡è¦è½¯ä»¶ç‰ˆæœ¬ï¼ˆåé¢3ä¸ªæ˜¯pythonåº“çš„ç‰ˆæœ¬ï¼Œå»ºè®®ä½¿ç”¨condaåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…æ­¤ç‰ˆæœ¬ã€‚åœ¨å…¶ä»–è½¯ä»¶ç‰ˆæœ¬å›ºå®šçš„æƒ…å†µä¸‹ï¼Œunslothä½¿ç”¨2025.2.5ä¹‹å¤–çš„ç‰ˆæœ¬å°±æŠ¥é”™ï¼‰ï¼š</p><ul><li><p>GPUé©±åŠ¨ç‰ˆæœ¬ï¼š550.54.15</p></li><li><p>Cudaç‰ˆæœ¬ï¼šV12.4.131</p></li><li><p>torchç‰ˆæœ¬ï¼š2.6.0</p></li><li><p>transformersç‰ˆæœ¬ï¼š4.48.3</p></li><li><p>unslothç‰ˆæœ¬ï¼š2025.2.5</p></li></ul><h2 id="1-3-å¤§æ¨¡å‹å¾®è°ƒå®šä¹‰"><a href="#1-3-å¤§æ¨¡å‹å¾®è°ƒå®šä¹‰" class="headerlink" title="1.3 å¤§æ¨¡å‹å¾®è°ƒå®šä¹‰"></a>1.3 å¤§æ¨¡å‹å¾®è°ƒå®šä¹‰</h2><p>åˆ©ç”¨ç‰¹å®šé¢†åŸŸçš„æ•°æ®é›†å¯¹å·²é¢„è®­ç»ƒçš„å¤§æ¨¡å‹è¿›è¡Œè¿›ä¸€æ­¥è®­ç»ƒçš„è¿‡ç¨‹ã€‚å®ƒæ—¨åœ¨ä¼˜åŒ–æ¨¡å‹åœ¨ç‰¹å®šä»»åŠ¡ä¸Šçš„æ€§èƒ½ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿæ›´å¥½åœ°é€‚åº”å’Œå®Œæˆç‰¹å®šé¢†åŸŸçš„ä»»åŠ¡ã€‚å…¶ä¸­æœ€é‡è¦çš„æ˜¯è¶…å‚æ•°ï¼ˆå¦‚å­¦ä¹ ç‡ã€æ‰¹æ¬¡å¤§å°å’Œè®­ç»ƒè½®æ¬¡ï¼‰è°ƒæ•´ä¼˜åŒ–ã€‚è½¬æˆå¤§ç™½è¯å°±æ˜¯è°ƒæ•´å¤§æ¨¡å‹ä¸­ä¸€äº›å‚æ•°çš„å€¼ï¼Œä½¿å…¶åœ¨ç‰¹å®šæ•°æ®é›†ä¸Šè¡¨ç°æ›´ä¼˜ç§€ã€‚</p><h1 id="äºŒã€ç›¸å…³æ–‡ä»¶ä¸‹è½½"><a href="#äºŒã€ç›¸å…³æ–‡ä»¶ä¸‹è½½" class="headerlink" title="äºŒã€ç›¸å…³æ–‡ä»¶ä¸‹è½½"></a>äºŒã€ç›¸å…³æ–‡ä»¶ä¸‹è½½</h1><h2 id="2-1-æ¨¡å‹æ–‡ä»¶ä¸‹è½½"><a href="#2-1-æ¨¡å‹æ–‡ä»¶ä¸‹è½½" class="headerlink" title="2.1 æ¨¡å‹æ–‡ä»¶ä¸‹è½½"></a>2.1 æ¨¡å‹æ–‡ä»¶ä¸‹è½½</h2><p>æœ¬æ¥æ˜¯æƒ³å»huggingfaceä¸Šä¸‹è½½ç›¸å…³æ¨¡å‹æ–‡ä»¶ä¸æ•°æ®é›†ï¼Œç”±äºhuggingfaceéœ€è¦æ¢¯å­æ‰èƒ½è®¿é—®ï¼Œä¸ä¾¿æ“ä½œã€‚æ‰€ä»¥æ­¤æ–‡æ¡£ä¸­æ˜¯åœ¨å›½å†…ç½‘ç»œå¯æ­£å¸¸è®¿é—®é­”æ­å¹³å°ä¸Šä¸‹è½½æ¨¡å‹ä¸æ•°æ®é›†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">è®¿é—®é­”æ­ï¼šhttps://modelscope.cn/models/deepseek-ai/DeepSeek-R1-Distill-Qwen-1.5B/files</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸æŒ‡å®š--local_dir å‚æ•°ï¼Œæ–‡ä»¶å°†è¢«ä¿å­˜åœ¨ç”¨æˆ·æ ¹ç›®å½•ä¸‹çš„.cacheå­ç›®å½•ä¸‹</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ¨¡å‹æ€»å¤§å°åœ¨3.3Gå·¦å³</span><br>(py312) D:\00_code_repos\AI_models&gt;modelscope download --model deepseek-ai/DeepSeek-R1-Distill-Qwen-1.5B --local_dir ./deepseek-ai/DeepSeek-R1-Distill-Qwen-1.5B<br></code></pre></td></tr></table></figure><h2 id="2-2-è®­ç»ƒæ•°æ®é›†æ–‡ä»¶ä¸‹è½½"><a href="#2-2-è®­ç»ƒæ•°æ®é›†æ–‡ä»¶ä¸‹è½½" class="headerlink" title="2.2 è®­ç»ƒæ•°æ®é›†æ–‡ä»¶ä¸‹è½½"></a>2.2 è®­ç»ƒæ•°æ®é›†æ–‡ä»¶ä¸‹è½½</h2><p>è®¿é—®é­”æ­ï¼Œæœç´¢â€œmedical-o1-reasoning-SFTâ€æ•°æ®é›†å¹¶ä¸‹è½½ï¼ˆæ­¤å¤„ä¼šæœ‰ä¸¤ä¸ªåŒåæ•°æ®é›†ï¼Œä½†ä¸Šä¼ è€…ä¸åŒï¼Œæˆ‘é€‰æ‹©äº†ä¸‹è½½é‡æ›´å¤§çš„<a href="https://modelscope.cn/datasets/AI-ModelScope/medical-o1-reasoning-SFT%EF%BC%89%E3%80%82">https://modelscope.cn/datasets/AI-ModelScope/medical-o1-reasoning-SFTï¼‰ã€‚</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">(py312) D:\00_code_repos\AI_datasets&gt;modelscope download --dataset AI-ModelScope/medical-o1-reasoning-SFT --local_dir ./AI-ModelScope/medical-o1-reasoning-SFT<br></code></pre></td></tr></table></figure><h1 id="ä¸‰ã€å…¶ä»–å‡†å¤‡æ­¥éª¤"><a href="#ä¸‰ã€å…¶ä»–å‡†å¤‡æ­¥éª¤" class="headerlink" title="ä¸‰ã€å…¶ä»–å‡†å¤‡æ­¥éª¤"></a>ä¸‰ã€å…¶ä»–å‡†å¤‡æ­¥éª¤</h1><h2 id="3-1-wandb-tokenå‡†å¤‡"><a href="#3-1-wandb-tokenå‡†å¤‡" class="headerlink" title="3.1 wandb tokenå‡†å¤‡"></a>3.1 wandb tokenå‡†å¤‡</h2><p>å»<a href="https://wandb.ai/">wandbå®˜ç½‘</a>æ³¨å†Œä¸€ä¸ªè´¦å·ã€ç”³è¯·ä¸€ä¸ªtokenï¼Œå¹¶è®°å½•æ­¤tokenï¼Œåç»­è¦ç”¨ã€‚</p><p>æ³¨ï¼š</p><ul><li><p>wandbçš„æ„æ€æ˜¯â€weights and biasesâ€œï¼Œç½‘ä¸Šæ²¡æœ‰æ‰¾åˆ°ç°æˆçš„ç¿»è¯‘ï¼Œæˆ‘ç›´è¯‘ä¸ºæƒé‡ä¸åå·®ã€‚</p></li><li><p><a href="https://wandb.ai/wandb_fc/chinese/reports/-Weights-Biases---Vmlldzo4MDEwNzM">å…³äºW&amp;Bçš„ä»‹ç»</a>ï¼šW&amp;B æ˜¯ä¸€ä¸ªå¹³å°ï¼Œå¯å¸®åŠ©æ•°æ®ç§‘å­¦å®¶è·Ÿè¸ªä»–ä»¬çš„æ¨¡å‹ã€æ•°æ®é›†ã€ç³»ç»Ÿä¿¡æ¯ç­‰ã€‚ åªéœ€å‡ è¡Œä»£ç ï¼Œå°±å¯ä»¥å¼€å§‹è·Ÿè¸ªæœ‰å…³è¿™äº›åŠŸèƒ½çš„æ‰€æœ‰å†…å®¹ã€‚ å®ƒæ˜¯å…è´¹ä¾›ä¸ªäººä½¿ç”¨çš„ã€‚ å›¢é˜Ÿä½¿ç”¨é€šå¸¸æ˜¯ä»˜è´¹çš„ï¼Œä½†ç”¨äºå­¦æœ¯ç›®çš„çš„å›¢é˜Ÿæ˜¯å…è´¹çš„ã€‚ å¯ä»¥å°† W&amp;B ä¸è‡ªå·±å–œæ¬¢çš„æ¡†æ¶ä¸€èµ·ä½¿ç”¨ï¼Œä¾‹å¦‚ TensorFlowã€Kerasã€PyTorchã€SKlearnã€fastai ç­‰ã€‚</p><p>æ‰€æœ‰è·Ÿè¸ªä¿¡æ¯éƒ½å‘é€åˆ° W&amp;B UI ä¸Šçš„ä¸“ç”¨é¡¹ç›®é¡µé¢ï¼Œå¯ä»¥åœ¨å…¶ä¸­æ‰“å¼€é«˜è´¨é‡çš„å¯è§†åŒ–ã€æ±‡æ€»ä¿¡æ¯å¹¶æ¯”è¾ƒæ¨¡å‹æˆ–å‚æ•°ã€‚</p></li></ul><h3 id="3-1-1-wandbå®˜ç½‘è´¦å·æ³¨å†Œ"><a href="#3-1-1-wandbå®˜ç½‘è´¦å·æ³¨å†Œ" class="headerlink" title="3.1.1 wandbå®˜ç½‘è´¦å·æ³¨å†Œ"></a>3.1.1 wandbå®˜ç½‘è´¦å·æ³¨å†Œ</h3><p>å¦‚ä¸‹ä½¿ç”¨æˆ‘è‡ªå·±çš„githubè´¦å·è¿›è¡Œæ³¨å†Œã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨æ‰‹åŠ¨é‚®ç®±ä¸å¯†ç è¿›è¡Œæ³¨å†Œï¼ˆå¦‚ä¸‹å›¾æœ€ä¸‹éƒ¨åˆ†æ‰€ç¤ºï¼‰</p><p><img src="https://s2.loli.net/2025/02/13/jBqpIiDF5t48Axc.png" alt="image-20250213162023573"></p><p><img src="https://s2.loli.net/2025/02/13/ZJYaFVol2H1vsej.png" alt="image-20250213162111736"></p><p><img src="https://s2.loli.net/2025/02/21/prnxAkaSZcHGPdE.png" alt="image-20250221230552719"></p><h3 id="3-1-2-è·å–token"><a href="#3-1-2-è·å–token" class="headerlink" title="3.1.2 è·å–token"></a>3.1.2 è·å–token</h3><p>è¿›å…¥wandbå®˜ç½‘ä¸­è‡ªå·±è´¦å·çš„ä¸»é¡µï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹ã€‚åœ¨å¦‚ä¸‹ä½ç½®å¤åˆ¶è‡ªå·±çš„wandb token</p><p><img src="https://s2.loli.net/2025/02/13/4gxCbyk1P95sULh.png" alt="image-20250213162624545"></p><h2 id="3-2-å‡†å¤‡jupyterç¯å¢ƒ"><a href="#3-2-å‡†å¤‡jupyterç¯å¢ƒ" class="headerlink" title="3.2 å‡†å¤‡jupyterç¯å¢ƒ"></a>3.2 å‡†å¤‡jupyterç¯å¢ƒ</h2><p>ä»¥ä¸‹ä»¥åœ¨Ubuntu 20.04.3 LTS -amd64ä¸Šå®‰è£…jupyterç¯å¢ƒä¸ºä¾‹ï¼Œè¯´æ˜å®‰è£…jupyterç¯å¢ƒçš„æ­¥éª¤ã€‚</p><h3 id="3-2-1-å®‰è£…conda"><a href="#3-2-1-å®‰è£…conda" class="headerlink" title="3.2.1 å®‰è£…conda"></a>3.2.1 å®‰è£…conda</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:/opt/installPkgs# mkdir /root/.pip<br>root@controller01:/opt/installPkgs# cat &gt; /root/.pip/pip.conf  &lt;&lt;EOF<br>[global]<br>trusted-host = mirrors.aliyun.com<br>index-url = https://mirrors.aliyun.com/pypi/simple<br>EOF<br><br>root@controller01:/opt/installPkgs# wget --user-agent=â€œMozillaâ€ + https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/Anaconda3-2024.06-1-Linux-x86_64.sh<br><br>root@controller01:/opt/installPkgs# bash Anaconda3-2024.06-1-Linux-x86_64.sh<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##å®‰è£…è¿‡ç¨‹ä¸­ï¼Œä¼šè¯¢é—®ç›¸å…³é—®é¢˜ï¼Œä¿æŒé»˜è®¤é…ç½®ç›´æ¥å›è½¦æˆ–è¾“å…¥YESå†å›è½¦ï¼ˆæ•´ä¸ªå®‰è£…è¿‡ç¨‹å¯èƒ½éœ€è¦è€—æ—¶å‡ åˆ†é’Ÿï¼‰</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##condaçš„é»˜è®¤å®‰è£…ç›®å½•æ˜¯/root/anaconda3</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##å®‰è£…è¿‡ç¨‹ä¸­æœ€å‡ è¡Œå¦‚ä¸‹</span></span><br>....<br>You can undo this by running `conda init --reverse $SHELL`? [yes|no]<br>[no] &gt;&gt;&gt; yes             #æ­¤å¤„è¾“å…¥yeså¹¶å›è½¦<br>no change     /root/anaconda3/condabin/conda<br>no change     /root/anaconda3/bin/conda<br>no change     /root/anaconda3/bin/conda-env<br>no change     /root/anaconda3/bin/activate<br>no change     /root/anaconda3/bin/deactivate<br>no change     /root/anaconda3/etc/profile.d/conda.sh<br>no change     /root/anaconda3/etc/fish/conf.d/conda.fish<br>no change     /root/anaconda3/shell/condabin/Conda.psm1<br>no change     /root/anaconda3/shell/condabin/conda-hook.ps1<br>no change     /root/anaconda3/lib/python3.12/site-packages/xontrib/conda.xsh<br>no change     /root/anaconda3/etc/profile.d/conda.csh<br>modified      /root/.bashrc<br><br>==&gt; For changes to take effect, close and re-open your current shell. &lt;==<br><br>Thank you for installing Anaconda3!<br>root@controller01:/opt/installPkgs# <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é‡æ–°åŠ è½½ç¯å¢ƒå˜é‡ï¼Œå¹¶å¯ç”¨é»˜è®¤çš„base condaç¯å¢ƒ</span><br>root@controller01:/opt/installPkgs# source ~/.bashrc<br>(base) root@controller01:/opt/installPkgs# which python<br>/root/anaconda3/bin/python<br>(base) root@controller01:/opt/installPkgs# which pip<br>/root/anaconda3/bin/pip<br>(base) root@controller01:/opt/installPkgs# python -V<br>Python 3.12.4<br>(base) root@controller01:/opt/installPkgs# pip -V<br>pip 24.0 from /root/anaconda3/lib/python3.12/site-packages/pip (python 3.12)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹ç°æœ‰çš„condaç®¡ç†çš„æ‰€æœ‰è™šæ‹Ÿpythonç¯å¢ƒ</span><br>(base) root@controller01:/opt/installPkgs# conda env list<br><span class="hljs-meta prompt_"># </span><span class="language-bash">conda environments:</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash">base                  *  /root/anaconda3</span><br><br>(base) root@controller01:/opt/installPkgs# <br></code></pre></td></tr></table></figure><h3 id="3-2-2-åˆ›å»ºself-llmè™šæ‹Ÿpythonç¯å¢ƒ"><a href="#3-2-2-åˆ›å»ºself-llmè™šæ‹Ÿpythonç¯å¢ƒ" class="headerlink" title="3.2.2 åˆ›å»ºself-llmè™šæ‹Ÿpythonç¯å¢ƒ"></a>3.2.2 åˆ›å»ºself-llmè™šæ‹Ÿpythonç¯å¢ƒ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ›´æ–°è½¯ä»¶åˆ—è¡¨</span><br>(base) root@controller01:/opt/installPkgs# apt-get update<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å‡†å¤‡å¥½python3ç¯å¢ƒä¸pip3ï¼ˆä½¿ç”¨ä¸Šè¿°condaåˆ›å»ºè™šæ‹Ÿpython3ã€pip3ç¯å¢ƒï¼‰</span><br>(base) root@controller01:/opt/installPkgs# conda create -n self-llm python=3.12<br>...<br>The following NEW packages will be INSTALLED:<br><br>  _libgcc_mutex      pkgs/main/linux-64::_libgcc_mutex-0.1-main <br>  _openmp_mutex      pkgs/main/linux-64::_openmp_mutex-5.1-1_gnu <br>  bzip2              pkgs/main/linux-64::bzip2-1.0.8-h5eee18b_6 <br>  ca-certificates    pkgs/main/linux-64::ca-certificates-2024.12.31-h06a4308_0 <br>  expat              pkgs/main/linux-64::expat-2.6.4-h6a678d5_0 <br>  ld_impl_linux-64   pkgs/main/linux-64::ld_impl_linux-64-2.40-h12ee557_0 <br>  libffi             pkgs/main/linux-64::libffi-3.4.4-h6a678d5_1 <br>  libgcc-ng          pkgs/main/linux-64::libgcc-ng-11.2.0-h1234567_1 <br>  libgomp            pkgs/main/linux-64::libgomp-11.2.0-h1234567_1 <br>  libstdcxx-ng       pkgs/main/linux-64::libstdcxx-ng-11.2.0-h1234567_1 <br>  libuuid            pkgs/main/linux-64::libuuid-1.41.5-h5eee18b_0 <br>  ncurses            pkgs/main/linux-64::ncurses-6.4-h6a678d5_0 <br>  openssl            pkgs/main/linux-64::openssl-3.0.15-h5eee18b_0 <br>  pip                pkgs/main/linux-64::pip-25.0-py312h06a4308_0 <br>  python             pkgs/main/linux-64::python-3.12.9-h5148396_0 <br>  readline           pkgs/main/linux-64::readline-8.2-h5eee18b_0 <br>  setuptools         pkgs/main/linux-64::setuptools-75.8.0-py312h06a4308_0 <br>  sqlite             pkgs/main/linux-64::sqlite-3.45.3-h5eee18b_0 <br>  tk                 pkgs/main/linux-64::tk-8.6.14-h39e8969_0 <br>  tzdata             pkgs/main/noarch::tzdata-2025a-h04d1e81_0 <br>  wheel              pkgs/main/linux-64::wheel-0.45.1-py312h06a4308_0 <br>  xz                 pkgs/main/linux-64::xz-5.6.4-h5eee18b_1 <br>  zlib               pkgs/main/linux-64::zlib-1.2.13-h5eee18b_1 <br><br><br>Proceed ([y]/n)? Y         #æ­¤å¤„è¾“å…¥yå¹¶å›è½¦<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##ç„¶åç­‰å¾…ä¸‹è½½ä¸è§£å‹æå–ç›¸å…³pythonå®‰è£…æ–‡ä»¶ä¸pythonæ¨¡å—ã€‚å®‰è£…è¿‡ç¨‹çš„æœ€åå‡ è¡Œè¾“å‡ºå¦‚ä¸‹</span></span><br>...<br><span class="hljs-meta prompt_"># </span><span class="language-bash">To activate this environment, use</span>                                                                         <br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#     $ conda activate self-llm</span></span>                                                                             <br><span class="hljs-meta prompt_"># </span><span class="language-bash">To deactivate an active environment, use</span>                                                                   <br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#     $ conda deactivate</span></span><br>(base) root@controller01:/opt/installPkgs# <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹ç°æœ‰çš„condaç®¡ç†çš„æ‰€æœ‰è™šæ‹Ÿpythonç¯å¢ƒ</span><br>(base) root@controller01:/opt/installPkgs# conda env list<br><span class="hljs-meta prompt_"># </span><span class="language-bash">conda environments:</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash">base                     /root/anaconda3</span><br>self-llm              *  /root/anaconda3/envs/self-llm<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ¿€æ´»self-llm è¿™ä¸ªè™šæ‹Ÿpythonç¯å¢ƒï¼Œå¹¶åœ¨å…¶ä¸­æ‰§è¡Œç›¸å…³å‘½ä»¤</span><br>(base) root@controller01:/opt/installPkgs# conda activate self-llm <br>(self-llm) root@controller01:/opt/installPkgs# python -V<br>Python 3.12.9<br>(self-llm) root@controller01:/opt/installPkgs# pip -V<br>pip 25.0 from /root/anaconda3/envs/self-llm/lib/python3.12/site-packages/pip (python 3.12)<br>(self-llm) root@controller01:/opt/installPkgs# <br></code></pre></td></tr></table></figure><h3 id="3-2-3-å®‰è£…jupyterç¯å¢ƒ"><a href="#3-2-3-å®‰è£…jupyterç¯å¢ƒ" class="headerlink" title="3.2.3 å®‰è£…jupyterç¯å¢ƒ"></a>3.2.3 å®‰è£…jupyterç¯å¢ƒ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£… IPython äº¤äº’å¼ shell</span><br>(self-llm) root@controller01:/opt/installPkgs# pip install ipython<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ­£å¼å®‰è£…jupyter</span><br>(self-llm) root@controller01:/opt/installPkgs# apt install jupyter-core jupyter-notebook -qy<br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»ºç›®å½•</span><br>(self-llm) root@controller01:/opt/installPkgs# mkdir finetunning-bigmodles<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯åŠ¨jupyter notebook</span><br>(self-llm) root@controller01:/opt/installPkgs# jupyter notebook --allow-root --ip=0.0.0.0<br>[I 01:29:38.744 NotebookApp] Serving notebooks from local directory: /opt/installPkgs<br>[I 01:29:38.744 NotebookApp] The Jupyter Notebook is running at:<br>[I 01:29:38.744 NotebookApp] http://a10:8888/?token=96f565e66d149b1803474ff3bf7c15e43fbaf9cc59c192ba<br>[I 01:29:38.744 NotebookApp]  or http://127.0.0.1:8888/?token=96f565e66d149b1803474ff3bf7c15e43fbaf9cc59c192ba<br>[I 01:29:38.744 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).<br>[W 01:29:38.755 NotebookApp] No web browser found: could not locate runnable browser.<br>[C 01:29:38.756 NotebookApp] <br>    <br>    To access the notebook, open this file in a browser:<br>        file:///root/.local/share/jupyter/runtime/nbserver-41207-open.html<br>    Or copy and paste one of these URLs:<br>        http://a10:8888/?token=96f565e66d149b1803474ff3bf7c15e43fbaf9cc59c192ba<br>     or http://127.0.0.1:8888/?token=96f565e66d149b1803474ff3bf7c15e43fbaf9cc59c192ba<br>[I 01:29:53.755 NotebookApp] 302 GET /?token=96f565e66d149b1803474ff3bf7c15e43fbaf9cc59c192ba (192.168.254.84) 2.07ms<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†ä»¥ä¸‹urlä¸­çš„127.0.0.1æ¢æˆæœåŠ¡å™¨IPï¼Œå³å¯è®¿é—®ä¸Šè¿°åˆ›å»ºçš„jupyterç¯å¢ƒï¼Œæ¯”å¦‚å½“å‰å®‰è£…jupyterç¯å¢ƒçš„æœåŠ¡å™¨IPæ˜¯172.20.0.21ï¼Œåˆ™URLæ˜¯å¦‚ä¸‹</span><br>http://172.20.0.21:8888/?token=96f565e66d149b1803474ff3bf7c15e43fbaf9cc59c192ba<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æœ€åçš„å‚æ•°tokenç±»ä¼¼äºè®¿é—®çš„å¯†ç ã€‚è®¿é—®æˆåŠŸåç•Œé¢å¦‚ä¸‹ï¼Œjupyterç¯å¢ƒæ ¹ç›®å½•å°±æ˜¯æ‰§è¡Œâ€œjupyter notebook --allow-root --ip=0.0.0.0â€å‘½ä»¤çš„æ‰€åœ¨ç›®å½•/opt/installPkgsï¼Œä»¥ä¸‹æ˜¾ç¤ºäº†æ‰€åœ¨ç›®å½•/opt/installPkgsä¸‹çš„æ‰€æœ‰æ–‡ä»¶åŠæ–‡ä»¶å¤¹</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/17/pacKOlYbVuzrJqQ.png" alt="image-20250217093519584"></p><p>å¦‚æœè¦è‡ªå®šä¹‰jupyterçš„å®¶ç›®å½•åŠå…¶ä»–é…ç½®ï¼Œå¯ä»¥ä¿®æ”¹å®ƒçš„é…ç½®æ–‡ä»¶ï¼ˆé»˜è®¤å·²ç»åˆ›å»ºï¼š&#x2F;root&#x2F;.jupyter&#x2F;jupyter_notebook_config.pyï¼‰ï¼Œä»¥åæ¯æ¬¡å¯åŠ¨æ—¶ï¼Œå®ƒéƒ½æ˜¯ä¼˜å…ˆä½¿ç”¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­çš„é…ç½®é¡¹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">(self-llm) root@controller01:/opt/installPkgs/finetunning-bigmodles# vi /root/.jupyter/jupyter_notebook_config.py<br>...<br>931 # c.ServerApp.notebook_dir = &#x27;&#x27;<br>932 c.ServerApp.notebook_dir = &#x27;/opt/installPkgs/finetunning-bigmodles/&#x27;<br>...<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸Šè¿°æ–‡ä»¶åï¼Œéœ€è¦é‡æ–°å¯åŠ¨jupyterè¿›ç¨‹ï¼Œæ‰ä¼šç”Ÿæ•ˆã€‚</p><h3 id="3-2-4-æŠ¥é”™å¤„ç†"><a href="#3-2-4-æŠ¥é”™å¤„ç†" class="headerlink" title="3.2.4 æŠ¥é”™å¤„ç†"></a>3.2.4 æŠ¥é”™å¤„ç†</h3><h4 id="å¯åŠ¨jupyter-notebookæ—¶æŠ¥â€œFail-to-get-yarn-configurationâ€"><a href="#å¯åŠ¨jupyter-notebookæ—¶æŠ¥â€œFail-to-get-yarn-configurationâ€" class="headerlink" title="å¯åŠ¨jupyter notebookæ—¶æŠ¥â€œFail to get yarn configurationâ€"></a>å¯åŠ¨jupyter notebookæ—¶æŠ¥â€œFail to get yarn configurationâ€</h4><p>ä½†æ­¤é”™è¯¯å¹¶æœªä¸å½±å“jupyter notebookçš„ä½¿ç”¨</p><p><img src="https://s2.loli.net/2025/02/14/qQlTesIb7oC1YNW.png" alt="image-20250214175252854"></p><p>è§£å†³åŠæ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ–¹æ³•1ï¼šæ­¤æŠ¥é”™ä¸å½±å“jupyter notebookçš„ä½¿ç”¨ï¼Œæš‚æ—¶ä¸äºˆç†ä¼š</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ–¹æ³•2ï¼šéœ€è¦å‡çº§Nodeç‰ˆæœ¬ï¼ˆå…ˆå‰æ˜¯v10.19.6ï¼Œå‡çº§åˆ°v12.22.6å³å¯ï¼‰ã€‚å‚è€ƒï¼šhttps://discourse.jupyter.org/t/jupyter-lab-4-0-6-error-on-startup-about-yarn-configuration-and-worker-threads/21859</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨nvmå‡çº§nodejsç‰ˆæœ¬ï¼š</span><br>nvm install 12.22.6<br></code></pre></td></tr></table></figure><h1 id="å››ã€åœ¨-ipynbä¸­è¿›è¡Œå¾®è°ƒ"><a href="#å››ã€åœ¨-ipynbä¸­è¿›è¡Œå¾®è°ƒ" class="headerlink" title="å››ã€åœ¨.ipynbä¸­è¿›è¡Œå¾®è°ƒ"></a>å››ã€åœ¨.ipynbä¸­è¿›è¡Œå¾®è°ƒ</h1><h2 id="4-1-æ‰“å¼€ä¸€ä¸ªå·²ç»å­˜åœ¨çš„-ipynbæ–‡ä»¶"><a href="#4-1-æ‰“å¼€ä¸€ä¸ªå·²ç»å­˜åœ¨çš„-ipynbæ–‡ä»¶" class="headerlink" title="4.1 æ‰“å¼€ä¸€ä¸ªå·²ç»å­˜åœ¨çš„.ipynbæ–‡ä»¶"></a>4.1 æ‰“å¼€ä¸€ä¸ªå·²ç»å­˜åœ¨çš„.ipynbæ–‡ä»¶</h2><p>æ¯”å¦‚ä¸‹è½½<a href="https://github.com/jiangsanyin/unsloth-DeepSeek-R1-Distill-Llama-8B/blob/main/deepseekr1_8b%E6%9C%AC%E5%9C%B0%E5%BE%AE%E8%B0%83.ipynb">deepseekr1_8bæœ¬åœ°å¾®è°ƒ.ipynb</a> ï¼Œä¿å­˜åˆ°<code>/opt/installPkgs/finetunning-bigmodles</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:/opt/installPkgs/finetunning-bigmodles# ll<br>total 104<br>drwxr-xr-x  2 root root  4096 Feb 17 10:02 ./<br>drwxr-xr-x 12 root root  4096 Feb 17 09:48 ../<br>-rw-r--r--  1 root root 95152 Feb 17 09:46 deepseekr1_8bæœ¬åœ°å¾®è°ƒ.ipynb<br><br></code></pre></td></tr></table></figure><p>ç„¶åæŒ‰ç…§å¦‚ä¸‹æ–¹å¼ï¼Œåœ¨jupyterå›¾å½¢ç•Œé¢æ‰¾åˆ°ä¸Šè¿°æ–‡ä»¶å¹¶ä½¿ç”¨â€Notebookâ€æ‰“å¼€ï¼š</p><p><img src="https://s2.loli.net/2025/02/17/ACp5NZeaJiPuqFQ.png" alt="image-20250217100452758"></p><p>æ‰“å¼€åç•Œé¢å¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2025/02/17/KDAFQO4sftwLU7H.png" alt="image-20250217100932951"></p><h3 id="4-1-1-è®¾ç½®æ­¤-ipynbæ–‡ä»¶å¯ä¿¡"><a href="#4-1-1-è®¾ç½®æ­¤-ipynbæ–‡ä»¶å¯ä¿¡" class="headerlink" title="4.1.1 è®¾ç½®æ­¤.ipynbæ–‡ä»¶å¯ä¿¡"></a>4.1.1 è®¾ç½®æ­¤.ipynbæ–‡ä»¶å¯ä¿¡</h3><p><img src="https://s2.loli.net/2025/02/17/JKr4Pjd3HSI2RXy.png" alt="image-20250217101948104"></p><h3 id="4-1-2-ä¸º-ipynbæ–‡ä»¶é€‰æ‹©kernel"><a href="#4-1-2-ä¸º-ipynbæ–‡ä»¶é€‰æ‹©kernel" class="headerlink" title="4.1.2 ä¸º.ipynbæ–‡ä»¶é€‰æ‹©kernel"></a>4.1.2 ä¸º.ipynbæ–‡ä»¶é€‰æ‹©kernel</h3><p><img src="https://s2.loli.net/2025/02/17/nA4xkQ1DazvZSUW.png" alt="image-20250217110822311"></p><h3 id="4-1-3-è¿è¡Œæ­¤-ipynbæ–‡ä»¶"><a href="#4-1-3-è¿è¡Œæ­¤-ipynbæ–‡ä»¶" class="headerlink" title="4.1.3 è¿è¡Œæ­¤.ipynbæ–‡ä»¶"></a>4.1.3 è¿è¡Œæ­¤.ipynbæ–‡ä»¶</h3><p>ä¸Šè¿°æ–‡ä»¶<code>deepseekr1_8bæœ¬åœ°å¾®è°ƒ.ipynb</code>ä»ç½‘ä¸Šä¸‹è½½ä¸‹æ¥åï¼Œæœ‰äº›åœ°æ–¹éœ€è¦ä¿®æ”¹ä¸‹ï¼Œå¦åˆ™åœ¨æœªç¿»å¢™çš„æœåŠ¡å™¨ä¸Šè¿è¡Œä¼šå¤±è´¥æˆ–æ‰§è¡Œé€Ÿåº¦å¾ˆæ…¢ã€‚</p><p>ä»¥ä¸‹æœªåˆ—ä¸¾å‡ºæ¥çš„cellï¼Œä¸éœ€è¦ä¿®æ”¹ï¼Œç›´æ¥æ‰§è¡Œå³å¯ã€‚</p><h4 id="ç¬¬1ä¸ªcell-å®‰è£…unsloth"><a href="#ç¬¬1ä¸ªcell-å®‰è£…unsloth" class="headerlink" title="ç¬¬1ä¸ªcell-å®‰è£…unsloth"></a><strong>ç¬¬1ä¸ªcell</strong>-å®‰è£…unsloth</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">%</span><span class="language-bash">%capture</span><br>!pip install unsloth==2025.2.5 -i https://mirrors.aliyun.com/pypi/simple<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Also get the latest nightly Unsloth!</span><br>!pip install --force-reinstall --no-cache-dir --no-deps git+https://gitee.com/sy-jiang/unsloth.git -i https://mirrors.aliyun.com/pypi/simple<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸Šè¿°å‘½ä»¤ä¸­åˆä¼šå®‰è£…æœ€æ–°çš„unsloth 2025.2.12ï¼ˆåç»­ä½¿ç”¨ä¸­ä¼šæœ‰é—®é¢˜ï¼‰ï¼Œæ‰€ä»¥é‡æ–°å®‰è£…nsloth 2025.2.12</span><br>!pip install unsloth==2025.2.5 -i https://mirrors.aliyun.com/pypi/simple<br></code></pre></td></tr></table></figure><p>ç„¶åå…‰æ ‡é€‰ä¸­æ­¤cellï¼Œä½¿ç”¨ç»„åˆé”®â€œshift+enerâ€æˆ–ç‚¹å‡»å¦‚ä¸‹æŒ‰é’®ï¼Œå³å¯æ‰§è¡Œé€‰ä¸­çš„cell</p><p><img src="https://s2.loli.net/2025/02/17/HvOjDMkZ4KG7FAS.png" alt="image-20250217110958036"></p><p>ç¬¬ä¸€ä¸ªcellæ‰§è¡Œæ‰€éœ€è¦çš„æ—¶é—´è¾ƒé•¿ï¼Œå› ä¸ºå®‰è£…çš„pythonåº“è¾ƒå¤§ã€‚cellæ‰§è¡Œæœªç»“æœæ—¶ï¼Œå‰é¢ä¼šä¸€ç›´æœ‰ä¸ªâ€*â€</p><p><img src="https://s2.loli.net/2025/02/17/9XLU8GbwDToWsmr.png" alt="image-20250217111048204"></p><p>å½“å‰cellæ‰§è¡Œç»“æŸåï¼Œä¼šåœ¨å½“é¢æ‰€æœ‰æ‰§è¡Œcellæ¬¡æ•°çš„åŸºç¡€åŠ 1ï¼Œç»“æœæ˜¾ç¤ºåœ¨cellå·¦ä¸Šè§’ã€‚å¦‚ä¸‹å›¾ï¼Œè¿™æ˜¯è¿™ä¸ªé¡µé¢æ­¤cellç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œæ‰€ä»¥æ‰§è¡Œç»“æŸåï¼Œæ˜¾ç¤º1</p><p><img src="https://s2.loli.net/2025/02/17/1pZPTJlGaed78XB.png" alt="image-20250217111458869"></p><h4 id="ç¬¬3ä¸ªcell-å®‰è£…wandb"><a href="#ç¬¬3ä¸ªcell-å®‰è£…wandb" class="headerlink" title="ç¬¬3ä¸ªcell-å®‰è£…wandb"></a><strong>ç¬¬3ä¸ªcell</strong>-å®‰è£…wandb</h4><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-meta">#!pip install wandb</span><br>#ä¿®æ”¹æˆå¦‚ä¸‹ä»¥ä½¿ç”¨å›½å†…pipå®‰è£…æº<br>!pip install wandb -i https:<span class="hljs-comment">//mirrors.aliyun.com/pypi/simple</span><br></code></pre></td></tr></table></figure><h4 id="ç¬¬4ä¸ªcell-åˆå§‹åŒ–wandb"><a href="#ç¬¬4ä¸ªcell-åˆå§‹åŒ–wandb" class="headerlink" title="ç¬¬4ä¸ªcell-åˆå§‹åŒ–wandb"></a>ç¬¬4ä¸ªcell-åˆå§‹åŒ–wandb</h4><p>å¦‚ä¸‹é…ç½®çš„keyå°±æ˜¯åœ¨wandbå®˜ç½‘ç”³è¯·åè·å–çš„tokenï¼Œè¯·ä¿®æ”¹æˆè‡ªå·±çš„tokenwanb token</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># è¿™é‡Œä¸ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œç›´æ¥å¡«å…¥wandbçš„token,å¦‚æœæ²¡æœ‰tokenå¯ä»¥å»å®˜ç½‘ä¸‹è½½ä¸€ä¸ª</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># ä¸ºäº†å®‰å…¨ï¼Œæˆ‘æ­¤å¤„åªç²˜è´´äº†è‡ªå·±tokençš„å‰éƒ¨åˆ†å†…å®¹</span></span><br>import wandb<br><br>wandb.login(key=&quot;b11f575fd0f6c8cae0cb016b24&quot;)<br>run = wandb.init(<br>    project=&#x27;my fint-tune on deepseek r1 with medical data&#x27;,<br>    job_type=&quot;training&quot;,<br>    anonymous=&quot;allow&quot;<br>)<br></code></pre></td></tr></table></figure><p>å¦‚æœä¸Šè¿°cellå†…å®¹è¿è¡Œä¸æˆåŠŸï¼Œåˆ™é‡‡ç”¨å¦‚ä¸‹æ–¹æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">1)é¦–å…ˆåœ¨self-llmè¿™ä¸ªè™šæ‹Ÿæœºpythonç¯å¢ƒç™»å½•åˆ°wandb.aiï¼ŒæˆåŠŸåä¼šå°†ç›¸å…³ä¿¡æ¯ä¿å­˜åœ¨/root/.netrc</span><br>(self-llm) root@controller01:/opt/installPkgs/finetunning-bigmodles# wandb login --relogin<br>wandb: Logging into wandb.ai. (Learn how to deploy a W&amp;B server locally: https://wandb.me/wandb-server)<br>wandb: You can find your API key in your browser here: https://wandb.ai/authorize<br>wandb: Paste an API key from your profile and hit enter, or press ctrl+c to quit: <br>wandb: Appending key for api.wandb.ai to your netrc file: /root/.netrc<br>wandb: W&amp;B API key is configured. Use `wandb login --relogin` to force relogin<br>(self-llm) root@controller01:/opt/installPkgs/finetunning-bigmodles# <br>(self-llm) root@controller01:/opt/installPkgs/finetunning-bigmodles# vi /root/.netrc <br>(self-llm) root@controller01:/opt/installPkgs/finetunning-bigmodles# <br>(self-llm) root@controller01:/opt/installPkgs/finetunning-bigmodles# cat /root/.netrc   <br>machine api.wandb.ai<br>  login user<br>  password b11f575fd0f6c8cae0cb016b24<br><span class="hljs-meta prompt_">  </span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">2)ä¿®æ”¹ä¸Šè¿°cellå†…å®¹ä¸ºå¦‚ä¸‹ï¼Œç„¶åé‡æ–°æ‰§è¡Œæ­¤cell</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># è¿™é‡Œä¸ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œç›´æ¥å¡«å…¥wandbçš„token,å¦‚æœæ²¡æœ‰tokenå¯ä»¥å»å®˜ç½‘ä¸‹è½½ä¸€ä¸ª</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># åŒæ—¶wandb.initæ—¶é»˜è®¤è¶…æ—¶æ—¶é—´æ˜¯90sï¼Œå› ä¸ºç½‘ç«™æ˜¯å›½å¤–ç½‘ç«™å¯èƒ½ç»å¸¸å‡ºç°initè¶…è¿‡90sçš„ç°è±¡ï¼Œæ‰€ä»¥å¢åŠ è¶…æ—¶æ—¶é—´ä¸º300s</span></span><br>import wandb<br>import os<br><span class="hljs-meta prompt_">#</span><span class="language-bash">os.environ[<span class="hljs-string">&quot;WANDB_API_KEY&quot;</span>] = <span class="hljs-string">&#x27;b11f575fd0f6c8cae0cb016b24&#x27;</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#os.environ[&quot;WANDB_MODE&quot;] = &quot;offline&quot;</span></span><br>os.environ[&#x27;WANDB_INIT_TIMEOUT&#x27;] = &#x27;1200&#x27;  #Increase timeout settings<br>os.environ[&#x27;WANDB_DEBUG&#x27;] = &quot;true&quot;           #Enable debugging<br><span class="hljs-meta prompt_">#</span><span class="language-bash">wandb.login(key=<span class="hljs-string">&quot;b11f575fd0f6c8cae0cb016b24&quot;</span>)</span><br>run = wandb.init(<br>    project=&#x27;my fint-tune on deepseek r1 with medical data&#x27;,<br>    job_type=&quot;training&quot;,<br>    anonymous=&quot;allow&quot;,<br>    settings=wandb.Settings(init_timeout=1200)<br>)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">3)æ‰§è¡ŒæˆåŠŸæ—¶ï¼Œè¾“å‡ºå¦‚ä¸‹</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/18/gac186mtlIDJnZu.png" alt="image-20250218100844293"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">4)ä¹‹åæŒ‰ç…§ä¸Šè¿°è¾“å‡ºçš„å†…å®¹ï¼ŒæŸ¥çœ‹wandb.aiç½‘ç«™ä¸­è‡ªå·±çš„ä¸»é¡µï¼Œçœ‹åˆ°å¦‚ä¸‹ç±»ä¼¼å†…å®¹ã€‚ä¹‹åå¾€åæ‰§è¡Œä¸‹ä¸€ä¸ªcell</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/18/TCQhspmOINxR2ri.png" alt="image-20250218101102349"></p><h4 id="ç¬¬5ä¸ªcell-åŠ è½½æ¨¡å‹æ–‡ä»¶-åˆ›å»ºmodelå®ä¾‹"><a href="#ç¬¬5ä¸ªcell-åŠ è½½æ¨¡å‹æ–‡ä»¶-åˆ›å»ºmodelå®ä¾‹" class="headerlink" title="ç¬¬5ä¸ªcell-åŠ è½½æ¨¡å‹æ–‡ä»¶&#x2F;åˆ›å»ºmodelå®ä¾‹"></a>ç¬¬5ä¸ªcell-åŠ è½½æ¨¡å‹æ–‡ä»¶&#x2F;åˆ›å»ºmodelå®ä¾‹</h4><p>æ­¤celléœ€è¦ä¿è¯ä½ çš„æœåŠ¡å™¨ä¸Šæœ‰NVIDIA GPUã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯NVIDIA A40ï¼Œå®ƒæœ‰44Gå·¦å³æ˜¾å­˜</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">model, tokenizer = FastLanguageModel.from_pretrained(<br>    model_name = &quot;/opt/code_repos/AI_models/unsloth-DeepSeek-R1-Distill-Llama-8B&quot;, # è¿™é‡Œæ”¹æˆä½ æœ¬åœ°æ¨¡å‹ï¼Œä»¥æˆ‘çš„ä¸ºä¾‹ï¼Œæˆ‘å·²ç»huggingfaceä¸Šçš„æ¨¡å‹æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ã€‚<br>    max_seq_length = max_seq_length,<br>    dtype = dtype,<br>    load_in_4bit = load_in_4bit,<br>)<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/17/z2x8lfMR4iL75X6.png" alt="image-20250217152019243"></p><h4 id="ç¬¬6ä¸ç¬¬7ä¸ªcell-å¾®è°ƒå‰æ‰§è¡Œæ¨ç†"><a href="#ç¬¬6ä¸ç¬¬7ä¸ªcell-å¾®è°ƒå‰æ‰§è¡Œæ¨ç†" class="headerlink" title="ç¬¬6ä¸ç¬¬7ä¸ªcell-å¾®è°ƒå‰æ‰§è¡Œæ¨ç†"></a>ç¬¬6ä¸ç¬¬7ä¸ªcell-å¾®è°ƒå‰æ‰§è¡Œæ¨ç†</h4><p>ç¬¬6ä¸ªcellæä¾›ä¸­è‹±æ–‡ä¸¤ç§å½¢å¼çš„é—®é¢˜ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">question = <span class="hljs-string">&quot;A 61-year-old woman with a long history of involuntary urine loss during activities like coughing or sneezing but no leakage at night undergoes a gynecological exam and Q-tip test. Based on these findings, what would cystometry most likely reveal about her residual volume and detrusor contractions?&quot;</span></span><br>question = &quot;ä¸€å61å²å¥³æ€§ï¼Œé•¿æœŸåœ¨å’³å—½æˆ–æ‰“å–·åšç­‰æ´»åŠ¨æ—¶ä¸è‡ªè§‰æ’å°¿ï¼Œä½†å¤œé—´æ— æ¼å°¿ï¼Œç°æ¥å—å¦‡ç§‘æ£€æŸ¥å’ŒQ-tipæ£€æŸ¥ã€‚åŸºäºè¿™äº›å‘ç°ï¼Œè†€èƒ±é€ ç˜˜æœ¯æœ€æœ‰å¯èƒ½æ­ç¤ºå¥¹çš„æ®‹ä½™å®¹é‡å’Œé€¼å°¿è‚Œæ”¶ç¼©æƒ…å†µï¼Ÿ&quot;<br><br><br>FastLanguageModel.for_inference(model)  # Unsloth has 2x faster inference!<br>inputs = tokenizer([prompt_style.format(question, &quot;&quot;)], return_tensors=&quot;pt&quot;).to(&quot;cuda&quot;)<br><br>outputs = model.generate(<br>    input_ids=inputs.input_ids,<br>    attention_mask=inputs.attention_mask,<br>    max_new_tokens=1200,<br>    use_cache=True,<br>)<br>response = tokenizer.batch_decode(outputs)<br>print(response[0].split(&quot;### Response:&quot;)[1])<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œæ—¶ï¼Œè¾“å‡ºå†…å®¹å¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2025/02/17/oyNrqQCiWLxwVBA.png" alt="image-20250217170314515"></p><h4 id="ç¬¬8ä¸ªcell-åˆ›å»ºæ¡†æ¶modelå®ä¾‹"><a href="#ç¬¬8ä¸ªcell-åˆ›å»ºæ¡†æ¶modelå®ä¾‹" class="headerlink" title="ç¬¬8ä¸ªcell-åˆ›å»ºæ¡†æ¶modelå®ä¾‹"></a>ç¬¬8ä¸ªcell-åˆ›å»ºæ¡†æ¶modelå®ä¾‹</h4><p>è¿™ä¸ªcellçš„å†…å®¹æ— éœ€ä¿®æ”¹ã€‚å®ƒä½¿ç”¨çš„loraæ¡†æ¶ä¸­ä½ç§©çŸ©é˜µçš„æ–¹æ³•å¯¹æ¨¡å‹è¿›è¡Œå¿«é€Ÿæœ‰æ•ˆå¾®è°ƒã€‚ï¼ˆéœ€è¦å¯¹loraæ¡†æ¶çŸ¥è¯†è¿›è¡Œå­¦ä¹ ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell">model = FastLanguageModel.get_peft_model(<br>    model,<br>    r=16,<br>    target_modules=[<br>        &quot;q_proj&quot;,<br>        &quot;k_proj&quot;,<br>        &quot;v_proj&quot;,<br>        &quot;o_proj&quot;,<br>        &quot;gate_proj&quot;,<br>        &quot;up_proj&quot;,<br>        &quot;down_proj&quot;,<br>    ],<br>    lora_alpha=16,<br>    lora_dropout=0,<br>    bias=&quot;none&quot;,<br>    use_gradient_checkpointing=&quot;unsloth&quot;,  # True or &quot;unsloth&quot; for very long context<br>    random_state=3407,<br>    use_rslora=False,<br>    loftq_config=None,<br>)<br></code></pre></td></tr></table></figure><h4 id="ç¬¬9ä¸ç¬¬10ä¸ªcell-æ•°æ®é›†è§„æ•´åŒ–å‡†å¤‡"><a href="#ç¬¬9ä¸ç¬¬10ä¸ªcell-æ•°æ®é›†è§„æ•´åŒ–å‡†å¤‡" class="headerlink" title="ç¬¬9ä¸ç¬¬10ä¸ªcell-æ•°æ®é›†è§„æ•´åŒ–å‡†å¤‡"></a>ç¬¬9ä¸ç¬¬10ä¸ªcell-æ•°æ®é›†è§„æ•´åŒ–å‡†å¤‡</h4><p>é¢„å¤„ç†æ•°æ®é›†ï¼Œå¯¹æ•°æ®é›†è¿›è¡Œè§„æ•´ã€‚è§„æ•´æˆç¬¬9ä¸ªcellä¸­æ ·å¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">train_prompt_style = &quot;&quot;&quot;Below is an instruction that describes a task, paired with an input that provides further context.<br>Write a response that appropriately completes the request.<br>Before answering, think carefully about the question and create a step-by-step chain of thoughts to ensure a logical and accurate response.<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">## Instruction:</span></span><br>You are a medical expert with advanced knowledge in clinical reasoning, diagnostics, and treatment planning.<br>Please answer the following medical question.<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">## Question:</span></span><br>&#123;&#125;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">## Response:</span></span><br>&lt;think&gt;<br>&#123;&#125;<br>&lt;/think&gt;<br>&#123;&#125;&quot;&quot;&quot;<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨å¦‚ä¸‹ç¬¬10ä¸ªcellä¸­å¦‚ä¸‹å‡½æ•°å¯¹æ•°æ®é›†è¿›è¡Œè§„æ•´ï¼Œå°†é—®é¢˜ã€æ€ç»´é“¾ä¸å›ç­”å¡«å……åˆ°ä¸Šè¿°promptä¸­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">EOS_TOKEN = tokenizer.eos_token  # Must add EOS_TOKEN<br><br><br>def formatting_prompts_func(examples):<br>    inputs = examples[&quot;Question&quot;]<br>    cots = examples[&quot;Complex_CoT&quot;]<br>    outputs = examples[&quot;Response&quot;]<br>    texts = []<br>    for input, cot, output in zip(inputs, cots, outputs):<br>        text = train_prompt_style.format(input, cot, output) + EOS_TOKEN<br>        texts.append(text)<br>    return &#123;<br>        &quot;text&quot;: texts,<br>    &#125;<br><br></code></pre></td></tr></table></figure><h4 id="ç¬¬11ä¸ªcell-åŠ è½½dataset"><a href="#ç¬¬11ä¸ªcell-åŠ è½½dataset" class="headerlink" title="ç¬¬11ä¸ªcell-åŠ è½½dataset"></a>ç¬¬11ä¸ªcell-åŠ è½½dataset</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">from datasets import load_dataset<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">load_datasetæ–¹æ³•è°ƒç”¨çš„ç¬¬1ä¸ªå‚æ•°ï¼ˆæ•°æ®é›†ç›®å½•ï¼‰ã€ç¬¬2ä¸ªå‚æ•°ï¼ˆä½¿ç”¨æ•°æ®é›†ä¸­å“ªç§è¯­è¨€.cnè¡¨ç¤ºè‹±æ–‡ï¼Œzhè¡¨ç¤ºä¸­æ–‡ï¼‰ã€‚å…¶ä½™ä¸å˜ï¼ˆç¬¬3ä¸ªå‚æ•°è¡¨ç¤ºä½¿ç”¨å‰500æ¡æ•°æ®ï¼‰</span><br>dataset = load_dataset(&quot;/opt/code_repos/AI_datasets/AI-ModelScope---medical-o1-reasoning-SFT&quot;, &quot;zh&quot;,split = &quot;train[0:500]&quot;) # è¿™é‡ŒåŒæ ·å»huggingfaceä¸Šé¢ä¸‹è½½æ•°æ®é›†ï¼Œç„¶åæ”¾åˆ°æœ¬åœ°<br>dataset = dataset.map(formatting_prompts_func, batched = True,)<br>dataset[&quot;text&quot;][0]<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œä¸Šè¿°cellå‰ï¼Œè¿˜éœ€è¦åšå¦‚ä¸‹æ“ä½œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å¤‡ä»½unsloth-DeepSeek-R1-Distill-Llama-8Bçš„README.mdæ–‡ä»¶</span><br>root@controller01:/opt/code_repos/AI_models/unsloth-DeepSeek-R1-Distill-Llama-8B# mv README.md unsloth-DeepSeek-R1-Distill-Llama-8B---README.md <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†æ•°æ®é›†AI-ModelScope---medical-o1-reasoning-SFTä¸‹é¢*.jsonä¸README.mdæ–‡ä»¶å¤åˆ¶åˆ°ä¸Šè¿°ç›®å½•ä¸‹</span><br>root@controller01:/opt/code_repos/AI_models/unsloth-DeepSeek-R1-Distill-Llama-8B# cp -p /opt/code_repos/AI_datasets/AI-ModelScope---medical-o1-reasoning-SFT/*.json ./<br>root@controller01:/opt/code_repos/AI_models/unsloth-DeepSeek-R1-Distill-Llama-8B# cp -p /opt/code_repos/AI_datasets/AI-ModelScope---medical-o1-reasoning-SFT/README.md ./<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ­¤æ—¶æ‰€æœ‰æ–‡ä»¶</span><br>root@controller01:/opt/code_repos/AI_models/unsloth-DeepSeek-R1-Distill-Llama-8B# ls -alh<br>total 16G<br>drwxr-xr-x 3 root root 4.0K Feb 17 16:21 .<br>drwxr-xr-x 6 root root 4.0K Feb 14 10:49 ..<br>-rw-r--r-- 1 root root  959 Feb 13 17:59 config.json<br>-rw-r--r-- 1 root root   73 Feb 13 17:59 configuration.json<br>-rw-r--r-- 1 root root  236 Feb 13 17:59 generation_config.json<br>-rw-r--r-- 1 root root  62M Feb 13 21:36 medical_o1_sft_Chinese.json<br>-rw-r--r-- 1 root root  71M Feb 13 21:36 medical_o1_sft.json<br>-rw-r--r-- 1 root root 4.7G Feb 13 19:11 model-00001-of-00004.safetensors<br>-rw-r--r-- 1 root root 4.7G Feb 13 19:02 model-00002-of-00004.safetensors<br>-rw-r--r-- 1 root root 4.6G Feb 13 19:10 model-00003-of-00004.safetensors<br>-rw-r--r-- 1 root root 1.1G Feb 13 18:17 model-00004-of-00004.safetensors<br>-rw-r--r-- 1 root root  24K Feb 13 17:59 model.safetensors.index.json<br>-rw------- 1 root root  952 Feb 13 19:11 .msc<br>-rw-r--r-- 1 root root   36 Feb 13 19:11 .mv<br>-rw-r--r-- 1 root root 1.3K Feb 13 21:36 README.md<br>-rw-r--r-- 1 root root  483 Feb 13 17:59 special_tokens_map.json<br>drwxr-xr-x 2 root root 4.0K Feb 13 19:11 ._____temp<br>-rw-r--r-- 1 root root  52K Feb 13 17:59 tokenizer_config.json<br>-rw-r--r-- 1 root root  17M Feb 13 18:00 tokenizer.json<br>-rw-r--r-- 1 root root  16K Feb 13 17:59 unsloth-DeepSeek-R1-Distill-Llama-8B---README.md<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œä¸Šè¿°cellï¼Œè¾“å‡ºå†…å®¹å¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2025/02/17/TSfnkEKOji5szyl.png" alt="image-20250217162802449"></p><h4 id="ç¬¬12ä¸ªcell-åˆ›å»ºSFTTrainerå®ä¾‹"><a href="#ç¬¬12ä¸ªcell-åˆ›å»ºSFTTrainerå®ä¾‹" class="headerlink" title="ç¬¬12ä¸ªcell-åˆ›å»ºSFTTrainerå®ä¾‹"></a>ç¬¬12ä¸ªcell-åˆ›å»ºSFTTrainerå®ä¾‹</h4><p>ä½¿ç”¨trlè¿™ä¸ªpythonåº“æ¥è¿›è¡Œè®­ç»ƒï¼ˆå¾®è°ƒï¼‰ã€‚</p><p>TrainingArguments(â€¦)ä¸­æœ‰å¾ˆå¤šå‚æ•°ï¼Œå®ƒä»¬æ˜¯è®­ç»ƒï¼ˆæ­¤å¤„æ˜¯æ·±åº¦å­¦ä¹ ï¼‰æ—¶ç”¨åˆ°çš„å‚æ•°ã€‚å…¶ä¸­æœ€åä¸€ä¸ªå‚æ•°output_dirå®šä¹‰è¾“å‡ºçš„checkpointçš„è¾“å‡ºç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs shell">from trl import SFTTrainer<br>from transformers import TrainingArguments<br>from unsloth import is_bfloat16_supported<br><br>trainer = SFTTrainer(<br>    model=model,<br>    tokenizer=tokenizer,<br>    train_dataset=dataset,<br>    dataset_text_field=&quot;text&quot;,<br>    max_seq_length=max_seq_length,<br>    dataset_num_proc=2,<br>    args=TrainingArguments(<br>        per_device_train_batch_size=2,<br>        gradient_accumulation_steps=4,<br>        # Use num_train_epochs = 1, warmup_ratio for full training runs!<br>        warmup_steps=5,<br>        max_steps=60,<br>        learning_rate=2e-4,<br>        fp16=not is_bfloat16_supported(),<br>        bf16=is_bfloat16_supported(),<br>        logging_steps=10,<br>        optim=&quot;adamw_8bit&quot;,<br>        weight_decay=0.01,<br>        lr_scheduler_type=&quot;linear&quot;,<br>        seed=3407,<br>        output_dir=&quot;outputs&quot;,<br>    ),<br>)<br></code></pre></td></tr></table></figure><h4 id="ç¬¬13ä¸ªcell-Model-training"><a href="#ç¬¬13ä¸ªcell-Model-training" class="headerlink" title="ç¬¬13ä¸ªcell-Model training"></a>ç¬¬13ä¸ªcell-Model training</h4><p>æ­¤cellå¶å°”ä¼šå‡ºç°è¿è¡Œå¤±è´¥çš„é—®é¢˜ï¼Œæç¤ºã€failed to upsert bucket: returned error 401 Unauthorized: {â€œerrorsâ€:[{â€œmessageâ€:â€user is not logged inâ€â€¦ã€‘è¿™æ ·çš„ä¿¡æ¯ï¼Œé‡å¤è¿è¡Œè¯•è¯•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">trainer_stats = trainer.train()<br></code></pre></td></tr></table></figure><p>æ­¤cellæ­£å¸¸è¿è¡Œè¿‡ç¨‹ä¸­è¾“å‡ºå¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2025/02/18/mXcTxGyh8iYzQHS.png" alt="image-20250218101724006"></p><p>æ­¤cellæ­£å¸¸ç»“æŸå¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2025/02/18/LnV3JCvGxXrD6se.png" alt="image-20250218102147794"></p><h4 id="ç¬¬14ä¸ªcell-ä¿å­˜å¾®è°ƒæ¨¡å‹"><a href="#ç¬¬14ä¸ªcell-ä¿å­˜å¾®è°ƒæ¨¡å‹" class="headerlink" title="ç¬¬14ä¸ªcell-ä¿å­˜å¾®è°ƒæ¨¡å‹"></a>ç¬¬14ä¸ªcell-ä¿å­˜å¾®è°ƒæ¨¡å‹</h4><p>cellå†…å®¹æ— éœ€ä¿®æ”¹ã€‚æ‰§è¡Œåï¼Œè¾“å‡ºå¦‚æœå¦‚ä¸‹ã€‚</p><p><img src="https://s2.loli.net/2025/02/18/fp8cOs7QYrxCVz3.png" alt="image-20250218102321298"></p><p>æ­¤æ—¶åœ¨wandb.aiç½‘ç«™ä¸­æŸ¥çœ‹å¯¹åº”projectçš„è¿è¡Œæƒ…å†µï¼Œå‘ç°çŠ¶æ€å·²ç»æ˜¯Finishedï¼š</p><p><img src="https://s2.loli.net/2025/02/18/SEr27bQL3MVWYDd.png" alt="image-20250218102558319"></p><p>ç‚¹å‡»projectåå­—ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹è¯¦ç»†ä¿¡æ¯ï¼š</p><p><img src="https://s2.loli.net/2025/02/18/SJ1XaUf2Gecx4Im.png" alt="image-20250218102633733"></p><h4 id="ç¬¬15ä¸ªcell-å¾®è°ƒåæ‰§è¡Œæ¨ç†"><a href="#ç¬¬15ä¸ªcell-å¾®è°ƒåæ‰§è¡Œæ¨ç†" class="headerlink" title="ç¬¬15ä¸ªcell-å¾®è°ƒåæ‰§è¡Œæ¨ç†"></a>ç¬¬15ä¸ªcell-å¾®è°ƒåæ‰§è¡Œæ¨ç†</h4><p>ä»…ä»…å°†é—®é¢˜ä»è‹±æ–‡å½¢å¼æ¢æˆä¸­æ–‡å½¢å¼ã€‚å…¶ä½™å†…å®¹ä¸å˜</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">question = <span class="hljs-string">&quot;A 61-year-old woman with a long history of involuntary urine loss during activities like coughing or sneezing but no leakage at night undergoes a gynecological exam and Q-tip test. Based on these findings, what would cystometry most likely reveal about her residual volume and detrusor contractions?&quot;</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##ä»…ä»…å°†é—®é¢˜ä»è‹±æ–‡å½¢å¼æ¢æˆä¸­æ–‡å½¢å¼ã€‚å…¶ä½™å†…å®¹ä¸å˜</span></span><br>question = &quot;ä¸€å61å²å¥³æ€§ï¼Œé•¿æœŸåœ¨å’³å—½æˆ–æ‰“å–·åšç­‰æ´»åŠ¨æ—¶ä¸è‡ªè§‰æ’å°¿ï¼Œä½†å¤œé—´æ— æ¼å°¿ï¼Œç°æ¥å—å¦‡ç§‘æ£€æŸ¥å’ŒQ-tipæ£€æŸ¥ã€‚åŸºäºè¿™äº›å‘ç°ï¼Œè†€èƒ±é€ ç˜˜æœ¯æœ€æœ‰å¯èƒ½æ­ç¤ºå¥¹çš„æ®‹ä½™å®¹é‡å’Œé€¼å°¿è‚Œæ”¶ç¼©æƒ…å†µï¼Ÿ&quot;<br><br>FastLanguageModel.for_inference(model)  # Unsloth has 2x faster inference!<br>inputs = tokenizer([prompt_style.format(question, &quot;&quot;)], return_tensors=&quot;pt&quot;).to(&quot;cuda&quot;)<br><br>outputs = model.generate(<br>    input_ids=inputs.input_ids,<br>    attention_mask=inputs.attention_mask,<br>    max_new_tokens=1200,<br>    use_cache=True,<br>)<br>response = tokenizer.batch_decode(outputs)<br>print(response[0].split(&quot;### Response:&quot;)[1])<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œåï¼Œè¾“å‡ºå†…å®¹å¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2025/02/18/KdSrm9CYI7xTJcg.png" alt="image-20250218103431363"></p><p>ä»¥ä¸‹æ˜¯å¾®è°ƒå‰åæ¨ç†çš„æ€ç»´é“¾ä¸ç»“æœæ¯”è¾ƒï¼ˆå¯ä»¥çœ‹åˆ°å¾®è°ƒåç»“æœç²¾ç®€å‡†ç¡®ä¸€äº›ï¼‰ï¼š</p><p><img src="https://s2.loli.net/2025/02/18/oECSlrJxPam3RGV.png" alt="image-20250218103525077"></p><h4 id="ç¬¬16ä¸ªcell-å¾®è°ƒåå…¶ä»–é—®é¢˜æ¨ç†"><a href="#ç¬¬16ä¸ªcell-å¾®è°ƒåå…¶ä»–é—®é¢˜æ¨ç†" class="headerlink" title="ç¬¬16ä¸ªcell-å¾®è°ƒåå…¶ä»–é—®é¢˜æ¨ç†"></a>ç¬¬16ä¸ªcell-å¾®è°ƒåå…¶ä»–é—®é¢˜æ¨ç†</h4><p>ç¬¬6ä¸ªcellæä¾›ä¸­è‹±æ–‡ä¸¤ç§å½¢å¼çš„é—®é¢˜ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">question = <span class="hljs-string">&quot;A 59-year-old man presents with a fever, chills, night sweats, and generalized fatigue, and is found to have a 12 mm vegetation on the aortic valve. Blood cultures indicate gram-positive, catalase-negative, gamma-hemolytic cocci in chains that do not grow in a 6.5% NaCl medium. What is the most likely predisposing factor for this patient&#x27;s condition?&quot;</span></span><br>question = &quot;59å²ç”·æ€§ï¼Œå‘çƒ­ï¼Œå¯’é¢¤ï¼Œç›—æ±—ï¼Œå…¨èº«ç–²åŠ³ï¼Œä¸»åŠ¨è„‰ç“£ä¸Šæœ‰12æ¯«ç±³çš„èµ˜ç”Ÿç‰©ã€‚è¡€æ¶²åŸ¹å…»æ˜¾ç¤ºé©å…°æ°é˜³æ€§ï¼Œè¿‡æ°§åŒ–æ°¢é…¶é˜´æ€§ï¼ŒÎ³ -æº¶è¡€æ€§çƒèŒé“¾ï¼Œä¸èƒ½åœ¨6.5%çš„NaClåŸ¹å…»åŸºä¸­ç”Ÿé•¿ã€‚è¿™ä¸ªç—…äººçš„ç—…æƒ…æœ€æœ‰å¯èƒ½çš„è¯±å‘å› ç´ æ˜¯ä»€ä¹ˆï¼Ÿ&quot;<br><br>inputs = tokenizer([prompt_style.format(question, &quot;&quot;)], return_tensors=&quot;pt&quot;).to(&quot;cuda&quot;)<br><br>outputs = model.generate(<br>    input_ids=inputs.input_ids,<br>    attention_mask=inputs.attention_mask,<br>    max_new_tokens=1200,<br>    use_cache=True,<br>)<br>response = tokenizer.batch_decode(outputs)<br>print(response[0].split(&quot;### Response:&quot;)[1])<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2025/02/18/OAoxhREBX45DvHi.png" alt="image-20250218104828178"></p><h4 id="ç¬¬17ä¸ªcell-ä¿å­˜æ¨¡å‹æƒé‡æ–‡ä»¶ç­‰åˆ°æœ¬åœ°"><a href="#ç¬¬17ä¸ªcell-ä¿å­˜æ¨¡å‹æƒé‡æ–‡ä»¶ç­‰åˆ°æœ¬åœ°" class="headerlink" title="ç¬¬17ä¸ªcell-ä¿å­˜æ¨¡å‹æƒé‡æ–‡ä»¶ç­‰åˆ°æœ¬åœ°"></a>ç¬¬17ä¸ªcell-ä¿å­˜æ¨¡å‹æƒé‡æ–‡ä»¶ç­‰åˆ°æœ¬åœ°</h4><p>cellå†…å®¹æ— éœ€ä¿®æ”¹ï¼Œç›´æ¥æ‰§è¡Œã€‚è¾“å‡ºå¦‚ä¸‹å›¾</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">new_model_online = <span class="hljs-string">&quot;kingabzpro/DeepSeek-R1-Medical-COT&quot;</span></span><br>new_model_local = &quot;DeepSeek-R1-Medical-COT&quot;<br>model.save_pretrained(new_model_local) # Local saving<br>tokenizer.save_pretrained(new_model_local)<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/18/jR7BLXGMQWYw5fb.png" alt="image-20250218105536427"></p><p>åŒæ—¶ä¼šåœ¨jupyteræ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªâ€DeepSeek-R1-Medical-COTâ€œç›®å½•ï¼Œå…¶ä¸­å†…å®¹å¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2025/02/18/l8cP9d3pRemtzQT.png" alt="image-20250218105707008"></p><h4 id="ç¬¬18ä¸ç¬¬19ä¸ªcell-æŠŠæ¨¡å‹å‘å¸ƒåˆ°huggingface"><a href="#ç¬¬18ä¸ç¬¬19ä¸ªcell-æŠŠæ¨¡å‹å‘å¸ƒåˆ°huggingface" class="headerlink" title="ç¬¬18ä¸ç¬¬19ä¸ªcell-æŠŠæ¨¡å‹å‘å¸ƒåˆ°huggingface"></a>ç¬¬18ä¸ç¬¬19ä¸ªcell-æŠŠæ¨¡å‹å‘å¸ƒåˆ°huggingface</h4><p>huggingfaceéœ€è¦ç¿»å¢™è®¿é—®ï¼Œçœç•¥ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">model.push_to_hub(new_model_online) # Online saving<br>tokenizer.push_to_hub(new_model_online) # Online saving<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">----------------</span><br>model.save_pretrained_merged(new_model_local, tokenizer, save_method = &quot;merged_16bit&quot;,)<br>model.push_to_hub_merged(new_model_online, tokenizer, save_method = &quot;merged_16bit&quot;)<br></code></pre></td></tr></table></figure><h2 id="4-2-åˆ›å»ºä¸€ä¸ªæ–°çš„-ipynbæ–‡ä»¶"><a href="#4-2-åˆ›å»ºä¸€ä¸ªæ–°çš„-ipynbæ–‡ä»¶" class="headerlink" title="4.2 åˆ›å»ºä¸€ä¸ªæ–°çš„.ipynbæ–‡ä»¶"></a>4.2 åˆ›å»ºä¸€ä¸ªæ–°çš„.ipynbæ–‡ä»¶</h2><p><img src="https://s2.loli.net/2025/02/17/ltvbC9sAd4gLKwx.png" alt="image-20250217093919718"></p><p><img src="https://s2.loli.net/2025/02/17/TGyioRtsJHe9wm7.png" alt="image-20250217094028950"></p><p>é‡å‘½åï¼š</p><p><img src="https://s2.loli.net/2025/02/18/qcfBh1Jbox2kjev.png" alt="image-20250218110117175"></p><h2 id="4-3-æŸ¥çœ‹å¿«æ·é”®"><a href="#4-3-æŸ¥çœ‹å¿«æ·é”®" class="headerlink" title="4.3 æŸ¥çœ‹å¿«æ·é”®"></a>4.3 æŸ¥çœ‹å¿«æ·é”®</h2><p><img src="https://s2.loli.net/2025/02/18/Hgx4iydTONfpkbv.png" alt="image-20250218110248372"></p><h1 id="äº”ã€å‚è€ƒèµ„æ–™"><a href="#äº”ã€å‚è€ƒèµ„æ–™" class="headerlink" title="äº”ã€å‚è€ƒèµ„æ–™"></a>äº”ã€å‚è€ƒèµ„æ–™</h1><p>å‚è€ƒæ•™å­¦è§†é¢‘ï¼š<a href="https://www.bilibili.com/video/BV1rSNmekEa7?spm_id_from=333.788.videopod.sections&vd_source=0b5fe5d5aa31f64bf7462d1d094b70a2">å¦‚ä½•åœ¨æœ¬åœ°å¾®è°ƒDeepSeek-R1-8bæ¨¡å‹</a></p>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¾®è°ƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2025å¹´3æœˆ2æ—¥é•¿æ²™å¸‚æœ›æœˆå…¬å›­éšæ‹</title>
    <link href="/2025/03/02/2025%E5%B9%B43%E6%9C%882%E6%97%A5%E9%95%BF%E6%B2%99%E5%B8%82%E6%9C%9B%E6%9C%88%E5%85%AC%E5%9B%AD%E9%9A%8F%E6%8B%8D/"/>
    <url>/2025/03/02/2025%E5%B9%B43%E6%9C%882%E6%97%A5%E9%95%BF%E6%B2%99%E5%B8%82%E6%9C%9B%E6%9C%88%E5%85%AC%E5%9B%AD%E9%9A%8F%E6%8B%8D/</url>
    
    <content type="html"><![CDATA[<p>2025å¹´3æœˆ2æ—¥ï¼Œä»Šå¤©ç™½å¤©å¤©æ°”ä¸é”™ã€‚ä»Šå¤©å‘ç‚¹ä¸ä¸€æ ·çš„ï¼Œå› ä¸ºè¿™å‡ å¤©å­¦ä¹ å·²ç»å¿«æŠ‘éƒäº†ï¼Œè¶ç€å¤©æ°”å¥½å‡ºå»æ”¾æ”¾é£ã€‚å‰ä¸¤å¤©å°±å¬è¯´é•¿æ²™å¸‚å‡ ä¸ªåœ°æ–¹çš„æ¨±èŠ±å·²ç»ç››å¼€ï¼Œæ¯”å¦‚æœ›æœˆå…¬å›­ã€‚ä¸‹åˆ4ç‚¹å·¦å³èµ¶åˆ°æœ›æœˆå…¬å›­ï¼Œäººæµé‡æŒºå¤§çš„ã€‚å‡ ä¹æ‰€æœ‰äººæ‰‹é‡Œéƒ½ç€æ‰‹æœºåœ¨æ‹ç…§ï¼Œæ‹æ‘„å¯¹è±¡ä¸»è¦æ˜¯æ‹æ¨±èŠ±ä¸ç¾å¥³ï¼Œæ‹æ‘„æ–¹å¼æœ‰å•†æ‹ã€éšæ‹ã€è‡ªæ‹ã€‚</p><p>  å¾ˆå¤šäººæ‹¿ç€ç›¸æœºåœ¨æ‹ç…§ï¼Œç‰¹åˆ«æ˜¯éšæ‹çš„ç¾å¥³ï¼Œå¾ˆå¤šäººç›´æ¥å°±æ‹ä¸Šäº†ï¼Œçœ‹åˆ°è¢«æ‹ä¹æ„è¢«æ‹ï¼Œæˆ‘ä¹Ÿæˆä¸ºæ‹æ‘„å¯¹æ–¹ä¸­çš„ä¸€å‘˜ã€‚å…¶ä¸­ä¸¤ä¸ªè¢«æ‹çš„ç¾å¥³ï¼Œè¿˜æ·»åŠ äº†å¾®ä¿¡æŠŠç…§ç‰‡å‘ç»™å¥¹ã€‚ä»¥ä¸‹é™¤äº†ä¸¤ä¸ªå°å¥³å­©æ˜¯è¢«å•†æ‹çš„ã€ç„¶åæˆ‘è¹­æ‹äº†ä¸€ä¸‹ï¼Œå…¶ä»–éƒ½æ˜¯éšæ‹çš„äººç‰©æˆ–é£æ™¯ã€‚ç›¸å…³ç…§ç‰‡ä¸Šä¼ ä¹Ÿå·²å°½é‡å¾å¾—å¯¹æ–¹åŒæ„ï¼Œæ²¡æœ‰è”ç³»æ–¹å¼ä¸ç¡®å®šçš„ï¼Œä¾µåˆ ã€‚</p><p>å›¾ç‰‡æœ‰äº›å¤§ï¼Œä¸æƒ³å ç”¨è‡ªå·±å›¾åºŠçš„ç©ºé—´ï¼Œç›´æ¥ä¸Šä¼ åˆ°å¾®ä¿¡å…¬ä¼—å·äº†ã€‚</p><p>æ–‡ç« é“¾æ¥ï¼š<a href="https://mp.weixin.qq.com/s/UBtgR9X6jI_F_fZh_v9lfQ">https://mp.weixin.qq.com/s/UBtgR9X6jI_F_fZh_v9lfQ</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>æœ›æœˆå…¬å›­éšæ‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PyTorchæ¡†æ¶åŸºç¡€å®è·µ</title>
    <link href="/2025/03/01/PyTorch%E6%A1%86%E6%9E%B6%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5/"/>
    <url>/2025/03/01/PyTorch%E6%A1%86%E6%9E%B6%E5%9F%BA%E7%A1%80%E5%AE%9E%E8%B7%B5/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€PyTorchç®€ä»‹"><a href="#ä¸€ã€PyTorchç®€ä»‹" class="headerlink" title="ä¸€ã€PyTorchç®€ä»‹"></a>ä¸€ã€PyTorchç®€ä»‹</h1><h2 id="1-1-PyTorchæ˜¯ä»€ä¹ˆ"><a href="#1-1-PyTorchæ˜¯ä»€ä¹ˆ" class="headerlink" title="1.1 PyTorchæ˜¯ä»€ä¹ˆ"></a>1.1 PyTorchæ˜¯ä»€ä¹ˆ</h2><p>Ã˜ å¼€æºçš„æœºå™¨å­¦ä¹ &#x2F;æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼ˆ <a href="https://pytorch.org/">https://pytorch.org/</a> ï¼‰</p><p>Ã˜ 2017å¹´1æœˆï¼ŒFAIR(Facebook AI Research)å‘å¸ƒäº†PyTorch 0.1 </p><p>Ã˜ å®ƒå¼ºè°ƒæ˜“ç”¨æ€§å’Œçµæ´»æ€§ï¼Œå¹¶å…è®¸ç”¨æ·±åº¦å­¦ä¹ é¢†åŸŸæƒ¯ç”¨çš„ Python æ¥è¡¨ç¤ºæ·±åº¦å­¦ä¹ æ¨¡å‹ </p><p>Ã˜ PyTorch æä¾›äº†ä¸€ä¸ªæ ¸å¿ƒæ•°æ®ç»“æ„â€”å¼ é‡ï¼ˆTensorï¼‰ </p><p>Ã˜ ç±»ä¼¼çš„æ¡†æ¶è¿˜æœ‰TensorFlowã€PaddlePaddleã€MindSporeç­‰</p><h2 id="1-2-ç¯å¢ƒæ­å»º"><a href="#1-2-ç¯å¢ƒæ­å»º" class="headerlink" title="1.2 ç¯å¢ƒæ­å»º"></a>1.2 ç¯å¢ƒæ­å»º</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">â€¢ è¯¦è§å®˜ç½‘ï¼š https://pytorch.org/</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">â€¢ å¿«é€Ÿå®‰è£…ï¼špip install torch</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">â€¢ è¯¾ç¨‹ä»£ç è¿è¡Œç¯å¢ƒï¼šPython 3.9.x ã€PyTorch 1.13.0</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ­å»ºç¯å¢ƒå‚è€ƒï¼šhttps://pytorch.org/get-started/previous-versions/#v1130</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##Linux and Windows platform</span></span><br>root@ksp-registry:~# conda create -n py3.9 python=3.9<br>conda activate py3.9<br><span class="hljs-meta prompt_">#</span><span class="language-bash">python -V</span><br>Python 3.9.21<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">CPU only</span><br>pip install torch==1.13.0+cpu torchvision==0.14.0+cpu torchaudio==0.13.0 --extra-index-url https://download.pytorch.org/whl/cpu<br>pip install NumPy==1.24.0<br>pip install matplotlib==3.9.4   #ç”»å›¾çš„pythonåº“<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¦‚æœæœ‰GPUï¼ŒCUDA 11.7</span><br>pip install torch==1.13.0+cu117 torchvision==0.14.0+cu117 torchaudio==0.13.0 --extra-index-url https://download.pytorch.org/whl/cu117<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/26/wueNz19vr5QFSq3.png" alt="image-20250226173613976"></p><h1 id="äºŒã€Tensoræ“ä½œ"><a href="#äºŒã€Tensoræ“ä½œ" class="headerlink" title="äºŒã€Tensoræ“ä½œ"></a>äºŒã€Tensoræ“ä½œ</h1><p>å¼ é‡ï¼ˆTensorï¼‰ï¼šPyTorchç½‘ç»œè¿ç®—ä¸­çš„åŸºæœ¬æ•°æ®ç»“æ„ï¼ˆç±»ä¼¼ndarray ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">###å¼ é‡ï¼ˆTensorï¼‰ï¼šPyTorchç½‘ç»œè¿ç®—ä¸­çš„åŸºæœ¬æ•°æ®ç»“æ„ï¼ˆç±»ä¼¼ndarray ï¼‰</span><br><span class="hljs-comment">###åˆ›å»ºå¼ é‡</span><br><span class="hljs-keyword">import</span> torch<br>a = torch.tensor(<span class="hljs-number">0.1</span>)<br>b = torch.tensor(<span class="hljs-number">0.3</span>, dtype=torch.float64)<br><span class="hljs-comment">#æ‰§è¡Œè¿ç®—</span><br>result = a + b<br><span class="hljs-built_in">print</span>(result)<br><br><br><span class="hljs-comment">###åˆ›å»ºç‰¹å®šçš„å¼ é‡</span><br><span class="hljs-keyword">import</span> torch<br><span class="hljs-comment"># å…¨1å¼ é‡</span><br>ones = torch.ones((<span class="hljs-number">3</span>, <span class="hljs-number">2</span>))                  <br><span class="hljs-comment"># ç­‰å·®åºåˆ—å¼ é‡</span><br>range_tensor = torch.arange(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>, <span class="hljs-number">1</span>)      <br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ones:&#x27;</span>, ones, <span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;range_tensor:&#x27;</span>, range_tensor)<br><br><br><span class="hljs-comment">###tensorä¸ndarrayç›¸äº’è½¬åŒ–</span><br><span class="hljs-keyword">import</span> torch<br>output = torch.zeros((<span class="hljs-number">2</span>, <span class="hljs-number">2</span>), dtype=torch.float32)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;1---&gt;&quot;</span>, output)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;2---&gt;output: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">type</span>(output)))<br>n_output = output.numpy()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;3---&gt;n_output: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">type</span>(n_output)))<br>t_output = torch.from_numpy(n_output)    <span class="hljs-comment"># å°†ndarrayè½¬ä¸ºtensor</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;4---&gt;t_output: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">type</span>(t_output)))<br><br><br><span class="hljs-comment">###PyTorchå¸¸ç”¨æ•°æ®ç±»å‹</span><br><span class="hljs-comment">#å®˜æ–¹æ•™ç¨‹ï¼š https://pytorch.org/tutorials/beginner/basics/tensorqs_tutorial.html</span><br><span class="hljs-comment">#å®˜æ–¹APIæ–‡æ¡£ï¼š https://pytorch.org/docs/stable/index.html</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/27/taWTeV3Lb2ivHmg.png" alt="image-20250227101746078"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">###å®˜æ–¹æ•™ç¨‹ï¼š https://pytorch.org/tutorials/beginner/basics/tensorqs_tutorial.html</span><br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br>data = [[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>],[<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]]<br>x_data = torch.tensor(data) <span class="hljs-comment">#ç›´æ¥ä»æ•°æ®åˆ›å»ºä¸€ä¸ªtensorï¼Œæ•°æ®ç±»å‹å¯ä»¥è¢«è‡ªåŠ¨æ¨æ–­å‡ºæ¥</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;1---&gt;x_data:&quot;</span>, x_data)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;x_data type:&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">type</span>(x_data)))<br>np_array = np.array(data) <span class="hljs-comment">#ç›´æ¥ä»æ•°æ®åˆ›å»ºä¸€ä¸ªnumpyå˜é‡</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;2---&gt;np_array&quot;</span>, np_array)<br>x_np = torch.from_numpy(np_array) <span class="hljs-comment">#ä»numpyå˜é‡åˆ›å»ºä¸€ä¸ªtensor</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;3---&gt;x_np&quot;</span>, x_np)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;x_np type:&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">type</span>(x_np)))<br>x_ones = torch.ones_like(x_data)   <span class="hljs-comment"># æ ¹æ®x_dataçš„åˆ›å»ºä¸€ä¸ªæ–°tensorï¼Œæ–°tensorçš„å±æ€§ï¼ˆæ­¤å¤„å› ä¸ºæ²¡æœ‰æŒ‡å®šæ•°æ®ç±»å‹ï¼Œæ‰€ä»¥æ–°tensoræ•°æ®ç±»å‹è·Ÿx_dataä¹Ÿä¸€æ ·ã€‚å…¶ä»–å±æ€§ä¹Ÿæ˜¯ç±»ä¼¼è§„å¾‹ï¼‰è·Ÿx_dataä¸€æ ·ï¼Œä½†æ•°å€¼å¯ä»¥æŒ‡å®šä¸ºå…¨æ˜¯1</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Ones Tensor: \n <span class="hljs-subst">&#123;x_ones&#125;</span> \n&quot;</span>)<br>x_rand = torch.rand_like(x_data, dtype=torch.<span class="hljs-built_in">float</span>) <span class="hljs-comment"># æ ¹æ®x_dataçš„åˆ›å»ºä¸€ä¸ªæ–°tensorï¼Œå½¢çŠ¶ä¸åŸtensorä¸€æ ·ï¼Œä½†æŒ‡å®šäº†æ–°çš„æ•°æ®ç±»å‹ä¸ºtorch.floatã€ä¸”å®ƒçš„å…ƒç´ å€¼éƒ½æ˜¯ä¸€äº›éšæœºç”Ÿæˆçš„æ•°</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Random Tensor: \n <span class="hljs-subst">&#123;x_rand&#125;</span> \n&quot;</span>)<br><br><span class="hljs-comment">###-------------------------------------------------------</span><br><span class="hljs-comment">############è¾“å‡ºå¦‚ä¸‹ï¼š</span><br><span class="hljs-number">1</span>---&gt;x_data: tensor([[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>],<br>        [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]])<br>x_data <span class="hljs-built_in">type</span>:&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;torch.Tensor&#x27;</span>&gt;<br><span class="hljs-number">2</span>---&gt;np_array [[<span class="hljs-number">1</span> <span class="hljs-number">2</span>]<br> [<span class="hljs-number">3</span> <span class="hljs-number">4</span>]]<br><span class="hljs-number">3</span>---&gt;x_np tensor([[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>],<br>        [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]], dtype=torch.int32)<br>x_np <span class="hljs-built_in">type</span>:&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;torch.Tensor&#x27;</span>&gt;<br>Ones Tensor: <br> tensor([[<span class="hljs-number">1</span>, <span class="hljs-number">1</span>],<br>        [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>]]) <br><br>Random Tensor: <br> tensor([[<span class="hljs-number">0.1867</span>, <span class="hljs-number">0.2627</span>],<br>        [<span class="hljs-number">0.4514</span>, <span class="hljs-number">0.6730</span>]])<br><br><br><span class="hljs-comment">###å®˜æ–¹æ•™ç¨‹ï¼š https://pytorch.org/tutorials/beginner/basics/tensorqs_tutorial.html</span><br><span class="hljs-comment">#With random or constant values</span><br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br>shape = (<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,)<br>rand_tensor = torch.rand(shape)<br>ones_tensor = torch.ones(shape)<br>zeros_tensor = torch.zeros(shape)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Random Tensor: \n <span class="hljs-subst">&#123;rand_tensor&#125;</span> \n&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Ones Tensor: \n <span class="hljs-subst">&#123;ones_tensor&#125;</span> \n&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Zeros Tensor: \n <span class="hljs-subst">&#123;zeros_tensor&#125;</span>&quot;</span>)<br><span class="hljs-comment">###-------------------------------------------------------</span><br><span class="hljs-comment">############è¾“å‡ºå¦‚ä¸‹ï¼š</span><br>Random Tensor:<br> tensor([[<span class="hljs-number">0.3904</span>, <span class="hljs-number">0.6009</span>, <span class="hljs-number">0.2566</span>],<br>        [<span class="hljs-number">0.7936</span>, <span class="hljs-number">0.9408</span>, <span class="hljs-number">0.1332</span>]])<br><br>Ones Tensor:<br> tensor([[<span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>],<br>        [<span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>]])<br><br>Zeros Tensor:<br> tensor([[<span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>],<br>        [<span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">0.</span>]])<br><br><br><span class="hljs-comment">###å®˜æ–¹æ•™ç¨‹ï¼š https://pytorch.org/tutorials/beginner/basics/tensorqs_tutorial.html</span><br><span class="hljs-comment">##Attributes of a Tensor,Tensor attributes describe their shape, datatype, and the device on which they are stored.</span><br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br>tensor = torch.rand(<span class="hljs-number">3</span>,<span class="hljs-number">4</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Shape of tensor: <span class="hljs-subst">&#123;tensor.shape&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Datatype of tensor: <span class="hljs-subst">&#123;tensor.dtype&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Device tensor is stored on: <span class="hljs-subst">&#123;tensor.device&#125;</span>&quot;</span>)<br><span class="hljs-comment">###-------------------------------------------------------</span><br><span class="hljs-comment">############è¾“å‡ºå¦‚ä¸‹ï¼š</span><br>Shape of tensor: torch.Size([<span class="hljs-number">3</span>, <span class="hljs-number">4</span>])<br>Datatype of tensor: torch.float32<br>Device tensor <span class="hljs-keyword">is</span> stored on: cpu<br><br><span class="hljs-comment">#Operations on Tensors</span><br><span class="hljs-comment">#Over 1200 tensor operations, including arithmetic, linear algebra, matrix manipulation (transposing, indexing, slicing), sampling and more are comprehensively described here(https://pytorch.org/docs/stable/torch.html).</span><br><span class="hljs-comment">#Try out some of the operations from the list. If youâ€™re familiar with the NumPy API, youâ€™ll find the Tensor API a breeze to use.</span><br><span class="hljs-comment">#Standard numpy-like indexing and slicing:</span><br>tensor = torch.ones(<span class="hljs-number">4</span>, <span class="hljs-number">4</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;First row: <span class="hljs-subst">&#123;tensor[<span class="hljs-number">0</span>]&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;First column: <span class="hljs-subst">&#123;tensor[:, <span class="hljs-number">0</span>]&#125;</span>&quot;</span>) <span class="hljs-comment">#ä¹Ÿå¯ä»¥æŒ‡å®šä¸ºå…¶ä»–åˆ—</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Last column: <span class="hljs-subst">&#123;tensor[..., -<span class="hljs-number">1</span>]&#125;</span>&quot;</span>)<br>tensor[:,<span class="hljs-number">1</span>] = <span class="hljs-number">0</span><br><span class="hljs-built_in">print</span>(tensor)<br><span class="hljs-comment">###-------------------------------------------------------</span><br><span class="hljs-comment">############è¾“å‡ºå¦‚ä¸‹ï¼š</span><br>First row: tensor([<span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>])<br>First column: tensor([<span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>])<br>Last column: tensor([<span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>])<br>tensor([[<span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>],<br>        [<span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>],<br>        [<span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>],<br>        [<span class="hljs-number">1.</span>, <span class="hljs-number">0.</span>, <span class="hljs-number">1.</span>, <span class="hljs-number">1.</span>]])<br></code></pre></td></tr></table></figure><h1 id="ä¸‰ã€æ„å»ºä¸€ä¸ªçº¿æ€§æ¨¡å‹"><a href="#ä¸‰ã€æ„å»ºä¸€ä¸ªçº¿æ€§æ¨¡å‹" class="headerlink" title="ä¸‰ã€æ„å»ºä¸€ä¸ªçº¿æ€§æ¨¡å‹"></a>ä¸‰ã€æ„å»ºä¸€ä¸ªçº¿æ€§æ¨¡å‹</h1><p>ä»»åŠ¡æè¿°</p><img src="C:\Users\jiangsanyin\AppData\Roaming\Typora\typora-user-images\image-20250227112224067.png" alt="image-20250227112224067" style="zoom: 33%;" /><img src="https://s2.loli.net/2025/02/27/UACk1egv35q9jLZ.png" alt="image-20250227112605556" style="zoom: 33%;" /><hr><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-comment">#1. è¯»å–æ•°æ®</span><br>data = pd.read_csv(<span class="hljs-string">&#x27;line_fit_data.csv&#x27;</span>).values    <span class="hljs-comment"># å°†æ•°æ®è¯»å–åå­˜å‚¨ä¸ºndarrayæ ¼å¼(ç±»ä¼¼äºæ•°ç»„å½¢å¼)</span><br>X = torch.tensor(data[:, <span class="hljs-number">0</span>], dtype=torch.float32) <span class="hljs-comment"># æ ·æœ¬è‡ªå˜é‡</span><br>y = torch.tensor(data[:, <span class="hljs-number">1</span>], dtype=torch.float32) <span class="hljs-comment"># ç›®æ ‡å˜é‡</span><br><span class="hljs-comment">#print(data)</span><br>W = torch.tensor(-<span class="hljs-number">10.0</span>, requires_grad=<span class="hljs-literal">True</span>)  <span class="hljs-comment">#åˆå§‹æƒå€¼ã€‚requires_grad=Trueçš„ä½œç”¨æ˜¯è®© backward å¯ä»¥è¿½è¸ªè¿™ä¸ªå‚æ•°å¹¶ä¸”è®¡ç®—å®ƒçš„æ¢¯åº¦ã€‚</span><br>b = torch.tensor(<span class="hljs-number">7.0</span>, requires_grad=<span class="hljs-literal">True</span>) <span class="hljs-comment">#åˆå§‹é˜ˆå€¼</span><br><span class="hljs-comment">#å…³äºå‚æ•° requires_grad çš„è¯¦ç»†è§£é‡Šï¼šhttps://blog.csdn.net/weixin_42572656/article/details/116117780</span><br>learning_rate = <span class="hljs-number">0.35</span>    <span class="hljs-comment">#å­¦ä¹ é€Ÿé€Ÿç‡ï¼Œæˆ–å«æ­¥é•¿</span><br><br><span class="hljs-comment">#2. æ„é€ ä¸€ä¸ªçº¿æ€§æ¨¡å‹</span><br><span class="hljs-comment"># æ„é€ ä¸€ä¸ªçº¿æ€§æ¨¡å‹</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">linear_model</span>(<span class="hljs-params">W, X, b</span>):<br>    <span class="hljs-keyword">return</span> W * X + b<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">loss_fn</span>(<span class="hljs-params">y_pre, y_true</span>):<br>    <span class="hljs-keyword">return</span> ((y_pre - y_true) ** <span class="hljs-number">2</span>).mean()  <span class="hljs-comment"># mean() æ–¹æ³• ç”¨äºè®¡ç®—å¼ é‡ä¸­æ‰€æœ‰å…ƒç´ çš„å¹³å‡å€¼</span><br>y_pre = linear_model(W, X, b)  <span class="hljs-comment"># å‰å‘ä¼ æ’­</span><br>loss = loss_fn(y_pre, y)  <span class="hljs-comment"># æ¨¡å‹æŸå¤±å€¼</span><br>loss.backward()  <span class="hljs-comment"># è¯¯å·®åå‘ä¼ æ’­</span><br>W.data = W.data - W.grad * learning_rate  <span class="hljs-comment"># æ²¿ç€æ¢¯åº¦çš„åæ–¹å‘æ›´æ–°æƒå€¼</span><br>b.data = b.data - b.grad * learning_rate  <span class="hljs-comment"># æ²¿ç€æ¢¯åº¦çš„åæ–¹å‘æ›´æ–°é˜ˆå€¼</span><br>W.grad.zero_()  <span class="hljs-comment"># å°†æƒå€¼çš„æ¢¯åº¦æ¸…é›¶</span><br>b.grad.zero_()  <span class="hljs-comment"># å°†é˜ˆå€¼çš„æ¢¯åº¦æ¸…é›¶</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Epoch: &quot;</span>, <span class="hljs-number">0</span>, <span class="hljs-string">&quot;Loss:&quot;</span>, loss.item(), <span class="hljs-string">&quot;W:&quot;</span>, W.item(), <span class="hljs-string">&quot;b:&quot;</span>, b.item())<br><br><br><span class="hljs-comment">####3. æ„é€ ä¼˜åŒ–å™¨</span><br><span class="hljs-comment">####è¾“å‡ºy_preï¼Œå¯ä»¥çœ‹åˆ°y_preä¸yæ˜¯æœ‰å¾ˆå¤§å·®å¼‚çš„ï¼ŒåŸå› åœ¨æˆ‘ä»¬çš„Wä¸bæ˜¯éšä¾¿å–çš„</span><br><span class="hljs-comment">###y_pre = linear_model(W, X, b)    #å‰å‘ä¼ æ’­</span><br><span class="hljs-comment">###loss = loss_fn(y_pre, y)             #æ¨¡å‹æŸå¤±å€¼</span><br><span class="hljs-comment">###loss.backward()                      #è¯¯å·®åå‘ä¼ æ’­</span><br><span class="hljs-comment">###print(W.grad)               #Wçš„æ¢¯åº¦ï¼Œå…¶å®å°±æ˜¯loss å…³äºWçš„åå¯¼æ•°</span><br><span class="hljs-comment">###print(b.grad)               #bçš„æ¢¯åº¦ï¼Œå…¶å®å°±æ˜¯loss å…³äºbçš„åå¯¼æ•°</span><br><span class="hljs-comment">####æœ‰äº†Wä¸bçš„æ¢¯åº¦åï¼Œå°±å¯ä»¥åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¸æ–­æ›´æ–°Wä¸bçš„å–å€¼äº†ï¼Œæœ€ç»ˆå®ç°lossçš„å‡å°</span><br><span class="hljs-comment">###</span><br><span class="hljs-comment">####4. æœ€å°åŒ–æ–¹å·®ï¼ˆè®­ç»ƒï¼‰</span><br><span class="hljs-comment">###W</span><br><span class="hljs-comment">###b</span><br><span class="hljs-comment">###W.data = W.data - W.grad * learning_rate  #æ²¿ç€æ¢¯åº¦çš„åæ–¹å‘æ›´æ–°æƒå€¼</span><br><span class="hljs-comment">###b.data = b.data - b.grad * learning_rate  #æ²¿ç€æ¢¯åº¦çš„åæ–¹å‘æ›´æ–°é˜ˆå€¼</span><br><span class="hljs-comment">####æŸ¥çœ‹æ›´æ–°åçš„Wä¸b</span><br><span class="hljs-comment">###W</span><br><span class="hljs-comment">###b</span><br><span class="hljs-comment">####é»˜è®¤æƒ…å†µä¸‹å˜é‡çš„æ¢¯åº¦æ˜¯ä¼šç´¯ç§¯çš„ï¼ˆæœ‰äº›åœºæ™¯éœ€è¦ï¼‰ã€‚æ­¤åœºæ™¯ä¸éœ€è¦æ¢¯åº¦ç´¯ç§¯ï¼Œæ›´æ–°å¯¹åº”å˜é‡åéœ€è¦å°†å˜é‡æ¢¯åº¦ç½®é›¶</span><br><span class="hljs-comment">###W.grad.zero_()  #å°†æƒå€¼çš„æ¢¯åº¦æ¸…é›¶</span><br><span class="hljs-comment">###b.grad.zero_()  #å°†é˜ˆå€¼çš„æ¢¯åº¦æ¸…é›¶</span><br><span class="hljs-comment">###</span><br><span class="hljs-comment">####5. æ€§èƒ½è¯„ä¼°</span><br><span class="hljs-comment">###y_pre = linear_model(W, X, b)    #å‰å‘ä¼ æ’­</span><br><span class="hljs-comment">###loss = loss_fn(y_pre, y)             #æ¨¡å‹æŸå¤±å€¼</span><br><span class="hljs-comment">###loss</span><br><br>y_pre = linear_model(W, X, b)  <span class="hljs-comment"># å‰å‘ä¼ æ’­</span><br>loss = loss_fn(y_pre, y)  <span class="hljs-comment"># æ¨¡å‹æŸå¤±å€¼</span><br>loss.backward()  <span class="hljs-comment"># è¯¯å·®åå‘ä¼ æ’­</span><br>W.data = W.data - W.grad * learning_rate  <span class="hljs-comment"># æ²¿ç€æ¢¯åº¦çš„åæ–¹å‘æ›´æ–°æƒå€¼</span><br>b.data = b.data - b.grad * learning_rate  <span class="hljs-comment"># æ²¿ç€æ¢¯åº¦çš„åæ–¹å‘æ›´æ–°é˜ˆå€¼</span><br>W.grad.zero_()  <span class="hljs-comment"># å°†æƒå€¼çš„æ¢¯åº¦æ¸…é›¶</span><br>b.grad.zero_()  <span class="hljs-comment"># å°†é˜ˆå€¼çš„æ¢¯åº¦æ¸…é›¶</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Epoch: &quot;</span>, <span class="hljs-number">0</span>, <span class="hljs-string">&quot;Loss:&quot;</span>, loss.item(), <span class="hljs-string">&quot;W:&quot;</span>, W.item(), <span class="hljs-string">&quot;b:&quot;</span>, b.item())<br><br>plt.figure(figsize=(<span class="hljs-number">10</span>, <span class="hljs-number">5</span>))      <span class="hljs-comment">#è®¾ç½®ç”»å¸ƒå¤§å°</span><br>plt.axis([-<span class="hljs-number">0.01</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">3</span>, <span class="hljs-number">10</span>])     <span class="hljs-comment">#æŒ‡å®šåæ ‡è½´çš„å–å€¼èŒƒå›´</span><br>plt.scatter(X, y, color=<span class="hljs-string">&quot;blue&quot;</span>)  <span class="hljs-comment">#ç»˜åˆ¶æ ·æœ¬å®é™…åˆ†å¸ƒå›¾</span><br>plt.plot(X, linear_model(W, X, b).data, color=<span class="hljs-string">&quot;red&quot;</span>)   <span class="hljs-comment">#ç»˜åˆ¶æ¨¡å‹é¢„æµ‹ç»“æœåˆ†å¸ƒå›¾</span><br><span class="hljs-comment">#plt.legend([&#x27;target_y&#x27;, &#x27;predict_y&#x27;])    #æ ‡ç¤ºå›¾ä¾‹</span><br><span class="hljs-comment">#plt.show()                               #å±•ç¤ºç”»å¸ƒï¼Œä¸æ‰§è¡Œçœ‹ä¸åˆ°å¼¹çª—ä¸ç”»å¸ƒ</span><br><br><span class="hljs-comment">#ä»¥ä¸‹forå¾ªç¯æ¼”ç¤ºï¼Œæ‰§è¡Œå¤šè½®æƒå€¼ä¸é˜ˆå€¼çš„æ›´æ–°ï¼Œå°½é‡å®ç°çº¿æ€§æ¨¡å‹å¯¹åŸæ•°æ®çš„æ‹Ÿåˆ</span><br><span class="hljs-comment">#def linear_model_train(W, X, b, y_true, range_):</span><br><span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">200</span>):<br>    y_pre = linear_model(W, X, b)  <span class="hljs-comment"># å‰å‘ä¼ æ’­</span><br>    loss = loss_fn(y_pre, y)  <span class="hljs-comment"># æ¨¡å‹æŸå¤±å€¼</span><br>    loss.backward()  <span class="hljs-comment"># è¯¯å·®åå‘ä¼ æ’­</span><br><br>    W.data = W.data - W.grad * learning_rate  <span class="hljs-comment"># æ²¿ç€æ¢¯åº¦çš„åæ–¹å‘æ›´æ–°æƒå€¼</span><br>    b.data = b.data - b.grad * learning_rate  <span class="hljs-comment"># æ²¿ç€æ¢¯åº¦çš„åæ–¹å‘æ›´æ–°é˜ˆå€¼</span><br>    W.grad.zero_()  <span class="hljs-comment"># å°†æƒå€¼çš„æ¢¯åº¦æ¸…é›¶</span><br>    b.grad.zero_()  <span class="hljs-comment"># å°†é˜ˆå€¼çš„æ¢¯åº¦æ¸…é›¶</span><br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Epoch: &quot;</span>, epoch, <span class="hljs-string">&quot;Loss:&quot;</span>, loss.item(), <span class="hljs-string">&quot;W:&quot;</span>, W.item(), <span class="hljs-string">&quot;b:&quot;</span>, b.item())<br>    plt.plot(X, y_pre.data, color=<span class="hljs-string">&quot;red&quot;</span>, alpha=<span class="hljs-number">0.2</span>)  <span class="hljs-comment"># ç»˜åˆ¶æ¨¡å‹é¢„æµ‹ç»“æœåˆ†å¸ƒå›¾</span><br><span class="hljs-comment">#linear_model_train(W, X, b, y, 10)</span><br><br>plt.show()<br><span class="hljs-comment">#ä¸‹å›¾æ˜¯æ­¤ç¨‹åºçš„å®é™…æ‰§è¡Œç»“æœï¼ˆè·Ÿé‚£äº›è“è‰²ç‚¹åŸºæœ¬é‡åˆçš„é‚£æ¡æ¨¡æ‹Ÿç›´çº¿å°±æ˜¯æœ€åçš„å›å½’æ–¹ç¨‹å¯¹åº”çš„ç›´çº¿ï¼‰</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/27/bcxfpJgAYdB2MGz.png" alt="image-20250227221735425"></p><h1 id="å››ã€è¯†åˆ«æ‰‹å†™æ•°å­—"><a href="#å››ã€è¯†åˆ«æ‰‹å†™æ•°å­—" class="headerlink" title="å››ã€è¯†åˆ«æ‰‹å†™æ•°å­—"></a>å››ã€è¯†åˆ«æ‰‹å†™æ•°å­—</h1><h2 id="æ¡ˆä¾‹æµç¨‹"><a href="#æ¡ˆä¾‹æµç¨‹" class="headerlink" title="æ¡ˆä¾‹æµç¨‹"></a>æ¡ˆä¾‹æµç¨‹</h2><img src="https://s2.loli.net/2025/02/27/XiUlT2bjKnDFEZ4.png" alt="image-20250227230342049" style="zoom: 67%;" /><img src="https://s2.loli.net/2025/02/27/RTrD9z3Js4YlHcS.png" alt="image-20250227230359444" style="zoom:67%;" /><img src="https://s2.loli.net/2025/02/27/iQckg79paIPwv48.png" alt="image-20250227230429605" style="zoom:67%;" /><hr><h2 id="å„ä¸ªæ­¥éª¤ä¸ä»£ç ç‰‡æ®µ"><a href="#å„ä¸ªæ­¥éª¤ä¸ä»£ç ç‰‡æ®µ" class="headerlink" title="å„ä¸ªæ­¥éª¤ä¸ä»£ç ç‰‡æ®µ"></a>å„ä¸ªæ­¥éª¤ä¸ä»£ç ç‰‡æ®µ</h2><p><img src="https://s2.loli.net/2025/03/01/mCvXah1eiBLVK4J.png" alt="image-20250301114431359"></p><p><img src="https://s2.loli.net/2025/03/01/2TRWV57AFKmfEct.png" alt="image-20250301114511908"></p><p><img src="https://s2.loli.net/2025/03/01/uURyVjaHInEWN1A.png" alt="image-20250301114752851"></p><p><img src="https://s2.loli.net/2025/03/01/rAOZwiVTY5Ss96n.png" alt="image-20250301114850257"></p><p><img src="https://s2.loli.net/2025/03/01/mpfv58o9eMPiKyB.png" alt="image-20250301114908341"></p><p><img src="https://s2.loli.net/2025/03/01/we9QAmPXczfRZHr.png" alt="image-20250301114926605"></p><p><img src="https://s2.loli.net/2025/03/01/68CItmDUg4xT5Nb.png" alt="image-20250301115050517"></p><p><img src="https://s2.loli.net/2025/03/01/IF659ZbtTuQsO8y.png" alt="image-20250301115106097"></p><p><img src="https://s2.loli.net/2025/03/01/aUeZ1RfYCkIJl3x.png" alt="image-20250301115114458"></p><p><img src="https://s2.loli.net/2025/03/01/Z6UVRGQivYcPrCM.png" alt="image-20250301115123276"></p><p><img src="https://s2.loli.net/2025/03/01/BmAegGxs8l74vqp.png" alt="image-20250301115133657"></p><p><img src="https://s2.loli.net/2025/03/01/rIRQC3yp2DtNPfh.png" alt="image-20250301115142324"></p><hr><h2 id="å…·ä½“å¯æ‰§è¡Œä»£ç "><a href="#å…·ä½“å¯æ‰§è¡Œä»£ç " class="headerlink" title="å…·ä½“å¯æ‰§è¡Œä»£ç "></a>å…·ä½“å¯æ‰§è¡Œä»£ç </h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ç›¸å…³ä»£ç ä¸æ–‡ä»¶å·²ç»ä¿å­˜åœ¨é˜¿é‡Œäº‘ç›˜ï¼ˆç”±äºé˜¿é‡Œäº‘ç›˜ä¸æ”¯æŒåˆ†äº«.zipï¼Œæ•…å°†åˆ†äº«ä¸ºè‡ªé‡Šæ”¾ç¨‹åºæ–‡ä»¶å³.exeæ ¼å¼ï¼Œä¸‹è½½åŒå‡»å³å¯è§£å‹ï¼‰</span><br>https://www.alipan.com/s/QdEhU2t9E1H<br>æå–ç : o49e<br></code></pre></td></tr></table></figure><p>ï¼ˆ1ï¼‰æ–‡ä»¶â€œè¯†åˆ«æ‰‹å†™æ•°å­—2.pyâ€å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy<br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">from</span> mnist_net_work2 <span class="hljs-keyword">import</span> Network2<br><br><span class="hljs-comment">#1. åŠ è½½æ•°æ®</span><br><span class="hljs-comment">#è¯»å–æ”¯æŒè¯»å–å’Œä¿å­˜numpyæ•°ç»„ï¼Œå…¶ä¸­.npzæ˜¯numpyä¸­ä½¿ç”¨çš„ç‰¹å®šçš„æ•°æ®ç±»å‹</span><br><span class="hljs-comment">#æŒ‡å®šallow_pickleå‚æ•°æ¥è®¾ç½®æ˜¯å¦å…è®¸ä½¿ç”¨pickleåºåˆ—åŒ–ï¼Œé»˜è®¤å€¼æ˜¯Falseï¼Œæ„å‘³ç€ numpy.load() å‡½æ•°ä¸èƒ½åŠ è½½åŒ…å« Python å¯¹è±¡ï¼ˆä¾‹å¦‚ Noneï¼‰çš„æ•°ç»„</span><br>data = numpy.load(<span class="hljs-string">&#x27;mnist.npz&#x27;</span>, allow_pickle=<span class="hljs-literal">True</span>)<br><span class="hljs-comment">#4ä¸ªå˜é‡åˆ†åˆ«ä»£è¡¨è®­ç»ƒé›†æ ·æœ¬è‡ªå˜é‡ã€è®­ç»ƒé›†æ ·æœ¬æ ‡ç­¾ã€æµ‹è¯•é›†æ ·æœ¬è‡ªå˜é‡ã€æµ‹è¯•é›†æ ·æœ¬æ ‡ç­¾</span><br>X_train, y_train, X_test, y_test = data[<span class="hljs-string">&#x27;x_train&#x27;</span>], data[<span class="hljs-string">&#x27;y_train&#x27;</span>], data[<span class="hljs-string">&#x27;x_test&#x27;</span>], data[<span class="hljs-string">&#x27;y_test&#x27;</span>]<br><br><br><span class="hljs-comment">#2. æ•°æ®åŠ å·¥</span><br>X_train_tensor = torch.tensor(X_train/<span class="hljs-number">255</span>, dtype=torch.float32)   <span class="hljs-comment">#å°†è®­ç»ƒé›†æ ·æœ¬è‡ªå˜é‡è½¬å˜ä¸ºtensorç±»å‹</span><br>y_train_tensor = torch.tensor(y_train, dtype=torch.int64)   <span class="hljs-comment">#å°†è®­ç»ƒé›†æ ·æœ¬æ ‡ç­¾è½¬å˜ä¸ºtensorç±»å‹</span><br>X_test_tensor = torch.tensor(X_test/<span class="hljs-number">255</span>, dtype=torch.float32)   <span class="hljs-comment">#å°†æµ‹è¯•é›†æ ·æœ¬è‡ªå˜é‡è½¬å˜ä¸ºtensorç±»å‹</span><br><span class="hljs-comment">#æµ‹è¯•é›†æ ·æœ¬æ ‡ç­¾ï¼Œåœ¨æ­¤å¤„ä¸éœ€è¦å…¶tensorç±»å‹ã€ç›´æ¥ä½¿ç”¨å…¶numpyæ•°ç»„ç±»å‹å³å¯ï¼Œæ•…æ— é¡»è½¬æ¢</span><br>train_ds = torch.utils.data.TensorDataset(X_train_tensor, y_train_tensor)  <span class="hljs-comment">#å°†è®­ç»ƒé›†æ ·æœ¬è‡ªå˜é‡ã€æ ‡ç­¾æ•´ç†æˆæˆå¯¹æ•°æ®é›†</span><br>train_dl = torch.utils.data.DataLoader(train_ds, batch_size=<span class="hljs-number">32</span>, shuffle=<span class="hljs-literal">True</span>) <span class="hljs-comment">#è®­ç»ƒé›†æ ·æœ¬æ•´ç†æˆå¯¹åï¼Œå†è½¬å˜æˆå¯è¿­ä»£çš„æ ¼å¼ã€è¿­ä»£å‰ä¼šæ‰“ä¹±ã€æ¯è½®è¿­ä»£å–32ä¸ªæ•°æ®ä¸ºä¸€æ‰¹</span><br><br><span class="hljs-comment">#3. æ„å»ºæ¨¡å‹ï¼ˆæ­å»ºç½‘ç»œï¼‰</span><br>network = Network2()   <span class="hljs-comment">#å®ä¾‹åŒ–å¾—åˆ°ä¸€ä¸ªç½‘ç»œæ¨¡å‹</span><br><br><span class="hljs-comment">#4. æ¨¡å‹é…ç½®</span><br><span class="hljs-comment">#æŸå¤±å‡½æ•°</span><br>loss_fn = torch.nn.CrossEntropyLoss()   <span class="hljs-comment">#ä½¿ç”¨torché»˜è®¤å­˜åœ¨çš„äº¤å‰ç†µå‡½æ•°</span><br><span class="hljs-comment">#ä¼˜åŒ–å™¨ã€‚ç”¨æ¥åœ¨å¤šæ¬¡è®­ç»ƒä¸­ä½¿ç”¨æ¢¯åº¦ä¿®æ”¹ç›¸å…³å‚æ•°å€¼çš„ï¼Œæ­¤å¤„ä½¿ç”¨éšæœºæ¢¯åº¦ä¸‹é™æ–¹æ³•SGDï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä»£è¡¨ç€è¦è®­ç»ƒè¿‡ç¨‹ä¸­éœ€è¦ä¸æ–­ä¿®æ”¹çš„æ¨¡å‹å‚æ•°ã€ç¬¬2ä¸ªå‚æ•°æ˜¯å­¦ä¹ ç‡</span><br>optimizer = torch.optim.SGD(network.parameters(), lr=<span class="hljs-number">0.01</span>)<br><br><span class="hljs-comment">#5. æ¨¡å‹è®­ç»ƒä¸ä¿å­˜</span><br><span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>):<br>    <span class="hljs-keyword">for</span> image, label <span class="hljs-keyword">in</span> train_dl:<br>        y_pre = network(image)            <span class="hljs-comment"># å‰å‘ä¼ æ’­</span><br>        loss = loss_fn(y_pre, label)      <span class="hljs-comment"># è®¡ç®—æ¨¡å‹æŸå¤±å€¼</span><br>        network.zero_grad()               <span class="hljs-comment"># å°†ç½‘ç»œä¸­æ‰€æœ‰å‚æ•°çš„æ¢¯åº¦è¿›è¡Œæ¸…é›¶</span><br>        loss.backward()                   <span class="hljs-comment"># è®¡ç®—æ¢¯åº¦</span><br>        optimizer.step()                  <span class="hljs-comment"># å¯¹ç½‘ç»œå‚æ•°ï¼ˆæƒå€¼å’Œé˜ˆå€¼ï¼‰è¿›è¡Œä¼˜åŒ–</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç¬¬ &#123;&#125; è½®è®­ç»ƒçš„æœ€åä¸€æ‰¹æ ·æœ¬çš„è®­ç»ƒæŸå¤±å€¼ä¸ºï¼š&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(epoch, loss.item()))  <span class="hljs-comment"># æ‰“å°è®­ç»ƒè¯¯å·®</span><br><br><span class="hljs-comment">#6. æ¨¡å‹åº”ç”¨</span><br>predict = network.forward(X_test_tensor)     <span class="hljs-comment">#è°ƒç”¨å·²ç»è®­ç»ƒå¥½çš„æ¨¡å‹å¯¹æµ‹è¯•é›†æ ·æœ¬è¿›è¡Œé¢„æµ‹</span><br>result = predict.data.numpy().argmax(axis=<span class="hljs-number">1</span>) <span class="hljs-comment"># æ¨¡å‹å¯¹æµ‹è¯•æ ·æœ¬çš„é¢„æµ‹æ ‡ç­¾</span><br>acc_test = (result == y_test).mean()                    <span class="hljs-comment">#æµ‹è¯•å‡†ç¡®åº¦</span><br><br>torch.save(network.state_dict(), <span class="hljs-string">&#x27;mnist_net_work2.pt&#x27;</span>)  <span class="hljs-comment">#ä¿å­˜å·²ç»è®­ç»ƒå¥½çš„æ¨¡å‹ï¼ˆæ­¤å¤„åªä¿å­˜å‚æ•°ï¼‰</span><br></code></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰ç½‘ç»œï¼ˆæ¨¡å‹ï¼‰å®šä¹‰æ–‡ä»¶â€œmnist_net_work2.pyâ€å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">from</span> torch.nn <span class="hljs-keyword">import</span> Module<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Network2</span>(<span class="hljs-title class_ inherited__">Module</span>):<br>    <span class="hljs-comment"># __init__æ–¹æ³•ä¸­ï¼Œå®šä¹‰ç¥ç»ç½‘ç»œç”¨åˆ°çš„å±‚åŠå‡½æ•°</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>(Network2, <span class="hljs-variable language_">self</span>).__init__()<br>        <span class="hljs-variable language_">self</span>.flatten = torch.nn.Flatten() <span class="hljs-comment">#å±•å¹³å±‚</span><br><br>        <span class="hljs-variable language_">self</span>.fc1 = torch.nn.Linear(<span class="hljs-number">784</span>, <span class="hljs-number">128</span>)  <span class="hljs-comment">#å…¨è¿æ¥ï¼ˆéšè—å±‚ï¼‰</span><br>        <span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªç®€å•çš„çº¿æ€§å±‚ï¼Œè¾“å…¥ç»´åº¦ä¸º784,è¾“å‡ºç»´åº¦ä¸º128</span><br><br>        <span class="hljs-variable language_">self</span>.fc2 = torch.nn.Linear(<span class="hljs-number">128</span>, <span class="hljs-number">10</span>)   <span class="hljs-comment">#å…¨è¿æ¥ï¼ˆè¾“å‡ºå±‚ï¼‰</span><br>        <span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªç®€å•çš„çº¿æ€§å±‚ï¼Œè¾“å…¥ç»´åº¦ä¸º128,è¾“å‡ºç»´åº¦ä¸º10</span><br><br>        <span class="hljs-variable language_">self</span>.relu = torch.nn.ReLU()                                <span class="hljs-comment">#æ¿€æ´»å‡½æ•°</span><br>        <span class="hljs-comment"># ReLU(Rectified Linear Unit)æ˜¯ä¸€ç§å¸¸ç”¨çš„æ¿€æ´»å‡½æ•°ï¼Œå…¨ç§°ä¸ºä¿®æ­£çº¿æ€§å•å…ƒã€‚</span><br>        <span class="hljs-comment"># å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å°†è¾“å…¥å€¼é™åˆ¶åœ¨ä¸€ä¸ªéè´Ÿçš„èŒƒå›´å†…ï¼Œå³å½“è¾“å…¥å€¼å°äº0æ—¶ï¼Œè¾“å‡ºå€¼ä¸º0;å½“è¾“å…¥å€¼å¤§äºç­‰äº0æ—¶ï¼Œè¾“å‡ºå€¼ç­‰äºè¾“å…¥å€¼æœ¬èº«ã€‚ReLUå‡½æ•°çš„è¡¨è¾¾å¼ä¸ºï¼šf(x) = max(0, x)ã€‚</span><br>        <span class="hljs-comment"># https://blog.csdn.net/u011775793/article/details/135422687</span><br><br>    <span class="hljs-comment">#å‰å‘ä¼ æ’­å‡½æ•°</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        <span class="hljs-comment">#print(&quot;x: &quot;, x)</span><br>        <span class="hljs-comment"># åˆå§‹åŒ–å‡½æ•°ä¸­å®šä¹‰çš„å„ä¸ªå‡½æ•°çš„è°ƒç”¨</span><br>        x = <span class="hljs-variable language_">self</span>.flatten(x)<br>        <span class="hljs-comment">#print(&quot;after flatten: &quot;, x)</span><br>        x = <span class="hljs-variable language_">self</span>.fc1(x)<br>        <span class="hljs-comment">#print(&quot;after fc1: &quot;, x)</span><br>        x = <span class="hljs-variable language_">self</span>.relu(x)<br>        <span class="hljs-comment">#print(&quot;after relu: &quot;, x)</span><br>        x = <span class="hljs-variable language_">self</span>.fc2(x)<br>        <span class="hljs-comment">#print(&quot;after fc2: &quot;, x)</span><br>        <span class="hljs-keyword">return</span> x<br><br></code></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰æ¨¡å‹åº”ç”¨å³æ¨¡å‹æ•ˆæœçš„éªŒè¯ï¼Œå¯¹åº”çš„æ–‡ä»¶â€œpredict2.pyâ€å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#import torch</span><br><span class="hljs-comment">#from mnist_net_work import NetWork</span><br><span class="hljs-comment">#import matplotlib.pyplot as plt</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#model = NetWork()                               # å®ä¾‹åŒ–å¾—åˆ°ä¸€ä¸ªç½‘ç»œæ¨¡å‹</span><br><span class="hljs-comment">#model_state_dict = torch.load(&#x27;mnist_1.pt&#x27;)     # åŠ è½½å·²ä¿å­˜å¥½çš„æ¨¡å‹ï¼ˆå‚æ•°ï¼‰</span><br><span class="hljs-comment">#model.load_state_dict(model_state_dict)         # å°†åŠ è½½è¿›æ¥çš„å‚æ•°å¯¼å…¥ç½‘ç»œä¸­</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#image = plt.imread(&#x27;test_images/&#123;&#125;.jpg&#x27;.format(0))       # è¯»å–ç…§ç‰‡</span><br><span class="hljs-comment">#plt.imshow(image)</span><br><br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">from</span> mnist_net_work2 <span class="hljs-keyword">import</span> Network2<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br>model = Network2()                  <span class="hljs-comment">#å®ä¾‹åŒ–å¾—åˆ°ä¸€ä¸ªç½‘ç»œæ¨¡å‹</span><br>model_state_dict = torch.load(<span class="hljs-string">&#x27;mnist_net_work2.pt&#x27;</span>)   <span class="hljs-comment">#åŠ è½½æ¨¡å‹å‚æ•°</span><br>model.load_state_dict(model_state_dict)   <span class="hljs-comment">#å°†åŠ è½½è¿›æ¥çš„æ¨¡å‹å‚æ•°å¯¼å…¥åˆ°ç½‘ç»œï¼ˆæ¨¡å‹ï¼‰ä¸­</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">30</span>):<br>    image = plt.imread(<span class="hljs-string">&#x27;test_images/&#123;&#125;.jpg&#x27;</span>.<span class="hljs-built_in">format</span>(i))   <span class="hljs-comment">#è¯»å–ç…§ç‰‡ã€‚imageçš„ç±»å‹æ˜¯ numpy.ndarray</span><br>    image = torch.tensor(image/<span class="hljs-number">255</span>, dtype=torch.float32)           <span class="hljs-comment">#è½¬æ¢æˆtensorç±»å‹</span><br>    image = image.view(<span class="hljs-number">1</span>, <span class="hljs-number">28</span>, <span class="hljs-number">28</span>)       <span class="hljs-comment">#æ•°æ®ç»“æ„ç”±äºŒç»´è½¬æˆä¸‰ç»´</span><br>    y_pre = model(image)                       <span class="hljs-comment">#æ‰§è¡Œé¢„æµ‹</span><br>    result = y_pre.data.numpy().argmax(axis=<span class="hljs-number">1</span>)          <span class="hljs-comment">#å¤„ç†é¢„æµ‹è¿”å›æ•°æ®ï¼Œè·å–é¢„æµ‹åˆ°çš„æ•°å­—</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;é¢„æµ‹ç…§ç‰‡&#123;&#125;.jpg çš„æ•°å­—æ˜¯ï¼š&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(i, result))<br></code></pre></td></tr></table></figure><table><thead><tr><th>ID</th><th>Name</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td>1</td><td>enqueue</td><td>Y</td><td>åˆ¤æ–­é›†ç¾¤ä¸­çš„ç©ºé—²èµ„æºæ˜¯å¦èƒ½æ»¡è¶³ä½œä¸šè°ƒåº¦çš„åŸºæœ¬éœ€æ±‚ï¼Œå¦‚æœèƒ½ï¼Œåˆ™å°†ä½œä¸šçš„podgroupè®¾ç½®ä¸º inqueueçŠ¶æ€ï¼Œå¦åˆ™ä¿æŒpodgroupä¸ºpendingçŠ¶æ€ã€‚</td></tr><tr><td>2</td><td>allocate</td><td>Y</td><td>å°è¯•ä¸ºinqueueçŠ¶æ€çš„podgroupä½œä¸šåˆ†é…èµ„æºã€‚</td></tr><tr><td>3</td><td>backfill</td><td>N</td><td>å°è¯•ä¸ºæœªæŒ‡æ˜podèµ„æºç”³è¯·é‡çš„ä½œä¸šåˆ†é…èµ„æºã€‚</td></tr><tr><td>4</td><td>preempt</td><td>N</td><td>è¯†åˆ«é«˜ä¼˜å…ˆçº§çš„è°ƒåº¦ä½œä¸šã€‚å°è¯•é©±é€ä½ä¼˜å…ˆçº§çš„Podï¼Œå¹¶ä¸ºé«˜ä¼˜å…ˆçº§ä½œä¸šåˆ†é…èµ„æºã€‚</td></tr><tr><td>5</td><td>reclaim</td><td>N</td><td>é€‰æ‹©èµ„æºè¢«å…¶ä»–queueå ç”¨çš„queueï¼Œå¹¶å›æ”¶ç›¸åº”èµ„æºã€‚</td></tr><tr><td>6</td><td>shuffle</td><td>N</td><td>å°†ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡é¡ºåºéšæœºåŒ–ï¼Œæé«˜èµ„æºåˆ©ç”¨ç‡ã€ä¼˜åŒ–è°ƒåº¦æ€§èƒ½</td></tr></tbody></table><table><thead><tr><th>ID</th><th>Name</th><th>Arguments</th><th>Registered Functions</th><th>Description</th></tr></thead><tbody><tr><td>1</td><td>binpack</td><td>* binpack.weight <br />* binpack.cpu <br />* binpack.memory <br />* binpack.resources</td><td>* nodeOrderFn</td><td>å°½é‡å°†Podç»‘å®šåˆ°èµ„æºåˆ©ç”¨ç‡é«˜çš„èŠ‚ç‚¹ä¸Šï¼Œ ä»¥å‡å°‘ç¢ç‰‡åŒ–ã€‚</td></tr><tr><td>2</td><td>conformance</td><td>&#x2F;</td><td>* preemptableFn <br />* reclaimableFn</td><td>è·³è¿‡å…³é”®Podï¼Œè€Œä¸æ˜¯é©±é€å®ƒä»¬ã€‚</td></tr><tr><td>3</td><td>drf</td><td>&#x2F;</td><td>* preemptableFn <br />* queueOrderFn <br />* reclaimFn <br />* jobOrderFn <br />* namespaceOrderFn</td><td>ä¸ºæ‰€æœ‰é˜Ÿåˆ—æä¾›å…¬å¹³çš„èµ„æºå…±äº«ã€‚</td></tr><tr><td><strong>ID</strong></td><td><strong>Name</strong></td><td><strong>Arguments</strong></td><td><strong>Registered Functions</strong></td><td><strong>Description</strong></td></tr><tr><td>4</td><td>extender</td><td>* extender.urlPrefix <br />* extender.httpTimeout <br />* extender.onSessionOpenVerb <br />* extender.onSessionCloseVerb <br />* extender.predicateVerb <br />* extender.prioritizeVerb <br />* extender.preemptableVerb <br />* extender.reclaimableVerb <br />* extender.queueOverusedVerb <br />* extender.jobEnqueueableVerb <br />* extender.ignorable</td><td>* predicateFn <br />* batchNodeOrderFn <br />* preemptableFn <br />* reclaimableFn <br />* jobEnqueueableFn <br />* overusedFn</td><td>æ·»åŠ å¤–éƒ¨http serverï¼Œç”¨ ä»¥æ‰§è¡Œè‡ªå®šä¹‰actionã€‚</td></tr><tr><td>5</td><td>gang</td><td>&#x2F;</td><td>* jobValidFn <br />* reclaimableFn <br />* preemptableFn <br />* jobOrderFn <br />* JobReadyFn <br />* jobPipelineFn <br />* jobStarvingFn</td><td>ä¸ºä½œä¸šåˆ†é…èµ„æºæ—¶ï¼Œé‡ç‚¹ è€ƒè™‘ä½œä¸šçš„æœ€ä½èµ„æºéœ€æ±‚ å’Œpodæœ€å°è¿è¡Œæ•°é‡ï¼Œæ‰§ è¡Œâ€œAll or nothingâ€çš„è°ƒåº¦ ç­–ç•¥ã€‚</td></tr><tr><td>6</td><td>nodeorder</td><td>* nodeaffinity.weight <br />* podaffinity.weight <br />* leastrequested.weight <br />* balancedresource.weight <br />* mostrequested.weight <br />* tainttoleration.weight <br />* imagelocality.weight</td><td>* nodeOrderFn <br />* batchNodeOrderFn</td><td>ä»¥è‡ªå®šä¹‰çš„æ–¹å¼å¯¹æ‰€æœ‰èŠ‚ç‚¹ è¿›è¡Œæ’åºã€‚</td></tr><tr><td><strong>ID</strong></td><td><strong>Name</strong></td><td><strong>Arguments</strong></td><td><strong>Registered Functions</strong></td><td><strong>Description</strong></td></tr><tr><td>7</td><td>numaaware</td><td>* weight</td><td>* predicateFn <br />* batchNodeOrderFn</td><td>åœ¨å°†podç»‘å®šåˆ°nodeèŠ‚ç‚¹æ—¶ï¼Œ é‡ç‚¹è€ƒè™‘CPU Numaå› ç´ ã€‚</td></tr><tr><td>8</td><td>overcommit</td><td>* overcommit-factor</td><td>* jobEnqueueableFn <br />* jobEnqueuedFn</td><td>å°†å¯ç”¨èµ„æºè®¾ç½®ä¸ºç¾¤é›†æ•´ä½“ èµ„æºçš„æŒ‡å®šå€æ•°ã€‚</td></tr><tr><td>9</td><td>predicate</td><td>* predicate.GPUSharingEnable <br />* predicate.CacheEnable <br />* predicate.ProportionalEnable <br />* predicate.resources <br />* predicate.resources.nvidia.com&#x2F;gpu.cpu <br />* predicate.resources.nvidia.com&#x2F;gpu.memory</td><td>* predicateFn</td><td>æ·»åŠ å…³äºå¦‚ä½•ä¸ºpodè°ƒåº¦è¿‡æ»¤ nodeçš„è‡ªå®šä¹‰å‡½æ•°ã€‚</td></tr><tr><td>10</td><td>priority</td><td>&#x2F;</td><td>* taskOrderFn <br />* jobOrderFn <br />* preemptableFn <br />* jobStarvingFn</td><td>å®šä¹‰è°ƒåº¦ä½œä¸šçš„ä¼˜å…ˆçº§ã€‚</td></tr><tr><td>11</td><td>proportion</td><td>&#x2F;</td><td>* queueOrderFn <br />* reclaimableFn <br />* overusedFn <br />* allocatableFn <br />* jobEnqueueableFn</td><td>æ ¹æ®queueçš„é…ç½®ï¼Œå°†é›†ç¾¤çš„æ•´ ä¸ªèµ„æºæŒ‰æ¯”ä¾‹åˆ’åˆ†åˆ°æ‰€æœ‰çš„ queueã€‚</td></tr><tr><td><strong>ID</strong></td><td><strong>Name</strong></td><td><strong>Arguments</strong></td><td><strong>Registered Functions</strong></td><td><strong>Description</strong></td></tr><tr><td>12</td><td>sla</td><td>* sla-waiting-time</td><td>* jobOrderFn <br />* jobEnqueueableFn <br />* JobPipelinedFn</td><td>æ ¹æ®SLAè®¾ç½®å¯¹å·¥ä½œè´Ÿè½½è¿›è¡Œæ’åºã€‚</td></tr><tr><td>13</td><td>task-topology</td><td>&#x2F;</td><td>* taskOrderFn <br />* nodeOrderFn</td><td>æ ¹æ®ç»™å®šç­–ç•¥ï¼Œå°†ä¸åŒè§’è‰²çš„Podç»‘å®šåˆ°èŠ‚ç‚¹ä¸Šã€‚</td></tr><tr><td>14</td><td>tdm</td><td>* tdm.revocable-zone.rz1 <br />* tdm.revocable-zone.rz2 <br />* tdm.evict.period</td><td>* predicateFn <br />* nodeOrderFn <br />* preemptableFn <br />* victimTasksFn <br />* jobOrderFn <br />* jobPipelinedFn <br />* jobStarvingFn</td><td>åœ¨ä¸åŒçš„æ—¶é—´æ®µå†…ï¼Œå…è®¸éƒ¨åˆ†èŠ‚ç‚¹æ‰¿æ¥K8så’Œå…¶ä»– é›†ç¾¤çš„ä½œä¸šè°ƒåº¦ã€‚</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>æœºå™¨å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>PyTorchæ¡†æ¶åŸºç¡€å®è·µ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¤§æ¨¡å‹ä¸AIGCæ¦‚è¿°</title>
    <link href="/2025/03/01/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E4%B8%8EAIGC%E6%A6%82%E8%BF%B0/"/>
    <url>/2025/03/01/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E4%B8%8EAIGC%E6%A6%82%E8%BF%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€å¤§æ¨¡å‹æ˜¯ä»€ä¹ˆ"><a href="#ä¸€ã€å¤§æ¨¡å‹æ˜¯ä»€ä¹ˆ" class="headerlink" title="ä¸€ã€å¤§æ¨¡å‹æ˜¯ä»€ä¹ˆ"></a>ä¸€ã€å¤§æ¨¡å‹æ˜¯ä»€ä¹ˆ</h1><p>å°†ä»¥å›½äº§å¤§æ¨¡å‹é˜¿é‡Œå·´å·´å…¬å¸æ¨å‡ºçš„â€œ<a href="https://tongyi.aliyun.com/">é€šä¹‰åƒé—®</a>â€ä¸ºä¾‹å­è¿›è¡Œæ¼”ç¤ºã€‚å®ƒéœ€è¦æå‰æ³¨å†Œè´¦å·ï¼ˆå…¶å®ç”¨æ”¯ä»˜å®æˆ–æ·˜å®è´¦å·ä¹Ÿèƒ½ç™»å½•ï¼‰æ¯”å¦‚ç”¨æ‰‹æœºå·è¿›è¡Œæ³¨å†Œç™»å½•ã€‚</p><p><img src="https://s2.loli.net/2025/02/25/l7fN8wIWLJeOPaz.png" alt="image-20250225120223430"></p><h2 id="1-1-å¤§æ¨¡å‹çš„å®šä¹‰"><a href="#1-1-å¤§æ¨¡å‹çš„å®šä¹‰" class="headerlink" title="1.1 å¤§æ¨¡å‹çš„å®šä¹‰"></a>1.1 å¤§æ¨¡å‹çš„å®šä¹‰</h2><p>èµ·æºï¼šå¤§è¯­è¨€æ¨¡å‹ï¼ˆLarge language Modelsï¼ŒLLMsï¼‰ï¼Œå›´ç»•è‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡è€Œåˆ›å»ºçš„ä¸€ç³»åˆ—æ¨¡å‹ã€‚</p><p>å‘å±•ï¼šåŸºç¡€æ¨¡å‹ï¼ˆFoundation Modelsï¼‰ï¼Œå¯ä»¥å¤„ç†å¤šæ¨¡æ€æ•°æ®ï¼Œä¸å±€é™äºè‡ªç„¶è¯­è¨€ã€‚</p><p>ä¸‹å›¾ç²—ç•¥åœ°æ¦‚æ‹¬äº†å·¥äººæ™ºèƒ½ã€æœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹ ã€å¤§æ¨¡å‹ä¹‹é—´çš„å…³ç³»ã€‚</p><p><img src="https://s2.loli.net/2025/02/25/6BRsMmWC4eXpoGi.png" alt="image-20250225205847972"></p><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>å®šä¹‰1ï¼šæ˜¯ä¸€ç§ç”±åŒ…å«æ•°ç™¾äº¿ä»¥ä¸Šå‚æ•°çš„æ·±åº¦ç¥ç»ç½‘ç»œæ„å»ºçš„è¯­è¨€æ¨¡å‹ï¼Œé€šå¸¸ä½¿ç”¨<strong>è‡ªç›‘ç£å­¦ä¹ </strong>æ–¹æ³•ï¼Œé€šè¿‡å¤§é‡<strong>æ— æ ‡æ³¨æ–‡æœ¬</strong>è¿›è¡Œè®­ç»ƒã€‚â€”å‡ºè‡ªä¹¦ç±ã€Šå¤§è§„æ¨¡è¯­è¨€æ¨¡å‹ä»ç†è®ºåˆ°å®è·µã€‹</p><p>å®šä¹‰2ï¼šä»»æ„çš„åœ¨å¤§è§„æ¨¡æ•°æ®ä¸Šè®­ç»ƒå¹¶ä¸”å¯ä»¥é€‚é…ï¼ˆä¾‹å¦‚å¾®è°ƒï¼‰å¹¿æ³›ä¸‹æ¸¸ä»»åŠ¡çš„æ¨¡å‹ã€‚â€”å‡ºè‡ªè®ºæ–‡ã€ŠOn the Opportunities and Risks of Foundation Modelsã€‹</p><h3 id="å‘æ•£æ€è€ƒä¸å­¦ä¹ å†…å®¹"><a href="#å‘æ•£æ€è€ƒä¸å­¦ä¹ å†…å®¹" class="headerlink" title="å‘æ•£æ€è€ƒä¸å­¦ä¹ å†…å®¹"></a>å‘æ•£æ€è€ƒä¸å­¦ä¹ å†…å®¹</h3><ul><li>è‡ªç›‘ç£å­¦ä¹ </li></ul><p><strong>è‡ªç›‘ç£å­¦ä¹ </strong>æ˜¯ä¸€ç§<strong>æœºå™¨å­¦ä¹ èŒƒå¼</strong>ï¼Œå®ƒä¸ä¾èµ–äººå·¥æ ‡æ³¨çš„æ•°æ®ï¼Œè€Œæ˜¯é€šè¿‡æ•°æ®è‡ªèº«æä¾›çš„<strong>å†…åœ¨ç»“æ„</strong>æˆ–<strong>éšè—ä¿¡æ¯</strong>æ¥ç”Ÿæˆç›‘ç£ä¿¡å·ï¼Œä»è€Œè¿›è¡Œæ¨¡å‹è®­ç»ƒã€‚å®ƒå¯ä»¥è¢«çœ‹ä½œæ˜¯ä¸€ç§ç‰¹æ®Šçš„<strong>æ— ç›‘ç£å­¦ä¹ </strong>ï¼Œå› ä¸ºå®ƒä¸éœ€è¦äººå·¥æ ‡ç­¾ï¼Œä½†å®ƒçš„è®­ç»ƒæ–¹å¼ç±»ä¼¼äºç›‘ç£å­¦ä¹ ã€‚</p><ul><li>æ— æ ‡æ³¨æ–‡æœ¬</li></ul><p>æ— æ ‡æ³¨æ–‡æœ¬ï¼ˆUnlabeled Textï¼‰æŒ‡çš„æ˜¯<strong>æ²¡æœ‰é™„åŠ äººå·¥æ ‡æ³¨ä¿¡æ¯</strong>çš„æ–‡æœ¬æ•°æ®ï¼Œé€šå¸¸åªæ˜¯<strong>åŸå§‹çš„è‡ªç„¶è¯­è¨€æ•°æ®</strong>ï¼Œä¸åŒ…å«ç±»åˆ«æ ‡ç­¾ã€æƒ…æ„Ÿè¯„åˆ†ã€å®ä½“æ ‡æ³¨ç­‰é¢å¤–ä¿¡æ¯ã€‚</p><p>æ— æ ‡æ³¨æ–‡æœ¬åœ¨**è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰<strong>ä»»åŠ¡ä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå°¤å…¶åœ¨</strong>è‡ªç›‘ç£å­¦ä¹ ï¼ˆSelf-Supervised Learningï¼‰<strong>å’Œ</strong>æ— ç›‘ç£å­¦ä¹ ï¼ˆUnsupervised Learningï¼‰**ä¸­ï¼Œå®ƒä»¬ç”¨äºé¢„è®­ç»ƒè¯­è¨€æ¨¡å‹ï¼Œå¸®åŠ©æ¨¡å‹å­¦ä¹ è¯­è¨€ç»“æ„å’Œè¯­ä¹‰ä¿¡æ¯ï¼Œè€Œæ— éœ€äººå·¥æ ‡æ³¨æ•°æ®ã€‚</p><h2 id="1-2-å¤§æ¨¡å‹çš„ç‰¹æ€§"><a href="#1-2-å¤§æ¨¡å‹çš„ç‰¹æ€§" class="headerlink" title="1.2 å¤§æ¨¡å‹çš„ç‰¹æ€§"></a>1.2 å¤§æ¨¡å‹çš„ç‰¹æ€§</h2><h3 id="åŸºæœ¬ç‰¹ç‚¹"><a href="#åŸºæœ¬ç‰¹ç‚¹" class="headerlink" title="åŸºæœ¬ç‰¹ç‚¹"></a>åŸºæœ¬ç‰¹ç‚¹</h3><p>1.å¤§è§„æ¨¡å‚æ•°é‡ï¼Œè¶…è¿‡ç™¾äº¿å‚æ•°è§„æ¨¡çš„ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚</p><p>2.å¤§è§„æ¨¡è®­ç»ƒæ•°æ®ï¼Œé€šè¿‡æµ·é‡æ•°æ®è¿›è¡Œè‡ªç›‘ç£é¢„è®­ç»ƒã€‚</p><p>3.æ¶Œç°èƒ½åŠ›ï¼Œè¡¨ç°å‡ºäº†äººç±»æ‰ä¼šæœ‰çš„æ™ºèƒ½ï¼ˆä¸Šä¸‹æ–‡å­¦ä¹ ã€æ€ç»´é“¾ï¼‰ã€‚</p><p>4.å¤šæ¨¡æ€æ•°æ®å¤šé¢†åŸŸé€‚åº”æ€§ï¼ˆé€šç”¨äººå·¥æ™ºèƒ½ï¼ŒAGIï¼Œartificial general intelligenceï¼‰ï¼Œç»é€‚å½“å¾®è°ƒæˆ–æç¤ºï¼Œèƒ½åº”ç”¨äºä¸åŒé¢†åŸŸï¼Œä¸”æ•ˆæœæ˜¾è‘—ã€‚</p><p>5.è¶…é•¿ä¸Šä¸‹æ–‡æ„ŸçŸ¥ï¼ŒåŸºäºTransformersçš„æ³¨æ„åŠ›æœºåˆ¶ï¼ˆ<a href="https://arxiv.org/abs/1706.03762">Googleçš„è®ºæ–‡ã€ŠAttention is All You Needã€‹</a>ï¼‰ä¿è¯å…¶èƒ½å……åˆ†ç†è§£ä¿¡æ¯ï¼Œå¹¶åšå‡ºåˆç†æ¨æ–­ã€‚</p><p>6.ä¸æ˜¯æœç´¢å¼•æ“ï¼Œæ— æ³•æ„ŸçŸ¥å®æ—¶æ•°æ®ã€‚ï¼ˆè¿™ä¸ªä¸è¶³å¯ä»¥èƒ½è¿‡è”ç½‘æœç´¢æ¥åŠ ä»¥å¼¥è¡¥ï¼Œä½†ä¸æ˜¯å¤§æ¨¡å‹æœ¬èº«çš„æ¨ç†èƒ½åŠ›å³ç¦»å¼€äº†äº’è”ç½‘å¤§æ¨¡å‹å°†ç¼ºå¤±è¿™ç§èƒ½åŠ›ï¼‰</p><h3 id="å…¶ä»–ç‰¹ç‚¹"><a href="#å…¶ä»–ç‰¹ç‚¹" class="headerlink" title="å…¶ä»–ç‰¹ç‚¹"></a>å…¶ä»–ç‰¹ç‚¹</h3><p>1.æ¨¡å‹åŒè´¨åŒ–ã€‚å½“å‰å¤§æ¨¡å‹éƒ½æ˜¯ä»¥Transformerä¸ºåŸºç¡€è¡ç”Ÿè€Œæ¥çš„</p><p>2.å¤§åŠ›å‡ºå¥‡è¿¹ã€‚<strong>å‚æ•°è§„æ¨¡</strong>ä¸<strong>é¢„è®­ç»ƒè¯­æ–™é‡çº§</strong>æ˜¯æ¨¡å‹æ€§èƒ½çš„å…³é”®å½±å“å› ç´ ã€‚ä¾‹å¦‚ä¸GPT-2çš„15äº¿å‚æ•°ç›¸æ¯”ï¼ŒGPT-3æœ‰1750äº¿ä¸ªå‚æ•°ï¼Œä»è€Œåœ¨æ€§èƒ½æ–¹é¢æœ‰å…³è´¨çš„æå‡ã€‚</p><p>3.ä»å¼€æºèµ°å‘é—­æºã€‚æŸäº›æ¨¡å‹æ ¹æœ¬ä¸ä¼šå¯¹å¤–å‘å¸ƒæˆ–åªå¯¹å°‘æ•°æä¾›APIè®¿é—®æƒé™ï¼ˆå¦‚openaiçš„æ¨¡å‹ï¼‰ï¼Œç”šè‡³ä¸€äº›æ•°æ®é›†ï¼ˆå¦‚GPT-2ï¼‰ä¹Ÿæ²¡æœ‰å…¬å¼€å‘å¸ƒ</p><p>4.å¤´éƒ¨å„æ–­ã€‚ç”±äºæ•°æ®èµ„æºä¸ç®—åŠ›åˆ¶çº¦ï¼Œä¸­å°å‹ä¼ä¸šåŸºæœ¬æ— æ³•ä¸å¤´éƒ¨ç§‘æŠ€å…¬å¸ç«äº‰ã€‚</p><h3 id="å…¸å‹ä»£è¡¨ï¼ˆå›½å¤–ï¼‰"><a href="#å…¸å‹ä»£è¡¨ï¼ˆå›½å¤–ï¼‰" class="headerlink" title="å…¸å‹ä»£è¡¨ï¼ˆå›½å¤–ï¼‰"></a>å…¸å‹ä»£è¡¨ï¼ˆå›½å¤–ï¼‰</h3><ol><li>GPTç³»åˆ—ï¼š<a href="https://chat.openai.com/">https://chat.openai.com/</a></li><li>è°·æ­Œgeminiï¼š<a href="https://gemini.google.com/">https://gemini.google.com/</a></li><li>å¾®è½¯Copilotï¼š<a href="https://www.bing.com/chat">https://www.bing.com/chat</a></li><li>Metaçš„Llamaï¼š<a href="https://llama.meta.com/llama2">https://llama.meta.com/llama2</a></li><li>Claudeç³»åˆ—ï¼š<a href="https://claude.ai/">https://claude.ai</a></li><li>XAIçš„grokï¼š<a href="https://x.aiã€https//grok.com/">https://x.aiã€https://grok.com/</a></li><li>MistralAIï¼š<a href="https://mistralai7b.com/">https://mistralai7b.com/</a></li></ol><h3 id="å…¸å‹ä»£è¡¨ï¼ˆå›½å†…ï¼‰"><a href="#å…¸å‹ä»£è¡¨ï¼ˆå›½å†…ï¼‰" class="headerlink" title="å…¸å‹ä»£è¡¨ï¼ˆå›½å†…ï¼‰"></a>å…¸å‹ä»£è¡¨ï¼ˆå›½å†…ï¼‰</h3><ol><li>é€šä¹‰åƒé—®ï¼š<a href="https://tongyi.aliyun.com/qianwen/">https://tongyi.aliyun.com/qianwen/</a></li><li>æ–‡å¿ƒä¸€è¨€ï¼š<a href="https://yiyan.baidu.com/welcome">https://yiyan.baidu.com/welcome</a></li><li>æ™ºè°±æ¸…è¨€ï¼š<a href="https://chatglm.cn/main/detail">https://chatglm.cn/main/detail</a></li><li>ç™¾å·å¤§æ¨¡å‹ï¼š<a href="https://www.baichuan-ai.com/home">https://www.baichuan-ai.com/home</a></li><li>è±†åŒ…ï¼š<a href="https://www.doubao.com/">https://www.doubao.com/</a></li><li>è®¯é£æ˜Ÿç«ï¼š<a href="https://xinghuo.xfyun.cn/">https://xinghuo.xfyun.cn/</a></li><li>å¤©å·¥ï¼š<a href="https://www.tiangong.cn/">https://www.tiangong.cn/</a></li><li>å•†æ±¤å•†é‡ï¼š<a href="https://chat.sensetime.com/wb/login">https://chat.sensetime.com/wb/login</a></li><li>è…¾è®¯æ··å…ƒå¤§æ¨¡å‹ï¼š<a href="https://hunyuan.tencent.com/?ref=feizhuke.com">https://hunyuan.tencent.com/?ref=feizhuke.com</a></li><li>Kimiï¼š<a href="https://kimi.moonshot.cn/">https://kimi.moonshot.cn/</a></li><li>åä¸ºç›˜å¤å¤§æ¨¡å‹ï¼ˆéœ€æå‰ç”³è¯·ï¼‰ï¼š<a href="https://www.huaweicloud.com/product/pangu.html">https://www.huaweicloud.com/product/pangu.html</a></li><li>360æ™ºè„‘ï¼š<a href="https://chat.360.com/?src=ai_360_com">https://chat.360.com/?src=ai_360_com</a></li><li>æ·±åº¦æ±‚ç´¢DeepSeekï¼š<a href="https://chat.deepseek.com/">https://chat.deepseek.com/</a></li></ol><h2 id="1-3-å¤§æ¨¡å‹èƒ½åšä»€ä¹ˆ"><a href="#1-3-å¤§æ¨¡å‹èƒ½åšä»€ä¹ˆ" class="headerlink" title="1.3 å¤§æ¨¡å‹èƒ½åšä»€ä¹ˆ"></a>1.3 å¤§æ¨¡å‹èƒ½åšä»€ä¹ˆ</h2><ol><li>æ–‡æœ¬ç”Ÿæˆï¼šé—®é¢˜å›ç­”ã€æ–‡ç¨¿æ’°å†™ã€ä»£ç ç”Ÿæˆã€æ•°å­¦è§£é¢˜ã€‚</li><li>æ™ºèƒ½å®¢æœï¼šåŒ…æ‹¬é€šç”¨èŠå¤©æœºå™¨äººå’ŒåŸºäºRAGæŠ€æœ¯çš„å‚ç›´é¢†åŸŸæœºå™¨äººã€‚</li><li>æœºå™¨ç¿»è¯‘ï¼šç”Ÿæˆç›®æ ‡è¯­è¨€çš„é«˜è´¨é‡è¯‘æ–‡ã€‚</li><li>æ–‡æœ¬æ‘˜è¦ï¼šå¯¹äºé•¿ç¯‡æ–‡ç« æˆ–æŠ¥å‘Šï¼Œæ¨¡å‹å¯ä»¥æç‚¼å…³é”®ä¿¡æ¯ç”Ÿæˆç®€æ´çš„æ‘˜è¦ã€‚</li><li>æƒ…æ„Ÿåˆ†æï¼šåˆ†ææ–‡æœ¬ä¸­çš„æƒ…æ„Ÿè‰²å½©ï¼Œåˆ¤æ–­ä½œè€…çš„æ€åº¦æ˜¯æ­£é¢ã€è´Ÿé¢è¿˜æ˜¯ä¸­ç«‹ã€‚</li><li>è§†è§‰ä»»åŠ¡ï¼šæ–‡ç”Ÿå›¾ã€æ–‡ç”Ÿè§†é¢‘ã€çœ‹å›¾è¯´è¯ç­‰</li></ol><h2 id="1-4-å¤§æ¨¡å‹åº”ç”¨"><a href="#1-4-å¤§æ¨¡å‹åº”ç”¨" class="headerlink" title="1.4 å¤§æ¨¡å‹åº”ç”¨"></a>1.4 å¤§æ¨¡å‹åº”ç”¨</h2><ol><li><p>åŒ»ç–—ä¿å¥å’Œç”Ÿç‰©åŒ»å­¦ã€ŠOn the Opportunities and Risks of Foundation Modelsã€‹</p></li><li><p>æ³•å¾‹ã€ŠOn the Opportunities and Risks of Foundation Modelsã€‹</p><p>æ°‘äº‹æ¡ˆä»¶å„ä¸ªæ­¥éª¤çš„ç¤ºä¾‹ä»¥åŠåŸºç¡€æ¨¡å‹å¯èƒ½æœ‰å¸®åŠ©çš„åœ°æ–¹</p></li><li><p>æ•™è‚²ã€ŠOn the Opportunities and Risks of Foundation Modelsã€‹</p></li></ol><h1 id="äºŒã€å¤§æ¨¡å‹çš„å‰ä¸–ä»Šç”Ÿ"><a href="#äºŒã€å¤§æ¨¡å‹çš„å‰ä¸–ä»Šç”Ÿ" class="headerlink" title="äºŒã€å¤§æ¨¡å‹çš„å‰ä¸–ä»Šç”Ÿ"></a>äºŒã€å¤§æ¨¡å‹çš„å‰ä¸–ä»Šç”Ÿ</h1><h2 id="2-1-ä»ç¥ç»ç½‘ç»œåˆ°å¤§æ¨¡å‹"><a href="#2-1-ä»ç¥ç»ç½‘ç»œåˆ°å¤§æ¨¡å‹" class="headerlink" title="2.1 ä»ç¥ç»ç½‘ç»œåˆ°å¤§æ¨¡å‹"></a>2.1 ä»ç¥ç»ç½‘ç»œåˆ°å¤§æ¨¡å‹</h2><ol><li>å•å±‚æ„ŸçŸ¥æœºï¼ˆè§£å†³çº¿æ€§å¯åˆ†é—®é¢˜ï¼Œ20ä¸–çºª40å¹´ä»£ï¼‰ </li><li>BPä¼ æ’­ç®—æ³•ï¼ˆè§£å†³çº¿æ€§ä¸å¯åˆ†é—®é¢˜ï¼Œ20ä¸–çºª80å¹´ä»£ï¼‰</li><li>æ·±åº¦ç¥ç»ç½‘ç»œï¼ˆæµ·é‡å›¾ç‰‡åˆ†ç±»ï¼Œ2010å¹´å·¦å³ï¼‰</li><li>å¤§æ¨¡å‹&#x2F;åŸºç¡€æ¨¡å‹ï¼ˆé€šç”¨äººå·¥æ™ºèƒ½ï¼Œ2020å¹´å·¦å³ï¼‰</li></ol><h2 id="2-2-å¤§æ¨¡å‹å‘å±•å¤§äº‹ä»¶"><a href="#2-2-å¤§æ¨¡å‹å‘å±•å¤§äº‹ä»¶" class="headerlink" title="2.2 å¤§æ¨¡å‹å‘å±•å¤§äº‹ä»¶"></a>2.2 å¤§æ¨¡å‹å‘å±•å¤§äº‹ä»¶</h2><ol><li>2017å¹´è°·æ­Œå‘è¡¨è®ºæ–‡ã€ŠAttention Is All You Needã€‹ï¼Œæ­£å¼æå‡ºTransformerç½‘ç»œï¼Œé©<strong>RNN</strong>ï¼ˆå¾ªç¯ç¥ç»ç½‘ç»œï¼ŒRecurrent Neural Networkï¼‰&#x2F;<strong>CNN</strong>ï¼ˆå·ç§¯ç¥ç»ç½‘ç»œï¼ŒConvolutional Neural Networkï¼‰çš„å‘½ã€‚</li><li>2018å¹´OPENAIå‘è¡¨è®ºæ–‡ã€ŠImproving Language Understanding by Generative Pre-Trainingã€‹å³â€œé€šè¿‡ç”Ÿæˆå¼é¢„è®­ç»ƒæé«˜è¯­è¨€ç†è§£èƒ½åŠ›â€ï¼ŒGPTè¯ç”Ÿã€‚</li><li>2018å¹´Googleå‘å¸ƒBERTï¼Œè¯¥æ¨¡å‹åœ¨è¯¸å¤šè‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡ä¸­å±•ç°äº†å“è¶Šçš„æ€§èƒ½ï¼Œæ¿€å‘äº†å¤§é‡ä»¥é¢„è®­ç»ƒè¯­è¨€æ¨¡<br>å‹ä¸ºåŸºç¡€çš„è‡ªç„¶è¯­è¨€å¤„ç†ç ”ç©¶ã€‚</li><li>2020å¹´6æœˆï¼ŒOpenAIå‘å¸ƒäº† GPT-3æ¨¡å‹ã€‚</li><li>2022å¹´11æœˆï¼ŒChatGPTï¼ˆå°±æ˜¯GPT-3.5-turboï¼‰çš„é—®ä¸–å¼•çˆ†å…¨çƒå…³æ³¨ã€‚</li><li>2023å¹´åˆè‡³ä»Šï¼Œå„å¤§ç§‘æŠ€å…¬å¸çº·çº·æ¨å‡ºè‡ªå·±çš„å¤§æ¨¡å‹ï¼Œâ€œä¸‡æ¨¡å¤§æˆ˜â€å¼€å§‹ã€‚</li><li>2024å¹´12æœˆä¸‹æ—¬ä¸2025å¹´1æœˆä¸‹æ—¬ï¼ŒDeepSeekç›¸ç»§å‘å¸ƒ DeepSeek-V3 æ¨¡å‹ã€DeepSeek-R1 æ¨¡å‹ï¼Œåˆ›æ–°çš„æ¶æ„ä¸è®­ç»ƒæ–¹æ³•ã€ä½è®­ç»ƒæˆæœ¬ã€ä¼˜æƒ çš„APIè°ƒç”¨ä»·æ ¼ä¸å¼ºå¤§é«˜æ•ˆçš„è¯­è¨€å¤„ç†èƒ½åŠ›ï¼Œä½¿å…¶è¿…é€Ÿç«éå…¨çƒã€ç™»é¡¶ä¸­ç¾åº”ç”¨ä¸‹è½½æ¦œé¦–ï¼Œæˆä¸ºä¸­å›½éª„å‚²ä¸äº‰ç›¸å­¦ä¹ ã€æ¨å¹¿çš„å¯¹è±¡ã€ä»¥ç¾å›½ä¸ºé¦–çš„è¥¿æ–¹å¤§æ¨¡å‹å¼ºå›½ç ”ç©¶çš„å¯¹è±¡ã€‚</li></ol><p><img src="https://s2.loli.net/2025/02/25/lYWvqCp64LOV2wG.png" alt="image-20250225225633082"></p><h2 id="2-3-å¤§è¯­è¨€æ¨¡å‹çš„ä¸‰ä¸ªå‘å±•é˜¶æ®µ"><a href="#2-3-å¤§è¯­è¨€æ¨¡å‹çš„ä¸‰ä¸ªå‘å±•é˜¶æ®µ" class="headerlink" title="2.3 å¤§è¯­è¨€æ¨¡å‹çš„ä¸‰ä¸ªå‘å±•é˜¶æ®µ"></a>2.3 å¤§è¯­è¨€æ¨¡å‹çš„ä¸‰ä¸ªå‘å±•é˜¶æ®µ</h2><p>æ¥è‡ªå¤æ—¦å¤§å­¦å¼ å¥‡ç­‰äººç¼–å†™ä¹¦ç±ã€Šå¤§è§„æ¨¡è¯­è¨€æ¨¡å‹ä»ç†è®ºåˆ°å®è·µã€‹</p><ol><li><strong>åŸºç¡€æ¨¡å‹é˜¶æ®µ</strong>ï¼Œä¸»è¦é›†ä¸­åœ¨2018å¹´è‡³2021å¹´æœŸé—´ï¼ŒæœŸé—´å‘å¸ƒäº†ä¸€ç³»åˆ—ä»£è¡¨æ€§çš„å¤§è¯­è¨€æ¨¡å‹ï¼Œå¦‚BERTã€GPTã€ç™¾ åº¦ERNIEã€åä¸ºç›˜å¤-Î±ã€Palmç­‰ã€‚è¿™äº›æ¨¡å‹çš„å‘å¸ƒä¸ºå¤§è¯­è¨€æ¨¡å‹çš„ç ”ç©¶æ‰“ä¸‹äº†åŸºç¡€ã€‚</li><li><strong>èƒ½åŠ›æ¢ç´¢é˜¶æ®µ</strong>ï¼Œä¸»è¦å‘ç”Ÿåœ¨2019å¹´è‡³2022å¹´æœŸé—´ã€‚ç ”ç©¶äººå‘˜å¼€å§‹å°è¯•æŒ‡ä»¤å¾®è°ƒï¼ˆInstruction Tuningï¼‰æ–¹æ¡ˆï¼Œå°†å„ç§ç±»å‹çš„ä»»åŠ¡ç»Ÿä¸€ä¸º<em>ç”Ÿæˆå¼è‡ªç„¶è¯­è¨€ç†è§£æ¡†æ¶</em>ï¼Œå¹¶ä½¿ç”¨<em>æ„é€ çš„è®­ç»ƒè¯­æ–™</em>å¯¹æ¨¡å‹è¿›è¡Œå¾®è°ƒã€‚</li><li><strong>çªç ´å‘å±•é˜¶æ®µ</strong>ï¼Œä»¥2022å¹´11æœˆChatGPTçš„å‘å¸ƒä¸ºèµ·ç‚¹ã€‚ChatGPTé€šè¿‡ä¸€ä¸ªç®€å•çš„å¯¹è¯æ¡†ï¼Œåˆ©ç”¨ä¸€ä¸ªå¤§è¯­è¨€æ¨¡å‹å°±èƒ½å¤Ÿå®ç°é—®é¢˜å›ç­”ã€æ–‡ç¨¿æ’°å†™ã€ä»£ç ç”Ÿæˆã€æ•°å­¦è§£é¢˜ç­‰å¤šç§ä»»åŠ¡</li></ol><h1 id="ä¸‰ã€å¤§æ¨¡å‹çˆ†ç«çš„åŸå› "><a href="#ä¸‰ã€å¤§æ¨¡å‹çˆ†ç«çš„åŸå› " class="headerlink" title="ä¸‰ã€å¤§æ¨¡å‹çˆ†ç«çš„åŸå› "></a>ä¸‰ã€å¤§æ¨¡å‹çˆ†ç«çš„åŸå› </h1><h2 id="3-1-åŸå› ä¸€-èƒ½é€šè¿‡å›¾çµæµ‹è¯•"><a href="#3-1-åŸå› ä¸€-èƒ½é€šè¿‡å›¾çµæµ‹è¯•" class="headerlink" title="3.1 åŸå› ä¸€ èƒ½é€šè¿‡å›¾çµæµ‹è¯•"></a>3.1 åŸå› ä¸€ èƒ½é€šè¿‡å›¾çµæµ‹è¯•</h2><p><strong>è®©äººä»¬çœ‹åˆ°äº†é€šç”¨äººå·¥æ™ºèƒ½ä¹ƒè‡³å¼ºäººå·¥æ™ºèƒ½çš„å¸Œæœ›</strong></p><p>â¢ åŠŸèƒ½æå…¶å¼ºå¤§ï¼Œï¼ˆChatGPTï¼‰è¿œè¶…åŒæœŸå…¶ä»–æ¨¡å‹ </p><p>â¢ å¯ä»¥å®Œæˆè·¨é¢†åŸŸã€è·¨æ¨¡æ€ä»»åŠ¡</p><p>åœ¨ChatGPTä¹‹å‰ï¼Œè¿˜æ²¡æœ‰å¤§æ¨¡å‹èƒ½é€šè¿‡å›¾çµæµ‹è¯•ã€‚å®ƒä¸ä»…å¯ä»¥è¿›è¡Œæ—¥å¸¸å¯¹è¯ï¼Œè¿˜èƒ½å¤Ÿå®Œæˆå¤æ‚ä»»åŠ¡ï¼Œå¦‚æ’°å†™æ–‡ç« ã€å›ç­”é—®é¢˜ç­‰ã€‚ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œæ‰€æœ‰è¿™äº›ä»»åŠ¡ éƒ½ç”±ä¸€ä¸ªæ¨¡å‹å®Œæˆã€‚åœ¨è®¸å¤šä»»åŠ¡ä¸Šï¼ŒChatGPTçš„æ€§èƒ½ç”šè‡³è¶…è¿‡äº†é’ˆå¯¹å•ä¸€ä»»åŠ¡è¿›è¡Œè®­ç»ƒçš„æœ‰ç›‘ç£ç®—æ³•ã€‚è¿™å¯¹äº äººå·¥æ™ºèƒ½é¢† åŸŸå…·æœ‰é‡å¤§æ„ä¹‰ã€‚</p><hr><p><strong>æ³¨ï¼šä»€ä¹ˆæ˜¯å›¾çµæµ‹è¯•ï¼Ÿ</strong></p><ul><li>æµ‹è¯•è€…(äºº)ä¸è¢«æµ‹è¯•è€…(æœºå™¨)éš”å¼€</li><li>æµ‹è¯•è€…é€šè¿‡ä¸€äº›è£…ç½®(å¦‚é”®ç›˜)å‘è¢«æµ‹è¯•è€…éšæ„æé—®</li><li>æµ‹è¯•è€…æ ¹æ®æ‰€æ¥å—å›ç­”åˆ¤å®šå¯¹æ–¹æ˜¯äººæˆ–æœºå™¨</li><li>å¤šæ¬¡æµ‹è¯•åå¹³å‡æ¯ä¸ªæµ‹è¯•è€…åšå‡ºè¶…è¿‡30%çš„è¯¯åˆ¤(å°†æœºå™¨åˆ¤å®šæˆäºº)</li><li>è¿™å°æœºå™¨å°±è¢«è®¤ä¸ºå…·æœ‰äººç±»æ™ºèƒ½</li></ul><h2 id="3-2-åŸå› äºŒ-æå…·äº‰è®®çš„AIè§‰é†’"><a href="#3-2-åŸå› äºŒ-æå…·äº‰è®®çš„AIè§‰é†’" class="headerlink" title="3.2 åŸå› äºŒ æå…·äº‰è®®çš„AIè§‰é†’"></a>3.2 åŸå› äºŒ æå…·äº‰è®®çš„AIè§‰é†’</h2><ul><li>â€œChatGPTæ˜¯æˆ‘ä¸€ç”Ÿä¸­è§åˆ°çš„ä¸¤é¡¹æœ€å…·é©å‘½æ€§æŠ€æœ¯ä¹‹ä¸€â€â€”â€”æ¯”å°”ç›–èŒ¨</li><li>â€œAIå°†æ˜¯äººç±»æœªæ¥æ–‡æ˜çš„æœ€å¤§é£é™©ä¹‹ä¸€â€â€”â€”åŸƒéš†Â·é©¬æ–¯å…‹</li><li>â€œAIæ˜¯è°·æ­Œæ­£åœ¨å¼€å‘çš„æœ€æ·±å¥¥çš„æŠ€æœ¯â€â€”â€”è°·æ­ŒCEOæ¡‘è¾¾å°”â€¢çš®æŸ¥ä¼Š </li><li>â€œAIå°†é¢ è¦†ç¤¾ä¼šâ€â€”â€”å·´è²ç‰¹</li></ul><h2 id="3-3-åŸå› ä¸‰-ä½¿ç”¨æ–¹å¼æå…¶ç®€å•"><a href="#3-3-åŸå› ä¸‰-ä½¿ç”¨æ–¹å¼æå…¶ç®€å•" class="headerlink" title="3.3 åŸå› ä¸‰ ä½¿ç”¨æ–¹å¼æå…¶ç®€å•"></a>3.3 åŸå› ä¸‰ ä½¿ç”¨æ–¹å¼æå…¶ç®€å•</h2><p>åœ¨å¯¹è¯æ¡†ä¸­æå‡ºä½ çš„éœ€æ±‚å³å¯ï¼ŒChatGPTæ´»è·ƒç”¨æˆ·æ•°ä¸€ä¸ªæœˆå†…å°±ç ´äº¿ã€‚</p><p><img src="https://s2.loli.net/2025/02/25/fRtx65YhjZW7HmE.png" alt="image-20250225232920381"></p><h1 id="å››ã€å¤§æ¨¡å‹åŸç†ä»‹ç»"><a href="#å››ã€å¤§æ¨¡å‹åŸç†ä»‹ç»" class="headerlink" title="å››ã€å¤§æ¨¡å‹åŸç†ä»‹ç»"></a>å››ã€å¤§æ¨¡å‹åŸç†ä»‹ç»</h1><h2 id="4-1-GPT-ç”Ÿæˆå¼æ¨¡å‹-çš„å·¥ä½œè¿‡ç¨‹-å•å­—æ¥é¾™"><a href="#4-1-GPT-ç”Ÿæˆå¼æ¨¡å‹-çš„å·¥ä½œè¿‡ç¨‹-å•å­—æ¥é¾™" class="headerlink" title="4.1 GPT(ç”Ÿæˆå¼æ¨¡å‹)çš„å·¥ä½œè¿‡ç¨‹:å•å­—æ¥é¾™"></a>4.1 GPT(ç”Ÿæˆå¼æ¨¡å‹)çš„å·¥ä½œè¿‡ç¨‹:å•å­—æ¥é¾™</h2><p>GPTæ˜¯è‹±æ–‡â€œGenerative Pre-trained Transformerâ€çš„ç¼©å†™ï¼Œå®ƒçš„ä¸­æ–‡å…¨ç§°æ˜¯ç”Ÿæˆå¼é¢„è®­ç»ƒå˜æ¢å™¨ï¼Œæ˜¯ä¸€ç§ç”Ÿæˆå¼æ¨¡å‹ã€‚</p><hr><p>æ¨¡å‹è¾“å…¥ï¼šæˆ‘ä»¬</p><p>æ¨¡å‹è¾“å‡ºï¼šå‘æ˜äº†ä¸€ä¸ªæ–°çš„å’Œç®€å•çš„æ¨¡å‹</p><hr><p><img src="https://s2.loli.net/2025/02/26/X1KgpxbFoIjB84E.png" alt="image-20250226101327422"></p><p>æ–‡æœ¬ç”Ÿæˆçš„è¿‡ç¨‹æœ¬è´¨å°±æ˜¯å•å­—æ¥é¾™ã€‚</p><p>é‚£ä¹ˆå•å­—æ¥é¾™ä¸ºä»€ä¹ˆå¯ä»¥äº§ç”Ÿè¿™ä¹ˆå¤§çš„å¨åŠ›ï¼Ÿ</p><h2 id="4-2-ChatGPTæ„å»ºæµç¨‹"><a href="#4-2-ChatGPTæ„å»ºæµç¨‹" class="headerlink" title="4.2 ChatGPTæ„å»ºæµç¨‹"></a>4.2 ChatGPTæ„å»ºæµç¨‹</h2><p>ChatGPTæ„å»ºä¸»è¦åŒ…å«å››ä¸ªé˜¶æ®µï¼š<strong>é¢„è®­ç»ƒ</strong>ã€<strong>æœ‰ç›‘ç£å¾®è°ƒ</strong>ã€<strong>å¥–åŠ±å»ºæ¨¡</strong>ã€<strong>å¼ºåŒ–å­¦ä¹ </strong>ã€‚è¿™å››ä¸ªé˜¶æ®µéƒ½éœ€è¦ä¸åŒè§„æ¨¡ <em>æ•°æ®é›†åˆ</em> ä»¥åŠä¸åŒç±»å‹çš„ <em>ç®—æ³•</em> ï¼Œä¼šäº§å‡ºä¸åŒç±»å‹çš„ <em>æ¨¡å‹</em> ï¼ŒåŒæ—¶æ‰€éœ€è¦çš„ <em>è®¡ç®—èµ„æº</em> ä¹Ÿæœ‰éå¸¸å¤§çš„å·®åˆ«ã€‚</p><p><img src="https://s2.loli.net/2025/02/26/d6hUSRkp57N4Mgl.png" alt="image-20250226104450061"></p><p>é€šè¿‡ä¸Šå›¾ï¼Œæˆ‘ä»¬ä¹Ÿè¾ƒå®¹æ˜“å½’çº³å‡ºâ€œ<strong>äººå·¥æ™ºèƒ½å‘å±•çš„ä¸‰å¤§å› ç´ ï¼š<em>æ•°æ®</em>ï¼ˆä¸Šå›¾ä¸­çš„æ•°æ®é›†åˆï¼‰ã€<em>ç®—æ³•</em>ï¼ˆä¸Šå›¾ä¸­çš„ç®—æ³•ï¼‰å’Œ<em>ç®—åŠ›</em>ï¼ˆä¸Šå›¾ä¸­çš„èµ„æºéœ€æ±‚ï¼‰</strong>â€ã€‚ä¸Šå›¾ä¸­è¿˜æœ‰ä¸€ä¸ªå†…å®¹â€œæ¨¡å‹â€ï¼Œå®ƒå…¶å®æ˜¯æ•°æ®é›†åˆä¸ç®—æ³•çš„äº§ç‰©ã€‚</p><p>ä¸Šå›¾ä¸­ç›¸å…³ä¸“ä¸šæœ¯è¯­è§£é‡Šï¼š</p><ul><li><em>SFTæ¨¡å‹</em>ï¼šSupervised Fine-Tuning Modelï¼Œå³ç›‘ç£å¾®è°ƒæ¨¡å‹</li><li>RMæ¨¡å‹ï¼šReward Modelï¼Œå³å¥–åŠ±æ¨¡å‹</li><li>RLæ¨¡å‹ï¼šReinforcement Learning Modelï¼Œå³å¼ºåŒ–å­¦ä¹ æ¨¡å‹</li></ul><hr><p><img src="https://s2.loli.net/2025/02/26/OHu8BJzQC3UsqnA.png" alt="image-20250226113420068"></p><h2 id="4-3-é˜¶æ®µä¸€-è‡ªç›‘ç£é¢„è®­ç»ƒ"><a href="#4-3-é˜¶æ®µä¸€-è‡ªç›‘ç£é¢„è®­ç»ƒ" class="headerlink" title="4.3 é˜¶æ®µä¸€ è‡ªç›‘ç£é¢„è®­ç»ƒ"></a>4.3 é˜¶æ®µä¸€ è‡ªç›‘ç£é¢„è®­ç»ƒ</h2><p>è‡ªç›‘ç£é¢„è®­ç»ƒï¼Œè‹±æ–‡å…¨ç§°â€Unsupervised pre-trainingâ€œ</p><hr><p>æ ¸å¿ƒæ€è·¯ï¼šåˆ©ç”¨å‰kä¸ªè¯ï¼ˆtokenï¼‰é¢„æµ‹ç¬¬k+1ä¸ªè¯ã€‚</p><p>è®¾æœ‰è¯­æ–™<code>ğ‘ˆ=&#123;ğ‘¢1,â€¦,ğ‘¢ğ‘›&#125;</code>ï¼Œå…¶ä¸­ <code>ğ‘¢ğ‘– </code>è¡¨ç¤ºè¯­æ–™ä¸­çš„ç¬¬ <code>i</code>ä¸ªè¯ï¼ˆtokenï¼‰ã€‚</p><p>é¢„è®­ç»ƒçš„ç›®æ ‡æ˜¯æœ€å¤§åŒ–ä»¥ä¸‹ <em>å¯¹æ•°ä¼¼ç„¶å‡½æ•°</em> ï¼š</p><img src="https://s2.loli.net/2025/02/26/Bj7uIfTNmEkGO4X.png" alt="image-20250226113732162" style="zoom:50%;" /><p>å…¶ä¸­ï¼Œ<code>P(uiâˆ£uiâˆ’k,...,uiâˆ’1;Î¸)</code>è¡¨ç¤ºåœ¨ç»™å®šå‰ <code>k</code> ä¸ªè¯ <code>uiâˆ’k,...,uiâˆ’1</code> çš„æ¡ä»¶ä¸‹ï¼Œæ¨¡å‹é¢„æµ‹ä¸‹ä¸€ä¸ªè¯æ˜¯ <code>ui</code>çš„æ¦‚ç‡ã€‚<code>ğœƒ</code>è¡¨ ç¤ºæ¨¡å‹ä¸­çš„å¯å˜å‚æ•°ã€‚</p><hr><p>æ¦‚æ‹¬æ€§åœ°è¯´ï¼Œä¸Šè¿°å†…å®¹æè¿°ä¸€ç§é€šè¿‡åˆ©ç”¨å‰ <code>k</code> ä¸ªè¯æ¥é¢„æµ‹ä¸‹ä¸€ä¸ªè¯çš„è¯­è¨€æ¨¡å‹é¢„è®­ç»ƒæ–¹æ³•ï¼Œå¹¶é€šè¿‡æœ€å¤§åŒ–å¯¹æ•°ä¼¼ç„¶å‡½æ•°æ¥ä¼˜åŒ–æ¨¡å‹å‚æ•°ã€‚</p><hr><p><img src="https://s2.loli.net/2025/02/26/YO7gGNp8KHhRont.png" alt="image-20250226113810162"></p><hr><p>æµ·é‡è®­ç»ƒæ•°æ®åŒ…æ‹¬äº’è”ç½‘ç½‘é¡µã€ç»´åŸºç™¾ç§‘ã€ä¹¦ç±ã€GitHubã€è®ºæ–‡ã€é—®ç­”ç½‘ç«™ç­‰ï¼Œæ„å»ºåŒ…å«æ•°åƒäº¿ç”šè‡³æ•°ä¸‡äº¿å•è¯ çš„å…·æœ‰å¤šæ ·æ€§çš„å†…å®¹ã€‚</p><p>åŸºç¡€å¤§æ¨¡å‹æ„å»ºäº† <em>é•¿æ–‡æœ¬å»ºæ¨¡èƒ½åŠ›</em> ï¼Œéšå«çš„æ„å»ºäº†åŒ…æ‹¬ <em>äº‹å®æ€§çŸ¥è¯†</em> å’Œ <em>å¸¸è¯†çŸ¥è¯†</em> åœ¨å†…çš„ <em>ä¸–ç•ŒçŸ¥è¯†</em> ï¼Œæ ¹æ®è¾“å…¥çš„æç¤º è¯ï¼ˆPromptï¼‰ï¼Œæ¨¡å‹å¯ä»¥ <em>ç”Ÿæˆæ–‡æœ¬è¡¥å…¨å¥å­</em> ã€‚</p><p><img src="https://s2.loli.net/2025/02/26/W8wXGeNgiq5uad9.png" alt="image-20250226145843606"></p><h2 id="4-4-é˜¶æ®µäºŒ-æœ‰ç›‘ç£å¾®è°ƒ-æŒ‡ä»¤å¾®è°ƒ"><a href="#4-4-é˜¶æ®µäºŒ-æœ‰ç›‘ç£å¾®è°ƒ-æŒ‡ä»¤å¾®è°ƒ" class="headerlink" title="4.4 é˜¶æ®µäºŒ æœ‰ç›‘ç£å¾®è°ƒ&#x2F;æŒ‡ä»¤å¾®è°ƒ"></a>4.4 é˜¶æ®µäºŒ æœ‰ç›‘ç£å¾®è°ƒ&#x2F;æŒ‡ä»¤å¾®è°ƒ</h2><p>æœ‰ç›‘ç£å¾®è°ƒ&#x2F;æŒ‡ä»¤å¾®è°ƒã€‚è‹±æ–‡å…¨ç§°Supervised Fine-tuning &#x2F; Instruction Tuningã€‚</p><hr><p>æœ‰ç›‘ç£å¾®è°ƒï¼ˆSupervised Fine-tuningï¼ŒSFTï¼‰ä¹Ÿç§°ä¸ºæŒ‡ä»¤å¾®è°ƒï¼ˆInstruction Tuningï¼‰ï¼Œåœ¨é˜¶æ®µä¸€çš„æ¨¡å‹ä¸Šç»§ç»­è®­ç»ƒã€‚ è®­ç»ƒæ•°æ®ä¸ºé«˜è´¨é‡æ•°æ®é›†åˆï¼ŒåŒ…å«ç”¨æˆ·è¾“å…¥çš„æç¤ºè¯ï¼ˆPromptï¼‰å’Œå¯¹åº”çš„ç†æƒ³è¾“å‡ºç»“æœã€‚ ç”¨æˆ·è¾“å…¥åŒ…æ‹¬é—®é¢˜ã€é—²èŠå¯¹è¯ã€ä»»åŠ¡æŒ‡ä»¤ç­‰å¤šç§å½¢å¼å’Œä»»åŠ¡ã€‚</p><p><img src="https://s2.loli.net/2025/02/26/d6hUSRkp57N4Mgl.png" alt="image-20250226104450061"></p><hr><p>æç¤ºè¯ï¼ˆPromptï¼‰ï¼šå¤æ—¦å¤§å­¦æœ‰å‡ ä¸ªæ ¡åŒºï¼Ÿ </p><p>ç†æƒ³è¾“å‡ºï¼šå¤æ—¦å¤§å­¦ç°æœ‰4ä¸ªæ ¡åŒºï¼Œåˆ†åˆ«æ˜¯é‚¯éƒ¸æ ¡åŒºã€æ–°æ±Ÿæ¹¾æ ¡åŒºã€æ«æ—æ ¡åŒºå’Œå¼ æ±Ÿæ ¡åŒºã€‚å…¶ä¸­é‚¯éƒ¸æ ¡åŒºæ˜¯å¤æ—¦å¤§å­¦çš„ä¸»æ ¡åŒºï¼Œé‚¯éƒ¸æ ¡åŒºä¸æ–°æ±Ÿæ¹¾æ ¡åŒºéƒ½ä½äºæ¨æµ¦åŒºï¼Œæ«æ—æ ¡åŒºä½äºå¾æ±‡åŒºï¼Œå¼ æ±Ÿæ ¡åŒºä½äºæµ¦ä¸œæ–°åŒºã€‚</p><p><img src="https://s2.loli.net/2025/02/26/W8wXGeNgiq5uad9.png" alt="image-20250226145843606"></p><hr><p>ç»è¿‡å¾®è°ƒåçš„æœ‰ç›‘ç£å¾®è°ƒï¼ˆSFTï¼‰æ¨¡å‹å…·å¤‡äº†åˆæ­¥çš„æŒ‡ä»¤å’Œä¸Šä¸‹æ–‡ç†è§£èƒ½åŠ›ï¼Œèƒ½å¤Ÿå®Œæˆå¼€æ”¾é¢†åŸŸé—®é¢˜ã€é˜…è¯»ç†è§£ã€ ç¿»è¯‘ã€ç”Ÿæˆä»£ç ç­‰èƒ½åŠ›ï¼Œä¹Ÿå…·å¤‡äº†ä¸€å®šçš„å¯¹æœªçŸ¥ä»»åŠ¡çš„æ³›åŒ–èƒ½åŠ›ã€‚</p><h2 id="4-5-é˜¶æ®µä¸‰-å¥–åŠ±å»ºæ¨¡"><a href="#4-5-é˜¶æ®µä¸‰-å¥–åŠ±å»ºæ¨¡" class="headerlink" title="4.5 é˜¶æ®µä¸‰ å¥–åŠ±å»ºæ¨¡"></a>4.5 é˜¶æ®µä¸‰ å¥–åŠ±å»ºæ¨¡</h2><p>å¥–åŠ±å»ºæ¨¡ï¼Œè‹±æ–‡å…¨ç§°â€Reward Modelingâ€œã€‚</p><hr><p>å¥–åŠ±å»ºæ¨¡ï¼ˆReward Modelingï¼‰é˜¶æ®µçš„ç›®æ ‡æ˜¯æ„å»ºä¸€ä¸ªæ–‡æœ¬è´¨é‡è¯„ä¼°æ¨¡å‹ã€‚</p><p>å¥–åŠ±å»ºæ¨¡ï¼ˆReward Modelingï¼‰ç”¨æ¥å¯¹SFTæ¨¡å‹çš„è¾“å‡ºæ–‡æœ¬è¿›è¡Œè´¨é‡è¯„ä¼°ã€‚</p><p>ä¸ºè®­ç»ƒå¾—åˆ°å¥–åŠ±æ¨¡å‹ï¼Œé¡»äººå·¥æ ‡æ³¨ç™¾ä¸‡é‡çº§çš„æ ·æœ¬åº“ï¼Œå¥–åŠ±æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ç‹¬ç«‹äºGPTæ¨¡å‹ã€‚</p><hr><p>å¥–åŠ±å»ºæ¨¡ï¼ˆReward Modelingï¼‰é˜¶æ®µçš„ç›®æ ‡æ˜¯æ„å»ºä¸€ä¸ª<strong>æ–‡æœ¬è´¨é‡è¯„ä¼°æ¨¡å‹</strong>ã€‚</p><p>æŠŠåŒä¸€ä¸ªæç¤ºè¯å¤šæ¬¡ä¼ å…¥SFTæ¨¡å‹ï¼Œä¼šå¾—åˆ°å¤šä¸ªä¸åŒè¾“å‡ºç»“æœï¼Œå¥–åŠ±æ¨¡å‹å¯ä»¥å¯¹è¿™äº›ç»“æœçš„è´¨é‡è¿›è¡Œæ’åºã€‚</p><p><img src="https://s2.loli.net/2025/02/26/f7GXjwoECgRqvxn.png" alt="image-20250226151237593"></p><h2 id="4-6-é˜¶æ®µå››-å¼ºåŒ–å­¦ä¹ "><a href="#4-6-é˜¶æ®µå››-å¼ºåŒ–å­¦ä¹ " class="headerlink" title="4.6 é˜¶æ®µå›› å¼ºåŒ–å­¦ä¹ "></a>4.6 é˜¶æ®µå›› å¼ºåŒ–å­¦ä¹ </h2><p>å¼ºåŒ–å­¦ä¹ ã€‚è‹±æ–‡å…¨ç§°æ˜¯â€Reinforcement Learningâ€œã€‚</p><hr><p>å¼ºåŒ–å­¦ä¹ ï¼ˆReinforcement Learningï¼‰é˜¶æ®µæ˜¯å¯¹æŒ‡ä»¤å¾®è°ƒï¼ˆSFTï¼‰æ¨¡å‹çš„è¿›ä¸€æ­¥è®­ç»ƒã€‚</p><p>æ ¹æ®æ•°åä¸‡ç”¨æˆ·ç»™å‡ºçš„æç¤ºè¯ï¼ŒSFTæ¨¡å‹ç”Ÿæˆç›¸åº”è¾“å‡ºï¼Œç„¶åå†åˆ©ç”¨å¥–åŠ±æ¨¡å‹ï¼ˆRMï¼‰å¯¹è¿™äº›è¾“å‡ºè¿›è¡Œè´¨é‡è¯„ä¼°ã€‚ ç»“åˆè¯„ä¼°ç»“æœå†å¯¹SFTæ¨¡å‹ <em>è¿›ä¸€æ­¥è°ƒæ•´</em> ï¼Œæœ€ç»ˆå¾—åˆ°ChatGPTã€‚</p><p><img src="https://s2.loli.net/2025/02/26/W8wXGeNgiq5uad9.png" alt="image-20250226145843606"></p><h2 id="4-7-ChatGPTæ„å»ºæµç¨‹å›é¡¾"><a href="#4-7-ChatGPTæ„å»ºæµç¨‹å›é¡¾" class="headerlink" title="4.7 ChatGPTæ„å»ºæµç¨‹å›é¡¾"></a>4.7 ChatGPTæ„å»ºæµç¨‹å›é¡¾</h2><p><img src="https://s2.loli.net/2025/02/25/GgVRSJF5PAIoWMj.png" alt="image-20250225231419832"></p><h2 id="4-8-tokenæ˜¯ä»€ä¹ˆ"><a href="#4-8-tokenæ˜¯ä»€ä¹ˆ" class="headerlink" title="4.8 tokenæ˜¯ä»€ä¹ˆ"></a>4.8 tokenæ˜¯ä»€ä¹ˆ</h2><p>åœ¨æ¨¡å‹ä¸­è¢«å¤„ç†çš„æ•°æ®å•å…ƒå¹¶ä¸æ˜¯å•è¯&#x2F;è¯è¯­ï¼Œè€Œæ˜¯tokenã€‚</p><hr><p>tokenæ˜¯æ–‡æœ¬å¤„ç†è¿‡ç¨‹ä¸­çš„åŸºæœ¬å•å…ƒï¼Œé€šå¸¸æ˜¯æŒ‡ä¸€ä¸ªå•è¯ã€æ ‡ç‚¹ç¬¦å·æˆ–è€…æ˜¯ç”±ç©ºæ ¼åˆ†éš”çš„æ–‡æœ¬ç‰‡æ®µã€‚ </p><p>tokenæ˜¯å¤§æ¨¡å‹ä¸–ç•Œä¸­çš„â€œå•è¯â€ï¼Œæ‰€æœ‰æ–‡æœ¬éƒ½å¯ä»¥ç”±tokenç»„åˆè€Œæ¥ã€‚</p><p><img src="https://s2.loli.net/2025/02/26/MagVuHTK3L1nZWS.png" alt="image-20250226153311380"></p><hr><p>è‹±æ–‡è¯­æ–™ä¸­1ä¸ªtokençº¦æœ‰4ä¸ªè‹±æ–‡å­—æ¯ï¼Œ100ä¸ªtokençº¦ç­‰äº75ä¸ªå•è¯çš„é•¿åº¦ï¼ˆå¹³å‡èµ·æ¥å¤§æ¦‚5.3ä¸ªè‹±æ–‡å­—æ¯å¯¹åº”ä¸€ä¸ªè‹±æ–‡å•è¯ï¼‰ã€‚ </p><p>ä¸­æ–‡é‡Œ1ä¸ªtokenç»å¤§éƒ¨åˆ†æƒ…å†µå¯¹åº”1~2ä¸ªå­—ï¼Œ1ä¸ªå­—å±…å¤šã€‚</p><p>å¤§æ¨¡å‹çš„tokenå­—å…¸ä¸€èˆ¬è·¨è¯­ç§ï¼Œå­—å…¸ä¸­tokenæ•°é‡ä¸ºåä¸‡é‡çº§ã€‚</p><hr><p>tokenä»æµ·é‡è¯­æ–™ä¸­ç»Ÿè®¡è€Œæ¥ï¼Œæœ‰ä¸åŒçš„ç»Ÿè®¡æ–¹æ³•ï¼Œå…¶ä¸€èˆ¬ç”±é«˜é¢‘è¯å’Œä½é¢‘è¯çš„å­è¯ç»„æˆã€‚ </p><p>tokenè¦ä¿ç•™åŸå§‹æ–‡æœ¬ä¸­å•è¯é—´çš„è¯­ä¹‰å…³ç³»ã€‚ </p><p>å°½å¯èƒ½é¿å…å‡ºç°æœªç™»å½•è¯ï¼ˆå³ä¸åœ¨è®­ç»ƒæ•°æ®ä¸­çš„è¯ã€‚è‹±æ–‡å…¨ç§°Out-Of-Vocabularyï¼Œç®€ç§°OOVï¼‰ï¼Œä½†å­—å…¸åˆä¸èƒ½å¤ªå¤§ã€‚</p><h1 id="äº”ã€AIGCç®€ä»‹"><a href="#äº”ã€AIGCç®€ä»‹" class="headerlink" title="äº”ã€AIGCç®€ä»‹"></a>äº”ã€AIGCç®€ä»‹</h1><h2 id="5-1-AIGCæ˜¯ä»€ä¹ˆ"><a href="#5-1-AIGCæ˜¯ä»€ä¹ˆ" class="headerlink" title="5.1 AIGCæ˜¯ä»€ä¹ˆ"></a>5.1 AIGCæ˜¯ä»€ä¹ˆ</h2><p>AIGCï¼ˆArtificial Intelligence Generated Contentï¼‰æ˜¯æŒ‡åˆ©ç”¨äººå·¥æ™ºèƒ½æŠ€æœ¯æ¥ç”Ÿæˆ<strong>å…¨æ–°çš„</strong>ã€<strong>é€¼çœŸçš„</strong>ã€<strong>æœ‰ç”¨çš„</strong>æ•°æ®ï¼Œå¦‚ æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘å’Œè§†é¢‘ç­‰ï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ¨¡ä»¿äººç±»çš„åˆ›é€ åŠ›å’Œå†™ä½œé£æ ¼ã€‚ </p><p>åœ¨æ­¤ä¹‹å‰çš„å†…å®¹ç”Ÿæˆæ–¹å¼ä¸»è¦ä¸ºï¼š </p><ol><li>PGCï¼ˆProfessional Generated Contentï¼‰ï¼Œä¸“å®¶ç”Ÿäº§å†…å®¹ï¼Œå¦‚å›¾ä¹¦ã€æŠ¥çº¸ã€æœŸåˆŠç­‰ã€‚ </li><li>UGCï¼ˆUser Generated Contentï¼‰ï¼Œç”¨æˆ·ç”Ÿäº§å†…å®¹ï¼Œå¦‚å¾®åšã€å…¬ä¼—å·ã€è‡ªåª’ä½“ç­‰ã€‚</li></ol><h2 id="5-2-AIGCä½œå“å±•ç¤º"><a href="#5-2-AIGCä½œå“å±•ç¤º" class="headerlink" title="5.2 AIGCä½œå“å±•ç¤º"></a>5.2 AIGCä½œå“å±•ç¤º</h2><p><img src="https://s2.loli.net/2025/02/26/BdS52EkqgOvDYno.png" alt="image-20250226154138094"></p><p><img src="https://s2.loli.net/2025/02/26/GxhFHbdUPAV6p34.png" alt="image-20250226154301432"></p><p>Soraæ–‡ç”Ÿè§†é¢‘ï¼š <a href="https://www.bilibili.com/video/BV1m4421F7Yc/?spm_id_from=333.337.search-card.all.click&vd_source=0b5fe5d5aa31f64bf7462d1d094b70a2">https://www.bilibili.com/video/BV1m4421F7Yc/?spm_id_from=333.337.search-card.all.click&amp;vd_source=0b5fe5d5aa31f64bf7462d1d094b70a2</a></p><h2 id="5-3-AIGCä¸å¤§æ¨¡å‹çš„å…³ç³»"><a href="#5-3-AIGCä¸å¤§æ¨¡å‹çš„å…³ç³»" class="headerlink" title="5.3 AIGCä¸å¤§æ¨¡å‹çš„å…³ç³»"></a>5.3 AIGCä¸å¤§æ¨¡å‹çš„å…³ç³»</h2><p><img src="https://s2.loli.net/2025/02/26/YEwbFnqWCkGMhUV.png" alt="image-20250226154709925"></p><ol><li>å¤§æ¨¡å‹ä¸ºAIGCæä¾›äº†å¼ºå¤§çš„ç”Ÿæˆèƒ½åŠ›ï¼šç”±äºå¤§æ¨¡å‹å…·æœ‰å¼ºå¤§çš„å­¦ä¹ èƒ½åŠ›å’Œç†è§£èƒ½åŠ›ï¼Œå› æ­¤å¯ä»¥ç”Ÿæˆæ›´åŠ <strong>ä¸°å¯Œ</strong>ã€ <strong>å¤šæ ·</strong>å’Œ<strong>é«˜è´¨é‡</strong>çš„å†…å®¹ï¼Œä»è€Œæ¨åŠ¨AIGCçš„å‘å±•ã€‚ </li><li>AIGCä¸ºå¤§æ¨¡å‹æä¾›äº†ä¸°å¯Œçš„åº”ç”¨åœºæ™¯ï¼šå¤§æ¨¡å‹åœ¨AIGCé¢†åŸŸçš„åº”ç”¨éå¸¸å¹¿æ³›ï¼ŒåŒ…æ‹¬<strong>æ–‡æœ¬ç”Ÿæˆ</strong>ã€<strong>å›¾åƒç”Ÿæˆ</strong>ã€<strong>éŸ³ä¹åˆ›ä½œ</strong>ç­‰ã€‚è¿™äº›åº”ç”¨åœºæ™¯ä¸ä»…å±•ç¤ºäº†å¤§æ¨¡å‹çš„å¼ºå¤§èƒ½åŠ›ï¼Œä¹Ÿä¸ºå¤§æ¨¡å‹çš„ç ”ç©¶å’Œå‘å±•æä¾›äº†å®é™…çš„éœ€æ±‚å’ŒåŠ¨åŠ›ã€‚ </li><li>AIGCä¸å¤§æ¨¡å‹ååŒè¿›åŒ–ï¼šéšç€AIGCåº”ç”¨çš„ä¸æ–­æ·±å…¥ï¼Œå¯¹å¤§æ¨¡å‹çš„éœ€æ±‚ä¹Ÿåœ¨ä¸æ–­æé«˜ï¼Œè¿™å°†æ¨åŠ¨å¤§æ¨¡å‹ä¸æ–­è¿›è¡ŒæŠ€æœ¯ä¼˜åŒ–å’Œåˆ›æ–°ã€‚åŒæ—¶ï¼Œå¤§æ¨¡å‹çš„è¿›æ­¥ä¹Ÿå°†è¿›ä¸€æ­¥æ¨åŠ¨AIGCçš„å‘å±•ï¼Œä¸¤è€…å½¢æˆäº†ä¸€ç§ååŒè¿›åŒ–çš„å…³ç³»ã€‚</li></ol><h2 id="5-4-AIGCæŠ€æœ¯ç‰¹ç‚¹"><a href="#5-4-AIGCæŠ€æœ¯ç‰¹ç‚¹" class="headerlink" title="5.4 AIGCæŠ€æœ¯ç‰¹ç‚¹"></a>5.4 AIGCæŠ€æœ¯ç‰¹ç‚¹</h2><ol><li>é«˜æ•ˆè‡ªåŠ¨åŒ–ã€‚AIGCå…·æœ‰å‡ºè‰²çš„è‡ªåŠ¨åŒ–å¤„ç†èƒ½åŠ›ï¼Œèƒ½å¤Ÿè¿…é€Ÿåˆ†æå’Œå¤„ç†å¤§é‡æ•°æ®ï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆæ‰€éœ€å†…å®¹ï¼Œæå¤§åœ°æå‡äº†å·¥ä½œæ•ˆç‡ï¼Œå‡å°‘äº†äººå·¥å¹²é¢„çš„éœ€æ±‚ï¼Œä½¿å¾—å†…å®¹ç”Ÿæˆè¿‡ç¨‹æ›´åŠ å¿«é€Ÿã€å‡†ç¡®ã€‚ </li><li>ä¸ªæ€§åŒ–å®šåˆ¶ã€‚AIGCå…·å¤‡æ·±åº¦å­¦ä¹ å’Œåˆ†æç”¨æˆ·è¡Œä¸ºçš„èƒ½åŠ›ï¼Œèƒ½å¤Ÿæ ¹æ®ç”¨æˆ·çš„ä¸ªæ€§åŒ–éœ€æ±‚å’Œåå¥½ï¼Œç”Ÿæˆå®šåˆ¶åŒ–çš„å†…å®¹ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°æ»¡è¶³ç”¨æˆ·çš„æœŸæœ›ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚ </li><li>å¤šåª’ä½“å½¢æ€ã€‚ä¸ä¼ ç»Ÿçš„äººå·¥æ™ºèƒ½ç”Ÿæˆå†…å®¹ä¸»è¦ä»¥æ–‡æœ¬å½¢å¼ä¸ºä¸»ä¸åŒï¼ŒAIGCèƒ½å¤Ÿç”ŸæˆåŒ…æ‹¬å›¾åƒã€éŸ³é¢‘ã€è§†é¢‘ç­‰å¤šç§å½¢å¼çš„å¤šåª’ä½“å†…å®¹ï¼Œä½¿å¾—AIGCåœ¨å†…å®¹åˆ›ä½œä¸Šæ›´åŠ çµæ´»å¤šæ ·ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°é€‚åº”ä¸åŒçš„ä¼ æ’­æ¸ é“å’Œç”¨æˆ·éœ€æ±‚ã€‚ </li><li>å‡†ç¡®æ€§é«˜ã€‚åœ¨å¤„ç†å’Œåˆ†ææ•°æ®æ—¶ï¼ŒAIGCå±•ç°å‡ºäº†æé«˜çš„å‡†ç¡®æ€§ï¼Œå®ƒèƒ½å¤Ÿç²¾ç¡®æå–å…³é”®ä¿¡æ¯ï¼Œç”Ÿæˆå¯é çš„ç»“è®ºæˆ–å»ºè®®ï¼Œä½¿å¾—AIGCåœ¨å†³ç­–æ”¯æŒã€æ•°æ®åˆ†æç­‰é¢†åŸŸå…·æœ‰å¹¿æ³›çš„åº”ç”¨ä»·å€¼ã€‚ </li><li>å­˜åœ¨è¯¯å¯¼æ€§ã€‚è¯¯å¯¼æ€§ä¸å‡†ç¡®å¹¶è¡Œï¼ŒAIGCåŸºäºç®—æ³•å’Œæ¨¡å‹è¿›è¡Œå·¥ä½œï¼Œåº•å±‚å¤§å¤šæ˜¯ç”Ÿæˆå¼çš„æ¦‚ç‡æ¨¡å‹ï¼Œå…¶å†…å®¹ç”Ÿæˆå…·æœ‰éšæœºæ€§ï¼Œå¹¶ä¸å®Œå…¨ä¾èµ–äºå®¢è§‚äº‹å®ï¼Œæ•…å¯èƒ½ä¼šäº§ç”Ÿè¯¯è§£ã€è¯¯åˆ¤æˆ–ç”Ÿæˆä¸å‡†ç¡®çš„å†…å®¹ã€‚</li></ol><h2 id="5-5-ä¸­å›½AIGCäº§ä¸šå›¾è°±"><a href="#5-5-ä¸­å›½AIGCäº§ä¸šå›¾è°±" class="headerlink" title="5.5 ä¸­å›½AIGCäº§ä¸šå›¾è°±"></a>5.5 ä¸­å›½AIGCäº§ä¸šå›¾è°±</h2><p>â€œ2023å¹´ä¸­å›½AIGCäº§ä¸šå›¾è°±â€å³ä¸‹å›¾ï¼Œç”±è‰¾ç‘å’¨è¯¢æ•´ç†ï¼Œå‘å¸ƒäº2023å¹´8æœˆã€‚</p><p><img src="https://s2.loli.net/2025/02/26/BoDrb3Eu6Wtp2dj.png" alt="image-20250226164956303"></p><hr><p>â€œ2024å¹´ä¸­å›½AIGCäº§ä¸šå›¾è°±V4.1â€å³ä¸‹å›¾ï¼Œç”±éå‡¡äº§ç ”æ•´ç†ï¼Œå‘å¸ƒäº2024å¹´6æœˆ4æ—¥</p><p><img src="https://s2.loli.net/2025/02/26/FoLf4GXNTAJO3xR.png" alt="image-20250226164358224"></p><h2 id="5-6-å°ç»“"><a href="#5-6-å°ç»“" class="headerlink" title="5.6 å°ç»“"></a>5.6 å°ç»“</h2><ol><li>AIGCæ˜¯æŒ‡åˆ©ç”¨äººå·¥æ™ºèƒ½æŠ€æœ¯æ¥ç”Ÿæˆå…¨æ–°çš„ã€é€¼çœŸçš„ã€æœ‰ç”¨çš„æ•°æ®ã€‚ </li><li>å¤§æ¨¡å‹ä¸ºAIGCæä¾›äº†å¼ºå¤§çš„ç”Ÿæˆèƒ½åŠ›ï¼ŒAIGCä¸ºå¤§æ¨¡å‹æä¾›äº†ä¸°å¯Œçš„åº”ç”¨åœºæ™¯ã€‚ </li><li>AIGCæŠ€æœ¯å…·æœ‰é«˜æ•ˆè‡ªåŠ¨åŒ–ã€ä¸ªæ€§åŒ–å®šåˆ¶ã€å¤šåª’ä½“å½¢æ€ã€å‡†ç¡®æ€§é«˜ã€åˆ›æ–°æ€§å¼ºã€å¯æ‰©å±•æ€§å¥½ç­‰ç‰¹ç‚¹ï¼Œä½†å¹¶ä¸æ˜¯ ä¸‡èƒ½çš„ï¼Œä¹Ÿå¯èƒ½ç”Ÿæˆå…·æœ‰è¯¯å¯¼æ€§çš„å†…å®¹ã€‚ </li><li>AIGCæŠ€æœ¯çš„å‰æ™¯å¹¿é˜”ï¼Œéšç€æŠ€æœ¯çš„çªç ´ä¸è·¨ç•Œèåˆçš„æ·±å…¥ï¼Œæœªæ¥å°†å¹¿æ³›åº”ç”¨äºå„è¡Œå„ä¸šã€‚</li></ol>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤§æ¨¡å‹ä¸AIGCæ¦‚è¿°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>torch1.13.0+cpuä¸­tensorçš„å¸¸ç”¨å±æ€§ä¸æ–¹æ³•</title>
    <link href="/2025/02/28/torch1-13-0-cpu%E4%B8%ADtensor%E7%9A%84%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7%E4%B8%8E%E6%96%B9%E6%B3%95/"/>
    <url>/2025/02/28/torch1-13-0-cpu%E4%B8%ADtensor%E7%9A%84%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7%E4%B8%8E%E6%96%B9%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€æ„å»ºtensor"><a href="#ä¸€ã€æ„å»ºtensor" class="headerlink" title="ä¸€ã€æ„å»ºtensor"></a>ä¸€ã€æ„å»ºtensor</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#ä¸€ã€æ„å»ºtensor</span><br><span class="hljs-comment">###PyTorchå¸¸ç”¨æ•°æ®ç±»å‹</span><br><span class="hljs-comment">#å®˜æ–¹æ•™ç¨‹ï¼š https://pytorch.org/tutorials/beginner/basics/tensorqs_tutorial.html</span><br><span class="hljs-comment">#å®˜æ–¹APIæ–‡æ¡£ï¼š https://pytorch.org/docs/stable/index.html</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">###å¼ é‡ï¼ˆTensorï¼‰ï¼šPyTorchç½‘ç»œè¿ç®—ä¸­çš„åŸºæœ¬æ•°æ®ç»“æ„ï¼ˆç±»ä¼¼ndarray ï¼‰</span><br><span class="hljs-comment">###åˆ›å»ºå¼ é‡</span><br><span class="hljs-keyword">import</span> torch<br>a = torch.tensor(<span class="hljs-number">0.1</span>)  <span class="hljs-comment">#æ­¤å¼ é‡åªæœ‰ä¸€ä¸ªæ ‡é‡å…ƒç´ 0.1</span><br>b = torch.tensor(<span class="hljs-number">0.3</span>, dtype=torch.float64)<br><span class="hljs-comment">#æ‰§è¡Œè¿ç®—</span><br>result = a + b<br><span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure><pre><code class="hljs">tensor(0.4000, dtype=torch.float64)</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">###åˆ›å»ºç‰¹å®šçš„å¼ é‡</span><br><span class="hljs-keyword">import</span> torch<br><span class="hljs-comment"># å…¨1å¼ é‡</span><br>ones = torch.ones((<span class="hljs-number">3</span>, <span class="hljs-number">2</span>))                  <br><span class="hljs-comment"># ç­‰å·®åºåˆ—å¼ é‡</span><br>range_tensor = torch.arange(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>, <span class="hljs-number">1</span>)      <br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ones:&#x27;</span>, ones, <span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;range_tensor:&#x27;</span>, range_tensor)<br></code></pre></td></tr></table></figure><pre><code class="hljs">ones: tensor([[1., 1.],        [1., 1.],        [1., 1.]])  range_tensor: tensor([ 1,  2,  3,  4,  5,  6,  7,  8,  9, 10])</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">###tensorä¸ndarrayç›¸äº’è½¬åŒ–</span><br><span class="hljs-keyword">import</span> torch<br>output = torch.zeros((<span class="hljs-number">2</span>, <span class="hljs-number">2</span>), dtype=torch.float32)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;1---&gt;&quot;</span>, output)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;2---&gt;output: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">type</span>(output)))<br><br>n_output = output.numpy()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;3---&gt;n_output: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">type</span>(n_output)))<br><br>t_output = torch.from_numpy(n_output)    <span class="hljs-comment"># å°†ndarrayè½¬ä¸ºtensor</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;4---&gt;t_output: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">type</span>(t_output)))<br></code></pre></td></tr></table></figure><pre><code class="hljs">1---&gt; tensor([[0., 0.],        [0., 0.]])2---&gt;output: &lt;class &#39;torch.Tensor&#39;&gt;3---&gt;n_output: &lt;class &#39;numpy.ndarray&#39;&gt;4---&gt;t_output: &lt;class &#39;torch.Tensor&#39;&gt;</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#ä»å˜é‡ç»§æ‰¿å±æ€§åˆ›å»ºå¼ é‡ã€ä»numpyåˆ›å»ºå¼ é‡</span><br><span class="hljs-comment">###å®˜æ–¹æ•™ç¨‹ï¼š https://pytorch.org/tutorials/beginner/basics/tensorqs_tutorial.html</span><br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br>data = [[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>],[<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]]<br>x_data = torch.tensor(data) <span class="hljs-comment">#ç›´æ¥ä»æ•°æ®åˆ›å»ºä¸€ä¸ªtensorï¼Œæ•°æ®ç±»å‹å¯ä»¥è¢«è‡ªåŠ¨æ¨æ–­å‡ºæ¥</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;1---&gt;x_data:&quot;</span>, x_data)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;x_data type:&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">type</span>(x_data)))<br>np_array = np.array(data) <span class="hljs-comment">#ç›´æ¥ä»æ•°æ®åˆ›å»ºä¸€ä¸ªnumpyå˜é‡</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;2---&gt;np_array&quot;</span>, np_array)<br>x_np = torch.from_numpy(np_array) <span class="hljs-comment">#ä»numpyå˜é‡åˆ›å»ºä¸€ä¸ªtensor</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;3---&gt;x_np&quot;</span>, x_np)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;x_np type:&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">type</span>(x_np)))<br><br>x_ones = torch.ones_like(x_data)   <span class="hljs-comment"># æ ¹æ®x_dataçš„åˆ›å»ºä¸€ä¸ªæ–°tensorï¼Œæ–°tensorçš„å±æ€§ï¼ˆæ­¤å¤„å› ä¸ºæ²¡æœ‰æŒ‡å®šæ•°æ®ç±»å‹ï¼Œæ‰€ä»¥æ–°tensoræ•°æ®ç±»å‹è·Ÿx_dataä¹Ÿä¸€æ ·ã€‚å…¶ä»–å±æ€§ä¹Ÿæ˜¯ç±»ä¼¼è§„å¾‹ï¼‰è·Ÿx_dataä¸€æ ·ï¼Œä½†æ•°å€¼å¯ä»¥æŒ‡å®šä¸ºå…¨æ˜¯1</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Ones Tensor: \n <span class="hljs-subst">&#123;x_ones&#125;</span> \n&quot;</span>)<br>x_rand = torch.rand_like(x_data, dtype=torch.<span class="hljs-built_in">float</span>) <span class="hljs-comment"># æ ¹æ®x_dataçš„åˆ›å»ºä¸€ä¸ªæ–°tensorï¼Œå½¢çŠ¶ä¸åŸtensorä¸€æ ·ï¼Œä½†æŒ‡å®šäº†æ–°çš„æ•°æ®ç±»å‹ä¸ºtorch.floatã€ä¸”å®ƒçš„å…ƒç´ å€¼éƒ½æ˜¯ä¸€äº›éšæœºç”Ÿæˆçš„æ•°</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Random Tensor: \n <span class="hljs-subst">&#123;x_rand&#125;</span> \n&quot;</span>)<br></code></pre></td></tr></table></figure><pre><code class="hljs">1---&gt;x_data: tensor([[1, 2],        [3, 4]])x_data type:&lt;class &#39;torch.Tensor&#39;&gt;2---&gt;np_array [[1 2] [3 4]]3---&gt;x_np tensor([[1, 2],        [3, 4]], dtype=torch.int32)x_np type:&lt;class &#39;torch.Tensor&#39;&gt;Ones Tensor:  tensor([[1, 1],        [1, 1]]) Random Tensor:  tensor([[0.0282, 0.8095],        [0.2707, 0.1938]]) </code></pre><p>â€‹    </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#åˆ›å»ºéšæœºæ•°å¼ é‡</span><br><span class="hljs-comment">###å®˜æ–¹æ•™ç¨‹ï¼š https://pytorch.org/tutorials/beginner/basics/tensorqs_tutorial.html</span><br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br>tensor = torch.rand(<span class="hljs-number">4</span>, <span class="hljs-number">4</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;First row: <span class="hljs-subst">&#123;tensor[<span class="hljs-number">1</span>]&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;First column: <span class="hljs-subst">&#123;tensor[:, <span class="hljs-number">0</span>]&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Last column: <span class="hljs-subst">&#123;tensor[..., -<span class="hljs-number">1</span>]&#125;</span>&quot;</span>)<br>tensor[:,<span class="hljs-number">1</span>] = <span class="hljs-number">0</span><br><span class="hljs-built_in">print</span>(tensor)<br></code></pre></td></tr></table></figure><pre><code class="hljs">First row: tensor([0.1094, 0.4258, 0.9837, 0.3118])First column: tensor([0.3335, 0.1094, 0.4532, 0.2374])Last column: tensor([0.7949, 0.3118, 0.5406, 0.5577])tensor([[0.3335, 0.0000, 0.1649, 0.7949],        [0.1094, 0.0000, 0.9837, 0.3118],        [0.4532, 0.0000, 0.6070, 0.5406],        [0.2374, 0.0000, 0.7951, 0.5577]])</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#äºŒã€tensorå±æ€§</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#tensor.dataç”¨æ³•</span><br><span class="hljs-keyword">import</span> torch<br>t = torch.tensor([[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]], dtype=torch.float32)<br><span class="hljs-built_in">print</span>(t)<br><span class="hljs-built_in">print</span>(t.data) <span class="hljs-comment">#åœ¨ PyTorch ä¸­ï¼Œtorch.tensor.data æ˜¯ä¸€ä¸ª å±æ€§ï¼Œç”¨äºè®¿é—®å¼ é‡çš„åº•å±‚æ•°æ®ï¼ˆå³å­˜å‚¨å¼ é‡å€¼çš„å®é™…å†…å­˜ï¼‰ã€‚å®ƒè¿”å›ä¸€ä¸ªä¸åŸå§‹å¼ é‡å…±äº«ç›¸åŒå­˜å‚¨çš„æ–°å¼ é‡ï¼Œä½† ä¸å‚ä¸è‡ªåŠ¨æ±‚å¯¼ï¼ˆå³ä¸è·Ÿè¸ªè®¡ç®—å†å²ï¼‰ã€‚</span><br><span class="hljs-built_in">print</span>(t.data.numpy())  <span class="hljs-comment">#numpy() æ–¹æ³•å°† PyTorch å¼ é‡è½¬æ¢ä¸º NumPy æ•°ç»„ã€‚è½¬æ¢åçš„ NumPy æ•°ç»„ä¸åŸå§‹å¼ é‡å…±äº«å­˜å‚¨ï¼Œå› æ­¤ä¿®æ”¹ NumPy æ•°ç»„ä¼šå½±å“åŸå§‹å¼ é‡ã€‚</span><br><span class="hljs-built_in">print</span>(t.data.numpy().argmax(axis=<span class="hljs-number">1</span>))  <span class="hljs-comment">#argmax() æ˜¯ NumPy æ•°ç»„çš„æ–¹æ³•ï¼Œç”¨äºè¿”å›æ²¿æŒ‡å®šè½´çš„æœ€å¤§å€¼çš„ç´¢å¼•ã€‚axis=1 è¡¨ç¤ºæ²¿ç€ç¬¬ 1 è½´ï¼ˆå³è¡Œæ–¹å‘ï¼‰æŸ¥æ‰¾æœ€å¤§å€¼çš„ç´¢å¼•ã€‚</span><br><br>x = torch.tensor([<span class="hljs-number">1.0</span>, <span class="hljs-number">2.0</span>, <span class="hljs-number">3.0</span>], requires_grad=<span class="hljs-literal">True</span>)<br><span class="hljs-built_in">print</span>(x)<br><span class="hljs-built_in">print</span>(x.data)<br></code></pre></td></tr></table></figure><pre><code class="hljs">tensor([[1., 2.],        [3., 4.]])tensor([[1., 2.],        [3., 4.]])[[1. 2.] [3. 4.]][1 1]tensor([1., 2., 3.], requires_grad=True)tensor([1., 2., 3.])</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#ä¸‰ã€tensoræ–¹æ³• </span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#åœ¨ PyTorch ä¸­ï¼Œtorch.tensor.mean() æ˜¯ä¸€ä¸ªç”¨äºè®¡ç®—å¼ é‡ä¸­æ‰€æœ‰å…ƒç´ å¹³å‡å€¼çš„æ–¹æ³•ã€‚å®ƒå¯ä»¥æ²¿ç€æŒ‡å®šçš„ç»´åº¦è®¡ç®—å¹³å‡å€¼ï¼Œä¹Ÿå¯ä»¥è®¡ç®—æ•´ä¸ªå¼ é‡çš„å¹³å‡å€¼ã€‚</span><br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br>tensor = torch.tensor([[<span class="hljs-number">2</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>], [<span class="hljs-number">6</span>, <span class="hljs-number">7</span>]], dtype=torch.float64)<br><span class="hljs-built_in">print</span>(tensor)<br>tensor.mean()<br></code></pre></td></tr></table></figure><pre><code class="hljs">tensor([[2., 3.],        [4., 5.],        [6., 7.]], dtype=torch.float64)tensor(4.5000, dtype=torch.float64)</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><br></code></pre></td></tr></table></figure><h1 id=""><a href="#" class="headerlink" title=""></a></h1>]]></content>
    
    
    <categories>
      
      <category>æœºå™¨å­¦ä¹ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>tensorçš„å¸¸ç”¨å±æ€§ä¸æ–¹æ³•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å·²æˆåŠŸéƒ¨ç½²æ»¡è¡€ç‰ˆDeepSeek-R1-671B,å¯æ‰¿æ¥å’¨è¯¢æˆ–éƒ¨ç½²ä¸šåŠ¡</title>
    <link href="/2025/02/26/%E5%B7%B2%E6%88%90%E5%8A%9F%E9%83%A8%E7%BD%B2%E6%BB%A1%E8%A1%80%E7%89%88DeepSeek-R1-671B-%E5%8F%AF%E6%89%BF%E6%8E%A5%E5%92%A8%E8%AF%A2%E6%88%96%E9%83%A8%E7%BD%B2%E4%B8%9A%E5%8A%A1/"/>
    <url>/2025/02/26/%E5%B7%B2%E6%88%90%E5%8A%9F%E9%83%A8%E7%BD%B2%E6%BB%A1%E8%A1%80%E7%89%88DeepSeek-R1-671B-%E5%8F%AF%E6%89%BF%E6%8E%A5%E5%92%A8%E8%AF%A2%E6%88%96%E9%83%A8%E7%BD%B2%E4%B8%9A%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€å¯æ‰¿æ¥å’¨è¯¢æˆ–éƒ¨ç½²ä¸šåŠ¡"><a href="#ä¸€ã€å¯æ‰¿æ¥å’¨è¯¢æˆ–éƒ¨ç½²ä¸šåŠ¡" class="headerlink" title="ä¸€ã€å¯æ‰¿æ¥å’¨è¯¢æˆ–éƒ¨ç½²ä¸šåŠ¡"></a>ä¸€ã€å¯æ‰¿æ¥å’¨è¯¢æˆ–éƒ¨ç½²ä¸šåŠ¡</h1><h2 id="å£°æ˜"><a href="#å£°æ˜" class="headerlink" title="å£°æ˜"></a>å£°æ˜</h2><p>æœ¬äººæˆåŠŸåœ¨4å°æœåŠ¡å™¨æˆåŠŸéƒ¨ç½²æ»¡è¡€ç‰ˆDeepSeek-R1-671Bï¼Œç›¸å…³ä¿¡æ¯ç®€ä»‹å¦‚ä¸‹ï¼Œç°å¯æ‰¿æ¥å’¨è¯¢æŒ‡å¯¼æˆ–éƒ¨ç½²ä¸šåŠ¡è®¢å•ï¼Œéƒ¨ç½²è¿‡ç¨‹æ­£åœ¨é€æ­¥ä¼˜åŒ–å®Œå–„ï¼Œå¤§å®¶å¯ç›¸äº’ä¸€èµ·å­¦ä¹ ã€‚ä»¥ä¸‹æœ‰éƒ¨ç½²æˆåŠŸåçš„ç›¸å…³å†…å®¹å±•ç¤ºã€‚</p><h2 id="æ»¡è¡€ç‰ˆDeepSeek-R1-671Bå†…å®¹å±•ç¤º"><a href="#æ»¡è¡€ç‰ˆDeepSeek-R1-671Bå†…å®¹å±•ç¤º" class="headerlink" title="æ»¡è¡€ç‰ˆDeepSeek-R1-671Bå†…å®¹å±•ç¤º"></a>æ»¡è¡€ç‰ˆDeepSeek-R1-671Bå†…å®¹å±•ç¤º</h2><h3 id="Rayé›†ç¾¤çŠ¶æ€"><a href="#Rayé›†ç¾¤çŠ¶æ€" class="headerlink" title="Rayé›†ç¾¤çŠ¶æ€"></a>Rayé›†ç¾¤çŠ¶æ€</h3><p><img src="https://s2.loli.net/2025/02/26/bsPtS84kB67Gdvr.png" alt="image-20250226093654893"></p><h3 id="Production-Metrics"><a href="#Production-Metrics" class="headerlink" title="Production Metrics"></a>Production Metrics</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell">(self-llm) deepseek@deepseek2:~$ curl http://10.119.85.138:8000/metrics<br>...<br>540    0     # TYPE python_gc_objects_collected_total counter<br>0  7756k   python_gc_objects_collected_total&#123;generation=&quot;0&quot;&#125; 37427.0<br>   0 --:python_gc_objects_collected_total&#123;generation=&quot;1&quot;&#125; 14232.0<br>--:-- --:--:-- python_gc_objects_collected_total&#123;generation=&quot;2&quot;&#125; 16818.0<br>--:--:-- 9615k<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP python_gc_objects_uncollectable_total Uncollectable objects found during GC</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE python_gc_objects_uncollectable_total counter</span><br>python_gc_objects_uncollectable_total&#123;generation=&quot;0&quot;&#125; 0.0<br>python_gc_objects_uncollectable_total&#123;generation=&quot;1&quot;&#125; 0.0<br>python_gc_objects_uncollectable_total&#123;generation=&quot;2&quot;&#125; 0.0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP python_gc_collections_total Number of <span class="hljs-built_in">times</span> this generation was collected</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE python_gc_collections_total counter</span><br>python_gc_collections_total&#123;generation=&quot;0&quot;&#125; 3033.0<br>python_gc_collections_total&#123;generation=&quot;1&quot;&#125; 267.0<br>python_gc_collections_total&#123;generation=&quot;2&quot;&#125; 315.0<br>...<br></code></pre></td></tr></table></figure><h3 id="openai-APIæ¥å£æµ‹è¯•"><a href="#openai-APIæ¥å£æµ‹è¯•" class="headerlink" title="openai APIæ¥å£æµ‹è¯•"></a>openai APIæ¥å£æµ‹è¯•</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å…¶ä¸­ 10.119.85.138 æ˜¯deepseek2èŠ‚ç‚¹çš„IBç½‘å¡IP</span><br>(self-llm) deepseek@deepseek2:~$ curl 10.119.85.138:8000/v1/models -H &quot;Authorization: Bearer zY0MrQwXV9Oo3g==&quot; | jq  <br><span class="hljs-meta prompt_">#</span><span class="language-bash">è¾“å‡ºå†…å®¹å¦‚ä¸‹</span><br><span class="hljs-meta prompt_">  % </span><span class="language-bash">Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br>                                 Dload  Upload   Total   Spent    Left  Speed<br>100   523  100   523    0     0   105k      0 --:--:-- --:--:-- --:--:--  127k<br>&#123;<br>  &quot;object&quot;: &quot;list&quot;,<br>  &quot;data&quot;: [<br>    &#123;<br>      &quot;id&quot;: &quot;DeepSeek-R1-671B&quot;,<br>      &quot;object&quot;: &quot;model&quot;,<br>      &quot;created&quot;: 1740405511,<br>      &quot;owned_by&quot;: &quot;vllm&quot;,<br>      &quot;root&quot;: &quot;/root/.cache/huggingface/hub/models/unsloth/DeepSeek-R1-BF16/&quot;,<br>      &quot;parent&quot;: null,<br>      &quot;max_model_len&quot;: 32768,<br>      &quot;permission&quot;: [<br>        &#123;<br>          &quot;id&quot;: &quot;modelperm-ced685e8156b4618b593580109205165&quot;,<br>          &quot;object&quot;: &quot;model_permission&quot;,<br>          &quot;created&quot;: 1740405511,<br>          &quot;allow_create_engine&quot;: false,<br>          &quot;allow_sampling&quot;: true,<br>          &quot;allow_logprobs&quot;: true,<br>          &quot;allow_search_indices&quot;: false,<br>          &quot;allow_view&quot;: true,<br>          &quot;allow_fine_tuning&quot;: false,<br>          &quot;organization&quot;: &quot;*&quot;,<br>          &quot;group&quot;: null,<br>          &quot;is_blocking&quot;: false<br>        &#125;<br>      ]<br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure><p>åŒæ—¶åœ¨vllm serveå‘½ä»¤æ‰§è¡Œçš„çª—å£ä¼šçœ‹åˆ°å¦‚ä¸‹è¾“å‡ºå†…å®¹</p><p><img src="https://s2.loli.net/2025/02/24/F3td4gkAeSfwijK.png" alt="image-20250224215955409"></p><h3 id="æœåŠ¡åŠŸèƒ½éªŒè¯"><a href="#æœåŠ¡åŠŸèƒ½éªŒè¯" class="headerlink" title="æœåŠ¡åŠŸèƒ½éªŒè¯"></a>æœåŠ¡åŠŸèƒ½éªŒè¯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">(self-llm) deepseek@deepseek2:~$ curl -X POST &quot;http://10.119.85.138:8000/v1/chat/completions&quot; -H &quot;Content-Type: application/json&quot; -H &quot;Authorization: Bearer zY0MrQwXV9Oo3g==&quot;  -d &#x27;&#123; &quot;model&quot;: &quot;DeepSeek-R1-671B&quot;, &quot;messages&quot;: [&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;ä½ å¥½&quot;&#125;]&#125;&#x27;<br>    <br>(self-llm) deepseek@deepseek2:~$ curl -X POST &quot;http://10.119.85.138:8000/v1/chat/completions&quot; -H &quot;Content-Type: application/json&quot; -H &quot;Authorization: Bearer zY0MrQwXV9Oo3g==&quot;  -d &#x27;&#123; &quot;model&quot;: &quot;DeepSeek-R1-671B&quot;, &quot;messages&quot;: [&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;è¯·è¯æ˜å‹¾è‚¡å®šç†&quot;&#125;]&#125;&#x27;<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å›ç­”</span><br>&#123;&quot;id&quot;:&quot;chatcmpl-11ae1ddf321343af848b5c683e67b72d&quot;,&quot;object&quot;:&quot;chat.completion&quot;,&quot;created&quot;:1740411348,&quot;model&quot;:&quot;deepseek-r1&quot;,&quot;choices&quot;:[&#123;&quot;index&quot;:0,&quot;message&quot;:&#123;&quot;role&quot;:&quot;assistant&quot;,&quot;reasoning_content&quot;:null,&quot;content&quot;:&quot;&lt;think&gt;\nå—¯ï¼Œç”¨æˆ·è®©æˆ‘è¯æ˜å‹¾è‚¡å®šç†ã€‚å‹¾è‚¡å®šç†æ˜¯æ•°å­¦é‡Œéå¸¸åŸºç¡€ä½†åˆé‡è¦çš„å®šç†ï¼Œè‚¯å®šæœ‰å¾ˆå¤šä¸åŒçš„è¯æ˜æ–¹æ³•ã€‚å…ˆå›å¿†ä¸€ä¸‹ï¼Œå‹¾è‚¡å®šç†æ˜¯è¯´åœ¨ç›´è§’ä¸‰è§’å½¢ä¸­ï¼Œæ–œè¾¹çš„å¹³æ–¹ç­‰äºä¸¤æ¡ç›´è§’è¾¹çš„å¹³æ–¹å’Œï¼Œä¹Ÿå°±æ˜¯aÂ² + bÂ² = cÂ²ã€‚ç°åœ¨å¾—é€‰ä¸€<br>ç§åˆé€‚çš„è¯æ˜æ–¹å¼ï¼Œå¯èƒ½æ˜¯å‡ ä½•çš„æˆ–è€…ä»£æ•°çš„ã€‚\n\né¦–å…ˆæƒ³åˆ°çš„æ˜¯å‡ ä½•è¯æ˜ä¸­çš„æ‹¼æ¥æ³•ï¼Œé€šè¿‡å°†å››ä¸ªç›´è§’ä¸‰è§’å½¢æ‹¼æˆä¸€ä¸ªå¤§çš„æ­£æ–¹å½¢ï¼Œç„¶åæ¯”è¾ƒé¢ç§¯ã€‚æˆ‘è¦ä¸è¦è¯•è¯•è¿™ä¸ªæ–¹æ³•ï¼Ÿæ¯”å¦‚è¯´ï¼Œå››ä¸ªå…¨ç­‰çš„ç›´è§’ä¸‰è§’å½¢ï¼Œè®¾å®ƒä»¬çš„ç›´è§’è¾¹ä¸ºaå’Œbï¼Œ<br>æ–œè¾¹ä¸ºcï¼Œæ‹¼èµ·æ¥çš„è¯ä¸­é—´åº”è¯¥ä¼šå½¢æˆä¸€ä¸ªè¾¹é•¿ä¸ºï¼ˆa+bï¼‰çš„æ­£æ–¹å½¢ï¼Œä¸­é—´çš„ç©ºéš™å¯èƒ½æ˜¯å°æ­£æ–¹å½¢ï¼Œè¾¹é•¿æ˜¯cæˆ–è€…åˆ«çš„ï¼Ÿ\n\nä¸å¯¹ï¼Œåº”è¯¥ä¼šå½¢æˆä¸€ä¸ªè¾¹é•¿ä¸ºcçš„æ­£æ–¹å½¢ï¼Œæˆ–è€…è¿™ä¸ªï¼Ÿç­‰ä¸€ä¸‹ï¼Œå¯èƒ½å¾—ä»”ç»†ç”»ä¸ªå›¾æƒ³è±¡ä¸€ä¸‹ã€‚å‡è®¾æˆ‘ä»¬æŠŠå››ä¸ªä¸‰è§’<br>å½¢æ¯ä¸ªçš„ç›´è§’è¾¹æœå¤–ï¼Œé‚£æ–œè¾¹å°±ä¼šç»„æˆé‡Œé¢çš„ä¸€ä¸ªæ­£æ–¹å½¢ï¼Œè¿™æ—¶å€™<br>...<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å›ç­”é—®é¢˜çš„åŒæ—¶åœ¨vllm serveå‘½ä»¤æ‰§è¡Œçš„çª—å£ä¼šçœ‹åˆ°å¦‚ä¸‹ï¼Œæ˜¾ç¤ºtokenå¹³å‡ç”Ÿæˆååç‡</span><br>INFO 02-24 17:21:12 metrics.py:455] Avg prompt throughput: 1.6 tokens/s, Avg generation throughput: 36.5 tokens/s, Running: 1 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 0.0%, CPU KV cache usage: 0.0%.<br>INFO 02-24 17:21:17 metrics.py:455] Avg prompt throughput: 0.0 tokens/s, Avg generation throughput: 37.2 tokens/s, Running: 1 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 0.0%, CPU KV cache usage: 0.0%.<br>INFO 02-24 17:21:22 metrics.py:455] Avg prompt throughput: 0.0 tokens/s, Avg generation throughput: 36.5 tokens/s, Running: 1 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 0.1%, CPU KV cache usage: 0.0%.<br>...<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç”šè‡³æ›´é«˜é€Ÿåº¦</span><br>INFO 02-24 23:32:00 metrics.py:455] Avg prompt throughput: 442.9 tokens/s, Avg generation throughput: 38.8 tokens/s, Running: 3 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 0.4%, CPU KV cache usage: 0.0%.<br>INFO 02-24 23:32:05 metrics.py:455] Avg prompt throughput: 0.0 tokens/s, Avg generation throughput: 102.4 tokens/s, Running: 3 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 0.4%, CPU KV cache usage: 0.0%.<br>INFO 02-24 23:32:07 async_llm_engine.py:179] Finished request chatcmpl-03add50cba264c84afe98fd6cce9907f.<br>INFO 02-24 23:32:10 metrics.py:455] Avg prompt throughput: 0.0 tokens/s, Avg generation throughput: 79.4 tokens/s, Running: 2 reqs, Swapped: 0 reqs, Pending: 0 reqs, GPU KV cache usage: 0.3%, CPU KV cache usage: 0.0%.<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">apt install nvtop</span><br>(self-llm) deepseek@deepseek1:~/installPkgs$ nvtop<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚ä¸‹æ˜¯`nvtop`å‘½ä»¤è¾“å‡º</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/26/Z5zyE3Opj8dUtxl.png" alt="image-20250226093914412"></p><h3 id="open-webuiä¼šè¯ç•Œé¢"><a href="#open-webuiä¼šè¯ç•Œé¢" class="headerlink" title="open-webuiä¼šè¯ç•Œé¢"></a>open-webuiä¼šè¯ç•Œé¢</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å…¶ä¸­ 10.119.85.138 æ˜¯deepseek2èŠ‚ç‚¹çš„IBç½‘å¡IP</span><br>(self-llm) deepseek@deepseek2:~$ curl http://10.119.85.138:18080<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æˆ–åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è®¿é—®ä¸Šè¿°åœ°å€ã€‚ç¬¬ä¸€ä¸ªæ³¨å†Œçš„ç”¨æˆ·ï¼Œé»˜è®¤å°±æ˜¯ç®¡ç†å‘˜ã€‚æ³¨å†Œåç™»å½•ã€æé—®</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/25/u9lErBStzK3sULx.png" alt="image-20250225154520858"></p><h1 id="äºŒã€æˆåŠŸéƒ¨ç½²æ‰€ç”¨ç¡¬è½¯ä»¶"><a href="#äºŒã€æˆåŠŸéƒ¨ç½²æ‰€ç”¨ç¡¬è½¯ä»¶" class="headerlink" title="äºŒã€æˆåŠŸéƒ¨ç½²æ‰€ç”¨ç¡¬è½¯ä»¶"></a>äºŒã€æˆåŠŸéƒ¨ç½²æ‰€ç”¨ç¡¬è½¯ä»¶</h1><h2 id="æœåŠ¡å™¨ä¿¡æ¯"><a href="#æœåŠ¡å™¨ä¿¡æ¯" class="headerlink" title="æœåŠ¡å™¨ä¿¡æ¯"></a>æœåŠ¡å™¨ä¿¡æ¯</h2><p><img src="https://s2.loli.net/2025/02/26/fw78TozsM5AijvF.png" alt="image-20250226093523439">  </p><p>æ³¨ï¼š</p><p>ï¼ˆ1ï¼‰å…¶ä¸­çš„ä¸‡å…†ç½‘å¡éƒ¨ç½²è¿‡ç¨‹ä¸­æ²¡æœ‰ç”¨åˆ°ã€‚</p><p>ï¼ˆ2ï¼‰NVIDIA A800çš„ä¿¡æ¯å¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs shell">deepseek@deepseek1:~$ nvidia-smi <br>Fri Feb 21 09:25:35 2025       <br>+-----------------------------------------------------------------------------------------+<br>| NVIDIA-SMI 550.90.07              Driver Version: 550.90.07      CUDA Version: 12.4     |<br>|-----------------------------------------+------------------------+----------------------+<br>| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |<br>| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |<br>|                                         |                        |               MIG M. |<br>|=========================================+========================+======================|<br>|   0  NVIDIA A800-SXM4-80GB          On  |   00000000:3D:00.0 Off |                    0 |<br>| N/A   33C    P0             61W /  400W |       1MiB /  81920MiB |      0%      Default |<br>|                                         |                        |             Disabled |<br>+-----------------------------------------+------------------------+----------------------+<br>|   1  NVIDIA A800-SXM4-80GB          On  |   00000000:42:00.0 Off |                    0 |<br>| N/A   29C    P0             58W /  400W |       1MiB /  81920MiB |      0%      Default |<br>|                                         |                        |             Disabled |<br>+-----------------------------------------+------------------------+----------------------+<br>|   2  NVIDIA A800-SXM4-80GB          On  |   00000000:61:00.0 Off |                    0 |<br>| N/A   30C    P0             61W /  400W |       1MiB /  81920MiB |      0%      Default |<br>|                                         |                        |             Disabled |<br>+-----------------------------------------+------------------------+----------------------+<br>|   3  NVIDIA A800-SXM4-80GB          On  |   00000000:67:00.0 Off |                    0 |<br>| N/A   33C    P0             64W /  400W |       1MiB /  81920MiB |      0%      Default |<br>|                                         |                        |             Disabled |<br>+-----------------------------------------+------------------------+----------------------+<br>|   4  NVIDIA A800-SXM4-80GB          On  |   00000000:AD:00.0 Off |                    0 |<br>| N/A   32C    P0             57W /  400W |       1MiB /  81920MiB |      0%      Default |<br>|                                         |                        |             Disabled |<br>+-----------------------------------------+------------------------+----------------------+<br>|   5  NVIDIA A800-SXM4-80GB          On  |   00000000:B1:00.0 Off |                    0 |<br>| N/A   29C    P0             61W /  400W |       1MiB /  81920MiB |      0%      Default |<br>|                                         |                        |             Disabled |<br>+-----------------------------------------+------------------------+----------------------+<br>|   6  NVIDIA A800-SXM4-80GB          On  |   00000000:D0:00.0 Off |                    0 |<br>| N/A   30C    P0             62W /  400W |       1MiB /  81920MiB |      0%      Default |<br>|                                         |                        |             Disabled |<br>+-----------------------------------------+------------------------+----------------------+<br>|   7  NVIDIA A800-SXM4-80GB          On  |   00000000:D3:00.0 Off |                    0 |<br>| N/A   32C    P0             60W /  400W |       1MiB /  81920MiB |      0%      Default |<br>|                                         |                        |             Disabled |<br>+-----------------------------------------+------------------------+----------------------+<br>                                                                                         <br>+-----------------------------------------------------------------------------------------+<br>| Processes:                                                                              |<br>|  GPU   GI   CI        PID   Type   Process name                              GPU Memory |<br>|        ID   ID                                                               Usage      |<br>|=========================================================================================|<br>|  No running processes found                                                             |<br>+-----------------------------------------------------------------------------------------+<br></code></pre></td></tr></table></figure><h2 id="è½¯ä»¶ä¿¡æ¯"><a href="#è½¯ä»¶ä¿¡æ¯" class="headerlink" title="è½¯ä»¶ä¿¡æ¯"></a>è½¯ä»¶ä¿¡æ¯</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">ç‰©ç†æœåŠ¡å™¨æ“ä½œç³»ç»Ÿï¼šUbuntu</span> <span class="hljs-number">22.04</span><span class="hljs-number">.4</span> <span class="hljs-string">LTS-x86_64</span><br><span class="hljs-attr">Nvidia driver version:</span> <span class="hljs-number">550.90</span><span class="hljs-number">.07</span><br><span class="hljs-attr">CUDA runtime version:</span> <span class="hljs-number">12.1</span><span class="hljs-number">.105</span><span class="hljs-string">(nodeå®¹å™¨å†…)ã€V12.4.99(ç‰©ç†æœåŠ¡å™¨ä¸Š)</span><br><span class="hljs-string">nvidia-fabricmanagerç‰ˆæœ¬ï¼š550.90.07</span><br><span class="hljs-string">nvlinkï¼š3.0</span><br><span class="hljs-string">nvswitchï¼š2.0</span><br><br><span class="hljs-attr">PyTorch version:</span> <span class="hljs-number">2.5</span><span class="hljs-number">.1</span><span class="hljs-string">+cu124</span><br><span class="hljs-attr">CUDA used to build PyTorch:</span> <span class="hljs-number">12.4</span><br><span class="hljs-attr">OS:</span> <span class="hljs-string">Ubuntu</span> <span class="hljs-number">22.04</span><span class="hljs-number">.3</span> <span class="hljs-string">LTS</span> <span class="hljs-string">(x86_64)</span><br><span class="hljs-attr">GCC version:</span> <span class="hljs-string">(Ubuntu</span> <span class="hljs-number">11.4</span><span class="hljs-number">.0</span><span class="hljs-string">-1ubuntu1~22.04)</span> <span class="hljs-number">11.4</span><span class="hljs-number">.0</span><br><span class="hljs-attr">CMake version:</span> <span class="hljs-string">version</span> <span class="hljs-number">3.31</span><span class="hljs-number">.4</span><br><span class="hljs-attr">Libc version:</span> <span class="hljs-string">glibc-2.35</span><br><span class="hljs-attr">Python version:</span> <span class="hljs-number">3.12</span><span class="hljs-number">.9</span> <span class="hljs-string">(main,</span> <span class="hljs-string">Feb</span>  <span class="hljs-number">5</span> <span class="hljs-number">2025</span><span class="hljs-string">,</span> <span class="hljs-number">08</span><span class="hljs-string">:49:00)</span> [<span class="hljs-string">GCC</span> <span class="hljs-number">11.4</span><span class="hljs-number">.0</span>] <span class="hljs-string">(64-bit</span> <span class="hljs-string">runtime)</span><br><span class="hljs-attr">Python platform:</span> <span class="hljs-string">Linux-5.15.0-113-generic-x86_64-with-glibc2.35</span><br><span class="hljs-attr">Is CUDA available:</span> <span class="hljs-literal">True</span><br><br><span class="hljs-attr">CUDA_MODULE_LOADING set to:</span> <span class="hljs-string">LAZY</span><br><span class="hljs-attr">Is XNNPACK available:</span> <span class="hljs-literal">True</span><br><span class="hljs-attr">CPU:</span> <span class="hljs-string">Intel(R)</span> <span class="hljs-string">Xeon(R)</span> <span class="hljs-string">Gold</span> <span class="hljs-number">6348 </span><span class="hljs-string">CPU</span> <span class="hljs-string">@</span> <span class="hljs-number">2.</span><span class="hljs-string">60GHz,</span> <span class="hljs-number">112</span><span class="hljs-string">æ ¸å¿ƒ</span><br><span class="hljs-string">numpy==1.26.4</span><br><span class="hljs-string">torch==2.5.1</span><br><span class="hljs-string">torchaudio==2.5.1</span><br><span class="hljs-string">torchvision==0.20.1</span><br><span class="hljs-string">triton==3.1.0</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ»¡è¡€ç‰ˆDeepSeek-R1-671B</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ubuntu2204LTS-x86_64å®‰è£…Cuda12.4</title>
    <link href="/2025/02/21/Ubuntu2204LTS-x86-64%E5%AE%89%E8%A3%85Cuda12-4/"/>
    <url>/2025/02/21/Ubuntu2204LTS-x86-64%E5%AE%89%E8%A3%85Cuda12-4/</url>
    
    <content type="html"><![CDATA[<p> å®‰è£…Cudaä¹‹å‰éœ€è¦ä¿è¯NVIDIAé©±åŠ¨å®‰è£…å¥½ã€‚Cudaå®‰è£…å¯å‚è€ƒNVIDIAå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.nvidia.com/cuda/cuda-installation-guide-linux/#ubuntu">cuda-installation-guide-linux</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æœåŠ¡å™¨æ‹¿åˆ°æ‰‹æ—¶ï¼Œå‘ç°å·²ç»å®‰è£…äº†Cuda11.5.119</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##å¦‚æœè¦ä½¿ç”¨aptå®‰è£…nvccï¼ˆæ­¤æ–¹å¼åœ¨Ubuntu22.04LTSä¸Šå®‰è£…çš„æ˜¯Cuda11.5.119ï¼‰ï¼šsudo apt install nvidia-cuda-toolkit</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹ç°æœ‰nvccç‰ˆæœ¬</span><br>deepseek@deepseek1:~/installPkgs$ nvcc -V<br>nvcc: NVIDIA (R) Cuda compiler driver<br>Copyright (c) 2005-2021 NVIDIA Corporation<br>Built on Thu_Nov_18_09:45:30_PST_2021<br>Cuda compilation tools, release 11.5, V11.5.119<br>Build cuda_11.5.r11.5/compiler.30672275_0<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##å¸è½½ç°æœ‰çš„Cuda11.5.119ï¼š</span></span><br>deepseek@deepseek1:~/installPkgs$ sudo apt remove nvidia-cuda-toolkit<br></code></pre></td></tr></table></figure><p>æˆ‘æƒ³æ”¹æˆä½¿ç”¨Cuda12.4ã€‚è®¿é—®<a href="https://developer.nvidia.com/cuda-12-4-0-download-archive">NVIDIAå®˜ç½‘cudaå®‰è£…æ–‡ä»¶ä¸‹è½½ç½‘é¡µ</a> ï¼Œä¾æ¬¡é€‰æ‹©å¦‚ä¸‹é€‰é¡¹æ‰¾åˆ°ä¸‹è½½ä¸å®‰è£…å‘½ä»¤ï¼š</p><p><img src="https://s2.loli.net/2025/02/21/iv6oBq75Rr8EzDO.png" alt="image-20250221172033572"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹è½½å®‰è£…æ–‡ä»¶</span><br>(self-llm) deepseek@deepseek1:~/installPkgs$ wget https://developer.download.nvidia.com/compute/cuda/12.4.0/local_installers/cuda_12.4.0_550.54.14_linux.run<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰§è¡Œå®‰è£…</span><br>(self-llm) deepseek@deepseek1:~/installPkgs$ sudo sh cuda_12.4.0_550.54.14_linux.run<br><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨å¼¹å‡ºå¯¹è¯ä¸­è¾“å…¥â€œacceptâ€æ¥å—æ¡æ¬¾ï¼Œç„¶åå¦‚ä¸‹é€‰æ‹©</span><br></code></pre></td></tr></table></figure><img src="https://s2.loli.net/2025/02/21/i8vKNVPkExZjD65.png" alt="image-20250221173309528" style="zoom:50%;" /><p><img src="https://s2.loli.net/2025/02/22/s8wCKUVEL2Sphna.png" alt="image-20250222162736130"></p><p>å®‰è£…è¿›ç¨‹å®Œæˆåï¼Œè¾“å‡ºå¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell">===========<br>= Summary =<br>===========<br><br>Driver:   Not Selected<br>Toolkit:  Installed in /usr/local/cuda-12.4/<br><br>Please make sure that<br> -   PATH includes /usr/local/cuda-12.4/bin<br> -   LD_LIBRARY_PATH includes /usr/local/cuda-12.4/lib64, or, add /usr/local/cuda-12.4/lib64 to /etc/ld.so.conf and run ldconfig as root<br><br>To uninstall the CUDA Toolkit, run cuda-uninstaller in /usr/local/cuda-12.4/bin<br>***WARNING: Incomplete installation! This installation did not install the CUDA Driver. A driver of version at least 550.00 is required for CUDA 12.4 functionality to work.<br>To install the driver using this installer, run the following command, replacing &lt;CudaInstaller&gt; with the name of this run file:<br>    sudo &lt;CudaInstaller&gt;.run --silent --driver<br><br>Logfile is /var/log/cuda-installer.log<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å‘ç°ç³»ç»Ÿå·²ç»åˆ›å»ºè½¯é“¾æ¥/usr/local/cudaï¼ŒæŒ‡å‘/usr/local/cuda-12.4/ã€‚åç»­ä½¿ç”¨æ­¤è½¯é“¾æ¥</span><br>(self-llm) deepseek@deepseek1:~/installPkgs$ ls -al /usr/local/cuda<br>lrwxrwxrwx 1 root root 21 Feb 21 17:55 /usr/local/cuda -&gt; /usr/local/cuda-12.4/<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŒ‰ç…§æç¤ºä¿®æ”¹ç³»ç»Ÿç¯å¢ƒå˜é‡PATHã€LD_LIBRARY_PATH</span><br>(self-llm) deepseek@deepseek1:~/installPkgs$ sudo vi /etc/profile<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##åœ¨æœ€åæ·»åŠ å¦‚ä¸‹å†…å®¹</span></span><br>export PATH=$PATH:/usr/local/cuda/bin/<br>export LD_LIBRARY_PATH=/usr/local/cuda/lib64/<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é‡æ–°æ‰“ä¸€ä¸ªç»ˆç«¯ä¼šè¯çª—å£æˆ–é‡æ–°åŠ è½½ä¸Šè¿°æ–‡ä»¶ä»¥å¯ç”¨ä¸Šè¿°ä¸¤ä¸ªä¿®æ”¹æˆ–æ·»åŠ çš„ç³»ç»Ÿç¯å¢ƒå˜é‡</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é‡æ–°åŠ è½½ä¸Šè¿°æ–‡ä»¶çš„æ–¹æ³•ï¼š<span class="hljs-built_in">source</span> /etc/profile</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä»¥ä¸‹ä»¥é‡æ–°æ‰“ä¸€ä¸ªç»ˆç«¯ä¼šè¯çª—å£ä¸ºä¾‹ç»§ç»­åç»­æ“ä½œ</span><br>(base) deepseek@deepseek1:~$ conda activate self-llm<br>(self-llm) deepseek@deepseek1:~$ echo $PATH<br>/home/deepseek/anaconda3/envs/self-llm/bin:/home/deepseek/anaconda3/condabin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/usr/local/cuda/bin<br>(self-llm) deepseek@deepseek1:~$ echo $LD_LIBRARY_PATH  <br>/usr/local/cuda/lib64/<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯ä»¥çœ‹åˆ°å½“å‰ä½¿ç”¨çš„Cudaç‰ˆæœ¬å·²ç»æ˜¯V12.4.99</span><br>(self-llm) deepseek@deepseek1:~$ nvcc -V<br>nvcc: NVIDIA (R) Cuda compiler driver<br>Copyright (c) 2005-2024 NVIDIA Corporation<br>Built on Tue_Feb_27_16:19:38_PST_2024<br>Cuda compilation tools, release 12.4, V12.4.99<br>Build cuda_12.4.r12.4/compiler.33961263_0<br>(self-llm) deepseek@deepseek1:~$ <br></code></pre></td></tr></table></figure><h2 id=""><a href="#" class="headerlink" title=""></a></h2>]]></content>
    
    
    <categories>
      
      <category>NVIDIAç”Ÿæ€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å®‰è£…Cuda12.4</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è¯•ç”¨è…¾è®¯äº‘åº”ç”¨å¿«é€Ÿéƒ¨ç½²DeepSeekæœåŠ¡</title>
    <link href="/2025/02/19/%E8%AF%95%E7%94%A8%E8%85%BE%E8%AE%AF%E4%BA%91%E5%BA%94%E7%94%A8%E9%83%A8%E7%BD%B2DeepSeek%E6%9C%8D%E5%8A%A1/"/>
    <url>/2025/02/19/%E8%AF%95%E7%94%A8%E8%85%BE%E8%AE%AF%E4%BA%91%E5%BA%94%E7%94%A8%E9%83%A8%E7%BD%B2DeepSeek%E6%9C%8D%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€äº§å“è¯´æ˜ä¸è®¡è´¹"><a href="#ä¸€ã€äº§å“è¯´æ˜ä¸è®¡è´¹" class="headerlink" title="ä¸€ã€äº§å“è¯´æ˜ä¸è®¡è´¹"></a>ä¸€ã€äº§å“è¯´æ˜ä¸è®¡è´¹</h1><h2 id="1-1-äº§å“è¯´æ˜"><a href="#1-1-äº§å“è¯´æ˜" class="headerlink" title="1.1 äº§å“è¯´æ˜"></a>1.1 äº§å“è¯´æ˜</h2><p>è…¾è®¯äº‘æä¾›é«˜æ€§èƒ½åº”ç”¨æœåŠ¡ï¼ˆHAIï¼‰å’Œäº‘æœåŠ¡å™¨ï¼ˆCVMï¼‰ä¸¤ç§ç±»å‹ç®—åŠ›ä»¥åº”ç”¨éƒ¨ç½²çš„å½¢å¼æ¥éƒ¨ç½²ç®—åŠ›ï¼Œä½†ä¸Šé¢è…¾è®¯ä¹ŸåŒæ—¶æä¾›äº†ä½¿ç”¨æ­¤ç®—åŠ›å…¶ä»–åº”ç”¨ï¼Œå¯ä»¥åœ¨ä¸Šé¢ä½¿ç”¨äº‘æœåŠ¡å™¨éƒ¨ç½²è‡ªå·±DeepSeekæœåŠ¡ã€ä½¿ç”¨ç”¨ç®—åŠ›è¿›è¡Œè½¯ä»¶ç ”å‘ç­‰ï¼Œç®—æ˜¯SaaSäº§å“ã€‚</p><p>ç›®å‰ï¼Œè…¾è®¯äº‘å·²æä¾›Cloud Studioã€äº‘åŸç”Ÿæ„å»ºã€HAIã€APIæ¥å£ã€çŸ¥è¯†å¼•æ“ç­‰å¤šç§æ¥å…¥æ–¹å¼ã€‚æœ¬ç€ä½“éªŒé«˜é€Ÿç¨³å®šDeepSeekçš„åˆè¡·ï¼Œè‡ªå·±å¯¹æ­¤äº§å“çš„ç®€å•è¯•ç”¨äº†ä¸‹ï¼Œä¸‹é¢æ˜¯è¯•ç”¨è®°å½•ã€‚</p><h2 id="1-2-è½¯ä»¶è®¡è´¹è¯´æ˜"><a href="#1-2-è½¯ä»¶è®¡è´¹è¯´æ˜" class="headerlink" title="1.2 è½¯ä»¶è®¡è´¹è¯´æ˜"></a>1.2 è½¯ä»¶è®¡è´¹è¯´æ˜</h2><p>è½¯ä»¶å…è´¹ï¼Œäº‘èµ„æºæŒ‰æ¶ˆè€—æ”¶è´¹ã€‚äº‘èµ„æºè´¹ç”¨æŒ‰è¿è¡Œè½¯ä»¶äº§ç”Ÿçš„æ¶ˆè€—è¿›è¡Œæ”¶å–ï¼Œèµ„æºå®šä»·å¯åœ¨åº”ç”¨å®‰è£…é¡µæŸ¥çœ‹è¯¦æƒ…ã€‚</p><ul><li>é«˜æ€§èƒ½åº”ç”¨æœåŠ¡ HAI å•ä»·ï¼Œå‚è€ƒ<a href="https://buy.cloud.tencent.com/hai">é«˜æ€§èƒ½åº”ç”¨æœåŠ¡ HAI å•ä»·</a></li><li>é«˜æ€§èƒ½åº”ç”¨æœåŠ¡è¯¦ç»†è®¡è´¹è¯´æ˜ï¼Œè¯·å‚è€ƒé«˜æ€§èƒ½åº”ç”¨<a href="https://cloud.tencent.com/document/product/1721/101029">æœåŠ¡è®¡è´¹</a>æ¦‚è¿°æ–‡æ¡£</li><li>äº‘æœåŠ¡å™¨ï¼ˆCVMï¼‰å•ä»·ï¼Œå‚è€ƒ<a href="https://buy.cloud.tencent.com/price/cvm/calculator">ä»·æ ¼è®¡ç®—å™¨</a></li></ul><h1 id="äºŒã€äº§å“ä½“éªŒä¸ä½¿ç”¨æ­¥éª¤"><a href="#äºŒã€äº§å“ä½“éªŒä¸ä½¿ç”¨æ­¥éª¤" class="headerlink" title="äºŒã€äº§å“ä½“éªŒä¸ä½¿ç”¨æ­¥éª¤"></a>äºŒã€äº§å“ä½“éªŒä¸ä½¿ç”¨æ­¥éª¤</h1><h2 id="2-1-è¿›å…¥è…¾è®¯äº‘DeepSeek-çš„å•†å“é¡µé¢"><a href="#2-1-è¿›å…¥è…¾è®¯äº‘DeepSeek-çš„å•†å“é¡µé¢" class="headerlink" title="2.1 è¿›å…¥è…¾è®¯äº‘DeepSeek çš„å•†å“é¡µé¢"></a>2.1 è¿›å…¥è…¾è®¯äº‘DeepSeek çš„å•†å“é¡µé¢</h2><p>è¿›å…¥ <a href="https://app.cloud.tencent.com/detail/SPU_BHDIEHIJCA8003">è…¾è®¯äº‘DeepSeek çš„å•†å“é¡µé¢</a> ï¼Œä½¿ç”¨å¾®ä¿¡æ‰«ç æˆ–ç›´æ¥ç”¨è´¦å·ç™»å½•è…¾è®¯äº‘ç½‘é¡µã€‚</p><p><img src="https://s2.loli.net/2025/02/19/6ezhUc3LfTtxAbI.png" alt="image-20250219213654060"></p><h2 id="2-2-è¿›å…¥å®‰è£…é¡µé¢"><a href="#2-2-è¿›å…¥å®‰è£…é¡µé¢" class="headerlink" title="2.2 è¿›å…¥å®‰è£…é¡µé¢"></a>2.2 è¿›å…¥å®‰è£…é¡µé¢</h2><p>å•å‡»ä¸Šå›¾ä¸­çš„â€œå®‰è£…åº”ç”¨â€æŒ‰é’®ï¼Œè¿›å…¥å®‰è£…é¡µé¢</p><p><img src="https://s2.loli.net/2025/02/19/AHeYN1piyJzTQbn.png" alt="image-20250219214019256"></p><p>ï¼ˆ1ï¼‰åº”ç”¨åç§°å¯è‡ªå®šä¹‰ã€‚æ­¤å¤„ä½¿ç”¨é»˜è®¤</p><p>ï¼ˆ2ï¼‰é€‰æ‹©ç®—åŠ›ç±»å‹ã€‚å…³äºä¸Šå›¾ä¸­ç®—åŠ›ç±»å‹çš„è¯´æ˜å¦‚ä¸‹ï¼Œä¸¤ç§ç®—åŠ›ç±»å‹æä¾›çš„ DeepSeek æœåŠ¡æœ‰æ‰€å·®å¼‚ï¼Œå¯¹æ¯”å¦‚ä¸‹ï¼š</p><table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>é«˜æ€§èƒ½åº”ç”¨æœåŠ¡ï¼ˆHAIï¼‰</th><th>äº‘æœåŠ¡å™¨ï¼ˆCVMï¼‰</th></tr></thead><tbody><tr><td>åº“å­˜</td><td>æä¾›æœºå‹è°ƒåº¦èƒ½åŠ›ï¼ŒæŒ‡å®šç®—åŠ›åŒ¹é…æœºå‹ï¼Œåœ¨åº“å­˜ç´§å¼ çš„æƒ…å†µä¸‹è°ƒåº¦æˆåŠŸæ¦‚ç‡æ›´é«˜ã€‚</td><td>ç”¨æˆ·è‡ªä¸»é€‰æ‹©æœºå‹ï¼Œåº“å­˜ç´§å¼ æ—¶ï¼Œéœ€è¦åœ¨ä¸åŒçš„å¯ç”¨åŒºå’Œæœºå‹ä¹‹é—´é‡è¯•ã€‚</td></tr><tr><td>æ¨¡å‹</td><td><strong>å†…ç½®æ¨¡å‹ç‰ˆæœ¬ï¼š</strong><br/>deepseek-r1:1.5b<br/>deepseek-r1:7b<br/>deepseek-r1:8b<br/>deepseek-r1:14b<br/>deepseek-r1:32b</td><td><strong>å†…ç½®æ¨¡å‹ç‰ˆæœ¬ï¼š</strong><br/>deepseek-r1:7b<br/>deepseek-r1:32b<br/>deepseek-r1:70b</td></tr><tr><td>ç»„ä»¶</td><td><strong>å†…ç½®ç»„ä»¶ï¼š</strong><br/>Open WebUIï¼ˆ6699 ç«¯å£ï¼‰<br/>Chatbot UIï¼ˆ6889 ç«¯å£ï¼‰<br/>Jupyter Labï¼ˆ6888 ç«¯å£ï¼‰</td><td><strong>å†…ç½®ç»„ä»¶ï¼š</strong><br/>Open WebUI (8080 ç«¯å£)<br/>Ollama API (11434 ç«¯å£ï¼Œå†…ç½‘è®¿é—®)</td></tr><tr><td>ç½‘ç»œ</td><td>å…¬ç½‘è®¿é—®ï¼šæ”¯æŒï¼ˆå«å­¦æœ¯åŠ é€Ÿï¼‰ã€‚<br />å†…ç½‘è®¿é—®ï¼šèµ°äº‘è”ç½‘æ‰“é€šã€‚</td><td>å…¬ç½‘è®¿é—®ï¼šæ”¯æŒ<br />å†…ç½‘è®¿é—®ï¼šæ”¯æŒï¼ŒVPC å†…äº’è®¿ã€‚</td></tr><tr><td>ç™»å½•</td><td><strong>ç™»å½•åˆ°å®¹å™¨è¿›ç¨‹ï¼Œæ”¯æŒçš„ç™»å½•æ–¹å¼ï¼š</strong><br />Cloud Studioï¼ˆç±»ä¼¼ VSCode ä½“éªŒï¼‰<br />OrcaTerm (å¯†ç ç™»å½•)<br />SSHï¼ˆå¯†ç ç™»å½•ï¼‰</td><td><strong>ç™»å½•åˆ°äº‘æœåŠ¡å™¨ï¼Œæ”¯æŒçš„ç™»å½•æ–¹å¼ï¼š</strong><br />OrcaTerm (å…å¯†ç™»å½•)<br />SSH (å¯†ç æˆ–å¯†é’¥ç™»å½•)</td></tr></tbody></table><p>ï¼ˆ3ï¼‰é€‰æ‹©éƒ¨ç½²åœ°åŸŸï¼Œæ­¤å¤„é€‰æ‹©å¹¿å·</p><p>ï¼ˆ4ï¼‰é€‰æ‹©ç®—åŠ›æ–¹æ¡ˆã€‚ç¬”è€…çœ‹åˆ°æœ‰3ç§ç±»å‹å¯é€‰ï¼Œé…ç½®è¶Šé«˜ï¼Œå•ä»·è¶Šé«˜ã€‚æ­¤å¤„è¯•ç”¨é€‰æ‹©GPUåŸºç¡€å‹ï¼Œå•ä»·1.2å…ƒ&#x2F;å°æ—¶</p><p><img src="https://s2.loli.net/2025/02/19/AdCLzgV4BarxToj.png" alt="image-20250219214600666"></p><p>ï¼ˆ5ï¼‰è§’è‰²æˆæƒï¼Œæˆ‘ä½¿ç”¨æ˜¯ä¸ªäººå®åè´¦æˆ·ç™»å½•ï¼Œåªæœ‰ä¸€ä¸ªå¯é€‰ã€‚</p><p>ï¼ˆ6ï¼‰æœ€åç‚¹å‡»â€œä¸‹ä¸€æ­¥ï¼šç¡®è®¤èµ„æºâ€æŒ‰é’®ï¼Œè¿›å…¥èµ„æºç¡®è®¤é¡µé¢ï¼Œç¡®è®¤åç»­èµ„æºæ¶ˆè€—æ¸…å•</p><h2 id="2-3-ç¡®è®¤è®¢å•ä¿¡æ¯"><a href="#2-3-ç¡®è®¤è®¢å•ä¿¡æ¯" class="headerlink" title="2.3 ç¡®è®¤è®¢å•ä¿¡æ¯"></a>2.3 ç¡®è®¤è®¢å•ä¿¡æ¯</h2><p><img src="https://s2.loli.net/2025/02/19/TrWsnklZG9L4iPz.png" alt="image-20250219215339506"></p><p>ï¼ˆ1ï¼‰â€œæˆæƒâ€å•é€‰æ¡†ä¸­å°è¯•é€‰ä¸­ï¼Œåœ¨å¼¹å‡ºçª—å£ä¸­é€‰æ‹©â€œåŒæ„æˆæƒâ€</p><p>ï¼ˆ2ï¼‰ç„¶åç‚¹å‡»â€œä¸‹ä¸€æ­¥ï¼šå®‰è£…åº”ç”¨â€æŒ‰é’®ï¼Œä»¥å®‰è£…éƒ¨ç½²åº”ç”¨ã€‚</p><h2 id="2-4-ç­‰å¾…åº”ç”¨å®‰è£…éƒ¨ç½²å®Œæˆ"><a href="#2-4-ç­‰å¾…åº”ç”¨å®‰è£…éƒ¨ç½²å®Œæˆ" class="headerlink" title="2.4 ç­‰å¾…åº”ç”¨å®‰è£…éƒ¨ç½²å®Œæˆ"></a>2.4 ç­‰å¾…åº”ç”¨å®‰è£…éƒ¨ç½²å®Œæˆ</h2><p>æ¥ä¸‹æ¥è¿›å…¥å¦‚ä¸‹â€œå®‰è£…éƒ¨ç½²åº”ç”¨â€é¡µé¢ï¼Œç­‰å¾…åº”ç”¨å®‰è£…éƒ¨ç½²å®Œæˆã€‚</p><p><img src="https://s2.loli.net/2025/02/19/JriRuN8f1UMAFQp.png" alt="image-20250219215652012"></p><h2 id="2-5-åº”ç”¨æ¦‚è§ˆç•Œé¢"><a href="#2-5-åº”ç”¨æ¦‚è§ˆç•Œé¢" class="headerlink" title="2.5 åº”ç”¨æ¦‚è§ˆç•Œé¢"></a>2.5 åº”ç”¨æ¦‚è§ˆç•Œé¢</h2><p>åº”ç”¨éƒ¨ç½²å®Œæˆåè¿›å…¥åº”ç”¨æ¦‚è§ˆç•Œé¢ï¼Œçœ‹åˆ°å¦‚å›¾ç•Œé¢å†…å®¹ã€‚</p><p><img src="https://s2.loli.net/2025/02/19/h2TbeCHQ81Fa9cu.png" alt="image-20250219220841011"></p><h2 id="2-6-æ‰“å¼€åº”ç”¨-æ¨¡å‹ä¼šè¯ç•Œé¢"><a href="#2-6-æ‰“å¼€åº”ç”¨-æ¨¡å‹ä¼šè¯ç•Œé¢" class="headerlink" title="2.6 æ‰“å¼€åº”ç”¨-æ¨¡å‹ä¼šè¯ç•Œé¢"></a>2.6 æ‰“å¼€åº”ç”¨-æ¨¡å‹ä¼šè¯ç•Œé¢</h2><p>ç‚¹å‡»ä¸Šå›¾å³ä¸Šè§’çš„â€œæ‰“å¼€åº”ç”¨â€æŒ‰é’®ï¼Œè·³è½¬åˆ° Web ç•Œé¢è·Ÿæ¨¡å‹å¯¹è¯</p><p><img src="https://s2.loli.net/2025/02/19/4fTIKUuyA9EqdbG.png" alt="image-20250219221053479"></p><p>ç‚¹å‡»ä¸Šå›¾åº•éƒ¨çš„â€œå¼€å§‹ä½¿ç”¨â€æŒ‰é’®ï¼Œå°†è·³è½¬åˆ°â€œOpen WebUIâ€è®¤è¯é¡µé¢</p><h2 id="2-7-OpenWebUIè®¤è¯é¡µé¢æ³¨å†Œ"><a href="#2-7-OpenWebUIè®¤è¯é¡µé¢æ³¨å†Œ" class="headerlink" title="2.7 OpenWebUIè®¤è¯é¡µé¢æ³¨å†Œ"></a>2.7 OpenWebUIè®¤è¯é¡µé¢æ³¨å†Œ</h2><p>åœ¨â€œOpen WebUIâ€è®¤è¯é¡µé¢ï¼Œè¾“å…¥ç”¨æˆ·åã€é‚®ç®±ä¸å¯†ç è¿›è¡Œæ³¨å†Œã€‚</p><p><img src="https://s2.loli.net/2025/02/19/gis7IqDYaLHcCr3.png" alt="image-20250219221335773"></p><p>æ³¨å†ŒæˆåŠŸï¼ˆæ ¹æ®æç¤ºï¼Œæ­¤æ³¨å†Œä¿¡æ¯åªä¼šä¿å­˜åœ¨æœ¬åœ°æ‰˜ç®¡çš„æœåŠ¡å™¨ä¸Šï¼‰åï¼Œå°†è·³è½¬åˆ°ä¼šè¯ç•Œé¢ã€‚</p><h2 id="2-8-é€‰æ‹©æ¨¡å‹è¿›è¡Œä¼šè¯"><a href="#2-8-é€‰æ‹©æ¨¡å‹è¿›è¡Œä¼šè¯" class="headerlink" title="2.8 é€‰æ‹©æ¨¡å‹è¿›è¡Œä¼šè¯"></a>2.8 é€‰æ‹©æ¨¡å‹è¿›è¡Œä¼šè¯</h2><p>åœ¨æ¨¡å‹ä¼šè¯ç•Œé¢ï¼Œé€‰æ‹©æ¨¡å‹å¹¶è¿›è¡Œä¼šè¯</p><p><img src="https://s2.loli.net/2025/02/19/86nFk3fJUwNZ5ct.png" alt="image-20250219221746434"></p><p>ï¼ˆ1ï¼‰å¯ä»¥çœ‹åˆ°ï¼Œæœ‰DeepSeek-R1æ¨¡å‹çš„å¤šä¸ªå‚æ•°ç‰ˆæœ¬å¯ä¾›é€‰æ‹©ï¼Œæœ€é«˜å‚æ•°ç‰ˆæœ¬æ˜¯32B</p><h2 id="2-9-OpenWebUIç•Œé¢ä¼šè¯æ•ˆæœ"><a href="#2-9-OpenWebUIç•Œé¢ä¼šè¯æ•ˆæœ" class="headerlink" title="2.9 OpenWebUIç•Œé¢ä¼šè¯æ•ˆæœ"></a>2.9 OpenWebUIç•Œé¢ä¼šè¯æ•ˆæœ</h2><p><img src="https://s2.loli.net/2025/02/19/dbSNrxtHqDypom4.png" alt="image-20250219222312804"></p><p>å›ç­”é—®é¢˜é€Ÿåº¦ä¸é”™ï¼Œä½“éªŒè¿˜è¡Œã€‚</p><h2 id="2-10-åº”ç”¨ç®¡ç†ä¸åº”ç”¨èµ„æº"><a href="#2-10-åº”ç”¨ç®¡ç†ä¸åº”ç”¨èµ„æº" class="headerlink" title="2.10 åº”ç”¨ç®¡ç†ä¸åº”ç”¨èµ„æº"></a>2.10 åº”ç”¨ç®¡ç†ä¸åº”ç”¨èµ„æº</h2><p>åœ¨ç¬¬2.5æ­¥çš„åº”ç”¨æ¦‚è§ˆç•Œé¢ï¼Œå¯ä»¥æŸ¥çœ‹â€œåº”ç”¨èµ„æºâ€ä¿¡æ¯</p><p><img src="https://s2.loli.net/2025/02/19/axrbZHqP8SlEMjN.png" alt="image-20250219222439742"></p><p>è¿˜å¯ä»¥æŸ¥çœ‹â€œåº”ç”¨ä¿¡æ¯â€ä¿¡æ¯</p><p><img src="https://s2.loli.net/2025/02/19/i1vfNhcjBwXK2bU.png" alt="image-20250219222633420"></p><p>ï¼ˆ1ï¼‰â€œåº”ç”¨ä¿¡æ¯â€é¡µé¢åº•éƒ¨ï¼Œæœ‰å¤šä¸ªåŠŸèƒ½ä½¿ç”¨è¯´æ˜ï¼Œå¦‚â€œåœ¨å†…ç½‘ä½¿ç”¨ Ollama API ä½¿ç”¨ DeepSeek æ¨¡å‹â€ã€â€œå¼€å¯ API é‰´æƒâ€ã€â€œæ›´æ”¹ WebUI ç«¯å£â€</p><p>ï¼ˆ2ï¼‰ç‚¹å‡»â€œCloudStudioâ€å¯¹åº”çš„é“¾æ¥ï¼Œå°†è¿›å…¥<strong>CloudStudio</strong> ä½¿ç”¨ç•Œé¢ï¼Œçœ‹ç•Œé¢è·ŸVScodeå¾ˆåƒ</p><p><img src="https://s2.loli.net/2025/02/19/wPvSKLpmFgxGlBq.png" alt="image-20250219222919680"></p><p>ï¼ˆ3ï¼‰ç‚¹å‡»â€œHAI æ§åˆ¶å°â€å¯¹åº”é“¾æ¥ï¼Œå°†è¿›å…¥HAI æ§åˆ¶å°ç•Œé¢ï¼Œå¦‚ä¸‹ï¼š</p><p>å¯ä»¥å¯¹æœåŠ¡å™¨è¿›è¡Œç®¡ç†ï¼š</p><p><img src="https://s2.loli.net/2025/02/19/CZIbXDOB4w83U5t.png" alt="image-20250219223202794"></p><p>è¿˜æœ‰ç®—åŠ›è¿æ¥çš„ä¾¿æ·æ‰“å¼€æ–¹å¼ï¼š</p><p><img src="https://s2.loli.net/2025/02/19/8SbiOajVBAKJNXE.png" alt="image-20250219223252830"></p><p>ï¼ˆ3ï¼‰ç‚¹å‡»â€œDeepSeek å¯¹è¯â€å¯¹åº”çš„é“¾æ¥ï¼Œå°±è·³è½¬åˆ°ç¬¬6æ­¥ä¸­çš„â€œOpen WebUIæ¨¡å‹ä¼šè¯ç•Œé¢â€</p><p>ï¼ˆ4ï¼‰ç‚¹å‡»â€œChatbotUIâ€å¯¹åº”çš„é“¾æ¥ï¼Œå°†è·³è½¬åˆ°â€œChatbotUIæ¨¡å‹ä¼šè¯ç•Œé¢â€ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2025/02/19/fwhnUSA2IOM1vHl.png" alt="image-20250219222145222"></p><h2 id="2-11-å…³æœº"><a href="#2-11-å…³æœº" class="headerlink" title="2.11 å…³æœº"></a>2.11 å…³æœº</h2><p>å…³æœºåè®¡ç®—èµ„æºä¸è®¡è´¹ï¼Œåªæ”¶å–å°‘é‡ç£ç›˜è´¹ç”¨ã€‚</p><p><img src="https://s2.loli.net/2025/02/19/rTROD1sxEm2QHZ3.png" alt="image-20250219223719727"></p><h2 id="2-12-é”€æ¯åº”ç”¨"><a href="#2-12-é”€æ¯åº”ç”¨" class="headerlink" title="2.12 é”€æ¯åº”ç”¨"></a>2.12 é”€æ¯åº”ç”¨</h2><p>å¦‚æœç¡®å®šä¸éœ€è¦äº†ï¼Œå¯ä»¥é”€æ¯åº”ç”¨</p><p><img src="https://s2.loli.net/2025/02/19/K1W65NSFZvL2RYk.png" alt="image-20250219225109895"></p><h2 id="2-13-è¯•ç”¨æœŸé—´äº§ç”Ÿçš„è´¹ç”¨"><a href="#2-13-è¯•ç”¨æœŸé—´äº§ç”Ÿçš„è´¹ç”¨" class="headerlink" title="2.13 è¯•ç”¨æœŸé—´äº§ç”Ÿçš„è´¹ç”¨"></a>2.13 è¯•ç”¨æœŸé—´äº§ç”Ÿçš„è´¹ç”¨</h2><p>ç¬”è€…åˆ›å»ºåº”ç”¨åä½¿ç”¨äº†åŠä¸ªå°æ—¶å·¦å³ï¼ŒæœŸé—´ä½¿ç”¨OpenWebUIä¸Chatboxæäº†å››äº”ä¸ªç®€å•é—®é¢˜å‡å¾—åˆ°æ­£å¸¸å›å¤ï¼Œç„¶åå…³æœºã€‚æœ€åè¢«æ”¶å–çš„è´¹ç”¨æ˜¯0.78å…ƒã€‚ç”±äºè‡ªå·±çš„è…¾è®¯äº‘è´¦æˆ·å†…æ²¡æœ‰å……å€¼ï¼Œ19æ—¥æ™šä¸Šå¤§æ¦‚22ç‚¹å·¦å³åˆ›å»ºçš„åº”ç”¨æœåŠ¡ï¼Œ20æ—¥æç¤ºæ¬ è´¹å¹¶è­¦å‘Šæœªæ”¯ä»˜å°†é‡Šæ”¾åº”ç”¨æœåŠ¡ï¼Œ21æ—¥ä¸­åˆç”±äºæœªæ”¯ä»˜æ‰€ä»¥æ­¤åº”ç”¨æœåŠ¡æœ€ç»ˆè¢«é‡Šæ”¾ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è…¾è®¯äº‘åº”ç”¨å¿«é€Ÿéƒ¨ç½²DeepSeekæœåŠ¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æœ¬åœ°å¾®è°ƒDeepSeek-R1-8bæ¨¡å‹</title>
    <link href="/2025/02/13/%E6%9C%AC%E5%9C%B0%E5%BE%AE%E8%B0%83DeepSeek-R1-8b%E6%A8%A1%E5%9E%8B/"/>
    <url>/2025/02/13/%E6%9C%AC%E5%9C%B0%E5%BE%AE%E8%B0%83DeepSeek-R1-8b%E6%A8%A1%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€æ–‡æ¡£è¯´æ˜ä¸æœåŠ¡å™¨å‡†å¤‡"><a href="#ä¸€ã€æ–‡æ¡£è¯´æ˜ä¸æœåŠ¡å™¨å‡†å¤‡" class="headerlink" title="ä¸€ã€æ–‡æ¡£è¯´æ˜ä¸æœåŠ¡å™¨å‡†å¤‡"></a>ä¸€ã€æ–‡æ¡£è¯´æ˜ä¸æœåŠ¡å™¨å‡†å¤‡</h1><h2 id="1-1-æ–‡æ¡£è¯´æ˜"><a href="#1-1-æ–‡æ¡£è¯´æ˜" class="headerlink" title="1.1 æ–‡æ¡£è¯´æ˜"></a>1.1 æ–‡æ¡£è¯´æ˜</h2><p>ç¬”è€…æ­£åœ¨ä»ä¼ ç»Ÿäº‘è®¡ç®—è¡Œä¸šå‘AIé æ‹¢ä¸­ï¼Œç›¸å…³åº•å±‚ç†è®ºçŸ¥è¯†ä¹Ÿæ­£åœ¨å­¦ä¹ ä¸­ï¼Œæ‰€ä»¥æ­¤ç¯‡å¾®è°ƒDeepSeek-R1-Distill-Llama-8Bæ¨¡å‹çš„æ“ä½œæ–‡æ¡£æ˜¯å‚è€ƒå…¶ä»–æ•™å­¦èµ„æ–™ï¼ˆåœ¨æœ¬æ–‡æœ€åå·²ç»æ³¨æ˜ï¼‰æ‰€åšçš„æ“ä½œè®°å½•ï¼Œå…¶ä¸­å·²ç»å°†ç›¸å…³é—®é¢˜å¦‚ä¸‹è½½æ¨¡å‹å¤§æ–‡ä»¶ã€æ“ä½œè¿‡ç¨‹ä¸­ç›¸å…³pythonåº“ç‰ˆæœ¬é—®é¢˜ã€wandbè®¤è¯é—®é¢˜ç­‰è§£å†³ï¼Œå¹¶è®°å½•åœ¨æ­¤æ–‡æ¡£ä¸­ã€‚</p><p>æ‰€ä»¥è¯´è¿™æ˜¯ä¸€ç¯‡ä¿å§†çº§åˆ«çš„â€å¾®è°ƒDeepSeek-R1-Distill-Llama-8Bæ¨¡å‹â€çš„æ“ä½œæ–‡ç« ï¼Œåªè¦ç¨å¾®æ‡‚ç‚¹è®¡ç®—æœºè½¯ä»¶çŸ¥è¯†å°±å¯ä»¥æˆåŠŸå¤ç°æ­¤æ–‡ç« ä¸­æ‰€è¿°å†…å®¹ã€‚</p><p>æ­¤æ–‡æ¡£ä¸­ä½¿ç”¨åˆ°äº†NVIDIA A40ï¼Œå¦‚æœGPUæ˜¾å­˜æˆ–ç®—åŠ›æ›´ä½ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨æ›´å°‘å‚æ•°ç‰ˆæœ¬DeepSeek-R1è’¸é¦æ¨¡å‹æ¯”å¦‚1.5Bï¼Œå®ƒä»…é CPUå°±å¯ä»¥è¿è¡Œã€‚</p><h2 id="1-2-æœåŠ¡å™¨ä¸GPUå‡†å¤‡"><a href="#1-2-æœåŠ¡å™¨ä¸GPUå‡†å¤‡" class="headerlink" title="1.2 æœåŠ¡å™¨ä¸GPUå‡†å¤‡"></a>1.2 æœåŠ¡å™¨ä¸GPUå‡†å¤‡</h2><p>æ­¤æ¬¡ä½¿ç”¨çš„æœåŠ¡å™¨æ˜¯ä¸€ä¸ªx86_64æ„æ¶çš„Hygon C86 5380ç‰©ç†æœåŠ¡å™¨ï¼Œå…·ä½“ä¿¡æ¯å¦‚ä¸‹ï¼š</p><table><thead><tr><th>ä¸»æœºå</th><th>IP</th><th>æ“ä½œç³»ç»Ÿ</th><th>è§„æ ¼</th><th>GPUæƒ…å†µ</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>controller01</td><td>172.20.0.21</td><td>Ubuntu 20.04.3 LTS -amd64</td><td>32c64g+960G</td><td>NVIDIA A40*1</td><td></td></tr></tbody></table><p>ç›¸å…³é‡è¦è½¯ä»¶ç‰ˆæœ¬ï¼ˆåé¢3ä¸ªæ˜¯pythonåº“çš„ç‰ˆæœ¬ï¼Œå»ºè®®ä½¿ç”¨condaåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…æ­¤ç‰ˆæœ¬ã€‚åœ¨å…¶ä»–è½¯ä»¶ç‰ˆæœ¬å›ºå®šçš„æƒ…å†µä¸‹ï¼Œunslothä½¿ç”¨2025.2.5ä¹‹å¤–çš„ç‰ˆæœ¬å°±æŠ¥é”™ï¼‰ï¼š</p><ul><li><p>GPUé©±åŠ¨ç‰ˆæœ¬ï¼š550.54.15</p></li><li><p>Cudaç‰ˆæœ¬ï¼šV12.4.131</p></li><li><p>torchç‰ˆæœ¬ï¼š2.6.0</p></li><li><p>transformersç‰ˆæœ¬ï¼š4.48.3</p></li><li><p>unslothç‰ˆæœ¬ï¼š2025.2.5</p></li></ul><h2 id="1-3-å¤§æ¨¡å‹å¾®è°ƒå®šä¹‰"><a href="#1-3-å¤§æ¨¡å‹å¾®è°ƒå®šä¹‰" class="headerlink" title="1.3 å¤§æ¨¡å‹å¾®è°ƒå®šä¹‰"></a>1.3 å¤§æ¨¡å‹å¾®è°ƒå®šä¹‰</h2><p>åˆ©ç”¨ç‰¹å®šé¢†åŸŸçš„æ•°æ®é›†å¯¹å·²é¢„è®­ç»ƒçš„å¤§æ¨¡å‹è¿›è¡Œè¿›ä¸€æ­¥è®­ç»ƒçš„è¿‡ç¨‹ã€‚å®ƒæ—¨åœ¨ä¼˜åŒ–æ¨¡å‹åœ¨ç‰¹å®šä»»åŠ¡ä¸Šçš„æ€§èƒ½ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿæ›´å¥½åœ°é€‚åº”å’Œå®Œæˆç‰¹å®šé¢†åŸŸçš„ä»»åŠ¡ã€‚å…¶ä¸­æœ€é‡è¦çš„æ˜¯è¶…å‚æ•°ï¼ˆå¦‚å­¦ä¹ ç‡ã€æ‰¹æ¬¡å¤§å°å’Œè®­ç»ƒè½®æ¬¡ï¼‰è°ƒæ•´ä¼˜åŒ–ã€‚è½¬æˆå¤§ç™½è¯å°±æ˜¯è°ƒæ•´å¤§æ¨¡å‹ä¸­ä¸€äº›å‚æ•°çš„å€¼ï¼Œä½¿å…¶åœ¨ç‰¹å®šæ•°æ®é›†ä¸Šè¡¨ç°æ›´ä¼˜ç§€ã€‚</p><h1 id="äºŒã€ç›¸å…³æ–‡ä»¶ä¸‹è½½"><a href="#äºŒã€ç›¸å…³æ–‡ä»¶ä¸‹è½½" class="headerlink" title="äºŒã€ç›¸å…³æ–‡ä»¶ä¸‹è½½"></a>äºŒã€ç›¸å…³æ–‡ä»¶ä¸‹è½½</h1><h2 id="2-1-æ¨¡å‹æ–‡ä»¶ä¸‹è½½"><a href="#2-1-æ¨¡å‹æ–‡ä»¶ä¸‹è½½" class="headerlink" title="2.1 æ¨¡å‹æ–‡ä»¶ä¸‹è½½"></a>2.1 æ¨¡å‹æ–‡ä»¶ä¸‹è½½</h2><p>æœ¬æ¥æ˜¯æƒ³å»huggingfaceä¸Šä¸‹è½½ç›¸å…³æ¨¡å‹æ–‡ä»¶ä¸æ•°æ®é›†ï¼Œç”±äºhuggingfaceéœ€è¦æ¢¯å­æ‰èƒ½è®¿é—®ï¼Œä¸ä¾¿æ“ä½œã€‚æ‰€ä»¥æ­¤æ–‡æ¡£ä¸­æ˜¯åœ¨å›½å†…ç½‘ç»œå¯æ­£å¸¸è®¿é—®é­”æ­å¹³å°ä¸Šä¸‹è½½æ¨¡å‹ä¸æ•°æ®é›†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">è®¿é—®é­”æ­ï¼šhttps://modelscope.cn/models/deepseek-ai/DeepSeek-R1-Distill-Llama-8B/files</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸æŒ‡å®š--local_dir å‚æ•°ï¼Œæ–‡ä»¶å°†è¢«ä¿å­˜åœ¨ç”¨æˆ·æ ¹ç›®å½•ä¸‹çš„.cacheå­ç›®å½•ä¸‹</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ¨¡å‹æ€»å¤§å°åœ¨16Gå·¦å³</span><br>root@t1-gpu:/opt/code_repos/AI_models/unsloth-DeepSeek-R1-Distill-Llama-8B# modelscope download --model unsloth/DeepSeek-R1-Distill-Llama-8B --local_dir ./<br></code></pre></td></tr></table></figure><h2 id="2-2-è®­ç»ƒæ•°æ®é›†æ–‡ä»¶ä¸‹è½½"><a href="#2-2-è®­ç»ƒæ•°æ®é›†æ–‡ä»¶ä¸‹è½½" class="headerlink" title="2.2 è®­ç»ƒæ•°æ®é›†æ–‡ä»¶ä¸‹è½½"></a>2.2 è®­ç»ƒæ•°æ®é›†æ–‡ä»¶ä¸‹è½½</h2><p>è®¿é—®é­”æ­ï¼Œæœç´¢â€œmedical-o1-reasoning-SFTâ€æ•°æ®é›†å¹¶ä¸‹è½½ï¼ˆæ­¤å¤„ä¼šæœ‰ä¸¤ä¸ªåŒåæ•°æ®é›†ï¼Œä½†ä¸Šä¼ è€…ä¸åŒï¼Œæˆ‘é€‰æ‹©äº†ä¸‹è½½é‡æ›´å¤§çš„<a href="https://modelscope.cn/datasets/AI-ModelScope/medical-o1-reasoning-SFT%EF%BC%89%E3%80%82">https://modelscope.cn/datasets/AI-ModelScope/medical-o1-reasoning-SFTï¼‰ã€‚</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@t1-gpu:/opt/code_repos/AI_datasets/AI-ModelScope---medical-o1-reasoning-SFT# modelscope download --dataset AI-ModelScope/medical-o1-reasoning-SFT --local_dir ./<br></code></pre></td></tr></table></figure><h1 id="ä¸‰ã€å…¶ä»–å‡†å¤‡æ­¥éª¤"><a href="#ä¸‰ã€å…¶ä»–å‡†å¤‡æ­¥éª¤" class="headerlink" title="ä¸‰ã€å…¶ä»–å‡†å¤‡æ­¥éª¤"></a>ä¸‰ã€å…¶ä»–å‡†å¤‡æ­¥éª¤</h1><h2 id="3-1-wandb-tokenå‡†å¤‡"><a href="#3-1-wandb-tokenå‡†å¤‡" class="headerlink" title="3.1 wandb tokenå‡†å¤‡"></a>3.1 wandb tokenå‡†å¤‡</h2><p>å»<a href="https://wandb.ai/">wandbå®˜ç½‘</a>æ³¨å†Œä¸€ä¸ªè´¦å·ã€ç”³è¯·ä¸€ä¸ªtokenï¼Œå¹¶è®°å½•æ­¤tokenï¼Œåç»­è¦ç”¨ã€‚</p><p>æ³¨ï¼š</p><ul><li><p>wandbçš„æ„æ€æ˜¯â€weights and biasesâ€œï¼Œç½‘ä¸Šæ²¡æœ‰æ‰¾åˆ°ç°æˆçš„ç¿»è¯‘ï¼Œæˆ‘ç›´è¯‘ä¸ºæƒé‡ä¸åå·®ã€‚</p></li><li><p><a href="https://wandb.ai/wandb_fc/chinese/reports/-Weights-Biases---Vmlldzo4MDEwNzM">å…³äºW&amp;Bçš„ä»‹ç»</a>ï¼šW&amp;B æ˜¯ä¸€ä¸ªå¹³å°ï¼Œå¯å¸®åŠ©æ•°æ®ç§‘å­¦å®¶è·Ÿè¸ªä»–ä»¬çš„æ¨¡å‹ã€æ•°æ®é›†ã€ç³»ç»Ÿä¿¡æ¯ç­‰ã€‚ åªéœ€å‡ è¡Œä»£ç ï¼Œå°±å¯ä»¥å¼€å§‹è·Ÿè¸ªæœ‰å…³è¿™äº›åŠŸèƒ½çš„æ‰€æœ‰å†…å®¹ã€‚ å®ƒæ˜¯å…è´¹ä¾›ä¸ªäººä½¿ç”¨çš„ã€‚ å›¢é˜Ÿä½¿ç”¨é€šå¸¸æ˜¯ä»˜è´¹çš„ï¼Œä½†ç”¨äºå­¦æœ¯ç›®çš„çš„å›¢é˜Ÿæ˜¯å…è´¹çš„ã€‚ å¯ä»¥å°† W&amp;B ä¸è‡ªå·±å–œæ¬¢çš„æ¡†æ¶ä¸€èµ·ä½¿ç”¨ï¼Œä¾‹å¦‚ TensorFlowã€Kerasã€PyTorchã€SKlearnã€fastai ç­‰ã€‚</p><p>æ‰€æœ‰è·Ÿè¸ªä¿¡æ¯éƒ½å‘é€åˆ° W&amp;B UI ä¸Šçš„ä¸“ç”¨é¡¹ç›®é¡µé¢ï¼Œå¯ä»¥åœ¨å…¶ä¸­æ‰“å¼€é«˜è´¨é‡çš„å¯è§†åŒ–ã€æ±‡æ€»ä¿¡æ¯å¹¶æ¯”è¾ƒæ¨¡å‹æˆ–å‚æ•°ã€‚</p></li></ul><h3 id="3-1-1-wandbå®˜ç½‘è´¦å·æ³¨å†Œ"><a href="#3-1-1-wandbå®˜ç½‘è´¦å·æ³¨å†Œ" class="headerlink" title="3.1.1 wandbå®˜ç½‘è´¦å·æ³¨å†Œ"></a>3.1.1 wandbå®˜ç½‘è´¦å·æ³¨å†Œ</h3><p>å¦‚ä¸‹ä½¿ç”¨æˆ‘è‡ªå·±çš„githubè´¦å·è¿›è¡Œæ³¨å†Œã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨æ‰‹åŠ¨é‚®ç®±ä¸å¯†ç è¿›è¡Œæ³¨å†Œï¼ˆå¦‚ä¸‹å›¾æœ€ä¸‹éƒ¨åˆ†æ‰€ç¤ºï¼‰</p><p><img src="https://s2.loli.net/2025/02/13/jBqpIiDF5t48Axc.png" alt="image-20250213162023573"></p><p><img src="https://s2.loli.net/2025/02/13/ZJYaFVol2H1vsej.png" alt="image-20250213162111736"></p><p><img src="https://s2.loli.net/2025/02/21/prnxAkaSZcHGPdE.png" alt="image-20250221230552719"></p><h3 id="3-1-2-è·å–token"><a href="#3-1-2-è·å–token" class="headerlink" title="3.1.2 è·å–token"></a>3.1.2 è·å–token</h3><p>è¿›å…¥wandbå®˜ç½‘ä¸­è‡ªå·±è´¦å·çš„ä¸»é¡µï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹ã€‚åœ¨å¦‚ä¸‹ä½ç½®å¤åˆ¶è‡ªå·±çš„wandb token</p><p><img src="https://s2.loli.net/2025/02/13/4gxCbyk1P95sULh.png" alt="image-20250213162624545"></p><h2 id="3-2-å‡†å¤‡jupyterç¯å¢ƒ"><a href="#3-2-å‡†å¤‡jupyterç¯å¢ƒ" class="headerlink" title="3.2 å‡†å¤‡jupyterç¯å¢ƒ"></a>3.2 å‡†å¤‡jupyterç¯å¢ƒ</h2><p>ä»¥ä¸‹ä»¥åœ¨Ubuntu 20.04.3 LTS -amd64ä¸Šå®‰è£…jupyterç¯å¢ƒä¸ºä¾‹ï¼Œè¯´æ˜å®‰è£…jupyterç¯å¢ƒçš„æ­¥éª¤ã€‚</p><h3 id="3-2-1-å®‰è£…conda"><a href="#3-2-1-å®‰è£…conda" class="headerlink" title="3.2.1 å®‰è£…conda"></a>3.2.1 å®‰è£…conda</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:/opt/installPkgs# mkdir /root/.pip<br>root@controller01:/opt/installPkgs# cat &gt; /root/.pip/pip.conf  &lt;&lt;EOF<br>[global]<br>trusted-host = mirrors.aliyun.com<br>index-url = https://mirrors.aliyun.com/pypi/simple<br>EOF<br><br>root@controller01:/opt/installPkgs# wget --user-agent=â€œMozillaâ€ + https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/Anaconda3-2024.06-1-Linux-x86_64.sh<br><br>root@controller01:/opt/installPkgs# bash Anaconda3-2024.06-1-Linux-x86_64.sh<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##å®‰è£…è¿‡ç¨‹ä¸­ï¼Œä¼šè¯¢é—®ç›¸å…³é—®é¢˜ï¼Œä¿æŒé»˜è®¤é…ç½®ç›´æ¥å›è½¦æˆ–è¾“å…¥YESå†å›è½¦ï¼ˆæ•´ä¸ªå®‰è£…è¿‡ç¨‹å¯èƒ½éœ€è¦è€—æ—¶å‡ åˆ†é’Ÿï¼‰</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##condaçš„é»˜è®¤å®‰è£…ç›®å½•æ˜¯/root/anaconda3</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##å®‰è£…è¿‡ç¨‹ä¸­æœ€å‡ è¡Œå¦‚ä¸‹</span></span><br>....<br>You can undo this by running `conda init --reverse $SHELL`? [yes|no]<br>[no] &gt;&gt;&gt; yes             #æ­¤å¤„è¾“å…¥yeså¹¶å›è½¦<br>no change     /root/anaconda3/condabin/conda<br>no change     /root/anaconda3/bin/conda<br>no change     /root/anaconda3/bin/conda-env<br>no change     /root/anaconda3/bin/activate<br>no change     /root/anaconda3/bin/deactivate<br>no change     /root/anaconda3/etc/profile.d/conda.sh<br>no change     /root/anaconda3/etc/fish/conf.d/conda.fish<br>no change     /root/anaconda3/shell/condabin/Conda.psm1<br>no change     /root/anaconda3/shell/condabin/conda-hook.ps1<br>no change     /root/anaconda3/lib/python3.12/site-packages/xontrib/conda.xsh<br>no change     /root/anaconda3/etc/profile.d/conda.csh<br>modified      /root/.bashrc<br><br>==&gt; For changes to take effect, close and re-open your current shell. &lt;==<br><br>Thank you for installing Anaconda3!<br>root@controller01:/opt/installPkgs# <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é‡æ–°åŠ è½½ç¯å¢ƒå˜é‡ï¼Œå¹¶å¯ç”¨é»˜è®¤çš„base condaç¯å¢ƒ</span><br>root@controller01:/opt/installPkgs# source ~/.bashrc<br>(base) root@controller01:/opt/installPkgs# which python<br>/root/anaconda3/bin/python<br>(base) root@controller01:/opt/installPkgs# which pip<br>/root/anaconda3/bin/pip<br>(base) root@controller01:/opt/installPkgs# python -V<br>Python 3.12.4<br>(base) root@controller01:/opt/installPkgs# pip -V<br>pip 24.0 from /root/anaconda3/lib/python3.12/site-packages/pip (python 3.12)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹ç°æœ‰çš„condaç®¡ç†çš„æ‰€æœ‰è™šæ‹Ÿpythonç¯å¢ƒ</span><br>(base) root@controller01:/opt/installPkgs# conda env list<br><span class="hljs-meta prompt_"># </span><span class="language-bash">conda environments:</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash">base                  *  /root/anaconda3</span><br><br>(base) root@controller01:/opt/installPkgs# <br></code></pre></td></tr></table></figure><h3 id="3-2-2-åˆ›å»ºself-llmè™šæ‹Ÿpythonç¯å¢ƒ"><a href="#3-2-2-åˆ›å»ºself-llmè™šæ‹Ÿpythonç¯å¢ƒ" class="headerlink" title="3.2.2 åˆ›å»ºself-llmè™šæ‹Ÿpythonç¯å¢ƒ"></a>3.2.2 åˆ›å»ºself-llmè™šæ‹Ÿpythonç¯å¢ƒ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ›´æ–°è½¯ä»¶åˆ—è¡¨</span><br>(base) root@controller01:/opt/installPkgs# apt-get update<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å‡†å¤‡å¥½python3ç¯å¢ƒä¸pip3ï¼ˆä½¿ç”¨ä¸Šè¿°condaåˆ›å»ºè™šæ‹Ÿpython3ã€pip3ç¯å¢ƒï¼‰</span><br>(base) root@controller01:/opt/installPkgs# conda create -n self-llm python=3.12<br>...<br>The following NEW packages will be INSTALLED:<br><br>  _libgcc_mutex      pkgs/main/linux-64::_libgcc_mutex-0.1-main <br>  _openmp_mutex      pkgs/main/linux-64::_openmp_mutex-5.1-1_gnu <br>  bzip2              pkgs/main/linux-64::bzip2-1.0.8-h5eee18b_6 <br>  ca-certificates    pkgs/main/linux-64::ca-certificates-2024.12.31-h06a4308_0 <br>  expat              pkgs/main/linux-64::expat-2.6.4-h6a678d5_0 <br>  ld_impl_linux-64   pkgs/main/linux-64::ld_impl_linux-64-2.40-h12ee557_0 <br>  libffi             pkgs/main/linux-64::libffi-3.4.4-h6a678d5_1 <br>  libgcc-ng          pkgs/main/linux-64::libgcc-ng-11.2.0-h1234567_1 <br>  libgomp            pkgs/main/linux-64::libgomp-11.2.0-h1234567_1 <br>  libstdcxx-ng       pkgs/main/linux-64::libstdcxx-ng-11.2.0-h1234567_1 <br>  libuuid            pkgs/main/linux-64::libuuid-1.41.5-h5eee18b_0 <br>  ncurses            pkgs/main/linux-64::ncurses-6.4-h6a678d5_0 <br>  openssl            pkgs/main/linux-64::openssl-3.0.15-h5eee18b_0 <br>  pip                pkgs/main/linux-64::pip-25.0-py312h06a4308_0 <br>  python             pkgs/main/linux-64::python-3.12.9-h5148396_0 <br>  readline           pkgs/main/linux-64::readline-8.2-h5eee18b_0 <br>  setuptools         pkgs/main/linux-64::setuptools-75.8.0-py312h06a4308_0 <br>  sqlite             pkgs/main/linux-64::sqlite-3.45.3-h5eee18b_0 <br>  tk                 pkgs/main/linux-64::tk-8.6.14-h39e8969_0 <br>  tzdata             pkgs/main/noarch::tzdata-2025a-h04d1e81_0 <br>  wheel              pkgs/main/linux-64::wheel-0.45.1-py312h06a4308_0 <br>  xz                 pkgs/main/linux-64::xz-5.6.4-h5eee18b_1 <br>  zlib               pkgs/main/linux-64::zlib-1.2.13-h5eee18b_1 <br><br><br>Proceed ([y]/n)? Y         #æ­¤å¤„è¾“å…¥yå¹¶å›è½¦<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##ç„¶åç­‰å¾…ä¸‹è½½ä¸è§£å‹æå–ç›¸å…³pythonå®‰è£…æ–‡ä»¶ä¸pythonæ¨¡å—ã€‚å®‰è£…è¿‡ç¨‹çš„æœ€åå‡ è¡Œè¾“å‡ºå¦‚ä¸‹</span></span><br>...<br><span class="hljs-meta prompt_"># </span><span class="language-bash">To activate this environment, use</span>                                                                         <br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#     $ conda activate self-llm</span></span>                                                                             <br><span class="hljs-meta prompt_"># </span><span class="language-bash">To deactivate an active environment, use</span>                                                                   <br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#     $ conda deactivate</span></span><br>(base) root@controller01:/opt/installPkgs# <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹ç°æœ‰çš„condaç®¡ç†çš„æ‰€æœ‰è™šæ‹Ÿpythonç¯å¢ƒ</span><br>(base) root@controller01:/opt/installPkgs# conda env list<br><span class="hljs-meta prompt_"># </span><span class="language-bash">conda environments:</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash">base                     /root/anaconda3</span><br>self-llm              *  /root/anaconda3/envs/self-llm<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ¿€æ´»self-llm è¿™ä¸ªè™šæ‹Ÿpythonç¯å¢ƒï¼Œå¹¶åœ¨å…¶ä¸­æ‰§è¡Œç›¸å…³å‘½ä»¤</span><br>(base) root@controller01:/opt/installPkgs# conda activate self-llm <br>(self-llm) root@controller01:/opt/installPkgs# python -V<br>Python 3.12.9<br>(self-llm) root@controller01:/opt/installPkgs# pip -V<br>pip 25.0 from /root/anaconda3/envs/self-llm/lib/python3.12/site-packages/pip (python 3.12)<br>(self-llm) root@controller01:/opt/installPkgs# <br></code></pre></td></tr></table></figure><h3 id="3-2-3-å®‰è£…jupyterç¯å¢ƒ"><a href="#3-2-3-å®‰è£…jupyterç¯å¢ƒ" class="headerlink" title="3.2.3 å®‰è£…jupyterç¯å¢ƒ"></a>3.2.3 å®‰è£…jupyterç¯å¢ƒ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£… IPython äº¤äº’å¼ shell</span><br>(self-llm) root@controller01:/opt/installPkgs# pip install ipython<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ­£å¼å®‰è£…jupyter</span><br>(self-llm) root@controller01:/opt/installPkgs# apt install jupyter-core jupyter-notebook -qy<br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»ºç›®å½•</span><br>(self-llm) root@controller01:/opt/installPkgs# mkdir finetunning-bigmodles<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯åŠ¨jupyter notebook</span><br>(self-llm) root@controller01:/opt/installPkgs# jupyter notebook --allow-root --ip=0.0.0.0 --no-browser<br>[I 01:29:38.744 NotebookApp] Serving notebooks from local directory: /opt/installPkgs<br>[I 01:29:38.744 NotebookApp] The Jupyter Notebook is running at:<br>[I 01:29:38.744 NotebookApp] http://a10:8888/?token=96f565e66d149b1803474ff3bf7c15e43fbaf9cc59c192ba<br>[I 01:29:38.744 NotebookApp]  or http://127.0.0.1:8888/?token=96f565e66d149b1803474ff3bf7c15e43fbaf9cc59c192ba<br>[I 01:29:38.744 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).<br>[W 01:29:38.755 NotebookApp] No web browser found: could not locate runnable browser.<br>[C 01:29:38.756 NotebookApp] <br>    <br>    To access the notebook, open this file in a browser:<br>        file:///root/.local/share/jupyter/runtime/nbserver-41207-open.html<br>    Or copy and paste one of these URLs:<br>        http://a10:8888/?token=96f565e66d149b1803474ff3bf7c15e43fbaf9cc59c192ba<br>     or http://127.0.0.1:8888/?token=96f565e66d149b1803474ff3bf7c15e43fbaf9cc59c192ba<br>[I 01:29:53.755 NotebookApp] 302 GET /?token=96f565e66d149b1803474ff3bf7c15e43fbaf9cc59c192ba (192.168.254.84) 2.07ms<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†ä»¥ä¸‹urlä¸­çš„127.0.0.1æ¢æˆæœåŠ¡å™¨IPï¼Œå³å¯è®¿é—®ä¸Šè¿°åˆ›å»ºçš„jupyterç¯å¢ƒï¼Œæ¯”å¦‚å½“å‰å®‰è£…jupyterç¯å¢ƒçš„æœåŠ¡å™¨IPæ˜¯172.20.0.21ï¼Œåˆ™URLæ˜¯å¦‚ä¸‹</span><br>http://172.20.0.21:8888/?token=96f565e66d149b1803474ff3bf7c15e43fbaf9cc59c192ba<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æœ€åçš„å‚æ•°tokenç±»ä¼¼äºè®¿é—®çš„å¯†ç ã€‚è®¿é—®æˆåŠŸåç•Œé¢å¦‚ä¸‹ï¼Œjupyterç¯å¢ƒæ ¹ç›®å½•å°±æ˜¯æ‰§è¡Œâ€œjupyter notebook --allow-root --ip=0.0.0.0â€å‘½ä»¤çš„æ‰€åœ¨ç›®å½•/opt/installPkgsï¼Œä»¥ä¸‹æ˜¾ç¤ºäº†æ‰€åœ¨ç›®å½•/opt/installPkgsä¸‹çš„æ‰€æœ‰æ–‡ä»¶åŠæ–‡ä»¶å¤¹</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/17/pacKOlYbVuzrJqQ.png" alt="image-20250217093519584"></p><p>å¦‚æœè¦è‡ªå®šä¹‰jupyterçš„å®¶ç›®å½•åŠå…¶ä»–é…ç½®ï¼Œå¯ä»¥ä¿®æ”¹å®ƒçš„é…ç½®æ–‡ä»¶ï¼ˆé»˜è®¤å·²ç»åˆ›å»ºï¼š&#x2F;root&#x2F;.jupyter&#x2F;jupyter_notebook_config.pyï¼‰ï¼Œä»¥åæ¯æ¬¡å¯åŠ¨æ—¶ï¼Œå®ƒéƒ½æ˜¯ä¼˜å…ˆä½¿ç”¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­çš„é…ç½®é¡¹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">(self-llm) root@controller01:/opt/installPkgs/finetunning-bigmodles# vi /root/.jupyter/jupyter_notebook_config.py<br>...<br>931 # c.ServerApp.notebook_dir = &#x27;&#x27;<br>932 c.ServerApp.notebook_dir = &#x27;/opt/installPkgs/finetunning-bigmodles/&#x27;<br>...<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸Šè¿°æ–‡ä»¶åï¼Œéœ€è¦é‡æ–°å¯åŠ¨jupyterè¿›ç¨‹ï¼Œæ‰ä¼šç”Ÿæ•ˆã€‚</p><h3 id="3-2-4-æŠ¥é”™å¤„ç†"><a href="#3-2-4-æŠ¥é”™å¤„ç†" class="headerlink" title="3.2.4 æŠ¥é”™å¤„ç†"></a>3.2.4 æŠ¥é”™å¤„ç†</h3><h4 id="å¯åŠ¨jupyter-notebookæ—¶æŠ¥â€œFail-to-get-yarn-configurationâ€"><a href="#å¯åŠ¨jupyter-notebookæ—¶æŠ¥â€œFail-to-get-yarn-configurationâ€" class="headerlink" title="å¯åŠ¨jupyter notebookæ—¶æŠ¥â€œFail to get yarn configurationâ€"></a>å¯åŠ¨jupyter notebookæ—¶æŠ¥â€œFail to get yarn configurationâ€</h4><p>ä½†æ­¤é”™è¯¯å¹¶æœªä¸å½±å“jupyter notebookçš„ä½¿ç”¨</p><p><img src="https://s2.loli.net/2025/02/14/qQlTesIb7oC1YNW.png" alt="image-20250214175252854"></p><p>è§£å†³åŠæ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ–¹æ³•1ï¼šæ­¤æŠ¥é”™ä¸å½±å“jupyter notebookçš„ä½¿ç”¨ï¼Œæš‚æ—¶ä¸äºˆç†ä¼š</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ–¹æ³•2ï¼šéœ€è¦å‡çº§Nodeç‰ˆæœ¬ï¼ˆå…ˆå‰æ˜¯v10.19.6ï¼Œå‡çº§åˆ°v12.22.6å³å¯ï¼‰ã€‚å‚è€ƒï¼šhttps://discourse.jupyter.org/t/jupyter-lab-4-0-6-error-on-startup-about-yarn-configuration-and-worker-threads/21859</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨nvmå‡çº§nodejsç‰ˆæœ¬ï¼š</span><br>nvm install 12.22.6<br></code></pre></td></tr></table></figure><h1 id="å››ã€åœ¨-ipynbä¸­è¿›è¡Œå¾®è°ƒ"><a href="#å››ã€åœ¨-ipynbä¸­è¿›è¡Œå¾®è°ƒ" class="headerlink" title="å››ã€åœ¨.ipynbä¸­è¿›è¡Œå¾®è°ƒ"></a>å››ã€åœ¨.ipynbä¸­è¿›è¡Œå¾®è°ƒ</h1><h2 id="4-1-æ‰“å¼€ä¸€ä¸ªå·²ç»å­˜åœ¨çš„-ipynbæ–‡ä»¶"><a href="#4-1-æ‰“å¼€ä¸€ä¸ªå·²ç»å­˜åœ¨çš„-ipynbæ–‡ä»¶" class="headerlink" title="4.1 æ‰“å¼€ä¸€ä¸ªå·²ç»å­˜åœ¨çš„.ipynbæ–‡ä»¶"></a>4.1 æ‰“å¼€ä¸€ä¸ªå·²ç»å­˜åœ¨çš„.ipynbæ–‡ä»¶</h2><p>æ¯”å¦‚ä¸‹è½½<a href="https://github.com/jiangsanyin/unsloth-DeepSeek-R1-Distill-Llama-8B/blob/main/deepseekr1_8b%E6%9C%AC%E5%9C%B0%E5%BE%AE%E8%B0%83.ipynb">deepseekr1_8bæœ¬åœ°å¾®è°ƒ.ipynb</a> ï¼Œä¿å­˜åˆ°<code>/opt/installPkgs/finetunning-bigmodles</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:/opt/installPkgs/finetunning-bigmodles# ll<br>total 104<br>drwxr-xr-x  2 root root  4096 Feb 17 10:02 ./<br>drwxr-xr-x 12 root root  4096 Feb 17 09:48 ../<br>-rw-r--r--  1 root root 95152 Feb 17 09:46 deepseekr1_8bæœ¬åœ°å¾®è°ƒ.ipynb<br><br></code></pre></td></tr></table></figure><p>ç„¶åæŒ‰ç…§å¦‚ä¸‹æ–¹å¼ï¼Œåœ¨jupyterå›¾å½¢ç•Œé¢æ‰¾åˆ°ä¸Šè¿°æ–‡ä»¶å¹¶ä½¿ç”¨â€Notebookâ€æ‰“å¼€ï¼š</p><p><img src="https://s2.loli.net/2025/02/17/ACp5NZeaJiPuqFQ.png" alt="image-20250217100452758"></p><p>æ‰“å¼€åç•Œé¢å¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2025/02/17/KDAFQO4sftwLU7H.png" alt="image-20250217100932951"></p><h3 id="4-1-1-è®¾ç½®æ­¤-ipynbæ–‡ä»¶å¯ä¿¡"><a href="#4-1-1-è®¾ç½®æ­¤-ipynbæ–‡ä»¶å¯ä¿¡" class="headerlink" title="4.1.1 è®¾ç½®æ­¤.ipynbæ–‡ä»¶å¯ä¿¡"></a>4.1.1 è®¾ç½®æ­¤.ipynbæ–‡ä»¶å¯ä¿¡</h3><p><img src="https://s2.loli.net/2025/02/17/JKr4Pjd3HSI2RXy.png" alt="image-20250217101948104"></p><h3 id="4-1-2-ä¸º-ipynbæ–‡ä»¶é€‰æ‹©kernel"><a href="#4-1-2-ä¸º-ipynbæ–‡ä»¶é€‰æ‹©kernel" class="headerlink" title="4.1.2 ä¸º.ipynbæ–‡ä»¶é€‰æ‹©kernel"></a>4.1.2 ä¸º.ipynbæ–‡ä»¶é€‰æ‹©kernel</h3><p><img src="https://s2.loli.net/2025/02/17/nA4xkQ1DazvZSUW.png" alt="image-20250217110822311"></p><h3 id="4-1-3-è¿è¡Œæ­¤-ipynbæ–‡ä»¶"><a href="#4-1-3-è¿è¡Œæ­¤-ipynbæ–‡ä»¶" class="headerlink" title="4.1.3 è¿è¡Œæ­¤.ipynbæ–‡ä»¶"></a>4.1.3 è¿è¡Œæ­¤.ipynbæ–‡ä»¶</h3><p>ä¸Šè¿°æ–‡ä»¶<code>deepseekr1_8bæœ¬åœ°å¾®è°ƒ.ipynb</code>ä»ç½‘ä¸Šä¸‹è½½ä¸‹æ¥åï¼Œæœ‰äº›åœ°æ–¹éœ€è¦ä¿®æ”¹ä¸‹ï¼Œå¦åˆ™åœ¨æœªç¿»å¢™çš„æœåŠ¡å™¨ä¸Šè¿è¡Œä¼šå¤±è´¥æˆ–æ‰§è¡Œé€Ÿåº¦å¾ˆæ…¢ã€‚</p><p>ä»¥ä¸‹æœªåˆ—ä¸¾å‡ºæ¥çš„cellï¼Œä¸éœ€è¦ä¿®æ”¹ï¼Œç›´æ¥æ‰§è¡Œå³å¯ã€‚</p><h4 id="ç¬¬1ä¸ªcell-å®‰è£…unsloth"><a href="#ç¬¬1ä¸ªcell-å®‰è£…unsloth" class="headerlink" title="ç¬¬1ä¸ªcell-å®‰è£…unsloth"></a><strong>ç¬¬1ä¸ªcell</strong>-å®‰è£…unsloth</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">%</span><span class="language-bash">%capture</span><br>!pip install unsloth==2025.2.5 -i https://mirrors.aliyun.com/pypi/simple<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Also get the latest nightly Unsloth!</span><br>!pip install --force-reinstall --no-cache-dir --no-deps git+https://gitee.com/sy-jiang/unsloth.git -i https://mirrors.aliyun.com/pypi/simple<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸Šè¿°å‘½ä»¤ä¸­åˆä¼šå®‰è£…æœ€æ–°çš„unsloth 2025.2.12ï¼ˆåç»­ä½¿ç”¨ä¸­ä¼šæœ‰é—®é¢˜ï¼‰ï¼Œæ‰€ä»¥é‡æ–°å®‰è£…nsloth 2025.2.12</span><br>!pip install unsloth==2025.2.5 -i https://mirrors.aliyun.com/pypi/simple<br></code></pre></td></tr></table></figure><p>ç„¶åå…‰æ ‡é€‰ä¸­æ­¤cellï¼Œä½¿ç”¨ç»„åˆé”®â€œshift+enerâ€æˆ–ç‚¹å‡»å¦‚ä¸‹æŒ‰é’®ï¼Œå³å¯æ‰§è¡Œé€‰ä¸­çš„cell</p><p><img src="https://s2.loli.net/2025/02/17/HvOjDMkZ4KG7FAS.png" alt="image-20250217110958036"></p><p>ç¬¬ä¸€ä¸ªcellæ‰§è¡Œæ‰€éœ€è¦çš„æ—¶é—´è¾ƒé•¿ï¼Œå› ä¸ºå®‰è£…çš„pythonåº“è¾ƒå¤§ã€‚cellæ‰§è¡Œæœªç»“æœæ—¶ï¼Œå‰é¢ä¼šä¸€ç›´æœ‰ä¸ªâ€*â€</p><p><img src="https://s2.loli.net/2025/02/17/9XLU8GbwDToWsmr.png" alt="image-20250217111048204"></p><p>å½“å‰cellæ‰§è¡Œç»“æŸåï¼Œä¼šåœ¨å½“é¢æ‰€æœ‰æ‰§è¡Œcellæ¬¡æ•°çš„åŸºç¡€åŠ 1ï¼Œç»“æœæ˜¾ç¤ºåœ¨cellå·¦ä¸Šè§’ã€‚å¦‚ä¸‹å›¾ï¼Œè¿™æ˜¯è¿™ä¸ªé¡µé¢æ­¤cellç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œæ‰€ä»¥æ‰§è¡Œç»“æŸåï¼Œæ˜¾ç¤º1</p><p><img src="https://s2.loli.net/2025/02/17/1pZPTJlGaed78XB.png" alt="image-20250217111458869"></p><h4 id="ç¬¬3ä¸ªcell-å®‰è£…wandb"><a href="#ç¬¬3ä¸ªcell-å®‰è£…wandb" class="headerlink" title="ç¬¬3ä¸ªcell-å®‰è£…wandb"></a><strong>ç¬¬3ä¸ªcell</strong>-å®‰è£…wandb</h4><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-meta">#!pip install wandb</span><br>#ä¿®æ”¹æˆå¦‚ä¸‹ä»¥ä½¿ç”¨å›½å†…pipå®‰è£…æº<br>!pip install wandb -i https:<span class="hljs-comment">//mirrors.aliyun.com/pypi/simple</span><br></code></pre></td></tr></table></figure><h4 id="ç¬¬4ä¸ªcell-åˆå§‹åŒ–wandb"><a href="#ç¬¬4ä¸ªcell-åˆå§‹åŒ–wandb" class="headerlink" title="ç¬¬4ä¸ªcell-åˆå§‹åŒ–wandb"></a>ç¬¬4ä¸ªcell-åˆå§‹åŒ–wandb</h4><p>å¦‚ä¸‹é…ç½®çš„keyå°±æ˜¯åœ¨wandbå®˜ç½‘ç”³è¯·åè·å–çš„tokenï¼Œè¯·ä¿®æ”¹æˆè‡ªå·±çš„tokenwanb token</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># è¿™é‡Œä¸ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œç›´æ¥å¡«å…¥wandbçš„token,å¦‚æœæ²¡æœ‰tokenå¯ä»¥å»å®˜ç½‘ä¸‹è½½ä¸€ä¸ª</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># ä¸ºäº†å®‰å…¨ï¼Œæˆ‘æ­¤å¤„åªç²˜è´´äº†è‡ªå·±tokençš„å‰éƒ¨åˆ†å†…å®¹</span></span><br>import wandb<br><br>wandb.login(key=&quot;b11f575fd0f6c8cae0cb016b24&quot;)<br>run = wandb.init(<br>    project=&#x27;my fint-tune on deepseek r1 with medical data&#x27;,<br>    job_type=&quot;training&quot;,<br>    anonymous=&quot;allow&quot;<br>)<br></code></pre></td></tr></table></figure><p>å¦‚æœä¸Šè¿°cellå†…å®¹è¿è¡Œä¸æˆåŠŸï¼Œåˆ™é‡‡ç”¨å¦‚ä¸‹æ–¹æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">1)é¦–å…ˆåœ¨self-llmè¿™ä¸ªè™šæ‹Ÿæœºpythonç¯å¢ƒç™»å½•åˆ°wandb.aiï¼ŒæˆåŠŸåä¼šå°†ç›¸å…³ä¿¡æ¯ä¿å­˜åœ¨/root/.netrc</span><br>(self-llm) root@controller01:/opt/installPkgs/finetunning-bigmodles# wandb login --relogin<br>wandb: Logging into wandb.ai. (Learn how to deploy a W&amp;B server locally: https://wandb.me/wandb-server)<br>wandb: You can find your API key in your browser here: https://wandb.ai/authorize<br>wandb: Paste an API key from your profile and hit enter, or press ctrl+c to quit: <br>wandb: Appending key for api.wandb.ai to your netrc file: /root/.netrc<br>wandb: W&amp;B API key is configured. Use `wandb login --relogin` to force relogin<br>(self-llm) root@controller01:/opt/installPkgs/finetunning-bigmodles# <br>(self-llm) root@controller01:/opt/installPkgs/finetunning-bigmodles# vi /root/.netrc <br>(self-llm) root@controller01:/opt/installPkgs/finetunning-bigmodles# <br>(self-llm) root@controller01:/opt/installPkgs/finetunning-bigmodles# cat /root/.netrc   <br>machine api.wandb.ai<br>  login user<br>  password b11f575fd0f6c8cae0cb016b24<br><span class="hljs-meta prompt_">  </span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">2)ä¿®æ”¹ä¸Šè¿°cellå†…å®¹ä¸ºå¦‚ä¸‹ï¼Œç„¶åé‡æ–°æ‰§è¡Œæ­¤cell</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># è¿™é‡Œä¸ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œç›´æ¥å¡«å…¥wandbçš„token,å¦‚æœæ²¡æœ‰tokenå¯ä»¥å»å®˜ç½‘ä¸‹è½½ä¸€ä¸ª</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># åŒæ—¶wandb.initæ—¶é»˜è®¤è¶…æ—¶æ—¶é—´æ˜¯90sï¼Œå› ä¸ºç½‘ç«™æ˜¯å›½å¤–ç½‘ç«™å¯èƒ½ç»å¸¸å‡ºç°initè¶…è¿‡90sçš„ç°è±¡ï¼Œæ‰€ä»¥å¢åŠ è¶…æ—¶æ—¶é—´ä¸º300s</span></span><br>import wandb<br>import os<br><span class="hljs-meta prompt_">#</span><span class="language-bash">os.environ[<span class="hljs-string">&quot;WANDB_API_KEY&quot;</span>] = <span class="hljs-string">&#x27;b11f575fd0f6c8cae0cb016b24&#x27;</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#os.environ[&quot;WANDB_MODE&quot;] = &quot;offline&quot;</span></span><br>os.environ[&#x27;WANDB_INIT_TIMEOUT&#x27;] = &#x27;1200&#x27;  #Increase timeout settings<br>os.environ[&#x27;WANDB_DEBUG&#x27;] = &quot;true&quot;           #Enable debugging<br><span class="hljs-meta prompt_">#</span><span class="language-bash">wandb.login(key=<span class="hljs-string">&quot;b11f575fd0f6c8cae0cb016b24&quot;</span>)</span><br>run = wandb.init(<br>    project=&#x27;my fint-tune on deepseek r1 with medical data&#x27;,<br>    job_type=&quot;training&quot;,<br>    anonymous=&quot;allow&quot;,<br>    settings=wandb.Settings(init_timeout=1200)<br>)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">3)æ‰§è¡ŒæˆåŠŸæ—¶ï¼Œè¾“å‡ºå¦‚ä¸‹</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/18/gac186mtlIDJnZu.png" alt="image-20250218100844293"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">4)ä¹‹åæŒ‰ç…§ä¸Šè¿°è¾“å‡ºçš„å†…å®¹ï¼ŒæŸ¥çœ‹wandb.aiç½‘ç«™ä¸­è‡ªå·±çš„ä¸»é¡µï¼Œçœ‹åˆ°å¦‚ä¸‹ç±»ä¼¼å†…å®¹ã€‚ä¹‹åå¾€åæ‰§è¡Œä¸‹ä¸€ä¸ªcell</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/18/TCQhspmOINxR2ri.png" alt="image-20250218101102349"></p><h4 id="ç¬¬5ä¸ªcell-åŠ è½½æ¨¡å‹æ–‡ä»¶-åˆ›å»ºmodelå®ä¾‹"><a href="#ç¬¬5ä¸ªcell-åŠ è½½æ¨¡å‹æ–‡ä»¶-åˆ›å»ºmodelå®ä¾‹" class="headerlink" title="ç¬¬5ä¸ªcell-åŠ è½½æ¨¡å‹æ–‡ä»¶&#x2F;åˆ›å»ºmodelå®ä¾‹"></a>ç¬¬5ä¸ªcell-åŠ è½½æ¨¡å‹æ–‡ä»¶&#x2F;åˆ›å»ºmodelå®ä¾‹</h4><p>æ­¤celléœ€è¦ä¿è¯ä½ çš„æœåŠ¡å™¨ä¸Šæœ‰NVIDIA GPUã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯NVIDIA A40ï¼Œå®ƒæœ‰44Gå·¦å³æ˜¾å­˜</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">model, tokenizer = FastLanguageModel.from_pretrained(<br>    model_name = &quot;/opt/code_repos/AI_models/unsloth-DeepSeek-R1-Distill-Llama-8B&quot;, # è¿™é‡Œæ”¹æˆä½ æœ¬åœ°æ¨¡å‹ï¼Œä»¥æˆ‘çš„ä¸ºä¾‹ï¼Œæˆ‘å·²ç»huggingfaceä¸Šçš„æ¨¡å‹æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ã€‚<br>    max_seq_length = max_seq_length,<br>    dtype = dtype,<br>    load_in_4bit = load_in_4bit,<br>)<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/17/z2x8lfMR4iL75X6.png" alt="image-20250217152019243"></p><h4 id="ç¬¬6ä¸ç¬¬7ä¸ªcell-å¾®è°ƒå‰æ‰§è¡Œæ¨ç†"><a href="#ç¬¬6ä¸ç¬¬7ä¸ªcell-å¾®è°ƒå‰æ‰§è¡Œæ¨ç†" class="headerlink" title="ç¬¬6ä¸ç¬¬7ä¸ªcell-å¾®è°ƒå‰æ‰§è¡Œæ¨ç†"></a>ç¬¬6ä¸ç¬¬7ä¸ªcell-å¾®è°ƒå‰æ‰§è¡Œæ¨ç†</h4><p>ç¬¬6ä¸ªcellæä¾›ä¸­è‹±æ–‡ä¸¤ç§å½¢å¼çš„é—®é¢˜ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">question = <span class="hljs-string">&quot;A 61-year-old woman with a long history of involuntary urine loss during activities like coughing or sneezing but no leakage at night undergoes a gynecological exam and Q-tip test. Based on these findings, what would cystometry most likely reveal about her residual volume and detrusor contractions?&quot;</span></span><br>question = &quot;ä¸€å61å²å¥³æ€§ï¼Œé•¿æœŸåœ¨å’³å—½æˆ–æ‰“å–·åšç­‰æ´»åŠ¨æ—¶ä¸è‡ªè§‰æ’å°¿ï¼Œä½†å¤œé—´æ— æ¼å°¿ï¼Œç°æ¥å—å¦‡ç§‘æ£€æŸ¥å’ŒQ-tipæ£€æŸ¥ã€‚åŸºäºè¿™äº›å‘ç°ï¼Œè†€èƒ±é€ ç˜˜æœ¯æœ€æœ‰å¯èƒ½æ­ç¤ºå¥¹çš„æ®‹ä½™å®¹é‡å’Œé€¼å°¿è‚Œæ”¶ç¼©æƒ…å†µï¼Ÿ&quot;<br><br><br>FastLanguageModel.for_inference(model)  # Unsloth has 2x faster inference!<br>inputs = tokenizer([prompt_style.format(question, &quot;&quot;)], return_tensors=&quot;pt&quot;).to(&quot;cuda&quot;)<br><br>outputs = model.generate(<br>    input_ids=inputs.input_ids,<br>    attention_mask=inputs.attention_mask,<br>    max_new_tokens=1200,<br>    use_cache=True,<br>)<br>response = tokenizer.batch_decode(outputs)<br>print(response[0].split(&quot;### Response:&quot;)[1])<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œæ—¶ï¼Œè¾“å‡ºå†…å®¹å¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2025/02/17/oyNrqQCiWLxwVBA.png" alt="image-20250217170314515"></p><h4 id="ç¬¬8ä¸ªcell-åˆ›å»ºæ¡†æ¶modelå®ä¾‹"><a href="#ç¬¬8ä¸ªcell-åˆ›å»ºæ¡†æ¶modelå®ä¾‹" class="headerlink" title="ç¬¬8ä¸ªcell-åˆ›å»ºæ¡†æ¶modelå®ä¾‹"></a>ç¬¬8ä¸ªcell-åˆ›å»ºæ¡†æ¶modelå®ä¾‹</h4><p>è¿™ä¸ªcellçš„å†…å®¹æ— éœ€ä¿®æ”¹ã€‚å®ƒä½¿ç”¨çš„loraæ¡†æ¶ä¸­ä½ç§©çŸ©é˜µçš„æ–¹æ³•å¯¹æ¨¡å‹è¿›è¡Œå¿«é€Ÿæœ‰æ•ˆå¾®è°ƒã€‚ï¼ˆéœ€è¦å¯¹loraæ¡†æ¶çŸ¥è¯†è¿›è¡Œå­¦ä¹ ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell">model = FastLanguageModel.get_peft_model(<br>    model,<br>    r=16,<br>    target_modules=[<br>        &quot;q_proj&quot;,<br>        &quot;k_proj&quot;,<br>        &quot;v_proj&quot;,<br>        &quot;o_proj&quot;,<br>        &quot;gate_proj&quot;,<br>        &quot;up_proj&quot;,<br>        &quot;down_proj&quot;,<br>    ],<br>    lora_alpha=16,<br>    lora_dropout=0,<br>    bias=&quot;none&quot;,<br>    use_gradient_checkpointing=&quot;unsloth&quot;,  # True or &quot;unsloth&quot; for very long context<br>    random_state=3407,<br>    use_rslora=False,<br>    loftq_config=None,<br>)<br></code></pre></td></tr></table></figure><h4 id="ç¬¬9ä¸ç¬¬10ä¸ªcell-æ•°æ®é›†è§„æ•´åŒ–å‡†å¤‡"><a href="#ç¬¬9ä¸ç¬¬10ä¸ªcell-æ•°æ®é›†è§„æ•´åŒ–å‡†å¤‡" class="headerlink" title="ç¬¬9ä¸ç¬¬10ä¸ªcell-æ•°æ®é›†è§„æ•´åŒ–å‡†å¤‡"></a>ç¬¬9ä¸ç¬¬10ä¸ªcell-æ•°æ®é›†è§„æ•´åŒ–å‡†å¤‡</h4><p>é¢„å¤„ç†æ•°æ®é›†ï¼Œå¯¹æ•°æ®é›†è¿›è¡Œè§„æ•´ã€‚è§„æ•´æˆç¬¬9ä¸ªcellä¸­æ ·å¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">train_prompt_style = &quot;&quot;&quot;Below is an instruction that describes a task, paired with an input that provides further context.<br>Write a response that appropriately completes the request.<br>Before answering, think carefully about the question and create a step-by-step chain of thoughts to ensure a logical and accurate response.<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">## Instruction:</span></span><br>You are a medical expert with advanced knowledge in clinical reasoning, diagnostics, and treatment planning.<br>Please answer the following medical question.<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">## Question:</span></span><br>&#123;&#125;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">## Response:</span></span><br>&lt;think&gt;<br>&#123;&#125;<br>&lt;/think&gt;<br>&#123;&#125;&quot;&quot;&quot;<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨å¦‚ä¸‹ç¬¬10ä¸ªcellä¸­å¦‚ä¸‹å‡½æ•°å¯¹æ•°æ®é›†è¿›è¡Œè§„æ•´ï¼Œå°†é—®é¢˜ã€æ€ç»´é“¾ä¸å›ç­”å¡«å……åˆ°ä¸Šè¿°promptä¸­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">EOS_TOKEN = tokenizer.eos_token  # Must add EOS_TOKEN<br><br><br>def formatting_prompts_func(examples):<br>    inputs = examples[&quot;Question&quot;]<br>    cots = examples[&quot;Complex_CoT&quot;]<br>    outputs = examples[&quot;Response&quot;]<br>    texts = []<br>    for input, cot, output in zip(inputs, cots, outputs):<br>        text = train_prompt_style.format(input, cot, output) + EOS_TOKEN<br>        texts.append(text)<br>    return &#123;<br>        &quot;text&quot;: texts,<br>    &#125;<br><br></code></pre></td></tr></table></figure><h4 id="ç¬¬11ä¸ªcell-åŠ è½½dataset"><a href="#ç¬¬11ä¸ªcell-åŠ è½½dataset" class="headerlink" title="ç¬¬11ä¸ªcell-åŠ è½½dataset"></a>ç¬¬11ä¸ªcell-åŠ è½½dataset</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">from datasets import load_dataset<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">load_datasetæ–¹æ³•è°ƒç”¨çš„ç¬¬1ä¸ªå‚æ•°ï¼ˆæ•°æ®é›†ç›®å½•ï¼‰ã€ç¬¬2ä¸ªå‚æ•°ï¼ˆä½¿ç”¨æ•°æ®é›†ä¸­å“ªç§è¯­è¨€.cnè¡¨ç¤ºè‹±æ–‡ï¼Œzhè¡¨ç¤ºä¸­æ–‡ï¼‰ã€‚å…¶ä½™ä¸å˜ï¼ˆç¬¬3ä¸ªå‚æ•°è¡¨ç¤ºä½¿ç”¨å‰500æ¡æ•°æ®ï¼‰</span><br>dataset = load_dataset(&quot;/opt/code_repos/AI_datasets/AI-ModelScope---medical-o1-reasoning-SFT&quot;, &quot;zh&quot;,split = &quot;train[0:500]&quot;) # è¿™é‡ŒåŒæ ·å»huggingfaceä¸Šé¢ä¸‹è½½æ•°æ®é›†ï¼Œç„¶åæ”¾åˆ°æœ¬åœ°<br>dataset = dataset.map(formatting_prompts_func, batched = True,)<br>dataset[&quot;text&quot;][0]<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œä¸Šè¿°cellå‰ï¼Œè¿˜éœ€è¦åšå¦‚ä¸‹æ“ä½œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å¤‡ä»½unsloth-DeepSeek-R1-Distill-Llama-8Bçš„README.mdæ–‡ä»¶</span><br>root@controller01:/opt/code_repos/AI_models/unsloth-DeepSeek-R1-Distill-Llama-8B# mv README.md unsloth-DeepSeek-R1-Distill-Llama-8B---README.md <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†æ•°æ®é›†AI-ModelScope---medical-o1-reasoning-SFTä¸‹é¢*.jsonä¸README.mdæ–‡ä»¶å¤åˆ¶åˆ°ä¸Šè¿°ç›®å½•ä¸‹</span><br>root@controller01:/opt/code_repos/AI_models/unsloth-DeepSeek-R1-Distill-Llama-8B# cp -p /opt/code_repos/AI_datasets/AI-ModelScope---medical-o1-reasoning-SFT/*.json ./<br>root@controller01:/opt/code_repos/AI_models/unsloth-DeepSeek-R1-Distill-Llama-8B# cp -p /opt/code_repos/AI_datasets/AI-ModelScope---medical-o1-reasoning-SFT/README.md ./<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ­¤æ—¶æ‰€æœ‰æ–‡ä»¶</span><br>root@controller01:/opt/code_repos/AI_models/unsloth-DeepSeek-R1-Distill-Llama-8B# ls -alh<br>total 16G<br>drwxr-xr-x 3 root root 4.0K Feb 17 16:21 .<br>drwxr-xr-x 6 root root 4.0K Feb 14 10:49 ..<br>-rw-r--r-- 1 root root  959 Feb 13 17:59 config.json<br>-rw-r--r-- 1 root root   73 Feb 13 17:59 configuration.json<br>-rw-r--r-- 1 root root  236 Feb 13 17:59 generation_config.json<br>-rw-r--r-- 1 root root  62M Feb 13 21:36 medical_o1_sft_Chinese.json<br>-rw-r--r-- 1 root root  71M Feb 13 21:36 medical_o1_sft.json<br>-rw-r--r-- 1 root root 4.7G Feb 13 19:11 model-00001-of-00004.safetensors<br>-rw-r--r-- 1 root root 4.7G Feb 13 19:02 model-00002-of-00004.safetensors<br>-rw-r--r-- 1 root root 4.6G Feb 13 19:10 model-00003-of-00004.safetensors<br>-rw-r--r-- 1 root root 1.1G Feb 13 18:17 model-00004-of-00004.safetensors<br>-rw-r--r-- 1 root root  24K Feb 13 17:59 model.safetensors.index.json<br>-rw------- 1 root root  952 Feb 13 19:11 .msc<br>-rw-r--r-- 1 root root   36 Feb 13 19:11 .mv<br>-rw-r--r-- 1 root root 1.3K Feb 13 21:36 README.md<br>-rw-r--r-- 1 root root  483 Feb 13 17:59 special_tokens_map.json<br>drwxr-xr-x 2 root root 4.0K Feb 13 19:11 ._____temp<br>-rw-r--r-- 1 root root  52K Feb 13 17:59 tokenizer_config.json<br>-rw-r--r-- 1 root root  17M Feb 13 18:00 tokenizer.json<br>-rw-r--r-- 1 root root  16K Feb 13 17:59 unsloth-DeepSeek-R1-Distill-Llama-8B---README.md<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œä¸Šè¿°cellï¼Œè¾“å‡ºå†…å®¹å¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2025/02/17/TSfnkEKOji5szyl.png" alt="image-20250217162802449"></p><h4 id="ç¬¬12ä¸ªcell-åˆ›å»ºSFTTrainerå®ä¾‹"><a href="#ç¬¬12ä¸ªcell-åˆ›å»ºSFTTrainerå®ä¾‹" class="headerlink" title="ç¬¬12ä¸ªcell-åˆ›å»ºSFTTrainerå®ä¾‹"></a>ç¬¬12ä¸ªcell-åˆ›å»ºSFTTrainerå®ä¾‹</h4><p>ä½¿ç”¨trlè¿™ä¸ªpythonåº“æ¥è¿›è¡Œè®­ç»ƒï¼ˆå¾®è°ƒï¼‰ã€‚</p><p>TrainingArguments(â€¦)ä¸­æœ‰å¾ˆå¤šå‚æ•°ï¼Œå®ƒä»¬æ˜¯è®­ç»ƒï¼ˆæ­¤å¤„æ˜¯æ·±åº¦å­¦ä¹ ï¼‰æ—¶ç”¨åˆ°çš„å‚æ•°ã€‚å…¶ä¸­æœ€åä¸€ä¸ªå‚æ•°output_dirå®šä¹‰è¾“å‡ºçš„checkpointçš„è¾“å‡ºç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs shell">from trl import SFTTrainer<br>from transformers import TrainingArguments<br>from unsloth import is_bfloat16_supported<br><br>trainer = SFTTrainer(<br>    model=model,<br>    tokenizer=tokenizer,<br>    train_dataset=dataset,<br>    dataset_text_field=&quot;text&quot;,<br>    max_seq_length=max_seq_length,<br>    dataset_num_proc=2,<br>    args=TrainingArguments(<br>        per_device_train_batch_size=2,<br>        gradient_accumulation_steps=4,<br>        # Use num_train_epochs = 1, warmup_ratio for full training runs!<br>        warmup_steps=5,<br>        max_steps=60,<br>        learning_rate=2e-4,<br>        fp16=not is_bfloat16_supported(),<br>        bf16=is_bfloat16_supported(),<br>        logging_steps=10,<br>        optim=&quot;adamw_8bit&quot;,<br>        weight_decay=0.01,<br>        lr_scheduler_type=&quot;linear&quot;,<br>        seed=3407,<br>        output_dir=&quot;outputs&quot;,<br>    ),<br>)<br></code></pre></td></tr></table></figure><h4 id="ç¬¬13ä¸ªcell-Model-training"><a href="#ç¬¬13ä¸ªcell-Model-training" class="headerlink" title="ç¬¬13ä¸ªcell-Model training"></a>ç¬¬13ä¸ªcell-Model training</h4><p>æ­¤cellå¶å°”ä¼šå‡ºç°è¿è¡Œå¤±è´¥çš„é—®é¢˜ï¼Œæç¤ºã€failed to upsert bucket: returned error 401 Unauthorized: {â€œerrorsâ€:[{â€œmessageâ€:â€user is not logged inâ€â€¦ã€‘è¿™æ ·çš„ä¿¡æ¯ï¼Œé‡å¤è¿è¡Œè¯•è¯•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">trainer_stats = trainer.train()<br></code></pre></td></tr></table></figure><p>æ­¤cellæ­£å¸¸è¿è¡Œè¿‡ç¨‹ä¸­è¾“å‡ºå¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2025/02/18/mXcTxGyh8iYzQHS.png" alt="image-20250218101724006"></p><p>æ­¤cellæ­£å¸¸ç»“æŸå¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2025/02/18/LnV3JCvGxXrD6se.png" alt="image-20250218102147794"></p><h4 id="ç¬¬14ä¸ªcell-ä¿å­˜å¾®è°ƒæ¨¡å‹"><a href="#ç¬¬14ä¸ªcell-ä¿å­˜å¾®è°ƒæ¨¡å‹" class="headerlink" title="ç¬¬14ä¸ªcell-ä¿å­˜å¾®è°ƒæ¨¡å‹"></a>ç¬¬14ä¸ªcell-ä¿å­˜å¾®è°ƒæ¨¡å‹</h4><p>cellå†…å®¹æ— éœ€ä¿®æ”¹ã€‚æ‰§è¡Œåï¼Œè¾“å‡ºå¦‚æœå¦‚ä¸‹ã€‚</p><p><img src="https://s2.loli.net/2025/02/18/fp8cOs7QYrxCVz3.png" alt="image-20250218102321298"></p><p>æ­¤æ—¶åœ¨wandb.aiç½‘ç«™ä¸­æŸ¥çœ‹å¯¹åº”projectçš„è¿è¡Œæƒ…å†µï¼Œå‘ç°çŠ¶æ€å·²ç»æ˜¯Finishedï¼š</p><p><img src="https://s2.loli.net/2025/02/18/SEr27bQL3MVWYDd.png" alt="image-20250218102558319"></p><p>ç‚¹å‡»projectåå­—ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹è¯¦ç»†ä¿¡æ¯ï¼š</p><p><img src="https://s2.loli.net/2025/02/18/SJ1XaUf2Gecx4Im.png" alt="image-20250218102633733"></p><h4 id="ç¬¬15ä¸ªcell-å¾®è°ƒåæ‰§è¡Œæ¨ç†"><a href="#ç¬¬15ä¸ªcell-å¾®è°ƒåæ‰§è¡Œæ¨ç†" class="headerlink" title="ç¬¬15ä¸ªcell-å¾®è°ƒåæ‰§è¡Œæ¨ç†"></a>ç¬¬15ä¸ªcell-å¾®è°ƒåæ‰§è¡Œæ¨ç†</h4><p>ä»…ä»…å°†é—®é¢˜ä»è‹±æ–‡å½¢å¼æ¢æˆä¸­æ–‡å½¢å¼ã€‚å…¶ä½™å†…å®¹ä¸å˜</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">question = <span class="hljs-string">&quot;A 61-year-old woman with a long history of involuntary urine loss during activities like coughing or sneezing but no leakage at night undergoes a gynecological exam and Q-tip test. Based on these findings, what would cystometry most likely reveal about her residual volume and detrusor contractions?&quot;</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##ä»…ä»…å°†é—®é¢˜ä»è‹±æ–‡å½¢å¼æ¢æˆä¸­æ–‡å½¢å¼ã€‚å…¶ä½™å†…å®¹ä¸å˜</span></span><br>question = &quot;ä¸€å61å²å¥³æ€§ï¼Œé•¿æœŸåœ¨å’³å—½æˆ–æ‰“å–·åšç­‰æ´»åŠ¨æ—¶ä¸è‡ªè§‰æ’å°¿ï¼Œä½†å¤œé—´æ— æ¼å°¿ï¼Œç°æ¥å—å¦‡ç§‘æ£€æŸ¥å’ŒQ-tipæ£€æŸ¥ã€‚åŸºäºè¿™äº›å‘ç°ï¼Œè†€èƒ±é€ ç˜˜æœ¯æœ€æœ‰å¯èƒ½æ­ç¤ºå¥¹çš„æ®‹ä½™å®¹é‡å’Œé€¼å°¿è‚Œæ”¶ç¼©æƒ…å†µï¼Ÿ&quot;<br><br>FastLanguageModel.for_inference(model)  # Unsloth has 2x faster inference!<br>inputs = tokenizer([prompt_style.format(question, &quot;&quot;)], return_tensors=&quot;pt&quot;).to(&quot;cuda&quot;)<br><br>outputs = model.generate(<br>    input_ids=inputs.input_ids,<br>    attention_mask=inputs.attention_mask,<br>    max_new_tokens=1200,<br>    use_cache=True,<br>)<br>response = tokenizer.batch_decode(outputs)<br>print(response[0].split(&quot;### Response:&quot;)[1])<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œåï¼Œè¾“å‡ºå†…å®¹å¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2025/02/18/KdSrm9CYI7xTJcg.png" alt="image-20250218103431363"></p><p>ä»¥ä¸‹æ˜¯å¾®è°ƒå‰åæ¨ç†çš„æ€ç»´é“¾ä¸ç»“æœæ¯”è¾ƒï¼ˆå¯ä»¥çœ‹åˆ°å¾®è°ƒåç»“æœç²¾ç®€å‡†ç¡®ä¸€äº›ï¼‰ï¼š</p><p><img src="https://s2.loli.net/2025/02/18/oECSlrJxPam3RGV.png" alt="image-20250218103525077"></p><h4 id="ç¬¬16ä¸ªcell-å¾®è°ƒåå…¶ä»–é—®é¢˜æ¨ç†"><a href="#ç¬¬16ä¸ªcell-å¾®è°ƒåå…¶ä»–é—®é¢˜æ¨ç†" class="headerlink" title="ç¬¬16ä¸ªcell-å¾®è°ƒåå…¶ä»–é—®é¢˜æ¨ç†"></a>ç¬¬16ä¸ªcell-å¾®è°ƒåå…¶ä»–é—®é¢˜æ¨ç†</h4><p>ç¬¬6ä¸ªcellæä¾›ä¸­è‹±æ–‡ä¸¤ç§å½¢å¼çš„é—®é¢˜ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">question = <span class="hljs-string">&quot;A 59-year-old man presents with a fever, chills, night sweats, and generalized fatigue, and is found to have a 12 mm vegetation on the aortic valve. Blood cultures indicate gram-positive, catalase-negative, gamma-hemolytic cocci in chains that do not grow in a 6.5% NaCl medium. What is the most likely predisposing factor for this patient&#x27;s condition?&quot;</span></span><br>question = &quot;59å²ç”·æ€§ï¼Œå‘çƒ­ï¼Œå¯’é¢¤ï¼Œç›—æ±—ï¼Œå…¨èº«ç–²åŠ³ï¼Œä¸»åŠ¨è„‰ç“£ä¸Šæœ‰12æ¯«ç±³çš„èµ˜ç”Ÿç‰©ã€‚è¡€æ¶²åŸ¹å…»æ˜¾ç¤ºé©å…°æ°é˜³æ€§ï¼Œè¿‡æ°§åŒ–æ°¢é…¶é˜´æ€§ï¼ŒÎ³ -æº¶è¡€æ€§çƒèŒé“¾ï¼Œä¸èƒ½åœ¨6.5%çš„NaClåŸ¹å…»åŸºä¸­ç”Ÿé•¿ã€‚è¿™ä¸ªç—…äººçš„ç—…æƒ…æœ€æœ‰å¯èƒ½çš„è¯±å‘å› ç´ æ˜¯ä»€ä¹ˆï¼Ÿ&quot;<br><br>inputs = tokenizer([prompt_style.format(question, &quot;&quot;)], return_tensors=&quot;pt&quot;).to(&quot;cuda&quot;)<br><br>outputs = model.generate(<br>    input_ids=inputs.input_ids,<br>    attention_mask=inputs.attention_mask,<br>    max_new_tokens=1200,<br>    use_cache=True,<br>)<br>response = tokenizer.batch_decode(outputs)<br>print(response[0].split(&quot;### Response:&quot;)[1])<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2025/02/18/OAoxhREBX45DvHi.png" alt="image-20250218104828178"></p><h4 id="ç¬¬17ä¸ªcell-ä¿å­˜æ¨¡å‹æƒé‡æ–‡ä»¶ç­‰åˆ°æœ¬åœ°"><a href="#ç¬¬17ä¸ªcell-ä¿å­˜æ¨¡å‹æƒé‡æ–‡ä»¶ç­‰åˆ°æœ¬åœ°" class="headerlink" title="ç¬¬17ä¸ªcell-ä¿å­˜æ¨¡å‹æƒé‡æ–‡ä»¶ç­‰åˆ°æœ¬åœ°"></a>ç¬¬17ä¸ªcell-ä¿å­˜æ¨¡å‹æƒé‡æ–‡ä»¶ç­‰åˆ°æœ¬åœ°</h4><p>cellå†…å®¹æ— éœ€ä¿®æ”¹ï¼Œç›´æ¥æ‰§è¡Œã€‚è¾“å‡ºå¦‚ä¸‹å›¾</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">new_model_online = <span class="hljs-string">&quot;kingabzpro/DeepSeek-R1-Medical-COT&quot;</span></span><br>new_model_local = &quot;DeepSeek-R1-Medical-COT&quot;<br>model.save_pretrained(new_model_local) # Local saving<br>tokenizer.save_pretrained(new_model_local)<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/18/jR7BLXGMQWYw5fb.png" alt="image-20250218105536427"></p><p>åŒæ—¶ä¼šåœ¨jupyteræ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªâ€DeepSeek-R1-Medical-COTâ€œç›®å½•ï¼Œå…¶ä¸­å†…å®¹å¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2025/02/18/l8cP9d3pRemtzQT.png" alt="image-20250218105707008"></p><h4 id="ç¬¬18ä¸ç¬¬19ä¸ªcell-æŠŠæ¨¡å‹å‘å¸ƒåˆ°huggingface"><a href="#ç¬¬18ä¸ç¬¬19ä¸ªcell-æŠŠæ¨¡å‹å‘å¸ƒåˆ°huggingface" class="headerlink" title="ç¬¬18ä¸ç¬¬19ä¸ªcell-æŠŠæ¨¡å‹å‘å¸ƒåˆ°huggingface"></a>ç¬¬18ä¸ç¬¬19ä¸ªcell-æŠŠæ¨¡å‹å‘å¸ƒåˆ°huggingface</h4><p>huggingfaceéœ€è¦ç¿»å¢™è®¿é—®ï¼Œçœç•¥ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">model.push_to_hub(new_model_online) # Online saving<br>tokenizer.push_to_hub(new_model_online) # Online saving<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">----------------</span><br>model.save_pretrained_merged(new_model_local, tokenizer, save_method = &quot;merged_16bit&quot;,)<br>model.push_to_hub_merged(new_model_online, tokenizer, save_method = &quot;merged_16bit&quot;)<br></code></pre></td></tr></table></figure><h2 id="4-2-åˆ›å»ºä¸€ä¸ªæ–°çš„-ipynbæ–‡ä»¶"><a href="#4-2-åˆ›å»ºä¸€ä¸ªæ–°çš„-ipynbæ–‡ä»¶" class="headerlink" title="4.2 åˆ›å»ºä¸€ä¸ªæ–°çš„.ipynbæ–‡ä»¶"></a>4.2 åˆ›å»ºä¸€ä¸ªæ–°çš„.ipynbæ–‡ä»¶</h2><p><img src="https://s2.loli.net/2025/02/17/ltvbC9sAd4gLKwx.png" alt="image-20250217093919718"></p><p><img src="https://s2.loli.net/2025/02/17/TGyioRtsJHe9wm7.png" alt="image-20250217094028950"></p><p>é‡å‘½åï¼š</p><p><img src="https://s2.loli.net/2025/02/18/qcfBh1Jbox2kjev.png" alt="image-20250218110117175"></p><h2 id="4-3-æŸ¥çœ‹å¿«æ·é”®"><a href="#4-3-æŸ¥çœ‹å¿«æ·é”®" class="headerlink" title="4.3 æŸ¥çœ‹å¿«æ·é”®"></a>4.3 æŸ¥çœ‹å¿«æ·é”®</h2><p><img src="https://s2.loli.net/2025/02/18/Hgx4iydTONfpkbv.png" alt="image-20250218110248372"></p><h1 id="äº”ã€å‚è€ƒèµ„æ–™"><a href="#äº”ã€å‚è€ƒèµ„æ–™" class="headerlink" title="äº”ã€å‚è€ƒèµ„æ–™"></a>äº”ã€å‚è€ƒèµ„æ–™</h1><p>å‚è€ƒæ•™å­¦è§†é¢‘ï¼š<a href="https://www.bilibili.com/video/BV1rSNmekEa7?spm_id_from=333.788.videopod.sections&vd_source=0b5fe5d5aa31f64bf7462d1d094b70a2">å¦‚ä½•åœ¨æœ¬åœ°å¾®è°ƒDeepSeek-R1-8bæ¨¡å‹</a></p>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æœ¬åœ°å¾®è°ƒ DeepSeek-R1-8b</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¾®è°ƒDeepSeek-R1-8Bæ¨¡å‹ä¸å¯è§†åŒ–è®­ç»ƒè¿‡ç¨‹</title>
    <link href="/2025/02/13/%E5%BE%AE%E8%B0%83DeepSeek-R1-8B%E6%A8%A1%E5%9E%8B%E4%B8%8E%E5%8F%AF%E8%A7%86%E5%8C%96%E8%AE%AD%E7%BB%83%E8%BF%87%E7%A8%8B/"/>
    <url>/2025/02/13/%E5%BE%AE%E8%B0%83DeepSeek-R1-8B%E6%A8%A1%E5%9E%8B%E4%B8%8E%E5%8F%AF%E8%A7%86%E5%8C%96%E8%AE%AD%E7%BB%83%E8%BF%87%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p>å‚è€ƒè‹±æ–‡æ–‡æ¡£ï¼š<a href="https://www.datacamp.com/tutorial/fine-tuning-deepseek-r1-reasoning-model">Fine-Tuning DeepSeek R1 (Reasoning Model)</a></p><p>å‚è€ƒæ•™å­¦è§†é¢‘ï¼š<a href="https://www.bilibili.com/video/BV13ZPdejE1K/?spm_id_from=333.337.search-card.all.click&vd_source=0b5fe5d5aa31f64bf7462d1d094b70a2">å¦‚ä½•å¿«é€Ÿå¾®è°ƒDeepSeek-R1-8bæ¨¡å‹ï¼Œå¹¶ä¸”å¯è§†åŒ–è®­ç»ƒè¿‡ç¨‹ï¼Œèµ¶ç´§è¡ŒåŠ¨èµ·æ¥ã€‚</a></p>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>DeepSeek</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>DeepSeek-R1æœ¬åœ°éƒ¨ç½²é…ç½®è¦æ±‚</title>
    <link href="/2025/02/13/DeepSeek-R1%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2%E9%85%8D%E7%BD%AE%E8%A6%81%E6%B1%82/"/>
    <url>/2025/02/13/DeepSeek-R1%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2%E9%85%8D%E7%BD%AE%E8%A6%81%E6%B1%82/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€å‰è¨€">ä¸€ã€å‰è¨€</h1><p>éšç€DeepSeek-V3ä¸R1çš„æŒç»­çˆ†ç«ï¼Œå›½å†…å„ä¸ªå‚å•†æ€èµ·äº†ä¸€åœºæ¥å…¥æˆ–é€‚é…DeepSeekæ¨¡å‹çš„æµªæ½®ï¼Œè¿™æ— ç–‘æ˜¯ä¸€ä»¶å¥½äº‹ã€‚åŒæ—¶ï¼Œä¹Ÿæœ‰è¶Šæ¥è¶Šå¤šçš„ç”¨æˆ·æˆ–å…¬å¸æƒ³è¦åœ¨æœ¬åœ°éƒ¨ç½²DeepSeekæ¨¡å‹ï¼Œä½“éªŒå…¶å¸¦æ¥çš„ä¾¿æ·åŠŸèƒ½æˆ–äºŒæ¬¡å¼€å‘ï¼Œä½†DeepSeekæ¨¡å‹éƒ¨ç½²æ—¶å¯¹ç¡¬ä»¶æœ‰ä¸€å®šè¦ä¸ï¼Œä»¥ä¸‹è¿™DeepSeek-R1çš„åŸºç¡€æ¨¡å‹åŠè’¸é¦æ¨¡å‹çš„éƒ¨ç½²ç¡¬ä»¶è¦æ±‚è¿›è¡Œæ•´ç†æ±‡æ€»ã€‚</p><h1 id="äºŒdeepseek-r1åŸºç¡€æ¨¡å‹æœ¬åœ°éƒ¨ç½²é…ç½®è¦æ±‚">äºŒã€DeepSeek-R1åŸºç¡€æ¨¡å‹æœ¬åœ°éƒ¨ç½²é…ç½®è¦æ±‚</h1><table><thead><tr class="header"><th>æ¨¡å‹|è¦æ±‚</th><th>CPU</th><th>å†…å­˜</th><th>ç¡¬ç›˜</th><th>æ˜¾å¡</th><th>åœºæ™¯</th></tr></thead><tbody><tr class="odd"><td><strong>DeepSeek-R1-1.5B</strong></td><td>æœ€ä½ 4 æ ¸ï¼ˆæ¨è Intel/AMD å¤šæ ¸å¤„ç†å™¨ï¼‰</td><td>8GB+</td><td>3GB+ å­˜å‚¨ç©ºé—´ï¼ˆæ¨¡å‹æ–‡ä»¶çº¦ 1.5-2GBï¼‰</td><td>éå¿…éœ€ï¼ˆçº¯ CPU æ¨ç†ï¼‰ï¼Œè‹¥ GPU åŠ é€Ÿå¯é€‰ 4GB+ æ˜¾å­˜ï¼ˆå¦‚ GTX 1650ï¼‰</td><td>ä½èµ„æºè®¾å¤‡éƒ¨ç½²ï¼ˆå¦‚æ ‘è“æ´¾ã€æ—§æ¬¾ç¬”è®°æœ¬ï¼‰ å®æ—¶æ–‡æœ¬ç”Ÿæˆï¼ˆèŠå¤©æœºå™¨äººã€ç®€å•é—®ç­”ï¼‰ åµŒå…¥å¼ç³»ç»Ÿæˆ–ç‰©è”ç½‘è®¾å¤‡</td></tr><tr class="even"><td><strong>DeepSeek-R1-7B</strong></td><td>8 æ ¸ä»¥ä¸Šï¼ˆæ¨èç°ä»£å¤šæ ¸ CPUï¼‰</td><td>16GB+</td><td>8GB+ï¼ˆæ¨¡å‹æ–‡ä»¶çº¦ 4-5GBï¼‰</td><td>æ¨è 8GB+ æ˜¾å­˜ï¼ˆå¦‚ RTX 3070/4060ï¼‰</td><td>æœ¬åœ°å¼€å‘æµ‹è¯•ï¼ˆä¸­å°å‹ä¼ä¸šï¼‰ ä¸­ç­‰å¤æ‚åº¦ NLP ä»»åŠ¡ï¼ˆæ–‡æœ¬æ‘˜è¦ã€ç¿»è¯‘ï¼‰ è½»é‡çº§å¤šè½®å¯¹è¯ç³»ç»Ÿ</td></tr><tr class="odd"><td><strong>DeepSeek-R1-8B</strong></td><td>ä¸ 7B ç›¸è¿‘</td><td>ä¸ 7B ç›¸è¿‘ï¼Œç•¥é«˜ 10-20%</td><td>ä¸ 7B ç›¸è¿‘ï¼Œç•¥é«˜ 10-20%</td><td>ä¸ 7B ç›¸è¿‘</td><td>éœ€æ›´é«˜ç²¾åº¦çš„è½»é‡çº§ä»»åŠ¡ï¼ˆå¦‚ä»£ç ç”Ÿæˆã€é€»è¾‘æ¨ç†ï¼‰</td></tr><tr class="even"><td><strong>DeepSeek-R1-14B</strong></td><td>12 æ ¸ä»¥ä¸Š</td><td>32GB+</td><td>15GB+</td><td>16GB+ æ˜¾å­˜ï¼ˆå¦‚ RTX 4090 æˆ– A5000ï¼‰</td><td>ä¼ä¸šçº§å¤æ‚ä»»åŠ¡ï¼ˆåˆåŒåˆ†æã€æŠ¥å‘Šç”Ÿæˆï¼‰ é•¿æ–‡æœ¬ç†è§£ä¸ç”Ÿæˆï¼ˆä¹¦ç±/è®ºæ–‡è¾…åŠ©å†™ä½œï¼‰</td></tr><tr class="odd"><td><strong>DeepSeek-R1-32B</strong></td><td>16 æ ¸ä»¥ä¸Šï¼ˆå¦‚ AMD Ryzen 9 æˆ– Intel i9ï¼‰</td><td>64GB+</td><td>30GB+</td><td>24GB+ æ˜¾å­˜ï¼ˆå¦‚ A100 40GB æˆ–åŒå¡ RTX 3090ï¼‰</td><td>é«˜ç²¾åº¦ä¸“ä¸šé¢†åŸŸä»»åŠ¡ï¼ˆåŒ»ç–—/æ³•å¾‹å’¨è¯¢ï¼‰ å¤šæ¨¡æ€ä»»åŠ¡é¢„å¤„ç†ï¼ˆéœ€ç»“åˆå…¶ä»–æ¡†æ¶ï¼‰</td></tr><tr class="even"><td><strong>DeepSeek-R1-70B</strong></td><td>32 æ ¸ä»¥ä¸Šï¼ˆæœåŠ¡å™¨çº§ CPUï¼‰</td><td>128GB+</td><td>70GB+</td><td>å¤šå¡å¹¶è¡Œï¼ˆå¦‚ 2x A100 80GB æˆ– 4x RTX 4090ï¼‰</td><td>ç§‘ç ”æœºæ„/å¤§å‹ä¼ä¸šï¼ˆé‡‘èé¢„æµ‹ã€å¤§è§„æ¨¡æ•°æ®åˆ†æï¼‰ é«˜å¤æ‚åº¦ç”Ÿæˆä»»åŠ¡ï¼ˆåˆ›æ„å†™ä½œã€ç®—æ³•è®¾è®¡ï¼‰</td></tr><tr class="odd"><td><strong>DeepSeek-R1-671B</strong></td><td>64 æ ¸ä»¥ä¸Šï¼ˆæœåŠ¡å™¨é›†ç¾¤ï¼‰</td><td>512GB+</td><td>300GB+</td><td>å¤šèŠ‚ç‚¹åˆ†å¸ƒå¼è®­ç»ƒï¼ˆå¦‚ 8x A100/H100ï¼‰</td><td>å›½å®¶çº§/è¶…å¤§è§„æ¨¡ AI ç ”ç©¶ï¼ˆå¦‚æ°”å€™å»ºæ¨¡ã€åŸºå› ç»„åˆ†æï¼‰ é€šç”¨äººå·¥æ™ºèƒ½ï¼ˆAGIï¼‰æ¢ç´¢</td></tr></tbody></table><figure><img src="https://s2.loli.net/2025/02/13/Iz3B64UwqTaYHXl.png" alt="image-20250213142425088" /><figcaption aria-hidden="true">image-20250213142425088</figcaption></figure><p><strong>é’ˆå¯¹DeepSeek-R1æ¨¡å‹æœ¬åœ°éƒ¨ç½²ä¸ä½¿ç”¨çš„é€šç”¨å»ºè®®</strong></p><ul><li><p><strong>é‡åŒ–ä¼˜åŒ–</strong>ï¼šä½¿ç”¨ 4-bit/8-bit é‡åŒ–å¯é™ä½æ˜¾å­˜å ç”¨ 30-50%ã€‚</p></li><li><p><strong>æ¨ç†æ¡†æ¶</strong>ï¼šæ­é… vLLMã€TensorRT ç­‰åŠ é€Ÿåº“æå‡æ•ˆç‡ã€‚</p></li><li><p><strong>äº‘éƒ¨ç½²</strong>ï¼š70B/671B å»ºè®®ä¼˜å…ˆè€ƒè™‘äº‘æœåŠ¡ä»¥å¼¹æ€§æ‰©å±•èµ„æºã€‚</p></li><li><p><strong>èƒ½è€—æ³¨æ„</strong>ï¼š32B+ æ¨¡å‹éœ€é«˜åŠŸç‡ç”µæºï¼ˆ1000W+ï¼‰å’Œæ•£çƒ­ç³»ç»Ÿã€‚</p></li></ul><h1 id="ä¸‰deepseek-r1è’¸é¦æ¨¡å‹åŠå…¶é‡åŒ–ç‰ˆæœ¬æœ¬åœ°éƒ¨ç½²é…ç½®è¦æ±‚">ä¸‰ã€DeepSeek-R1è’¸é¦æ¨¡å‹åŠå…¶é‡åŒ–ç‰ˆæœ¬æœ¬åœ°éƒ¨ç½²é…ç½®è¦æ±‚</h1><figure><img src="https://s2.loli.net/2025/02/13/mFkuPELIxc7Z4yX.png" alt="image-20250213102615401" /><figcaption aria-hidden="true">image-20250213102615401</figcaption></figure><p>ä½¿ç”¨è’¸é¦æ¨¡å‹æ—¶ï¼ŒCPUé…ç½®åº”è¯¥å°½é‡è·ŸåŒç­‰å‚æ•°è§„æ¨¡çš„DeepSeek-R1æ¨¡å‹é è¿‘æˆ–ç•¥ä½ã€‚æœ¬äººåœ¨æœ¬åœ°ä½¿ç”¨ä¸€ä¸ªNVIDIA A40ä¹ŸæˆåŠŸéƒ¨ç½²äº†DeepSeek-R1-Distill-Llama-70Bï¼Œè¯•ç”¨ç€ç›´æ¥ä½¿ç”¨ollamaæˆ–ä½¿ç”¨pythonç¨‹åºå‘å…¶æé—®ï¼Œå…¶å›ç­”é—®é¢˜çš„é€Ÿåº¦ä¸å‡†ç¡®æ€§ï¼ˆåªé’ˆå¯¹æ‰€ææ™®é€šé—®é¢˜è€Œè¨€ï¼‰è¿˜èƒ½æ¥å—ã€‚</p><p>å¦å¤–ï¼Œåœ¨éƒ¨ç½²ä¸ä½¿ç”¨AIæ¨¡å‹è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚ä»è¾ƒå°çš„æ¨¡å‹å¼€å§‹éƒ¨ç½²è¿›è¡Œè¯•ç”¨ï¼Œå¦‚æœ‰éœ€è¦å†å‡çº§è‡³æ›´é«˜å‚æ•°è§„æ¨¡çš„æ¨¡å‹ï¼Œåœ¨æ»¡è¶³éœ€æ±‚çš„åŒæ—¶ä¹Ÿå¯ä»¥é¿å…èµ„æºçš„æµªè´¹ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤§æ¨¡å‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>k8såœ¨çº¿éƒ¨ç½²-kubeadméƒ¨ç½²å•èŠ‚ç‚¹k8s1.23.17</title>
    <link href="/2025/02/12/k8s%E5%9C%A8%E7%BA%BF%E9%83%A8%E7%BD%B2-kubeadm%E9%83%A8%E7%BD%B2%E5%8D%95%E8%8A%82%E7%82%B9k8s1-23-17/"/>
    <url>/2025/02/12/k8s%E5%9C%A8%E7%BA%BF%E9%83%A8%E7%BD%B2-kubeadm%E9%83%A8%E7%BD%B2%E5%8D%95%E8%8A%82%E7%82%B9k8s1-23-17/</url>
    
    <content type="html"><![CDATA[<h2 id="èŠ‚ç‚¹è§„åˆ’">2.1 èŠ‚ç‚¹è§„åˆ’</h2><table style="width:100%;"><thead><tr class="header"><th>ä¸»æœºå</th><th>ç”¨é€”</th><th>IP</th><th>rootç”¨æˆ·å¯†ç </th><th>è§„æ ¼</th><th>ç³»ç»Ÿç›˜</th><th>OS</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr class="odd"><td>controller01</td><td>master + worker</td><td>172.20.0.21</td><td>cloud@2020</td><td>8c16g</td><td>400G</td><td>Ubuntu 20.04.3 LTS-amd64</td><td>è”ç½‘</td></tr></tbody></table><h2 id="å®‰è£…æ­¥éª¤">2.2 å®‰è£…æ­¥éª¤</h2><h3 id="ä¿®æ”¹å„èŠ‚ç‚¹ä¸»æœºå">2.2.1 ä¿®æ”¹å„èŠ‚ç‚¹ä¸»æœºå</h3><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">hostnamectl</span> <span class="hljs-built_in">set-hostname</span> <span class="hljs-string">controller01</span><br></code></pre></td></tr></table></figure><h3 id="é…ç½®ä¸»æœºååŠä¸»æœºåä¸ipæ˜ å°„æ‰€æœ‰èŠ‚ç‚¹">2.2.2 é…ç½®ä¸»æœºååŠä¸»æœºåä¸ipæ˜ å°„ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:~# cat /etc/hosts<br>...<br>172.20.0.21 controller01<br></code></pre></td></tr></table></figure><h3 id="é…ç½®ä»master01åˆ°æ‰€æœ‰èŠ‚ç‚¹çš„sshå…å¯†ç™»å½•">2.2.3 é…ç½®ä»master01åˆ°æ‰€æœ‰èŠ‚ç‚¹çš„sshå…å¯†ç™»å½•</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ruby">root<span class="hljs-variable">@controller01</span><span class="hljs-symbol">:~</span><span class="hljs-comment"># ssh-keygen -P &quot;&quot; -t rsa</span><br>root<span class="hljs-variable">@controller01</span><span class="hljs-symbol">:~</span><span class="hljs-comment"># ssh-copy-id root<span class="hljs-doctag">@controller</span>01</span><br></code></pre></td></tr></table></figure><h3 id="å…³é—­é˜²ç«å¢™ç­‰è®¾ç½®ä¸å®‰è£…ä¸€äº›å¸¸ç”¨çš„å·¥å…·ç»„ä»¶">2.2.4 å…³é—­é˜²ç«å¢™ç­‰è®¾ç½®ä¸å®‰è£…ä¸€äº›å¸¸ç”¨çš„å·¥å…·ç»„ä»¶</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å…³é—­é˜²ç«å¢™</span><br>systemctl status ufw<br>systemctl stop ufw<br>systemctl disable ufw<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è®¾ç½®æ—¶åŒºä¸ºäºšæ´²ä¸Šæµ·</span><br>timedatectl set-timezone Asia/Shanghai<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…å¸¸ç”¨å·¥å…·ç»„ä»¶</span><br>apt-get update &amp;&amp; apt install -y tmux wget<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…k8sç›¸å…³æœåŠ¡ä¾èµ–ç»„ä»¶</span><br>apt install -y socat conntrack ebtables ipset chrony;systemctl enable chronyd.service &amp;&amp; systemctl restart chronyd.service &amp;&amp; systemctl status chronyd<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹æ—¶é—´åŒæ­¥æƒ…å†µ</span><br>chronyc sources<br></code></pre></td></tr></table></figure><h3 id="swapåˆ†åŒºç¦ç”¨åŠå†…æ ¸å‚æ•°è°ƒæ•´">2.5.5 Swapåˆ†åŒºç¦ç”¨åŠå†…æ ¸å‚æ•°è°ƒæ•´</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸´æ—¶ç¦ç”¨swapåˆ†åŒº</span><br>swapoff -a<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ³¨é‡Šswapé…ç½®è¡Œï¼Œæ°¸ä¹…ç¦ç”¨swapåˆ†åŒº</span><br>sed -i &#x27;s/.*swap.*/#&amp;/&#x27; /etc/fstab<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è°ƒæ•´å†…æ ¸å‚æ•°</span><br>echo &#x27;vm.swappiness=0&#x27; &gt;&gt; /etc/sysctl.d/k8s.conf<br>sysctl -p /etc/sysctl.d/k8s.conf<br></code></pre></td></tr></table></figure><h3 id="è½¬å‘ipv4å¹¶è®©iptablesçœ‹åˆ°æ¡¥æ¥æµé‡">2.2.6 è½¬å‘IPv4å¹¶è®©iptablesçœ‹åˆ°æ¡¥æ¥æµé‡</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">è®¾ç½®OSå¯åŠ¨æ—¶çš„åŠ è½½æ¨¡å—</span><br>echo &#x27;overlay&#x27; &gt;&gt; /etc/modules-load.d/k8s.conf;echo &#x27;br_netfilter&#x27; &gt;&gt; /etc/modules-load.d/k8s.conf<br><span class="hljs-meta prompt_">#</span><span class="language-bash">åŠ è½½overlayä¸br_netfilteræ¨¡å—</span><br>modprobe overlay &amp;&amp; modprobe br_netfilter<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è®¾ç½®å†…æ ¸å‚æ•°(é‡å¯ä¾ç„¶ç”Ÿæ•ˆ)</span><br>echo &#x27;net.bridge.bridge-nf-call-iptables  = 1&#x27; &gt;&gt; /etc/sysctl.d/k8s.conf<br>echo &#x27;net.bridge.bridge-nf-call-ip6tables = 1&#x27; &gt;&gt; /etc/sysctl.d/k8s.conf<br>echo &#x27;net.ipv4.ip_forward                 = 1&#x27; &gt;&gt; /etc/sysctl.d/k8s.conf<br><span class="hljs-meta prompt_">#</span><span class="language-bash">bridge-nf</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">bridge-nf ä½¿å¾— netfilter å¯ä»¥å¯¹ Linux ç½‘æ¡¥ä¸Šçš„ IPv4/ARP/IPv6 åŒ…è¿‡æ»¤ã€‚æ¯”å¦‚ï¼Œè®¾ç½®net.bridge.bridge-nf-call-iptablesï¼1åï¼ŒäºŒå±‚çš„ç½‘æ¡¥åœ¨è½¬å‘åŒ…æ—¶ä¹Ÿä¼šè¢« <span class="hljs-comment">#iptablesçš„ FORWARD è§„åˆ™æ‰€è¿‡æ»¤ã€‚å¸¸ç”¨çš„é€‰é¡¹åŒ…æ‹¬ï¼š</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">net.bridge.bridge-nf-call-arptablesï¼šæ˜¯å¦åœ¨ arptables çš„ FORWARD ä¸­è¿‡æ»¤ç½‘æ¡¥çš„ ARP åŒ…</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">net.bridge.bridge-nf-call-ip6tablesï¼šæ˜¯å¦åœ¨ ip6tables é“¾ä¸­è¿‡æ»¤ IPv6 åŒ…</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">net.bridge.bridge-nf-call-iptablesï¼šæ˜¯å¦åœ¨ iptables é“¾ä¸­è¿‡æ»¤ IPv4 åŒ…</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">net.bridge.bridge-nf-filter-vlan-taggedï¼šæ˜¯å¦åœ¨ iptables/arptables ä¸­è¿‡æ»¤æ‰“äº† vlan æ ‡ç­¾çš„åŒ…ã€‚</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é˜²ç«å¢™æ˜¯ä¿æŠ¤æœåŠ¡å™¨å’ŒåŸºç¡€è®¾æ–½å®‰å…¨çš„é‡è¦å·¥å…·ã€‚åœ¨ Linux ç”Ÿæ€ç³»ç»Ÿä¸­ï¼Œiptables æ˜¯ä½¿ ç”¨å¾ˆå¹¿æ³›çš„é˜²ç«å¢™å·¥å…·ä¹‹ä¸€ï¼Œå®ƒåŸºäºå†…æ ¸çš„åŒ…è¿‡æ»¤æ¡†æ¶ï¼ˆpacket filtering <span class="hljs-comment">#frameworkï¼‰ netfilterã€‚</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">Linux ä¸Šæœ€å¸¸ç”¨çš„é˜²ç«å¢™å·¥å…·æ˜¯ iptablesã€‚iptables ä¸åè®®æ ˆå†…æœ‰åŒ…è¿‡æ»¤åŠŸèƒ½çš„ hook äº¤ äº’æ¥å®Œæˆå·¥ä½œã€‚è¿™äº›å†…æ ¸ hook æ„æˆäº† netfilter æ¡†æ¶ã€‚</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ¯ä¸ªè¿›å…¥ç½‘ç»œç³»ç»Ÿçš„åŒ…ï¼ˆæ¥æ”¶æˆ–å‘é€ï¼‰åœ¨ç»è¿‡åè®®æ ˆæ—¶éƒ½ä¼šè§¦å‘è¿™äº› hookï¼Œç¨‹åº å¯ä»¥é€šè¿‡æ³¨å†Œ hook å‡½æ•°çš„æ–¹å¼åœ¨ä¸€äº›å…³é”®è·¯å¾„ä¸Šå¤„ç†ç½‘ç»œæµé‡ã€‚iptables ç›¸å…³çš„å†…æ ¸æ¨¡ <span class="hljs-comment">#å—åœ¨è¿™äº› hook ç‚¹æ³¨å†Œäº†å¤„ç†å‡½æ•°ï¼Œå› æ­¤å¯ä»¥é€šè¿‡é…ç½® iptables è§„åˆ™æ¥ä½¿å¾—ç½‘ç»œæµé‡ç¬¦åˆ é˜²ç«å¢™è§„åˆ™ã€‚</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä¸éœ€è¦é‡å¯ä½¿å†…æ ¸å‚æ•°ç”Ÿæ•ˆï¼Œç„¶åæŸ¥çœ‹å½“å‰ç”Ÿæ•ˆçš„ç›¸å…³å†…æ ¸å‚æ•°</span><br>sysctl --system<br>sysctl net.bridge.bridge-nf-call-iptables <br>sysctl net.bridge.bridge-nf-call-ip6tables <br>sysctl net.ipv4.ip_forward<br></code></pre></td></tr></table></figure><h3 id="å®‰è£…docker-engine">2.2.7 å®‰è£…docker engine</h3><p>æ›´æ–°apt-get</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get update<br></code></pre></td></tr></table></figure><p>å®‰è£… apt ä¾èµ–åŒ…ï¼Œç”¨äºé€šè¿‡HTTPSæ¥è·å–ä»“åº“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get install apt-transport-https ca-certificates curl gnupg-agent software-properties-common<br></code></pre></td></tr></table></figure><p>æ·»åŠ  Docker çš„å®˜æ–¹ GPG å¯†é’¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -<br></code></pre></td></tr></table></figure><p>è®¾ç½®ç¨³å®šç‰ˆä»“åº“(æ·»åŠ åˆ°/etc/apt/sources.listä¸­)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo add-apt-repository &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&quot;<br></code></pre></td></tr></table></figure><p>æ›´æ–°apt-get</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get update<br></code></pre></td></tr></table></figure><p>æŸ¥è¯¢docker-ceç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-cache policy docker-ce<br></code></pre></td></tr></table></figure><p>å®‰è£…æŒ‡å®šç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get install docker-ce=5:20.10.24~3-0~ubuntu-focal<br></code></pre></td></tr></table></figure><p>éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker --version<br></code></pre></td></tr></table></figure><p><strong>æ›´æ–° cgroupdriver ä¸ºsystemd</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs shell">tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;<br>&#123;<br>  &quot;registry-mirrors&quot;: [<br>    &quot;https://hub.rat.dev&quot;,<br>    &quot;https://registry.aliyuncs.com&quot;,<br>    &quot;https://registry.docker-cn.com&quot;,<br>    &quot;https://docker.chenby.cn&quot;,<br>    &quot;https://docker.registry.cyou&quot;,<br>    &quot;https://docker-cf.registry.cyou&quot;,<br>    &quot;https://dockercf.jsdelivr.fyi&quot;,<br>    &quot;https://docker.jsdelivr.fyi&quot;,<br>    &quot;https://dockertest.jsdelivr.fyi&quot;,<br>    &quot;https://dockerproxy.com&quot;,<br>    &quot;https://docker.m.daocloud.io&quot;,<br>    &quot;https://docker.nju.edu.cn&quot;,<br>    &quot;https://docker.mirrors.sjtug.sjtu.edu.cn&quot;,<br>    &quot;https://docker.mirrors.ustc.edu.cn&quot;,<br>    &quot;https://mirror.iscas.ac.cn&quot;,<br>    &quot;https://docker.rainbond.cc&quot;<br>  ],<br>  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;]<br>&#125;<br>EOF<br><br>systemctl daemon-reload<br>systemctl restart docker<br></code></pre></td></tr></table></figure><h3 id="k8sé›†ç¾¤åˆå§‹åŒ–kubeadm">2.2.8 K8sé›†ç¾¤åˆå§‹åŒ–(kubeadm)</h3><h4 id="å®‰è£…å·¥å…·">2.2.8.1 å®‰è£…å·¥å…·</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…ç»„ä»¶</span><br>apt-get update<br>apt-get install -y apt-transport-https ca-certificates curl<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ·»åŠ GPG å¯†é’¥</span><br>curl -s https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | sudo apt-key add -<br><br>tee /etc/apt/sources.list.d/kubernetes.list &lt;&lt; EOF<br>deb https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial main<br>EOF<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…kubelet kubeadm kubectl</span><br>apt-get update<br>apt-get install -y kubelet=1.23.17-00 kubeadm=1.23.17-00 kubectl=1.23.17-00<br>apt-mark hold kubelet kubeadm kubectl<br></code></pre></td></tr></table></figure><h4 id="ä¸‹è½½é•œåƒå¹¶ä¸Šä¼ åˆ°harbor">2.2.8.2 ä¸‹è½½é•œåƒå¹¶ä¸Šä¼ åˆ°harbor</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœæ²¡æœ‰harboræœåŠ¡å™¨æˆ–ä¸çŸ¥é“å®ƒæ˜¯ä»€ä¹ˆï¼Œå°±ç›´æ¥ä½¿ç”¨ registry.aliyuncs.com/google_containers/xxx</span><br>k8s_ver=&quot;1.23.17&quot;<br>kubeadm config images list --kubernetes-version=$&#123;k8s_ver&#125; | awk -F &quot;/&quot; &#x27;&#123;print $NF&#125;&#x27;<br>images=$(kubeadm config images list --kubernetes-version=$&#123;k8s_ver&#125; | awk -F &quot;/&quot; &#x27;&#123;print $NF&#125;&#x27;)<br>for i in $&#123;images&#125;; <br>    do echo $i; <br>    docker pull registry.aliyuncs.com/google_containers/$i; <br>done<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœæœ‰harboræœåŠ¡å™¨</span><br>k8s_ver=&quot;1.23.17&quot;<br>harbor_url=&quot;175.6.40.93:8196&quot;<br>kubeadm config images list --kubernetes-version=$&#123;k8s_ver&#125; | awk -F &quot;/&quot; &#x27;&#123;print $NF&#125;&#x27;<br>images=$(kubeadm config images list --kubernetes-version=$&#123;k8s_ver&#125; | awk -F &quot;/&quot; &#x27;&#123;print $NF&#125;&#x27;)<br>for i in $&#123;images&#125;; <br>    do echo $i; <br>    docker pull registry.aliyuncs.com/google_containers/$i; <br>    docker tag registry.aliyuncs.com/google_containers/$i $&#123;harbor_url&#125;/google_containers/$i; <br>    docker push $&#123;harbor_url&#125;/google_containers/$i; <br>    docker rmi registry.aliyuncs.com/google_containers/$i; <br>done<br></code></pre></td></tr></table></figure><h4 id="æ­£å¼åˆå§‹åŒ–">2.2.8.3 æ­£å¼åˆå§‹åŒ–</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœæ²¡æœ‰harboræœåŠ¡å™¨æˆ–ä¸çŸ¥é“å®ƒæ˜¯ä»€ä¹ˆ</span><br>kubeadm init \<br> --image-repository=registry.aliyuncs.com/google_containers \<br> --kubernetes-version=1.23.17 \<br> --pod-network-cidr=&quot;10.250.0.0/16&quot; \<br> --apiserver-advertise-address=172.20.0.21 \<br> --service-cidr=&quot;10.96.0.0/12&quot; \<br> --ignore-preflight-errors strings=Swap<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœæœ‰harboræœåŠ¡å™¨</span><br>kubeadm init \<br> --image-repository=175.6.40.93:8196/google_containers \<br> --kubernetes-version=1.23.17 \<br> --pod-network-cidr=&quot;10.250.0.0/16&quot; \<br> --apiserver-advertise-address=172.20.0.21 \<br> --service-cidr=&quot;10.96.0.0/12&quot; \<br> --ignore-preflight-errors strings=Swap<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">--image-repository harboræœåŠ¡å™¨é•¿åŸŸå+ä»“åº“å</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">--kubernetes-version ä¸Šé¢çš„<span class="hljs-variable">$&#123;k8s_ver&#125;</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">--pod-network-cidr k8sé›†ç¾¤çš„podç½‘æ®µï¼Œå¯è‡ªå®šä¹‰</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">--apiserver-advertise-address masterèŠ‚ç‚¹çš„ç®¡ç†ip</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">--service-cidr k8sé›†ç¾¤çš„svcç½‘æ®µï¼Œå¯è‡ªå®šä¹‰</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">--ignore-preflight-errors strings=Swap å€¼åªèƒ½æ˜¯ä¸€ä¸ªåˆ—è¡¨çš„å­é›†ï¼Œè¯¦æƒ…æŸ¥çœ‹kubeadm init --<span class="hljs-built_in">help</span></span><br></code></pre></td></tr></table></figure><h3 id="é…ç½®kube-configæ–‡ä»¶">2.2.9 é…ç½®kube configæ–‡ä»¶</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">è¾“å‡ºä¿¡æ¯æç¤ºå†…å®¹</span><br>mkdir -p $HOME/.kube<br>cp -i /etc/kubernetes/admin.conf $HOME/.kube/config<br>chown $(id -u):$(id -g) $HOME/.kube/config<br></code></pre></td></tr></table></figure><h3 id="åˆ é™¤masterèŠ‚ç‚¹æ±¡ç‚¹">2.2.10 åˆ é™¤masterèŠ‚ç‚¹æ±¡ç‚¹</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">K8Sä¸­é»˜è®¤masterèŠ‚ç‚¹æ˜¯ä¸èƒ½è°ƒåº¦ä»»ä½•podçš„ï¼Œå› ä¸ºæ­¤å¤„æ˜¯å•èŠ‚ç‚¹k8sé›†ç¾¤ï¼Œæ‰€ä»¥éœ€è¦å°†æ§åˆ¶èŠ‚ç‚¹æ±¡ç‚¹å»é™¤</span><br>kubectl taint nodes --all node-role.kubernetes.io/master-<br></code></pre></td></tr></table></figure><h3 id="å®‰è£…ç½‘ç»œæ’ä»¶calico">2.2.11 å®‰è£…ç½‘ç»œæ’ä»¶(calico)</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -p /data/kubernetes/network/calico &amp;&amp; cd /data/kubernetes/network/calico<br>wget https://docs.projectcalico.org/manifests/calico.yaml<br><br>docker pull docker.io/calico/cni:v3.25.0<br>docker pull docker.io/calico/node:v3.25.0<br>docker pull docker.io/calico/kube-controllers:v3.25.0<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿®æ”¹ä¸‹è½½ä¸‹æ¥çš„calico.yamlæ–‡ä»¶ï¼šå…¶ä¸­ä½¿ç”¨åˆ°çš„é•œåƒã€CALICO_IPV4POOL_CIDRçš„å€¼ä¸ºâ€œ--pod-network-cidrâ€å‚æ•°çš„é…ç½®å€¼</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿®æ”¹åå¦‚ä¸‹</span><br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br><span class="line">1470</span><br><span class="line">1471</span><br><span class="line">1472</span><br><span class="line">1473</span><br><span class="line">1474</span><br><span class="line">1475</span><br><span class="line">1476</span><br><span class="line">1477</span><br><span class="line">1478</span><br><span class="line">1479</span><br><span class="line">1480</span><br><span class="line">1481</span><br><span class="line">1482</span><br><span class="line">1483</span><br><span class="line">1484</span><br><span class="line">1485</span><br><span class="line">1486</span><br><span class="line">1487</span><br><span class="line">1488</span><br><span class="line">1489</span><br><span class="line">1490</span><br><span class="line">1491</span><br><span class="line">1492</span><br><span class="line">1493</span><br><span class="line">1494</span><br><span class="line">1495</span><br><span class="line">1496</span><br><span class="line">1497</span><br><span class="line">1498</span><br><span class="line">1499</span><br><span class="line">1500</span><br><span class="line">1501</span><br><span class="line">1502</span><br><span class="line">1503</span><br><span class="line">1504</span><br><span class="line">1505</span><br><span class="line">1506</span><br><span class="line">1507</span><br><span class="line">1508</span><br><span class="line">1509</span><br><span class="line">1510</span><br><span class="line">1511</span><br><span class="line">1512</span><br><span class="line">1513</span><br><span class="line">1514</span><br><span class="line">1515</span><br><span class="line">1516</span><br><span class="line">1517</span><br><span class="line">1518</span><br><span class="line">1519</span><br><span class="line">1520</span><br><span class="line">1521</span><br><span class="line">1522</span><br><span class="line">1523</span><br><span class="line">1524</span><br><span class="line">1525</span><br><span class="line">1526</span><br><span class="line">1527</span><br><span class="line">1528</span><br><span class="line">1529</span><br><span class="line">1530</span><br><span class="line">1531</span><br><span class="line">1532</span><br><span class="line">1533</span><br><span class="line">1534</span><br><span class="line">1535</span><br><span class="line">1536</span><br><span class="line">1537</span><br><span class="line">1538</span><br><span class="line">1539</span><br><span class="line">1540</span><br><span class="line">1541</span><br><span class="line">1542</span><br><span class="line">1543</span><br><span class="line">1544</span><br><span class="line">1545</span><br><span class="line">1546</span><br><span class="line">1547</span><br><span class="line">1548</span><br><span class="line">1549</span><br><span class="line">1550</span><br><span class="line">1551</span><br><span class="line">1552</span><br><span class="line">1553</span><br><span class="line">1554</span><br><span class="line">1555</span><br><span class="line">1556</span><br><span class="line">1557</span><br><span class="line">1558</span><br><span class="line">1559</span><br><span class="line">1560</span><br><span class="line">1561</span><br><span class="line">1562</span><br><span class="line">1563</span><br><span class="line">1564</span><br><span class="line">1565</span><br><span class="line">1566</span><br><span class="line">1567</span><br><span class="line">1568</span><br><span class="line">1569</span><br><span class="line">1570</span><br><span class="line">1571</span><br><span class="line">1572</span><br><span class="line">1573</span><br><span class="line">1574</span><br><span class="line">1575</span><br><span class="line">1576</span><br><span class="line">1577</span><br><span class="line">1578</span><br><span class="line">1579</span><br><span class="line">1580</span><br><span class="line">1581</span><br><span class="line">1582</span><br><span class="line">1583</span><br><span class="line">1584</span><br><span class="line">1585</span><br><span class="line">1586</span><br><span class="line">1587</span><br><span class="line">1588</span><br><span class="line">1589</span><br><span class="line">1590</span><br><span class="line">1591</span><br><span class="line">1592</span><br><span class="line">1593</span><br><span class="line">1594</span><br><span class="line">1595</span><br><span class="line">1596</span><br><span class="line">1597</span><br><span class="line">1598</span><br><span class="line">1599</span><br><span class="line">1600</span><br><span class="line">1601</span><br><span class="line">1602</span><br><span class="line">1603</span><br><span class="line">1604</span><br><span class="line">1605</span><br><span class="line">1606</span><br><span class="line">1607</span><br><span class="line">1608</span><br><span class="line">1609</span><br><span class="line">1610</span><br><span class="line">1611</span><br><span class="line">1612</span><br><span class="line">1613</span><br><span class="line">1614</span><br><span class="line">1615</span><br><span class="line">1616</span><br><span class="line">1617</span><br><span class="line">1618</span><br><span class="line">1619</span><br><span class="line">1620</span><br><span class="line">1621</span><br><span class="line">1622</span><br><span class="line">1623</span><br><span class="line">1624</span><br><span class="line">1625</span><br><span class="line">1626</span><br><span class="line">1627</span><br><span class="line">1628</span><br><span class="line">1629</span><br><span class="line">1630</span><br><span class="line">1631</span><br><span class="line">1632</span><br><span class="line">1633</span><br><span class="line">1634</span><br><span class="line">1635</span><br><span class="line">1636</span><br><span class="line">1637</span><br><span class="line">1638</span><br><span class="line">1639</span><br><span class="line">1640</span><br><span class="line">1641</span><br><span class="line">1642</span><br><span class="line">1643</span><br><span class="line">1644</span><br><span class="line">1645</span><br><span class="line">1646</span><br><span class="line">1647</span><br><span class="line">1648</span><br><span class="line">1649</span><br><span class="line">1650</span><br><span class="line">1651</span><br><span class="line">1652</span><br><span class="line">1653</span><br><span class="line">1654</span><br><span class="line">1655</span><br><span class="line">1656</span><br><span class="line">1657</span><br><span class="line">1658</span><br><span class="line">1659</span><br><span class="line">1660</span><br><span class="line">1661</span><br><span class="line">1662</span><br><span class="line">1663</span><br><span class="line">1664</span><br><span class="line">1665</span><br><span class="line">1666</span><br><span class="line">1667</span><br><span class="line">1668</span><br><span class="line">1669</span><br><span class="line">1670</span><br><span class="line">1671</span><br><span class="line">1672</span><br><span class="line">1673</span><br><span class="line">1674</span><br><span class="line">1675</span><br><span class="line">1676</span><br><span class="line">1677</span><br><span class="line">1678</span><br><span class="line">1679</span><br><span class="line">1680</span><br><span class="line">1681</span><br><span class="line">1682</span><br><span class="line">1683</span><br><span class="line">1684</span><br><span class="line">1685</span><br><span class="line">1686</span><br><span class="line">1687</span><br><span class="line">1688</span><br><span class="line">1689</span><br><span class="line">1690</span><br><span class="line">1691</span><br><span class="line">1692</span><br><span class="line">1693</span><br><span class="line">1694</span><br><span class="line">1695</span><br><span class="line">1696</span><br><span class="line">1697</span><br><span class="line">1698</span><br><span class="line">1699</span><br><span class="line">1700</span><br><span class="line">1701</span><br><span class="line">1702</span><br><span class="line">1703</span><br><span class="line">1704</span><br><span class="line">1705</span><br><span class="line">1706</span><br><span class="line">1707</span><br><span class="line">1708</span><br><span class="line">1709</span><br><span class="line">1710</span><br><span class="line">1711</span><br><span class="line">1712</span><br><span class="line">1713</span><br><span class="line">1714</span><br><span class="line">1715</span><br><span class="line">1716</span><br><span class="line">1717</span><br><span class="line">1718</span><br><span class="line">1719</span><br><span class="line">1720</span><br><span class="line">1721</span><br><span class="line">1722</span><br><span class="line">1723</span><br><span class="line">1724</span><br><span class="line">1725</span><br><span class="line">1726</span><br><span class="line">1727</span><br><span class="line">1728</span><br><span class="line">1729</span><br><span class="line">1730</span><br><span class="line">1731</span><br><span class="line">1732</span><br><span class="line">1733</span><br><span class="line">1734</span><br><span class="line">1735</span><br><span class="line">1736</span><br><span class="line">1737</span><br><span class="line">1738</span><br><span class="line">1739</span><br><span class="line">1740</span><br><span class="line">1741</span><br><span class="line">1742</span><br><span class="line">1743</span><br><span class="line">1744</span><br><span class="line">1745</span><br><span class="line">1746</span><br><span class="line">1747</span><br><span class="line">1748</span><br><span class="line">1749</span><br><span class="line">1750</span><br><span class="line">1751</span><br><span class="line">1752</span><br><span class="line">1753</span><br><span class="line">1754</span><br><span class="line">1755</span><br><span class="line">1756</span><br><span class="line">1757</span><br><span class="line">1758</span><br><span class="line">1759</span><br><span class="line">1760</span><br><span class="line">1761</span><br><span class="line">1762</span><br><span class="line">1763</span><br><span class="line">1764</span><br><span class="line">1765</span><br><span class="line">1766</span><br><span class="line">1767</span><br><span class="line">1768</span><br><span class="line">1769</span><br><span class="line">1770</span><br><span class="line">1771</span><br><span class="line">1772</span><br><span class="line">1773</span><br><span class="line">1774</span><br><span class="line">1775</span><br><span class="line">1776</span><br><span class="line">1777</span><br><span class="line">1778</span><br><span class="line">1779</span><br><span class="line">1780</span><br><span class="line">1781</span><br><span class="line">1782</span><br><span class="line">1783</span><br><span class="line">1784</span><br><span class="line">1785</span><br><span class="line">1786</span><br><span class="line">1787</span><br><span class="line">1788</span><br><span class="line">1789</span><br><span class="line">1790</span><br><span class="line">1791</span><br><span class="line">1792</span><br><span class="line">1793</span><br><span class="line">1794</span><br><span class="line">1795</span><br><span class="line">1796</span><br><span class="line">1797</span><br><span class="line">1798</span><br><span class="line">1799</span><br><span class="line">1800</span><br><span class="line">1801</span><br><span class="line">1802</span><br><span class="line">1803</span><br><span class="line">1804</span><br><span class="line">1805</span><br><span class="line">1806</span><br><span class="line">1807</span><br><span class="line">1808</span><br><span class="line">1809</span><br><span class="line">1810</span><br><span class="line">1811</span><br><span class="line">1812</span><br><span class="line">1813</span><br><span class="line">1814</span><br><span class="line">1815</span><br><span class="line">1816</span><br><span class="line">1817</span><br><span class="line">1818</span><br><span class="line">1819</span><br><span class="line">1820</span><br><span class="line">1821</span><br><span class="line">1822</span><br><span class="line">1823</span><br><span class="line">1824</span><br><span class="line">1825</span><br><span class="line">1826</span><br><span class="line">1827</span><br><span class="line">1828</span><br><span class="line">1829</span><br><span class="line">1830</span><br><span class="line">1831</span><br><span class="line">1832</span><br><span class="line">1833</span><br><span class="line">1834</span><br><span class="line">1835</span><br><span class="line">1836</span><br><span class="line">1837</span><br><span class="line">1838</span><br><span class="line">1839</span><br><span class="line">1840</span><br><span class="line">1841</span><br><span class="line">1842</span><br><span class="line">1843</span><br><span class="line">1844</span><br><span class="line">1845</span><br><span class="line">1846</span><br><span class="line">1847</span><br><span class="line">1848</span><br><span class="line">1849</span><br><span class="line">1850</span><br><span class="line">1851</span><br><span class="line">1852</span><br><span class="line">1853</span><br><span class="line">1854</span><br><span class="line">1855</span><br><span class="line">1856</span><br><span class="line">1857</span><br><span class="line">1858</span><br><span class="line">1859</span><br><span class="line">1860</span><br><span class="line">1861</span><br><span class="line">1862</span><br><span class="line">1863</span><br><span class="line">1864</span><br><span class="line">1865</span><br><span class="line">1866</span><br><span class="line">1867</span><br><span class="line">1868</span><br><span class="line">1869</span><br><span class="line">1870</span><br><span class="line">1871</span><br><span class="line">1872</span><br><span class="line">1873</span><br><span class="line">1874</span><br><span class="line">1875</span><br><span class="line">1876</span><br><span class="line">1877</span><br><span class="line">1878</span><br><span class="line">1879</span><br><span class="line">1880</span><br><span class="line">1881</span><br><span class="line">1882</span><br><span class="line">1883</span><br><span class="line">1884</span><br><span class="line">1885</span><br><span class="line">1886</span><br><span class="line">1887</span><br><span class="line">1888</span><br><span class="line">1889</span><br><span class="line">1890</span><br><span class="line">1891</span><br><span class="line">1892</span><br><span class="line">1893</span><br><span class="line">1894</span><br><span class="line">1895</span><br><span class="line">1896</span><br><span class="line">1897</span><br><span class="line">1898</span><br><span class="line">1899</span><br><span class="line">1900</span><br><span class="line">1901</span><br><span class="line">1902</span><br><span class="line">1903</span><br><span class="line">1904</span><br><span class="line">1905</span><br><span class="line">1906</span><br><span class="line">1907</span><br><span class="line">1908</span><br><span class="line">1909</span><br><span class="line">1910</span><br><span class="line">1911</span><br><span class="line">1912</span><br><span class="line">1913</span><br><span class="line">1914</span><br><span class="line">1915</span><br><span class="line">1916</span><br><span class="line">1917</span><br><span class="line">1918</span><br><span class="line">1919</span><br><span class="line">1920</span><br><span class="line">1921</span><br><span class="line">1922</span><br><span class="line">1923</span><br><span class="line">1924</span><br><span class="line">1925</span><br><span class="line">1926</span><br><span class="line">1927</span><br><span class="line">1928</span><br><span class="line">1929</span><br><span class="line">1930</span><br><span class="line">1931</span><br><span class="line">1932</span><br><span class="line">1933</span><br><span class="line">1934</span><br><span class="line">1935</span><br><span class="line">1936</span><br><span class="line">1937</span><br><span class="line">1938</span><br><span class="line">1939</span><br><span class="line">1940</span><br><span class="line">1941</span><br><span class="line">1942</span><br><span class="line">1943</span><br><span class="line">1944</span><br><span class="line">1945</span><br><span class="line">1946</span><br><span class="line">1947</span><br><span class="line">1948</span><br><span class="line">1949</span><br><span class="line">1950</span><br><span class="line">1951</span><br><span class="line">1952</span><br><span class="line">1953</span><br><span class="line">1954</span><br><span class="line">1955</span><br><span class="line">1956</span><br><span class="line">1957</span><br><span class="line">1958</span><br><span class="line">1959</span><br><span class="line">1960</span><br><span class="line">1961</span><br><span class="line">1962</span><br><span class="line">1963</span><br><span class="line">1964</span><br><span class="line">1965</span><br><span class="line">1966</span><br><span class="line">1967</span><br><span class="line">1968</span><br><span class="line">1969</span><br><span class="line">1970</span><br><span class="line">1971</span><br><span class="line">1972</span><br><span class="line">1973</span><br><span class="line">1974</span><br><span class="line">1975</span><br><span class="line">1976</span><br><span class="line">1977</span><br><span class="line">1978</span><br><span class="line">1979</span><br><span class="line">1980</span><br><span class="line">1981</span><br><span class="line">1982</span><br><span class="line">1983</span><br><span class="line">1984</span><br><span class="line">1985</span><br><span class="line">1986</span><br><span class="line">1987</span><br><span class="line">1988</span><br><span class="line">1989</span><br><span class="line">1990</span><br><span class="line">1991</span><br><span class="line">1992</span><br><span class="line">1993</span><br><span class="line">1994</span><br><span class="line">1995</span><br><span class="line">1996</span><br><span class="line">1997</span><br><span class="line">1998</span><br><span class="line">1999</span><br><span class="line">2000</span><br><span class="line">2001</span><br><span class="line">2002</span><br><span class="line">2003</span><br><span class="line">2004</span><br><span class="line">2005</span><br><span class="line">2006</span><br><span class="line">2007</span><br><span class="line">2008</span><br><span class="line">2009</span><br><span class="line">2010</span><br><span class="line">2011</span><br><span class="line">2012</span><br><span class="line">2013</span><br><span class="line">2014</span><br><span class="line">2015</span><br><span class="line">2016</span><br><span class="line">2017</span><br><span class="line">2018</span><br><span class="line">2019</span><br><span class="line">2020</span><br><span class="line">2021</span><br><span class="line">2022</span><br><span class="line">2023</span><br><span class="line">2024</span><br><span class="line">2025</span><br><span class="line">2026</span><br><span class="line">2027</span><br><span class="line">2028</span><br><span class="line">2029</span><br><span class="line">2030</span><br><span class="line">2031</span><br><span class="line">2032</span><br><span class="line">2033</span><br><span class="line">2034</span><br><span class="line">2035</span><br><span class="line">2036</span><br><span class="line">2037</span><br><span class="line">2038</span><br><span class="line">2039</span><br><span class="line">2040</span><br><span class="line">2041</span><br><span class="line">2042</span><br><span class="line">2043</span><br><span class="line">2044</span><br><span class="line">2045</span><br><span class="line">2046</span><br><span class="line">2047</span><br><span class="line">2048</span><br><span class="line">2049</span><br><span class="line">2050</span><br><span class="line">2051</span><br><span class="line">2052</span><br><span class="line">2053</span><br><span class="line">2054</span><br><span class="line">2055</span><br><span class="line">2056</span><br><span class="line">2057</span><br><span class="line">2058</span><br><span class="line">2059</span><br><span class="line">2060</span><br><span class="line">2061</span><br><span class="line">2062</span><br><span class="line">2063</span><br><span class="line">2064</span><br><span class="line">2065</span><br><span class="line">2066</span><br><span class="line">2067</span><br><span class="line">2068</span><br><span class="line">2069</span><br><span class="line">2070</span><br><span class="line">2071</span><br><span class="line">2072</span><br><span class="line">2073</span><br><span class="line">2074</span><br><span class="line">2075</span><br><span class="line">2076</span><br><span class="line">2077</span><br><span class="line">2078</span><br><span class="line">2079</span><br><span class="line">2080</span><br><span class="line">2081</span><br><span class="line">2082</span><br><span class="line">2083</span><br><span class="line">2084</span><br><span class="line">2085</span><br><span class="line">2086</span><br><span class="line">2087</span><br><span class="line">2088</span><br><span class="line">2089</span><br><span class="line">2090</span><br><span class="line">2091</span><br><span class="line">2092</span><br><span class="line">2093</span><br><span class="line">2094</span><br><span class="line">2095</span><br><span class="line">2096</span><br><span class="line">2097</span><br><span class="line">2098</span><br><span class="line">2099</span><br><span class="line">2100</span><br><span class="line">2101</span><br><span class="line">2102</span><br><span class="line">2103</span><br><span class="line">2104</span><br><span class="line">2105</span><br><span class="line">2106</span><br><span class="line">2107</span><br><span class="line">2108</span><br><span class="line">2109</span><br><span class="line">2110</span><br><span class="line">2111</span><br><span class="line">2112</span><br><span class="line">2113</span><br><span class="line">2114</span><br><span class="line">2115</span><br><span class="line">2116</span><br><span class="line">2117</span><br><span class="line">2118</span><br><span class="line">2119</span><br><span class="line">2120</span><br><span class="line">2121</span><br><span class="line">2122</span><br><span class="line">2123</span><br><span class="line">2124</span><br><span class="line">2125</span><br><span class="line">2126</span><br><span class="line">2127</span><br><span class="line">2128</span><br><span class="line">2129</span><br><span class="line">2130</span><br><span class="line">2131</span><br><span class="line">2132</span><br><span class="line">2133</span><br><span class="line">2134</span><br><span class="line">2135</span><br><span class="line">2136</span><br><span class="line">2137</span><br><span class="line">2138</span><br><span class="line">2139</span><br><span class="line">2140</span><br><span class="line">2141</span><br><span class="line">2142</span><br><span class="line">2143</span><br><span class="line">2144</span><br><span class="line">2145</span><br><span class="line">2146</span><br><span class="line">2147</span><br><span class="line">2148</span><br><span class="line">2149</span><br><span class="line">2150</span><br><span class="line">2151</span><br><span class="line">2152</span><br><span class="line">2153</span><br><span class="line">2154</span><br><span class="line">2155</span><br><span class="line">2156</span><br><span class="line">2157</span><br><span class="line">2158</span><br><span class="line">2159</span><br><span class="line">2160</span><br><span class="line">2161</span><br><span class="line">2162</span><br><span class="line">2163</span><br><span class="line">2164</span><br><span class="line">2165</span><br><span class="line">2166</span><br><span class="line">2167</span><br><span class="line">2168</span><br><span class="line">2169</span><br><span class="line">2170</span><br><span class="line">2171</span><br><span class="line">2172</span><br><span class="line">2173</span><br><span class="line">2174</span><br><span class="line">2175</span><br><span class="line">2176</span><br><span class="line">2177</span><br><span class="line">2178</span><br><span class="line">2179</span><br><span class="line">2180</span><br><span class="line">2181</span><br><span class="line">2182</span><br><span class="line">2183</span><br><span class="line">2184</span><br><span class="line">2185</span><br><span class="line">2186</span><br><span class="line">2187</span><br><span class="line">2188</span><br><span class="line">2189</span><br><span class="line">2190</span><br><span class="line">2191</span><br><span class="line">2192</span><br><span class="line">2193</span><br><span class="line">2194</span><br><span class="line">2195</span><br><span class="line">2196</span><br><span class="line">2197</span><br><span class="line">2198</span><br><span class="line">2199</span><br><span class="line">2200</span><br><span class="line">2201</span><br><span class="line">2202</span><br><span class="line">2203</span><br><span class="line">2204</span><br><span class="line">2205</span><br><span class="line">2206</span><br><span class="line">2207</span><br><span class="line">2208</span><br><span class="line">2209</span><br><span class="line">2210</span><br><span class="line">2211</span><br><span class="line">2212</span><br><span class="line">2213</span><br><span class="line">2214</span><br><span class="line">2215</span><br><span class="line">2216</span><br><span class="line">2217</span><br><span class="line">2218</span><br><span class="line">2219</span><br><span class="line">2220</span><br><span class="line">2221</span><br><span class="line">2222</span><br><span class="line">2223</span><br><span class="line">2224</span><br><span class="line">2225</span><br><span class="line">2226</span><br><span class="line">2227</span><br><span class="line">2228</span><br><span class="line">2229</span><br><span class="line">2230</span><br><span class="line">2231</span><br><span class="line">2232</span><br><span class="line">2233</span><br><span class="line">2234</span><br><span class="line">2235</span><br><span class="line">2236</span><br><span class="line">2237</span><br><span class="line">2238</span><br><span class="line">2239</span><br><span class="line">2240</span><br><span class="line">2241</span><br><span class="line">2242</span><br><span class="line">2243</span><br><span class="line">2244</span><br><span class="line">2245</span><br><span class="line">2246</span><br><span class="line">2247</span><br><span class="line">2248</span><br><span class="line">2249</span><br><span class="line">2250</span><br><span class="line">2251</span><br><span class="line">2252</span><br><span class="line">2253</span><br><span class="line">2254</span><br><span class="line">2255</span><br><span class="line">2256</span><br><span class="line">2257</span><br><span class="line">2258</span><br><span class="line">2259</span><br><span class="line">2260</span><br><span class="line">2261</span><br><span class="line">2262</span><br><span class="line">2263</span><br><span class="line">2264</span><br><span class="line">2265</span><br><span class="line">2266</span><br><span class="line">2267</span><br><span class="line">2268</span><br><span class="line">2269</span><br><span class="line">2270</span><br><span class="line">2271</span><br><span class="line">2272</span><br><span class="line">2273</span><br><span class="line">2274</span><br><span class="line">2275</span><br><span class="line">2276</span><br><span class="line">2277</span><br><span class="line">2278</span><br><span class="line">2279</span><br><span class="line">2280</span><br><span class="line">2281</span><br><span class="line">2282</span><br><span class="line">2283</span><br><span class="line">2284</span><br><span class="line">2285</span><br><span class="line">2286</span><br><span class="line">2287</span><br><span class="line">2288</span><br><span class="line">2289</span><br><span class="line">2290</span><br><span class="line">2291</span><br><span class="line">2292</span><br><span class="line">2293</span><br><span class="line">2294</span><br><span class="line">2295</span><br><span class="line">2296</span><br><span class="line">2297</span><br><span class="line">2298</span><br><span class="line">2299</span><br><span class="line">2300</span><br><span class="line">2301</span><br><span class="line">2302</span><br><span class="line">2303</span><br><span class="line">2304</span><br><span class="line">2305</span><br><span class="line">2306</span><br><span class="line">2307</span><br><span class="line">2308</span><br><span class="line">2309</span><br><span class="line">2310</span><br><span class="line">2311</span><br><span class="line">2312</span><br><span class="line">2313</span><br><span class="line">2314</span><br><span class="line">2315</span><br><span class="line">2316</span><br><span class="line">2317</span><br><span class="line">2318</span><br><span class="line">2319</span><br><span class="line">2320</span><br><span class="line">2321</span><br><span class="line">2322</span><br><span class="line">2323</span><br><span class="line">2324</span><br><span class="line">2325</span><br><span class="line">2326</span><br><span class="line">2327</span><br><span class="line">2328</span><br><span class="line">2329</span><br><span class="line">2330</span><br><span class="line">2331</span><br><span class="line">2332</span><br><span class="line">2333</span><br><span class="line">2334</span><br><span class="line">2335</span><br><span class="line">2336</span><br><span class="line">2337</span><br><span class="line">2338</span><br><span class="line">2339</span><br><span class="line">2340</span><br><span class="line">2341</span><br><span class="line">2342</span><br><span class="line">2343</span><br><span class="line">2344</span><br><span class="line">2345</span><br><span class="line">2346</span><br><span class="line">2347</span><br><span class="line">2348</span><br><span class="line">2349</span><br><span class="line">2350</span><br><span class="line">2351</span><br><span class="line">2352</span><br><span class="line">2353</span><br><span class="line">2354</span><br><span class="line">2355</span><br><span class="line">2356</span><br><span class="line">2357</span><br><span class="line">2358</span><br><span class="line">2359</span><br><span class="line">2360</span><br><span class="line">2361</span><br><span class="line">2362</span><br><span class="line">2363</span><br><span class="line">2364</span><br><span class="line">2365</span><br><span class="line">2366</span><br><span class="line">2367</span><br><span class="line">2368</span><br><span class="line">2369</span><br><span class="line">2370</span><br><span class="line">2371</span><br><span class="line">2372</span><br><span class="line">2373</span><br><span class="line">2374</span><br><span class="line">2375</span><br><span class="line">2376</span><br><span class="line">2377</span><br><span class="line">2378</span><br><span class="line">2379</span><br><span class="line">2380</span><br><span class="line">2381</span><br><span class="line">2382</span><br><span class="line">2383</span><br><span class="line">2384</span><br><span class="line">2385</span><br><span class="line">2386</span><br><span class="line">2387</span><br><span class="line">2388</span><br><span class="line">2389</span><br><span class="line">2390</span><br><span class="line">2391</span><br><span class="line">2392</span><br><span class="line">2393</span><br><span class="line">2394</span><br><span class="line">2395</span><br><span class="line">2396</span><br><span class="line">2397</span><br><span class="line">2398</span><br><span class="line">2399</span><br><span class="line">2400</span><br><span class="line">2401</span><br><span class="line">2402</span><br><span class="line">2403</span><br><span class="line">2404</span><br><span class="line">2405</span><br><span class="line">2406</span><br><span class="line">2407</span><br><span class="line">2408</span><br><span class="line">2409</span><br><span class="line">2410</span><br><span class="line">2411</span><br><span class="line">2412</span><br><span class="line">2413</span><br><span class="line">2414</span><br><span class="line">2415</span><br><span class="line">2416</span><br><span class="line">2417</span><br><span class="line">2418</span><br><span class="line">2419</span><br><span class="line">2420</span><br><span class="line">2421</span><br><span class="line">2422</span><br><span class="line">2423</span><br><span class="line">2424</span><br><span class="line">2425</span><br><span class="line">2426</span><br><span class="line">2427</span><br><span class="line">2428</span><br><span class="line">2429</span><br><span class="line">2430</span><br><span class="line">2431</span><br><span class="line">2432</span><br><span class="line">2433</span><br><span class="line">2434</span><br><span class="line">2435</span><br><span class="line">2436</span><br><span class="line">2437</span><br><span class="line">2438</span><br><span class="line">2439</span><br><span class="line">2440</span><br><span class="line">2441</span><br><span class="line">2442</span><br><span class="line">2443</span><br><span class="line">2444</span><br><span class="line">2445</span><br><span class="line">2446</span><br><span class="line">2447</span><br><span class="line">2448</span><br><span class="line">2449</span><br><span class="line">2450</span><br><span class="line">2451</span><br><span class="line">2452</span><br><span class="line">2453</span><br><span class="line">2454</span><br><span class="line">2455</span><br><span class="line">2456</span><br><span class="line">2457</span><br><span class="line">2458</span><br><span class="line">2459</span><br><span class="line">2460</span><br><span class="line">2461</span><br><span class="line">2462</span><br><span class="line">2463</span><br><span class="line">2464</span><br><span class="line">2465</span><br><span class="line">2466</span><br><span class="line">2467</span><br><span class="line">2468</span><br><span class="line">2469</span><br><span class="line">2470</span><br><span class="line">2471</span><br><span class="line">2472</span><br><span class="line">2473</span><br><span class="line">2474</span><br><span class="line">2475</span><br><span class="line">2476</span><br><span class="line">2477</span><br><span class="line">2478</span><br><span class="line">2479</span><br><span class="line">2480</span><br><span class="line">2481</span><br><span class="line">2482</span><br><span class="line">2483</span><br><span class="line">2484</span><br><span class="line">2485</span><br><span class="line">2486</span><br><span class="line">2487</span><br><span class="line">2488</span><br><span class="line">2489</span><br><span class="line">2490</span><br><span class="line">2491</span><br><span class="line">2492</span><br><span class="line">2493</span><br><span class="line">2494</span><br><span class="line">2495</span><br><span class="line">2496</span><br><span class="line">2497</span><br><span class="line">2498</span><br><span class="line">2499</span><br><span class="line">2500</span><br><span class="line">2501</span><br><span class="line">2502</span><br><span class="line">2503</span><br><span class="line">2504</span><br><span class="line">2505</span><br><span class="line">2506</span><br><span class="line">2507</span><br><span class="line">2508</span><br><span class="line">2509</span><br><span class="line">2510</span><br><span class="line">2511</span><br><span class="line">2512</span><br><span class="line">2513</span><br><span class="line">2514</span><br><span class="line">2515</span><br><span class="line">2516</span><br><span class="line">2517</span><br><span class="line">2518</span><br><span class="line">2519</span><br><span class="line">2520</span><br><span class="line">2521</span><br><span class="line">2522</span><br><span class="line">2523</span><br><span class="line">2524</span><br><span class="line">2525</span><br><span class="line">2526</span><br><span class="line">2527</span><br><span class="line">2528</span><br><span class="line">2529</span><br><span class="line">2530</span><br><span class="line">2531</span><br><span class="line">2532</span><br><span class="line">2533</span><br><span class="line">2534</span><br><span class="line">2535</span><br><span class="line">2536</span><br><span class="line">2537</span><br><span class="line">2538</span><br><span class="line">2539</span><br><span class="line">2540</span><br><span class="line">2541</span><br><span class="line">2542</span><br><span class="line">2543</span><br><span class="line">2544</span><br><span class="line">2545</span><br><span class="line">2546</span><br><span class="line">2547</span><br><span class="line">2548</span><br><span class="line">2549</span><br><span class="line">2550</span><br><span class="line">2551</span><br><span class="line">2552</span><br><span class="line">2553</span><br><span class="line">2554</span><br><span class="line">2555</span><br><span class="line">2556</span><br><span class="line">2557</span><br><span class="line">2558</span><br><span class="line">2559</span><br><span class="line">2560</span><br><span class="line">2561</span><br><span class="line">2562</span><br><span class="line">2563</span><br><span class="line">2564</span><br><span class="line">2565</span><br><span class="line">2566</span><br><span class="line">2567</span><br><span class="line">2568</span><br><span class="line">2569</span><br><span class="line">2570</span><br><span class="line">2571</span><br><span class="line">2572</span><br><span class="line">2573</span><br><span class="line">2574</span><br><span class="line">2575</span><br><span class="line">2576</span><br><span class="line">2577</span><br><span class="line">2578</span><br><span class="line">2579</span><br><span class="line">2580</span><br><span class="line">2581</span><br><span class="line">2582</span><br><span class="line">2583</span><br><span class="line">2584</span><br><span class="line">2585</span><br><span class="line">2586</span><br><span class="line">2587</span><br><span class="line">2588</span><br><span class="line">2589</span><br><span class="line">2590</span><br><span class="line">2591</span><br><span class="line">2592</span><br><span class="line">2593</span><br><span class="line">2594</span><br><span class="line">2595</span><br><span class="line">2596</span><br><span class="line">2597</span><br><span class="line">2598</span><br><span class="line">2599</span><br><span class="line">2600</span><br><span class="line">2601</span><br><span class="line">2602</span><br><span class="line">2603</span><br><span class="line">2604</span><br><span class="line">2605</span><br><span class="line">2606</span><br><span class="line">2607</span><br><span class="line">2608</span><br><span class="line">2609</span><br><span class="line">2610</span><br><span class="line">2611</span><br><span class="line">2612</span><br><span class="line">2613</span><br><span class="line">2614</span><br><span class="line">2615</span><br><span class="line">2616</span><br><span class="line">2617</span><br><span class="line">2618</span><br><span class="line">2619</span><br><span class="line">2620</span><br><span class="line">2621</span><br><span class="line">2622</span><br><span class="line">2623</span><br><span class="line">2624</span><br><span class="line">2625</span><br><span class="line">2626</span><br><span class="line">2627</span><br><span class="line">2628</span><br><span class="line">2629</span><br><span class="line">2630</span><br><span class="line">2631</span><br><span class="line">2632</span><br><span class="line">2633</span><br><span class="line">2634</span><br><span class="line">2635</span><br><span class="line">2636</span><br><span class="line">2637</span><br><span class="line">2638</span><br><span class="line">2639</span><br><span class="line">2640</span><br><span class="line">2641</span><br><span class="line">2642</span><br><span class="line">2643</span><br><span class="line">2644</span><br><span class="line">2645</span><br><span class="line">2646</span><br><span class="line">2647</span><br><span class="line">2648</span><br><span class="line">2649</span><br><span class="line">2650</span><br><span class="line">2651</span><br><span class="line">2652</span><br><span class="line">2653</span><br><span class="line">2654</span><br><span class="line">2655</span><br><span class="line">2656</span><br><span class="line">2657</span><br><span class="line">2658</span><br><span class="line">2659</span><br><span class="line">2660</span><br><span class="line">2661</span><br><span class="line">2662</span><br><span class="line">2663</span><br><span class="line">2664</span><br><span class="line">2665</span><br><span class="line">2666</span><br><span class="line">2667</span><br><span class="line">2668</span><br><span class="line">2669</span><br><span class="line">2670</span><br><span class="line">2671</span><br><span class="line">2672</span><br><span class="line">2673</span><br><span class="line">2674</span><br><span class="line">2675</span><br><span class="line">2676</span><br><span class="line">2677</span><br><span class="line">2678</span><br><span class="line">2679</span><br><span class="line">2680</span><br><span class="line">2681</span><br><span class="line">2682</span><br><span class="line">2683</span><br><span class="line">2684</span><br><span class="line">2685</span><br><span class="line">2686</span><br><span class="line">2687</span><br><span class="line">2688</span><br><span class="line">2689</span><br><span class="line">2690</span><br><span class="line">2691</span><br><span class="line">2692</span><br><span class="line">2693</span><br><span class="line">2694</span><br><span class="line">2695</span><br><span class="line">2696</span><br><span class="line">2697</span><br><span class="line">2698</span><br><span class="line">2699</span><br><span class="line">2700</span><br><span class="line">2701</span><br><span class="line">2702</span><br><span class="line">2703</span><br><span class="line">2704</span><br><span class="line">2705</span><br><span class="line">2706</span><br><span class="line">2707</span><br><span class="line">2708</span><br><span class="line">2709</span><br><span class="line">2710</span><br><span class="line">2711</span><br><span class="line">2712</span><br><span class="line">2713</span><br><span class="line">2714</span><br><span class="line">2715</span><br><span class="line">2716</span><br><span class="line">2717</span><br><span class="line">2718</span><br><span class="line">2719</span><br><span class="line">2720</span><br><span class="line">2721</span><br><span class="line">2722</span><br><span class="line">2723</span><br><span class="line">2724</span><br><span class="line">2725</span><br><span class="line">2726</span><br><span class="line">2727</span><br><span class="line">2728</span><br><span class="line">2729</span><br><span class="line">2730</span><br><span class="line">2731</span><br><span class="line">2732</span><br><span class="line">2733</span><br><span class="line">2734</span><br><span class="line">2735</span><br><span class="line">2736</span><br><span class="line">2737</span><br><span class="line">2738</span><br><span class="line">2739</span><br><span class="line">2740</span><br><span class="line">2741</span><br><span class="line">2742</span><br><span class="line">2743</span><br><span class="line">2744</span><br><span class="line">2745</span><br><span class="line">2746</span><br><span class="line">2747</span><br><span class="line">2748</span><br><span class="line">2749</span><br><span class="line">2750</span><br><span class="line">2751</span><br><span class="line">2752</span><br><span class="line">2753</span><br><span class="line">2754</span><br><span class="line">2755</span><br><span class="line">2756</span><br><span class="line">2757</span><br><span class="line">2758</span><br><span class="line">2759</span><br><span class="line">2760</span><br><span class="line">2761</span><br><span class="line">2762</span><br><span class="line">2763</span><br><span class="line">2764</span><br><span class="line">2765</span><br><span class="line">2766</span><br><span class="line">2767</span><br><span class="line">2768</span><br><span class="line">2769</span><br><span class="line">2770</span><br><span class="line">2771</span><br><span class="line">2772</span><br><span class="line">2773</span><br><span class="line">2774</span><br><span class="line">2775</span><br><span class="line">2776</span><br><span class="line">2777</span><br><span class="line">2778</span><br><span class="line">2779</span><br><span class="line">2780</span><br><span class="line">2781</span><br><span class="line">2782</span><br><span class="line">2783</span><br><span class="line">2784</span><br><span class="line">2785</span><br><span class="line">2786</span><br><span class="line">2787</span><br><span class="line">2788</span><br><span class="line">2789</span><br><span class="line">2790</span><br><span class="line">2791</span><br><span class="line">2792</span><br><span class="line">2793</span><br><span class="line">2794</span><br><span class="line">2795</span><br><span class="line">2796</span><br><span class="line">2797</span><br><span class="line">2798</span><br><span class="line">2799</span><br><span class="line">2800</span><br><span class="line">2801</span><br><span class="line">2802</span><br><span class="line">2803</span><br><span class="line">2804</span><br><span class="line">2805</span><br><span class="line">2806</span><br><span class="line">2807</span><br><span class="line">2808</span><br><span class="line">2809</span><br><span class="line">2810</span><br><span class="line">2811</span><br><span class="line">2812</span><br><span class="line">2813</span><br><span class="line">2814</span><br><span class="line">2815</span><br><span class="line">2816</span><br><span class="line">2817</span><br><span class="line">2818</span><br><span class="line">2819</span><br><span class="line">2820</span><br><span class="line">2821</span><br><span class="line">2822</span><br><span class="line">2823</span><br><span class="line">2824</span><br><span class="line">2825</span><br><span class="line">2826</span><br><span class="line">2827</span><br><span class="line">2828</span><br><span class="line">2829</span><br><span class="line">2830</span><br><span class="line">2831</span><br><span class="line">2832</span><br><span class="line">2833</span><br><span class="line">2834</span><br><span class="line">2835</span><br><span class="line">2836</span><br><span class="line">2837</span><br><span class="line">2838</span><br><span class="line">2839</span><br><span class="line">2840</span><br><span class="line">2841</span><br><span class="line">2842</span><br><span class="line">2843</span><br><span class="line">2844</span><br><span class="line">2845</span><br><span class="line">2846</span><br><span class="line">2847</span><br><span class="line">2848</span><br><span class="line">2849</span><br><span class="line">2850</span><br><span class="line">2851</span><br><span class="line">2852</span><br><span class="line">2853</span><br><span class="line">2854</span><br><span class="line">2855</span><br><span class="line">2856</span><br><span class="line">2857</span><br><span class="line">2858</span><br><span class="line">2859</span><br><span class="line">2860</span><br><span class="line">2861</span><br><span class="line">2862</span><br><span class="line">2863</span><br><span class="line">2864</span><br><span class="line">2865</span><br><span class="line">2866</span><br><span class="line">2867</span><br><span class="line">2868</span><br><span class="line">2869</span><br><span class="line">2870</span><br><span class="line">2871</span><br><span class="line">2872</span><br><span class="line">2873</span><br><span class="line">2874</span><br><span class="line">2875</span><br><span class="line">2876</span><br><span class="line">2877</span><br><span class="line">2878</span><br><span class="line">2879</span><br><span class="line">2880</span><br><span class="line">2881</span><br><span class="line">2882</span><br><span class="line">2883</span><br><span class="line">2884</span><br><span class="line">2885</span><br><span class="line">2886</span><br><span class="line">2887</span><br><span class="line">2888</span><br><span class="line">2889</span><br><span class="line">2890</span><br><span class="line">2891</span><br><span class="line">2892</span><br><span class="line">2893</span><br><span class="line">2894</span><br><span class="line">2895</span><br><span class="line">2896</span><br><span class="line">2897</span><br><span class="line">2898</span><br><span class="line">2899</span><br><span class="line">2900</span><br><span class="line">2901</span><br><span class="line">2902</span><br><span class="line">2903</span><br><span class="line">2904</span><br><span class="line">2905</span><br><span class="line">2906</span><br><span class="line">2907</span><br><span class="line">2908</span><br><span class="line">2909</span><br><span class="line">2910</span><br><span class="line">2911</span><br><span class="line">2912</span><br><span class="line">2913</span><br><span class="line">2914</span><br><span class="line">2915</span><br><span class="line">2916</span><br><span class="line">2917</span><br><span class="line">2918</span><br><span class="line">2919</span><br><span class="line">2920</span><br><span class="line">2921</span><br><span class="line">2922</span><br><span class="line">2923</span><br><span class="line">2924</span><br><span class="line">2925</span><br><span class="line">2926</span><br><span class="line">2927</span><br><span class="line">2928</span><br><span class="line">2929</span><br><span class="line">2930</span><br><span class="line">2931</span><br><span class="line">2932</span><br><span class="line">2933</span><br><span class="line">2934</span><br><span class="line">2935</span><br><span class="line">2936</span><br><span class="line">2937</span><br><span class="line">2938</span><br><span class="line">2939</span><br><span class="line">2940</span><br><span class="line">2941</span><br><span class="line">2942</span><br><span class="line">2943</span><br><span class="line">2944</span><br><span class="line">2945</span><br><span class="line">2946</span><br><span class="line">2947</span><br><span class="line">2948</span><br><span class="line">2949</span><br><span class="line">2950</span><br><span class="line">2951</span><br><span class="line">2952</span><br><span class="line">2953</span><br><span class="line">2954</span><br><span class="line">2955</span><br><span class="line">2956</span><br><span class="line">2957</span><br><span class="line">2958</span><br><span class="line">2959</span><br><span class="line">2960</span><br><span class="line">2961</span><br><span class="line">2962</span><br><span class="line">2963</span><br><span class="line">2964</span><br><span class="line">2965</span><br><span class="line">2966</span><br><span class="line">2967</span><br><span class="line">2968</span><br><span class="line">2969</span><br><span class="line">2970</span><br><span class="line">2971</span><br><span class="line">2972</span><br><span class="line">2973</span><br><span class="line">2974</span><br><span class="line">2975</span><br><span class="line">2976</span><br><span class="line">2977</span><br><span class="line">2978</span><br><span class="line">2979</span><br><span class="line">2980</span><br><span class="line">2981</span><br><span class="line">2982</span><br><span class="line">2983</span><br><span class="line">2984</span><br><span class="line">2985</span><br><span class="line">2986</span><br><span class="line">2987</span><br><span class="line">2988</span><br><span class="line">2989</span><br><span class="line">2990</span><br><span class="line">2991</span><br><span class="line">2992</span><br><span class="line">2993</span><br><span class="line">2994</span><br><span class="line">2995</span><br><span class="line">2996</span><br><span class="line">2997</span><br><span class="line">2998</span><br><span class="line">2999</span><br><span class="line">3000</span><br><span class="line">3001</span><br><span class="line">3002</span><br><span class="line">3003</span><br><span class="line">3004</span><br><span class="line">3005</span><br><span class="line">3006</span><br><span class="line">3007</span><br><span class="line">3008</span><br><span class="line">3009</span><br><span class="line">3010</span><br><span class="line">3011</span><br><span class="line">3012</span><br><span class="line">3013</span><br><span class="line">3014</span><br><span class="line">3015</span><br><span class="line">3016</span><br><span class="line">3017</span><br><span class="line">3018</span><br><span class="line">3019</span><br><span class="line">3020</span><br><span class="line">3021</span><br><span class="line">3022</span><br><span class="line">3023</span><br><span class="line">3024</span><br><span class="line">3025</span><br><span class="line">3026</span><br><span class="line">3027</span><br><span class="line">3028</span><br><span class="line">3029</span><br><span class="line">3030</span><br><span class="line">3031</span><br><span class="line">3032</span><br><span class="line">3033</span><br><span class="line">3034</span><br><span class="line">3035</span><br><span class="line">3036</span><br><span class="line">3037</span><br><span class="line">3038</span><br><span class="line">3039</span><br><span class="line">3040</span><br><span class="line">3041</span><br><span class="line">3042</span><br><span class="line">3043</span><br><span class="line">3044</span><br><span class="line">3045</span><br><span class="line">3046</span><br><span class="line">3047</span><br><span class="line">3048</span><br><span class="line">3049</span><br><span class="line">3050</span><br><span class="line">3051</span><br><span class="line">3052</span><br><span class="line">3053</span><br><span class="line">3054</span><br><span class="line">3055</span><br><span class="line">3056</span><br><span class="line">3057</span><br><span class="line">3058</span><br><span class="line">3059</span><br><span class="line">3060</span><br><span class="line">3061</span><br><span class="line">3062</span><br><span class="line">3063</span><br><span class="line">3064</span><br><span class="line">3065</span><br><span class="line">3066</span><br><span class="line">3067</span><br><span class="line">3068</span><br><span class="line">3069</span><br><span class="line">3070</span><br><span class="line">3071</span><br><span class="line">3072</span><br><span class="line">3073</span><br><span class="line">3074</span><br><span class="line">3075</span><br><span class="line">3076</span><br><span class="line">3077</span><br><span class="line">3078</span><br><span class="line">3079</span><br><span class="line">3080</span><br><span class="line">3081</span><br><span class="line">3082</span><br><span class="line">3083</span><br><span class="line">3084</span><br><span class="line">3085</span><br><span class="line">3086</span><br><span class="line">3087</span><br><span class="line">3088</span><br><span class="line">3089</span><br><span class="line">3090</span><br><span class="line">3091</span><br><span class="line">3092</span><br><span class="line">3093</span><br><span class="line">3094</span><br><span class="line">3095</span><br><span class="line">3096</span><br><span class="line">3097</span><br><span class="line">3098</span><br><span class="line">3099</span><br><span class="line">3100</span><br><span class="line">3101</span><br><span class="line">3102</span><br><span class="line">3103</span><br><span class="line">3104</span><br><span class="line">3105</span><br><span class="line">3106</span><br><span class="line">3107</span><br><span class="line">3108</span><br><span class="line">3109</span><br><span class="line">3110</span><br><span class="line">3111</span><br><span class="line">3112</span><br><span class="line">3113</span><br><span class="line">3114</span><br><span class="line">3115</span><br><span class="line">3116</span><br><span class="line">3117</span><br><span class="line">3118</span><br><span class="line">3119</span><br><span class="line">3120</span><br><span class="line">3121</span><br><span class="line">3122</span><br><span class="line">3123</span><br><span class="line">3124</span><br><span class="line">3125</span><br><span class="line">3126</span><br><span class="line">3127</span><br><span class="line">3128</span><br><span class="line">3129</span><br><span class="line">3130</span><br><span class="line">3131</span><br><span class="line">3132</span><br><span class="line">3133</span><br><span class="line">3134</span><br><span class="line">3135</span><br><span class="line">3136</span><br><span class="line">3137</span><br><span class="line">3138</span><br><span class="line">3139</span><br><span class="line">3140</span><br><span class="line">3141</span><br><span class="line">3142</span><br><span class="line">3143</span><br><span class="line">3144</span><br><span class="line">3145</span><br><span class="line">3146</span><br><span class="line">3147</span><br><span class="line">3148</span><br><span class="line">3149</span><br><span class="line">3150</span><br><span class="line">3151</span><br><span class="line">3152</span><br><span class="line">3153</span><br><span class="line">3154</span><br><span class="line">3155</span><br><span class="line">3156</span><br><span class="line">3157</span><br><span class="line">3158</span><br><span class="line">3159</span><br><span class="line">3160</span><br><span class="line">3161</span><br><span class="line">3162</span><br><span class="line">3163</span><br><span class="line">3164</span><br><span class="line">3165</span><br><span class="line">3166</span><br><span class="line">3167</span><br><span class="line">3168</span><br><span class="line">3169</span><br><span class="line">3170</span><br><span class="line">3171</span><br><span class="line">3172</span><br><span class="line">3173</span><br><span class="line">3174</span><br><span class="line">3175</span><br><span class="line">3176</span><br><span class="line">3177</span><br><span class="line">3178</span><br><span class="line">3179</span><br><span class="line">3180</span><br><span class="line">3181</span><br><span class="line">3182</span><br><span class="line">3183</span><br><span class="line">3184</span><br><span class="line">3185</span><br><span class="line">3186</span><br><span class="line">3187</span><br><span class="line">3188</span><br><span class="line">3189</span><br><span class="line">3190</span><br><span class="line">3191</span><br><span class="line">3192</span><br><span class="line">3193</span><br><span class="line">3194</span><br><span class="line">3195</span><br><span class="line">3196</span><br><span class="line">3197</span><br><span class="line">3198</span><br><span class="line">3199</span><br><span class="line">3200</span><br><span class="line">3201</span><br><span class="line">3202</span><br><span class="line">3203</span><br><span class="line">3204</span><br><span class="line">3205</span><br><span class="line">3206</span><br><span class="line">3207</span><br><span class="line">3208</span><br><span class="line">3209</span><br><span class="line">3210</span><br><span class="line">3211</span><br><span class="line">3212</span><br><span class="line">3213</span><br><span class="line">3214</span><br><span class="line">3215</span><br><span class="line">3216</span><br><span class="line">3217</span><br><span class="line">3218</span><br><span class="line">3219</span><br><span class="line">3220</span><br><span class="line">3221</span><br><span class="line">3222</span><br><span class="line">3223</span><br><span class="line">3224</span><br><span class="line">3225</span><br><span class="line">3226</span><br><span class="line">3227</span><br><span class="line">3228</span><br><span class="line">3229</span><br><span class="line">3230</span><br><span class="line">3231</span><br><span class="line">3232</span><br><span class="line">3233</span><br><span class="line">3234</span><br><span class="line">3235</span><br><span class="line">3236</span><br><span class="line">3237</span><br><span class="line">3238</span><br><span class="line">3239</span><br><span class="line">3240</span><br><span class="line">3241</span><br><span class="line">3242</span><br><span class="line">3243</span><br><span class="line">3244</span><br><span class="line">3245</span><br><span class="line">3246</span><br><span class="line">3247</span><br><span class="line">3248</span><br><span class="line">3249</span><br><span class="line">3250</span><br><span class="line">3251</span><br><span class="line">3252</span><br><span class="line">3253</span><br><span class="line">3254</span><br><span class="line">3255</span><br><span class="line">3256</span><br><span class="line">3257</span><br><span class="line">3258</span><br><span class="line">3259</span><br><span class="line">3260</span><br><span class="line">3261</span><br><span class="line">3262</span><br><span class="line">3263</span><br><span class="line">3264</span><br><span class="line">3265</span><br><span class="line">3266</span><br><span class="line">3267</span><br><span class="line">3268</span><br><span class="line">3269</span><br><span class="line">3270</span><br><span class="line">3271</span><br><span class="line">3272</span><br><span class="line">3273</span><br><span class="line">3274</span><br><span class="line">3275</span><br><span class="line">3276</span><br><span class="line">3277</span><br><span class="line">3278</span><br><span class="line">3279</span><br><span class="line">3280</span><br><span class="line">3281</span><br><span class="line">3282</span><br><span class="line">3283</span><br><span class="line">3284</span><br><span class="line">3285</span><br><span class="line">3286</span><br><span class="line">3287</span><br><span class="line">3288</span><br><span class="line">3289</span><br><span class="line">3290</span><br><span class="line">3291</span><br><span class="line">3292</span><br><span class="line">3293</span><br><span class="line">3294</span><br><span class="line">3295</span><br><span class="line">3296</span><br><span class="line">3297</span><br><span class="line">3298</span><br><span class="line">3299</span><br><span class="line">3300</span><br><span class="line">3301</span><br><span class="line">3302</span><br><span class="line">3303</span><br><span class="line">3304</span><br><span class="line">3305</span><br><span class="line">3306</span><br><span class="line">3307</span><br><span class="line">3308</span><br><span class="line">3309</span><br><span class="line">3310</span><br><span class="line">3311</span><br><span class="line">3312</span><br><span class="line">3313</span><br><span class="line">3314</span><br><span class="line">3315</span><br><span class="line">3316</span><br><span class="line">3317</span><br><span class="line">3318</span><br><span class="line">3319</span><br><span class="line">3320</span><br><span class="line">3321</span><br><span class="line">3322</span><br><span class="line">3323</span><br><span class="line">3324</span><br><span class="line">3325</span><br><span class="line">3326</span><br><span class="line">3327</span><br><span class="line">3328</span><br><span class="line">3329</span><br><span class="line">3330</span><br><span class="line">3331</span><br><span class="line">3332</span><br><span class="line">3333</span><br><span class="line">3334</span><br><span class="line">3335</span><br><span class="line">3336</span><br><span class="line">3337</span><br><span class="line">3338</span><br><span class="line">3339</span><br><span class="line">3340</span><br><span class="line">3341</span><br><span class="line">3342</span><br><span class="line">3343</span><br><span class="line">3344</span><br><span class="line">3345</span><br><span class="line">3346</span><br><span class="line">3347</span><br><span class="line">3348</span><br><span class="line">3349</span><br><span class="line">3350</span><br><span class="line">3351</span><br><span class="line">3352</span><br><span class="line">3353</span><br><span class="line">3354</span><br><span class="line">3355</span><br><span class="line">3356</span><br><span class="line">3357</span><br><span class="line">3358</span><br><span class="line">3359</span><br><span class="line">3360</span><br><span class="line">3361</span><br><span class="line">3362</span><br><span class="line">3363</span><br><span class="line">3364</span><br><span class="line">3365</span><br><span class="line">3366</span><br><span class="line">3367</span><br><span class="line">3368</span><br><span class="line">3369</span><br><span class="line">3370</span><br><span class="line">3371</span><br><span class="line">3372</span><br><span class="line">3373</span><br><span class="line">3374</span><br><span class="line">3375</span><br><span class="line">3376</span><br><span class="line">3377</span><br><span class="line">3378</span><br><span class="line">3379</span><br><span class="line">3380</span><br><span class="line">3381</span><br><span class="line">3382</span><br><span class="line">3383</span><br><span class="line">3384</span><br><span class="line">3385</span><br><span class="line">3386</span><br><span class="line">3387</span><br><span class="line">3388</span><br><span class="line">3389</span><br><span class="line">3390</span><br><span class="line">3391</span><br><span class="line">3392</span><br><span class="line">3393</span><br><span class="line">3394</span><br><span class="line">3395</span><br><span class="line">3396</span><br><span class="line">3397</span><br><span class="line">3398</span><br><span class="line">3399</span><br><span class="line">3400</span><br><span class="line">3401</span><br><span class="line">3402</span><br><span class="line">3403</span><br><span class="line">3404</span><br><span class="line">3405</span><br><span class="line">3406</span><br><span class="line">3407</span><br><span class="line">3408</span><br><span class="line">3409</span><br><span class="line">3410</span><br><span class="line">3411</span><br><span class="line">3412</span><br><span class="line">3413</span><br><span class="line">3414</span><br><span class="line">3415</span><br><span class="line">3416</span><br><span class="line">3417</span><br><span class="line">3418</span><br><span class="line">3419</span><br><span class="line">3420</span><br><span class="line">3421</span><br><span class="line">3422</span><br><span class="line">3423</span><br><span class="line">3424</span><br><span class="line">3425</span><br><span class="line">3426</span><br><span class="line">3427</span><br><span class="line">3428</span><br><span class="line">3429</span><br><span class="line">3430</span><br><span class="line">3431</span><br><span class="line">3432</span><br><span class="line">3433</span><br><span class="line">3434</span><br><span class="line">3435</span><br><span class="line">3436</span><br><span class="line">3437</span><br><span class="line">3438</span><br><span class="line">3439</span><br><span class="line">3440</span><br><span class="line">3441</span><br><span class="line">3442</span><br><span class="line">3443</span><br><span class="line">3444</span><br><span class="line">3445</span><br><span class="line">3446</span><br><span class="line">3447</span><br><span class="line">3448</span><br><span class="line">3449</span><br><span class="line">3450</span><br><span class="line">3451</span><br><span class="line">3452</span><br><span class="line">3453</span><br><span class="line">3454</span><br><span class="line">3455</span><br><span class="line">3456</span><br><span class="line">3457</span><br><span class="line">3458</span><br><span class="line">3459</span><br><span class="line">3460</span><br><span class="line">3461</span><br><span class="line">3462</span><br><span class="line">3463</span><br><span class="line">3464</span><br><span class="line">3465</span><br><span class="line">3466</span><br><span class="line">3467</span><br><span class="line">3468</span><br><span class="line">3469</span><br><span class="line">3470</span><br><span class="line">3471</span><br><span class="line">3472</span><br><span class="line">3473</span><br><span class="line">3474</span><br><span class="line">3475</span><br><span class="line">3476</span><br><span class="line">3477</span><br><span class="line">3478</span><br><span class="line">3479</span><br><span class="line">3480</span><br><span class="line">3481</span><br><span class="line">3482</span><br><span class="line">3483</span><br><span class="line">3484</span><br><span class="line">3485</span><br><span class="line">3486</span><br><span class="line">3487</span><br><span class="line">3488</span><br><span class="line">3489</span><br><span class="line">3490</span><br><span class="line">3491</span><br><span class="line">3492</span><br><span class="line">3493</span><br><span class="line">3494</span><br><span class="line">3495</span><br><span class="line">3496</span><br><span class="line">3497</span><br><span class="line">3498</span><br><span class="line">3499</span><br><span class="line">3500</span><br><span class="line">3501</span><br><span class="line">3502</span><br><span class="line">3503</span><br><span class="line">3504</span><br><span class="line">3505</span><br><span class="line">3506</span><br><span class="line">3507</span><br><span class="line">3508</span><br><span class="line">3509</span><br><span class="line">3510</span><br><span class="line">3511</span><br><span class="line">3512</span><br><span class="line">3513</span><br><span class="line">3514</span><br><span class="line">3515</span><br><span class="line">3516</span><br><span class="line">3517</span><br><span class="line">3518</span><br><span class="line">3519</span><br><span class="line">3520</span><br><span class="line">3521</span><br><span class="line">3522</span><br><span class="line">3523</span><br><span class="line">3524</span><br><span class="line">3525</span><br><span class="line">3526</span><br><span class="line">3527</span><br><span class="line">3528</span><br><span class="line">3529</span><br><span class="line">3530</span><br><span class="line">3531</span><br><span class="line">3532</span><br><span class="line">3533</span><br><span class="line">3534</span><br><span class="line">3535</span><br><span class="line">3536</span><br><span class="line">3537</span><br><span class="line">3538</span><br><span class="line">3539</span><br><span class="line">3540</span><br><span class="line">3541</span><br><span class="line">3542</span><br><span class="line">3543</span><br><span class="line">3544</span><br><span class="line">3545</span><br><span class="line">3546</span><br><span class="line">3547</span><br><span class="line">3548</span><br><span class="line">3549</span><br><span class="line">3550</span><br><span class="line">3551</span><br><span class="line">3552</span><br><span class="line">3553</span><br><span class="line">3554</span><br><span class="line">3555</span><br><span class="line">3556</span><br><span class="line">3557</span><br><span class="line">3558</span><br><span class="line">3559</span><br><span class="line">3560</span><br><span class="line">3561</span><br><span class="line">3562</span><br><span class="line">3563</span><br><span class="line">3564</span><br><span class="line">3565</span><br><span class="line">3566</span><br><span class="line">3567</span><br><span class="line">3568</span><br><span class="line">3569</span><br><span class="line">3570</span><br><span class="line">3571</span><br><span class="line">3572</span><br><span class="line">3573</span><br><span class="line">3574</span><br><span class="line">3575</span><br><span class="line">3576</span><br><span class="line">3577</span><br><span class="line">3578</span><br><span class="line">3579</span><br><span class="line">3580</span><br><span class="line">3581</span><br><span class="line">3582</span><br><span class="line">3583</span><br><span class="line">3584</span><br><span class="line">3585</span><br><span class="line">3586</span><br><span class="line">3587</span><br><span class="line">3588</span><br><span class="line">3589</span><br><span class="line">3590</span><br><span class="line">3591</span><br><span class="line">3592</span><br><span class="line">3593</span><br><span class="line">3594</span><br><span class="line">3595</span><br><span class="line">3596</span><br><span class="line">3597</span><br><span class="line">3598</span><br><span class="line">3599</span><br><span class="line">3600</span><br><span class="line">3601</span><br><span class="line">3602</span><br><span class="line">3603</span><br><span class="line">3604</span><br><span class="line">3605</span><br><span class="line">3606</span><br><span class="line">3607</span><br><span class="line">3608</span><br><span class="line">3609</span><br><span class="line">3610</span><br><span class="line">3611</span><br><span class="line">3612</span><br><span class="line">3613</span><br><span class="line">3614</span><br><span class="line">3615</span><br><span class="line">3616</span><br><span class="line">3617</span><br><span class="line">3618</span><br><span class="line">3619</span><br><span class="line">3620</span><br><span class="line">3621</span><br><span class="line">3622</span><br><span class="line">3623</span><br><span class="line">3624</span><br><span class="line">3625</span><br><span class="line">3626</span><br><span class="line">3627</span><br><span class="line">3628</span><br><span class="line">3629</span><br><span class="line">3630</span><br><span class="line">3631</span><br><span class="line">3632</span><br><span class="line">3633</span><br><span class="line">3634</span><br><span class="line">3635</span><br><span class="line">3636</span><br><span class="line">3637</span><br><span class="line">3638</span><br><span class="line">3639</span><br><span class="line">3640</span><br><span class="line">3641</span><br><span class="line">3642</span><br><span class="line">3643</span><br><span class="line">3644</span><br><span class="line">3645</span><br><span class="line">3646</span><br><span class="line">3647</span><br><span class="line">3648</span><br><span class="line">3649</span><br><span class="line">3650</span><br><span class="line">3651</span><br><span class="line">3652</span><br><span class="line">3653</span><br><span class="line">3654</span><br><span class="line">3655</span><br><span class="line">3656</span><br><span class="line">3657</span><br><span class="line">3658</span><br><span class="line">3659</span><br><span class="line">3660</span><br><span class="line">3661</span><br><span class="line">3662</span><br><span class="line">3663</span><br><span class="line">3664</span><br><span class="line">3665</span><br><span class="line">3666</span><br><span class="line">3667</span><br><span class="line">3668</span><br><span class="line">3669</span><br><span class="line">3670</span><br><span class="line">3671</span><br><span class="line">3672</span><br><span class="line">3673</span><br><span class="line">3674</span><br><span class="line">3675</span><br><span class="line">3676</span><br><span class="line">3677</span><br><span class="line">3678</span><br><span class="line">3679</span><br><span class="line">3680</span><br><span class="line">3681</span><br><span class="line">3682</span><br><span class="line">3683</span><br><span class="line">3684</span><br><span class="line">3685</span><br><span class="line">3686</span><br><span class="line">3687</span><br><span class="line">3688</span><br><span class="line">3689</span><br><span class="line">3690</span><br><span class="line">3691</span><br><span class="line">3692</span><br><span class="line">3693</span><br><span class="line">3694</span><br><span class="line">3695</span><br><span class="line">3696</span><br><span class="line">3697</span><br><span class="line">3698</span><br><span class="line">3699</span><br><span class="line">3700</span><br><span class="line">3701</span><br><span class="line">3702</span><br><span class="line">3703</span><br><span class="line">3704</span><br><span class="line">3705</span><br><span class="line">3706</span><br><span class="line">3707</span><br><span class="line">3708</span><br><span class="line">3709</span><br><span class="line">3710</span><br><span class="line">3711</span><br><span class="line">3712</span><br><span class="line">3713</span><br><span class="line">3714</span><br><span class="line">3715</span><br><span class="line">3716</span><br><span class="line">3717</span><br><span class="line">3718</span><br><span class="line">3719</span><br><span class="line">3720</span><br><span class="line">3721</span><br><span class="line">3722</span><br><span class="line">3723</span><br><span class="line">3724</span><br><span class="line">3725</span><br><span class="line">3726</span><br><span class="line">3727</span><br><span class="line">3728</span><br><span class="line">3729</span><br><span class="line">3730</span><br><span class="line">3731</span><br><span class="line">3732</span><br><span class="line">3733</span><br><span class="line">3734</span><br><span class="line">3735</span><br><span class="line">3736</span><br><span class="line">3737</span><br><span class="line">3738</span><br><span class="line">3739</span><br><span class="line">3740</span><br><span class="line">3741</span><br><span class="line">3742</span><br><span class="line">3743</span><br><span class="line">3744</span><br><span class="line">3745</span><br><span class="line">3746</span><br><span class="line">3747</span><br><span class="line">3748</span><br><span class="line">3749</span><br><span class="line">3750</span><br><span class="line">3751</span><br><span class="line">3752</span><br><span class="line">3753</span><br><span class="line">3754</span><br><span class="line">3755</span><br><span class="line">3756</span><br><span class="line">3757</span><br><span class="line">3758</span><br><span class="line">3759</span><br><span class="line">3760</span><br><span class="line">3761</span><br><span class="line">3762</span><br><span class="line">3763</span><br><span class="line">3764</span><br><span class="line">3765</span><br><span class="line">3766</span><br><span class="line">3767</span><br><span class="line">3768</span><br><span class="line">3769</span><br><span class="line">3770</span><br><span class="line">3771</span><br><span class="line">3772</span><br><span class="line">3773</span><br><span class="line">3774</span><br><span class="line">3775</span><br><span class="line">3776</span><br><span class="line">3777</span><br><span class="line">3778</span><br><span class="line">3779</span><br><span class="line">3780</span><br><span class="line">3781</span><br><span class="line">3782</span><br><span class="line">3783</span><br><span class="line">3784</span><br><span class="line">3785</span><br><span class="line">3786</span><br><span class="line">3787</span><br><span class="line">3788</span><br><span class="line">3789</span><br><span class="line">3790</span><br><span class="line">3791</span><br><span class="line">3792</span><br><span class="line">3793</span><br><span class="line">3794</span><br><span class="line">3795</span><br><span class="line">3796</span><br><span class="line">3797</span><br><span class="line">3798</span><br><span class="line">3799</span><br><span class="line">3800</span><br><span class="line">3801</span><br><span class="line">3802</span><br><span class="line">3803</span><br><span class="line">3804</span><br><span class="line">3805</span><br><span class="line">3806</span><br><span class="line">3807</span><br><span class="line">3808</span><br><span class="line">3809</span><br><span class="line">3810</span><br><span class="line">3811</span><br><span class="line">3812</span><br><span class="line">3813</span><br><span class="line">3814</span><br><span class="line">3815</span><br><span class="line">3816</span><br><span class="line">3817</span><br><span class="line">3818</span><br><span class="line">3819</span><br><span class="line">3820</span><br><span class="line">3821</span><br><span class="line">3822</span><br><span class="line">3823</span><br><span class="line">3824</span><br><span class="line">3825</span><br><span class="line">3826</span><br><span class="line">3827</span><br><span class="line">3828</span><br><span class="line">3829</span><br><span class="line">3830</span><br><span class="line">3831</span><br><span class="line">3832</span><br><span class="line">3833</span><br><span class="line">3834</span><br><span class="line">3835</span><br><span class="line">3836</span><br><span class="line">3837</span><br><span class="line">3838</span><br><span class="line">3839</span><br><span class="line">3840</span><br><span class="line">3841</span><br><span class="line">3842</span><br><span class="line">3843</span><br><span class="line">3844</span><br><span class="line">3845</span><br><span class="line">3846</span><br><span class="line">3847</span><br><span class="line">3848</span><br><span class="line">3849</span><br><span class="line">3850</span><br><span class="line">3851</span><br><span class="line">3852</span><br><span class="line">3853</span><br><span class="line">3854</span><br><span class="line">3855</span><br><span class="line">3856</span><br><span class="line">3857</span><br><span class="line">3858</span><br><span class="line">3859</span><br><span class="line">3860</span><br><span class="line">3861</span><br><span class="line">3862</span><br><span class="line">3863</span><br><span class="line">3864</span><br><span class="line">3865</span><br><span class="line">3866</span><br><span class="line">3867</span><br><span class="line">3868</span><br><span class="line">3869</span><br><span class="line">3870</span><br><span class="line">3871</span><br><span class="line">3872</span><br><span class="line">3873</span><br><span class="line">3874</span><br><span class="line">3875</span><br><span class="line">3876</span><br><span class="line">3877</span><br><span class="line">3878</span><br><span class="line">3879</span><br><span class="line">3880</span><br><span class="line">3881</span><br><span class="line">3882</span><br><span class="line">3883</span><br><span class="line">3884</span><br><span class="line">3885</span><br><span class="line">3886</span><br><span class="line">3887</span><br><span class="line">3888</span><br><span class="line">3889</span><br><span class="line">3890</span><br><span class="line">3891</span><br><span class="line">3892</span><br><span class="line">3893</span><br><span class="line">3894</span><br><span class="line">3895</span><br><span class="line">3896</span><br><span class="line">3897</span><br><span class="line">3898</span><br><span class="line">3899</span><br><span class="line">3900</span><br><span class="line">3901</span><br><span class="line">3902</span><br><span class="line">3903</span><br><span class="line">3904</span><br><span class="line">3905</span><br><span class="line">3906</span><br><span class="line">3907</span><br><span class="line">3908</span><br><span class="line">3909</span><br><span class="line">3910</span><br><span class="line">3911</span><br><span class="line">3912</span><br><span class="line">3913</span><br><span class="line">3914</span><br><span class="line">3915</span><br><span class="line">3916</span><br><span class="line">3917</span><br><span class="line">3918</span><br><span class="line">3919</span><br><span class="line">3920</span><br><span class="line">3921</span><br><span class="line">3922</span><br><span class="line">3923</span><br><span class="line">3924</span><br><span class="line">3925</span><br><span class="line">3926</span><br><span class="line">3927</span><br><span class="line">3928</span><br><span class="line">3929</span><br><span class="line">3930</span><br><span class="line">3931</span><br><span class="line">3932</span><br><span class="line">3933</span><br><span class="line">3934</span><br><span class="line">3935</span><br><span class="line">3936</span><br><span class="line">3937</span><br><span class="line">3938</span><br><span class="line">3939</span><br><span class="line">3940</span><br><span class="line">3941</span><br><span class="line">3942</span><br><span class="line">3943</span><br><span class="line">3944</span><br><span class="line">3945</span><br><span class="line">3946</span><br><span class="line">3947</span><br><span class="line">3948</span><br><span class="line">3949</span><br><span class="line">3950</span><br><span class="line">3951</span><br><span class="line">3952</span><br><span class="line">3953</span><br><span class="line">3954</span><br><span class="line">3955</span><br><span class="line">3956</span><br><span class="line">3957</span><br><span class="line">3958</span><br><span class="line">3959</span><br><span class="line">3960</span><br><span class="line">3961</span><br><span class="line">3962</span><br><span class="line">3963</span><br><span class="line">3964</span><br><span class="line">3965</span><br><span class="line">3966</span><br><span class="line">3967</span><br><span class="line">3968</span><br><span class="line">3969</span><br><span class="line">3970</span><br><span class="line">3971</span><br><span class="line">3972</span><br><span class="line">3973</span><br><span class="line">3974</span><br><span class="line">3975</span><br><span class="line">3976</span><br><span class="line">3977</span><br><span class="line">3978</span><br><span class="line">3979</span><br><span class="line">3980</span><br><span class="line">3981</span><br><span class="line">3982</span><br><span class="line">3983</span><br><span class="line">3984</span><br><span class="line">3985</span><br><span class="line">3986</span><br><span class="line">3987</span><br><span class="line">3988</span><br><span class="line">3989</span><br><span class="line">3990</span><br><span class="line">3991</span><br><span class="line">3992</span><br><span class="line">3993</span><br><span class="line">3994</span><br><span class="line">3995</span><br><span class="line">3996</span><br><span class="line">3997</span><br><span class="line">3998</span><br><span class="line">3999</span><br><span class="line">4000</span><br><span class="line">4001</span><br><span class="line">4002</span><br><span class="line">4003</span><br><span class="line">4004</span><br><span class="line">4005</span><br><span class="line">4006</span><br><span class="line">4007</span><br><span class="line">4008</span><br><span class="line">4009</span><br><span class="line">4010</span><br><span class="line">4011</span><br><span class="line">4012</span><br><span class="line">4013</span><br><span class="line">4014</span><br><span class="line">4015</span><br><span class="line">4016</span><br><span class="line">4017</span><br><span class="line">4018</span><br><span class="line">4019</span><br><span class="line">4020</span><br><span class="line">4021</span><br><span class="line">4022</span><br><span class="line">4023</span><br><span class="line">4024</span><br><span class="line">4025</span><br><span class="line">4026</span><br><span class="line">4027</span><br><span class="line">4028</span><br><span class="line">4029</span><br><span class="line">4030</span><br><span class="line">4031</span><br><span class="line">4032</span><br><span class="line">4033</span><br><span class="line">4034</span><br><span class="line">4035</span><br><span class="line">4036</span><br><span class="line">4037</span><br><span class="line">4038</span><br><span class="line">4039</span><br><span class="line">4040</span><br><span class="line">4041</span><br><span class="line">4042</span><br><span class="line">4043</span><br><span class="line">4044</span><br><span class="line">4045</span><br><span class="line">4046</span><br><span class="line">4047</span><br><span class="line">4048</span><br><span class="line">4049</span><br><span class="line">4050</span><br><span class="line">4051</span><br><span class="line">4052</span><br><span class="line">4053</span><br><span class="line">4054</span><br><span class="line">4055</span><br><span class="line">4056</span><br><span class="line">4057</span><br><span class="line">4058</span><br><span class="line">4059</span><br><span class="line">4060</span><br><span class="line">4061</span><br><span class="line">4062</span><br><span class="line">4063</span><br><span class="line">4064</span><br><span class="line">4065</span><br><span class="line">4066</span><br><span class="line">4067</span><br><span class="line">4068</span><br><span class="line">4069</span><br><span class="line">4070</span><br><span class="line">4071</span><br><span class="line">4072</span><br><span class="line">4073</span><br><span class="line">4074</span><br><span class="line">4075</span><br><span class="line">4076</span><br><span class="line">4077</span><br><span class="line">4078</span><br><span class="line">4079</span><br><span class="line">4080</span><br><span class="line">4081</span><br><span class="line">4082</span><br><span class="line">4083</span><br><span class="line">4084</span><br><span class="line">4085</span><br><span class="line">4086</span><br><span class="line">4087</span><br><span class="line">4088</span><br><span class="line">4089</span><br><span class="line">4090</span><br><span class="line">4091</span><br><span class="line">4092</span><br><span class="line">4093</span><br><span class="line">4094</span><br><span class="line">4095</span><br><span class="line">4096</span><br><span class="line">4097</span><br><span class="line">4098</span><br><span class="line">4099</span><br><span class="line">4100</span><br><span class="line">4101</span><br><span class="line">4102</span><br><span class="line">4103</span><br><span class="line">4104</span><br><span class="line">4105</span><br><span class="line">4106</span><br><span class="line">4107</span><br><span class="line">4108</span><br><span class="line">4109</span><br><span class="line">4110</span><br><span class="line">4111</span><br><span class="line">4112</span><br><span class="line">4113</span><br><span class="line">4114</span><br><span class="line">4115</span><br><span class="line">4116</span><br><span class="line">4117</span><br><span class="line">4118</span><br><span class="line">4119</span><br><span class="line">4120</span><br><span class="line">4121</span><br><span class="line">4122</span><br><span class="line">4123</span><br><span class="line">4124</span><br><span class="line">4125</span><br><span class="line">4126</span><br><span class="line">4127</span><br><span class="line">4128</span><br><span class="line">4129</span><br><span class="line">4130</span><br><span class="line">4131</span><br><span class="line">4132</span><br><span class="line">4133</span><br><span class="line">4134</span><br><span class="line">4135</span><br><span class="line">4136</span><br><span class="line">4137</span><br><span class="line">4138</span><br><span class="line">4139</span><br><span class="line">4140</span><br><span class="line">4141</span><br><span class="line">4142</span><br><span class="line">4143</span><br><span class="line">4144</span><br><span class="line">4145</span><br><span class="line">4146</span><br><span class="line">4147</span><br><span class="line">4148</span><br><span class="line">4149</span><br><span class="line">4150</span><br><span class="line">4151</span><br><span class="line">4152</span><br><span class="line">4153</span><br><span class="line">4154</span><br><span class="line">4155</span><br><span class="line">4156</span><br><span class="line">4157</span><br><span class="line">4158</span><br><span class="line">4159</span><br><span class="line">4160</span><br><span class="line">4161</span><br><span class="line">4162</span><br><span class="line">4163</span><br><span class="line">4164</span><br><span class="line">4165</span><br><span class="line">4166</span><br><span class="line">4167</span><br><span class="line">4168</span><br><span class="line">4169</span><br><span class="line">4170</span><br><span class="line">4171</span><br><span class="line">4172</span><br><span class="line">4173</span><br><span class="line">4174</span><br><span class="line">4175</span><br><span class="line">4176</span><br><span class="line">4177</span><br><span class="line">4178</span><br><span class="line">4179</span><br><span class="line">4180</span><br><span class="line">4181</span><br><span class="line">4182</span><br><span class="line">4183</span><br><span class="line">4184</span><br><span class="line">4185</span><br><span class="line">4186</span><br><span class="line">4187</span><br><span class="line">4188</span><br><span class="line">4189</span><br><span class="line">4190</span><br><span class="line">4191</span><br><span class="line">4192</span><br><span class="line">4193</span><br><span class="line">4194</span><br><span class="line">4195</span><br><span class="line">4196</span><br><span class="line">4197</span><br><span class="line">4198</span><br><span class="line">4199</span><br><span class="line">4200</span><br><span class="line">4201</span><br><span class="line">4202</span><br><span class="line">4203</span><br><span class="line">4204</span><br><span class="line">4205</span><br><span class="line">4206</span><br><span class="line">4207</span><br><span class="line">4208</span><br><span class="line">4209</span><br><span class="line">4210</span><br><span class="line">4211</span><br><span class="line">4212</span><br><span class="line">4213</span><br><span class="line">4214</span><br><span class="line">4215</span><br><span class="line">4216</span><br><span class="line">4217</span><br><span class="line">4218</span><br><span class="line">4219</span><br><span class="line">4220</span><br><span class="line">4221</span><br><span class="line">4222</span><br><span class="line">4223</span><br><span class="line">4224</span><br><span class="line">4225</span><br><span class="line">4226</span><br><span class="line">4227</span><br><span class="line">4228</span><br><span class="line">4229</span><br><span class="line">4230</span><br><span class="line">4231</span><br><span class="line">4232</span><br><span class="line">4233</span><br><span class="line">4234</span><br><span class="line">4235</span><br><span class="line">4236</span><br><span class="line">4237</span><br><span class="line">4238</span><br><span class="line">4239</span><br><span class="line">4240</span><br><span class="line">4241</span><br><span class="line">4242</span><br><span class="line">4243</span><br><span class="line">4244</span><br><span class="line">4245</span><br><span class="line">4246</span><br><span class="line">4247</span><br><span class="line">4248</span><br><span class="line">4249</span><br><span class="line">4250</span><br><span class="line">4251</span><br><span class="line">4252</span><br><span class="line">4253</span><br><span class="line">4254</span><br><span class="line">4255</span><br><span class="line">4256</span><br><span class="line">4257</span><br><span class="line">4258</span><br><span class="line">4259</span><br><span class="line">4260</span><br><span class="line">4261</span><br><span class="line">4262</span><br><span class="line">4263</span><br><span class="line">4264</span><br><span class="line">4265</span><br><span class="line">4266</span><br><span class="line">4267</span><br><span class="line">4268</span><br><span class="line">4269</span><br><span class="line">4270</span><br><span class="line">4271</span><br><span class="line">4272</span><br><span class="line">4273</span><br><span class="line">4274</span><br><span class="line">4275</span><br><span class="line">4276</span><br><span class="line">4277</span><br><span class="line">4278</span><br><span class="line">4279</span><br><span class="line">4280</span><br><span class="line">4281</span><br><span class="line">4282</span><br><span class="line">4283</span><br><span class="line">4284</span><br><span class="line">4285</span><br><span class="line">4286</span><br><span class="line">4287</span><br><span class="line">4288</span><br><span class="line">4289</span><br><span class="line">4290</span><br><span class="line">4291</span><br><span class="line">4292</span><br><span class="line">4293</span><br><span class="line">4294</span><br><span class="line">4295</span><br><span class="line">4296</span><br><span class="line">4297</span><br><span class="line">4298</span><br><span class="line">4299</span><br><span class="line">4300</span><br><span class="line">4301</span><br><span class="line">4302</span><br><span class="line">4303</span><br><span class="line">4304</span><br><span class="line">4305</span><br><span class="line">4306</span><br><span class="line">4307</span><br><span class="line">4308</span><br><span class="line">4309</span><br><span class="line">4310</span><br><span class="line">4311</span><br><span class="line">4312</span><br><span class="line">4313</span><br><span class="line">4314</span><br><span class="line">4315</span><br><span class="line">4316</span><br><span class="line">4317</span><br><span class="line">4318</span><br><span class="line">4319</span><br><span class="line">4320</span><br><span class="line">4321</span><br><span class="line">4322</span><br><span class="line">4323</span><br><span class="line">4324</span><br><span class="line">4325</span><br><span class="line">4326</span><br><span class="line">4327</span><br><span class="line">4328</span><br><span class="line">4329</span><br><span class="line">4330</span><br><span class="line">4331</span><br><span class="line">4332</span><br><span class="line">4333</span><br><span class="line">4334</span><br><span class="line">4335</span><br><span class="line">4336</span><br><span class="line">4337</span><br><span class="line">4338</span><br><span class="line">4339</span><br><span class="line">4340</span><br><span class="line">4341</span><br><span class="line">4342</span><br><span class="line">4343</span><br><span class="line">4344</span><br><span class="line">4345</span><br><span class="line">4346</span><br><span class="line">4347</span><br><span class="line">4348</span><br><span class="line">4349</span><br><span class="line">4350</span><br><span class="line">4351</span><br><span class="line">4352</span><br><span class="line">4353</span><br><span class="line">4354</span><br><span class="line">4355</span><br><span class="line">4356</span><br><span class="line">4357</span><br><span class="line">4358</span><br><span class="line">4359</span><br><span class="line">4360</span><br><span class="line">4361</span><br><span class="line">4362</span><br><span class="line">4363</span><br><span class="line">4364</span><br><span class="line">4365</span><br><span class="line">4366</span><br><span class="line">4367</span><br><span class="line">4368</span><br><span class="line">4369</span><br><span class="line">4370</span><br><span class="line">4371</span><br><span class="line">4372</span><br><span class="line">4373</span><br><span class="line">4374</span><br><span class="line">4375</span><br><span class="line">4376</span><br><span class="line">4377</span><br><span class="line">4378</span><br><span class="line">4379</span><br><span class="line">4380</span><br><span class="line">4381</span><br><span class="line">4382</span><br><span class="line">4383</span><br><span class="line">4384</span><br><span class="line">4385</span><br><span class="line">4386</span><br><span class="line">4387</span><br><span class="line">4388</span><br><span class="line">4389</span><br><span class="line">4390</span><br><span class="line">4391</span><br><span class="line">4392</span><br><span class="line">4393</span><br><span class="line">4394</span><br><span class="line">4395</span><br><span class="line">4396</span><br><span class="line">4397</span><br><span class="line">4398</span><br><span class="line">4399</span><br><span class="line">4400</span><br><span class="line">4401</span><br><span class="line">4402</span><br><span class="line">4403</span><br><span class="line">4404</span><br><span class="line">4405</span><br><span class="line">4406</span><br><span class="line">4407</span><br><span class="line">4408</span><br><span class="line">4409</span><br><span class="line">4410</span><br><span class="line">4411</span><br><span class="line">4412</span><br><span class="line">4413</span><br><span class="line">4414</span><br><span class="line">4415</span><br><span class="line">4416</span><br><span class="line">4417</span><br><span class="line">4418</span><br><span class="line">4419</span><br><span class="line">4420</span><br><span class="line">4421</span><br><span class="line">4422</span><br><span class="line">4423</span><br><span class="line">4424</span><br><span class="line">4425</span><br><span class="line">4426</span><br><span class="line">4427</span><br><span class="line">4428</span><br><span class="line">4429</span><br><span class="line">4430</span><br><span class="line">4431</span><br><span class="line">4432</span><br><span class="line">4433</span><br><span class="line">4434</span><br><span class="line">4435</span><br><span class="line">4436</span><br><span class="line">4437</span><br><span class="line">4438</span><br><span class="line">4439</span><br><span class="line">4440</span><br><span class="line">4441</span><br><span class="line">4442</span><br><span class="line">4443</span><br><span class="line">4444</span><br><span class="line">4445</span><br><span class="line">4446</span><br><span class="line">4447</span><br><span class="line">4448</span><br><span class="line">4449</span><br><span class="line">4450</span><br><span class="line">4451</span><br><span class="line">4452</span><br><span class="line">4453</span><br><span class="line">4454</span><br><span class="line">4455</span><br><span class="line">4456</span><br><span class="line">4457</span><br><span class="line">4458</span><br><span class="line">4459</span><br><span class="line">4460</span><br><span class="line">4461</span><br><span class="line">4462</span><br><span class="line">4463</span><br><span class="line">4464</span><br><span class="line">4465</span><br><span class="line">4466</span><br><span class="line">4467</span><br><span class="line">4468</span><br><span class="line">4469</span><br><span class="line">4470</span><br><span class="line">4471</span><br><span class="line">4472</span><br><span class="line">4473</span><br><span class="line">4474</span><br><span class="line">4475</span><br><span class="line">4476</span><br><span class="line">4477</span><br><span class="line">4478</span><br><span class="line">4479</span><br><span class="line">4480</span><br><span class="line">4481</span><br><span class="line">4482</span><br><span class="line">4483</span><br><span class="line">4484</span><br><span class="line">4485</span><br><span class="line">4486</span><br><span class="line">4487</span><br><span class="line">4488</span><br><span class="line">4489</span><br><span class="line">4490</span><br><span class="line">4491</span><br><span class="line">4492</span><br><span class="line">4493</span><br><span class="line">4494</span><br><span class="line">4495</span><br><span class="line">4496</span><br><span class="line">4497</span><br><span class="line">4498</span><br><span class="line">4499</span><br><span class="line">4500</span><br><span class="line">4501</span><br><span class="line">4502</span><br><span class="line">4503</span><br><span class="line">4504</span><br><span class="line">4505</span><br><span class="line">4506</span><br><span class="line">4507</span><br><span class="line">4508</span><br><span class="line">4509</span><br><span class="line">4510</span><br><span class="line">4511</span><br><span class="line">4512</span><br><span class="line">4513</span><br><span class="line">4514</span><br><span class="line">4515</span><br><span class="line">4516</span><br><span class="line">4517</span><br><span class="line">4518</span><br><span class="line">4519</span><br><span class="line">4520</span><br><span class="line">4521</span><br><span class="line">4522</span><br><span class="line">4523</span><br><span class="line">4524</span><br><span class="line">4525</span><br><span class="line">4526</span><br><span class="line">4527</span><br><span class="line">4528</span><br><span class="line">4529</span><br><span class="line">4530</span><br><span class="line">4531</span><br><span class="line">4532</span><br><span class="line">4533</span><br><span class="line">4534</span><br><span class="line">4535</span><br><span class="line">4536</span><br><span class="line">4537</span><br><span class="line">4538</span><br><span class="line">4539</span><br><span class="line">4540</span><br><span class="line">4541</span><br><span class="line">4542</span><br><span class="line">4543</span><br><span class="line">4544</span><br><span class="line">4545</span><br><span class="line">4546</span><br><span class="line">4547</span><br><span class="line">4548</span><br><span class="line">4549</span><br><span class="line">4550</span><br><span class="line">4551</span><br><span class="line">4552</span><br><span class="line">4553</span><br><span class="line">4554</span><br><span class="line">4555</span><br><span class="line">4556</span><br><span class="line">4557</span><br><span class="line">4558</span><br><span class="line">4559</span><br><span class="line">4560</span><br><span class="line">4561</span><br><span class="line">4562</span><br><span class="line">4563</span><br><span class="line">4564</span><br><span class="line">4565</span><br><span class="line">4566</span><br><span class="line">4567</span><br><span class="line">4568</span><br><span class="line">4569</span><br><span class="line">4570</span><br><span class="line">4571</span><br><span class="line">4572</span><br><span class="line">4573</span><br><span class="line">4574</span><br><span class="line">4575</span><br><span class="line">4576</span><br><span class="line">4577</span><br><span class="line">4578</span><br><span class="line">4579</span><br><span class="line">4580</span><br><span class="line">4581</span><br><span class="line">4582</span><br><span class="line">4583</span><br><span class="line">4584</span><br><span class="line">4585</span><br><span class="line">4586</span><br><span class="line">4587</span><br><span class="line">4588</span><br><span class="line">4589</span><br><span class="line">4590</span><br><span class="line">4591</span><br><span class="line">4592</span><br><span class="line">4593</span><br><span class="line">4594</span><br><span class="line">4595</span><br><span class="line">4596</span><br><span class="line">4597</span><br><span class="line">4598</span><br><span class="line">4599</span><br><span class="line">4600</span><br><span class="line">4601</span><br><span class="line">4602</span><br><span class="line">4603</span><br><span class="line">4604</span><br><span class="line">4605</span><br><span class="line">4606</span><br><span class="line">4607</span><br><span class="line">4608</span><br><span class="line">4609</span><br><span class="line">4610</span><br><span class="line">4611</span><br><span class="line">4612</span><br><span class="line">4613</span><br><span class="line">4614</span><br><span class="line">4615</span><br><span class="line">4616</span><br><span class="line">4617</span><br><span class="line">4618</span><br><span class="line">4619</span><br><span class="line">4620</span><br><span class="line">4621</span><br><span class="line">4622</span><br><span class="line">4623</span><br><span class="line">4624</span><br><span class="line">4625</span><br><span class="line">4626</span><br><span class="line">4627</span><br><span class="line">4628</span><br><span class="line">4629</span><br><span class="line">4630</span><br><span class="line">4631</span><br><span class="line">4632</span><br><span class="line">4633</span><br><span class="line">4634</span><br><span class="line">4635</span><br><span class="line">4636</span><br><span class="line">4637</span><br><span class="line">4638</span><br><span class="line">4639</span><br><span class="line">4640</span><br><span class="line">4641</span><br><span class="line">4642</span><br><span class="line">4643</span><br><span class="line">4644</span><br><span class="line">4645</span><br><span class="line">4646</span><br><span class="line">4647</span><br><span class="line">4648</span><br><span class="line">4649</span><br><span class="line">4650</span><br><span class="line">4651</span><br><span class="line">4652</span><br><span class="line">4653</span><br><span class="line">4654</span><br><span class="line">4655</span><br><span class="line">4656</span><br><span class="line">4657</span><br><span class="line">4658</span><br><span class="line">4659</span><br><span class="line">4660</span><br><span class="line">4661</span><br><span class="line">4662</span><br><span class="line">4663</span><br><span class="line">4664</span><br><span class="line">4665</span><br><span class="line">4666</span><br><span class="line">4667</span><br><span class="line">4668</span><br><span class="line">4669</span><br><span class="line">4670</span><br><span class="line">4671</span><br><span class="line">4672</span><br><span class="line">4673</span><br><span class="line">4674</span><br><span class="line">4675</span><br><span class="line">4676</span><br><span class="line">4677</span><br><span class="line">4678</span><br><span class="line">4679</span><br><span class="line">4680</span><br><span class="line">4681</span><br><span class="line">4682</span><br><span class="line">4683</span><br><span class="line">4684</span><br><span class="line">4685</span><br><span class="line">4686</span><br><span class="line">4687</span><br><span class="line">4688</span><br><span class="line">4689</span><br><span class="line">4690</span><br><span class="line">4691</span><br><span class="line">4692</span><br><span class="line">4693</span><br><span class="line">4694</span><br><span class="line">4695</span><br><span class="line">4696</span><br><span class="line">4697</span><br><span class="line">4698</span><br><span class="line">4699</span><br><span class="line">4700</span><br><span class="line">4701</span><br><span class="line">4702</span><br><span class="line">4703</span><br><span class="line">4704</span><br><span class="line">4705</span><br><span class="line">4706</span><br><span class="line">4707</span><br><span class="line">4708</span><br><span class="line">4709</span><br><span class="line">4710</span><br><span class="line">4711</span><br><span class="line">4712</span><br><span class="line">4713</span><br><span class="line">4714</span><br><span class="line">4715</span><br><span class="line">4716</span><br><span class="line">4717</span><br><span class="line">4718</span><br><span class="line">4719</span><br><span class="line">4720</span><br><span class="line">4721</span><br><span class="line">4722</span><br><span class="line">4723</span><br><span class="line">4724</span><br><span class="line">4725</span><br><span class="line">4726</span><br><span class="line">4727</span><br><span class="line">4728</span><br><span class="line">4729</span><br><span class="line">4730</span><br><span class="line">4731</span><br><span class="line">4732</span><br><span class="line">4733</span><br><span class="line">4734</span><br><span class="line">4735</span><br><span class="line">4736</span><br><span class="line">4737</span><br><span class="line">4738</span><br><span class="line">4739</span><br><span class="line">4740</span><br><span class="line">4741</span><br><span class="line">4742</span><br><span class="line">4743</span><br><span class="line">4744</span><br><span class="line">4745</span><br><span class="line">4746</span><br><span class="line">4747</span><br><span class="line">4748</span><br><span class="line">4749</span><br><span class="line">4750</span><br><span class="line">4751</span><br><span class="line">4752</span><br><span class="line">4753</span><br><span class="line">4754</span><br><span class="line">4755</span><br><span class="line">4756</span><br><span class="line">4757</span><br><span class="line">4758</span><br><span class="line">4759</span><br><span class="line">4760</span><br><span class="line">4761</span><br><span class="line">4762</span><br><span class="line">4763</span><br><span class="line">4764</span><br><span class="line">4765</span><br><span class="line">4766</span><br><span class="line">4767</span><br><span class="line">4768</span><br><span class="line">4769</span><br><span class="line">4770</span><br><span class="line">4771</span><br><span class="line">4772</span><br><span class="line">4773</span><br><span class="line">4774</span><br><span class="line">4775</span><br><span class="line">4776</span><br><span class="line">4777</span><br><span class="line">4778</span><br><span class="line">4779</span><br><span class="line">4780</span><br><span class="line">4781</span><br><span class="line">4782</span><br><span class="line">4783</span><br><span class="line">4784</span><br><span class="line">4785</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/calico-kube-controllers.yaml</span><br><span class="hljs-comment"># This manifest creates a Pod Disruption Budget for Controller to allow K8s Cluster Autoscaler to evict</span><br><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">policy/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">PodDisruptionBudget</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">calico-kube-controllers</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">k8s-app:</span> <span class="hljs-string">calico-kube-controllers</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">maxUnavailable:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">k8s-app:</span> <span class="hljs-string">calico-kube-controllers</span><br><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/calico-kube-controllers.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">calico-kube-controllers</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/calico-node.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">calico-node</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/calico-config.yaml</span><br><span class="hljs-comment"># This ConfigMap is used to configure a self-hosted Calico installation.</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">calico-config</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-comment"># Typha is disabled.</span><br>  <span class="hljs-attr">typha_service_name:</span> <span class="hljs-string">&quot;none&quot;</span><br>  <span class="hljs-comment"># Configure the backend to use.</span><br>  <span class="hljs-attr">calico_backend:</span> <span class="hljs-string">&quot;bird&quot;</span><br><br>  <span class="hljs-comment"># Configure the MTU to use for workload interfaces and tunnels.</span><br>  <span class="hljs-comment"># By default, MTU is auto-detected, and explicitly setting this field should not be required.</span><br>  <span class="hljs-comment"># You can override auto-detection by providing a non-zero value.</span><br>  <span class="hljs-attr">veth_mtu:</span> <span class="hljs-string">&quot;0&quot;</span><br><br>  <span class="hljs-comment"># The CNI network configuration to install on each node. The special</span><br>  <span class="hljs-comment"># values in this config will be automatically populated.</span><br>  <span class="hljs-attr">cni_network_config:</span> <span class="hljs-string">|-</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">      &quot;name&quot;: &quot;k8s-pod-network&quot;,</span><br><span class="hljs-string">      &quot;cniVersion&quot;: &quot;0.3.1&quot;,</span><br><span class="hljs-string">      &quot;plugins&quot;: [</span><br><span class="hljs-string">        &#123;</span><br><span class="hljs-string">          &quot;type&quot;: &quot;calico&quot;,</span><br><span class="hljs-string">          &quot;log_level&quot;: &quot;info&quot;,</span><br><span class="hljs-string">          &quot;log_file_path&quot;: &quot;/var/log/calico/cni/cni.log&quot;,</span><br><span class="hljs-string">          &quot;datastore_type&quot;: &quot;kubernetes&quot;,</span><br><span class="hljs-string">          &quot;nodename&quot;: &quot;__KUBERNETES_NODE_NAME__&quot;,</span><br><span class="hljs-string">          &quot;mtu&quot;: __CNI_MTU__,</span><br><span class="hljs-string">          &quot;ipam&quot;: &#123;</span><br><span class="hljs-string">              &quot;type&quot;: &quot;host-local&quot;,</span><br><span class="hljs-string">               &quot;subnet&quot;: &quot;usePodCidr&quot;</span><br><span class="hljs-string">          &#125;,</span><br><span class="hljs-string">          &quot;policy&quot;: &#123;</span><br><span class="hljs-string">              &quot;type&quot;: &quot;k8s&quot;</span><br><span class="hljs-string">          &#125;,</span><br><span class="hljs-string">          &quot;kubernetes&quot;: &#123;</span><br><span class="hljs-string">              &quot;kubeconfig&quot;: &quot;__KUBECONFIG_FILEPATH__&quot;</span><br><span class="hljs-string">          &#125;</span><br><span class="hljs-string">        &#125;,</span><br><span class="hljs-string">        &#123;</span><br><span class="hljs-string">          &quot;type&quot;: &quot;portmap&quot;,</span><br><span class="hljs-string">          &quot;snat&quot;: true,</span><br><span class="hljs-string">          &quot;capabilities&quot;: &#123;&quot;portMappings&quot;: true&#125;</span><br><span class="hljs-string">        &#125;,</span><br><span class="hljs-string">        &#123;</span><br><span class="hljs-string">          &quot;type&quot;: &quot;bandwidth&quot;,</span><br><span class="hljs-string">          &quot;capabilities&quot;: &#123;&quot;bandwidth&quot;: true&#125;</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">      ]</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string"></span><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/kdd-crds.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apiextensions.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">CustomResourceDefinition</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">bgpconfigurations.crd.projectcalico.org</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">group:</span> <span class="hljs-string">crd.projectcalico.org</span><br>  <span class="hljs-attr">names:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">BGPConfiguration</span><br>    <span class="hljs-attr">listKind:</span> <span class="hljs-string">BGPConfigurationList</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">bgpconfigurations</span><br>    <span class="hljs-attr">singular:</span> <span class="hljs-string">bgpconfiguration</span><br>  <span class="hljs-attr">preserveUnknownFields:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">scope:</span> <span class="hljs-string">Cluster</span><br>  <span class="hljs-attr">versions:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">v1</span><br>    <span class="hljs-attr">schema:</span><br>      <span class="hljs-attr">openAPIV3Schema:</span><br>        <span class="hljs-attr">description:</span> <span class="hljs-string">BGPConfiguration</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">configuration</span> <span class="hljs-string">for</span> <span class="hljs-string">any</span> <span class="hljs-string">BGP</span> <span class="hljs-string">routing.</span><br>        <span class="hljs-attr">properties:</span><br>          <span class="hljs-attr">apiVersion:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;APIVersion defines the versioned schema of this representation</span><br><span class="hljs-string">              of an object. Servers should convert recognized schemas to the latest</span><br><span class="hljs-string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">kind:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Kind is a string value representing the REST resource this</span><br><span class="hljs-string">              object represents. Servers may infer this from the endpoint the client</span><br><span class="hljs-string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">metadata:</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>          <span class="hljs-attr">spec:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">BGPConfigurationSpec</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">values</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">BGP</span> <span class="hljs-string">configuration.</span><br>            <span class="hljs-attr">properties:</span><br>              <span class="hljs-attr">asNumber:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;ASNumber is the default AS number used by a node. [Default:</span><br><span class="hljs-string">                  64512]&#x27;</span><br>                <span class="hljs-attr">format:</span> <span class="hljs-string">int32</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">bindMode:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">BindMode</span> <span class="hljs-string">indicates</span> <span class="hljs-string">whether</span> <span class="hljs-string">to</span> <span class="hljs-string">listen</span> <span class="hljs-string">for</span> <span class="hljs-string">BGP</span> <span class="hljs-string">connections</span><br>                  <span class="hljs-string">on</span> <span class="hljs-string">all</span> <span class="hljs-string">addresses</span> <span class="hljs-string">(None)</span> <span class="hljs-string">or</span> <span class="hljs-string">only</span> <span class="hljs-string">on</span> <span class="hljs-string">the</span> <span class="hljs-string">node&#x27;s</span> <span class="hljs-string">canonical</span> <span class="hljs-string">IP</span> <span class="hljs-string">address</span><br>                  <span class="hljs-string">Node.Spec.BGP.IPvXAddress</span> <span class="hljs-string">(NodeIP).</span> <span class="hljs-string">Default</span> <span class="hljs-string">behaviour</span> <span class="hljs-string">is</span> <span class="hljs-string">to</span> <span class="hljs-string">listen</span><br>                  <span class="hljs-string">for</span> <span class="hljs-string">BGP</span> <span class="hljs-string">connections</span> <span class="hljs-string">on</span> <span class="hljs-string">all</span> <span class="hljs-string">addresses.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">communities:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Communities</span> <span class="hljs-string">is</span> <span class="hljs-string">a</span> <span class="hljs-string">list</span> <span class="hljs-string">of</span> <span class="hljs-string">BGP</span> <span class="hljs-string">community</span> <span class="hljs-string">values</span> <span class="hljs-string">and</span> <span class="hljs-string">their</span><br>                  <span class="hljs-string">arbitrary</span> <span class="hljs-string">names</span> <span class="hljs-string">for</span> <span class="hljs-string">tagging</span> <span class="hljs-string">routes.</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">description:</span> <span class="hljs-string">Community</span> <span class="hljs-string">contains</span> <span class="hljs-string">standard</span> <span class="hljs-string">or</span> <span class="hljs-string">large</span> <span class="hljs-string">community</span> <span class="hljs-string">value</span><br>                    <span class="hljs-string">and</span> <span class="hljs-string">its</span> <span class="hljs-string">name.</span><br>                  <span class="hljs-attr">properties:</span><br>                    <span class="hljs-attr">name:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">Name</span> <span class="hljs-string">given</span> <span class="hljs-string">to</span> <span class="hljs-string">community</span> <span class="hljs-string">value.</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                    <span class="hljs-attr">value:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">Value</span> <span class="hljs-string">must</span> <span class="hljs-string">be</span> <span class="hljs-string">of</span> <span class="hljs-string">format</span> <span class="hljs-string">`aa:nn`</span> <span class="hljs-string">or</span> <span class="hljs-string">`aa:nn:mm`.</span><br>                        <span class="hljs-string">For</span> <span class="hljs-string">standard</span> <span class="hljs-string">community</span> <span class="hljs-string">use</span> <span class="hljs-string">`aa:nn`</span> <span class="hljs-string">format,</span> <span class="hljs-string">where</span> <span class="hljs-string">`aa`</span> <span class="hljs-string">and</span><br>                        <span class="hljs-string">`nn`</span> <span class="hljs-string">are</span> <span class="hljs-number">16</span> <span class="hljs-string">bit</span> <span class="hljs-string">number.</span> <span class="hljs-string">For</span> <span class="hljs-string">large</span> <span class="hljs-string">community</span> <span class="hljs-string">use</span> <span class="hljs-string">`aa:nn:mm`</span><br>                        <span class="hljs-string">format,</span> <span class="hljs-string">where</span> <span class="hljs-string">`aa`,</span> <span class="hljs-string">`nn`</span> <span class="hljs-string">and</span> <span class="hljs-string">`mm`</span> <span class="hljs-string">are</span> <span class="hljs-number">32</span> <span class="hljs-string">bit</span> <span class="hljs-string">number.</span> <span class="hljs-string">Where,</span><br>                        <span class="hljs-string">`aa`</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">AS</span> <span class="hljs-string">Number,</span> <span class="hljs-string">`nn`</span> <span class="hljs-string">and</span> <span class="hljs-string">`mm`</span> <span class="hljs-string">are</span> <span class="hljs-string">per-AS</span> <span class="hljs-string">identifier.</span><br>                      <span class="hljs-attr">pattern:</span> <span class="hljs-string">^(\d+):(\d+)$|^(\d+):(\d+):(\d+)$</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>              <span class="hljs-attr">ignoredInterfaces:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">IgnoredInterfaces</span> <span class="hljs-string">indicates</span> <span class="hljs-string">the</span> <span class="hljs-string">network</span> <span class="hljs-string">interfaces</span> <span class="hljs-string">that</span><br>                  <span class="hljs-string">needs</span> <span class="hljs-string">to</span> <span class="hljs-string">be</span> <span class="hljs-string">excluded</span> <span class="hljs-string">when</span> <span class="hljs-string">reading</span> <span class="hljs-string">device</span> <span class="hljs-string">routes.</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>              <span class="hljs-attr">listenPort:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">ListenPort</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">port</span> <span class="hljs-string">where</span> <span class="hljs-string">BGP</span> <span class="hljs-string">protocol</span> <span class="hljs-string">should</span> <span class="hljs-string">listen.</span><br>                  <span class="hljs-string">Defaults</span> <span class="hljs-string">to</span> <span class="hljs-number">179</span><br>                <span class="hljs-attr">maximum:</span> <span class="hljs-number">65535</span><br>                <span class="hljs-attr">minimum:</span> <span class="hljs-number">1</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">logSeverityScreen:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;LogSeverityScreen is the log severity above which logs</span><br><span class="hljs-string">                  are sent to the stdout. [Default: INFO]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">nodeMeshMaxRestartTime:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Time</span> <span class="hljs-string">to</span> <span class="hljs-string">allow</span> <span class="hljs-string">for</span> <span class="hljs-string">software</span> <span class="hljs-string">restart</span> <span class="hljs-string">for</span> <span class="hljs-string">node-to-mesh</span> <span class="hljs-string">peerings.</span>  <span class="hljs-string">When</span><br>                  <span class="hljs-string">specified,</span> <span class="hljs-string">this</span> <span class="hljs-string">is</span> <span class="hljs-string">configured</span> <span class="hljs-string">as</span> <span class="hljs-string">the</span> <span class="hljs-string">graceful</span> <span class="hljs-string">restart</span> <span class="hljs-string">timeout.</span>  <span class="hljs-string">When</span><br>                  <span class="hljs-string">not</span> <span class="hljs-string">specified,</span> <span class="hljs-string">the</span> <span class="hljs-string">BIRD</span> <span class="hljs-string">default</span> <span class="hljs-string">of</span> <span class="hljs-string">120s</span> <span class="hljs-string">is</span> <span class="hljs-string">used.</span> <span class="hljs-string">This</span> <span class="hljs-string">field</span> <span class="hljs-string">can</span><br>                  <span class="hljs-string">only</span> <span class="hljs-string">be</span> <span class="hljs-string">set</span> <span class="hljs-string">on</span> <span class="hljs-string">the</span> <span class="hljs-string">default</span> <span class="hljs-string">BGPConfiguration</span> <span class="hljs-string">instance</span> <span class="hljs-string">and</span> <span class="hljs-string">requires</span><br>                  <span class="hljs-string">that</span> <span class="hljs-string">NodeMesh</span> <span class="hljs-string">is</span> <span class="hljs-string">enabled</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">nodeMeshPassword:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Optional</span> <span class="hljs-string">BGP</span> <span class="hljs-string">password</span> <span class="hljs-string">for</span> <span class="hljs-string">full</span> <span class="hljs-string">node-to-mesh</span> <span class="hljs-string">peerings.</span><br>                  <span class="hljs-string">This</span> <span class="hljs-string">field</span> <span class="hljs-string">can</span> <span class="hljs-string">only</span> <span class="hljs-string">be</span> <span class="hljs-string">set</span> <span class="hljs-string">on</span> <span class="hljs-string">the</span> <span class="hljs-string">default</span> <span class="hljs-string">BGPConfiguration</span> <span class="hljs-string">instance</span><br>                  <span class="hljs-string">and</span> <span class="hljs-string">requires</span> <span class="hljs-string">that</span> <span class="hljs-string">NodeMesh</span> <span class="hljs-string">is</span> <span class="hljs-string">enabled</span><br>                <span class="hljs-attr">properties:</span><br>                  <span class="hljs-attr">secretKeyRef:</span><br>                    <span class="hljs-attr">description:</span> <span class="hljs-string">Selects</span> <span class="hljs-string">a</span> <span class="hljs-string">key</span> <span class="hljs-string">of</span> <span class="hljs-string">a</span> <span class="hljs-string">secret</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">node</span> <span class="hljs-string">pod&#x27;s</span> <span class="hljs-string">namespace.</span><br>                    <span class="hljs-attr">properties:</span><br>                      <span class="hljs-attr">key:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">The</span> <span class="hljs-string">key</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">secret</span> <span class="hljs-string">to</span> <span class="hljs-string">select</span> <span class="hljs-string">from.</span>  <span class="hljs-string">Must</span> <span class="hljs-string">be</span><br>                          <span class="hljs-string">a</span> <span class="hljs-string">valid</span> <span class="hljs-string">secret</span> <span class="hljs-string">key.</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">name:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names</span><br><span class="hljs-string">                          TODO: Add other useful fields. apiVersion, kind, uid?&#x27;</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">optional:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">Specify</span> <span class="hljs-string">whether</span> <span class="hljs-string">the</span> <span class="hljs-string">Secret</span> <span class="hljs-string">or</span> <span class="hljs-string">its</span> <span class="hljs-string">key</span> <span class="hljs-string">must</span> <span class="hljs-string">be</span><br>                          <span class="hljs-string">defined</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>                    <span class="hljs-attr">required:</span><br>                    <span class="hljs-bullet">-</span> <span class="hljs-string">key</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>              <span class="hljs-attr">nodeToNodeMeshEnabled:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;NodeToNodeMeshEnabled sets whether full node to node</span><br><span class="hljs-string">                  BGP mesh is enabled. [Default: true]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">prefixAdvertisements:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">PrefixAdvertisements</span> <span class="hljs-string">contains</span> <span class="hljs-string">per-prefix</span> <span class="hljs-string">advertisement</span><br>                  <span class="hljs-string">configuration.</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">description:</span> <span class="hljs-string">PrefixAdvertisement</span> <span class="hljs-string">configures</span> <span class="hljs-string">advertisement</span> <span class="hljs-string">properties</span><br>                    <span class="hljs-string">for</span> <span class="hljs-string">the</span> <span class="hljs-string">specified</span> <span class="hljs-string">CIDR.</span><br>                  <span class="hljs-attr">properties:</span><br>                    <span class="hljs-attr">cidr:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">CIDR</span> <span class="hljs-string">for</span> <span class="hljs-string">which</span> <span class="hljs-string">properties</span> <span class="hljs-string">should</span> <span class="hljs-string">be</span> <span class="hljs-string">advertised.</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                    <span class="hljs-attr">communities:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">Communities</span> <span class="hljs-string">can</span> <span class="hljs-string">be</span> <span class="hljs-string">list</span> <span class="hljs-string">of</span> <span class="hljs-string">either</span> <span class="hljs-string">community</span> <span class="hljs-string">names</span><br>                        <span class="hljs-string">already</span> <span class="hljs-string">defined</span> <span class="hljs-string">in</span> <span class="hljs-string">`Specs.Communities`</span> <span class="hljs-string">or</span> <span class="hljs-string">community</span> <span class="hljs-string">value</span><br>                        <span class="hljs-string">of</span> <span class="hljs-string">format</span> <span class="hljs-string">`aa:nn`</span> <span class="hljs-string">or</span> <span class="hljs-string">`aa:nn:mm`.</span> <span class="hljs-string">For</span> <span class="hljs-string">standard</span> <span class="hljs-string">community</span> <span class="hljs-string">use</span><br>                        <span class="hljs-string">`aa:nn`</span> <span class="hljs-string">format,</span> <span class="hljs-string">where</span> <span class="hljs-string">`aa`</span> <span class="hljs-string">and</span> <span class="hljs-string">`nn`</span> <span class="hljs-string">are</span> <span class="hljs-number">16</span> <span class="hljs-string">bit</span> <span class="hljs-string">number.</span> <span class="hljs-string">For</span><br>                        <span class="hljs-string">large</span> <span class="hljs-string">community</span> <span class="hljs-string">use</span> <span class="hljs-string">`aa:nn:mm`</span> <span class="hljs-string">format,</span> <span class="hljs-string">where</span> <span class="hljs-string">`aa`,</span> <span class="hljs-string">`nn`</span> <span class="hljs-string">and</span><br>                        <span class="hljs-string">`mm`</span> <span class="hljs-string">are</span> <span class="hljs-number">32</span> <span class="hljs-string">bit</span> <span class="hljs-string">number.</span> <span class="hljs-string">Where,`aa`</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">AS</span> <span class="hljs-string">Number,</span> <span class="hljs-string">`nn`</span> <span class="hljs-string">and</span><br>                        <span class="hljs-string">`mm`</span> <span class="hljs-string">are</span> <span class="hljs-string">per-AS</span> <span class="hljs-string">identifier.</span><br>                      <span class="hljs-attr">items:</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>              <span class="hljs-attr">serviceClusterIPs:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">ServiceClusterIPs</span> <span class="hljs-string">are</span> <span class="hljs-string">the</span> <span class="hljs-string">CIDR</span> <span class="hljs-string">blocks</span> <span class="hljs-string">from</span> <span class="hljs-string">which</span> <span class="hljs-string">service</span><br>                  <span class="hljs-string">cluster</span> <span class="hljs-string">IPs</span> <span class="hljs-string">are</span> <span class="hljs-string">allocated.</span> <span class="hljs-string">If</span> <span class="hljs-string">specified,</span> <span class="hljs-string">Calico</span> <span class="hljs-string">will</span> <span class="hljs-string">advertise</span> <span class="hljs-string">these</span><br>                  <span class="hljs-string">blocks,</span> <span class="hljs-string">as</span> <span class="hljs-string">well</span> <span class="hljs-string">as</span> <span class="hljs-string">any</span> <span class="hljs-string">cluster</span> <span class="hljs-string">IPs</span> <span class="hljs-string">within</span> <span class="hljs-string">them.</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">description:</span> <span class="hljs-string">ServiceClusterIPBlock</span> <span class="hljs-string">represents</span> <span class="hljs-string">a</span> <span class="hljs-string">single</span> <span class="hljs-string">allowed</span> <span class="hljs-string">ClusterIP</span><br>                    <span class="hljs-string">CIDR</span> <span class="hljs-string">block.</span><br>                  <span class="hljs-attr">properties:</span><br>                    <span class="hljs-attr">cidr:</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>              <span class="hljs-attr">serviceExternalIPs:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">ServiceExternalIPs</span> <span class="hljs-string">are</span> <span class="hljs-string">the</span> <span class="hljs-string">CIDR</span> <span class="hljs-string">blocks</span> <span class="hljs-string">for</span> <span class="hljs-string">Kubernetes</span><br>                  <span class="hljs-string">Service</span> <span class="hljs-string">External</span> <span class="hljs-string">IPs.</span> <span class="hljs-string">Kubernetes</span> <span class="hljs-string">Service</span> <span class="hljs-string">ExternalIPs</span> <span class="hljs-string">will</span> <span class="hljs-string">only</span> <span class="hljs-string">be</span><br>                  <span class="hljs-string">advertised</span> <span class="hljs-string">if</span> <span class="hljs-string">they</span> <span class="hljs-string">are</span> <span class="hljs-string">within</span> <span class="hljs-string">one</span> <span class="hljs-string">of</span> <span class="hljs-string">these</span> <span class="hljs-string">blocks.</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">description:</span> <span class="hljs-string">ServiceExternalIPBlock</span> <span class="hljs-string">represents</span> <span class="hljs-string">a</span> <span class="hljs-string">single</span> <span class="hljs-string">allowed</span><br>                    <span class="hljs-string">External</span> <span class="hljs-string">IP</span> <span class="hljs-string">CIDR</span> <span class="hljs-string">block.</span><br>                  <span class="hljs-attr">properties:</span><br>                    <span class="hljs-attr">cidr:</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>              <span class="hljs-attr">serviceLoadBalancerIPs:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">ServiceLoadBalancerIPs</span> <span class="hljs-string">are</span> <span class="hljs-string">the</span> <span class="hljs-string">CIDR</span> <span class="hljs-string">blocks</span> <span class="hljs-string">for</span> <span class="hljs-string">Kubernetes</span><br>                  <span class="hljs-string">Service</span> <span class="hljs-string">LoadBalancer</span> <span class="hljs-string">IPs.</span> <span class="hljs-string">Kubernetes</span> <span class="hljs-string">Service</span> <span class="hljs-string">status.LoadBalancer.Ingress</span><br>                  <span class="hljs-string">IPs</span> <span class="hljs-string">will</span> <span class="hljs-string">only</span> <span class="hljs-string">be</span> <span class="hljs-string">advertised</span> <span class="hljs-string">if</span> <span class="hljs-string">they</span> <span class="hljs-string">are</span> <span class="hljs-string">within</span> <span class="hljs-string">one</span> <span class="hljs-string">of</span> <span class="hljs-string">these</span> <span class="hljs-string">blocks.</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">description:</span> <span class="hljs-string">ServiceLoadBalancerIPBlock</span> <span class="hljs-string">represents</span> <span class="hljs-string">a</span> <span class="hljs-string">single</span> <span class="hljs-string">allowed</span><br>                    <span class="hljs-string">LoadBalancer</span> <span class="hljs-string">IP</span> <span class="hljs-string">CIDR</span> <span class="hljs-string">block.</span><br>                  <span class="hljs-attr">properties:</span><br>                    <span class="hljs-attr">cidr:</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>    <span class="hljs-attr">served:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">storage:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">status:</span><br>  <span class="hljs-attr">acceptedNames:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">conditions:</span> []<br>  <span class="hljs-attr">storedVersions:</span> []<br><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/kdd-crds.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apiextensions.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">CustomResourceDefinition</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">bgppeers.crd.projectcalico.org</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">group:</span> <span class="hljs-string">crd.projectcalico.org</span><br>  <span class="hljs-attr">names:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">BGPPeer</span><br>    <span class="hljs-attr">listKind:</span> <span class="hljs-string">BGPPeerList</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">bgppeers</span><br>    <span class="hljs-attr">singular:</span> <span class="hljs-string">bgppeer</span><br>  <span class="hljs-attr">preserveUnknownFields:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">scope:</span> <span class="hljs-string">Cluster</span><br>  <span class="hljs-attr">versions:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">v1</span><br>    <span class="hljs-attr">schema:</span><br>      <span class="hljs-attr">openAPIV3Schema:</span><br>        <span class="hljs-attr">properties:</span><br>          <span class="hljs-attr">apiVersion:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;APIVersion defines the versioned schema of this representation</span><br><span class="hljs-string">              of an object. Servers should convert recognized schemas to the latest</span><br><span class="hljs-string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">kind:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Kind is a string value representing the REST resource this</span><br><span class="hljs-string">              object represents. Servers may infer this from the endpoint the client</span><br><span class="hljs-string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">metadata:</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>          <span class="hljs-attr">spec:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">BGPPeerSpec</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">specification</span> <span class="hljs-string">for</span> <span class="hljs-string">a</span> <span class="hljs-string">BGPPeer</span> <span class="hljs-string">resource.</span><br>            <span class="hljs-attr">properties:</span><br>              <span class="hljs-attr">asNumber:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">The</span> <span class="hljs-string">AS</span> <span class="hljs-string">Number</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">peer.</span><br>                <span class="hljs-attr">format:</span> <span class="hljs-string">int32</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">keepOriginalNextHop:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Option</span> <span class="hljs-string">to</span> <span class="hljs-string">keep</span> <span class="hljs-string">the</span> <span class="hljs-string">original</span> <span class="hljs-string">nexthop</span> <span class="hljs-string">field</span> <span class="hljs-string">when</span> <span class="hljs-string">routes</span><br>                  <span class="hljs-string">are</span> <span class="hljs-string">sent</span> <span class="hljs-string">to</span> <span class="hljs-string">a</span> <span class="hljs-string">BGP</span> <span class="hljs-string">Peer.</span> <span class="hljs-string">Setting</span> <span class="hljs-string">&quot;true&quot;</span> <span class="hljs-string">configures</span> <span class="hljs-string">the</span> <span class="hljs-string">selected</span> <span class="hljs-string">BGP</span><br>                  <span class="hljs-string">Peers</span> <span class="hljs-string">node</span> <span class="hljs-string">to</span> <span class="hljs-string">use</span> <span class="hljs-string">the</span> <span class="hljs-string">&quot;next hop keep;&quot;</span> <span class="hljs-string">instead</span> <span class="hljs-string">of</span> <span class="hljs-string">&quot;next hop self;&quot;</span><span class="hljs-string">(default)</span><br>                  <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">specific</span> <span class="hljs-string">branch</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Node</span> <span class="hljs-string">on</span> <span class="hljs-string">&quot;bird.cfg&quot;</span><span class="hljs-string">.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">maxRestartTime:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Time</span> <span class="hljs-string">to</span> <span class="hljs-string">allow</span> <span class="hljs-string">for</span> <span class="hljs-string">software</span> <span class="hljs-string">restart.</span>  <span class="hljs-string">When</span> <span class="hljs-string">specified,</span><br>                  <span class="hljs-string">this</span> <span class="hljs-string">is</span> <span class="hljs-string">configured</span> <span class="hljs-string">as</span> <span class="hljs-string">the</span> <span class="hljs-string">graceful</span> <span class="hljs-string">restart</span> <span class="hljs-string">timeout.</span>  <span class="hljs-string">When</span> <span class="hljs-string">not</span> <span class="hljs-string">specified,</span><br>                  <span class="hljs-string">the</span> <span class="hljs-string">BIRD</span> <span class="hljs-string">default</span> <span class="hljs-string">of</span> <span class="hljs-string">120s</span> <span class="hljs-string">is</span> <span class="hljs-string">used.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">node:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">The</span> <span class="hljs-string">node</span> <span class="hljs-string">name</span> <span class="hljs-string">identifying</span> <span class="hljs-string">the</span> <span class="hljs-string">Calico</span> <span class="hljs-string">node</span> <span class="hljs-string">instance</span> <span class="hljs-string">that</span><br>                  <span class="hljs-string">is</span> <span class="hljs-string">targeted</span> <span class="hljs-string">by</span> <span class="hljs-string">this</span> <span class="hljs-string">peer.</span> <span class="hljs-string">If</span> <span class="hljs-string">this</span> <span class="hljs-string">is</span> <span class="hljs-string">not</span> <span class="hljs-string">set,</span> <span class="hljs-string">and</span> <span class="hljs-literal">no</span> <span class="hljs-string">nodeSelector</span><br>                  <span class="hljs-string">is</span> <span class="hljs-string">specified,</span> <span class="hljs-string">then</span> <span class="hljs-string">this</span> <span class="hljs-string">BGP</span> <span class="hljs-string">peer</span> <span class="hljs-string">selects</span> <span class="hljs-string">all</span> <span class="hljs-string">nodes</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">cluster.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">nodeSelector:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Selector</span> <span class="hljs-string">for</span> <span class="hljs-string">the</span> <span class="hljs-string">nodes</span> <span class="hljs-string">that</span> <span class="hljs-string">should</span> <span class="hljs-string">have</span> <span class="hljs-string">this</span> <span class="hljs-string">peering.</span>  <span class="hljs-string">When</span><br>                  <span class="hljs-string">this</span> <span class="hljs-string">is</span> <span class="hljs-string">set,</span> <span class="hljs-string">the</span> <span class="hljs-string">Node</span> <span class="hljs-string">field</span> <span class="hljs-string">must</span> <span class="hljs-string">be</span> <span class="hljs-string">empty.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">numAllowedLocalASNumbers:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Maximum</span> <span class="hljs-string">number</span> <span class="hljs-string">of</span> <span class="hljs-string">local</span> <span class="hljs-string">AS</span> <span class="hljs-string">numbers</span> <span class="hljs-string">that</span> <span class="hljs-string">are</span> <span class="hljs-string">allowed</span> <span class="hljs-string">in</span><br>                  <span class="hljs-string">the</span> <span class="hljs-string">AS</span> <span class="hljs-string">path</span> <span class="hljs-string">for</span> <span class="hljs-string">received</span> <span class="hljs-string">routes.</span> <span class="hljs-string">This</span> <span class="hljs-string">removes</span> <span class="hljs-string">BGP</span> <span class="hljs-string">loop</span> <span class="hljs-string">prevention</span><br>                  <span class="hljs-string">and</span> <span class="hljs-string">should</span> <span class="hljs-string">only</span> <span class="hljs-string">be</span> <span class="hljs-string">used</span> <span class="hljs-string">if</span> <span class="hljs-string">absolutely</span> <span class="hljs-string">necesssary.</span><br>                <span class="hljs-attr">format:</span> <span class="hljs-string">int32</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">password:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Optional</span> <span class="hljs-string">BGP</span> <span class="hljs-string">password</span> <span class="hljs-string">for</span> <span class="hljs-string">the</span> <span class="hljs-string">peerings</span> <span class="hljs-string">generated</span> <span class="hljs-string">by</span> <span class="hljs-string">this</span><br>                  <span class="hljs-string">BGPPeer</span> <span class="hljs-string">resource.</span><br>                <span class="hljs-attr">properties:</span><br>                  <span class="hljs-attr">secretKeyRef:</span><br>                    <span class="hljs-attr">description:</span> <span class="hljs-string">Selects</span> <span class="hljs-string">a</span> <span class="hljs-string">key</span> <span class="hljs-string">of</span> <span class="hljs-string">a</span> <span class="hljs-string">secret</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">node</span> <span class="hljs-string">pod&#x27;s</span> <span class="hljs-string">namespace.</span><br>                    <span class="hljs-attr">properties:</span><br>                      <span class="hljs-attr">key:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">The</span> <span class="hljs-string">key</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">secret</span> <span class="hljs-string">to</span> <span class="hljs-string">select</span> <span class="hljs-string">from.</span>  <span class="hljs-string">Must</span> <span class="hljs-string">be</span><br>                          <span class="hljs-string">a</span> <span class="hljs-string">valid</span> <span class="hljs-string">secret</span> <span class="hljs-string">key.</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">name:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names</span><br><span class="hljs-string">                          TODO: Add other useful fields. apiVersion, kind, uid?&#x27;</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">optional:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">Specify</span> <span class="hljs-string">whether</span> <span class="hljs-string">the</span> <span class="hljs-string">Secret</span> <span class="hljs-string">or</span> <span class="hljs-string">its</span> <span class="hljs-string">key</span> <span class="hljs-string">must</span> <span class="hljs-string">be</span><br>                          <span class="hljs-string">defined</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>                    <span class="hljs-attr">required:</span><br>                    <span class="hljs-bullet">-</span> <span class="hljs-string">key</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>              <span class="hljs-attr">peerIP:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">The</span> <span class="hljs-string">IP</span> <span class="hljs-string">address</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">peer</span> <span class="hljs-string">followed</span> <span class="hljs-string">by</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">port</span><br>                  <span class="hljs-string">number</span> <span class="hljs-string">to</span> <span class="hljs-string">peer</span> <span class="hljs-string">with.</span> <span class="hljs-string">If</span> <span class="hljs-string">port</span> <span class="hljs-string">number</span> <span class="hljs-string">is</span> <span class="hljs-string">given,</span> <span class="hljs-string">format</span> <span class="hljs-string">should</span> <span class="hljs-string">be</span> <span class="hljs-string">`[&lt;IPv6&gt;]:port`</span><br>                  <span class="hljs-string">or</span> <span class="hljs-string">`&lt;IPv4&gt;:&lt;port&gt;`</span> <span class="hljs-string">for</span> <span class="hljs-string">IPv4.</span> <span class="hljs-string">If</span> <span class="hljs-string">optional</span> <span class="hljs-string">port</span> <span class="hljs-string">number</span> <span class="hljs-string">is</span> <span class="hljs-string">not</span> <span class="hljs-string">set,</span><br>                  <span class="hljs-string">and</span> <span class="hljs-string">this</span> <span class="hljs-string">peer</span> <span class="hljs-string">IP</span> <span class="hljs-string">and</span> <span class="hljs-string">ASNumber</span> <span class="hljs-string">belongs</span> <span class="hljs-string">to</span> <span class="hljs-string">a</span> <span class="hljs-string">calico/node</span> <span class="hljs-string">with</span> <span class="hljs-string">ListenPort</span><br>                  <span class="hljs-string">set</span> <span class="hljs-string">in</span> <span class="hljs-string">BGPConfiguration,</span> <span class="hljs-string">then</span> <span class="hljs-string">we</span> <span class="hljs-string">use</span> <span class="hljs-string">that</span> <span class="hljs-string">port</span> <span class="hljs-string">to</span> <span class="hljs-string">peer.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">peerSelector:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Selector</span> <span class="hljs-string">for</span> <span class="hljs-string">the</span> <span class="hljs-string">remote</span> <span class="hljs-string">nodes</span> <span class="hljs-string">to</span> <span class="hljs-string">peer</span> <span class="hljs-string">with.</span>  <span class="hljs-string">When</span> <span class="hljs-string">this</span><br>                  <span class="hljs-string">is</span> <span class="hljs-string">set,</span> <span class="hljs-string">the</span> <span class="hljs-string">PeerIP</span> <span class="hljs-string">and</span> <span class="hljs-string">ASNumber</span> <span class="hljs-string">fields</span> <span class="hljs-string">must</span> <span class="hljs-string">be</span> <span class="hljs-string">empty.</span>  <span class="hljs-string">For</span> <span class="hljs-string">each</span><br>                  <span class="hljs-string">peering</span> <span class="hljs-string">between</span> <span class="hljs-string">the</span> <span class="hljs-string">local</span> <span class="hljs-string">node</span> <span class="hljs-string">and</span> <span class="hljs-string">selected</span> <span class="hljs-string">remote</span> <span class="hljs-string">nodes,</span> <span class="hljs-string">we</span> <span class="hljs-string">configure</span><br>                  <span class="hljs-string">an</span> <span class="hljs-string">IPv4</span> <span class="hljs-string">peering</span> <span class="hljs-string">if</span> <span class="hljs-string">both</span> <span class="hljs-string">ends</span> <span class="hljs-string">have</span> <span class="hljs-string">NodeBGPSpec.IPv4Address</span> <span class="hljs-string">specified,</span><br>                  <span class="hljs-string">and</span> <span class="hljs-string">an</span> <span class="hljs-string">IPv6</span> <span class="hljs-string">peering</span> <span class="hljs-string">if</span> <span class="hljs-string">both</span> <span class="hljs-string">ends</span> <span class="hljs-string">have</span> <span class="hljs-string">NodeBGPSpec.IPv6Address</span> <span class="hljs-string">specified.</span>  <span class="hljs-string">The</span><br>                  <span class="hljs-string">remote</span> <span class="hljs-string">AS</span> <span class="hljs-string">number</span> <span class="hljs-string">comes</span> <span class="hljs-string">from</span> <span class="hljs-string">the</span> <span class="hljs-string">remote</span> <span class="hljs-string">node&#x27;s</span> <span class="hljs-string">NodeBGPSpec.ASNumber,</span><br>                  <span class="hljs-string">or</span> <span class="hljs-string">the</span> <span class="hljs-string">global</span> <span class="hljs-string">default</span> <span class="hljs-string">if</span> <span class="hljs-string">that</span> <span class="hljs-string">is</span> <span class="hljs-string">not</span> <span class="hljs-string">set.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">reachableBy:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Add</span> <span class="hljs-string">an</span> <span class="hljs-string">exact,</span> <span class="hljs-string">i.e.</span> <span class="hljs-string">/32,</span> <span class="hljs-string">static</span> <span class="hljs-string">route</span> <span class="hljs-string">toward</span> <span class="hljs-string">peer</span> <span class="hljs-string">IP</span> <span class="hljs-string">in</span><br>                  <span class="hljs-string">order</span> <span class="hljs-string">to</span> <span class="hljs-string">prevent</span> <span class="hljs-string">route</span> <span class="hljs-string">flapping.</span> <span class="hljs-string">ReachableBy</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">address</span><br>                  <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">gateway</span> <span class="hljs-string">which</span> <span class="hljs-string">peer</span> <span class="hljs-string">can</span> <span class="hljs-string">be</span> <span class="hljs-string">reached</span> <span class="hljs-string">by.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">sourceAddress:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Specifies</span> <span class="hljs-string">whether</span> <span class="hljs-string">and</span> <span class="hljs-string">how</span> <span class="hljs-string">to</span> <span class="hljs-string">configure</span> <span class="hljs-string">a</span> <span class="hljs-string">source</span> <span class="hljs-string">address</span><br>                  <span class="hljs-string">for</span> <span class="hljs-string">the</span> <span class="hljs-string">peerings</span> <span class="hljs-string">generated</span> <span class="hljs-string">by</span> <span class="hljs-string">this</span> <span class="hljs-string">BGPPeer</span> <span class="hljs-string">resource.</span>  <span class="hljs-string">Default</span> <span class="hljs-string">value</span><br>                  <span class="hljs-string">&quot;UseNodeIP&quot;</span> <span class="hljs-string">means</span> <span class="hljs-string">to</span> <span class="hljs-string">configure</span> <span class="hljs-string">the</span> <span class="hljs-string">node</span> <span class="hljs-string">IP</span> <span class="hljs-string">as</span> <span class="hljs-string">the</span> <span class="hljs-string">source</span> <span class="hljs-string">address.</span>  <span class="hljs-string">&quot;None&quot;</span><br>                  <span class="hljs-string">means</span> <span class="hljs-string">not</span> <span class="hljs-string">to</span> <span class="hljs-string">configure</span> <span class="hljs-string">a</span> <span class="hljs-string">source</span> <span class="hljs-string">address.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">ttlSecurity:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">TTLSecurity</span> <span class="hljs-string">enables</span> <span class="hljs-string">the</span> <span class="hljs-string">generalized</span> <span class="hljs-string">TTL</span> <span class="hljs-string">security</span> <span class="hljs-string">mechanism</span><br>                  <span class="hljs-string">(GTSM)</span> <span class="hljs-string">which</span> <span class="hljs-string">protects</span> <span class="hljs-string">against</span> <span class="hljs-string">spoofed</span> <span class="hljs-string">packets</span> <span class="hljs-string">by</span> <span class="hljs-string">ignoring</span> <span class="hljs-string">received</span><br>                  <span class="hljs-string">packets</span> <span class="hljs-string">with</span> <span class="hljs-string">a</span> <span class="hljs-string">smaller</span> <span class="hljs-string">than</span> <span class="hljs-string">expected</span> <span class="hljs-string">TTL</span> <span class="hljs-string">value.</span> <span class="hljs-string">The</span> <span class="hljs-string">provided</span> <span class="hljs-string">value</span><br>                  <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">number</span> <span class="hljs-string">of</span> <span class="hljs-string">hops</span> <span class="hljs-string">(edges)</span> <span class="hljs-string">between</span> <span class="hljs-string">the</span> <span class="hljs-string">peers.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>    <span class="hljs-attr">served:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">storage:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">status:</span><br>  <span class="hljs-attr">acceptedNames:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">conditions:</span> []<br>  <span class="hljs-attr">storedVersions:</span> []<br><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/kdd-crds.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apiextensions.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">CustomResourceDefinition</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">blockaffinities.crd.projectcalico.org</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">group:</span> <span class="hljs-string">crd.projectcalico.org</span><br>  <span class="hljs-attr">names:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">BlockAffinity</span><br>    <span class="hljs-attr">listKind:</span> <span class="hljs-string">BlockAffinityList</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">blockaffinities</span><br>    <span class="hljs-attr">singular:</span> <span class="hljs-string">blockaffinity</span><br>  <span class="hljs-attr">preserveUnknownFields:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">scope:</span> <span class="hljs-string">Cluster</span><br>  <span class="hljs-attr">versions:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">v1</span><br>    <span class="hljs-attr">schema:</span><br>      <span class="hljs-attr">openAPIV3Schema:</span><br>        <span class="hljs-attr">properties:</span><br>          <span class="hljs-attr">apiVersion:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;APIVersion defines the versioned schema of this representation</span><br><span class="hljs-string">              of an object. Servers should convert recognized schemas to the latest</span><br><span class="hljs-string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">kind:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Kind is a string value representing the REST resource this</span><br><span class="hljs-string">              object represents. Servers may infer this from the endpoint the client</span><br><span class="hljs-string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">metadata:</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>          <span class="hljs-attr">spec:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">BlockAffinitySpec</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">specification</span> <span class="hljs-string">for</span> <span class="hljs-string">a</span> <span class="hljs-string">BlockAffinity</span><br>              <span class="hljs-string">resource.</span><br>            <span class="hljs-attr">properties:</span><br>              <span class="hljs-attr">cidr:</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">deleted:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Deleted</span> <span class="hljs-string">indicates</span> <span class="hljs-string">that</span> <span class="hljs-string">this</span> <span class="hljs-string">block</span> <span class="hljs-string">affinity</span> <span class="hljs-string">is</span> <span class="hljs-string">being</span> <span class="hljs-string">deleted.</span><br>                  <span class="hljs-string">This</span> <span class="hljs-string">field</span> <span class="hljs-string">is</span> <span class="hljs-string">a</span> <span class="hljs-string">string</span> <span class="hljs-string">for</span> <span class="hljs-string">compatibility</span> <span class="hljs-string">with</span> <span class="hljs-string">older</span> <span class="hljs-string">releases</span> <span class="hljs-string">that</span><br>                  <span class="hljs-string">mistakenly</span> <span class="hljs-string">treat</span> <span class="hljs-string">this</span> <span class="hljs-string">field</span> <span class="hljs-string">as</span> <span class="hljs-string">a</span> <span class="hljs-string">string.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">node:</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">state:</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>            <span class="hljs-attr">required:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">cidr</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">deleted</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">node</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">state</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>    <span class="hljs-attr">served:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">storage:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">status:</span><br>  <span class="hljs-attr">acceptedNames:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">conditions:</span> []<br>  <span class="hljs-attr">storedVersions:</span> []<br><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/kdd-crds.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apiextensions.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">CustomResourceDefinition</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">annotations:</span><br>    <span class="hljs-attr">controller-gen.kubebuilder.io/version:</span> <span class="hljs-string">(devel)</span><br>  <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-literal">null</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">caliconodestatuses.crd.projectcalico.org</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">group:</span> <span class="hljs-string">crd.projectcalico.org</span><br>  <span class="hljs-attr">names:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">CalicoNodeStatus</span><br>    <span class="hljs-attr">listKind:</span> <span class="hljs-string">CalicoNodeStatusList</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">caliconodestatuses</span><br>    <span class="hljs-attr">singular:</span> <span class="hljs-string">caliconodestatus</span><br>  <span class="hljs-attr">preserveUnknownFields:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">scope:</span> <span class="hljs-string">Cluster</span><br>  <span class="hljs-attr">versions:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">v1</span><br>    <span class="hljs-attr">schema:</span><br>      <span class="hljs-attr">openAPIV3Schema:</span><br>        <span class="hljs-attr">properties:</span><br>          <span class="hljs-attr">apiVersion:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;APIVersion defines the versioned schema of this representation</span><br><span class="hljs-string">              of an object. Servers should convert recognized schemas to the latest</span><br><span class="hljs-string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">kind:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Kind is a string value representing the REST resource this</span><br><span class="hljs-string">              object represents. Servers may infer this from the endpoint the client</span><br><span class="hljs-string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">metadata:</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>          <span class="hljs-attr">spec:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">CalicoNodeStatusSpec</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">specification</span> <span class="hljs-string">for</span> <span class="hljs-string">a</span> <span class="hljs-string">CalicoNodeStatus</span><br>              <span class="hljs-string">resource.</span><br>            <span class="hljs-attr">properties:</span><br>              <span class="hljs-attr">classes:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Classes</span> <span class="hljs-string">declares</span> <span class="hljs-string">the</span> <span class="hljs-string">types</span> <span class="hljs-string">of</span> <span class="hljs-string">information</span> <span class="hljs-string">to</span> <span class="hljs-string">monitor</span><br>                  <span class="hljs-string">for</span> <span class="hljs-string">this</span> <span class="hljs-string">calico/node,</span> <span class="hljs-string">and</span> <span class="hljs-string">allows</span> <span class="hljs-string">for</span> <span class="hljs-string">selective</span> <span class="hljs-string">status</span> <span class="hljs-string">reporting</span><br>                  <span class="hljs-string">about</span> <span class="hljs-string">certain</span> <span class="hljs-string">subsets</span> <span class="hljs-string">of</span> <span class="hljs-string">information.</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>              <span class="hljs-attr">node:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">The</span> <span class="hljs-string">node</span> <span class="hljs-string">name</span> <span class="hljs-string">identifies</span> <span class="hljs-string">the</span> <span class="hljs-string">Calico</span> <span class="hljs-string">node</span> <span class="hljs-string">instance</span> <span class="hljs-string">for</span><br>                  <span class="hljs-string">node</span> <span class="hljs-string">status.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">updatePeriodSeconds:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">UpdatePeriodSeconds</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">period</span> <span class="hljs-string">at</span> <span class="hljs-string">which</span> <span class="hljs-string">CalicoNodeStatus</span><br>                  <span class="hljs-string">should</span> <span class="hljs-string">be</span> <span class="hljs-string">updated.</span> <span class="hljs-string">Set</span> <span class="hljs-string">to</span> <span class="hljs-number">0</span> <span class="hljs-string">to</span> <span class="hljs-string">disable</span> <span class="hljs-string">CalicoNodeStatus</span> <span class="hljs-string">refresh.</span><br>                  <span class="hljs-string">Maximum</span> <span class="hljs-string">update</span> <span class="hljs-string">period</span> <span class="hljs-string">is</span> <span class="hljs-string">one</span> <span class="hljs-string">day.</span><br>                <span class="hljs-attr">format:</span> <span class="hljs-string">int32</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>          <span class="hljs-attr">status:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">CalicoNodeStatusStatus</span> <span class="hljs-string">defines</span> <span class="hljs-string">the</span> <span class="hljs-string">observed</span> <span class="hljs-string">state</span> <span class="hljs-string">of</span> <span class="hljs-string">CalicoNodeStatus.</span><br>              <span class="hljs-literal">No</span> <span class="hljs-string">validation</span> <span class="hljs-string">needed</span> <span class="hljs-string">for</span> <span class="hljs-string">status</span> <span class="hljs-string">since</span> <span class="hljs-string">it</span> <span class="hljs-string">is</span> <span class="hljs-string">updated</span> <span class="hljs-string">by</span> <span class="hljs-string">Calico.</span><br>            <span class="hljs-attr">properties:</span><br>              <span class="hljs-attr">agent:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Agent</span> <span class="hljs-string">holds</span> <span class="hljs-string">agent</span> <span class="hljs-string">status</span> <span class="hljs-string">on</span> <span class="hljs-string">the</span> <span class="hljs-string">node.</span><br>                <span class="hljs-attr">properties:</span><br>                  <span class="hljs-attr">birdV4:</span><br>                    <span class="hljs-attr">description:</span> <span class="hljs-string">BIRDV4</span> <span class="hljs-string">represents</span> <span class="hljs-string">the</span> <span class="hljs-string">latest</span> <span class="hljs-string">observed</span> <span class="hljs-string">status</span> <span class="hljs-string">of</span> <span class="hljs-string">bird4.</span><br>                    <span class="hljs-attr">properties:</span><br>                      <span class="hljs-attr">lastBootTime:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">LastBootTime</span> <span class="hljs-string">holds</span> <span class="hljs-string">the</span> <span class="hljs-string">value</span> <span class="hljs-string">of</span> <span class="hljs-string">lastBootTime</span><br>                          <span class="hljs-string">from</span> <span class="hljs-string">bird.ctl</span> <span class="hljs-string">output.</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">lastReconfigurationTime:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">LastReconfigurationTime</span> <span class="hljs-string">holds</span> <span class="hljs-string">the</span> <span class="hljs-string">value</span> <span class="hljs-string">of</span> <span class="hljs-string">lastReconfigTime</span><br>                          <span class="hljs-string">from</span> <span class="hljs-string">bird.ctl</span> <span class="hljs-string">output.</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">routerID:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">Router</span> <span class="hljs-string">ID</span> <span class="hljs-string">used</span> <span class="hljs-string">by</span> <span class="hljs-string">bird.</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">state:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">The</span> <span class="hljs-string">state</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">BGP</span> <span class="hljs-string">Daemon.</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">version:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">Version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">BGP</span> <span class="hljs-string">daemon</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                  <span class="hljs-attr">birdV6:</span><br>                    <span class="hljs-attr">description:</span> <span class="hljs-string">BIRDV6</span> <span class="hljs-string">represents</span> <span class="hljs-string">the</span> <span class="hljs-string">latest</span> <span class="hljs-string">observed</span> <span class="hljs-string">status</span> <span class="hljs-string">of</span> <span class="hljs-string">bird6.</span><br>                    <span class="hljs-attr">properties:</span><br>                      <span class="hljs-attr">lastBootTime:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">LastBootTime</span> <span class="hljs-string">holds</span> <span class="hljs-string">the</span> <span class="hljs-string">value</span> <span class="hljs-string">of</span> <span class="hljs-string">lastBootTime</span><br>                          <span class="hljs-string">from</span> <span class="hljs-string">bird.ctl</span> <span class="hljs-string">output.</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">lastReconfigurationTime:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">LastReconfigurationTime</span> <span class="hljs-string">holds</span> <span class="hljs-string">the</span> <span class="hljs-string">value</span> <span class="hljs-string">of</span> <span class="hljs-string">lastReconfigTime</span><br>                          <span class="hljs-string">from</span> <span class="hljs-string">bird.ctl</span> <span class="hljs-string">output.</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">routerID:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">Router</span> <span class="hljs-string">ID</span> <span class="hljs-string">used</span> <span class="hljs-string">by</span> <span class="hljs-string">bird.</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">state:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">The</span> <span class="hljs-string">state</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">BGP</span> <span class="hljs-string">Daemon.</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">version:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">Version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">BGP</span> <span class="hljs-string">daemon</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>              <span class="hljs-attr">bgp:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">BGP</span> <span class="hljs-string">holds</span> <span class="hljs-string">node</span> <span class="hljs-string">BGP</span> <span class="hljs-string">status.</span><br>                <span class="hljs-attr">properties:</span><br>                  <span class="hljs-attr">numberEstablishedV4:</span><br>                    <span class="hljs-attr">description:</span> <span class="hljs-string">The</span> <span class="hljs-string">total</span> <span class="hljs-string">number</span> <span class="hljs-string">of</span> <span class="hljs-string">IPv4</span> <span class="hljs-string">established</span> <span class="hljs-string">bgp</span> <span class="hljs-string">sessions.</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                  <span class="hljs-attr">numberEstablishedV6:</span><br>                    <span class="hljs-attr">description:</span> <span class="hljs-string">The</span> <span class="hljs-string">total</span> <span class="hljs-string">number</span> <span class="hljs-string">of</span> <span class="hljs-string">IPv6</span> <span class="hljs-string">established</span> <span class="hljs-string">bgp</span> <span class="hljs-string">sessions.</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                  <span class="hljs-attr">numberNotEstablishedV4:</span><br>                    <span class="hljs-attr">description:</span> <span class="hljs-string">The</span> <span class="hljs-string">total</span> <span class="hljs-string">number</span> <span class="hljs-string">of</span> <span class="hljs-string">IPv4</span> <span class="hljs-string">non-established</span> <span class="hljs-string">bgp</span> <span class="hljs-string">sessions.</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                  <span class="hljs-attr">numberNotEstablishedV6:</span><br>                    <span class="hljs-attr">description:</span> <span class="hljs-string">The</span> <span class="hljs-string">total</span> <span class="hljs-string">number</span> <span class="hljs-string">of</span> <span class="hljs-string">IPv6</span> <span class="hljs-string">non-established</span> <span class="hljs-string">bgp</span> <span class="hljs-string">sessions.</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                  <span class="hljs-attr">peersV4:</span><br>                    <span class="hljs-attr">description:</span> <span class="hljs-string">PeersV4</span> <span class="hljs-string">represents</span> <span class="hljs-string">IPv4</span> <span class="hljs-string">BGP</span> <span class="hljs-string">peers</span> <span class="hljs-string">status</span> <span class="hljs-string">on</span> <span class="hljs-string">the</span> <span class="hljs-string">node.</span><br>                    <span class="hljs-attr">items:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">CalicoNodePeer</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">status</span> <span class="hljs-string">of</span> <span class="hljs-string">BGP</span> <span class="hljs-string">peers</span><br>                        <span class="hljs-string">on</span> <span class="hljs-string">the</span> <span class="hljs-string">node.</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">peerIP:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">IP</span> <span class="hljs-string">address</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">peer</span> <span class="hljs-string">whose</span> <span class="hljs-string">condition</span> <span class="hljs-string">we</span> <span class="hljs-string">are</span><br>                            <span class="hljs-string">reporting.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">since:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Since</span> <span class="hljs-string">the</span> <span class="hljs-string">state</span> <span class="hljs-string">or</span> <span class="hljs-string">reason</span> <span class="hljs-string">last</span> <span class="hljs-string">changed.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">state:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">State</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">BGP</span> <span class="hljs-string">session</span> <span class="hljs-string">state.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">type:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Type</span> <span class="hljs-string">indicates</span> <span class="hljs-string">whether</span> <span class="hljs-string">this</span> <span class="hljs-string">peer</span> <span class="hljs-string">is</span> <span class="hljs-string">configured</span><br>                            <span class="hljs-string">via</span> <span class="hljs-string">the</span> <span class="hljs-string">node-to-node</span> <span class="hljs-string">mesh,</span> <span class="hljs-string">or</span> <span class="hljs-string">via</span> <span class="hljs-string">en</span> <span class="hljs-string">explicit</span> <span class="hljs-string">global</span> <span class="hljs-string">or</span><br>                            <span class="hljs-string">per-node</span> <span class="hljs-string">BGPPeer</span> <span class="hljs-string">object.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                  <span class="hljs-attr">peersV6:</span><br>                    <span class="hljs-attr">description:</span> <span class="hljs-string">PeersV6</span> <span class="hljs-string">represents</span> <span class="hljs-string">IPv6</span> <span class="hljs-string">BGP</span> <span class="hljs-string">peers</span> <span class="hljs-string">status</span> <span class="hljs-string">on</span> <span class="hljs-string">the</span> <span class="hljs-string">node.</span><br>                    <span class="hljs-attr">items:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">CalicoNodePeer</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">status</span> <span class="hljs-string">of</span> <span class="hljs-string">BGP</span> <span class="hljs-string">peers</span><br>                        <span class="hljs-string">on</span> <span class="hljs-string">the</span> <span class="hljs-string">node.</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">peerIP:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">IP</span> <span class="hljs-string">address</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">peer</span> <span class="hljs-string">whose</span> <span class="hljs-string">condition</span> <span class="hljs-string">we</span> <span class="hljs-string">are</span><br>                            <span class="hljs-string">reporting.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">since:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Since</span> <span class="hljs-string">the</span> <span class="hljs-string">state</span> <span class="hljs-string">or</span> <span class="hljs-string">reason</span> <span class="hljs-string">last</span> <span class="hljs-string">changed.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">state:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">State</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">BGP</span> <span class="hljs-string">session</span> <span class="hljs-string">state.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">type:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Type</span> <span class="hljs-string">indicates</span> <span class="hljs-string">whether</span> <span class="hljs-string">this</span> <span class="hljs-string">peer</span> <span class="hljs-string">is</span> <span class="hljs-string">configured</span><br>                            <span class="hljs-string">via</span> <span class="hljs-string">the</span> <span class="hljs-string">node-to-node</span> <span class="hljs-string">mesh,</span> <span class="hljs-string">or</span> <span class="hljs-string">via</span> <span class="hljs-string">en</span> <span class="hljs-string">explicit</span> <span class="hljs-string">global</span> <span class="hljs-string">or</span><br>                            <span class="hljs-string">per-node</span> <span class="hljs-string">BGPPeer</span> <span class="hljs-string">object.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                <span class="hljs-attr">required:</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">numberEstablishedV4</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">numberEstablishedV6</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">numberNotEstablishedV4</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">numberNotEstablishedV6</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>              <span class="hljs-attr">lastUpdated:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">LastUpdated</span> <span class="hljs-string">is</span> <span class="hljs-string">a</span> <span class="hljs-string">timestamp</span> <span class="hljs-string">representing</span> <span class="hljs-string">the</span> <span class="hljs-string">server</span> <span class="hljs-string">time</span><br>                  <span class="hljs-string">when</span> <span class="hljs-string">CalicoNodeStatus</span> <span class="hljs-string">object</span> <span class="hljs-string">last</span> <span class="hljs-string">updated.</span> <span class="hljs-string">It</span> <span class="hljs-string">is</span> <span class="hljs-string">represented</span> <span class="hljs-string">in</span><br>                  <span class="hljs-string">RFC3339</span> <span class="hljs-string">form</span> <span class="hljs-string">and</span> <span class="hljs-string">is</span> <span class="hljs-string">in</span> <span class="hljs-string">UTC.</span><br>                <span class="hljs-attr">format:</span> <span class="hljs-string">date-time</span><br>                <span class="hljs-attr">nullable:</span> <span class="hljs-literal">true</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">routes:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Routes</span> <span class="hljs-string">reports</span> <span class="hljs-string">routes</span> <span class="hljs-string">known</span> <span class="hljs-string">to</span> <span class="hljs-string">the</span> <span class="hljs-string">Calico</span> <span class="hljs-string">BGP</span> <span class="hljs-string">daemon</span><br>                  <span class="hljs-string">on</span> <span class="hljs-string">the</span> <span class="hljs-string">node.</span><br>                <span class="hljs-attr">properties:</span><br>                  <span class="hljs-attr">routesV4:</span><br>                    <span class="hljs-attr">description:</span> <span class="hljs-string">RoutesV4</span> <span class="hljs-string">represents</span> <span class="hljs-string">IPv4</span> <span class="hljs-string">routes</span> <span class="hljs-string">on</span> <span class="hljs-string">the</span> <span class="hljs-string">node.</span><br>                    <span class="hljs-attr">items:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">CalicoNodeRoute</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">status</span> <span class="hljs-string">of</span> <span class="hljs-string">BGP</span> <span class="hljs-string">routes</span><br>                        <span class="hljs-string">on</span> <span class="hljs-string">the</span> <span class="hljs-string">node.</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">destination:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Destination</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">route.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">gateway:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Gateway</span> <span class="hljs-string">for</span> <span class="hljs-string">the</span> <span class="hljs-string">destination.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">interface:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Interface</span> <span class="hljs-string">for</span> <span class="hljs-string">the</span> <span class="hljs-string">destination</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">learnedFrom:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">LearnedFrom</span> <span class="hljs-string">contains</span> <span class="hljs-string">information</span> <span class="hljs-string">regarding</span><br>                            <span class="hljs-string">where</span> <span class="hljs-string">this</span> <span class="hljs-string">route</span> <span class="hljs-string">originated.</span><br>                          <span class="hljs-attr">properties:</span><br>                            <span class="hljs-attr">peerIP:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">If</span> <span class="hljs-string">sourceType</span> <span class="hljs-string">is</span> <span class="hljs-string">NodeMesh</span> <span class="hljs-string">or</span> <span class="hljs-string">BGPPeer,</span> <span class="hljs-string">IP</span><br>                                <span class="hljs-string">address</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">router</span> <span class="hljs-string">that</span> <span class="hljs-string">sent</span> <span class="hljs-string">us</span> <span class="hljs-string">this</span> <span class="hljs-string">route.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">sourceType:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Type</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">source</span> <span class="hljs-string">where</span> <span class="hljs-string">a</span> <span class="hljs-string">route</span> <span class="hljs-string">is</span> <span class="hljs-string">learned</span><br>                                <span class="hljs-string">from.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                        <span class="hljs-attr">type:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Type</span> <span class="hljs-string">indicates</span> <span class="hljs-string">if</span> <span class="hljs-string">the</span> <span class="hljs-string">route</span> <span class="hljs-string">is</span> <span class="hljs-string">being</span> <span class="hljs-string">used</span> <span class="hljs-string">for</span><br>                            <span class="hljs-string">forwarding</span> <span class="hljs-string">or</span> <span class="hljs-string">not.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                  <span class="hljs-attr">routesV6:</span><br>                    <span class="hljs-attr">description:</span> <span class="hljs-string">RoutesV6</span> <span class="hljs-string">represents</span> <span class="hljs-string">IPv6</span> <span class="hljs-string">routes</span> <span class="hljs-string">on</span> <span class="hljs-string">the</span> <span class="hljs-string">node.</span><br>                    <span class="hljs-attr">items:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">CalicoNodeRoute</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">status</span> <span class="hljs-string">of</span> <span class="hljs-string">BGP</span> <span class="hljs-string">routes</span><br>                        <span class="hljs-string">on</span> <span class="hljs-string">the</span> <span class="hljs-string">node.</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">destination:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Destination</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">route.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">gateway:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Gateway</span> <span class="hljs-string">for</span> <span class="hljs-string">the</span> <span class="hljs-string">destination.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">interface:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Interface</span> <span class="hljs-string">for</span> <span class="hljs-string">the</span> <span class="hljs-string">destination</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">learnedFrom:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">LearnedFrom</span> <span class="hljs-string">contains</span> <span class="hljs-string">information</span> <span class="hljs-string">regarding</span><br>                            <span class="hljs-string">where</span> <span class="hljs-string">this</span> <span class="hljs-string">route</span> <span class="hljs-string">originated.</span><br>                          <span class="hljs-attr">properties:</span><br>                            <span class="hljs-attr">peerIP:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">If</span> <span class="hljs-string">sourceType</span> <span class="hljs-string">is</span> <span class="hljs-string">NodeMesh</span> <span class="hljs-string">or</span> <span class="hljs-string">BGPPeer,</span> <span class="hljs-string">IP</span><br>                                <span class="hljs-string">address</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">router</span> <span class="hljs-string">that</span> <span class="hljs-string">sent</span> <span class="hljs-string">us</span> <span class="hljs-string">this</span> <span class="hljs-string">route.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">sourceType:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Type</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">source</span> <span class="hljs-string">where</span> <span class="hljs-string">a</span> <span class="hljs-string">route</span> <span class="hljs-string">is</span> <span class="hljs-string">learned</span><br>                                <span class="hljs-string">from.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                        <span class="hljs-attr">type:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Type</span> <span class="hljs-string">indicates</span> <span class="hljs-string">if</span> <span class="hljs-string">the</span> <span class="hljs-string">route</span> <span class="hljs-string">is</span> <span class="hljs-string">being</span> <span class="hljs-string">used</span> <span class="hljs-string">for</span><br>                            <span class="hljs-string">forwarding</span> <span class="hljs-string">or</span> <span class="hljs-string">not.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>    <span class="hljs-attr">served:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">storage:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">status:</span><br>  <span class="hljs-attr">acceptedNames:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">conditions:</span> []<br>  <span class="hljs-attr">storedVersions:</span> []<br><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/kdd-crds.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apiextensions.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">CustomResourceDefinition</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">clusterinformations.crd.projectcalico.org</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">group:</span> <span class="hljs-string">crd.projectcalico.org</span><br>  <span class="hljs-attr">names:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterInformation</span><br>    <span class="hljs-attr">listKind:</span> <span class="hljs-string">ClusterInformationList</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">clusterinformations</span><br>    <span class="hljs-attr">singular:</span> <span class="hljs-string">clusterinformation</span><br>  <span class="hljs-attr">preserveUnknownFields:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">scope:</span> <span class="hljs-string">Cluster</span><br>  <span class="hljs-attr">versions:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">v1</span><br>    <span class="hljs-attr">schema:</span><br>      <span class="hljs-attr">openAPIV3Schema:</span><br>        <span class="hljs-attr">description:</span> <span class="hljs-string">ClusterInformation</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">cluster</span> <span class="hljs-string">specific</span> <span class="hljs-string">information.</span><br>        <span class="hljs-attr">properties:</span><br>          <span class="hljs-attr">apiVersion:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;APIVersion defines the versioned schema of this representation</span><br><span class="hljs-string">              of an object. Servers should convert recognized schemas to the latest</span><br><span class="hljs-string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">kind:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Kind is a string value representing the REST resource this</span><br><span class="hljs-string">              object represents. Servers may infer this from the endpoint the client</span><br><span class="hljs-string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">metadata:</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>          <span class="hljs-attr">spec:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">ClusterInformationSpec</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">values</span> <span class="hljs-string">of</span> <span class="hljs-string">describing</span><br>              <span class="hljs-string">the</span> <span class="hljs-string">cluster.</span><br>            <span class="hljs-attr">properties:</span><br>              <span class="hljs-attr">calicoVersion:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">CalicoVersion</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">Calico</span> <span class="hljs-string">that</span> <span class="hljs-string">the</span> <span class="hljs-string">cluster</span><br>                  <span class="hljs-string">is</span> <span class="hljs-string">running</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">clusterGUID:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">ClusterGUID</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">GUID</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">cluster</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">clusterType:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">ClusterType</span> <span class="hljs-string">describes</span> <span class="hljs-string">the</span> <span class="hljs-string">type</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">cluster</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">datastoreReady:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">DatastoreReady</span> <span class="hljs-string">is</span> <span class="hljs-string">used</span> <span class="hljs-string">during</span> <span class="hljs-string">significant</span> <span class="hljs-string">datastore</span> <span class="hljs-string">migrations</span><br>                  <span class="hljs-string">to</span> <span class="hljs-string">signal</span> <span class="hljs-string">to</span> <span class="hljs-string">components</span> <span class="hljs-string">such</span> <span class="hljs-string">as</span> <span class="hljs-string">Felix</span> <span class="hljs-string">that</span> <span class="hljs-string">it</span> <span class="hljs-string">should</span> <span class="hljs-string">wait</span> <span class="hljs-string">before</span><br>                  <span class="hljs-string">accessing</span> <span class="hljs-string">the</span> <span class="hljs-string">datastore.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">variant:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Variant</span> <span class="hljs-string">declares</span> <span class="hljs-string">which</span> <span class="hljs-string">variant</span> <span class="hljs-string">of</span> <span class="hljs-string">Calico</span> <span class="hljs-string">should</span> <span class="hljs-string">be</span> <span class="hljs-string">active.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>    <span class="hljs-attr">served:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">storage:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">status:</span><br>  <span class="hljs-attr">acceptedNames:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">conditions:</span> []<br>  <span class="hljs-attr">storedVersions:</span> []<br><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/kdd-crds.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apiextensions.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">CustomResourceDefinition</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">felixconfigurations.crd.projectcalico.org</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">group:</span> <span class="hljs-string">crd.projectcalico.org</span><br>  <span class="hljs-attr">names:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">FelixConfiguration</span><br>    <span class="hljs-attr">listKind:</span> <span class="hljs-string">FelixConfigurationList</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">felixconfigurations</span><br>    <span class="hljs-attr">singular:</span> <span class="hljs-string">felixconfiguration</span><br>  <span class="hljs-attr">preserveUnknownFields:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">scope:</span> <span class="hljs-string">Cluster</span><br>  <span class="hljs-attr">versions:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">v1</span><br>    <span class="hljs-attr">schema:</span><br>      <span class="hljs-attr">openAPIV3Schema:</span><br>        <span class="hljs-attr">description:</span> <span class="hljs-string">Felix</span> <span class="hljs-string">Configuration</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">configuration</span> <span class="hljs-string">for</span> <span class="hljs-string">Felix.</span><br>        <span class="hljs-attr">properties:</span><br>          <span class="hljs-attr">apiVersion:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;APIVersion defines the versioned schema of this representation</span><br><span class="hljs-string">              of an object. Servers should convert recognized schemas to the latest</span><br><span class="hljs-string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">kind:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Kind is a string value representing the REST resource this</span><br><span class="hljs-string">              object represents. Servers may infer this from the endpoint the client</span><br><span class="hljs-string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">metadata:</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>          <span class="hljs-attr">spec:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">FelixConfigurationSpec</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">values</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Felix</span> <span class="hljs-string">configuration.</span><br>            <span class="hljs-attr">properties:</span><br>              <span class="hljs-attr">allowIPIPPacketsFromWorkloads:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;AllowIPIPPacketsFromWorkloads controls whether Felix</span><br><span class="hljs-string">                  will add a rule to drop IPIP encapsulated traffic from workloads</span><br><span class="hljs-string">                  [Default: false]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">allowVXLANPacketsFromWorkloads:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;AllowVXLANPacketsFromWorkloads controls whether Felix</span><br><span class="hljs-string">                  will add a rule to drop VXLAN encapsulated traffic from workloads</span><br><span class="hljs-string">                  [Default: false]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">awsSrcDstCheck:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Set source-destination-check on AWS EC2 instances. Accepted</span><br><span class="hljs-string">                  value must be one of &quot;DoNothing&quot;, &quot;Enable&quot; or &quot;Disable&quot;. [Default:</span><br><span class="hljs-string">                  DoNothing]&#x27;</span><br>                <span class="hljs-attr">enum:</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">DoNothing</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">Enable</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">Disable</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">bpfConnectTimeLoadBalancingEnabled:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;BPFConnectTimeLoadBalancingEnabled when in BPF mode,</span><br><span class="hljs-string">                  controls whether Felix installs the connection-time load balancer.  The</span><br><span class="hljs-string">                  connect-time load balancer is required for the host to be able to</span><br><span class="hljs-string">                  reach Kubernetes services and it improves the performance of pod-to-service</span><br><span class="hljs-string">                  connections.  The only reason to disable it is for debugging purposes.  [Default:</span><br><span class="hljs-string">                  true]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">bpfDataIfacePattern:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">BPFDataIfacePattern</span> <span class="hljs-string">is</span> <span class="hljs-string">a</span> <span class="hljs-string">regular</span> <span class="hljs-string">expression</span> <span class="hljs-string">that</span> <span class="hljs-string">controls</span><br>                  <span class="hljs-string">which</span> <span class="hljs-string">interfaces</span> <span class="hljs-string">Felix</span> <span class="hljs-string">should</span> <span class="hljs-string">attach</span> <span class="hljs-string">BPF</span> <span class="hljs-string">programs</span> <span class="hljs-string">to</span> <span class="hljs-string">in</span> <span class="hljs-string">order</span> <span class="hljs-string">to</span><br>                  <span class="hljs-string">catch</span> <span class="hljs-string">traffic</span> <span class="hljs-string">to/from</span> <span class="hljs-string">the</span> <span class="hljs-string">network.</span>  <span class="hljs-string">This</span> <span class="hljs-string">needs</span> <span class="hljs-string">to</span> <span class="hljs-string">match</span> <span class="hljs-string">the</span> <span class="hljs-string">interfaces</span><br>                  <span class="hljs-string">that</span> <span class="hljs-string">Calico</span> <span class="hljs-string">workload</span> <span class="hljs-string">traffic</span> <span class="hljs-string">flows</span> <span class="hljs-string">over</span> <span class="hljs-string">as</span> <span class="hljs-string">well</span> <span class="hljs-string">as</span> <span class="hljs-string">any</span> <span class="hljs-string">interfaces</span><br>                  <span class="hljs-string">that</span> <span class="hljs-string">handle</span> <span class="hljs-string">incoming</span> <span class="hljs-string">traffic</span> <span class="hljs-string">to</span> <span class="hljs-string">nodeports</span> <span class="hljs-string">and</span> <span class="hljs-string">services</span> <span class="hljs-string">from</span> <span class="hljs-string">outside</span><br>                  <span class="hljs-string">the</span> <span class="hljs-string">cluster.</span>  <span class="hljs-string">It</span> <span class="hljs-string">should</span> <span class="hljs-string">not</span> <span class="hljs-string">match</span> <span class="hljs-string">the</span> <span class="hljs-string">workload</span> <span class="hljs-string">interfaces</span> <span class="hljs-string">(usually</span><br>                  <span class="hljs-string">named</span> <span class="hljs-string">cali...).</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">bpfDisableUnprivileged:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;BPFDisableUnprivileged, if enabled, Felix sets the kernel.unprivileged_bpf_disabled</span><br><span class="hljs-string">                  sysctl to disable unprivileged use of BPF.  This ensures that unprivileged</span><br><span class="hljs-string">                  users cannot access Calico<span class="hljs-char escape_">&#x27;&#x27;</span>s BPF maps and cannot insert their own</span><br><span class="hljs-string">                  BPF programs to interfere with Calico<span class="hljs-char escape_">&#x27;&#x27;</span>s. [Default: true]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">bpfEnabled:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;BPFEnabled, if enabled Felix will use the BPF dataplane.</span><br><span class="hljs-string">                  [Default: false]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">bpfEnforceRPF:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;BPFEnforceRPF enforce strict RPF on all host interfaces</span><br><span class="hljs-string">                  with BPF programs regardless of what is the per-interfaces or global</span><br><span class="hljs-string">                  setting. Possible values are Disabled, Strict or Loose. [Default:</span><br><span class="hljs-string">                  Strict]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">bpfExtToServiceConnmark:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;BPFExtToServiceConnmark in BPF mode, control a 32bit</span><br><span class="hljs-string">                  mark that is set on connections from an external client to a local</span><br><span class="hljs-string">                  service. This mark allows us to control how packets of that connection</span><br><span class="hljs-string">                  are routed within the host and how is routing interpreted by RPF</span><br><span class="hljs-string">                  check. [Default: 0]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">bpfExternalServiceMode:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;BPFExternalServiceMode in BPF mode, controls how connections</span><br><span class="hljs-string">                  from outside the cluster to services (node ports and cluster IPs)</span><br><span class="hljs-string">                  are forwarded to remote workloads.  If set to &quot;Tunnel&quot; then both</span><br><span class="hljs-string">                  request and response traffic is tunneled to the remote node.  If</span><br><span class="hljs-string">                  set to &quot;DSR&quot;, the request traffic is tunneled but the response traffic</span><br><span class="hljs-string">                  is sent directly from the remote node.  In &quot;DSR&quot; mode, the remote</span><br><span class="hljs-string">                  node appears to use the IP of the ingress node; this requires a</span><br><span class="hljs-string">                  permissive L2 network.  [Default: Tunnel]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">bpfHostConntrackBypass:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;BPFHostConntrackBypass Controls whether to bypass Linux</span><br><span class="hljs-string">                  conntrack in BPF mode for workloads and services. [Default: true</span><br><span class="hljs-string">                  - bypass Linux conntrack]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">bpfKubeProxyEndpointSlicesEnabled:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">BPFKubeProxyEndpointSlicesEnabled</span> <span class="hljs-string">in</span> <span class="hljs-string">BPF</span> <span class="hljs-string">mode,</span> <span class="hljs-string">controls</span><br>                  <span class="hljs-string">whether</span> <span class="hljs-string">Felix&#x27;s</span> <span class="hljs-string">embedded</span> <span class="hljs-string">kube-proxy</span> <span class="hljs-string">accepts</span> <span class="hljs-string">EndpointSlices</span> <span class="hljs-string">or</span> <span class="hljs-string">not.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">bpfKubeProxyIptablesCleanupEnabled:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;BPFKubeProxyIptablesCleanupEnabled, if enabled in BPF</span><br><span class="hljs-string">                  mode, Felix will proactively clean up the upstream Kubernetes kube-proxy<span class="hljs-char escape_">&#x27;&#x27;</span>s</span><br><span class="hljs-string">                  iptables chains.  Should only be enabled if kube-proxy is not running.  [Default:</span><br><span class="hljs-string">                  true]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">bpfKubeProxyMinSyncPeriod:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;BPFKubeProxyMinSyncPeriod, in BPF mode, controls the</span><br><span class="hljs-string">                  minimum time between updates to the dataplane for Felix<span class="hljs-char escape_">&#x27;&#x27;</span>s embedded</span><br><span class="hljs-string">                  kube-proxy.  Lower values give reduced set-up latency.  Higher values</span><br><span class="hljs-string">                  reduce Felix CPU usage by batching up more work.  [Default: 1s]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">bpfL3IfacePattern:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">BPFL3IfacePattern</span> <span class="hljs-string">is</span> <span class="hljs-string">a</span> <span class="hljs-string">regular</span> <span class="hljs-string">expression</span> <span class="hljs-string">that</span> <span class="hljs-string">allows</span><br>                  <span class="hljs-string">to</span> <span class="hljs-string">list</span> <span class="hljs-string">tunnel</span> <span class="hljs-string">devices</span> <span class="hljs-string">like</span> <span class="hljs-string">wireguard</span> <span class="hljs-string">or</span> <span class="hljs-string">vxlan</span> <span class="hljs-string">(i.e.,</span> <span class="hljs-string">L3</span> <span class="hljs-string">devices)</span><br>                  <span class="hljs-string">in</span> <span class="hljs-string">addition</span> <span class="hljs-string">to</span> <span class="hljs-string">BPFDataIfacePattern.</span> <span class="hljs-string">That</span> <span class="hljs-string">is,</span> <span class="hljs-string">tunnel</span> <span class="hljs-string">interfaces</span> <span class="hljs-string">not</span><br>                  <span class="hljs-string">created</span> <span class="hljs-string">by</span> <span class="hljs-string">Calico,</span> <span class="hljs-string">that</span> <span class="hljs-string">Calico</span> <span class="hljs-string">workload</span> <span class="hljs-string">traffic</span> <span class="hljs-string">flows</span> <span class="hljs-string">over</span> <span class="hljs-string">as</span> <span class="hljs-string">well</span><br>                  <span class="hljs-string">as</span> <span class="hljs-string">any</span> <span class="hljs-string">interfaces</span> <span class="hljs-string">that</span> <span class="hljs-string">handle</span> <span class="hljs-string">incoming</span> <span class="hljs-string">traffic</span> <span class="hljs-string">to</span> <span class="hljs-string">nodeports</span> <span class="hljs-string">and</span><br>                  <span class="hljs-string">services</span> <span class="hljs-string">from</span> <span class="hljs-string">outside</span> <span class="hljs-string">the</span> <span class="hljs-string">cluster.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">bpfLogLevel:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;BPFLogLevel controls the log level of the BPF programs</span><br><span class="hljs-string">                  when in BPF dataplane mode.  One of &quot;Off&quot;, &quot;Info&quot;, or &quot;Debug&quot;.  The</span><br><span class="hljs-string">                  logs are emitted to the BPF trace pipe, accessible with the command</span><br><span class="hljs-string">                  `tc exec bpf debug`. [Default: Off].&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">bpfMapSizeConntrack:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;BPFMapSizeConntrack sets the size for the conntrack</span><br><span class="hljs-string">                  map.  This map must be large enough to hold an entry for each active</span><br><span class="hljs-string">                  connection.  Warning: changing the size of the conntrack map can</span><br><span class="hljs-string">                  cause disruption.&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">bpfMapSizeIPSets:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">BPFMapSizeIPSets</span> <span class="hljs-string">sets</span> <span class="hljs-string">the</span> <span class="hljs-string">size</span> <span class="hljs-string">for</span> <span class="hljs-string">ipsets</span> <span class="hljs-string">map.</span>  <span class="hljs-string">The</span> <span class="hljs-string">IP</span><br>                  <span class="hljs-string">sets</span> <span class="hljs-string">map</span> <span class="hljs-string">must</span> <span class="hljs-string">be</span> <span class="hljs-string">large</span> <span class="hljs-string">enough</span> <span class="hljs-string">to</span> <span class="hljs-string">hold</span> <span class="hljs-string">an</span> <span class="hljs-string">entry</span> <span class="hljs-string">for</span> <span class="hljs-string">each</span> <span class="hljs-string">endpoint</span><br>                  <span class="hljs-string">matched</span> <span class="hljs-string">by</span> <span class="hljs-string">every</span> <span class="hljs-string">selector</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">source/destination</span> <span class="hljs-string">matches</span> <span class="hljs-string">in</span> <span class="hljs-string">network</span><br>                  <span class="hljs-string">policy.</span>  <span class="hljs-string">Selectors</span> <span class="hljs-string">such</span> <span class="hljs-string">as</span> <span class="hljs-string">&quot;all()&quot;</span> <span class="hljs-string">can</span> <span class="hljs-string">result</span> <span class="hljs-string">in</span> <span class="hljs-string">large</span> <span class="hljs-string">numbers</span> <span class="hljs-string">of</span><br>                  <span class="hljs-string">entries</span> <span class="hljs-string">(one</span> <span class="hljs-string">entry</span> <span class="hljs-string">per</span> <span class="hljs-string">endpoint</span> <span class="hljs-string">in</span> <span class="hljs-string">that</span> <span class="hljs-string">case).</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">bpfMapSizeIfState:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">BPFMapSizeIfState</span> <span class="hljs-string">sets</span> <span class="hljs-string">the</span> <span class="hljs-string">size</span> <span class="hljs-string">for</span> <span class="hljs-string">ifstate</span> <span class="hljs-string">map.</span>  <span class="hljs-string">The</span><br>                  <span class="hljs-string">ifstate</span> <span class="hljs-string">map</span> <span class="hljs-string">must</span> <span class="hljs-string">be</span> <span class="hljs-string">large</span> <span class="hljs-string">enough</span> <span class="hljs-string">to</span> <span class="hljs-string">hold</span> <span class="hljs-string">an</span> <span class="hljs-string">entry</span> <span class="hljs-string">for</span> <span class="hljs-string">each</span> <span class="hljs-string">device</span><br>                  <span class="hljs-string">(host</span> <span class="hljs-string">+</span> <span class="hljs-string">workloads)</span> <span class="hljs-string">on</span> <span class="hljs-string">a</span> <span class="hljs-string">host.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">bpfMapSizeNATAffinity:</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">bpfMapSizeNATBackend:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">BPFMapSizeNATBackend</span> <span class="hljs-string">sets</span> <span class="hljs-string">the</span> <span class="hljs-string">size</span> <span class="hljs-string">for</span> <span class="hljs-string">nat</span> <span class="hljs-string">back</span> <span class="hljs-string">end</span> <span class="hljs-string">map.</span><br>                  <span class="hljs-string">This</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">total</span> <span class="hljs-string">number</span> <span class="hljs-string">of</span> <span class="hljs-string">endpoints.</span> <span class="hljs-string">This</span> <span class="hljs-string">is</span> <span class="hljs-string">mostly</span> <span class="hljs-string">more</span> <span class="hljs-string">than</span><br>                  <span class="hljs-string">the</span> <span class="hljs-string">size</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">number</span> <span class="hljs-string">of</span> <span class="hljs-string">services.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">bpfMapSizeNATFrontend:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">BPFMapSizeNATFrontend</span> <span class="hljs-string">sets</span> <span class="hljs-string">the</span> <span class="hljs-string">size</span> <span class="hljs-string">for</span> <span class="hljs-string">nat</span> <span class="hljs-string">front</span> <span class="hljs-string">end</span><br>                  <span class="hljs-string">map.</span> <span class="hljs-string">FrontendMap</span> <span class="hljs-string">should</span> <span class="hljs-string">be</span> <span class="hljs-string">large</span> <span class="hljs-string">enough</span> <span class="hljs-string">to</span> <span class="hljs-string">hold</span> <span class="hljs-string">an</span> <span class="hljs-string">entry</span> <span class="hljs-string">for</span> <span class="hljs-string">each</span><br>                  <span class="hljs-string">nodeport,</span> <span class="hljs-string">external</span> <span class="hljs-string">IP</span> <span class="hljs-string">and</span> <span class="hljs-string">each</span> <span class="hljs-string">port</span> <span class="hljs-string">in</span> <span class="hljs-string">each</span> <span class="hljs-string">service.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">bpfMapSizeRoute:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">BPFMapSizeRoute</span> <span class="hljs-string">sets</span> <span class="hljs-string">the</span> <span class="hljs-string">size</span> <span class="hljs-string">for</span> <span class="hljs-string">the</span> <span class="hljs-string">routes</span> <span class="hljs-string">map.</span>  <span class="hljs-string">The</span><br>                  <span class="hljs-string">routes</span> <span class="hljs-string">map</span> <span class="hljs-string">should</span> <span class="hljs-string">be</span> <span class="hljs-string">large</span> <span class="hljs-string">enough</span> <span class="hljs-string">to</span> <span class="hljs-string">hold</span> <span class="hljs-string">one</span> <span class="hljs-string">entry</span> <span class="hljs-string">per</span> <span class="hljs-string">workload</span><br>                  <span class="hljs-string">and</span> <span class="hljs-string">a</span> <span class="hljs-string">handful</span> <span class="hljs-string">of</span> <span class="hljs-string">entries</span> <span class="hljs-string">per</span> <span class="hljs-string">host</span> <span class="hljs-string">(enough</span> <span class="hljs-string">to</span> <span class="hljs-string">cover</span> <span class="hljs-string">its</span> <span class="hljs-string">own</span> <span class="hljs-string">IPs</span> <span class="hljs-string">and</span><br>                  <span class="hljs-string">tunnel</span> <span class="hljs-string">IPs).</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">bpfPSNATPorts:</span><br>                <span class="hljs-attr">anyOf:</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;BPFPSNATPorts sets the range from which we randomly</span><br><span class="hljs-string">                  pick a port if there is a source port collision. This should be</span><br><span class="hljs-string">                  within the ephemeral range as defined by RFC 6056 (1024â€“65535) and</span><br><span class="hljs-string">                  preferably outside the  ephemeral ranges used by common operating</span><br><span class="hljs-string">                  systems. Linux uses 32768â€“60999, while others mostly use the IANA</span><br><span class="hljs-string">                  defined range 49152â€“65535. It is not necessarily a problem if this</span><br><span class="hljs-string">                  range overlaps with the operating systems. Both ends of the range</span><br><span class="hljs-string">                  are inclusive. [Default: 20000:29999]&#x27;</span><br>                <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>              <span class="hljs-attr">bpfPolicyDebugEnabled:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">BPFPolicyDebugEnabled</span> <span class="hljs-string">when</span> <span class="hljs-literal">true</span><span class="hljs-string">,</span> <span class="hljs-string">Felix</span> <span class="hljs-string">records</span> <span class="hljs-string">detailed</span><br>                  <span class="hljs-string">information</span> <span class="hljs-string">about</span> <span class="hljs-string">the</span> <span class="hljs-string">BPF</span> <span class="hljs-string">policy</span> <span class="hljs-string">programs,</span> <span class="hljs-string">which</span> <span class="hljs-string">can</span> <span class="hljs-string">be</span> <span class="hljs-string">examined</span><br>                  <span class="hljs-string">with</span> <span class="hljs-string">the</span> <span class="hljs-string">calico-bpf</span> <span class="hljs-string">command-line</span> <span class="hljs-string">tool.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">chainInsertMode:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;ChainInsertMode controls whether Felix hooks the kernel<span class="hljs-char escape_">&#x27;&#x27;</span>s</span><br><span class="hljs-string">                  top-level iptables chains by inserting a rule at the top of the</span><br><span class="hljs-string">                  chain or by appending a rule at the bottom. insert is the safe default</span><br><span class="hljs-string">                  since it prevents Calico<span class="hljs-char escape_">&#x27;&#x27;</span>s rules from being bypassed. If you switch</span><br><span class="hljs-string">                  to append mode, be sure that the other rules in the chains signal</span><br><span class="hljs-string">                  acceptance by falling through to the Calico rules, otherwise the</span><br><span class="hljs-string">                  Calico policy will be bypassed. [Default: insert]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">dataplaneDriver:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">DataplaneDriver</span> <span class="hljs-string">filename</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">external</span> <span class="hljs-string">dataplane</span> <span class="hljs-string">driver</span><br>                  <span class="hljs-string">to</span> <span class="hljs-string">use.</span>  <span class="hljs-string">Only</span> <span class="hljs-string">used</span> <span class="hljs-string">if</span> <span class="hljs-string">UseInternalDataplaneDriver</span> <span class="hljs-string">is</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">false.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">dataplaneWatchdogTimeout:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;DataplaneWatchdogTimeout is the readiness/liveness timeout</span><br><span class="hljs-string">                  used for Felix&#x27;s (internal) dataplane driver. Increase this value</span><br><span class="hljs-string">                  if you experience spurious non-ready or non-live events when Felix</span><br><span class="hljs-string">                  is under heavy load. Decrease the value to get felix to report non-live</span><br><span class="hljs-string">                  or non-ready more quickly. [Default: 90s] \n Deprecated: replaced</span><br><span class="hljs-string">                  by the generic HealthTimeoutOverrides.&quot;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">debugDisableLogDropping:</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">debugMemoryProfilePath:</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">debugSimulateCalcGraphHangAfter:</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">debugSimulateDataplaneHangAfter:</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">defaultEndpointToHostAction:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;DefaultEndpointToHostAction controls what happens to</span><br><span class="hljs-string">                  traffic that goes from a workload endpoint to the host itself (after</span><br><span class="hljs-string">                  the traffic hits the endpoint egress policy). By default Calico</span><br><span class="hljs-string">                  blocks traffic from workload endpoints to the host itself with an</span><br><span class="hljs-string">                  iptables &quot;DROP&quot; action. If you want to allow some or all traffic</span><br><span class="hljs-string">                  from endpoint to host, set this parameter to RETURN or ACCEPT. Use</span><br><span class="hljs-string">                  RETURN if you have your own rules in the iptables &quot;INPUT&quot; chain;</span><br><span class="hljs-string">                  Calico will insert its rules at the top of that chain, then &quot;RETURN&quot;</span><br><span class="hljs-string">                  packets to the &quot;INPUT&quot; chain once it has completed processing workload</span><br><span class="hljs-string">                  endpoint egress policy. Use ACCEPT to unconditionally accept packets</span><br><span class="hljs-string">                  from workloads after processing workload endpoint egress policy.</span><br><span class="hljs-string">                  [Default: Drop]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">deviceRouteProtocol:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">This</span> <span class="hljs-string">defines</span> <span class="hljs-string">the</span> <span class="hljs-string">route</span> <span class="hljs-string">protocol</span> <span class="hljs-string">added</span> <span class="hljs-string">to</span> <span class="hljs-string">programmed</span> <span class="hljs-string">device</span><br>                  <span class="hljs-string">routes,</span> <span class="hljs-string">by</span> <span class="hljs-string">default</span> <span class="hljs-string">this</span> <span class="hljs-string">will</span> <span class="hljs-string">be</span> <span class="hljs-string">RTPROT_BOOT</span> <span class="hljs-string">when</span> <span class="hljs-string">left</span> <span class="hljs-string">blank.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">deviceRouteSourceAddress:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">This</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">IPv4</span> <span class="hljs-string">source</span> <span class="hljs-string">address</span> <span class="hljs-string">to</span> <span class="hljs-string">use</span> <span class="hljs-string">on</span> <span class="hljs-string">programmed</span><br>                  <span class="hljs-string">device</span> <span class="hljs-string">routes.</span> <span class="hljs-string">By</span> <span class="hljs-string">default</span> <span class="hljs-string">the</span> <span class="hljs-string">source</span> <span class="hljs-string">address</span> <span class="hljs-string">is</span> <span class="hljs-string">left</span> <span class="hljs-string">blank,</span> <span class="hljs-string">leaving</span><br>                  <span class="hljs-string">the</span> <span class="hljs-string">kernel</span> <span class="hljs-string">to</span> <span class="hljs-string">choose</span> <span class="hljs-string">the</span> <span class="hljs-string">source</span> <span class="hljs-string">address</span> <span class="hljs-string">used.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">deviceRouteSourceAddressIPv6:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">This</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">IPv6</span> <span class="hljs-string">source</span> <span class="hljs-string">address</span> <span class="hljs-string">to</span> <span class="hljs-string">use</span> <span class="hljs-string">on</span> <span class="hljs-string">programmed</span><br>                  <span class="hljs-string">device</span> <span class="hljs-string">routes.</span> <span class="hljs-string">By</span> <span class="hljs-string">default</span> <span class="hljs-string">the</span> <span class="hljs-string">source</span> <span class="hljs-string">address</span> <span class="hljs-string">is</span> <span class="hljs-string">left</span> <span class="hljs-string">blank,</span> <span class="hljs-string">leaving</span><br>                  <span class="hljs-string">the</span> <span class="hljs-string">kernel</span> <span class="hljs-string">to</span> <span class="hljs-string">choose</span> <span class="hljs-string">the</span> <span class="hljs-string">source</span> <span class="hljs-string">address</span> <span class="hljs-string">used.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">disableConntrackInvalidCheck:</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">endpointReportingDelay:</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">endpointReportingEnabled:</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">externalNodesList:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">ExternalNodesCIDRList</span> <span class="hljs-string">is</span> <span class="hljs-string">a</span> <span class="hljs-string">list</span> <span class="hljs-string">of</span> <span class="hljs-string">CIDR&#x27;s</span> <span class="hljs-string">of</span> <span class="hljs-string">external-non-calico-nodes</span><br>                  <span class="hljs-string">which</span> <span class="hljs-string">may</span> <span class="hljs-string">source</span> <span class="hljs-string">tunnel</span> <span class="hljs-string">traffic</span> <span class="hljs-string">and</span> <span class="hljs-string">have</span> <span class="hljs-string">the</span> <span class="hljs-string">tunneled</span> <span class="hljs-string">traffic</span> <span class="hljs-string">be</span><br>                  <span class="hljs-string">accepted</span> <span class="hljs-string">at</span> <span class="hljs-string">calico</span> <span class="hljs-string">nodes.</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>              <span class="hljs-attr">failsafeInboundHostPorts:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;FailsafeInboundHostPorts is a list of UDP/TCP ports</span><br><span class="hljs-string">                  and CIDRs that Felix will allow incoming traffic to host endpoints</span><br><span class="hljs-string">                  on irrespective of the security policy. This is useful to avoid</span><br><span class="hljs-string">                  accidentally cutting off a host with incorrect configuration. For</span><br><span class="hljs-string">                  back-compatibility, if the protocol is not specified, it defaults</span><br><span class="hljs-string">                  to &quot;tcp&quot;. If a CIDR is not specified, it will allow traffic from</span><br><span class="hljs-string">                  all addresses. To disable all inbound host ports, use the value</span><br><span class="hljs-string">                  none. The default value allows ssh access and DHCP. [Default: tcp:22,</span><br><span class="hljs-string">                  udp:68, tcp:179, tcp:2379, tcp:2380, tcp:6443, tcp:6666, tcp:6667]&#x27;</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">description:</span> <span class="hljs-string">ProtoPort</span> <span class="hljs-string">is</span> <span class="hljs-string">combination</span> <span class="hljs-string">of</span> <span class="hljs-string">protocol,</span> <span class="hljs-string">port,</span> <span class="hljs-string">and</span> <span class="hljs-string">CIDR.</span><br>                    <span class="hljs-string">Protocol</span> <span class="hljs-string">and</span> <span class="hljs-string">port</span> <span class="hljs-string">must</span> <span class="hljs-string">be</span> <span class="hljs-string">specified.</span><br>                  <span class="hljs-attr">properties:</span><br>                    <span class="hljs-attr">net:</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                    <span class="hljs-attr">port:</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                    <span class="hljs-attr">protocol:</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                  <span class="hljs-attr">required:</span><br>                  <span class="hljs-bullet">-</span> <span class="hljs-string">port</span><br>                  <span class="hljs-bullet">-</span> <span class="hljs-string">protocol</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>              <span class="hljs-attr">failsafeOutboundHostPorts:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;FailsafeOutboundHostPorts is a list of UDP/TCP ports</span><br><span class="hljs-string">                  and CIDRs that Felix will allow outgoing traffic from host endpoints</span><br><span class="hljs-string">                  to irrespective of the security policy. This is useful to avoid</span><br><span class="hljs-string">                  accidentally cutting off a host with incorrect configuration. For</span><br><span class="hljs-string">                  back-compatibility, if the protocol is not specified, it defaults</span><br><span class="hljs-string">                  to &quot;tcp&quot;. If a CIDR is not specified, it will allow traffic from</span><br><span class="hljs-string">                  all addresses. To disable all outbound host ports, use the value</span><br><span class="hljs-string">                  none. The default value opens etcd<span class="hljs-char escape_">&#x27;&#x27;</span>s standard ports to ensure that</span><br><span class="hljs-string">                  Felix does not get cut off from etcd as well as allowing DHCP and</span><br><span class="hljs-string">                  DNS. [Default: tcp:179, tcp:2379, tcp:2380, tcp:6443, tcp:6666,</span><br><span class="hljs-string">                  tcp:6667, udp:53, udp:67]&#x27;</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">description:</span> <span class="hljs-string">ProtoPort</span> <span class="hljs-string">is</span> <span class="hljs-string">combination</span> <span class="hljs-string">of</span> <span class="hljs-string">protocol,</span> <span class="hljs-string">port,</span> <span class="hljs-string">and</span> <span class="hljs-string">CIDR.</span><br>                    <span class="hljs-string">Protocol</span> <span class="hljs-string">and</span> <span class="hljs-string">port</span> <span class="hljs-string">must</span> <span class="hljs-string">be</span> <span class="hljs-string">specified.</span><br>                  <span class="hljs-attr">properties:</span><br>                    <span class="hljs-attr">net:</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                    <span class="hljs-attr">port:</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                    <span class="hljs-attr">protocol:</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                  <span class="hljs-attr">required:</span><br>                  <span class="hljs-bullet">-</span> <span class="hljs-string">port</span><br>                  <span class="hljs-bullet">-</span> <span class="hljs-string">protocol</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>              <span class="hljs-attr">featureDetectOverride:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">FeatureDetectOverride</span> <span class="hljs-string">is</span> <span class="hljs-string">used</span> <span class="hljs-string">to</span> <span class="hljs-string">override</span> <span class="hljs-string">feature</span> <span class="hljs-string">detection</span><br>                  <span class="hljs-string">based</span> <span class="hljs-string">on</span> <span class="hljs-string">auto-detected</span> <span class="hljs-string">platform</span> <span class="hljs-string">capabilities.</span>  <span class="hljs-string">Values</span> <span class="hljs-string">are</span> <span class="hljs-string">specified</span><br>                  <span class="hljs-string">in</span> <span class="hljs-string">a</span> <span class="hljs-string">comma</span> <span class="hljs-string">separated</span> <span class="hljs-string">list</span> <span class="hljs-string">with</span> <span class="hljs-literal">no</span> <span class="hljs-string">spaces,</span> <span class="hljs-string">example;</span> <span class="hljs-string">&quot;SNATFullyRandom=true,MASQFullyRandom=false,RestoreSupportsLock=&quot;</span><span class="hljs-string">.</span>  <span class="hljs-string">&quot;true&quot;</span><br>                  <span class="hljs-string">or</span> <span class="hljs-string">&quot;false&quot;</span> <span class="hljs-string">will</span> <span class="hljs-string">force</span> <span class="hljs-string">the</span> <span class="hljs-string">feature,</span> <span class="hljs-string">empty</span> <span class="hljs-string">or</span> <span class="hljs-string">omitted</span> <span class="hljs-string">values</span> <span class="hljs-string">are</span> <span class="hljs-string">auto-detected.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">featureGates:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">FeatureGates</span> <span class="hljs-string">is</span> <span class="hljs-string">used</span> <span class="hljs-string">to</span> <span class="hljs-string">enable</span> <span class="hljs-string">or</span> <span class="hljs-string">disable</span> <span class="hljs-string">tech-preview</span><br>                  <span class="hljs-string">Calico</span> <span class="hljs-string">features.</span> <span class="hljs-string">Values</span> <span class="hljs-string">are</span> <span class="hljs-string">specified</span> <span class="hljs-string">in</span> <span class="hljs-string">a</span> <span class="hljs-string">comma</span> <span class="hljs-string">separated</span> <span class="hljs-string">list</span><br>                  <span class="hljs-string">with</span> <span class="hljs-literal">no</span> <span class="hljs-string">spaces,</span> <span class="hljs-string">example;</span> <span class="hljs-string">&quot;BPFConnectTimeLoadBalancingWorkaround=enabled,XyZ=false&quot;</span><span class="hljs-string">.</span><br>                  <span class="hljs-string">This</span> <span class="hljs-string">is</span> <span class="hljs-string">used</span> <span class="hljs-string">to</span> <span class="hljs-string">enable</span> <span class="hljs-string">features</span> <span class="hljs-string">that</span> <span class="hljs-string">are</span> <span class="hljs-string">not</span> <span class="hljs-string">fully</span> <span class="hljs-string">production</span> <span class="hljs-string">ready.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">floatingIPs:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">FloatingIPs</span> <span class="hljs-string">configures</span> <span class="hljs-string">whether</span> <span class="hljs-string">or</span> <span class="hljs-string">not</span> <span class="hljs-string">Felix</span> <span class="hljs-string">will</span> <span class="hljs-string">program</span><br>                  <span class="hljs-string">non-OpenStack</span> <span class="hljs-string">floating</span> <span class="hljs-string">IP</span> <span class="hljs-string">addresses.</span>  <span class="hljs-string">(OpenStack-derived</span> <span class="hljs-string">floating</span><br>                  <span class="hljs-string">IPs</span> <span class="hljs-string">are</span> <span class="hljs-string">always</span> <span class="hljs-string">programmed,</span> <span class="hljs-string">regardless</span> <span class="hljs-string">of</span> <span class="hljs-string">this</span> <span class="hljs-string">setting.)</span><br>                <span class="hljs-attr">enum:</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">Enabled</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">Disabled</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">genericXDPEnabled:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;GenericXDPEnabled enables Generic XDP so network cards</span><br><span class="hljs-string">                  that don<span class="hljs-char escape_">&#x27;&#x27;</span>t support XDP offload or driver modes can use XDP. This</span><br><span class="hljs-string">                  is not recommended since it doesn<span class="hljs-char escape_">&#x27;&#x27;</span>t provide better performance</span><br><span class="hljs-string">                  than iptables. [Default: false]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">healthEnabled:</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">healthHost:</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">healthPort:</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">healthTimeoutOverrides:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">HealthTimeoutOverrides</span> <span class="hljs-string">allows</span> <span class="hljs-string">the</span> <span class="hljs-string">internal</span> <span class="hljs-string">watchdog</span> <span class="hljs-string">timeouts</span><br>                  <span class="hljs-string">of</span> <span class="hljs-string">individual</span> <span class="hljs-string">subcomponents</span> <span class="hljs-string">to</span> <span class="hljs-string">be</span> <span class="hljs-string">overriden.</span>  <span class="hljs-string">This</span> <span class="hljs-string">is</span> <span class="hljs-string">useful</span> <span class="hljs-string">for</span><br>                  <span class="hljs-string">working</span> <span class="hljs-string">around</span> <span class="hljs-string">&quot;false positive&quot;</span> <span class="hljs-string">liveness</span> <span class="hljs-string">timeouts</span> <span class="hljs-string">that</span> <span class="hljs-string">can</span> <span class="hljs-string">occur</span><br>                  <span class="hljs-string">in</span> <span class="hljs-string">particularly</span> <span class="hljs-string">stressful</span> <span class="hljs-string">workloads</span> <span class="hljs-string">or</span> <span class="hljs-string">if</span> <span class="hljs-string">CPU</span> <span class="hljs-string">is</span> <span class="hljs-string">constrained.</span>  <span class="hljs-string">For</span><br>                  <span class="hljs-string">a</span> <span class="hljs-string">list</span> <span class="hljs-string">of</span> <span class="hljs-string">active</span> <span class="hljs-string">subcomponents,</span> <span class="hljs-string">see</span> <span class="hljs-string">Felix&#x27;s</span> <span class="hljs-string">logs.</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">properties:</span><br>                    <span class="hljs-attr">name:</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                    <span class="hljs-attr">timeout:</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                  <span class="hljs-attr">required:</span><br>                  <span class="hljs-bullet">-</span> <span class="hljs-string">name</span><br>                  <span class="hljs-bullet">-</span> <span class="hljs-string">timeout</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>              <span class="hljs-attr">interfaceExclude:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;InterfaceExclude is a comma-separated list of interfaces</span><br><span class="hljs-string">                  that Felix should exclude when monitoring for host endpoints. The</span><br><span class="hljs-string">                  default value ensures that Felix ignores Kubernetes<span class="hljs-char escape_">&#x27;&#x27;</span> IPVS dummy</span><br><span class="hljs-string">                  interface, which is used internally by kube-proxy. If you want to</span><br><span class="hljs-string">                  exclude multiple interface names using a single value, the list</span><br><span class="hljs-string">                  supports regular expressions. For regular expressions you must wrap</span><br><span class="hljs-string">                  the value with <span class="hljs-char escape_">&#x27;&#x27;</span>/<span class="hljs-char escape_">&#x27;&#x27;</span>. For example having values <span class="hljs-char escape_">&#x27;&#x27;</span>/^kube/,veth1<span class="hljs-char escape_">&#x27;&#x27;</span></span><br><span class="hljs-string">                  will exclude all interfaces that begin with <span class="hljs-char escape_">&#x27;&#x27;</span>kube<span class="hljs-char escape_">&#x27;&#x27;</span> and also the</span><br><span class="hljs-string">                  interface <span class="hljs-char escape_">&#x27;&#x27;</span>veth1<span class="hljs-char escape_">&#x27;&#x27;</span>. [Default: kube-ipvs0]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">interfacePrefix:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;InterfacePrefix is the interface name prefix that identifies</span><br><span class="hljs-string">                  workload endpoints and so distinguishes them from host endpoint</span><br><span class="hljs-string">                  interfaces. Note: in environments other than bare metal, the orchestrators</span><br><span class="hljs-string">                  configure this appropriately. For example our Kubernetes and Docker</span><br><span class="hljs-string">                  integrations set the <span class="hljs-char escape_">&#x27;&#x27;</span>cali<span class="hljs-char escape_">&#x27;&#x27;</span> value, and our OpenStack integration</span><br><span class="hljs-string">                  sets the <span class="hljs-char escape_">&#x27;&#x27;</span>tap<span class="hljs-char escape_">&#x27;&#x27;</span> value. [Default: cali]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">interfaceRefreshInterval:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">InterfaceRefreshInterval</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">period</span> <span class="hljs-string">at</span> <span class="hljs-string">which</span> <span class="hljs-string">Felix</span><br>                  <span class="hljs-string">rescans</span> <span class="hljs-string">local</span> <span class="hljs-string">interfaces</span> <span class="hljs-string">to</span> <span class="hljs-string">verify</span> <span class="hljs-string">their</span> <span class="hljs-string">state.</span> <span class="hljs-string">The</span> <span class="hljs-string">rescan</span> <span class="hljs-string">can</span> <span class="hljs-string">be</span><br>                  <span class="hljs-string">disabled</span> <span class="hljs-string">by</span> <span class="hljs-string">setting</span> <span class="hljs-string">the</span> <span class="hljs-string">interval</span> <span class="hljs-string">to</span> <span class="hljs-number">0</span><span class="hljs-string">.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">ipipEnabled:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;IPIPEnabled overrides whether Felix should configure</span><br><span class="hljs-string">                  an IPIP interface on the host. Optional as Felix determines this</span><br><span class="hljs-string">                  based on the existing IP pools. [Default: nil (unset)]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">ipipMTU:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;IPIPMTU is the MTU to set on the tunnel device. See</span><br><span class="hljs-string">                  Configuring MTU [Default: 1440]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">ipsetsRefreshInterval:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;IpsetsRefreshInterval is the period at which Felix re-checks</span><br><span class="hljs-string">                  all iptables state to ensure that no other process has accidentally</span><br><span class="hljs-string">                  broken Calico<span class="hljs-char escape_">&#x27;&#x27;</span>s rules. Set to 0 to disable iptables refresh. [Default:</span><br><span class="hljs-string">                  90s]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">iptablesBackend:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">IptablesBackend</span> <span class="hljs-string">specifies</span> <span class="hljs-string">which</span> <span class="hljs-string">backend</span> <span class="hljs-string">of</span> <span class="hljs-string">iptables</span> <span class="hljs-string">will</span><br>                  <span class="hljs-string">be</span> <span class="hljs-string">used.</span> <span class="hljs-string">The</span> <span class="hljs-string">default</span> <span class="hljs-string">is</span> <span class="hljs-string">Auto.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">iptablesFilterAllowAction:</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">iptablesLockFilePath:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;IptablesLockFilePath is the location of the iptables</span><br><span class="hljs-string">                  lock file. You may need to change this if the lock file is not in</span><br><span class="hljs-string">                  its standard location (for example if you have mapped it into Felix<span class="hljs-char escape_">&#x27;&#x27;</span>s</span><br><span class="hljs-string">                  container at a different path). [Default: /run/xtables.lock]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">iptablesLockProbeInterval:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;IptablesLockProbeInterval is the time that Felix will</span><br><span class="hljs-string">                  wait between attempts to acquire the iptables lock if it is not</span><br><span class="hljs-string">                  available. Lower values make Felix more responsive when the lock</span><br><span class="hljs-string">                  is contended, but use more CPU. [Default: 50ms]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">iptablesLockTimeout:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;IptablesLockTimeout is the time that Felix will wait</span><br><span class="hljs-string">                  for the iptables lock, or 0, to disable. To use this feature, Felix</span><br><span class="hljs-string">                  must share the iptables lock file with all other processes that</span><br><span class="hljs-string">                  also take the lock. When running Felix inside a container, this</span><br><span class="hljs-string">                  requires the /run directory of the host to be mounted into the calico/node</span><br><span class="hljs-string">                  or calico/felix container. [Default: 0s disabled]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">iptablesMangleAllowAction:</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">iptablesMarkMask:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;IptablesMarkMask is the mask that Felix selects its</span><br><span class="hljs-string">                  IPTables Mark bits from. Should be a 32 bit hexadecimal number with</span><br><span class="hljs-string">                  at least 8 bits set, none of which clash with any other mark bits</span><br><span class="hljs-string">                  in use on the system. [Default: 0xff000000]&#x27;</span><br>                <span class="hljs-attr">format:</span> <span class="hljs-string">int32</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">iptablesNATOutgoingInterfaceFilter:</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">iptablesPostWriteCheckInterval:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;IptablesPostWriteCheckInterval is the period after Felix</span><br><span class="hljs-string">                  has done a write to the dataplane that it schedules an extra read</span><br><span class="hljs-string">                  back in order to check the write was not clobbered by another process.</span><br><span class="hljs-string">                  This should only occur if another application on the system doesn<span class="hljs-char escape_">&#x27;&#x27;</span>t</span><br><span class="hljs-string">                  respect the iptables lock. [Default: 1s]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">iptablesRefreshInterval:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;IptablesRefreshInterval is the period at which Felix</span><br><span class="hljs-string">                  re-checks the IP sets in the dataplane to ensure that no other process</span><br><span class="hljs-string">                  has accidentally broken Calico<span class="hljs-char escape_">&#x27;&#x27;</span>s rules. Set to 0 to disable IP</span><br><span class="hljs-string">                  sets refresh. Note: the default for this value is lower than the</span><br><span class="hljs-string">                  other refresh intervals as a workaround for a Linux kernel bug that</span><br><span class="hljs-string">                  was fixed in kernel version 4.11. If you are using v4.11 or greater</span><br><span class="hljs-string">                  you may want to set this to, a higher value to reduce Felix CPU</span><br><span class="hljs-string">                  usage. [Default: 10s]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">ipv6Support:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">IPv6Support</span> <span class="hljs-string">controls</span> <span class="hljs-string">whether</span> <span class="hljs-string">Felix</span> <span class="hljs-string">enables</span> <span class="hljs-string">support</span> <span class="hljs-string">for</span><br>                  <span class="hljs-string">IPv6</span> <span class="hljs-string">(if</span> <span class="hljs-string">supported</span> <span class="hljs-string">by</span> <span class="hljs-string">the</span> <span class="hljs-string">in-use</span> <span class="hljs-string">dataplane).</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">kubeNodePortRanges:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;KubeNodePortRanges holds list of port ranges used for</span><br><span class="hljs-string">                  service node ports. Only used if felix detects kube-proxy running</span><br><span class="hljs-string">                  in ipvs mode. Felix uses these ranges to separate host and workload</span><br><span class="hljs-string">                  traffic. [Default: 30000:32767].&#x27;</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">anyOf:</span><br>                  <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                  <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                  <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                  <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>              <span class="hljs-attr">logDebugFilenameRegex:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">LogDebugFilenameRegex</span> <span class="hljs-string">controls</span> <span class="hljs-string">which</span> <span class="hljs-string">source</span> <span class="hljs-string">code</span> <span class="hljs-string">files</span><br>                  <span class="hljs-string">have</span> <span class="hljs-string">their</span> <span class="hljs-string">Debug</span> <span class="hljs-string">log</span> <span class="hljs-string">output</span> <span class="hljs-string">included</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">logs.</span> <span class="hljs-string">Only</span> <span class="hljs-string">logs</span> <span class="hljs-string">from</span><br>                  <span class="hljs-string">files</span> <span class="hljs-string">with</span> <span class="hljs-string">names</span> <span class="hljs-string">that</span> <span class="hljs-string">match</span> <span class="hljs-string">the</span> <span class="hljs-string">given</span> <span class="hljs-string">regular</span> <span class="hljs-string">expression</span> <span class="hljs-string">are</span> <span class="hljs-string">included.</span>  <span class="hljs-string">The</span><br>                  <span class="hljs-string">filter</span> <span class="hljs-string">only</span> <span class="hljs-string">applies</span> <span class="hljs-string">to</span> <span class="hljs-string">Debug</span> <span class="hljs-string">level</span> <span class="hljs-string">logs.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">logFilePath:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;LogFilePath is the full path to the Felix log. Set to</span><br><span class="hljs-string">                  none to disable file logging. [Default: /var/log/calico/felix.log]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">logPrefix:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;LogPrefix is the log prefix that Felix uses when rendering</span><br><span class="hljs-string">                  LOG rules. [Default: calico-packet]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">logSeverityFile:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;LogSeverityFile is the log severity above which logs</span><br><span class="hljs-string">                  are sent to the log file. [Default: Info]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">logSeverityScreen:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;LogSeverityScreen is the log severity above which logs</span><br><span class="hljs-string">                  are sent to the stdout. [Default: Info]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">logSeveritySys:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;LogSeveritySys is the log severity above which logs</span><br><span class="hljs-string">                  are sent to the syslog. Set to None for no logging to syslog. [Default:</span><br><span class="hljs-string">                  Info]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">maxIpsetSize:</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">metadataAddr:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;MetadataAddr is the IP address or domain name of the</span><br><span class="hljs-string">                  server that can answer VM queries for cloud-init metadata. In OpenStack,</span><br><span class="hljs-string">                  this corresponds to the machine running nova-api (or in Ubuntu,</span><br><span class="hljs-string">                  nova-api-metadata). A value of none (case insensitive) means that</span><br><span class="hljs-string">                  Felix should not set up any NAT rule for the metadata path. [Default:</span><br><span class="hljs-string">                  127.0.0.1]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">metadataPort:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;MetadataPort is the port of the metadata server. This,</span><br><span class="hljs-string">                  combined with global.MetadataAddr (if not <span class="hljs-char escape_">&#x27;&#x27;</span>None<span class="hljs-char escape_">&#x27;&#x27;</span>), is used to</span><br><span class="hljs-string">                  set up a NAT rule, from 169.254.169.254:80 to MetadataAddr:MetadataPort.</span><br><span class="hljs-string">                  In most cases this should not need to be changed [Default: 8775].&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">mtuIfacePattern:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">MTUIfacePattern</span> <span class="hljs-string">is</span> <span class="hljs-string">a</span> <span class="hljs-string">regular</span> <span class="hljs-string">expression</span> <span class="hljs-string">that</span> <span class="hljs-string">controls</span><br>                  <span class="hljs-string">which</span> <span class="hljs-string">interfaces</span> <span class="hljs-string">Felix</span> <span class="hljs-string">should</span> <span class="hljs-string">scan</span> <span class="hljs-string">in</span> <span class="hljs-string">order</span> <span class="hljs-string">to</span> <span class="hljs-string">calculate</span> <span class="hljs-string">the</span> <span class="hljs-string">host&#x27;s</span><br>                  <span class="hljs-string">MTU.</span> <span class="hljs-string">This</span> <span class="hljs-string">should</span> <span class="hljs-string">not</span> <span class="hljs-string">match</span> <span class="hljs-string">workload</span> <span class="hljs-string">interfaces</span> <span class="hljs-string">(usually</span> <span class="hljs-string">named</span> <span class="hljs-string">cali...).</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">natOutgoingAddress:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">NATOutgoingAddress</span> <span class="hljs-string">specifies</span> <span class="hljs-string">an</span> <span class="hljs-string">address</span> <span class="hljs-string">to</span> <span class="hljs-string">use</span> <span class="hljs-string">when</span> <span class="hljs-string">performing</span><br>                  <span class="hljs-string">source</span> <span class="hljs-string">NAT</span> <span class="hljs-string">for</span> <span class="hljs-string">traffic</span> <span class="hljs-string">in</span> <span class="hljs-string">a</span> <span class="hljs-string">natOutgoing</span> <span class="hljs-string">pool</span> <span class="hljs-string">that</span> <span class="hljs-string">is</span> <span class="hljs-string">leaving</span> <span class="hljs-string">the</span><br>                  <span class="hljs-string">network.</span> <span class="hljs-string">By</span> <span class="hljs-string">default</span> <span class="hljs-string">the</span> <span class="hljs-string">address</span> <span class="hljs-string">used</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">address</span> <span class="hljs-string">on</span> <span class="hljs-string">the</span> <span class="hljs-string">interface</span><br>                  <span class="hljs-string">the</span> <span class="hljs-string">traffic</span> <span class="hljs-string">is</span> <span class="hljs-string">leaving</span> <span class="hljs-string">on</span> <span class="hljs-string">(ie</span> <span class="hljs-string">it</span> <span class="hljs-string">uses</span> <span class="hljs-string">the</span> <span class="hljs-string">iptables</span> <span class="hljs-string">MASQUERADE</span> <span class="hljs-string">target)</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">natPortRange:</span><br>                <span class="hljs-attr">anyOf:</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">NATPortRange</span> <span class="hljs-string">specifies</span> <span class="hljs-string">the</span> <span class="hljs-string">range</span> <span class="hljs-string">of</span> <span class="hljs-string">ports</span> <span class="hljs-string">that</span> <span class="hljs-string">is</span> <span class="hljs-string">used</span><br>                  <span class="hljs-string">for</span> <span class="hljs-string">port</span> <span class="hljs-string">mapping</span> <span class="hljs-string">when</span> <span class="hljs-string">doing</span> <span class="hljs-string">outgoing</span> <span class="hljs-string">NAT.</span> <span class="hljs-string">When</span> <span class="hljs-string">unset</span> <span class="hljs-string">the</span> <span class="hljs-string">default</span><br>                  <span class="hljs-string">behavior</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">network</span> <span class="hljs-string">stack</span> <span class="hljs-string">is</span> <span class="hljs-string">used.</span><br>                <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>              <span class="hljs-attr">netlinkTimeout:</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">openstackRegion:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;OpenstackRegion is the name of the region that a particular</span><br><span class="hljs-string">                  Felix belongs to. In a multi-region Calico/OpenStack deployment,</span><br><span class="hljs-string">                  this must be configured somehow for each Felix (here in the datamodel,</span><br><span class="hljs-string">                  or in felix.cfg or the environment on each compute node), and must</span><br><span class="hljs-string">                  match the [calico] openstack_region value configured in neutron.conf</span><br><span class="hljs-string">                  on each node. [Default: Empty]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">policySyncPathPrefix:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;PolicySyncPathPrefix is used to by Felix to communicate</span><br><span class="hljs-string">                  policy changes to external services, like Application layer policy.</span><br><span class="hljs-string">                  [Default: Empty]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">prometheusGoMetricsEnabled:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;PrometheusGoMetricsEnabled disables Go runtime metrics</span><br><span class="hljs-string">                  collection, which the Prometheus client does by default, when set</span><br><span class="hljs-string">                  to false. This reduces the number of metrics reported, reducing</span><br><span class="hljs-string">                  Prometheus load. [Default: true]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">prometheusMetricsEnabled:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;PrometheusMetricsEnabled enables the Prometheus metrics</span><br><span class="hljs-string">                  server in Felix if set to true. [Default: false]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">prometheusMetricsHost:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;PrometheusMetricsHost is the host that the Prometheus</span><br><span class="hljs-string">                  metrics server should bind to. [Default: empty]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">prometheusMetricsPort:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;PrometheusMetricsPort is the TCP port that the Prometheus</span><br><span class="hljs-string">                  metrics server should bind to. [Default: 9091]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">prometheusProcessMetricsEnabled:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;PrometheusProcessMetricsEnabled disables process metrics</span><br><span class="hljs-string">                  collection, which the Prometheus client does by default, when set</span><br><span class="hljs-string">                  to false. This reduces the number of metrics reported, reducing</span><br><span class="hljs-string">                  Prometheus load. [Default: true]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">prometheusWireGuardMetricsEnabled:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;PrometheusWireGuardMetricsEnabled disables wireguard</span><br><span class="hljs-string">                  metrics collection, which the Prometheus client does by default,</span><br><span class="hljs-string">                  when set to false. This reduces the number of metrics reported,</span><br><span class="hljs-string">                  reducing Prometheus load. [Default: true]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">removeExternalRoutes:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Whether</span> <span class="hljs-string">or</span> <span class="hljs-string">not</span> <span class="hljs-string">to</span> <span class="hljs-string">remove</span> <span class="hljs-string">device</span> <span class="hljs-string">routes</span> <span class="hljs-string">that</span> <span class="hljs-string">have</span> <span class="hljs-string">not</span><br>                  <span class="hljs-string">been</span> <span class="hljs-string">programmed</span> <span class="hljs-string">by</span> <span class="hljs-string">Felix.</span> <span class="hljs-string">Disabling</span> <span class="hljs-string">this</span> <span class="hljs-string">will</span> <span class="hljs-string">allow</span> <span class="hljs-string">external</span> <span class="hljs-string">applications</span><br>                  <span class="hljs-string">to</span> <span class="hljs-string">also</span> <span class="hljs-string">add</span> <span class="hljs-string">device</span> <span class="hljs-string">routes.</span> <span class="hljs-string">This</span> <span class="hljs-string">is</span> <span class="hljs-string">enabled</span> <span class="hljs-string">by</span> <span class="hljs-string">default</span> <span class="hljs-string">which</span> <span class="hljs-string">means</span><br>                  <span class="hljs-string">we</span> <span class="hljs-string">will</span> <span class="hljs-string">remove</span> <span class="hljs-string">externally</span> <span class="hljs-string">added</span> <span class="hljs-string">routes.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">reportingInterval:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;ReportingInterval is the interval at which Felix reports</span><br><span class="hljs-string">                  its status into the datastore or 0 to disable. Must be non-zero</span><br><span class="hljs-string">                  in OpenStack deployments. [Default: 30s]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">reportingTTL:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;ReportingTTL is the time-to-live setting for process-wide</span><br><span class="hljs-string">                  status reports. [Default: 90s]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">routeRefreshInterval:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;RouteRefreshInterval is the period at which Felix re-checks</span><br><span class="hljs-string">                  the routes in the dataplane to ensure that no other process has</span><br><span class="hljs-string">                  accidentally broken Calico<span class="hljs-char escape_">&#x27;&#x27;</span>s rules. Set to 0 to disable route refresh.</span><br><span class="hljs-string">                  [Default: 90s]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">routeSource:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;RouteSource configures where Felix gets its routing</span><br><span class="hljs-string">                  information. - WorkloadIPs: use workload endpoints to construct</span><br><span class="hljs-string">                  routes. - CalicoIPAM: the default - use IPAM data to construct routes.&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">routeSyncDisabled:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">RouteSyncDisabled</span> <span class="hljs-string">will</span> <span class="hljs-string">disable</span> <span class="hljs-string">all</span> <span class="hljs-string">operations</span> <span class="hljs-string">performed</span><br>                  <span class="hljs-string">on</span> <span class="hljs-string">the</span> <span class="hljs-string">route</span> <span class="hljs-string">table.</span> <span class="hljs-string">Set</span> <span class="hljs-string">to</span> <span class="hljs-literal">true</span> <span class="hljs-string">to</span> <span class="hljs-string">run</span> <span class="hljs-string">in</span> <span class="hljs-string">network-policy</span> <span class="hljs-string">mode</span> <span class="hljs-string">only.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">routeTableRange:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Deprecated</span> <span class="hljs-string">in</span> <span class="hljs-string">favor</span> <span class="hljs-string">of</span> <span class="hljs-string">RouteTableRanges.</span> <span class="hljs-string">Calico</span> <span class="hljs-string">programs</span><br>                  <span class="hljs-string">additional</span> <span class="hljs-string">Linux</span> <span class="hljs-string">route</span> <span class="hljs-string">tables</span> <span class="hljs-string">for</span> <span class="hljs-string">various</span> <span class="hljs-string">purposes.</span> <span class="hljs-string">RouteTableRange</span><br>                  <span class="hljs-string">specifies</span> <span class="hljs-string">the</span> <span class="hljs-string">indices</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">route</span> <span class="hljs-string">tables</span> <span class="hljs-string">that</span> <span class="hljs-string">Calico</span> <span class="hljs-string">should</span> <span class="hljs-string">use.</span><br>                <span class="hljs-attr">properties:</span><br>                  <span class="hljs-attr">max:</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                  <span class="hljs-attr">min:</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                <span class="hljs-attr">required:</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">max</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">min</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>              <span class="hljs-attr">routeTableRanges:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Calico</span> <span class="hljs-string">programs</span> <span class="hljs-string">additional</span> <span class="hljs-string">Linux</span> <span class="hljs-string">route</span> <span class="hljs-string">tables</span> <span class="hljs-string">for</span> <span class="hljs-string">various</span><br>                  <span class="hljs-string">purposes.</span> <span class="hljs-string">RouteTableRanges</span> <span class="hljs-string">specifies</span> <span class="hljs-string">a</span> <span class="hljs-string">set</span> <span class="hljs-string">of</span> <span class="hljs-string">table</span> <span class="hljs-string">index</span> <span class="hljs-string">ranges</span><br>                  <span class="hljs-string">that</span> <span class="hljs-string">Calico</span> <span class="hljs-string">should</span> <span class="hljs-string">use.</span> <span class="hljs-string">Deprecates`RouteTableRange`,</span> <span class="hljs-string">overrides</span> <span class="hljs-string">`RouteTableRange`.</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">properties:</span><br>                    <span class="hljs-attr">max:</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                    <span class="hljs-attr">min:</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                  <span class="hljs-attr">required:</span><br>                  <span class="hljs-bullet">-</span> <span class="hljs-string">max</span><br>                  <span class="hljs-bullet">-</span> <span class="hljs-string">min</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>              <span class="hljs-attr">serviceLoopPrevention:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;When service IP advertisement is enabled, prevent routing</span><br><span class="hljs-string">                  loops to service IPs that are not in use, by dropping or rejecting</span><br><span class="hljs-string">                  packets that do not get DNAT<span class="hljs-char escape_">&#x27;&#x27;</span>d by kube-proxy. Unless set to &quot;Disabled&quot;,</span><br><span class="hljs-string">                  in which case such routing loops continue to be allowed. [Default:</span><br><span class="hljs-string">                  Drop]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">sidecarAccelerationEnabled:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;SidecarAccelerationEnabled enables experimental sidecar</span><br><span class="hljs-string">                  acceleration [Default: false]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">usageReportingEnabled:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;UsageReportingEnabled reports anonymous Calico version</span><br><span class="hljs-string">                  number and cluster size to projectcalico.org. Logs warnings returned</span><br><span class="hljs-string">                  by the usage server. For example, if a significant security vulnerability</span><br><span class="hljs-string">                  has been discovered in the version of Calico being used. [Default:</span><br><span class="hljs-string">                  true]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">usageReportingInitialDelay:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;UsageReportingInitialDelay controls the minimum delay</span><br><span class="hljs-string">                  before Felix makes a report. [Default: 300s]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">usageReportingInterval:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;UsageReportingInterval controls the interval at which</span><br><span class="hljs-string">                  Felix makes reports. [Default: 86400s]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">useInternalDataplaneDriver:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">UseInternalDataplaneDriver,</span> <span class="hljs-string">if</span> <span class="hljs-literal">true</span><span class="hljs-string">,</span> <span class="hljs-string">Felix</span> <span class="hljs-string">will</span> <span class="hljs-string">use</span> <span class="hljs-string">its</span><br>                  <span class="hljs-string">internal</span> <span class="hljs-string">dataplane</span> <span class="hljs-string">programming</span> <span class="hljs-string">logic.</span>  <span class="hljs-string">If</span> <span class="hljs-literal">false</span><span class="hljs-string">,</span> <span class="hljs-string">it</span> <span class="hljs-string">will</span> <span class="hljs-string">launch</span><br>                  <span class="hljs-string">an</span> <span class="hljs-string">external</span> <span class="hljs-string">dataplane</span> <span class="hljs-string">driver</span> <span class="hljs-string">and</span> <span class="hljs-string">communicate</span> <span class="hljs-string">with</span> <span class="hljs-string">it</span> <span class="hljs-string">over</span> <span class="hljs-string">protobuf.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">vxlanEnabled:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;VXLANEnabled overrides whether Felix should create the</span><br><span class="hljs-string">                  VXLAN tunnel device for IPv4 VXLAN networking. Optional as Felix</span><br><span class="hljs-string">                  determines this based on the existing IP pools. [Default: nil (unset)]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">vxlanMTU:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;VXLANMTU is the MTU to set on the IPv4 VXLAN tunnel</span><br><span class="hljs-string">                  device. See Configuring MTU [Default: 1410]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">vxlanMTUV6:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;VXLANMTUV6 is the MTU to set on the IPv6 VXLAN tunnel</span><br><span class="hljs-string">                  device. See Configuring MTU [Default: 1390]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">vxlanPort:</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">vxlanVNI:</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">wireguardEnabled:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;WireguardEnabled controls whether Wireguard is enabled</span><br><span class="hljs-string">                  for IPv4 (encapsulating IPv4 traffic over an IPv4 underlay network).</span><br><span class="hljs-string">                  [Default: false]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">wireguardEnabledV6:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;WireguardEnabledV6 controls whether Wireguard is enabled</span><br><span class="hljs-string">                  for IPv6 (encapsulating IPv6 traffic over an IPv6 underlay network).</span><br><span class="hljs-string">                  [Default: false]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">wireguardHostEncryptionEnabled:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;WireguardHostEncryptionEnabled controls whether Wireguard</span><br><span class="hljs-string">                  host-to-host encryption is enabled. [Default: false]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">wireguardInterfaceName:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;WireguardInterfaceName specifies the name to use for</span><br><span class="hljs-string">                  the IPv4 Wireguard interface. [Default: wireguard.cali]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">wireguardInterfaceNameV6:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;WireguardInterfaceNameV6 specifies the name to use for</span><br><span class="hljs-string">                  the IPv6 Wireguard interface. [Default: wg-v6.cali]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">wireguardKeepAlive:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;WireguardKeepAlive controls Wireguard PersistentKeepalive</span><br><span class="hljs-string">                  option. Set 0 to disable. [Default: 0]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">wireguardListeningPort:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;WireguardListeningPort controls the listening port used</span><br><span class="hljs-string">                  by IPv4 Wireguard. [Default: 51820]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">wireguardListeningPortV6:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;WireguardListeningPortV6 controls the listening port</span><br><span class="hljs-string">                  used by IPv6 Wireguard. [Default: 51821]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">wireguardMTU:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;WireguardMTU controls the MTU on the IPv4 Wireguard</span><br><span class="hljs-string">                  interface. See Configuring MTU [Default: 1440]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">wireguardMTUV6:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;WireguardMTUV6 controls the MTU on the IPv6 Wireguard</span><br><span class="hljs-string">                  interface. See Configuring MTU [Default: 1420]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">wireguardRoutingRulePriority:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;WireguardRoutingRulePriority controls the priority value</span><br><span class="hljs-string">                  to use for the Wireguard routing rule. [Default: 99]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">workloadSourceSpoofing:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">WorkloadSourceSpoofing</span> <span class="hljs-string">controls</span> <span class="hljs-string">whether</span> <span class="hljs-string">pods</span> <span class="hljs-string">can</span> <span class="hljs-string">use</span><br>                  <span class="hljs-string">the</span> <span class="hljs-string">allowedSourcePrefixes</span> <span class="hljs-string">annotation</span> <span class="hljs-string">to</span> <span class="hljs-string">send</span> <span class="hljs-string">traffic</span> <span class="hljs-string">with</span> <span class="hljs-string">a</span> <span class="hljs-string">source</span><br>                  <span class="hljs-string">IP</span> <span class="hljs-string">address</span> <span class="hljs-string">that</span> <span class="hljs-string">is</span> <span class="hljs-string">not</span> <span class="hljs-string">theirs.</span> <span class="hljs-string">This</span> <span class="hljs-string">is</span> <span class="hljs-string">disabled</span> <span class="hljs-string">by</span> <span class="hljs-string">default.</span> <span class="hljs-string">When</span><br>                  <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">&quot;Any&quot;</span><span class="hljs-string">,</span> <span class="hljs-string">pods</span> <span class="hljs-string">can</span> <span class="hljs-string">request</span> <span class="hljs-string">any</span> <span class="hljs-string">prefix.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">xdpEnabled:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;XDPEnabled enables XDP acceleration for suitable untracked</span><br><span class="hljs-string">                  incoming deny rules. [Default: true]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">xdpRefreshInterval:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;XDPRefreshInterval is the period at which Felix re-checks</span><br><span class="hljs-string">                  all XDP state to ensure that no other process has accidentally broken</span><br><span class="hljs-string">                  Calico<span class="hljs-char escape_">&#x27;&#x27;</span>s BPF maps or attached programs. Set to 0 to disable XDP</span><br><span class="hljs-string">                  refresh. [Default: 90s]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>    <span class="hljs-attr">served:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">storage:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">status:</span><br>  <span class="hljs-attr">acceptedNames:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">conditions:</span> []<br>  <span class="hljs-attr">storedVersions:</span> []<br><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/kdd-crds.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apiextensions.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">CustomResourceDefinition</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">globalnetworkpolicies.crd.projectcalico.org</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">group:</span> <span class="hljs-string">crd.projectcalico.org</span><br>  <span class="hljs-attr">names:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">GlobalNetworkPolicy</span><br>    <span class="hljs-attr">listKind:</span> <span class="hljs-string">GlobalNetworkPolicyList</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">globalnetworkpolicies</span><br>    <span class="hljs-attr">singular:</span> <span class="hljs-string">globalnetworkpolicy</span><br>  <span class="hljs-attr">preserveUnknownFields:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">scope:</span> <span class="hljs-string">Cluster</span><br>  <span class="hljs-attr">versions:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">v1</span><br>    <span class="hljs-attr">schema:</span><br>      <span class="hljs-attr">openAPIV3Schema:</span><br>        <span class="hljs-attr">properties:</span><br>          <span class="hljs-attr">apiVersion:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;APIVersion defines the versioned schema of this representation</span><br><span class="hljs-string">              of an object. Servers should convert recognized schemas to the latest</span><br><span class="hljs-string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">kind:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Kind is a string value representing the REST resource this</span><br><span class="hljs-string">              object represents. Servers may infer this from the endpoint the client</span><br><span class="hljs-string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">metadata:</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>          <span class="hljs-attr">spec:</span><br>            <span class="hljs-attr">properties:</span><br>              <span class="hljs-attr">applyOnForward:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">ApplyOnForward</span> <span class="hljs-string">indicates</span> <span class="hljs-string">to</span> <span class="hljs-string">apply</span> <span class="hljs-string">the</span> <span class="hljs-string">rules</span> <span class="hljs-string">in</span> <span class="hljs-string">this</span> <span class="hljs-string">policy</span><br>                  <span class="hljs-string">on</span> <span class="hljs-string">forward</span> <span class="hljs-string">traffic.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">doNotTrack:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">DoNotTrack</span> <span class="hljs-string">indicates</span> <span class="hljs-string">whether</span> <span class="hljs-string">packets</span> <span class="hljs-string">matched</span> <span class="hljs-string">by</span> <span class="hljs-string">the</span> <span class="hljs-string">rules</span><br>                  <span class="hljs-string">in</span> <span class="hljs-string">this</span> <span class="hljs-string">policy</span> <span class="hljs-string">should</span> <span class="hljs-string">go</span> <span class="hljs-string">through</span> <span class="hljs-string">the</span> <span class="hljs-string">data</span> <span class="hljs-string">plane&#x27;s</span> <span class="hljs-string">connection</span> <span class="hljs-string">tracking,</span><br>                  <span class="hljs-string">such</span> <span class="hljs-string">as</span> <span class="hljs-string">Linux</span> <span class="hljs-string">conntrack.</span>  <span class="hljs-string">If</span> <span class="hljs-literal">True</span><span class="hljs-string">,</span> <span class="hljs-string">the</span> <span class="hljs-string">rules</span> <span class="hljs-string">in</span> <span class="hljs-string">this</span> <span class="hljs-string">policy</span> <span class="hljs-string">are</span><br>                  <span class="hljs-string">applied</span> <span class="hljs-string">before</span> <span class="hljs-string">any</span> <span class="hljs-string">data</span> <span class="hljs-string">plane</span> <span class="hljs-string">connection</span> <span class="hljs-string">tracking,</span> <span class="hljs-string">and</span> <span class="hljs-string">packets</span> <span class="hljs-string">allowed</span><br>                  <span class="hljs-string">by</span> <span class="hljs-string">this</span> <span class="hljs-string">policy</span> <span class="hljs-string">are</span> <span class="hljs-string">marked</span> <span class="hljs-string">as</span> <span class="hljs-string">not</span> <span class="hljs-string">to</span> <span class="hljs-string">be</span> <span class="hljs-string">tracked.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">egress:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">The</span> <span class="hljs-string">ordered</span> <span class="hljs-string">set</span> <span class="hljs-string">of</span> <span class="hljs-string">egress</span> <span class="hljs-string">rules.</span>  <span class="hljs-string">Each</span> <span class="hljs-string">rule</span> <span class="hljs-string">contains</span><br>                  <span class="hljs-string">a</span> <span class="hljs-string">set</span> <span class="hljs-string">of</span> <span class="hljs-string">packet</span> <span class="hljs-string">match</span> <span class="hljs-string">criteria</span> <span class="hljs-string">and</span> <span class="hljs-string">a</span> <span class="hljs-string">corresponding</span> <span class="hljs-string">action</span> <span class="hljs-string">to</span> <span class="hljs-string">apply.</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;A Rule encapsulates a set of match criteria and an</span><br><span class="hljs-string">                    action.  Both selector-based security Policy and security Profiles</span><br><span class="hljs-string">                    reference rules - separated out as a list of rules for both ingress</span><br><span class="hljs-string">                    and egress packet matching. \n Each positive match criteria has</span><br><span class="hljs-string">                    a negated version, prefixed with \&quot;Not\&quot;. All the match criteria</span><br><span class="hljs-string">                    within a rule must be satisfied for a packet to match. A single</span><br><span class="hljs-string">                    rule can contain the positive and negative version of a match</span><br><span class="hljs-string">                    and both must be satisfied for the rule to match.&quot;</span><br>                  <span class="hljs-attr">properties:</span><br>                    <span class="hljs-attr">action:</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                    <span class="hljs-attr">destination:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">Destination</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">match</span> <span class="hljs-string">criteria</span> <span class="hljs-string">that</span> <span class="hljs-string">apply</span><br>                        <span class="hljs-string">to</span> <span class="hljs-string">destination</span> <span class="hljs-string">entity.</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">namespaceSelector:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;NamespaceSelector is an optional field that</span><br><span class="hljs-string">                            contains a selector expression. Only traffic that originates</span><br><span class="hljs-string">                            from (or terminates at) endpoints within the selected</span><br><span class="hljs-string">                            namespaces will be matched. When both NamespaceSelector</span><br><span class="hljs-string">                            and another selector are defined on the same rule, then</span><br><span class="hljs-string">                            only workload endpoints that are matched by both selectors</span><br><span class="hljs-string">                            will be selected by the rule. \n For NetworkPolicy, an</span><br><span class="hljs-string">                            empty NamespaceSelector implies that the Selector is limited</span><br><span class="hljs-string">                            to selecting only workload endpoints in the same namespace</span><br><span class="hljs-string">                            as the NetworkPolicy. \n For NetworkPolicy, `global()`</span><br><span class="hljs-string">                            NamespaceSelector implies that the Selector is limited</span><br><span class="hljs-string">                            to selecting only GlobalNetworkSet or HostEndpoint. \n</span><br><span class="hljs-string">                            For GlobalNetworkPolicy, an empty NamespaceSelector implies</span><br><span class="hljs-string">                            the Selector applies to workload endpoints across all</span><br><span class="hljs-string">                            namespaces.&quot;</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">nets:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Nets</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span> <span class="hljs-string">the</span><br>                            <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span> <span class="hljs-string">from</span> <span class="hljs-string">(or</span><br>                            <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">IP</span> <span class="hljs-string">addresses</span> <span class="hljs-string">in</span> <span class="hljs-string">any</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">given</span> <span class="hljs-string">subnets.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">notNets:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">NotNets</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Nets</span><br>                            <span class="hljs-string">field.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">notPorts:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">NotPorts</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Ports</span><br>                            <span class="hljs-string">field.</span> <span class="hljs-string">Since</span> <span class="hljs-string">only</span> <span class="hljs-string">some</span> <span class="hljs-string">protocols</span> <span class="hljs-string">have</span> <span class="hljs-string">ports,</span> <span class="hljs-string">if</span> <span class="hljs-string">any</span> <span class="hljs-string">ports</span><br>                            <span class="hljs-string">are</span> <span class="hljs-string">specified</span> <span class="hljs-string">it</span> <span class="hljs-string">requires</span> <span class="hljs-string">the</span> <span class="hljs-string">Protocol</span> <span class="hljs-string">match</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">Rule</span><br>                            <span class="hljs-string">to</span> <span class="hljs-string">be</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">&quot;TCP&quot;</span> <span class="hljs-string">or</span> <span class="hljs-string">&quot;UDP&quot;</span><span class="hljs-string">.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">anyOf:</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                            <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">notSelector:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">NotSelector</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Selector</span><br>                            <span class="hljs-string">field.</span>  <span class="hljs-string">See</span> <span class="hljs-string">Selector</span> <span class="hljs-string">field</span> <span class="hljs-string">for</span> <span class="hljs-string">subtleties</span> <span class="hljs-string">with</span> <span class="hljs-string">negated</span><br>                            <span class="hljs-string">selectors.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">ports:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Ports is an optional field that restricts</span><br><span class="hljs-string">                            the rule to only apply to traffic that has a source (destination)</span><br><span class="hljs-string">                            port that matches one of these ranges/values. This value</span><br><span class="hljs-string">                            is a list of integers or strings that represent ranges</span><br><span class="hljs-string">                            of ports. \n Since only some protocols have ports, if</span><br><span class="hljs-string">                            any ports are specified it requires the Protocol match</span><br><span class="hljs-string">                            in the Rule to be set to \&quot;TCP\&quot; or \&quot;UDP\&quot;.&quot;</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">anyOf:</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                            <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">selector:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Selector is an optional field that contains</span><br><span class="hljs-string">                            a selector expression (see Policy for sample syntax).</span><br><span class="hljs-string">                            \ Only traffic that originates from (terminates at) endpoints</span><br><span class="hljs-string">                            matching the selector will be matched. \n Note that: in</span><br><span class="hljs-string">                            addition to the negated version of the Selector (see NotSelector</span><br><span class="hljs-string">                            below), the selector expression syntax itself supports</span><br><span class="hljs-string">                            negation.  The two types of negation are subtly different.</span><br><span class="hljs-string">                            One negates the set of matched endpoints, the other negates</span><br><span class="hljs-string">                            the whole match: \n \tSelector = \&quot;!has(my_label)\&quot; matches</span><br><span class="hljs-string">                            packets that are from other Calico-controlled \tendpoints</span><br><span class="hljs-string">                            that do not have the label \&quot;my_label\&quot;. \n \tNotSelector</span><br><span class="hljs-string">                            = \&quot;has(my_label)\&quot; matches packets that are not from</span><br><span class="hljs-string">                            Calico-controlled \tendpoints that do have the label \&quot;my_label\&quot;.</span><br><span class="hljs-string">                            \n The effect is that the latter will accept packets from</span><br><span class="hljs-string">                            non-Calico sources whereas the former is limited to packets</span><br><span class="hljs-string">                            from Calico-controlled endpoints.&quot;</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">serviceAccounts:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">ServiceAccounts</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                            <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span> <span class="hljs-string">from</span><br>                            <span class="hljs-string">(or</span> <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">running</span> <span class="hljs-string">as</span> <span class="hljs-string">a</span> <span class="hljs-string">matching</span> <span class="hljs-string">service</span><br>                            <span class="hljs-string">account.</span><br>                          <span class="hljs-attr">properties:</span><br>                            <span class="hljs-attr">names:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Names</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                                <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span><br>                                <span class="hljs-string">from</span> <span class="hljs-string">(or</span> <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">running</span> <span class="hljs-string">as</span> <span class="hljs-string">a</span> <span class="hljs-string">service</span><br>                                <span class="hljs-string">account</span> <span class="hljs-string">whose</span> <span class="hljs-string">name</span> <span class="hljs-string">is</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">list.</span><br>                              <span class="hljs-attr">items:</span><br>                                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                            <span class="hljs-attr">selector:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Selector</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                                <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span><br>                                <span class="hljs-string">from</span> <span class="hljs-string">(or</span> <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">running</span> <span class="hljs-string">as</span> <span class="hljs-string">a</span> <span class="hljs-string">service</span><br>                                <span class="hljs-string">account</span> <span class="hljs-string">that</span> <span class="hljs-string">matches</span> <span class="hljs-string">the</span> <span class="hljs-string">given</span> <span class="hljs-string">label</span> <span class="hljs-string">selector.</span> <span class="hljs-string">If</span><br>                                <span class="hljs-string">both</span> <span class="hljs-string">Names</span> <span class="hljs-string">and</span> <span class="hljs-string">Selector</span> <span class="hljs-string">are</span> <span class="hljs-string">specified</span> <span class="hljs-string">then</span> <span class="hljs-string">they</span> <span class="hljs-string">are</span><br>                                <span class="hljs-string">AND&#x27;ed.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                        <span class="hljs-attr">services:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Services is an optional field that contains</span><br><span class="hljs-string">                            options for matching Kubernetes Services. If specified,</span><br><span class="hljs-string">                            only traffic that originates from or terminates at endpoints</span><br><span class="hljs-string">                            within the selected service(s) will be matched, and only</span><br><span class="hljs-string">                            to/from each endpoint&#x27;s port. \n Services cannot be specified</span><br><span class="hljs-string">                            on the same rule as Selector, NotSelector, NamespaceSelector,</span><br><span class="hljs-string">                            Nets, NotNets or ServiceAccounts. \n Ports and NotPorts</span><br><span class="hljs-string">                            can only be specified with Services on ingress rules.&quot;</span><br>                          <span class="hljs-attr">properties:</span><br>                            <span class="hljs-attr">name:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Name</span> <span class="hljs-string">specifies</span> <span class="hljs-string">the</span> <span class="hljs-string">name</span> <span class="hljs-string">of</span> <span class="hljs-string">a</span> <span class="hljs-string">Kubernetes</span><br>                                <span class="hljs-string">Service</span> <span class="hljs-string">to</span> <span class="hljs-string">match.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">namespace:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Namespace</span> <span class="hljs-string">specifies</span> <span class="hljs-string">the</span> <span class="hljs-string">namespace</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span><br>                                <span class="hljs-string">given</span> <span class="hljs-string">Service.</span> <span class="hljs-string">If</span> <span class="hljs-string">left</span> <span class="hljs-string">empty,</span> <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">will</span> <span class="hljs-string">match</span><br>                                <span class="hljs-string">within</span> <span class="hljs-string">this</span> <span class="hljs-string">policy&#x27;s</span> <span class="hljs-string">namespace.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                    <span class="hljs-attr">http:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">HTTP</span> <span class="hljs-string">contains</span> <span class="hljs-string">match</span> <span class="hljs-string">criteria</span> <span class="hljs-string">that</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">HTTP</span><br>                        <span class="hljs-string">requests.</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">methods:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Methods</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                            <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">apply</span> <span class="hljs-string">only</span> <span class="hljs-string">to</span> <span class="hljs-string">HTTP</span> <span class="hljs-string">requests</span> <span class="hljs-string">that</span> <span class="hljs-string">use</span> <span class="hljs-string">one</span> <span class="hljs-string">of</span><br>                            <span class="hljs-string">the</span> <span class="hljs-string">listed</span> <span class="hljs-string">HTTP</span> <span class="hljs-string">Methods</span> <span class="hljs-string">(e.g.</span> <span class="hljs-string">GET,</span> <span class="hljs-string">PUT,</span> <span class="hljs-string">etc.)</span> <span class="hljs-string">Multiple</span><br>                            <span class="hljs-string">methods</span> <span class="hljs-string">are</span> <span class="hljs-string">OR&#x27;d</span> <span class="hljs-string">together.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">paths:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Paths is an optional field that restricts</span><br><span class="hljs-string">                            the rule to apply to HTTP requests that use one of the</span><br><span class="hljs-string">                            listed HTTP Paths. Multiple paths are OR<span class="hljs-char escape_">&#x27;&#x27;</span>d together.</span><br><span class="hljs-string">                            e.g: - exact: /foo - prefix: /bar NOTE: Each entry may</span><br><span class="hljs-string">                            ONLY specify either a `exact` or a `prefix` match. The</span><br><span class="hljs-string">                            validator will check for it.&#x27;</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;HTTPPath specifies an HTTP path to match.</span><br><span class="hljs-string">                              It may be either of the form: exact: &lt;path&gt;: which matches</span><br><span class="hljs-string">                              the path exactly or prefix: &lt;path-prefix&gt;: which matches</span><br><span class="hljs-string">                              the path prefix&#x27;</span><br>                            <span class="hljs-attr">properties:</span><br>                              <span class="hljs-attr">exact:</span><br>                                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                              <span class="hljs-attr">prefix:</span><br>                                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                    <span class="hljs-attr">icmp:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span> <span class="hljs-string">the</span> <span class="hljs-string">rule</span><br>                        <span class="hljs-string">to</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">type</span> <span class="hljs-string">and</span> <span class="hljs-string">code</span> <span class="hljs-string">of</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">traffic.</span>  <span class="hljs-string">This</span><br>                        <span class="hljs-string">should</span> <span class="hljs-string">only</span> <span class="hljs-string">be</span> <span class="hljs-string">specified</span> <span class="hljs-string">if</span> <span class="hljs-string">the</span> <span class="hljs-string">Protocol</span> <span class="hljs-string">field</span> <span class="hljs-string">is</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">&quot;ICMP&quot;</span><br>                        <span class="hljs-string">or</span> <span class="hljs-string">&quot;ICMPv6&quot;</span><span class="hljs-string">.</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">code:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Match</span> <span class="hljs-string">on</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">code.</span>  <span class="hljs-string">If</span> <span class="hljs-string">specified,</span><br>                            <span class="hljs-string">the</span> <span class="hljs-string">Type</span> <span class="hljs-string">value</span> <span class="hljs-string">must</span> <span class="hljs-string">also</span> <span class="hljs-string">be</span> <span class="hljs-string">specified.</span> <span class="hljs-string">This</span> <span class="hljs-string">is</span> <span class="hljs-string">a</span> <span class="hljs-string">technical</span><br>                            <span class="hljs-string">limitation</span> <span class="hljs-string">imposed</span> <span class="hljs-string">by</span> <span class="hljs-string">the</span> <span class="hljs-string">kernel&#x27;s</span> <span class="hljs-string">iptables</span> <span class="hljs-string">firewall,</span><br>                            <span class="hljs-string">which</span> <span class="hljs-string">Calico</span> <span class="hljs-string">uses</span> <span class="hljs-string">to</span> <span class="hljs-string">enforce</span> <span class="hljs-string">the</span> <span class="hljs-string">rule.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                        <span class="hljs-attr">type:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Match</span> <span class="hljs-string">on</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">type.</span>  <span class="hljs-string">For</span> <span class="hljs-string">example</span><br>                            <span class="hljs-string">a</span> <span class="hljs-string">value</span> <span class="hljs-string">of</span> <span class="hljs-number">8</span> <span class="hljs-string">refers</span> <span class="hljs-string">to</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">Echo</span> <span class="hljs-string">Request</span> <span class="hljs-string">(i.e.</span> <span class="hljs-string">pings).</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                    <span class="hljs-attr">ipVersion:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">IPVersion</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span> <span class="hljs-string">the</span><br>                        <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">match</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">IP</span> <span class="hljs-string">version.</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                    <span class="hljs-attr">metadata:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">Metadata</span> <span class="hljs-string">contains</span> <span class="hljs-string">additional</span> <span class="hljs-string">information</span> <span class="hljs-string">for</span> <span class="hljs-string">this</span><br>                        <span class="hljs-string">rule</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">annotations:</span><br>                          <span class="hljs-attr">additionalProperties:</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Annotations</span> <span class="hljs-string">is</span> <span class="hljs-string">a</span> <span class="hljs-string">set</span> <span class="hljs-string">of</span> <span class="hljs-string">key</span> <span class="hljs-string">value</span> <span class="hljs-string">pairs</span> <span class="hljs-string">that</span><br>                            <span class="hljs-string">give</span> <span class="hljs-string">extra</span> <span class="hljs-string">information</span> <span class="hljs-string">about</span> <span class="hljs-string">the</span> <span class="hljs-string">rule</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                    <span class="hljs-attr">notICMP:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">NotICMP</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">field.</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">code:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Match</span> <span class="hljs-string">on</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">code.</span>  <span class="hljs-string">If</span> <span class="hljs-string">specified,</span><br>                            <span class="hljs-string">the</span> <span class="hljs-string">Type</span> <span class="hljs-string">value</span> <span class="hljs-string">must</span> <span class="hljs-string">also</span> <span class="hljs-string">be</span> <span class="hljs-string">specified.</span> <span class="hljs-string">This</span> <span class="hljs-string">is</span> <span class="hljs-string">a</span> <span class="hljs-string">technical</span><br>                            <span class="hljs-string">limitation</span> <span class="hljs-string">imposed</span> <span class="hljs-string">by</span> <span class="hljs-string">the</span> <span class="hljs-string">kernel&#x27;s</span> <span class="hljs-string">iptables</span> <span class="hljs-string">firewall,</span><br>                            <span class="hljs-string">which</span> <span class="hljs-string">Calico</span> <span class="hljs-string">uses</span> <span class="hljs-string">to</span> <span class="hljs-string">enforce</span> <span class="hljs-string">the</span> <span class="hljs-string">rule.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                        <span class="hljs-attr">type:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Match</span> <span class="hljs-string">on</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">type.</span>  <span class="hljs-string">For</span> <span class="hljs-string">example</span><br>                            <span class="hljs-string">a</span> <span class="hljs-string">value</span> <span class="hljs-string">of</span> <span class="hljs-number">8</span> <span class="hljs-string">refers</span> <span class="hljs-string">to</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">Echo</span> <span class="hljs-string">Request</span> <span class="hljs-string">(i.e.</span> <span class="hljs-string">pings).</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                    <span class="hljs-attr">notProtocol:</span><br>                      <span class="hljs-attr">anyOf:</span><br>                      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">NotProtocol</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Protocol</span><br>                        <span class="hljs-string">field.</span><br>                      <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                      <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>                    <span class="hljs-attr">protocol:</span><br>                      <span class="hljs-attr">anyOf:</span><br>                      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Protocol is an optional field that restricts the</span><br><span class="hljs-string">                        rule to only apply to traffic of a specific IP protocol. Required</span><br><span class="hljs-string">                        if any of the EntityRules contain Ports (because ports only</span><br><span class="hljs-string">                        apply to certain protocols). \n Must be one of these string</span><br><span class="hljs-string">                        values: \&quot;TCP\&quot;, \&quot;UDP\&quot;, \&quot;ICMP\&quot;, \&quot;ICMPv6\&quot;, \&quot;SCTP\&quot;,</span><br><span class="hljs-string">                        \&quot;UDPLite\&quot; or an integer in the range 1-255.&quot;</span><br>                      <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                      <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>                    <span class="hljs-attr">source:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">Source</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">match</span> <span class="hljs-string">criteria</span> <span class="hljs-string">that</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span><br>                        <span class="hljs-string">source</span> <span class="hljs-string">entity.</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">namespaceSelector:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;NamespaceSelector is an optional field that</span><br><span class="hljs-string">                            contains a selector expression. Only traffic that originates</span><br><span class="hljs-string">                            from (or terminates at) endpoints within the selected</span><br><span class="hljs-string">                            namespaces will be matched. When both NamespaceSelector</span><br><span class="hljs-string">                            and another selector are defined on the same rule, then</span><br><span class="hljs-string">                            only workload endpoints that are matched by both selectors</span><br><span class="hljs-string">                            will be selected by the rule. \n For NetworkPolicy, an</span><br><span class="hljs-string">                            empty NamespaceSelector implies that the Selector is limited</span><br><span class="hljs-string">                            to selecting only workload endpoints in the same namespace</span><br><span class="hljs-string">                            as the NetworkPolicy. \n For NetworkPolicy, `global()`</span><br><span class="hljs-string">                            NamespaceSelector implies that the Selector is limited</span><br><span class="hljs-string">                            to selecting only GlobalNetworkSet or HostEndpoint. \n</span><br><span class="hljs-string">                            For GlobalNetworkPolicy, an empty NamespaceSelector implies</span><br><span class="hljs-string">                            the Selector applies to workload endpoints across all</span><br><span class="hljs-string">                            namespaces.&quot;</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">nets:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Nets</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span> <span class="hljs-string">the</span><br>                            <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span> <span class="hljs-string">from</span> <span class="hljs-string">(or</span><br>                            <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">IP</span> <span class="hljs-string">addresses</span> <span class="hljs-string">in</span> <span class="hljs-string">any</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">given</span> <span class="hljs-string">subnets.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">notNets:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">NotNets</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Nets</span><br>                            <span class="hljs-string">field.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">notPorts:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">NotPorts</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Ports</span><br>                            <span class="hljs-string">field.</span> <span class="hljs-string">Since</span> <span class="hljs-string">only</span> <span class="hljs-string">some</span> <span class="hljs-string">protocols</span> <span class="hljs-string">have</span> <span class="hljs-string">ports,</span> <span class="hljs-string">if</span> <span class="hljs-string">any</span> <span class="hljs-string">ports</span><br>                            <span class="hljs-string">are</span> <span class="hljs-string">specified</span> <span class="hljs-string">it</span> <span class="hljs-string">requires</span> <span class="hljs-string">the</span> <span class="hljs-string">Protocol</span> <span class="hljs-string">match</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">Rule</span><br>                            <span class="hljs-string">to</span> <span class="hljs-string">be</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">&quot;TCP&quot;</span> <span class="hljs-string">or</span> <span class="hljs-string">&quot;UDP&quot;</span><span class="hljs-string">.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">anyOf:</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                            <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">notSelector:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">NotSelector</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Selector</span><br>                            <span class="hljs-string">field.</span>  <span class="hljs-string">See</span> <span class="hljs-string">Selector</span> <span class="hljs-string">field</span> <span class="hljs-string">for</span> <span class="hljs-string">subtleties</span> <span class="hljs-string">with</span> <span class="hljs-string">negated</span><br>                            <span class="hljs-string">selectors.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">ports:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Ports is an optional field that restricts</span><br><span class="hljs-string">                            the rule to only apply to traffic that has a source (destination)</span><br><span class="hljs-string">                            port that matches one of these ranges/values. This value</span><br><span class="hljs-string">                            is a list of integers or strings that represent ranges</span><br><span class="hljs-string">                            of ports. \n Since only some protocols have ports, if</span><br><span class="hljs-string">                            any ports are specified it requires the Protocol match</span><br><span class="hljs-string">                            in the Rule to be set to \&quot;TCP\&quot; or \&quot;UDP\&quot;.&quot;</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">anyOf:</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                            <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">selector:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Selector is an optional field that contains</span><br><span class="hljs-string">                            a selector expression (see Policy for sample syntax).</span><br><span class="hljs-string">                            \ Only traffic that originates from (terminates at) endpoints</span><br><span class="hljs-string">                            matching the selector will be matched. \n Note that: in</span><br><span class="hljs-string">                            addition to the negated version of the Selector (see NotSelector</span><br><span class="hljs-string">                            below), the selector expression syntax itself supports</span><br><span class="hljs-string">                            negation.  The two types of negation are subtly different.</span><br><span class="hljs-string">                            One negates the set of matched endpoints, the other negates</span><br><span class="hljs-string">                            the whole match: \n \tSelector = \&quot;!has(my_label)\&quot; matches</span><br><span class="hljs-string">                            packets that are from other Calico-controlled \tendpoints</span><br><span class="hljs-string">                            that do not have the label \&quot;my_label\&quot;. \n \tNotSelector</span><br><span class="hljs-string">                            = \&quot;has(my_label)\&quot; matches packets that are not from</span><br><span class="hljs-string">                            Calico-controlled \tendpoints that do have the label \&quot;my_label\&quot;.</span><br><span class="hljs-string">                            \n The effect is that the latter will accept packets from</span><br><span class="hljs-string">                            non-Calico sources whereas the former is limited to packets</span><br><span class="hljs-string">                            from Calico-controlled endpoints.&quot;</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">serviceAccounts:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">ServiceAccounts</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                            <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span> <span class="hljs-string">from</span><br>                            <span class="hljs-string">(or</span> <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">running</span> <span class="hljs-string">as</span> <span class="hljs-string">a</span> <span class="hljs-string">matching</span> <span class="hljs-string">service</span><br>                            <span class="hljs-string">account.</span><br>                          <span class="hljs-attr">properties:</span><br>                            <span class="hljs-attr">names:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Names</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                                <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span><br>                                <span class="hljs-string">from</span> <span class="hljs-string">(or</span> <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">running</span> <span class="hljs-string">as</span> <span class="hljs-string">a</span> <span class="hljs-string">service</span><br>                                <span class="hljs-string">account</span> <span class="hljs-string">whose</span> <span class="hljs-string">name</span> <span class="hljs-string">is</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">list.</span><br>                              <span class="hljs-attr">items:</span><br>                                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                            <span class="hljs-attr">selector:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Selector</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                                <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span><br>                                <span class="hljs-string">from</span> <span class="hljs-string">(or</span> <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">running</span> <span class="hljs-string">as</span> <span class="hljs-string">a</span> <span class="hljs-string">service</span><br>                                <span class="hljs-string">account</span> <span class="hljs-string">that</span> <span class="hljs-string">matches</span> <span class="hljs-string">the</span> <span class="hljs-string">given</span> <span class="hljs-string">label</span> <span class="hljs-string">selector.</span> <span class="hljs-string">If</span><br>                                <span class="hljs-string">both</span> <span class="hljs-string">Names</span> <span class="hljs-string">and</span> <span class="hljs-string">Selector</span> <span class="hljs-string">are</span> <span class="hljs-string">specified</span> <span class="hljs-string">then</span> <span class="hljs-string">they</span> <span class="hljs-string">are</span><br>                                <span class="hljs-string">AND&#x27;ed.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                        <span class="hljs-attr">services:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Services is an optional field that contains</span><br><span class="hljs-string">                            options for matching Kubernetes Services. If specified,</span><br><span class="hljs-string">                            only traffic that originates from or terminates at endpoints</span><br><span class="hljs-string">                            within the selected service(s) will be matched, and only</span><br><span class="hljs-string">                            to/from each endpoint&#x27;s port. \n Services cannot be specified</span><br><span class="hljs-string">                            on the same rule as Selector, NotSelector, NamespaceSelector,</span><br><span class="hljs-string">                            Nets, NotNets or ServiceAccounts. \n Ports and NotPorts</span><br><span class="hljs-string">                            can only be specified with Services on ingress rules.&quot;</span><br>                          <span class="hljs-attr">properties:</span><br>                            <span class="hljs-attr">name:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Name</span> <span class="hljs-string">specifies</span> <span class="hljs-string">the</span> <span class="hljs-string">name</span> <span class="hljs-string">of</span> <span class="hljs-string">a</span> <span class="hljs-string">Kubernetes</span><br>                                <span class="hljs-string">Service</span> <span class="hljs-string">to</span> <span class="hljs-string">match.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">namespace:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Namespace</span> <span class="hljs-string">specifies</span> <span class="hljs-string">the</span> <span class="hljs-string">namespace</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span><br>                                <span class="hljs-string">given</span> <span class="hljs-string">Service.</span> <span class="hljs-string">If</span> <span class="hljs-string">left</span> <span class="hljs-string">empty,</span> <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">will</span> <span class="hljs-string">match</span><br>                                <span class="hljs-string">within</span> <span class="hljs-string">this</span> <span class="hljs-string">policy&#x27;s</span> <span class="hljs-string">namespace.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                  <span class="hljs-attr">required:</span><br>                  <span class="hljs-bullet">-</span> <span class="hljs-string">action</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>              <span class="hljs-attr">ingress:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">The</span> <span class="hljs-string">ordered</span> <span class="hljs-string">set</span> <span class="hljs-string">of</span> <span class="hljs-string">ingress</span> <span class="hljs-string">rules.</span>  <span class="hljs-string">Each</span> <span class="hljs-string">rule</span> <span class="hljs-string">contains</span><br>                  <span class="hljs-string">a</span> <span class="hljs-string">set</span> <span class="hljs-string">of</span> <span class="hljs-string">packet</span> <span class="hljs-string">match</span> <span class="hljs-string">criteria</span> <span class="hljs-string">and</span> <span class="hljs-string">a</span> <span class="hljs-string">corresponding</span> <span class="hljs-string">action</span> <span class="hljs-string">to</span> <span class="hljs-string">apply.</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;A Rule encapsulates a set of match criteria and an</span><br><span class="hljs-string">                    action.  Both selector-based security Policy and security Profiles</span><br><span class="hljs-string">                    reference rules - separated out as a list of rules for both ingress</span><br><span class="hljs-string">                    and egress packet matching. \n Each positive match criteria has</span><br><span class="hljs-string">                    a negated version, prefixed with \&quot;Not\&quot;. All the match criteria</span><br><span class="hljs-string">                    within a rule must be satisfied for a packet to match. A single</span><br><span class="hljs-string">                    rule can contain the positive and negative version of a match</span><br><span class="hljs-string">                    and both must be satisfied for the rule to match.&quot;</span><br>                  <span class="hljs-attr">properties:</span><br>                    <span class="hljs-attr">action:</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                    <span class="hljs-attr">destination:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">Destination</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">match</span> <span class="hljs-string">criteria</span> <span class="hljs-string">that</span> <span class="hljs-string">apply</span><br>                        <span class="hljs-string">to</span> <span class="hljs-string">destination</span> <span class="hljs-string">entity.</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">namespaceSelector:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;NamespaceSelector is an optional field that</span><br><span class="hljs-string">                            contains a selector expression. Only traffic that originates</span><br><span class="hljs-string">                            from (or terminates at) endpoints within the selected</span><br><span class="hljs-string">                            namespaces will be matched. When both NamespaceSelector</span><br><span class="hljs-string">                            and another selector are defined on the same rule, then</span><br><span class="hljs-string">                            only workload endpoints that are matched by both selectors</span><br><span class="hljs-string">                            will be selected by the rule. \n For NetworkPolicy, an</span><br><span class="hljs-string">                            empty NamespaceSelector implies that the Selector is limited</span><br><span class="hljs-string">                            to selecting only workload endpoints in the same namespace</span><br><span class="hljs-string">                            as the NetworkPolicy. \n For NetworkPolicy, `global()`</span><br><span class="hljs-string">                            NamespaceSelector implies that the Selector is limited</span><br><span class="hljs-string">                            to selecting only GlobalNetworkSet or HostEndpoint. \n</span><br><span class="hljs-string">                            For GlobalNetworkPolicy, an empty NamespaceSelector implies</span><br><span class="hljs-string">                            the Selector applies to workload endpoints across all</span><br><span class="hljs-string">                            namespaces.&quot;</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">nets:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Nets</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span> <span class="hljs-string">the</span><br>                            <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span> <span class="hljs-string">from</span> <span class="hljs-string">(or</span><br>                            <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">IP</span> <span class="hljs-string">addresses</span> <span class="hljs-string">in</span> <span class="hljs-string">any</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">given</span> <span class="hljs-string">subnets.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">notNets:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">NotNets</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Nets</span><br>                            <span class="hljs-string">field.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">notPorts:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">NotPorts</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Ports</span><br>                            <span class="hljs-string">field.</span> <span class="hljs-string">Since</span> <span class="hljs-string">only</span> <span class="hljs-string">some</span> <span class="hljs-string">protocols</span> <span class="hljs-string">have</span> <span class="hljs-string">ports,</span> <span class="hljs-string">if</span> <span class="hljs-string">any</span> <span class="hljs-string">ports</span><br>                            <span class="hljs-string">are</span> <span class="hljs-string">specified</span> <span class="hljs-string">it</span> <span class="hljs-string">requires</span> <span class="hljs-string">the</span> <span class="hljs-string">Protocol</span> <span class="hljs-string">match</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">Rule</span><br>                            <span class="hljs-string">to</span> <span class="hljs-string">be</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">&quot;TCP&quot;</span> <span class="hljs-string">or</span> <span class="hljs-string">&quot;UDP&quot;</span><span class="hljs-string">.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">anyOf:</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                            <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">notSelector:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">NotSelector</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Selector</span><br>                            <span class="hljs-string">field.</span>  <span class="hljs-string">See</span> <span class="hljs-string">Selector</span> <span class="hljs-string">field</span> <span class="hljs-string">for</span> <span class="hljs-string">subtleties</span> <span class="hljs-string">with</span> <span class="hljs-string">negated</span><br>                            <span class="hljs-string">selectors.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">ports:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Ports is an optional field that restricts</span><br><span class="hljs-string">                            the rule to only apply to traffic that has a source (destination)</span><br><span class="hljs-string">                            port that matches one of these ranges/values. This value</span><br><span class="hljs-string">                            is a list of integers or strings that represent ranges</span><br><span class="hljs-string">                            of ports. \n Since only some protocols have ports, if</span><br><span class="hljs-string">                            any ports are specified it requires the Protocol match</span><br><span class="hljs-string">                            in the Rule to be set to \&quot;TCP\&quot; or \&quot;UDP\&quot;.&quot;</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">anyOf:</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                            <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">selector:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Selector is an optional field that contains</span><br><span class="hljs-string">                            a selector expression (see Policy for sample syntax).</span><br><span class="hljs-string">                            \ Only traffic that originates from (terminates at) endpoints</span><br><span class="hljs-string">                            matching the selector will be matched. \n Note that: in</span><br><span class="hljs-string">                            addition to the negated version of the Selector (see NotSelector</span><br><span class="hljs-string">                            below), the selector expression syntax itself supports</span><br><span class="hljs-string">                            negation.  The two types of negation are subtly different.</span><br><span class="hljs-string">                            One negates the set of matched endpoints, the other negates</span><br><span class="hljs-string">                            the whole match: \n \tSelector = \&quot;!has(my_label)\&quot; matches</span><br><span class="hljs-string">                            packets that are from other Calico-controlled \tendpoints</span><br><span class="hljs-string">                            that do not have the label \&quot;my_label\&quot;. \n \tNotSelector</span><br><span class="hljs-string">                            = \&quot;has(my_label)\&quot; matches packets that are not from</span><br><span class="hljs-string">                            Calico-controlled \tendpoints that do have the label \&quot;my_label\&quot;.</span><br><span class="hljs-string">                            \n The effect is that the latter will accept packets from</span><br><span class="hljs-string">                            non-Calico sources whereas the former is limited to packets</span><br><span class="hljs-string">                            from Calico-controlled endpoints.&quot;</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">serviceAccounts:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">ServiceAccounts</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                            <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span> <span class="hljs-string">from</span><br>                            <span class="hljs-string">(or</span> <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">running</span> <span class="hljs-string">as</span> <span class="hljs-string">a</span> <span class="hljs-string">matching</span> <span class="hljs-string">service</span><br>                            <span class="hljs-string">account.</span><br>                          <span class="hljs-attr">properties:</span><br>                            <span class="hljs-attr">names:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Names</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                                <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span><br>                                <span class="hljs-string">from</span> <span class="hljs-string">(or</span> <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">running</span> <span class="hljs-string">as</span> <span class="hljs-string">a</span> <span class="hljs-string">service</span><br>                                <span class="hljs-string">account</span> <span class="hljs-string">whose</span> <span class="hljs-string">name</span> <span class="hljs-string">is</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">list.</span><br>                              <span class="hljs-attr">items:</span><br>                                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                            <span class="hljs-attr">selector:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Selector</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                                <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span><br>                                <span class="hljs-string">from</span> <span class="hljs-string">(or</span> <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">running</span> <span class="hljs-string">as</span> <span class="hljs-string">a</span> <span class="hljs-string">service</span><br>                                <span class="hljs-string">account</span> <span class="hljs-string">that</span> <span class="hljs-string">matches</span> <span class="hljs-string">the</span> <span class="hljs-string">given</span> <span class="hljs-string">label</span> <span class="hljs-string">selector.</span> <span class="hljs-string">If</span><br>                                <span class="hljs-string">both</span> <span class="hljs-string">Names</span> <span class="hljs-string">and</span> <span class="hljs-string">Selector</span> <span class="hljs-string">are</span> <span class="hljs-string">specified</span> <span class="hljs-string">then</span> <span class="hljs-string">they</span> <span class="hljs-string">are</span><br>                                <span class="hljs-string">AND&#x27;ed.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                        <span class="hljs-attr">services:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Services is an optional field that contains</span><br><span class="hljs-string">                            options for matching Kubernetes Services. If specified,</span><br><span class="hljs-string">                            only traffic that originates from or terminates at endpoints</span><br><span class="hljs-string">                            within the selected service(s) will be matched, and only</span><br><span class="hljs-string">                            to/from each endpoint&#x27;s port. \n Services cannot be specified</span><br><span class="hljs-string">                            on the same rule as Selector, NotSelector, NamespaceSelector,</span><br><span class="hljs-string">                            Nets, NotNets or ServiceAccounts. \n Ports and NotPorts</span><br><span class="hljs-string">                            can only be specified with Services on ingress rules.&quot;</span><br>                          <span class="hljs-attr">properties:</span><br>                            <span class="hljs-attr">name:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Name</span> <span class="hljs-string">specifies</span> <span class="hljs-string">the</span> <span class="hljs-string">name</span> <span class="hljs-string">of</span> <span class="hljs-string">a</span> <span class="hljs-string">Kubernetes</span><br>                                <span class="hljs-string">Service</span> <span class="hljs-string">to</span> <span class="hljs-string">match.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">namespace:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Namespace</span> <span class="hljs-string">specifies</span> <span class="hljs-string">the</span> <span class="hljs-string">namespace</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span><br>                                <span class="hljs-string">given</span> <span class="hljs-string">Service.</span> <span class="hljs-string">If</span> <span class="hljs-string">left</span> <span class="hljs-string">empty,</span> <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">will</span> <span class="hljs-string">match</span><br>                                <span class="hljs-string">within</span> <span class="hljs-string">this</span> <span class="hljs-string">policy&#x27;s</span> <span class="hljs-string">namespace.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                    <span class="hljs-attr">http:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">HTTP</span> <span class="hljs-string">contains</span> <span class="hljs-string">match</span> <span class="hljs-string">criteria</span> <span class="hljs-string">that</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">HTTP</span><br>                        <span class="hljs-string">requests.</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">methods:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Methods</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                            <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">apply</span> <span class="hljs-string">only</span> <span class="hljs-string">to</span> <span class="hljs-string">HTTP</span> <span class="hljs-string">requests</span> <span class="hljs-string">that</span> <span class="hljs-string">use</span> <span class="hljs-string">one</span> <span class="hljs-string">of</span><br>                            <span class="hljs-string">the</span> <span class="hljs-string">listed</span> <span class="hljs-string">HTTP</span> <span class="hljs-string">Methods</span> <span class="hljs-string">(e.g.</span> <span class="hljs-string">GET,</span> <span class="hljs-string">PUT,</span> <span class="hljs-string">etc.)</span> <span class="hljs-string">Multiple</span><br>                            <span class="hljs-string">methods</span> <span class="hljs-string">are</span> <span class="hljs-string">OR&#x27;d</span> <span class="hljs-string">together.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">paths:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Paths is an optional field that restricts</span><br><span class="hljs-string">                            the rule to apply to HTTP requests that use one of the</span><br><span class="hljs-string">                            listed HTTP Paths. Multiple paths are OR<span class="hljs-char escape_">&#x27;&#x27;</span>d together.</span><br><span class="hljs-string">                            e.g: - exact: /foo - prefix: /bar NOTE: Each entry may</span><br><span class="hljs-string">                            ONLY specify either a `exact` or a `prefix` match. The</span><br><span class="hljs-string">                            validator will check for it.&#x27;</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;HTTPPath specifies an HTTP path to match.</span><br><span class="hljs-string">                              It may be either of the form: exact: &lt;path&gt;: which matches</span><br><span class="hljs-string">                              the path exactly or prefix: &lt;path-prefix&gt;: which matches</span><br><span class="hljs-string">                              the path prefix&#x27;</span><br>                            <span class="hljs-attr">properties:</span><br>                              <span class="hljs-attr">exact:</span><br>                                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                              <span class="hljs-attr">prefix:</span><br>                                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                    <span class="hljs-attr">icmp:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span> <span class="hljs-string">the</span> <span class="hljs-string">rule</span><br>                        <span class="hljs-string">to</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">type</span> <span class="hljs-string">and</span> <span class="hljs-string">code</span> <span class="hljs-string">of</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">traffic.</span>  <span class="hljs-string">This</span><br>                        <span class="hljs-string">should</span> <span class="hljs-string">only</span> <span class="hljs-string">be</span> <span class="hljs-string">specified</span> <span class="hljs-string">if</span> <span class="hljs-string">the</span> <span class="hljs-string">Protocol</span> <span class="hljs-string">field</span> <span class="hljs-string">is</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">&quot;ICMP&quot;</span><br>                        <span class="hljs-string">or</span> <span class="hljs-string">&quot;ICMPv6&quot;</span><span class="hljs-string">.</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">code:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Match</span> <span class="hljs-string">on</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">code.</span>  <span class="hljs-string">If</span> <span class="hljs-string">specified,</span><br>                            <span class="hljs-string">the</span> <span class="hljs-string">Type</span> <span class="hljs-string">value</span> <span class="hljs-string">must</span> <span class="hljs-string">also</span> <span class="hljs-string">be</span> <span class="hljs-string">specified.</span> <span class="hljs-string">This</span> <span class="hljs-string">is</span> <span class="hljs-string">a</span> <span class="hljs-string">technical</span><br>                            <span class="hljs-string">limitation</span> <span class="hljs-string">imposed</span> <span class="hljs-string">by</span> <span class="hljs-string">the</span> <span class="hljs-string">kernel&#x27;s</span> <span class="hljs-string">iptables</span> <span class="hljs-string">firewall,</span><br>                            <span class="hljs-string">which</span> <span class="hljs-string">Calico</span> <span class="hljs-string">uses</span> <span class="hljs-string">to</span> <span class="hljs-string">enforce</span> <span class="hljs-string">the</span> <span class="hljs-string">rule.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                        <span class="hljs-attr">type:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Match</span> <span class="hljs-string">on</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">type.</span>  <span class="hljs-string">For</span> <span class="hljs-string">example</span><br>                            <span class="hljs-string">a</span> <span class="hljs-string">value</span> <span class="hljs-string">of</span> <span class="hljs-number">8</span> <span class="hljs-string">refers</span> <span class="hljs-string">to</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">Echo</span> <span class="hljs-string">Request</span> <span class="hljs-string">(i.e.</span> <span class="hljs-string">pings).</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                    <span class="hljs-attr">ipVersion:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">IPVersion</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span> <span class="hljs-string">the</span><br>                        <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">match</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">IP</span> <span class="hljs-string">version.</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                    <span class="hljs-attr">metadata:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">Metadata</span> <span class="hljs-string">contains</span> <span class="hljs-string">additional</span> <span class="hljs-string">information</span> <span class="hljs-string">for</span> <span class="hljs-string">this</span><br>                        <span class="hljs-string">rule</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">annotations:</span><br>                          <span class="hljs-attr">additionalProperties:</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Annotations</span> <span class="hljs-string">is</span> <span class="hljs-string">a</span> <span class="hljs-string">set</span> <span class="hljs-string">of</span> <span class="hljs-string">key</span> <span class="hljs-string">value</span> <span class="hljs-string">pairs</span> <span class="hljs-string">that</span><br>                            <span class="hljs-string">give</span> <span class="hljs-string">extra</span> <span class="hljs-string">information</span> <span class="hljs-string">about</span> <span class="hljs-string">the</span> <span class="hljs-string">rule</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                    <span class="hljs-attr">notICMP:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">NotICMP</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">field.</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">code:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Match</span> <span class="hljs-string">on</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">code.</span>  <span class="hljs-string">If</span> <span class="hljs-string">specified,</span><br>                            <span class="hljs-string">the</span> <span class="hljs-string">Type</span> <span class="hljs-string">value</span> <span class="hljs-string">must</span> <span class="hljs-string">also</span> <span class="hljs-string">be</span> <span class="hljs-string">specified.</span> <span class="hljs-string">This</span> <span class="hljs-string">is</span> <span class="hljs-string">a</span> <span class="hljs-string">technical</span><br>                            <span class="hljs-string">limitation</span> <span class="hljs-string">imposed</span> <span class="hljs-string">by</span> <span class="hljs-string">the</span> <span class="hljs-string">kernel&#x27;s</span> <span class="hljs-string">iptables</span> <span class="hljs-string">firewall,</span><br>                            <span class="hljs-string">which</span> <span class="hljs-string">Calico</span> <span class="hljs-string">uses</span> <span class="hljs-string">to</span> <span class="hljs-string">enforce</span> <span class="hljs-string">the</span> <span class="hljs-string">rule.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                        <span class="hljs-attr">type:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Match</span> <span class="hljs-string">on</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">type.</span>  <span class="hljs-string">For</span> <span class="hljs-string">example</span><br>                            <span class="hljs-string">a</span> <span class="hljs-string">value</span> <span class="hljs-string">of</span> <span class="hljs-number">8</span> <span class="hljs-string">refers</span> <span class="hljs-string">to</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">Echo</span> <span class="hljs-string">Request</span> <span class="hljs-string">(i.e.</span> <span class="hljs-string">pings).</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                    <span class="hljs-attr">notProtocol:</span><br>                      <span class="hljs-attr">anyOf:</span><br>                      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">NotProtocol</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Protocol</span><br>                        <span class="hljs-string">field.</span><br>                      <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                      <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>                    <span class="hljs-attr">protocol:</span><br>                      <span class="hljs-attr">anyOf:</span><br>                      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Protocol is an optional field that restricts the</span><br><span class="hljs-string">                        rule to only apply to traffic of a specific IP protocol. Required</span><br><span class="hljs-string">                        if any of the EntityRules contain Ports (because ports only</span><br><span class="hljs-string">                        apply to certain protocols). \n Must be one of these string</span><br><span class="hljs-string">                        values: \&quot;TCP\&quot;, \&quot;UDP\&quot;, \&quot;ICMP\&quot;, \&quot;ICMPv6\&quot;, \&quot;SCTP\&quot;,</span><br><span class="hljs-string">                        \&quot;UDPLite\&quot; or an integer in the range 1-255.&quot;</span><br>                      <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                      <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>                    <span class="hljs-attr">source:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">Source</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">match</span> <span class="hljs-string">criteria</span> <span class="hljs-string">that</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span><br>                        <span class="hljs-string">source</span> <span class="hljs-string">entity.</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">namespaceSelector:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;NamespaceSelector is an optional field that</span><br><span class="hljs-string">                            contains a selector expression. Only traffic that originates</span><br><span class="hljs-string">                            from (or terminates at) endpoints within the selected</span><br><span class="hljs-string">                            namespaces will be matched. When both NamespaceSelector</span><br><span class="hljs-string">                            and another selector are defined on the same rule, then</span><br><span class="hljs-string">                            only workload endpoints that are matched by both selectors</span><br><span class="hljs-string">                            will be selected by the rule. \n For NetworkPolicy, an</span><br><span class="hljs-string">                            empty NamespaceSelector implies that the Selector is limited</span><br><span class="hljs-string">                            to selecting only workload endpoints in the same namespace</span><br><span class="hljs-string">                            as the NetworkPolicy. \n For NetworkPolicy, `global()`</span><br><span class="hljs-string">                            NamespaceSelector implies that the Selector is limited</span><br><span class="hljs-string">                            to selecting only GlobalNetworkSet or HostEndpoint. \n</span><br><span class="hljs-string">                            For GlobalNetworkPolicy, an empty NamespaceSelector implies</span><br><span class="hljs-string">                            the Selector applies to workload endpoints across all</span><br><span class="hljs-string">                            namespaces.&quot;</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">nets:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Nets</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span> <span class="hljs-string">the</span><br>                            <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span> <span class="hljs-string">from</span> <span class="hljs-string">(or</span><br>                            <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">IP</span> <span class="hljs-string">addresses</span> <span class="hljs-string">in</span> <span class="hljs-string">any</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">given</span> <span class="hljs-string">subnets.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">notNets:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">NotNets</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Nets</span><br>                            <span class="hljs-string">field.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">notPorts:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">NotPorts</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Ports</span><br>                            <span class="hljs-string">field.</span> <span class="hljs-string">Since</span> <span class="hljs-string">only</span> <span class="hljs-string">some</span> <span class="hljs-string">protocols</span> <span class="hljs-string">have</span> <span class="hljs-string">ports,</span> <span class="hljs-string">if</span> <span class="hljs-string">any</span> <span class="hljs-string">ports</span><br>                            <span class="hljs-string">are</span> <span class="hljs-string">specified</span> <span class="hljs-string">it</span> <span class="hljs-string">requires</span> <span class="hljs-string">the</span> <span class="hljs-string">Protocol</span> <span class="hljs-string">match</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">Rule</span><br>                            <span class="hljs-string">to</span> <span class="hljs-string">be</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">&quot;TCP&quot;</span> <span class="hljs-string">or</span> <span class="hljs-string">&quot;UDP&quot;</span><span class="hljs-string">.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">anyOf:</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                            <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">notSelector:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">NotSelector</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Selector</span><br>                            <span class="hljs-string">field.</span>  <span class="hljs-string">See</span> <span class="hljs-string">Selector</span> <span class="hljs-string">field</span> <span class="hljs-string">for</span> <span class="hljs-string">subtleties</span> <span class="hljs-string">with</span> <span class="hljs-string">negated</span><br>                            <span class="hljs-string">selectors.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">ports:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Ports is an optional field that restricts</span><br><span class="hljs-string">                            the rule to only apply to traffic that has a source (destination)</span><br><span class="hljs-string">                            port that matches one of these ranges/values. This value</span><br><span class="hljs-string">                            is a list of integers or strings that represent ranges</span><br><span class="hljs-string">                            of ports. \n Since only some protocols have ports, if</span><br><span class="hljs-string">                            any ports are specified it requires the Protocol match</span><br><span class="hljs-string">                            in the Rule to be set to \&quot;TCP\&quot; or \&quot;UDP\&quot;.&quot;</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">anyOf:</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                            <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">selector:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Selector is an optional field that contains</span><br><span class="hljs-string">                            a selector expression (see Policy for sample syntax).</span><br><span class="hljs-string">                            \ Only traffic that originates from (terminates at) endpoints</span><br><span class="hljs-string">                            matching the selector will be matched. \n Note that: in</span><br><span class="hljs-string">                            addition to the negated version of the Selector (see NotSelector</span><br><span class="hljs-string">                            below), the selector expression syntax itself supports</span><br><span class="hljs-string">                            negation.  The two types of negation are subtly different.</span><br><span class="hljs-string">                            One negates the set of matched endpoints, the other negates</span><br><span class="hljs-string">                            the whole match: \n \tSelector = \&quot;!has(my_label)\&quot; matches</span><br><span class="hljs-string">                            packets that are from other Calico-controlled \tendpoints</span><br><span class="hljs-string">                            that do not have the label \&quot;my_label\&quot;. \n \tNotSelector</span><br><span class="hljs-string">                            = \&quot;has(my_label)\&quot; matches packets that are not from</span><br><span class="hljs-string">                            Calico-controlled \tendpoints that do have the label \&quot;my_label\&quot;.</span><br><span class="hljs-string">                            \n The effect is that the latter will accept packets from</span><br><span class="hljs-string">                            non-Calico sources whereas the former is limited to packets</span><br><span class="hljs-string">                            from Calico-controlled endpoints.&quot;</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">serviceAccounts:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">ServiceAccounts</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                            <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span> <span class="hljs-string">from</span><br>                            <span class="hljs-string">(or</span> <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">running</span> <span class="hljs-string">as</span> <span class="hljs-string">a</span> <span class="hljs-string">matching</span> <span class="hljs-string">service</span><br>                            <span class="hljs-string">account.</span><br>                          <span class="hljs-attr">properties:</span><br>                            <span class="hljs-attr">names:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Names</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                                <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span><br>                                <span class="hljs-string">from</span> <span class="hljs-string">(or</span> <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">running</span> <span class="hljs-string">as</span> <span class="hljs-string">a</span> <span class="hljs-string">service</span><br>                                <span class="hljs-string">account</span> <span class="hljs-string">whose</span> <span class="hljs-string">name</span> <span class="hljs-string">is</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">list.</span><br>                              <span class="hljs-attr">items:</span><br>                                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                            <span class="hljs-attr">selector:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Selector</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                                <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span><br>                                <span class="hljs-string">from</span> <span class="hljs-string">(or</span> <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">running</span> <span class="hljs-string">as</span> <span class="hljs-string">a</span> <span class="hljs-string">service</span><br>                                <span class="hljs-string">account</span> <span class="hljs-string">that</span> <span class="hljs-string">matches</span> <span class="hljs-string">the</span> <span class="hljs-string">given</span> <span class="hljs-string">label</span> <span class="hljs-string">selector.</span> <span class="hljs-string">If</span><br>                                <span class="hljs-string">both</span> <span class="hljs-string">Names</span> <span class="hljs-string">and</span> <span class="hljs-string">Selector</span> <span class="hljs-string">are</span> <span class="hljs-string">specified</span> <span class="hljs-string">then</span> <span class="hljs-string">they</span> <span class="hljs-string">are</span><br>                                <span class="hljs-string">AND&#x27;ed.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                        <span class="hljs-attr">services:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Services is an optional field that contains</span><br><span class="hljs-string">                            options for matching Kubernetes Services. If specified,</span><br><span class="hljs-string">                            only traffic that originates from or terminates at endpoints</span><br><span class="hljs-string">                            within the selected service(s) will be matched, and only</span><br><span class="hljs-string">                            to/from each endpoint&#x27;s port. \n Services cannot be specified</span><br><span class="hljs-string">                            on the same rule as Selector, NotSelector, NamespaceSelector,</span><br><span class="hljs-string">                            Nets, NotNets or ServiceAccounts. \n Ports and NotPorts</span><br><span class="hljs-string">                            can only be specified with Services on ingress rules.&quot;</span><br>                          <span class="hljs-attr">properties:</span><br>                            <span class="hljs-attr">name:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Name</span> <span class="hljs-string">specifies</span> <span class="hljs-string">the</span> <span class="hljs-string">name</span> <span class="hljs-string">of</span> <span class="hljs-string">a</span> <span class="hljs-string">Kubernetes</span><br>                                <span class="hljs-string">Service</span> <span class="hljs-string">to</span> <span class="hljs-string">match.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">namespace:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Namespace</span> <span class="hljs-string">specifies</span> <span class="hljs-string">the</span> <span class="hljs-string">namespace</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span><br>                                <span class="hljs-string">given</span> <span class="hljs-string">Service.</span> <span class="hljs-string">If</span> <span class="hljs-string">left</span> <span class="hljs-string">empty,</span> <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">will</span> <span class="hljs-string">match</span><br>                                <span class="hljs-string">within</span> <span class="hljs-string">this</span> <span class="hljs-string">policy&#x27;s</span> <span class="hljs-string">namespace.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                  <span class="hljs-attr">required:</span><br>                  <span class="hljs-bullet">-</span> <span class="hljs-string">action</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>              <span class="hljs-attr">namespaceSelector:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">NamespaceSelector</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">for</span> <span class="hljs-string">an</span> <span class="hljs-string">expression</span><br>                  <span class="hljs-string">used</span> <span class="hljs-string">to</span> <span class="hljs-string">select</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">based</span> <span class="hljs-string">on</span> <span class="hljs-string">namespaces.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">order:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Order</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">specifies</span> <span class="hljs-string">the</span> <span class="hljs-string">order</span> <span class="hljs-string">in</span><br>                  <span class="hljs-string">which</span> <span class="hljs-string">the</span> <span class="hljs-string">policy</span> <span class="hljs-string">is</span> <span class="hljs-string">applied.</span> <span class="hljs-string">Policies</span> <span class="hljs-string">with</span> <span class="hljs-string">higher</span> <span class="hljs-string">&quot;order&quot;</span> <span class="hljs-string">are</span> <span class="hljs-string">applied</span><br>                  <span class="hljs-string">after</span> <span class="hljs-string">those</span> <span class="hljs-string">with</span> <span class="hljs-string">lower</span> <span class="hljs-string">order.</span>  <span class="hljs-string">If</span> <span class="hljs-string">the</span> <span class="hljs-string">order</span> <span class="hljs-string">is</span> <span class="hljs-string">omitted,</span> <span class="hljs-string">it</span> <span class="hljs-string">may</span> <span class="hljs-string">be</span><br>                  <span class="hljs-string">considered</span> <span class="hljs-string">to</span> <span class="hljs-string">be</span> <span class="hljs-string">&quot;infinite&quot;</span> <span class="hljs-bullet">-</span> <span class="hljs-string">i.e.</span> <span class="hljs-string">the</span> <span class="hljs-string">policy</span> <span class="hljs-string">will</span> <span class="hljs-string">be</span> <span class="hljs-string">applied</span> <span class="hljs-string">last.</span>  <span class="hljs-string">Policies</span><br>                  <span class="hljs-string">with</span> <span class="hljs-string">identical</span> <span class="hljs-string">order</span> <span class="hljs-string">will</span> <span class="hljs-string">be</span> <span class="hljs-string">applied</span> <span class="hljs-string">in</span> <span class="hljs-string">alphanumerical</span> <span class="hljs-string">order</span> <span class="hljs-string">based</span><br>                  <span class="hljs-string">on</span> <span class="hljs-string">the</span> <span class="hljs-string">Policy</span> <span class="hljs-string">&quot;Name&quot;</span><span class="hljs-string">.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">number</span><br>              <span class="hljs-attr">preDNAT:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">PreDNAT</span> <span class="hljs-string">indicates</span> <span class="hljs-string">to</span> <span class="hljs-string">apply</span> <span class="hljs-string">the</span> <span class="hljs-string">rules</span> <span class="hljs-string">in</span> <span class="hljs-string">this</span> <span class="hljs-string">policy</span> <span class="hljs-string">before</span><br>                  <span class="hljs-string">any</span> <span class="hljs-string">DNAT.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">selector:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;The selector is an expression used to pick pick out</span><br><span class="hljs-string">                  the endpoints that the policy should be applied to. \n Selector</span><br><span class="hljs-string">                  expressions follow this syntax: \n \tlabel == \&quot;string_literal\&quot;</span><br><span class="hljs-string">                  \ -&gt;  comparison, e.g. my_label == \&quot;foo bar\&quot; \tlabel != \&quot;string_literal\&quot;</span><br><span class="hljs-string">                  \  -&gt;  not equal; also matches if label is not present \tlabel in</span><br><span class="hljs-string">                  &#123; \&quot;a\&quot;, \&quot;b\&quot;, \&quot;c\&quot;, ... &#125;  -&gt;  true if the value of label X is</span><br><span class="hljs-string">                  one of \&quot;a\&quot;, \&quot;b\&quot;, \&quot;c\&quot; \tlabel not in &#123; \&quot;a\&quot;, \&quot;b\&quot;, \&quot;c\&quot;,</span><br><span class="hljs-string">                  ... &#125;  -&gt;  true if the value of label X is not one of \&quot;a\&quot;, \&quot;b\&quot;,</span><br><span class="hljs-string">                  \&quot;c\&quot; \thas(label_name)  -&gt; True if that label is present \t! expr</span><br><span class="hljs-string">                  -&gt; negation of expr \texpr &amp;&amp; expr  -&gt; Short-circuit and \texpr</span><br><span class="hljs-string">                  || expr  -&gt; Short-circuit or \t( expr ) -&gt; parens for grouping \tall()</span><br><span class="hljs-string">                  or the empty selector -&gt; matches all endpoints. \n Label names are</span><br><span class="hljs-string">                  allowed to contain alphanumerics, -, _ and /. String literals are</span><br><span class="hljs-string">                  more permissive but they do not support escape characters. \n Examples</span><br><span class="hljs-string">                  (with made-up labels): \n \ttype == \&quot;webserver\&quot; &amp;&amp; deployment</span><br><span class="hljs-string">                  == \&quot;prod\&quot; \ttype in &#123;\&quot;frontend\&quot;, \&quot;backend\&quot;&#125; \tdeployment !=</span><br><span class="hljs-string">                  \&quot;dev\&quot; \t! has(label_name)&quot;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">serviceAccountSelector:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">ServiceAccountSelector</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">for</span> <span class="hljs-string">an</span> <span class="hljs-string">expression</span><br>                  <span class="hljs-string">used</span> <span class="hljs-string">to</span> <span class="hljs-string">select</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">based</span> <span class="hljs-string">on</span> <span class="hljs-string">service</span> <span class="hljs-string">accounts.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">types:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Types indicates whether this policy applies to ingress,</span><br><span class="hljs-string">                  or to egress, or to both.  When not explicitly specified (and so</span><br><span class="hljs-string">                  the value on creation is empty or nil), Calico defaults Types according</span><br><span class="hljs-string">                  to what Ingress and Egress rules are present in the policy.  The</span><br><span class="hljs-string">                  default is: \n - [ PolicyTypeIngress ], if there are no Egress rules</span><br><span class="hljs-string">                  (including the case where there are   also no Ingress rules) \n</span><br><span class="hljs-string">                  - [ PolicyTypeEgress ], if there are Egress rules but no Ingress</span><br><span class="hljs-string">                  rules \n - [ PolicyTypeIngress, PolicyTypeEgress ], if there are</span><br><span class="hljs-string">                  both Ingress and Egress rules. \n When the policy is read back again,</span><br><span class="hljs-string">                  Types will always be one of these values, never empty or nil.&quot;</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">description:</span> <span class="hljs-string">PolicyType</span> <span class="hljs-string">enumerates</span> <span class="hljs-string">the</span> <span class="hljs-string">possible</span> <span class="hljs-string">values</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">PolicySpec</span><br>                    <span class="hljs-string">Types</span> <span class="hljs-string">field.</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>    <span class="hljs-attr">served:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">storage:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">status:</span><br>  <span class="hljs-attr">acceptedNames:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">conditions:</span> []<br>  <span class="hljs-attr">storedVersions:</span> []<br><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/kdd-crds.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apiextensions.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">CustomResourceDefinition</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">globalnetworksets.crd.projectcalico.org</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">group:</span> <span class="hljs-string">crd.projectcalico.org</span><br>  <span class="hljs-attr">names:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">GlobalNetworkSet</span><br>    <span class="hljs-attr">listKind:</span> <span class="hljs-string">GlobalNetworkSetList</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">globalnetworksets</span><br>    <span class="hljs-attr">singular:</span> <span class="hljs-string">globalnetworkset</span><br>  <span class="hljs-attr">preserveUnknownFields:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">scope:</span> <span class="hljs-string">Cluster</span><br>  <span class="hljs-attr">versions:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">v1</span><br>    <span class="hljs-attr">schema:</span><br>      <span class="hljs-attr">openAPIV3Schema:</span><br>        <span class="hljs-attr">description:</span> <span class="hljs-string">GlobalNetworkSet</span> <span class="hljs-string">contains</span> <span class="hljs-string">a</span> <span class="hljs-string">set</span> <span class="hljs-string">of</span> <span class="hljs-string">arbitrary</span> <span class="hljs-string">IP</span> <span class="hljs-string">sub-networks/CIDRs</span><br>          <span class="hljs-string">that</span> <span class="hljs-string">share</span> <span class="hljs-string">labels</span> <span class="hljs-string">to</span> <span class="hljs-string">allow</span> <span class="hljs-string">rules</span> <span class="hljs-string">to</span> <span class="hljs-string">refer</span> <span class="hljs-string">to</span> <span class="hljs-string">them</span> <span class="hljs-string">via</span> <span class="hljs-string">selectors.</span>  <span class="hljs-string">The</span> <span class="hljs-string">labels</span><br>          <span class="hljs-string">of</span> <span class="hljs-string">GlobalNetworkSet</span> <span class="hljs-string">are</span> <span class="hljs-string">not</span> <span class="hljs-string">namespaced.</span><br>        <span class="hljs-attr">properties:</span><br>          <span class="hljs-attr">apiVersion:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;APIVersion defines the versioned schema of this representation</span><br><span class="hljs-string">              of an object. Servers should convert recognized schemas to the latest</span><br><span class="hljs-string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">kind:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Kind is a string value representing the REST resource this</span><br><span class="hljs-string">              object represents. Servers may infer this from the endpoint the client</span><br><span class="hljs-string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">metadata:</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>          <span class="hljs-attr">spec:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">GlobalNetworkSetSpec</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">specification</span> <span class="hljs-string">for</span> <span class="hljs-string">a</span> <span class="hljs-string">NetworkSet</span><br>              <span class="hljs-string">resource.</span><br>            <span class="hljs-attr">properties:</span><br>              <span class="hljs-attr">nets:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">The</span> <span class="hljs-string">list</span> <span class="hljs-string">of</span> <span class="hljs-string">IP</span> <span class="hljs-string">networks</span> <span class="hljs-string">that</span> <span class="hljs-string">belong</span> <span class="hljs-string">to</span> <span class="hljs-string">this</span> <span class="hljs-string">set.</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>    <span class="hljs-attr">served:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">storage:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">status:</span><br>  <span class="hljs-attr">acceptedNames:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">conditions:</span> []<br>  <span class="hljs-attr">storedVersions:</span> []<br><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/kdd-crds.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apiextensions.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">CustomResourceDefinition</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">hostendpoints.crd.projectcalico.org</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">group:</span> <span class="hljs-string">crd.projectcalico.org</span><br>  <span class="hljs-attr">names:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">HostEndpoint</span><br>    <span class="hljs-attr">listKind:</span> <span class="hljs-string">HostEndpointList</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">hostendpoints</span><br>    <span class="hljs-attr">singular:</span> <span class="hljs-string">hostendpoint</span><br>  <span class="hljs-attr">preserveUnknownFields:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">scope:</span> <span class="hljs-string">Cluster</span><br>  <span class="hljs-attr">versions:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">v1</span><br>    <span class="hljs-attr">schema:</span><br>      <span class="hljs-attr">openAPIV3Schema:</span><br>        <span class="hljs-attr">properties:</span><br>          <span class="hljs-attr">apiVersion:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;APIVersion defines the versioned schema of this representation</span><br><span class="hljs-string">              of an object. Servers should convert recognized schemas to the latest</span><br><span class="hljs-string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">kind:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Kind is a string value representing the REST resource this</span><br><span class="hljs-string">              object represents. Servers may infer this from the endpoint the client</span><br><span class="hljs-string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">metadata:</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>          <span class="hljs-attr">spec:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">HostEndpointSpec</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">specification</span> <span class="hljs-string">for</span> <span class="hljs-string">a</span> <span class="hljs-string">HostEndpoint</span><br>              <span class="hljs-string">resource.</span><br>            <span class="hljs-attr">properties:</span><br>              <span class="hljs-attr">expectedIPs:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;The expected IP addresses (IPv4 and IPv6) of the endpoint.</span><br><span class="hljs-string">                  If \&quot;InterfaceName\&quot; is not present, Calico will look for an interface</span><br><span class="hljs-string">                  matching any of the IPs in the list and apply policy to that. Note:</span><br><span class="hljs-string">                  \tWhen using the selector match criteria in an ingress or egress</span><br><span class="hljs-string">                  security Policy \tor Profile, Calico converts the selector into</span><br><span class="hljs-string">                  a set of IP addresses. For host \tendpoints, the ExpectedIPs field</span><br><span class="hljs-string">                  is used for that purpose. (If only the interface \tname is specified,</span><br><span class="hljs-string">                  Calico does not learn the IPs of the interface for use in match</span><br><span class="hljs-string">                  \tcriteria.)&quot;</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>              <span class="hljs-attr">interfaceName:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Either \&quot;*\&quot;, or the name of a specific Linux interface</span><br><span class="hljs-string">                  to apply policy to; or empty.  \&quot;*\&quot; indicates that this HostEndpoint</span><br><span class="hljs-string">                  governs all traffic to, from or through the default network namespace</span><br><span class="hljs-string">                  of the host named by the \&quot;Node\&quot; field; entering and leaving that</span><br><span class="hljs-string">                  namespace via any interface, including those from/to non-host-networked</span><br><span class="hljs-string">                  local workloads. \n If InterfaceName is not \&quot;*\&quot;, this HostEndpoint</span><br><span class="hljs-string">                  only governs traffic that enters or leaves the host through the</span><br><span class="hljs-string">                  specific interface named by InterfaceName, or - when InterfaceName</span><br><span class="hljs-string">                  is empty - through the specific interface that has one of the IPs</span><br><span class="hljs-string">                  in ExpectedIPs. Therefore, when InterfaceName is empty, at least</span><br><span class="hljs-string">                  one expected IP must be specified.  Only external interfaces (such</span><br><span class="hljs-string">                  as \&quot;eth0\&quot;) are supported here; it isn&#x27;t possible for a HostEndpoint</span><br><span class="hljs-string">                  to protect traffic through a specific local workload interface.</span><br><span class="hljs-string">                  \n Note: Only some kinds of policy are implemented for \&quot;*\&quot; HostEndpoints;</span><br><span class="hljs-string">                  initially just pre-DNAT policy.  Please check Calico documentation</span><br><span class="hljs-string">                  for the latest position.&quot;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">node:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">The</span> <span class="hljs-string">node</span> <span class="hljs-string">name</span> <span class="hljs-string">identifying</span> <span class="hljs-string">the</span> <span class="hljs-string">Calico</span> <span class="hljs-string">node</span> <span class="hljs-string">instance.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">ports:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Ports</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">endpoint&#x27;s</span> <span class="hljs-string">named</span> <span class="hljs-string">ports,</span> <span class="hljs-string">which</span> <span class="hljs-string">may</span><br>                  <span class="hljs-string">be</span> <span class="hljs-string">referenced</span> <span class="hljs-string">in</span> <span class="hljs-string">security</span> <span class="hljs-string">policy</span> <span class="hljs-string">rules.</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">properties:</span><br>                    <span class="hljs-attr">name:</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                    <span class="hljs-attr">port:</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                    <span class="hljs-attr">protocol:</span><br>                      <span class="hljs-attr">anyOf:</span><br>                      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                      <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>                  <span class="hljs-attr">required:</span><br>                  <span class="hljs-bullet">-</span> <span class="hljs-string">name</span><br>                  <span class="hljs-bullet">-</span> <span class="hljs-string">port</span><br>                  <span class="hljs-bullet">-</span> <span class="hljs-string">protocol</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>              <span class="hljs-attr">profiles:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">A</span> <span class="hljs-string">list</span> <span class="hljs-string">of</span> <span class="hljs-string">identifiers</span> <span class="hljs-string">of</span> <span class="hljs-string">security</span> <span class="hljs-string">Profile</span> <span class="hljs-string">objects</span> <span class="hljs-string">that</span><br>                  <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">this</span> <span class="hljs-string">endpoint.</span> <span class="hljs-string">Each</span> <span class="hljs-string">profile</span> <span class="hljs-string">is</span> <span class="hljs-string">applied</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">order</span> <span class="hljs-string">that</span><br>                  <span class="hljs-string">they</span> <span class="hljs-string">appear</span> <span class="hljs-string">in</span> <span class="hljs-string">this</span> <span class="hljs-string">list.</span>  <span class="hljs-string">Profile</span> <span class="hljs-string">rules</span> <span class="hljs-string">are</span> <span class="hljs-string">applied</span> <span class="hljs-string">after</span> <span class="hljs-string">the</span> <span class="hljs-string">selector-based</span><br>                  <span class="hljs-string">security</span> <span class="hljs-string">policy.</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>    <span class="hljs-attr">served:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">storage:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">status:</span><br>  <span class="hljs-attr">acceptedNames:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">conditions:</span> []<br>  <span class="hljs-attr">storedVersions:</span> []<br><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/kdd-crds.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apiextensions.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">CustomResourceDefinition</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">ipamblocks.crd.projectcalico.org</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">group:</span> <span class="hljs-string">crd.projectcalico.org</span><br>  <span class="hljs-attr">names:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">IPAMBlock</span><br>    <span class="hljs-attr">listKind:</span> <span class="hljs-string">IPAMBlockList</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">ipamblocks</span><br>    <span class="hljs-attr">singular:</span> <span class="hljs-string">ipamblock</span><br>  <span class="hljs-attr">preserveUnknownFields:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">scope:</span> <span class="hljs-string">Cluster</span><br>  <span class="hljs-attr">versions:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">v1</span><br>    <span class="hljs-attr">schema:</span><br>      <span class="hljs-attr">openAPIV3Schema:</span><br>        <span class="hljs-attr">properties:</span><br>          <span class="hljs-attr">apiVersion:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;APIVersion defines the versioned schema of this representation</span><br><span class="hljs-string">              of an object. Servers should convert recognized schemas to the latest</span><br><span class="hljs-string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">kind:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Kind is a string value representing the REST resource this</span><br><span class="hljs-string">              object represents. Servers may infer this from the endpoint the client</span><br><span class="hljs-string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">metadata:</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>          <span class="hljs-attr">spec:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">IPAMBlockSpec</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">specification</span> <span class="hljs-string">for</span> <span class="hljs-string">an</span> <span class="hljs-string">IPAMBlock</span><br>              <span class="hljs-string">resource.</span><br>            <span class="hljs-attr">properties:</span><br>              <span class="hljs-attr">affinity:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Affinity</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">block,</span> <span class="hljs-string">if</span> <span class="hljs-string">this</span> <span class="hljs-string">block</span> <span class="hljs-string">has</span> <span class="hljs-string">one.</span> <span class="hljs-string">If</span> <span class="hljs-string">set,</span><br>                  <span class="hljs-string">it</span> <span class="hljs-string">will</span> <span class="hljs-string">be</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">form</span> <span class="hljs-string">&quot;host:&lt;hostname&gt;&quot;</span><span class="hljs-string">.</span> <span class="hljs-string">If</span> <span class="hljs-string">not</span> <span class="hljs-string">set,</span> <span class="hljs-string">this</span> <span class="hljs-string">block</span><br>                  <span class="hljs-string">is</span> <span class="hljs-string">not</span> <span class="hljs-string">affine</span> <span class="hljs-string">to</span> <span class="hljs-string">a</span> <span class="hljs-string">host.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">allocations:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Array</span> <span class="hljs-string">of</span> <span class="hljs-string">allocations</span> <span class="hljs-string">in-use</span> <span class="hljs-string">within</span> <span class="hljs-string">this</span> <span class="hljs-string">block.</span> <span class="hljs-string">nil</span> <span class="hljs-string">entries</span><br>                  <span class="hljs-string">mean</span> <span class="hljs-string">the</span> <span class="hljs-string">allocation</span> <span class="hljs-string">is</span> <span class="hljs-string">free.</span> <span class="hljs-string">For</span> <span class="hljs-string">non-nil</span> <span class="hljs-string">entries</span> <span class="hljs-string">at</span> <span class="hljs-string">index</span> <span class="hljs-string">i,</span> <span class="hljs-string">the</span><br>                  <span class="hljs-string">index</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">ordinal</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">allocation</span> <span class="hljs-string">within</span> <span class="hljs-string">this</span> <span class="hljs-string">block</span> <span class="hljs-string">and</span> <span class="hljs-string">the</span><br>                  <span class="hljs-string">value</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">index</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">associated</span> <span class="hljs-string">attributes</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">Attributes</span><br>                  <span class="hljs-string">array.</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                  <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> This nullable is manually added in. We should update controller-gen</span><br>                  <span class="hljs-comment"># to handle []*int properly itself.</span><br>                  <span class="hljs-attr">nullable:</span> <span class="hljs-literal">true</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>              <span class="hljs-attr">attributes:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Attributes</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">array</span> <span class="hljs-string">of</span> <span class="hljs-string">arbitrary</span> <span class="hljs-string">metadata</span> <span class="hljs-string">associated</span><br>                  <span class="hljs-string">with</span> <span class="hljs-string">allocations</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">block.</span> <span class="hljs-string">To</span> <span class="hljs-string">find</span> <span class="hljs-string">attributes</span> <span class="hljs-string">for</span> <span class="hljs-string">a</span> <span class="hljs-string">given</span> <span class="hljs-string">allocation,</span><br>                  <span class="hljs-string">use</span> <span class="hljs-string">the</span> <span class="hljs-string">value</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">allocation&#x27;s</span> <span class="hljs-string">entry</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">Allocations</span> <span class="hljs-string">array</span><br>                  <span class="hljs-string">as</span> <span class="hljs-string">the</span> <span class="hljs-string">index</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">element</span> <span class="hljs-string">in</span> <span class="hljs-string">this</span> <span class="hljs-string">array.</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">properties:</span><br>                    <span class="hljs-attr">handle_id:</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                    <span class="hljs-attr">secondary:</span><br>                      <span class="hljs-attr">additionalProperties:</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>              <span class="hljs-attr">cidr:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">The</span> <span class="hljs-string">block&#x27;s</span> <span class="hljs-string">CIDR.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">deleted:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Deleted</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">internal</span> <span class="hljs-string">boolean</span> <span class="hljs-string">used</span> <span class="hljs-string">to</span> <span class="hljs-string">workaround</span> <span class="hljs-string">a</span> <span class="hljs-string">limitation</span><br>                  <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">Kubernetes</span> <span class="hljs-string">API</span> <span class="hljs-string">whereby</span> <span class="hljs-string">deletion</span> <span class="hljs-string">will</span> <span class="hljs-string">not</span> <span class="hljs-string">return</span> <span class="hljs-string">a</span> <span class="hljs-string">conflict</span><br>                  <span class="hljs-string">error</span> <span class="hljs-string">if</span> <span class="hljs-string">the</span> <span class="hljs-string">block</span> <span class="hljs-string">has</span> <span class="hljs-string">been</span> <span class="hljs-string">updated.</span> <span class="hljs-string">It</span> <span class="hljs-string">should</span> <span class="hljs-string">not</span> <span class="hljs-string">be</span> <span class="hljs-string">set</span> <span class="hljs-string">manually.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">sequenceNumber:</span><br>                <span class="hljs-attr">default:</span> <span class="hljs-number">0</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">We</span> <span class="hljs-string">store</span> <span class="hljs-string">a</span> <span class="hljs-string">sequence</span> <span class="hljs-string">number</span> <span class="hljs-string">that</span> <span class="hljs-string">is</span> <span class="hljs-string">updated</span> <span class="hljs-string">each</span> <span class="hljs-string">time</span><br>                  <span class="hljs-string">the</span> <span class="hljs-string">block</span> <span class="hljs-string">is</span> <span class="hljs-string">written.</span> <span class="hljs-string">Each</span> <span class="hljs-string">allocation</span> <span class="hljs-string">will</span> <span class="hljs-string">also</span> <span class="hljs-string">store</span> <span class="hljs-string">the</span> <span class="hljs-string">sequence</span><br>                  <span class="hljs-string">number</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">block</span> <span class="hljs-string">at</span> <span class="hljs-string">the</span> <span class="hljs-string">time</span> <span class="hljs-string">of</span> <span class="hljs-string">its</span> <span class="hljs-string">creation.</span> <span class="hljs-string">When</span> <span class="hljs-string">releasing</span><br>                  <span class="hljs-string">an</span> <span class="hljs-string">IP,</span> <span class="hljs-string">passing</span> <span class="hljs-string">the</span> <span class="hljs-string">sequence</span> <span class="hljs-string">number</span> <span class="hljs-string">associated</span> <span class="hljs-string">with</span> <span class="hljs-string">the</span> <span class="hljs-string">allocation</span><br>                  <span class="hljs-string">allows</span> <span class="hljs-string">us</span> <span class="hljs-string">to</span> <span class="hljs-string">protect</span> <span class="hljs-string">against</span> <span class="hljs-string">a</span> <span class="hljs-string">race</span> <span class="hljs-string">condition</span> <span class="hljs-string">and</span> <span class="hljs-string">ensure</span> <span class="hljs-string">the</span> <span class="hljs-string">IP</span><br>                  <span class="hljs-string">hasn&#x27;t</span> <span class="hljs-string">been</span> <span class="hljs-string">released</span> <span class="hljs-string">and</span> <span class="hljs-string">re-allocated</span> <span class="hljs-string">since</span> <span class="hljs-string">the</span> <span class="hljs-string">release</span> <span class="hljs-string">request.</span><br>                <span class="hljs-attr">format:</span> <span class="hljs-string">int64</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">sequenceNumberForAllocation:</span><br>                <span class="hljs-attr">additionalProperties:</span><br>                  <span class="hljs-attr">format:</span> <span class="hljs-string">int64</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Map</span> <span class="hljs-string">of</span> <span class="hljs-string">allocated</span> <span class="hljs-string">ordinal</span> <span class="hljs-string">within</span> <span class="hljs-string">the</span> <span class="hljs-string">block</span> <span class="hljs-string">to</span> <span class="hljs-string">sequence</span><br>                  <span class="hljs-string">number</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">block</span> <span class="hljs-string">at</span> <span class="hljs-string">the</span> <span class="hljs-string">time</span> <span class="hljs-string">of</span> <span class="hljs-string">allocation.</span> <span class="hljs-string">Kubernetes</span> <span class="hljs-string">does</span> <span class="hljs-string">not</span><br>                  <span class="hljs-string">allow</span> <span class="hljs-string">numerical</span> <span class="hljs-string">keys</span> <span class="hljs-string">for</span> <span class="hljs-string">maps,</span> <span class="hljs-string">so</span> <span class="hljs-string">the</span> <span class="hljs-string">key</span> <span class="hljs-string">is</span> <span class="hljs-string">cast</span> <span class="hljs-string">to</span> <span class="hljs-string">a</span> <span class="hljs-string">string.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>              <span class="hljs-attr">strictAffinity:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">StrictAffinity</span> <span class="hljs-string">on</span> <span class="hljs-string">the</span> <span class="hljs-string">IPAMBlock</span> <span class="hljs-string">is</span> <span class="hljs-string">deprecated</span> <span class="hljs-string">and</span> <span class="hljs-literal">no</span><br>                  <span class="hljs-string">longer</span> <span class="hljs-string">used</span> <span class="hljs-string">by</span> <span class="hljs-string">the</span> <span class="hljs-string">code.</span> <span class="hljs-string">Use</span> <span class="hljs-string">IPAMConfig</span> <span class="hljs-string">StrictAffinity</span> <span class="hljs-string">instead.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">unallocated:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Unallocated</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">ordered</span> <span class="hljs-string">list</span> <span class="hljs-string">of</span> <span class="hljs-string">allocations</span> <span class="hljs-string">which</span> <span class="hljs-string">are</span><br>                  <span class="hljs-string">free</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">block.</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>            <span class="hljs-attr">required:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">allocations</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">attributes</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">cidr</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">strictAffinity</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">unallocated</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>    <span class="hljs-attr">served:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">storage:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">status:</span><br>  <span class="hljs-attr">acceptedNames:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">conditions:</span> []<br>  <span class="hljs-attr">storedVersions:</span> []<br><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/kdd-crds.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apiextensions.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">CustomResourceDefinition</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">ipamconfigs.crd.projectcalico.org</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">group:</span> <span class="hljs-string">crd.projectcalico.org</span><br>  <span class="hljs-attr">names:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">IPAMConfig</span><br>    <span class="hljs-attr">listKind:</span> <span class="hljs-string">IPAMConfigList</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">ipamconfigs</span><br>    <span class="hljs-attr">singular:</span> <span class="hljs-string">ipamconfig</span><br>  <span class="hljs-attr">preserveUnknownFields:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">scope:</span> <span class="hljs-string">Cluster</span><br>  <span class="hljs-attr">versions:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">v1</span><br>    <span class="hljs-attr">schema:</span><br>      <span class="hljs-attr">openAPIV3Schema:</span><br>        <span class="hljs-attr">properties:</span><br>          <span class="hljs-attr">apiVersion:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;APIVersion defines the versioned schema of this representation</span><br><span class="hljs-string">              of an object. Servers should convert recognized schemas to the latest</span><br><span class="hljs-string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">kind:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Kind is a string value representing the REST resource this</span><br><span class="hljs-string">              object represents. Servers may infer this from the endpoint the client</span><br><span class="hljs-string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">metadata:</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>          <span class="hljs-attr">spec:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">IPAMConfigSpec</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">specification</span> <span class="hljs-string">for</span> <span class="hljs-string">an</span> <span class="hljs-string">IPAMConfig</span><br>              <span class="hljs-string">resource.</span><br>            <span class="hljs-attr">properties:</span><br>              <span class="hljs-attr">autoAllocateBlocks:</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">maxBlocksPerHost:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">MaxBlocksPerHost,</span> <span class="hljs-string">if</span> <span class="hljs-string">non-zero,</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">max</span> <span class="hljs-string">number</span> <span class="hljs-string">of</span> <span class="hljs-string">blocks</span><br>                  <span class="hljs-string">that</span> <span class="hljs-string">can</span> <span class="hljs-string">be</span> <span class="hljs-string">affine</span> <span class="hljs-string">to</span> <span class="hljs-string">each</span> <span class="hljs-string">host.</span><br>                <span class="hljs-attr">maximum:</span> <span class="hljs-number">2147483647</span><br>                <span class="hljs-attr">minimum:</span> <span class="hljs-number">0</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">strictAffinity:</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>            <span class="hljs-attr">required:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">autoAllocateBlocks</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">strictAffinity</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>    <span class="hljs-attr">served:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">storage:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">status:</span><br>  <span class="hljs-attr">acceptedNames:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">conditions:</span> []<br>  <span class="hljs-attr">storedVersions:</span> []<br><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/kdd-crds.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apiextensions.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">CustomResourceDefinition</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">ipamhandles.crd.projectcalico.org</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">group:</span> <span class="hljs-string">crd.projectcalico.org</span><br>  <span class="hljs-attr">names:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">IPAMHandle</span><br>    <span class="hljs-attr">listKind:</span> <span class="hljs-string">IPAMHandleList</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">ipamhandles</span><br>    <span class="hljs-attr">singular:</span> <span class="hljs-string">ipamhandle</span><br>  <span class="hljs-attr">preserveUnknownFields:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">scope:</span> <span class="hljs-string">Cluster</span><br>  <span class="hljs-attr">versions:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">v1</span><br>    <span class="hljs-attr">schema:</span><br>      <span class="hljs-attr">openAPIV3Schema:</span><br>        <span class="hljs-attr">properties:</span><br>          <span class="hljs-attr">apiVersion:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;APIVersion defines the versioned schema of this representation</span><br><span class="hljs-string">              of an object. Servers should convert recognized schemas to the latest</span><br><span class="hljs-string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">kind:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Kind is a string value representing the REST resource this</span><br><span class="hljs-string">              object represents. Servers may infer this from the endpoint the client</span><br><span class="hljs-string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">metadata:</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>          <span class="hljs-attr">spec:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">IPAMHandleSpec</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">specification</span> <span class="hljs-string">for</span> <span class="hljs-string">an</span> <span class="hljs-string">IPAMHandle</span><br>              <span class="hljs-string">resource.</span><br>            <span class="hljs-attr">properties:</span><br>              <span class="hljs-attr">block:</span><br>                <span class="hljs-attr">additionalProperties:</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>              <span class="hljs-attr">deleted:</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">handleID:</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>            <span class="hljs-attr">required:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">block</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">handleID</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>    <span class="hljs-attr">served:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">storage:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">status:</span><br>  <span class="hljs-attr">acceptedNames:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">conditions:</span> []<br>  <span class="hljs-attr">storedVersions:</span> []<br><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/kdd-crds.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apiextensions.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">CustomResourceDefinition</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">ippools.crd.projectcalico.org</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">group:</span> <span class="hljs-string">crd.projectcalico.org</span><br>  <span class="hljs-attr">names:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">IPPool</span><br>    <span class="hljs-attr">listKind:</span> <span class="hljs-string">IPPoolList</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">ippools</span><br>    <span class="hljs-attr">singular:</span> <span class="hljs-string">ippool</span><br>  <span class="hljs-attr">preserveUnknownFields:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">scope:</span> <span class="hljs-string">Cluster</span><br>  <span class="hljs-attr">versions:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">v1</span><br>    <span class="hljs-attr">schema:</span><br>      <span class="hljs-attr">openAPIV3Schema:</span><br>        <span class="hljs-attr">properties:</span><br>          <span class="hljs-attr">apiVersion:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;APIVersion defines the versioned schema of this representation</span><br><span class="hljs-string">              of an object. Servers should convert recognized schemas to the latest</span><br><span class="hljs-string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">kind:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Kind is a string value representing the REST resource this</span><br><span class="hljs-string">              object represents. Servers may infer this from the endpoint the client</span><br><span class="hljs-string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">metadata:</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>          <span class="hljs-attr">spec:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">IPPoolSpec</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">specification</span> <span class="hljs-string">for</span> <span class="hljs-string">an</span> <span class="hljs-string">IPPool</span> <span class="hljs-string">resource.</span><br>            <span class="hljs-attr">properties:</span><br>              <span class="hljs-attr">allowedUses:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">AllowedUse</span> <span class="hljs-string">controls</span> <span class="hljs-string">what</span> <span class="hljs-string">the</span> <span class="hljs-string">IP</span> <span class="hljs-string">pool</span> <span class="hljs-string">will</span> <span class="hljs-string">be</span> <span class="hljs-string">used</span> <span class="hljs-string">for.</span>  <span class="hljs-string">If</span><br>                  <span class="hljs-string">not</span> <span class="hljs-string">specified</span> <span class="hljs-string">or</span> <span class="hljs-string">empty,</span> <span class="hljs-string">defaults</span> <span class="hljs-string">to</span> [<span class="hljs-string">&quot;Tunnel&quot;</span>, <span class="hljs-string">&quot;Workload&quot;</span>] <span class="hljs-string">for</span> <span class="hljs-string">back-compatibility</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>              <span class="hljs-attr">blockSize:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">The</span> <span class="hljs-string">block</span> <span class="hljs-string">size</span> <span class="hljs-string">to</span> <span class="hljs-string">use</span> <span class="hljs-string">for</span> <span class="hljs-string">IP</span> <span class="hljs-string">address</span> <span class="hljs-string">assignments</span> <span class="hljs-string">from</span><br>                  <span class="hljs-string">this</span> <span class="hljs-string">pool.</span> <span class="hljs-string">Defaults</span> <span class="hljs-string">to</span> <span class="hljs-number">26</span> <span class="hljs-string">for</span> <span class="hljs-string">IPv4</span> <span class="hljs-string">and</span> <span class="hljs-number">122</span> <span class="hljs-string">for</span> <span class="hljs-string">IPv6.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">cidr:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">The</span> <span class="hljs-string">pool</span> <span class="hljs-string">CIDR.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">disableBGPExport:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Disable exporting routes from this IP Pool<span class="hljs-char escape_">&#x27;&#x27;</span>s CIDR over</span><br><span class="hljs-string">                  BGP. [Default: false]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">disabled:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">When</span> <span class="hljs-string">disabled</span> <span class="hljs-string">is</span> <span class="hljs-literal">true</span><span class="hljs-string">,</span> <span class="hljs-string">Calico</span> <span class="hljs-string">IPAM</span> <span class="hljs-string">will</span> <span class="hljs-string">not</span> <span class="hljs-string">assign</span> <span class="hljs-string">addresses</span><br>                  <span class="hljs-string">from</span> <span class="hljs-string">this</span> <span class="hljs-string">pool.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">ipip:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Deprecated: this field is only used for APIv1 backwards</span><br><span class="hljs-string">                  compatibility. Setting this field is not allowed, this field is</span><br><span class="hljs-string">                  for internal use only.&#x27;</span><br>                <span class="hljs-attr">properties:</span><br>                  <span class="hljs-attr">enabled:</span><br>                    <span class="hljs-attr">description:</span> <span class="hljs-string">When</span> <span class="hljs-string">enabled</span> <span class="hljs-string">is</span> <span class="hljs-literal">true</span><span class="hljs-string">,</span> <span class="hljs-string">ipip</span> <span class="hljs-string">tunneling</span> <span class="hljs-string">will</span> <span class="hljs-string">be</span> <span class="hljs-string">used</span><br>                      <span class="hljs-string">to</span> <span class="hljs-string">deliver</span> <span class="hljs-string">packets</span> <span class="hljs-string">to</span> <span class="hljs-string">destinations</span> <span class="hljs-string">within</span> <span class="hljs-string">this</span> <span class="hljs-string">pool.</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>                  <span class="hljs-attr">mode:</span><br>                    <span class="hljs-attr">description:</span> <span class="hljs-string">The</span> <span class="hljs-string">IPIP</span> <span class="hljs-string">mode.</span>  <span class="hljs-string">This</span> <span class="hljs-string">can</span> <span class="hljs-string">be</span> <span class="hljs-string">one</span> <span class="hljs-string">of</span> <span class="hljs-string">&quot;always&quot;</span> <span class="hljs-string">or</span> <span class="hljs-string">&quot;cross-subnet&quot;</span><span class="hljs-string">.</span>  <span class="hljs-string">A</span><br>                      <span class="hljs-string">mode</span> <span class="hljs-string">of</span> <span class="hljs-string">&quot;always&quot;</span> <span class="hljs-string">will</span> <span class="hljs-string">also</span> <span class="hljs-string">use</span> <span class="hljs-string">IPIP</span> <span class="hljs-string">tunneling</span> <span class="hljs-string">for</span> <span class="hljs-string">routing</span> <span class="hljs-string">to</span><br>                      <span class="hljs-string">destination</span> <span class="hljs-string">IP</span> <span class="hljs-string">addresses</span> <span class="hljs-string">within</span> <span class="hljs-string">this</span> <span class="hljs-string">pool.</span>  <span class="hljs-string">A</span> <span class="hljs-string">mode</span> <span class="hljs-string">of</span> <span class="hljs-string">&quot;cross-subnet&quot;</span><br>                      <span class="hljs-string">will</span> <span class="hljs-string">only</span> <span class="hljs-string">use</span> <span class="hljs-string">IPIP</span> <span class="hljs-string">tunneling</span> <span class="hljs-string">when</span> <span class="hljs-string">the</span> <span class="hljs-string">destination</span> <span class="hljs-string">node</span> <span class="hljs-string">is</span> <span class="hljs-string">on</span><br>                      <span class="hljs-string">a</span> <span class="hljs-string">different</span> <span class="hljs-string">subnet</span> <span class="hljs-string">to</span> <span class="hljs-string">the</span> <span class="hljs-string">originating</span> <span class="hljs-string">node.</span>  <span class="hljs-string">The</span> <span class="hljs-string">default</span> <span class="hljs-string">value</span><br>                      <span class="hljs-string">(if</span> <span class="hljs-string">not</span> <span class="hljs-string">specified)</span> <span class="hljs-string">is</span> <span class="hljs-string">&quot;always&quot;</span><span class="hljs-string">.</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>              <span class="hljs-attr">ipipMode:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Contains</span> <span class="hljs-string">configuration</span> <span class="hljs-string">for</span> <span class="hljs-string">IPIP</span> <span class="hljs-string">tunneling</span> <span class="hljs-string">for</span> <span class="hljs-string">this</span> <span class="hljs-string">pool.</span><br>                  <span class="hljs-string">If</span> <span class="hljs-string">not</span> <span class="hljs-string">specified,</span> <span class="hljs-string">then</span> <span class="hljs-string">this</span> <span class="hljs-string">is</span> <span class="hljs-string">defaulted</span> <span class="hljs-string">to</span> <span class="hljs-string">&quot;Never&quot;</span> <span class="hljs-string">(i.e.</span> <span class="hljs-string">IPIP</span> <span class="hljs-string">tunneling</span><br>                  <span class="hljs-string">is</span> <span class="hljs-string">disabled).</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">nat-outgoing:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Deprecated: this field is only used for APIv1 backwards</span><br><span class="hljs-string">                  compatibility. Setting this field is not allowed, this field is</span><br><span class="hljs-string">                  for internal use only.&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">natOutgoing:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">When</span> <span class="hljs-string">natOutgoing</span> <span class="hljs-string">is</span> <span class="hljs-literal">true</span><span class="hljs-string">,</span> <span class="hljs-string">packets</span> <span class="hljs-string">sent</span> <span class="hljs-string">from</span> <span class="hljs-string">Calico</span> <span class="hljs-string">networked</span><br>                  <span class="hljs-string">containers</span> <span class="hljs-string">in</span> <span class="hljs-string">this</span> <span class="hljs-string">pool</span> <span class="hljs-string">to</span> <span class="hljs-string">destinations</span> <span class="hljs-string">outside</span> <span class="hljs-string">of</span> <span class="hljs-string">this</span> <span class="hljs-string">pool</span> <span class="hljs-string">will</span><br>                  <span class="hljs-string">be</span> <span class="hljs-string">masqueraded.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span><br>              <span class="hljs-attr">nodeSelector:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Allows</span> <span class="hljs-string">IPPool</span> <span class="hljs-string">to</span> <span class="hljs-string">allocate</span> <span class="hljs-string">for</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">node</span> <span class="hljs-string">by</span> <span class="hljs-string">label</span><br>                  <span class="hljs-string">selector.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">vxlanMode:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Contains</span> <span class="hljs-string">configuration</span> <span class="hljs-string">for</span> <span class="hljs-string">VXLAN</span> <span class="hljs-string">tunneling</span> <span class="hljs-string">for</span> <span class="hljs-string">this</span> <span class="hljs-string">pool.</span><br>                  <span class="hljs-string">If</span> <span class="hljs-string">not</span> <span class="hljs-string">specified,</span> <span class="hljs-string">then</span> <span class="hljs-string">this</span> <span class="hljs-string">is</span> <span class="hljs-string">defaulted</span> <span class="hljs-string">to</span> <span class="hljs-string">&quot;Never&quot;</span> <span class="hljs-string">(i.e.</span> <span class="hljs-string">VXLAN</span><br>                  <span class="hljs-string">tunneling</span> <span class="hljs-string">is</span> <span class="hljs-string">disabled).</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>            <span class="hljs-attr">required:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">cidr</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>    <span class="hljs-attr">served:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">storage:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">status:</span><br>  <span class="hljs-attr">acceptedNames:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">conditions:</span> []<br>  <span class="hljs-attr">storedVersions:</span> []<br><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/kdd-crds.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apiextensions.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">CustomResourceDefinition</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">annotations:</span><br>    <span class="hljs-attr">controller-gen.kubebuilder.io/version:</span> <span class="hljs-string">(devel)</span><br>  <span class="hljs-attr">creationTimestamp:</span> <span class="hljs-literal">null</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">ipreservations.crd.projectcalico.org</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">group:</span> <span class="hljs-string">crd.projectcalico.org</span><br>  <span class="hljs-attr">names:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">IPReservation</span><br>    <span class="hljs-attr">listKind:</span> <span class="hljs-string">IPReservationList</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">ipreservations</span><br>    <span class="hljs-attr">singular:</span> <span class="hljs-string">ipreservation</span><br>  <span class="hljs-attr">preserveUnknownFields:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">scope:</span> <span class="hljs-string">Cluster</span><br>  <span class="hljs-attr">versions:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">v1</span><br>    <span class="hljs-attr">schema:</span><br>      <span class="hljs-attr">openAPIV3Schema:</span><br>        <span class="hljs-attr">properties:</span><br>          <span class="hljs-attr">apiVersion:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;APIVersion defines the versioned schema of this representation</span><br><span class="hljs-string">              of an object. Servers should convert recognized schemas to the latest</span><br><span class="hljs-string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">kind:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Kind is a string value representing the REST resource this</span><br><span class="hljs-string">              object represents. Servers may infer this from the endpoint the client</span><br><span class="hljs-string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">metadata:</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>          <span class="hljs-attr">spec:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">IPReservationSpec</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">specification</span> <span class="hljs-string">for</span> <span class="hljs-string">an</span> <span class="hljs-string">IPReservation</span><br>              <span class="hljs-string">resource.</span><br>            <span class="hljs-attr">properties:</span><br>              <span class="hljs-attr">reservedCIDRs:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">ReservedCIDRs</span> <span class="hljs-string">is</span> <span class="hljs-string">a</span> <span class="hljs-string">list</span> <span class="hljs-string">of</span> <span class="hljs-string">CIDRs</span> <span class="hljs-string">and/or</span> <span class="hljs-string">IP</span> <span class="hljs-string">addresses</span><br>                  <span class="hljs-string">that</span> <span class="hljs-string">Calico</span> <span class="hljs-string">IPAM</span> <span class="hljs-string">will</span> <span class="hljs-string">exclude</span> <span class="hljs-string">from</span> <span class="hljs-string">new</span> <span class="hljs-string">allocations.</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>    <span class="hljs-attr">served:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">storage:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">status:</span><br>  <span class="hljs-attr">acceptedNames:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">conditions:</span> []<br>  <span class="hljs-attr">storedVersions:</span> []<br><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/kdd-crds.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apiextensions.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">CustomResourceDefinition</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">kubecontrollersconfigurations.crd.projectcalico.org</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">group:</span> <span class="hljs-string">crd.projectcalico.org</span><br>  <span class="hljs-attr">names:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">KubeControllersConfiguration</span><br>    <span class="hljs-attr">listKind:</span> <span class="hljs-string">KubeControllersConfigurationList</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">kubecontrollersconfigurations</span><br>    <span class="hljs-attr">singular:</span> <span class="hljs-string">kubecontrollersconfiguration</span><br>  <span class="hljs-attr">preserveUnknownFields:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">scope:</span> <span class="hljs-string">Cluster</span><br>  <span class="hljs-attr">versions:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">v1</span><br>    <span class="hljs-attr">schema:</span><br>      <span class="hljs-attr">openAPIV3Schema:</span><br>        <span class="hljs-attr">properties:</span><br>          <span class="hljs-attr">apiVersion:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;APIVersion defines the versioned schema of this representation</span><br><span class="hljs-string">              of an object. Servers should convert recognized schemas to the latest</span><br><span class="hljs-string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">kind:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Kind is a string value representing the REST resource this</span><br><span class="hljs-string">              object represents. Servers may infer this from the endpoint the client</span><br><span class="hljs-string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">metadata:</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>          <span class="hljs-attr">spec:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">KubeControllersConfigurationSpec</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">values</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span><br>              <span class="hljs-string">Kubernetes</span> <span class="hljs-string">controllers</span> <span class="hljs-string">configuration.</span><br>            <span class="hljs-attr">properties:</span><br>              <span class="hljs-attr">controllers:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Controllers</span> <span class="hljs-string">enables</span> <span class="hljs-string">and</span> <span class="hljs-string">configures</span> <span class="hljs-string">individual</span> <span class="hljs-string">Kubernetes</span><br>                  <span class="hljs-string">controllers</span><br>                <span class="hljs-attr">properties:</span><br>                  <span class="hljs-attr">namespace:</span><br>                    <span class="hljs-attr">description:</span> <span class="hljs-string">Namespace</span> <span class="hljs-string">enables</span> <span class="hljs-string">and</span> <span class="hljs-string">configures</span> <span class="hljs-string">the</span> <span class="hljs-string">namespace</span> <span class="hljs-string">controller.</span><br>                      <span class="hljs-string">Enabled</span> <span class="hljs-string">by</span> <span class="hljs-string">default,</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">nil</span> <span class="hljs-string">to</span> <span class="hljs-string">disable.</span><br>                    <span class="hljs-attr">properties:</span><br>                      <span class="hljs-attr">reconcilerPeriod:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;ReconcilerPeriod is the period to perform reconciliation</span><br><span class="hljs-string">                          with the Calico datastore. [Default: 5m]&#x27;</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                  <span class="hljs-attr">node:</span><br>                    <span class="hljs-attr">description:</span> <span class="hljs-string">Node</span> <span class="hljs-string">enables</span> <span class="hljs-string">and</span> <span class="hljs-string">configures</span> <span class="hljs-string">the</span> <span class="hljs-string">node</span> <span class="hljs-string">controller.</span><br>                      <span class="hljs-string">Enabled</span> <span class="hljs-string">by</span> <span class="hljs-string">default,</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">nil</span> <span class="hljs-string">to</span> <span class="hljs-string">disable.</span><br>                    <span class="hljs-attr">properties:</span><br>                      <span class="hljs-attr">hostEndpoint:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">HostEndpoint</span> <span class="hljs-string">controls</span> <span class="hljs-string">syncing</span> <span class="hljs-string">nodes</span> <span class="hljs-string">to</span> <span class="hljs-string">host</span> <span class="hljs-string">endpoints.</span><br>                          <span class="hljs-string">Disabled</span> <span class="hljs-string">by</span> <span class="hljs-string">default,</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">nil</span> <span class="hljs-string">to</span> <span class="hljs-string">disable.</span><br>                        <span class="hljs-attr">properties:</span><br>                          <span class="hljs-attr">autoCreate:</span><br>                            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;AutoCreate enables automatic creation of</span><br><span class="hljs-string">                              host endpoints for every node. [Default: Disabled]&#x27;</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                      <span class="hljs-attr">leakGracePeriod:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;LeakGracePeriod is the period used by the controller</span><br><span class="hljs-string">                          to determine if an IP address has been leaked. Set to 0</span><br><span class="hljs-string">                          to disable IP garbage collection. [Default: 15m]&#x27;</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">reconcilerPeriod:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;ReconcilerPeriod is the period to perform reconciliation</span><br><span class="hljs-string">                          with the Calico datastore. [Default: 5m]&#x27;</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">syncLabels:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;SyncLabels controls whether to copy Kubernetes</span><br><span class="hljs-string">                          node labels to Calico nodes. [Default: Enabled]&#x27;</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                  <span class="hljs-attr">policy:</span><br>                    <span class="hljs-attr">description:</span> <span class="hljs-string">Policy</span> <span class="hljs-string">enables</span> <span class="hljs-string">and</span> <span class="hljs-string">configures</span> <span class="hljs-string">the</span> <span class="hljs-string">policy</span> <span class="hljs-string">controller.</span><br>                      <span class="hljs-string">Enabled</span> <span class="hljs-string">by</span> <span class="hljs-string">default,</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">nil</span> <span class="hljs-string">to</span> <span class="hljs-string">disable.</span><br>                    <span class="hljs-attr">properties:</span><br>                      <span class="hljs-attr">reconcilerPeriod:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;ReconcilerPeriod is the period to perform reconciliation</span><br><span class="hljs-string">                          with the Calico datastore. [Default: 5m]&#x27;</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                  <span class="hljs-attr">serviceAccount:</span><br>                    <span class="hljs-attr">description:</span> <span class="hljs-string">ServiceAccount</span> <span class="hljs-string">enables</span> <span class="hljs-string">and</span> <span class="hljs-string">configures</span> <span class="hljs-string">the</span> <span class="hljs-string">service</span><br>                      <span class="hljs-string">account</span> <span class="hljs-string">controller.</span> <span class="hljs-string">Enabled</span> <span class="hljs-string">by</span> <span class="hljs-string">default,</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">nil</span> <span class="hljs-string">to</span> <span class="hljs-string">disable.</span><br>                    <span class="hljs-attr">properties:</span><br>                      <span class="hljs-attr">reconcilerPeriod:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;ReconcilerPeriod is the period to perform reconciliation</span><br><span class="hljs-string">                          with the Calico datastore. [Default: 5m]&#x27;</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                  <span class="hljs-attr">workloadEndpoint:</span><br>                    <span class="hljs-attr">description:</span> <span class="hljs-string">WorkloadEndpoint</span> <span class="hljs-string">enables</span> <span class="hljs-string">and</span> <span class="hljs-string">configures</span> <span class="hljs-string">the</span> <span class="hljs-string">workload</span><br>                      <span class="hljs-string">endpoint</span> <span class="hljs-string">controller.</span> <span class="hljs-string">Enabled</span> <span class="hljs-string">by</span> <span class="hljs-string">default,</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">nil</span> <span class="hljs-string">to</span> <span class="hljs-string">disable.</span><br>                    <span class="hljs-attr">properties:</span><br>                      <span class="hljs-attr">reconcilerPeriod:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;ReconcilerPeriod is the period to perform reconciliation</span><br><span class="hljs-string">                          with the Calico datastore. [Default: 5m]&#x27;</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>              <span class="hljs-attr">debugProfilePort:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">DebugProfilePort</span> <span class="hljs-string">configures</span> <span class="hljs-string">the</span> <span class="hljs-string">port</span> <span class="hljs-string">to</span> <span class="hljs-string">serve</span> <span class="hljs-string">memory</span><br>                  <span class="hljs-string">and</span> <span class="hljs-string">cpu</span> <span class="hljs-string">profiles</span> <span class="hljs-string">on.</span> <span class="hljs-string">If</span> <span class="hljs-string">not</span> <span class="hljs-string">specified,</span> <span class="hljs-string">profiling</span> <span class="hljs-string">is</span> <span class="hljs-string">disabled.</span><br>                <span class="hljs-attr">format:</span> <span class="hljs-string">int32</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>              <span class="hljs-attr">etcdV3CompactionPeriod:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;EtcdV3CompactionPeriod is the period between etcdv3</span><br><span class="hljs-string">                  compaction requests. Set to 0 to disable. [Default: 10m]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">healthChecks:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;HealthChecks enables or disables support for health</span><br><span class="hljs-string">                  checks [Default: Enabled]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">logSeverityScreen:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;LogSeverityScreen is the log severity above which logs</span><br><span class="hljs-string">                  are sent to the stdout. [Default: Info]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">prometheusMetricsPort:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;PrometheusMetricsPort is the TCP port that the Prometheus</span><br><span class="hljs-string">                  metrics server should bind to. Set to 0 to disable. [Default: 9094]&#x27;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>            <span class="hljs-attr">required:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">controllers</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>          <span class="hljs-attr">status:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">KubeControllersConfigurationStatus</span> <span class="hljs-string">represents</span> <span class="hljs-string">the</span> <span class="hljs-string">status</span><br>              <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">configuration.</span> <span class="hljs-string">It&#x27;s</span> <span class="hljs-string">useful</span> <span class="hljs-string">for</span> <span class="hljs-string">admins</span> <span class="hljs-string">to</span> <span class="hljs-string">be</span> <span class="hljs-string">able</span> <span class="hljs-string">to</span> <span class="hljs-string">see</span> <span class="hljs-string">the</span> <span class="hljs-string">actual</span><br>              <span class="hljs-string">config</span> <span class="hljs-string">that</span> <span class="hljs-string">was</span> <span class="hljs-string">applied,</span> <span class="hljs-string">which</span> <span class="hljs-string">can</span> <span class="hljs-string">be</span> <span class="hljs-string">modified</span> <span class="hljs-string">by</span> <span class="hljs-string">environment</span> <span class="hljs-string">variables</span><br>              <span class="hljs-string">on</span> <span class="hljs-string">the</span> <span class="hljs-string">kube-controllers</span> <span class="hljs-string">process.</span><br>            <span class="hljs-attr">properties:</span><br>              <span class="hljs-attr">environmentVars:</span><br>                <span class="hljs-attr">additionalProperties:</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">EnvironmentVars</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">environment</span> <span class="hljs-string">variables</span> <span class="hljs-string">on</span><br>                  <span class="hljs-string">the</span> <span class="hljs-string">kube-controllers</span> <span class="hljs-string">that</span> <span class="hljs-string">influenced</span> <span class="hljs-string">the</span> <span class="hljs-string">RunningConfig.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>              <span class="hljs-attr">runningConfig:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">RunningConfig</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">effective</span> <span class="hljs-string">config</span> <span class="hljs-string">that</span> <span class="hljs-string">is</span> <span class="hljs-string">running</span><br>                  <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">kube-controllers</span> <span class="hljs-string">pod,</span> <span class="hljs-string">after</span> <span class="hljs-string">merging</span> <span class="hljs-string">the</span> <span class="hljs-string">API</span> <span class="hljs-string">resource</span> <span class="hljs-string">with</span><br>                  <span class="hljs-string">any</span> <span class="hljs-string">environment</span> <span class="hljs-string">variables.</span><br>                <span class="hljs-attr">properties:</span><br>                  <span class="hljs-attr">controllers:</span><br>                    <span class="hljs-attr">description:</span> <span class="hljs-string">Controllers</span> <span class="hljs-string">enables</span> <span class="hljs-string">and</span> <span class="hljs-string">configures</span> <span class="hljs-string">individual</span> <span class="hljs-string">Kubernetes</span><br>                      <span class="hljs-string">controllers</span><br>                    <span class="hljs-attr">properties:</span><br>                      <span class="hljs-attr">namespace:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">Namespace</span> <span class="hljs-string">enables</span> <span class="hljs-string">and</span> <span class="hljs-string">configures</span> <span class="hljs-string">the</span> <span class="hljs-string">namespace</span><br>                          <span class="hljs-string">controller.</span> <span class="hljs-string">Enabled</span> <span class="hljs-string">by</span> <span class="hljs-string">default,</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">nil</span> <span class="hljs-string">to</span> <span class="hljs-string">disable.</span><br>                        <span class="hljs-attr">properties:</span><br>                          <span class="hljs-attr">reconcilerPeriod:</span><br>                            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;ReconcilerPeriod is the period to perform</span><br><span class="hljs-string">                              reconciliation with the Calico datastore. [Default:</span><br><span class="hljs-string">                              5m]&#x27;</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                      <span class="hljs-attr">node:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">Node</span> <span class="hljs-string">enables</span> <span class="hljs-string">and</span> <span class="hljs-string">configures</span> <span class="hljs-string">the</span> <span class="hljs-string">node</span> <span class="hljs-string">controller.</span><br>                          <span class="hljs-string">Enabled</span> <span class="hljs-string">by</span> <span class="hljs-string">default,</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">nil</span> <span class="hljs-string">to</span> <span class="hljs-string">disable.</span><br>                        <span class="hljs-attr">properties:</span><br>                          <span class="hljs-attr">hostEndpoint:</span><br>                            <span class="hljs-attr">description:</span> <span class="hljs-string">HostEndpoint</span> <span class="hljs-string">controls</span> <span class="hljs-string">syncing</span> <span class="hljs-string">nodes</span> <span class="hljs-string">to</span> <span class="hljs-string">host</span><br>                              <span class="hljs-string">endpoints.</span> <span class="hljs-string">Disabled</span> <span class="hljs-string">by</span> <span class="hljs-string">default,</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">nil</span> <span class="hljs-string">to</span> <span class="hljs-string">disable.</span><br>                            <span class="hljs-attr">properties:</span><br>                              <span class="hljs-attr">autoCreate:</span><br>                                <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;AutoCreate enables automatic creation</span><br><span class="hljs-string">                                  of host endpoints for every node. [Default: Disabled]&#x27;</span><br>                                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                          <span class="hljs-attr">leakGracePeriod:</span><br>                            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;LeakGracePeriod is the period used by the</span><br><span class="hljs-string">                              controller to determine if an IP address has been leaked.</span><br><span class="hljs-string">                              Set to 0 to disable IP garbage collection. [Default:</span><br><span class="hljs-string">                              15m]&#x27;</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">reconcilerPeriod:</span><br>                            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;ReconcilerPeriod is the period to perform</span><br><span class="hljs-string">                              reconciliation with the Calico datastore. [Default:</span><br><span class="hljs-string">                              5m]&#x27;</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">syncLabels:</span><br>                            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;SyncLabels controls whether to copy Kubernetes</span><br><span class="hljs-string">                              node labels to Calico nodes. [Default: Enabled]&#x27;</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                      <span class="hljs-attr">policy:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">Policy</span> <span class="hljs-string">enables</span> <span class="hljs-string">and</span> <span class="hljs-string">configures</span> <span class="hljs-string">the</span> <span class="hljs-string">policy</span> <span class="hljs-string">controller.</span><br>                          <span class="hljs-string">Enabled</span> <span class="hljs-string">by</span> <span class="hljs-string">default,</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">nil</span> <span class="hljs-string">to</span> <span class="hljs-string">disable.</span><br>                        <span class="hljs-attr">properties:</span><br>                          <span class="hljs-attr">reconcilerPeriod:</span><br>                            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;ReconcilerPeriod is the period to perform</span><br><span class="hljs-string">                              reconciliation with the Calico datastore. [Default:</span><br><span class="hljs-string">                              5m]&#x27;</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                      <span class="hljs-attr">serviceAccount:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">ServiceAccount</span> <span class="hljs-string">enables</span> <span class="hljs-string">and</span> <span class="hljs-string">configures</span> <span class="hljs-string">the</span> <span class="hljs-string">service</span><br>                          <span class="hljs-string">account</span> <span class="hljs-string">controller.</span> <span class="hljs-string">Enabled</span> <span class="hljs-string">by</span> <span class="hljs-string">default,</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">nil</span> <span class="hljs-string">to</span> <span class="hljs-string">disable.</span><br>                        <span class="hljs-attr">properties:</span><br>                          <span class="hljs-attr">reconcilerPeriod:</span><br>                            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;ReconcilerPeriod is the period to perform</span><br><span class="hljs-string">                              reconciliation with the Calico datastore. [Default:</span><br><span class="hljs-string">                              5m]&#x27;</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                      <span class="hljs-attr">workloadEndpoint:</span><br>                        <span class="hljs-attr">description:</span> <span class="hljs-string">WorkloadEndpoint</span> <span class="hljs-string">enables</span> <span class="hljs-string">and</span> <span class="hljs-string">configures</span> <span class="hljs-string">the</span> <span class="hljs-string">workload</span><br>                          <span class="hljs-string">endpoint</span> <span class="hljs-string">controller.</span> <span class="hljs-string">Enabled</span> <span class="hljs-string">by</span> <span class="hljs-string">default,</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">nil</span> <span class="hljs-string">to</span> <span class="hljs-string">disable.</span><br>                        <span class="hljs-attr">properties:</span><br>                          <span class="hljs-attr">reconcilerPeriod:</span><br>                            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;ReconcilerPeriod is the period to perform</span><br><span class="hljs-string">                              reconciliation with the Calico datastore. [Default:</span><br><span class="hljs-string">                              5m]&#x27;</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                  <span class="hljs-attr">debugProfilePort:</span><br>                    <span class="hljs-attr">description:</span> <span class="hljs-string">DebugProfilePort</span> <span class="hljs-string">configures</span> <span class="hljs-string">the</span> <span class="hljs-string">port</span> <span class="hljs-string">to</span> <span class="hljs-string">serve</span> <span class="hljs-string">memory</span><br>                      <span class="hljs-string">and</span> <span class="hljs-string">cpu</span> <span class="hljs-string">profiles</span> <span class="hljs-string">on.</span> <span class="hljs-string">If</span> <span class="hljs-string">not</span> <span class="hljs-string">specified,</span> <span class="hljs-string">profiling</span> <span class="hljs-string">is</span> <span class="hljs-string">disabled.</span><br>                    <span class="hljs-attr">format:</span> <span class="hljs-string">int32</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                  <span class="hljs-attr">etcdV3CompactionPeriod:</span><br>                    <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;EtcdV3CompactionPeriod is the period between etcdv3</span><br><span class="hljs-string">                      compaction requests. Set to 0 to disable. [Default: 10m]&#x27;</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                  <span class="hljs-attr">healthChecks:</span><br>                    <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;HealthChecks enables or disables support for health</span><br><span class="hljs-string">                      checks [Default: Enabled]&#x27;</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                  <span class="hljs-attr">logSeverityScreen:</span><br>                    <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;LogSeverityScreen is the log severity above which</span><br><span class="hljs-string">                      logs are sent to the stdout. [Default: Info]&#x27;</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                  <span class="hljs-attr">prometheusMetricsPort:</span><br>                    <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;PrometheusMetricsPort is the TCP port that the Prometheus</span><br><span class="hljs-string">                      metrics server should bind to. Set to 0 to disable. [Default:</span><br><span class="hljs-string">                      9094]&#x27;</span><br>                    <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                <span class="hljs-attr">required:</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">controllers</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>    <span class="hljs-attr">served:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">storage:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">status:</span><br>  <span class="hljs-attr">acceptedNames:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">conditions:</span> []<br>  <span class="hljs-attr">storedVersions:</span> []<br><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/kdd-crds.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apiextensions.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">CustomResourceDefinition</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">networkpolicies.crd.projectcalico.org</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">group:</span> <span class="hljs-string">crd.projectcalico.org</span><br>  <span class="hljs-attr">names:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">NetworkPolicy</span><br>    <span class="hljs-attr">listKind:</span> <span class="hljs-string">NetworkPolicyList</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">networkpolicies</span><br>    <span class="hljs-attr">singular:</span> <span class="hljs-string">networkpolicy</span><br>  <span class="hljs-attr">preserveUnknownFields:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">scope:</span> <span class="hljs-string">Namespaced</span><br>  <span class="hljs-attr">versions:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">v1</span><br>    <span class="hljs-attr">schema:</span><br>      <span class="hljs-attr">openAPIV3Schema:</span><br>        <span class="hljs-attr">properties:</span><br>          <span class="hljs-attr">apiVersion:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;APIVersion defines the versioned schema of this representation</span><br><span class="hljs-string">              of an object. Servers should convert recognized schemas to the latest</span><br><span class="hljs-string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">kind:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Kind is a string value representing the REST resource this</span><br><span class="hljs-string">              object represents. Servers may infer this from the endpoint the client</span><br><span class="hljs-string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">metadata:</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>          <span class="hljs-attr">spec:</span><br>            <span class="hljs-attr">properties:</span><br>              <span class="hljs-attr">egress:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">The</span> <span class="hljs-string">ordered</span> <span class="hljs-string">set</span> <span class="hljs-string">of</span> <span class="hljs-string">egress</span> <span class="hljs-string">rules.</span>  <span class="hljs-string">Each</span> <span class="hljs-string">rule</span> <span class="hljs-string">contains</span><br>                  <span class="hljs-string">a</span> <span class="hljs-string">set</span> <span class="hljs-string">of</span> <span class="hljs-string">packet</span> <span class="hljs-string">match</span> <span class="hljs-string">criteria</span> <span class="hljs-string">and</span> <span class="hljs-string">a</span> <span class="hljs-string">corresponding</span> <span class="hljs-string">action</span> <span class="hljs-string">to</span> <span class="hljs-string">apply.</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;A Rule encapsulates a set of match criteria and an</span><br><span class="hljs-string">                    action.  Both selector-based security Policy and security Profiles</span><br><span class="hljs-string">                    reference rules - separated out as a list of rules for both ingress</span><br><span class="hljs-string">                    and egress packet matching. \n Each positive match criteria has</span><br><span class="hljs-string">                    a negated version, prefixed with \&quot;Not\&quot;. All the match criteria</span><br><span class="hljs-string">                    within a rule must be satisfied for a packet to match. A single</span><br><span class="hljs-string">                    rule can contain the positive and negative version of a match</span><br><span class="hljs-string">                    and both must be satisfied for the rule to match.&quot;</span><br>                  <span class="hljs-attr">properties:</span><br>                    <span class="hljs-attr">action:</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                    <span class="hljs-attr">destination:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">Destination</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">match</span> <span class="hljs-string">criteria</span> <span class="hljs-string">that</span> <span class="hljs-string">apply</span><br>                        <span class="hljs-string">to</span> <span class="hljs-string">destination</span> <span class="hljs-string">entity.</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">namespaceSelector:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;NamespaceSelector is an optional field that</span><br><span class="hljs-string">                            contains a selector expression. Only traffic that originates</span><br><span class="hljs-string">                            from (or terminates at) endpoints within the selected</span><br><span class="hljs-string">                            namespaces will be matched. When both NamespaceSelector</span><br><span class="hljs-string">                            and another selector are defined on the same rule, then</span><br><span class="hljs-string">                            only workload endpoints that are matched by both selectors</span><br><span class="hljs-string">                            will be selected by the rule. \n For NetworkPolicy, an</span><br><span class="hljs-string">                            empty NamespaceSelector implies that the Selector is limited</span><br><span class="hljs-string">                            to selecting only workload endpoints in the same namespace</span><br><span class="hljs-string">                            as the NetworkPolicy. \n For NetworkPolicy, `global()`</span><br><span class="hljs-string">                            NamespaceSelector implies that the Selector is limited</span><br><span class="hljs-string">                            to selecting only GlobalNetworkSet or HostEndpoint. \n</span><br><span class="hljs-string">                            For GlobalNetworkPolicy, an empty NamespaceSelector implies</span><br><span class="hljs-string">                            the Selector applies to workload endpoints across all</span><br><span class="hljs-string">                            namespaces.&quot;</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">nets:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Nets</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span> <span class="hljs-string">the</span><br>                            <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span> <span class="hljs-string">from</span> <span class="hljs-string">(or</span><br>                            <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">IP</span> <span class="hljs-string">addresses</span> <span class="hljs-string">in</span> <span class="hljs-string">any</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">given</span> <span class="hljs-string">subnets.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">notNets:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">NotNets</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Nets</span><br>                            <span class="hljs-string">field.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">notPorts:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">NotPorts</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Ports</span><br>                            <span class="hljs-string">field.</span> <span class="hljs-string">Since</span> <span class="hljs-string">only</span> <span class="hljs-string">some</span> <span class="hljs-string">protocols</span> <span class="hljs-string">have</span> <span class="hljs-string">ports,</span> <span class="hljs-string">if</span> <span class="hljs-string">any</span> <span class="hljs-string">ports</span><br>                            <span class="hljs-string">are</span> <span class="hljs-string">specified</span> <span class="hljs-string">it</span> <span class="hljs-string">requires</span> <span class="hljs-string">the</span> <span class="hljs-string">Protocol</span> <span class="hljs-string">match</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">Rule</span><br>                            <span class="hljs-string">to</span> <span class="hljs-string">be</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">&quot;TCP&quot;</span> <span class="hljs-string">or</span> <span class="hljs-string">&quot;UDP&quot;</span><span class="hljs-string">.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">anyOf:</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                            <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">notSelector:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">NotSelector</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Selector</span><br>                            <span class="hljs-string">field.</span>  <span class="hljs-string">See</span> <span class="hljs-string">Selector</span> <span class="hljs-string">field</span> <span class="hljs-string">for</span> <span class="hljs-string">subtleties</span> <span class="hljs-string">with</span> <span class="hljs-string">negated</span><br>                            <span class="hljs-string">selectors.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">ports:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Ports is an optional field that restricts</span><br><span class="hljs-string">                            the rule to only apply to traffic that has a source (destination)</span><br><span class="hljs-string">                            port that matches one of these ranges/values. This value</span><br><span class="hljs-string">                            is a list of integers or strings that represent ranges</span><br><span class="hljs-string">                            of ports. \n Since only some protocols have ports, if</span><br><span class="hljs-string">                            any ports are specified it requires the Protocol match</span><br><span class="hljs-string">                            in the Rule to be set to \&quot;TCP\&quot; or \&quot;UDP\&quot;.&quot;</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">anyOf:</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                            <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">selector:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Selector is an optional field that contains</span><br><span class="hljs-string">                            a selector expression (see Policy for sample syntax).</span><br><span class="hljs-string">                            \ Only traffic that originates from (terminates at) endpoints</span><br><span class="hljs-string">                            matching the selector will be matched. \n Note that: in</span><br><span class="hljs-string">                            addition to the negated version of the Selector (see NotSelector</span><br><span class="hljs-string">                            below), the selector expression syntax itself supports</span><br><span class="hljs-string">                            negation.  The two types of negation are subtly different.</span><br><span class="hljs-string">                            One negates the set of matched endpoints, the other negates</span><br><span class="hljs-string">                            the whole match: \n \tSelector = \&quot;!has(my_label)\&quot; matches</span><br><span class="hljs-string">                            packets that are from other Calico-controlled \tendpoints</span><br><span class="hljs-string">                            that do not have the label \&quot;my_label\&quot;. \n \tNotSelector</span><br><span class="hljs-string">                            = \&quot;has(my_label)\&quot; matches packets that are not from</span><br><span class="hljs-string">                            Calico-controlled \tendpoints that do have the label \&quot;my_label\&quot;.</span><br><span class="hljs-string">                            \n The effect is that the latter will accept packets from</span><br><span class="hljs-string">                            non-Calico sources whereas the former is limited to packets</span><br><span class="hljs-string">                            from Calico-controlled endpoints.&quot;</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">serviceAccounts:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">ServiceAccounts</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                            <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span> <span class="hljs-string">from</span><br>                            <span class="hljs-string">(or</span> <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">running</span> <span class="hljs-string">as</span> <span class="hljs-string">a</span> <span class="hljs-string">matching</span> <span class="hljs-string">service</span><br>                            <span class="hljs-string">account.</span><br>                          <span class="hljs-attr">properties:</span><br>                            <span class="hljs-attr">names:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Names</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                                <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span><br>                                <span class="hljs-string">from</span> <span class="hljs-string">(or</span> <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">running</span> <span class="hljs-string">as</span> <span class="hljs-string">a</span> <span class="hljs-string">service</span><br>                                <span class="hljs-string">account</span> <span class="hljs-string">whose</span> <span class="hljs-string">name</span> <span class="hljs-string">is</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">list.</span><br>                              <span class="hljs-attr">items:</span><br>                                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                            <span class="hljs-attr">selector:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Selector</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                                <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span><br>                                <span class="hljs-string">from</span> <span class="hljs-string">(or</span> <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">running</span> <span class="hljs-string">as</span> <span class="hljs-string">a</span> <span class="hljs-string">service</span><br>                                <span class="hljs-string">account</span> <span class="hljs-string">that</span> <span class="hljs-string">matches</span> <span class="hljs-string">the</span> <span class="hljs-string">given</span> <span class="hljs-string">label</span> <span class="hljs-string">selector.</span> <span class="hljs-string">If</span><br>                                <span class="hljs-string">both</span> <span class="hljs-string">Names</span> <span class="hljs-string">and</span> <span class="hljs-string">Selector</span> <span class="hljs-string">are</span> <span class="hljs-string">specified</span> <span class="hljs-string">then</span> <span class="hljs-string">they</span> <span class="hljs-string">are</span><br>                                <span class="hljs-string">AND&#x27;ed.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                        <span class="hljs-attr">services:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Services is an optional field that contains</span><br><span class="hljs-string">                            options for matching Kubernetes Services. If specified,</span><br><span class="hljs-string">                            only traffic that originates from or terminates at endpoints</span><br><span class="hljs-string">                            within the selected service(s) will be matched, and only</span><br><span class="hljs-string">                            to/from each endpoint&#x27;s port. \n Services cannot be specified</span><br><span class="hljs-string">                            on the same rule as Selector, NotSelector, NamespaceSelector,</span><br><span class="hljs-string">                            Nets, NotNets or ServiceAccounts. \n Ports and NotPorts</span><br><span class="hljs-string">                            can only be specified with Services on ingress rules.&quot;</span><br>                          <span class="hljs-attr">properties:</span><br>                            <span class="hljs-attr">name:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Name</span> <span class="hljs-string">specifies</span> <span class="hljs-string">the</span> <span class="hljs-string">name</span> <span class="hljs-string">of</span> <span class="hljs-string">a</span> <span class="hljs-string">Kubernetes</span><br>                                <span class="hljs-string">Service</span> <span class="hljs-string">to</span> <span class="hljs-string">match.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">namespace:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Namespace</span> <span class="hljs-string">specifies</span> <span class="hljs-string">the</span> <span class="hljs-string">namespace</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span><br>                                <span class="hljs-string">given</span> <span class="hljs-string">Service.</span> <span class="hljs-string">If</span> <span class="hljs-string">left</span> <span class="hljs-string">empty,</span> <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">will</span> <span class="hljs-string">match</span><br>                                <span class="hljs-string">within</span> <span class="hljs-string">this</span> <span class="hljs-string">policy&#x27;s</span> <span class="hljs-string">namespace.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                    <span class="hljs-attr">http:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">HTTP</span> <span class="hljs-string">contains</span> <span class="hljs-string">match</span> <span class="hljs-string">criteria</span> <span class="hljs-string">that</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">HTTP</span><br>                        <span class="hljs-string">requests.</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">methods:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Methods</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                            <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">apply</span> <span class="hljs-string">only</span> <span class="hljs-string">to</span> <span class="hljs-string">HTTP</span> <span class="hljs-string">requests</span> <span class="hljs-string">that</span> <span class="hljs-string">use</span> <span class="hljs-string">one</span> <span class="hljs-string">of</span><br>                            <span class="hljs-string">the</span> <span class="hljs-string">listed</span> <span class="hljs-string">HTTP</span> <span class="hljs-string">Methods</span> <span class="hljs-string">(e.g.</span> <span class="hljs-string">GET,</span> <span class="hljs-string">PUT,</span> <span class="hljs-string">etc.)</span> <span class="hljs-string">Multiple</span><br>                            <span class="hljs-string">methods</span> <span class="hljs-string">are</span> <span class="hljs-string">OR&#x27;d</span> <span class="hljs-string">together.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">paths:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Paths is an optional field that restricts</span><br><span class="hljs-string">                            the rule to apply to HTTP requests that use one of the</span><br><span class="hljs-string">                            listed HTTP Paths. Multiple paths are OR<span class="hljs-char escape_">&#x27;&#x27;</span>d together.</span><br><span class="hljs-string">                            e.g: - exact: /foo - prefix: /bar NOTE: Each entry may</span><br><span class="hljs-string">                            ONLY specify either a `exact` or a `prefix` match. The</span><br><span class="hljs-string">                            validator will check for it.&#x27;</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;HTTPPath specifies an HTTP path to match.</span><br><span class="hljs-string">                              It may be either of the form: exact: &lt;path&gt;: which matches</span><br><span class="hljs-string">                              the path exactly or prefix: &lt;path-prefix&gt;: which matches</span><br><span class="hljs-string">                              the path prefix&#x27;</span><br>                            <span class="hljs-attr">properties:</span><br>                              <span class="hljs-attr">exact:</span><br>                                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                              <span class="hljs-attr">prefix:</span><br>                                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                    <span class="hljs-attr">icmp:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span> <span class="hljs-string">the</span> <span class="hljs-string">rule</span><br>                        <span class="hljs-string">to</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">type</span> <span class="hljs-string">and</span> <span class="hljs-string">code</span> <span class="hljs-string">of</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">traffic.</span>  <span class="hljs-string">This</span><br>                        <span class="hljs-string">should</span> <span class="hljs-string">only</span> <span class="hljs-string">be</span> <span class="hljs-string">specified</span> <span class="hljs-string">if</span> <span class="hljs-string">the</span> <span class="hljs-string">Protocol</span> <span class="hljs-string">field</span> <span class="hljs-string">is</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">&quot;ICMP&quot;</span><br>                        <span class="hljs-string">or</span> <span class="hljs-string">&quot;ICMPv6&quot;</span><span class="hljs-string">.</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">code:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Match</span> <span class="hljs-string">on</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">code.</span>  <span class="hljs-string">If</span> <span class="hljs-string">specified,</span><br>                            <span class="hljs-string">the</span> <span class="hljs-string">Type</span> <span class="hljs-string">value</span> <span class="hljs-string">must</span> <span class="hljs-string">also</span> <span class="hljs-string">be</span> <span class="hljs-string">specified.</span> <span class="hljs-string">This</span> <span class="hljs-string">is</span> <span class="hljs-string">a</span> <span class="hljs-string">technical</span><br>                            <span class="hljs-string">limitation</span> <span class="hljs-string">imposed</span> <span class="hljs-string">by</span> <span class="hljs-string">the</span> <span class="hljs-string">kernel&#x27;s</span> <span class="hljs-string">iptables</span> <span class="hljs-string">firewall,</span><br>                            <span class="hljs-string">which</span> <span class="hljs-string">Calico</span> <span class="hljs-string">uses</span> <span class="hljs-string">to</span> <span class="hljs-string">enforce</span> <span class="hljs-string">the</span> <span class="hljs-string">rule.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                        <span class="hljs-attr">type:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Match</span> <span class="hljs-string">on</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">type.</span>  <span class="hljs-string">For</span> <span class="hljs-string">example</span><br>                            <span class="hljs-string">a</span> <span class="hljs-string">value</span> <span class="hljs-string">of</span> <span class="hljs-number">8</span> <span class="hljs-string">refers</span> <span class="hljs-string">to</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">Echo</span> <span class="hljs-string">Request</span> <span class="hljs-string">(i.e.</span> <span class="hljs-string">pings).</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                    <span class="hljs-attr">ipVersion:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">IPVersion</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span> <span class="hljs-string">the</span><br>                        <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">match</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">IP</span> <span class="hljs-string">version.</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                    <span class="hljs-attr">metadata:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">Metadata</span> <span class="hljs-string">contains</span> <span class="hljs-string">additional</span> <span class="hljs-string">information</span> <span class="hljs-string">for</span> <span class="hljs-string">this</span><br>                        <span class="hljs-string">rule</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">annotations:</span><br>                          <span class="hljs-attr">additionalProperties:</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Annotations</span> <span class="hljs-string">is</span> <span class="hljs-string">a</span> <span class="hljs-string">set</span> <span class="hljs-string">of</span> <span class="hljs-string">key</span> <span class="hljs-string">value</span> <span class="hljs-string">pairs</span> <span class="hljs-string">that</span><br>                            <span class="hljs-string">give</span> <span class="hljs-string">extra</span> <span class="hljs-string">information</span> <span class="hljs-string">about</span> <span class="hljs-string">the</span> <span class="hljs-string">rule</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                    <span class="hljs-attr">notICMP:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">NotICMP</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">field.</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">code:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Match</span> <span class="hljs-string">on</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">code.</span>  <span class="hljs-string">If</span> <span class="hljs-string">specified,</span><br>                            <span class="hljs-string">the</span> <span class="hljs-string">Type</span> <span class="hljs-string">value</span> <span class="hljs-string">must</span> <span class="hljs-string">also</span> <span class="hljs-string">be</span> <span class="hljs-string">specified.</span> <span class="hljs-string">This</span> <span class="hljs-string">is</span> <span class="hljs-string">a</span> <span class="hljs-string">technical</span><br>                            <span class="hljs-string">limitation</span> <span class="hljs-string">imposed</span> <span class="hljs-string">by</span> <span class="hljs-string">the</span> <span class="hljs-string">kernel&#x27;s</span> <span class="hljs-string">iptables</span> <span class="hljs-string">firewall,</span><br>                            <span class="hljs-string">which</span> <span class="hljs-string">Calico</span> <span class="hljs-string">uses</span> <span class="hljs-string">to</span> <span class="hljs-string">enforce</span> <span class="hljs-string">the</span> <span class="hljs-string">rule.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                        <span class="hljs-attr">type:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Match</span> <span class="hljs-string">on</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">type.</span>  <span class="hljs-string">For</span> <span class="hljs-string">example</span><br>                            <span class="hljs-string">a</span> <span class="hljs-string">value</span> <span class="hljs-string">of</span> <span class="hljs-number">8</span> <span class="hljs-string">refers</span> <span class="hljs-string">to</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">Echo</span> <span class="hljs-string">Request</span> <span class="hljs-string">(i.e.</span> <span class="hljs-string">pings).</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                    <span class="hljs-attr">notProtocol:</span><br>                      <span class="hljs-attr">anyOf:</span><br>                      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">NotProtocol</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Protocol</span><br>                        <span class="hljs-string">field.</span><br>                      <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                      <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>                    <span class="hljs-attr">protocol:</span><br>                      <span class="hljs-attr">anyOf:</span><br>                      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Protocol is an optional field that restricts the</span><br><span class="hljs-string">                        rule to only apply to traffic of a specific IP protocol. Required</span><br><span class="hljs-string">                        if any of the EntityRules contain Ports (because ports only</span><br><span class="hljs-string">                        apply to certain protocols). \n Must be one of these string</span><br><span class="hljs-string">                        values: \&quot;TCP\&quot;, \&quot;UDP\&quot;, \&quot;ICMP\&quot;, \&quot;ICMPv6\&quot;, \&quot;SCTP\&quot;,</span><br><span class="hljs-string">                        \&quot;UDPLite\&quot; or an integer in the range 1-255.&quot;</span><br>                      <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                      <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>                    <span class="hljs-attr">source:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">Source</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">match</span> <span class="hljs-string">criteria</span> <span class="hljs-string">that</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span><br>                        <span class="hljs-string">source</span> <span class="hljs-string">entity.</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">namespaceSelector:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;NamespaceSelector is an optional field that</span><br><span class="hljs-string">                            contains a selector expression. Only traffic that originates</span><br><span class="hljs-string">                            from (or terminates at) endpoints within the selected</span><br><span class="hljs-string">                            namespaces will be matched. When both NamespaceSelector</span><br><span class="hljs-string">                            and another selector are defined on the same rule, then</span><br><span class="hljs-string">                            only workload endpoints that are matched by both selectors</span><br><span class="hljs-string">                            will be selected by the rule. \n For NetworkPolicy, an</span><br><span class="hljs-string">                            empty NamespaceSelector implies that the Selector is limited</span><br><span class="hljs-string">                            to selecting only workload endpoints in the same namespace</span><br><span class="hljs-string">                            as the NetworkPolicy. \n For NetworkPolicy, `global()`</span><br><span class="hljs-string">                            NamespaceSelector implies that the Selector is limited</span><br><span class="hljs-string">                            to selecting only GlobalNetworkSet or HostEndpoint. \n</span><br><span class="hljs-string">                            For GlobalNetworkPolicy, an empty NamespaceSelector implies</span><br><span class="hljs-string">                            the Selector applies to workload endpoints across all</span><br><span class="hljs-string">                            namespaces.&quot;</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">nets:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Nets</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span> <span class="hljs-string">the</span><br>                            <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span> <span class="hljs-string">from</span> <span class="hljs-string">(or</span><br>                            <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">IP</span> <span class="hljs-string">addresses</span> <span class="hljs-string">in</span> <span class="hljs-string">any</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">given</span> <span class="hljs-string">subnets.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">notNets:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">NotNets</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Nets</span><br>                            <span class="hljs-string">field.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">notPorts:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">NotPorts</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Ports</span><br>                            <span class="hljs-string">field.</span> <span class="hljs-string">Since</span> <span class="hljs-string">only</span> <span class="hljs-string">some</span> <span class="hljs-string">protocols</span> <span class="hljs-string">have</span> <span class="hljs-string">ports,</span> <span class="hljs-string">if</span> <span class="hljs-string">any</span> <span class="hljs-string">ports</span><br>                            <span class="hljs-string">are</span> <span class="hljs-string">specified</span> <span class="hljs-string">it</span> <span class="hljs-string">requires</span> <span class="hljs-string">the</span> <span class="hljs-string">Protocol</span> <span class="hljs-string">match</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">Rule</span><br>                            <span class="hljs-string">to</span> <span class="hljs-string">be</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">&quot;TCP&quot;</span> <span class="hljs-string">or</span> <span class="hljs-string">&quot;UDP&quot;</span><span class="hljs-string">.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">anyOf:</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                            <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">notSelector:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">NotSelector</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Selector</span><br>                            <span class="hljs-string">field.</span>  <span class="hljs-string">See</span> <span class="hljs-string">Selector</span> <span class="hljs-string">field</span> <span class="hljs-string">for</span> <span class="hljs-string">subtleties</span> <span class="hljs-string">with</span> <span class="hljs-string">negated</span><br>                            <span class="hljs-string">selectors.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">ports:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Ports is an optional field that restricts</span><br><span class="hljs-string">                            the rule to only apply to traffic that has a source (destination)</span><br><span class="hljs-string">                            port that matches one of these ranges/values. This value</span><br><span class="hljs-string">                            is a list of integers or strings that represent ranges</span><br><span class="hljs-string">                            of ports. \n Since only some protocols have ports, if</span><br><span class="hljs-string">                            any ports are specified it requires the Protocol match</span><br><span class="hljs-string">                            in the Rule to be set to \&quot;TCP\&quot; or \&quot;UDP\&quot;.&quot;</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">anyOf:</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                            <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">selector:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Selector is an optional field that contains</span><br><span class="hljs-string">                            a selector expression (see Policy for sample syntax).</span><br><span class="hljs-string">                            \ Only traffic that originates from (terminates at) endpoints</span><br><span class="hljs-string">                            matching the selector will be matched. \n Note that: in</span><br><span class="hljs-string">                            addition to the negated version of the Selector (see NotSelector</span><br><span class="hljs-string">                            below), the selector expression syntax itself supports</span><br><span class="hljs-string">                            negation.  The two types of negation are subtly different.</span><br><span class="hljs-string">                            One negates the set of matched endpoints, the other negates</span><br><span class="hljs-string">                            the whole match: \n \tSelector = \&quot;!has(my_label)\&quot; matches</span><br><span class="hljs-string">                            packets that are from other Calico-controlled \tendpoints</span><br><span class="hljs-string">                            that do not have the label \&quot;my_label\&quot;. \n \tNotSelector</span><br><span class="hljs-string">                            = \&quot;has(my_label)\&quot; matches packets that are not from</span><br><span class="hljs-string">                            Calico-controlled \tendpoints that do have the label \&quot;my_label\&quot;.</span><br><span class="hljs-string">                            \n The effect is that the latter will accept packets from</span><br><span class="hljs-string">                            non-Calico sources whereas the former is limited to packets</span><br><span class="hljs-string">                            from Calico-controlled endpoints.&quot;</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">serviceAccounts:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">ServiceAccounts</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                            <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span> <span class="hljs-string">from</span><br>                            <span class="hljs-string">(or</span> <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">running</span> <span class="hljs-string">as</span> <span class="hljs-string">a</span> <span class="hljs-string">matching</span> <span class="hljs-string">service</span><br>                            <span class="hljs-string">account.</span><br>                          <span class="hljs-attr">properties:</span><br>                            <span class="hljs-attr">names:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Names</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                                <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span><br>                                <span class="hljs-string">from</span> <span class="hljs-string">(or</span> <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">running</span> <span class="hljs-string">as</span> <span class="hljs-string">a</span> <span class="hljs-string">service</span><br>                                <span class="hljs-string">account</span> <span class="hljs-string">whose</span> <span class="hljs-string">name</span> <span class="hljs-string">is</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">list.</span><br>                              <span class="hljs-attr">items:</span><br>                                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                            <span class="hljs-attr">selector:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Selector</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                                <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span><br>                                <span class="hljs-string">from</span> <span class="hljs-string">(or</span> <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">running</span> <span class="hljs-string">as</span> <span class="hljs-string">a</span> <span class="hljs-string">service</span><br>                                <span class="hljs-string">account</span> <span class="hljs-string">that</span> <span class="hljs-string">matches</span> <span class="hljs-string">the</span> <span class="hljs-string">given</span> <span class="hljs-string">label</span> <span class="hljs-string">selector.</span> <span class="hljs-string">If</span><br>                                <span class="hljs-string">both</span> <span class="hljs-string">Names</span> <span class="hljs-string">and</span> <span class="hljs-string">Selector</span> <span class="hljs-string">are</span> <span class="hljs-string">specified</span> <span class="hljs-string">then</span> <span class="hljs-string">they</span> <span class="hljs-string">are</span><br>                                <span class="hljs-string">AND&#x27;ed.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                        <span class="hljs-attr">services:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Services is an optional field that contains</span><br><span class="hljs-string">                            options for matching Kubernetes Services. If specified,</span><br><span class="hljs-string">                            only traffic that originates from or terminates at endpoints</span><br><span class="hljs-string">                            within the selected service(s) will be matched, and only</span><br><span class="hljs-string">                            to/from each endpoint&#x27;s port. \n Services cannot be specified</span><br><span class="hljs-string">                            on the same rule as Selector, NotSelector, NamespaceSelector,</span><br><span class="hljs-string">                            Nets, NotNets or ServiceAccounts. \n Ports and NotPorts</span><br><span class="hljs-string">                            can only be specified with Services on ingress rules.&quot;</span><br>                          <span class="hljs-attr">properties:</span><br>                            <span class="hljs-attr">name:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Name</span> <span class="hljs-string">specifies</span> <span class="hljs-string">the</span> <span class="hljs-string">name</span> <span class="hljs-string">of</span> <span class="hljs-string">a</span> <span class="hljs-string">Kubernetes</span><br>                                <span class="hljs-string">Service</span> <span class="hljs-string">to</span> <span class="hljs-string">match.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">namespace:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Namespace</span> <span class="hljs-string">specifies</span> <span class="hljs-string">the</span> <span class="hljs-string">namespace</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span><br>                                <span class="hljs-string">given</span> <span class="hljs-string">Service.</span> <span class="hljs-string">If</span> <span class="hljs-string">left</span> <span class="hljs-string">empty,</span> <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">will</span> <span class="hljs-string">match</span><br>                                <span class="hljs-string">within</span> <span class="hljs-string">this</span> <span class="hljs-string">policy&#x27;s</span> <span class="hljs-string">namespace.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                  <span class="hljs-attr">required:</span><br>                  <span class="hljs-bullet">-</span> <span class="hljs-string">action</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>              <span class="hljs-attr">ingress:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">The</span> <span class="hljs-string">ordered</span> <span class="hljs-string">set</span> <span class="hljs-string">of</span> <span class="hljs-string">ingress</span> <span class="hljs-string">rules.</span>  <span class="hljs-string">Each</span> <span class="hljs-string">rule</span> <span class="hljs-string">contains</span><br>                  <span class="hljs-string">a</span> <span class="hljs-string">set</span> <span class="hljs-string">of</span> <span class="hljs-string">packet</span> <span class="hljs-string">match</span> <span class="hljs-string">criteria</span> <span class="hljs-string">and</span> <span class="hljs-string">a</span> <span class="hljs-string">corresponding</span> <span class="hljs-string">action</span> <span class="hljs-string">to</span> <span class="hljs-string">apply.</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;A Rule encapsulates a set of match criteria and an</span><br><span class="hljs-string">                    action.  Both selector-based security Policy and security Profiles</span><br><span class="hljs-string">                    reference rules - separated out as a list of rules for both ingress</span><br><span class="hljs-string">                    and egress packet matching. \n Each positive match criteria has</span><br><span class="hljs-string">                    a negated version, prefixed with \&quot;Not\&quot;. All the match criteria</span><br><span class="hljs-string">                    within a rule must be satisfied for a packet to match. A single</span><br><span class="hljs-string">                    rule can contain the positive and negative version of a match</span><br><span class="hljs-string">                    and both must be satisfied for the rule to match.&quot;</span><br>                  <span class="hljs-attr">properties:</span><br>                    <span class="hljs-attr">action:</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                    <span class="hljs-attr">destination:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">Destination</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">match</span> <span class="hljs-string">criteria</span> <span class="hljs-string">that</span> <span class="hljs-string">apply</span><br>                        <span class="hljs-string">to</span> <span class="hljs-string">destination</span> <span class="hljs-string">entity.</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">namespaceSelector:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;NamespaceSelector is an optional field that</span><br><span class="hljs-string">                            contains a selector expression. Only traffic that originates</span><br><span class="hljs-string">                            from (or terminates at) endpoints within the selected</span><br><span class="hljs-string">                            namespaces will be matched. When both NamespaceSelector</span><br><span class="hljs-string">                            and another selector are defined on the same rule, then</span><br><span class="hljs-string">                            only workload endpoints that are matched by both selectors</span><br><span class="hljs-string">                            will be selected by the rule. \n For NetworkPolicy, an</span><br><span class="hljs-string">                            empty NamespaceSelector implies that the Selector is limited</span><br><span class="hljs-string">                            to selecting only workload endpoints in the same namespace</span><br><span class="hljs-string">                            as the NetworkPolicy. \n For NetworkPolicy, `global()`</span><br><span class="hljs-string">                            NamespaceSelector implies that the Selector is limited</span><br><span class="hljs-string">                            to selecting only GlobalNetworkSet or HostEndpoint. \n</span><br><span class="hljs-string">                            For GlobalNetworkPolicy, an empty NamespaceSelector implies</span><br><span class="hljs-string">                            the Selector applies to workload endpoints across all</span><br><span class="hljs-string">                            namespaces.&quot;</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">nets:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Nets</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span> <span class="hljs-string">the</span><br>                            <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span> <span class="hljs-string">from</span> <span class="hljs-string">(or</span><br>                            <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">IP</span> <span class="hljs-string">addresses</span> <span class="hljs-string">in</span> <span class="hljs-string">any</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">given</span> <span class="hljs-string">subnets.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">notNets:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">NotNets</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Nets</span><br>                            <span class="hljs-string">field.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">notPorts:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">NotPorts</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Ports</span><br>                            <span class="hljs-string">field.</span> <span class="hljs-string">Since</span> <span class="hljs-string">only</span> <span class="hljs-string">some</span> <span class="hljs-string">protocols</span> <span class="hljs-string">have</span> <span class="hljs-string">ports,</span> <span class="hljs-string">if</span> <span class="hljs-string">any</span> <span class="hljs-string">ports</span><br>                            <span class="hljs-string">are</span> <span class="hljs-string">specified</span> <span class="hljs-string">it</span> <span class="hljs-string">requires</span> <span class="hljs-string">the</span> <span class="hljs-string">Protocol</span> <span class="hljs-string">match</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">Rule</span><br>                            <span class="hljs-string">to</span> <span class="hljs-string">be</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">&quot;TCP&quot;</span> <span class="hljs-string">or</span> <span class="hljs-string">&quot;UDP&quot;</span><span class="hljs-string">.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">anyOf:</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                            <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">notSelector:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">NotSelector</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Selector</span><br>                            <span class="hljs-string">field.</span>  <span class="hljs-string">See</span> <span class="hljs-string">Selector</span> <span class="hljs-string">field</span> <span class="hljs-string">for</span> <span class="hljs-string">subtleties</span> <span class="hljs-string">with</span> <span class="hljs-string">negated</span><br>                            <span class="hljs-string">selectors.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">ports:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Ports is an optional field that restricts</span><br><span class="hljs-string">                            the rule to only apply to traffic that has a source (destination)</span><br><span class="hljs-string">                            port that matches one of these ranges/values. This value</span><br><span class="hljs-string">                            is a list of integers or strings that represent ranges</span><br><span class="hljs-string">                            of ports. \n Since only some protocols have ports, if</span><br><span class="hljs-string">                            any ports are specified it requires the Protocol match</span><br><span class="hljs-string">                            in the Rule to be set to \&quot;TCP\&quot; or \&quot;UDP\&quot;.&quot;</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">anyOf:</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                            <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">selector:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Selector is an optional field that contains</span><br><span class="hljs-string">                            a selector expression (see Policy for sample syntax).</span><br><span class="hljs-string">                            \ Only traffic that originates from (terminates at) endpoints</span><br><span class="hljs-string">                            matching the selector will be matched. \n Note that: in</span><br><span class="hljs-string">                            addition to the negated version of the Selector (see NotSelector</span><br><span class="hljs-string">                            below), the selector expression syntax itself supports</span><br><span class="hljs-string">                            negation.  The two types of negation are subtly different.</span><br><span class="hljs-string">                            One negates the set of matched endpoints, the other negates</span><br><span class="hljs-string">                            the whole match: \n \tSelector = \&quot;!has(my_label)\&quot; matches</span><br><span class="hljs-string">                            packets that are from other Calico-controlled \tendpoints</span><br><span class="hljs-string">                            that do not have the label \&quot;my_label\&quot;. \n \tNotSelector</span><br><span class="hljs-string">                            = \&quot;has(my_label)\&quot; matches packets that are not from</span><br><span class="hljs-string">                            Calico-controlled \tendpoints that do have the label \&quot;my_label\&quot;.</span><br><span class="hljs-string">                            \n The effect is that the latter will accept packets from</span><br><span class="hljs-string">                            non-Calico sources whereas the former is limited to packets</span><br><span class="hljs-string">                            from Calico-controlled endpoints.&quot;</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">serviceAccounts:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">ServiceAccounts</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                            <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span> <span class="hljs-string">from</span><br>                            <span class="hljs-string">(or</span> <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">running</span> <span class="hljs-string">as</span> <span class="hljs-string">a</span> <span class="hljs-string">matching</span> <span class="hljs-string">service</span><br>                            <span class="hljs-string">account.</span><br>                          <span class="hljs-attr">properties:</span><br>                            <span class="hljs-attr">names:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Names</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                                <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span><br>                                <span class="hljs-string">from</span> <span class="hljs-string">(or</span> <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">running</span> <span class="hljs-string">as</span> <span class="hljs-string">a</span> <span class="hljs-string">service</span><br>                                <span class="hljs-string">account</span> <span class="hljs-string">whose</span> <span class="hljs-string">name</span> <span class="hljs-string">is</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">list.</span><br>                              <span class="hljs-attr">items:</span><br>                                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                            <span class="hljs-attr">selector:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Selector</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                                <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span><br>                                <span class="hljs-string">from</span> <span class="hljs-string">(or</span> <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">running</span> <span class="hljs-string">as</span> <span class="hljs-string">a</span> <span class="hljs-string">service</span><br>                                <span class="hljs-string">account</span> <span class="hljs-string">that</span> <span class="hljs-string">matches</span> <span class="hljs-string">the</span> <span class="hljs-string">given</span> <span class="hljs-string">label</span> <span class="hljs-string">selector.</span> <span class="hljs-string">If</span><br>                                <span class="hljs-string">both</span> <span class="hljs-string">Names</span> <span class="hljs-string">and</span> <span class="hljs-string">Selector</span> <span class="hljs-string">are</span> <span class="hljs-string">specified</span> <span class="hljs-string">then</span> <span class="hljs-string">they</span> <span class="hljs-string">are</span><br>                                <span class="hljs-string">AND&#x27;ed.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                        <span class="hljs-attr">services:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Services is an optional field that contains</span><br><span class="hljs-string">                            options for matching Kubernetes Services. If specified,</span><br><span class="hljs-string">                            only traffic that originates from or terminates at endpoints</span><br><span class="hljs-string">                            within the selected service(s) will be matched, and only</span><br><span class="hljs-string">                            to/from each endpoint&#x27;s port. \n Services cannot be specified</span><br><span class="hljs-string">                            on the same rule as Selector, NotSelector, NamespaceSelector,</span><br><span class="hljs-string">                            Nets, NotNets or ServiceAccounts. \n Ports and NotPorts</span><br><span class="hljs-string">                            can only be specified with Services on ingress rules.&quot;</span><br>                          <span class="hljs-attr">properties:</span><br>                            <span class="hljs-attr">name:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Name</span> <span class="hljs-string">specifies</span> <span class="hljs-string">the</span> <span class="hljs-string">name</span> <span class="hljs-string">of</span> <span class="hljs-string">a</span> <span class="hljs-string">Kubernetes</span><br>                                <span class="hljs-string">Service</span> <span class="hljs-string">to</span> <span class="hljs-string">match.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">namespace:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Namespace</span> <span class="hljs-string">specifies</span> <span class="hljs-string">the</span> <span class="hljs-string">namespace</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span><br>                                <span class="hljs-string">given</span> <span class="hljs-string">Service.</span> <span class="hljs-string">If</span> <span class="hljs-string">left</span> <span class="hljs-string">empty,</span> <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">will</span> <span class="hljs-string">match</span><br>                                <span class="hljs-string">within</span> <span class="hljs-string">this</span> <span class="hljs-string">policy&#x27;s</span> <span class="hljs-string">namespace.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                    <span class="hljs-attr">http:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">HTTP</span> <span class="hljs-string">contains</span> <span class="hljs-string">match</span> <span class="hljs-string">criteria</span> <span class="hljs-string">that</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">HTTP</span><br>                        <span class="hljs-string">requests.</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">methods:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Methods</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                            <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">apply</span> <span class="hljs-string">only</span> <span class="hljs-string">to</span> <span class="hljs-string">HTTP</span> <span class="hljs-string">requests</span> <span class="hljs-string">that</span> <span class="hljs-string">use</span> <span class="hljs-string">one</span> <span class="hljs-string">of</span><br>                            <span class="hljs-string">the</span> <span class="hljs-string">listed</span> <span class="hljs-string">HTTP</span> <span class="hljs-string">Methods</span> <span class="hljs-string">(e.g.</span> <span class="hljs-string">GET,</span> <span class="hljs-string">PUT,</span> <span class="hljs-string">etc.)</span> <span class="hljs-string">Multiple</span><br>                            <span class="hljs-string">methods</span> <span class="hljs-string">are</span> <span class="hljs-string">OR&#x27;d</span> <span class="hljs-string">together.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">paths:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Paths is an optional field that restricts</span><br><span class="hljs-string">                            the rule to apply to HTTP requests that use one of the</span><br><span class="hljs-string">                            listed HTTP Paths. Multiple paths are OR<span class="hljs-char escape_">&#x27;&#x27;</span>d together.</span><br><span class="hljs-string">                            e.g: - exact: /foo - prefix: /bar NOTE: Each entry may</span><br><span class="hljs-string">                            ONLY specify either a `exact` or a `prefix` match. The</span><br><span class="hljs-string">                            validator will check for it.&#x27;</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;HTTPPath specifies an HTTP path to match.</span><br><span class="hljs-string">                              It may be either of the form: exact: &lt;path&gt;: which matches</span><br><span class="hljs-string">                              the path exactly or prefix: &lt;path-prefix&gt;: which matches</span><br><span class="hljs-string">                              the path prefix&#x27;</span><br>                            <span class="hljs-attr">properties:</span><br>                              <span class="hljs-attr">exact:</span><br>                                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                              <span class="hljs-attr">prefix:</span><br>                                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                    <span class="hljs-attr">icmp:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span> <span class="hljs-string">the</span> <span class="hljs-string">rule</span><br>                        <span class="hljs-string">to</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">type</span> <span class="hljs-string">and</span> <span class="hljs-string">code</span> <span class="hljs-string">of</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">traffic.</span>  <span class="hljs-string">This</span><br>                        <span class="hljs-string">should</span> <span class="hljs-string">only</span> <span class="hljs-string">be</span> <span class="hljs-string">specified</span> <span class="hljs-string">if</span> <span class="hljs-string">the</span> <span class="hljs-string">Protocol</span> <span class="hljs-string">field</span> <span class="hljs-string">is</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">&quot;ICMP&quot;</span><br>                        <span class="hljs-string">or</span> <span class="hljs-string">&quot;ICMPv6&quot;</span><span class="hljs-string">.</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">code:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Match</span> <span class="hljs-string">on</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">code.</span>  <span class="hljs-string">If</span> <span class="hljs-string">specified,</span><br>                            <span class="hljs-string">the</span> <span class="hljs-string">Type</span> <span class="hljs-string">value</span> <span class="hljs-string">must</span> <span class="hljs-string">also</span> <span class="hljs-string">be</span> <span class="hljs-string">specified.</span> <span class="hljs-string">This</span> <span class="hljs-string">is</span> <span class="hljs-string">a</span> <span class="hljs-string">technical</span><br>                            <span class="hljs-string">limitation</span> <span class="hljs-string">imposed</span> <span class="hljs-string">by</span> <span class="hljs-string">the</span> <span class="hljs-string">kernel&#x27;s</span> <span class="hljs-string">iptables</span> <span class="hljs-string">firewall,</span><br>                            <span class="hljs-string">which</span> <span class="hljs-string">Calico</span> <span class="hljs-string">uses</span> <span class="hljs-string">to</span> <span class="hljs-string">enforce</span> <span class="hljs-string">the</span> <span class="hljs-string">rule.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                        <span class="hljs-attr">type:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Match</span> <span class="hljs-string">on</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">type.</span>  <span class="hljs-string">For</span> <span class="hljs-string">example</span><br>                            <span class="hljs-string">a</span> <span class="hljs-string">value</span> <span class="hljs-string">of</span> <span class="hljs-number">8</span> <span class="hljs-string">refers</span> <span class="hljs-string">to</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">Echo</span> <span class="hljs-string">Request</span> <span class="hljs-string">(i.e.</span> <span class="hljs-string">pings).</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                    <span class="hljs-attr">ipVersion:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">IPVersion</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span> <span class="hljs-string">the</span><br>                        <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">match</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">IP</span> <span class="hljs-string">version.</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                    <span class="hljs-attr">metadata:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">Metadata</span> <span class="hljs-string">contains</span> <span class="hljs-string">additional</span> <span class="hljs-string">information</span> <span class="hljs-string">for</span> <span class="hljs-string">this</span><br>                        <span class="hljs-string">rule</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">annotations:</span><br>                          <span class="hljs-attr">additionalProperties:</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Annotations</span> <span class="hljs-string">is</span> <span class="hljs-string">a</span> <span class="hljs-string">set</span> <span class="hljs-string">of</span> <span class="hljs-string">key</span> <span class="hljs-string">value</span> <span class="hljs-string">pairs</span> <span class="hljs-string">that</span><br>                            <span class="hljs-string">give</span> <span class="hljs-string">extra</span> <span class="hljs-string">information</span> <span class="hljs-string">about</span> <span class="hljs-string">the</span> <span class="hljs-string">rule</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                    <span class="hljs-attr">notICMP:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">NotICMP</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">field.</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">code:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Match</span> <span class="hljs-string">on</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">code.</span>  <span class="hljs-string">If</span> <span class="hljs-string">specified,</span><br>                            <span class="hljs-string">the</span> <span class="hljs-string">Type</span> <span class="hljs-string">value</span> <span class="hljs-string">must</span> <span class="hljs-string">also</span> <span class="hljs-string">be</span> <span class="hljs-string">specified.</span> <span class="hljs-string">This</span> <span class="hljs-string">is</span> <span class="hljs-string">a</span> <span class="hljs-string">technical</span><br>                            <span class="hljs-string">limitation</span> <span class="hljs-string">imposed</span> <span class="hljs-string">by</span> <span class="hljs-string">the</span> <span class="hljs-string">kernel&#x27;s</span> <span class="hljs-string">iptables</span> <span class="hljs-string">firewall,</span><br>                            <span class="hljs-string">which</span> <span class="hljs-string">Calico</span> <span class="hljs-string">uses</span> <span class="hljs-string">to</span> <span class="hljs-string">enforce</span> <span class="hljs-string">the</span> <span class="hljs-string">rule.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                        <span class="hljs-attr">type:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Match</span> <span class="hljs-string">on</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">type.</span>  <span class="hljs-string">For</span> <span class="hljs-string">example</span><br>                            <span class="hljs-string">a</span> <span class="hljs-string">value</span> <span class="hljs-string">of</span> <span class="hljs-number">8</span> <span class="hljs-string">refers</span> <span class="hljs-string">to</span> <span class="hljs-string">ICMP</span> <span class="hljs-string">Echo</span> <span class="hljs-string">Request</span> <span class="hljs-string">(i.e.</span> <span class="hljs-string">pings).</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                    <span class="hljs-attr">notProtocol:</span><br>                      <span class="hljs-attr">anyOf:</span><br>                      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">NotProtocol</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Protocol</span><br>                        <span class="hljs-string">field.</span><br>                      <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                      <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>                    <span class="hljs-attr">protocol:</span><br>                      <span class="hljs-attr">anyOf:</span><br>                      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                      <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Protocol is an optional field that restricts the</span><br><span class="hljs-string">                        rule to only apply to traffic of a specific IP protocol. Required</span><br><span class="hljs-string">                        if any of the EntityRules contain Ports (because ports only</span><br><span class="hljs-string">                        apply to certain protocols). \n Must be one of these string</span><br><span class="hljs-string">                        values: \&quot;TCP\&quot;, \&quot;UDP\&quot;, \&quot;ICMP\&quot;, \&quot;ICMPv6\&quot;, \&quot;SCTP\&quot;,</span><br><span class="hljs-string">                        \&quot;UDPLite\&quot; or an integer in the range 1-255.&quot;</span><br>                      <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                      <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>                    <span class="hljs-attr">source:</span><br>                      <span class="hljs-attr">description:</span> <span class="hljs-string">Source</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">match</span> <span class="hljs-string">criteria</span> <span class="hljs-string">that</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span><br>                        <span class="hljs-string">source</span> <span class="hljs-string">entity.</span><br>                      <span class="hljs-attr">properties:</span><br>                        <span class="hljs-attr">namespaceSelector:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;NamespaceSelector is an optional field that</span><br><span class="hljs-string">                            contains a selector expression. Only traffic that originates</span><br><span class="hljs-string">                            from (or terminates at) endpoints within the selected</span><br><span class="hljs-string">                            namespaces will be matched. When both NamespaceSelector</span><br><span class="hljs-string">                            and another selector are defined on the same rule, then</span><br><span class="hljs-string">                            only workload endpoints that are matched by both selectors</span><br><span class="hljs-string">                            will be selected by the rule. \n For NetworkPolicy, an</span><br><span class="hljs-string">                            empty NamespaceSelector implies that the Selector is limited</span><br><span class="hljs-string">                            to selecting only workload endpoints in the same namespace</span><br><span class="hljs-string">                            as the NetworkPolicy. \n For NetworkPolicy, `global()`</span><br><span class="hljs-string">                            NamespaceSelector implies that the Selector is limited</span><br><span class="hljs-string">                            to selecting only GlobalNetworkSet or HostEndpoint. \n</span><br><span class="hljs-string">                            For GlobalNetworkPolicy, an empty NamespaceSelector implies</span><br><span class="hljs-string">                            the Selector applies to workload endpoints across all</span><br><span class="hljs-string">                            namespaces.&quot;</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">nets:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">Nets</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span> <span class="hljs-string">the</span><br>                            <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span> <span class="hljs-string">from</span> <span class="hljs-string">(or</span><br>                            <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">IP</span> <span class="hljs-string">addresses</span> <span class="hljs-string">in</span> <span class="hljs-string">any</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">given</span> <span class="hljs-string">subnets.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">notNets:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">NotNets</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Nets</span><br>                            <span class="hljs-string">field.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">notPorts:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">NotPorts</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Ports</span><br>                            <span class="hljs-string">field.</span> <span class="hljs-string">Since</span> <span class="hljs-string">only</span> <span class="hljs-string">some</span> <span class="hljs-string">protocols</span> <span class="hljs-string">have</span> <span class="hljs-string">ports,</span> <span class="hljs-string">if</span> <span class="hljs-string">any</span> <span class="hljs-string">ports</span><br>                            <span class="hljs-string">are</span> <span class="hljs-string">specified</span> <span class="hljs-string">it</span> <span class="hljs-string">requires</span> <span class="hljs-string">the</span> <span class="hljs-string">Protocol</span> <span class="hljs-string">match</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">Rule</span><br>                            <span class="hljs-string">to</span> <span class="hljs-string">be</span> <span class="hljs-string">set</span> <span class="hljs-string">to</span> <span class="hljs-string">&quot;TCP&quot;</span> <span class="hljs-string">or</span> <span class="hljs-string">&quot;UDP&quot;</span><span class="hljs-string">.</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">anyOf:</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                            <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">notSelector:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">NotSelector</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">negated</span> <span class="hljs-string">version</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">Selector</span><br>                            <span class="hljs-string">field.</span>  <span class="hljs-string">See</span> <span class="hljs-string">Selector</span> <span class="hljs-string">field</span> <span class="hljs-string">for</span> <span class="hljs-string">subtleties</span> <span class="hljs-string">with</span> <span class="hljs-string">negated</span><br>                            <span class="hljs-string">selectors.</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">ports:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Ports is an optional field that restricts</span><br><span class="hljs-string">                            the rule to only apply to traffic that has a source (destination)</span><br><span class="hljs-string">                            port that matches one of these ranges/values. This value</span><br><span class="hljs-string">                            is a list of integers or strings that represent ranges</span><br><span class="hljs-string">                            of ports. \n Since only some protocols have ports, if</span><br><span class="hljs-string">                            any ports are specified it requires the Protocol match</span><br><span class="hljs-string">                            in the Rule to be set to \&quot;TCP\&quot; or \&quot;UDP\&quot;.&quot;</span><br>                          <span class="hljs-attr">items:</span><br>                            <span class="hljs-attr">anyOf:</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">integer</span><br>                            <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">pattern:</span> <span class="hljs-string">^.*</span><br>                            <span class="hljs-attr">x-kubernetes-int-or-string:</span> <span class="hljs-literal">true</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                        <span class="hljs-attr">selector:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Selector is an optional field that contains</span><br><span class="hljs-string">                            a selector expression (see Policy for sample syntax).</span><br><span class="hljs-string">                            \ Only traffic that originates from (terminates at) endpoints</span><br><span class="hljs-string">                            matching the selector will be matched. \n Note that: in</span><br><span class="hljs-string">                            addition to the negated version of the Selector (see NotSelector</span><br><span class="hljs-string">                            below), the selector expression syntax itself supports</span><br><span class="hljs-string">                            negation.  The two types of negation are subtly different.</span><br><span class="hljs-string">                            One negates the set of matched endpoints, the other negates</span><br><span class="hljs-string">                            the whole match: \n \tSelector = \&quot;!has(my_label)\&quot; matches</span><br><span class="hljs-string">                            packets that are from other Calico-controlled \tendpoints</span><br><span class="hljs-string">                            that do not have the label \&quot;my_label\&quot;. \n \tNotSelector</span><br><span class="hljs-string">                            = \&quot;has(my_label)\&quot; matches packets that are not from</span><br><span class="hljs-string">                            Calico-controlled \tendpoints that do have the label \&quot;my_label\&quot;.</span><br><span class="hljs-string">                            \n The effect is that the latter will accept packets from</span><br><span class="hljs-string">                            non-Calico sources whereas the former is limited to packets</span><br><span class="hljs-string">                            from Calico-controlled endpoints.&quot;</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                        <span class="hljs-attr">serviceAccounts:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">ServiceAccounts</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                            <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span> <span class="hljs-string">from</span><br>                            <span class="hljs-string">(or</span> <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">running</span> <span class="hljs-string">as</span> <span class="hljs-string">a</span> <span class="hljs-string">matching</span> <span class="hljs-string">service</span><br>                            <span class="hljs-string">account.</span><br>                          <span class="hljs-attr">properties:</span><br>                            <span class="hljs-attr">names:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Names</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                                <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span><br>                                <span class="hljs-string">from</span> <span class="hljs-string">(or</span> <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">running</span> <span class="hljs-string">as</span> <span class="hljs-string">a</span> <span class="hljs-string">service</span><br>                                <span class="hljs-string">account</span> <span class="hljs-string">whose</span> <span class="hljs-string">name</span> <span class="hljs-string">is</span> <span class="hljs-string">in</span> <span class="hljs-string">the</span> <span class="hljs-string">list.</span><br>                              <span class="hljs-attr">items:</span><br>                                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>                            <span class="hljs-attr">selector:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Selector</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">restricts</span><br>                                <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">to</span> <span class="hljs-string">only</span> <span class="hljs-string">apply</span> <span class="hljs-string">to</span> <span class="hljs-string">traffic</span> <span class="hljs-string">that</span> <span class="hljs-string">originates</span><br>                                <span class="hljs-string">from</span> <span class="hljs-string">(or</span> <span class="hljs-string">terminates</span> <span class="hljs-string">at)</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">running</span> <span class="hljs-string">as</span> <span class="hljs-string">a</span> <span class="hljs-string">service</span><br>                                <span class="hljs-string">account</span> <span class="hljs-string">that</span> <span class="hljs-string">matches</span> <span class="hljs-string">the</span> <span class="hljs-string">given</span> <span class="hljs-string">label</span> <span class="hljs-string">selector.</span> <span class="hljs-string">If</span><br>                                <span class="hljs-string">both</span> <span class="hljs-string">Names</span> <span class="hljs-string">and</span> <span class="hljs-string">Selector</span> <span class="hljs-string">are</span> <span class="hljs-string">specified</span> <span class="hljs-string">then</span> <span class="hljs-string">they</span> <span class="hljs-string">are</span><br>                                <span class="hljs-string">AND&#x27;ed.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                        <span class="hljs-attr">services:</span><br>                          <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Services is an optional field that contains</span><br><span class="hljs-string">                            options for matching Kubernetes Services. If specified,</span><br><span class="hljs-string">                            only traffic that originates from or terminates at endpoints</span><br><span class="hljs-string">                            within the selected service(s) will be matched, and only</span><br><span class="hljs-string">                            to/from each endpoint&#x27;s port. \n Services cannot be specified</span><br><span class="hljs-string">                            on the same rule as Selector, NotSelector, NamespaceSelector,</span><br><span class="hljs-string">                            Nets, NotNets or ServiceAccounts. \n Ports and NotPorts</span><br><span class="hljs-string">                            can only be specified with Services on ingress rules.&quot;</span><br>                          <span class="hljs-attr">properties:</span><br>                            <span class="hljs-attr">name:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Name</span> <span class="hljs-string">specifies</span> <span class="hljs-string">the</span> <span class="hljs-string">name</span> <span class="hljs-string">of</span> <span class="hljs-string">a</span> <span class="hljs-string">Kubernetes</span><br>                                <span class="hljs-string">Service</span> <span class="hljs-string">to</span> <span class="hljs-string">match.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                            <span class="hljs-attr">namespace:</span><br>                              <span class="hljs-attr">description:</span> <span class="hljs-string">Namespace</span> <span class="hljs-string">specifies</span> <span class="hljs-string">the</span> <span class="hljs-string">namespace</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span><br>                                <span class="hljs-string">given</span> <span class="hljs-string">Service.</span> <span class="hljs-string">If</span> <span class="hljs-string">left</span> <span class="hljs-string">empty,</span> <span class="hljs-string">the</span> <span class="hljs-string">rule</span> <span class="hljs-string">will</span> <span class="hljs-string">match</span><br>                                <span class="hljs-string">within</span> <span class="hljs-string">this</span> <span class="hljs-string">policy&#x27;s</span> <span class="hljs-string">namespace.</span><br>                              <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                          <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                  <span class="hljs-attr">required:</span><br>                  <span class="hljs-bullet">-</span> <span class="hljs-string">action</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>              <span class="hljs-attr">order:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">Order</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">that</span> <span class="hljs-string">specifies</span> <span class="hljs-string">the</span> <span class="hljs-string">order</span> <span class="hljs-string">in</span><br>                  <span class="hljs-string">which</span> <span class="hljs-string">the</span> <span class="hljs-string">policy</span> <span class="hljs-string">is</span> <span class="hljs-string">applied.</span> <span class="hljs-string">Policies</span> <span class="hljs-string">with</span> <span class="hljs-string">higher</span> <span class="hljs-string">&quot;order&quot;</span> <span class="hljs-string">are</span> <span class="hljs-string">applied</span><br>                  <span class="hljs-string">after</span> <span class="hljs-string">those</span> <span class="hljs-string">with</span> <span class="hljs-string">lower</span> <span class="hljs-string">order.</span>  <span class="hljs-string">If</span> <span class="hljs-string">the</span> <span class="hljs-string">order</span> <span class="hljs-string">is</span> <span class="hljs-string">omitted,</span> <span class="hljs-string">it</span> <span class="hljs-string">may</span> <span class="hljs-string">be</span><br>                  <span class="hljs-string">considered</span> <span class="hljs-string">to</span> <span class="hljs-string">be</span> <span class="hljs-string">&quot;infinite&quot;</span> <span class="hljs-bullet">-</span> <span class="hljs-string">i.e.</span> <span class="hljs-string">the</span> <span class="hljs-string">policy</span> <span class="hljs-string">will</span> <span class="hljs-string">be</span> <span class="hljs-string">applied</span> <span class="hljs-string">last.</span>  <span class="hljs-string">Policies</span><br>                  <span class="hljs-string">with</span> <span class="hljs-string">identical</span> <span class="hljs-string">order</span> <span class="hljs-string">will</span> <span class="hljs-string">be</span> <span class="hljs-string">applied</span> <span class="hljs-string">in</span> <span class="hljs-string">alphanumerical</span> <span class="hljs-string">order</span> <span class="hljs-string">based</span><br>                  <span class="hljs-string">on</span> <span class="hljs-string">the</span> <span class="hljs-string">Policy</span> <span class="hljs-string">&quot;Name&quot;</span><span class="hljs-string">.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">number</span><br>              <span class="hljs-attr">selector:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;The selector is an expression used to pick pick out</span><br><span class="hljs-string">                  the endpoints that the policy should be applied to. \n Selector</span><br><span class="hljs-string">                  expressions follow this syntax: \n \tlabel == \&quot;string_literal\&quot;</span><br><span class="hljs-string">                  \ -&gt;  comparison, e.g. my_label == \&quot;foo bar\&quot; \tlabel != \&quot;string_literal\&quot;</span><br><span class="hljs-string">                  \  -&gt;  not equal; also matches if label is not present \tlabel in</span><br><span class="hljs-string">                  &#123; \&quot;a\&quot;, \&quot;b\&quot;, \&quot;c\&quot;, ... &#125;  -&gt;  true if the value of label X is</span><br><span class="hljs-string">                  one of \&quot;a\&quot;, \&quot;b\&quot;, \&quot;c\&quot; \tlabel not in &#123; \&quot;a\&quot;, \&quot;b\&quot;, \&quot;c\&quot;,</span><br><span class="hljs-string">                  ... &#125;  -&gt;  true if the value of label X is not one of \&quot;a\&quot;, \&quot;b\&quot;,</span><br><span class="hljs-string">                  \&quot;c\&quot; \thas(label_name)  -&gt; True if that label is present \t! expr</span><br><span class="hljs-string">                  -&gt; negation of expr \texpr &amp;&amp; expr  -&gt; Short-circuit and \texpr</span><br><span class="hljs-string">                  || expr  -&gt; Short-circuit or \t( expr ) -&gt; parens for grouping \tall()</span><br><span class="hljs-string">                  or the empty selector -&gt; matches all endpoints. \n Label names are</span><br><span class="hljs-string">                  allowed to contain alphanumerics, -, _ and /. String literals are</span><br><span class="hljs-string">                  more permissive but they do not support escape characters. \n Examples</span><br><span class="hljs-string">                  (with made-up labels): \n \ttype == \&quot;webserver\&quot; &amp;&amp; deployment</span><br><span class="hljs-string">                  == \&quot;prod\&quot; \ttype in &#123;\&quot;frontend\&quot;, \&quot;backend\&quot;&#125; \tdeployment !=</span><br><span class="hljs-string">                  \&quot;dev\&quot; \t! has(label_name)&quot;</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">serviceAccountSelector:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">ServiceAccountSelector</span> <span class="hljs-string">is</span> <span class="hljs-string">an</span> <span class="hljs-string">optional</span> <span class="hljs-string">field</span> <span class="hljs-string">for</span> <span class="hljs-string">an</span> <span class="hljs-string">expression</span><br>                  <span class="hljs-string">used</span> <span class="hljs-string">to</span> <span class="hljs-string">select</span> <span class="hljs-string">a</span> <span class="hljs-string">pod</span> <span class="hljs-string">based</span> <span class="hljs-string">on</span> <span class="hljs-string">service</span> <span class="hljs-string">accounts.</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>              <span class="hljs-attr">types:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Types indicates whether this policy applies to ingress,</span><br><span class="hljs-string">                  or to egress, or to both.  When not explicitly specified (and so</span><br><span class="hljs-string">                  the value on creation is empty or nil), Calico defaults Types according</span><br><span class="hljs-string">                  to what Ingress and Egress are present in the policy.  The default</span><br><span class="hljs-string">                  is: \n - [ PolicyTypeIngress ], if there are no Egress rules (including</span><br><span class="hljs-string">                  the case where there are   also no Ingress rules) \n - [ PolicyTypeEgress</span><br><span class="hljs-string">                  ], if there are Egress rules but no Ingress rules \n - [ PolicyTypeIngress,</span><br><span class="hljs-string">                  PolicyTypeEgress ], if there are both Ingress and Egress rules.</span><br><span class="hljs-string">                  \n When the policy is read back again, Types will always be one</span><br><span class="hljs-string">                  of these values, never empty or nil.&quot;</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">description:</span> <span class="hljs-string">PolicyType</span> <span class="hljs-string">enumerates</span> <span class="hljs-string">the</span> <span class="hljs-string">possible</span> <span class="hljs-string">values</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">PolicySpec</span><br>                    <span class="hljs-string">Types</span> <span class="hljs-string">field.</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>    <span class="hljs-attr">served:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">storage:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">status:</span><br>  <span class="hljs-attr">acceptedNames:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">conditions:</span> []<br>  <span class="hljs-attr">storedVersions:</span> []<br><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/kdd-crds.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apiextensions.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">CustomResourceDefinition</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">networksets.crd.projectcalico.org</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">group:</span> <span class="hljs-string">crd.projectcalico.org</span><br>  <span class="hljs-attr">names:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">NetworkSet</span><br>    <span class="hljs-attr">listKind:</span> <span class="hljs-string">NetworkSetList</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">networksets</span><br>    <span class="hljs-attr">singular:</span> <span class="hljs-string">networkset</span><br>  <span class="hljs-attr">preserveUnknownFields:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">scope:</span> <span class="hljs-string">Namespaced</span><br>  <span class="hljs-attr">versions:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">v1</span><br>    <span class="hljs-attr">schema:</span><br>      <span class="hljs-attr">openAPIV3Schema:</span><br>        <span class="hljs-attr">description:</span> <span class="hljs-string">NetworkSet</span> <span class="hljs-string">is</span> <span class="hljs-string">the</span> <span class="hljs-string">Namespaced-equivalent</span> <span class="hljs-string">of</span> <span class="hljs-string">the</span> <span class="hljs-string">GlobalNetworkSet.</span><br>        <span class="hljs-attr">properties:</span><br>          <span class="hljs-attr">apiVersion:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;APIVersion defines the versioned schema of this representation</span><br><span class="hljs-string">              of an object. Servers should convert recognized schemas to the latest</span><br><span class="hljs-string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">kind:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Kind is a string value representing the REST resource this</span><br><span class="hljs-string">              object represents. Servers may infer this from the endpoint the client</span><br><span class="hljs-string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>          <span class="hljs-attr">metadata:</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>          <span class="hljs-attr">spec:</span><br>            <span class="hljs-attr">description:</span> <span class="hljs-string">NetworkSetSpec</span> <span class="hljs-string">contains</span> <span class="hljs-string">the</span> <span class="hljs-string">specification</span> <span class="hljs-string">for</span> <span class="hljs-string">a</span> <span class="hljs-string">NetworkSet</span><br>              <span class="hljs-string">resource.</span><br>            <span class="hljs-attr">properties:</span><br>              <span class="hljs-attr">nets:</span><br>                <span class="hljs-attr">description:</span> <span class="hljs-string">The</span> <span class="hljs-string">list</span> <span class="hljs-string">of</span> <span class="hljs-string">IP</span> <span class="hljs-string">networks</span> <span class="hljs-string">that</span> <span class="hljs-string">belong</span> <span class="hljs-string">to</span> <span class="hljs-string">this</span> <span class="hljs-string">set.</span><br>                <span class="hljs-attr">items:</span><br>                  <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br>                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br>    <span class="hljs-attr">served:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">storage:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">status:</span><br>  <span class="hljs-attr">acceptedNames:</span><br>    <span class="hljs-attr">kind:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">plural:</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">conditions:</span> []<br>  <span class="hljs-attr">storedVersions:</span> []<br><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/calico-kube-controllers-rbac.yaml</span><br><span class="hljs-comment"># Include a clusterrole for the kube-controllers component,</span><br><span class="hljs-comment"># and bind it to the calico-kube-controllers serviceaccount.</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRole</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">calico-kube-controllers</span><br><span class="hljs-attr">rules:</span><br>  <span class="hljs-comment"># Nodes are watched to monitor for deletions.</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">nodes</span><br>    <span class="hljs-attr">verbs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br>  <span class="hljs-comment"># Pods are watched to check for existence as part of IPAM controller.</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">pods</span><br>    <span class="hljs-attr">verbs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br>  <span class="hljs-comment"># IPAM resources are manipulated in response to node and block updates, as well as periodic triggers.</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;crd.projectcalico.org&quot;</span>]<br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">ipreservations</span><br>    <span class="hljs-attr">verbs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;crd.projectcalico.org&quot;</span>]<br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">blockaffinities</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">ipamblocks</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">ipamhandles</span><br>    <span class="hljs-attr">verbs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">create</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">update</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">delete</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br>  <span class="hljs-comment"># Pools are watched to maintain a mapping of blocks to IP pools.</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;crd.projectcalico.org&quot;</span>]<br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">ippools</span><br>    <span class="hljs-attr">verbs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br>  <span class="hljs-comment"># kube-controllers manages hostendpoints.</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;crd.projectcalico.org&quot;</span>]<br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">hostendpoints</span><br>    <span class="hljs-attr">verbs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">create</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">update</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">delete</span><br>  <span class="hljs-comment"># Needs access to update clusterinformations.</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;crd.projectcalico.org&quot;</span>]<br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">clusterinformations</span><br>    <span class="hljs-attr">verbs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">create</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">update</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br>  <span class="hljs-comment"># KubeControllersConfiguration is where it gets its config</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;crd.projectcalico.org&quot;</span>]<br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">kubecontrollersconfigurations</span><br>    <span class="hljs-attr">verbs:</span><br>      <span class="hljs-comment"># read its own config</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br>      <span class="hljs-comment"># create a default if none exists</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">create</span><br>      <span class="hljs-comment"># update status</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">update</span><br>      <span class="hljs-comment"># watch for changes</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/calico-node-rbac.yaml</span><br><span class="hljs-comment"># Include a clusterrole for the calico-node DaemonSet,</span><br><span class="hljs-comment"># and bind it to the calico-node serviceaccount.</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRole</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">calico-node</span><br><span class="hljs-attr">rules:</span><br>  <span class="hljs-comment"># Used for creating service account tokens to be used by the CNI plugin</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">serviceaccounts/token</span><br>    <span class="hljs-attr">resourceNames:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">calico-node</span><br>    <span class="hljs-attr">verbs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">create</span><br>  <span class="hljs-comment"># The CNI plugin needs to get pods, nodes, and namespaces.</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">pods</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">nodes</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">namespaces</span><br>    <span class="hljs-attr">verbs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br>  <span class="hljs-comment"># EndpointSlices are used for Service-based network policy rule</span><br>  <span class="hljs-comment"># enforcement.</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;discovery.k8s.io&quot;</span>]<br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">endpointslices</span><br>    <span class="hljs-attr">verbs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span> <br>      <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">endpoints</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">services</span><br>    <span class="hljs-attr">verbs:</span><br>      <span class="hljs-comment"># Used to discover service IPs for advertisement.</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>      <span class="hljs-comment"># Used to discover Typhas.</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br>  <span class="hljs-comment"># Pod CIDR auto-detection on kubeadm needs access to config maps.</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">configmaps</span><br>    <span class="hljs-attr">verbs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">nodes/status</span><br>    <span class="hljs-attr">verbs:</span><br>      <span class="hljs-comment"># Needed for clearing NodeNetworkUnavailable flag.</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">patch</span><br>      <span class="hljs-comment"># Calico stores some configuration information in node annotations.</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">update</span><br>  <span class="hljs-comment"># Watch for changes to Kubernetes NetworkPolicies.</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;networking.k8s.io&quot;</span>]<br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">networkpolicies</span><br>    <span class="hljs-attr">verbs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>  <span class="hljs-comment"># Used by Calico for policy information.</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">pods</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">namespaces</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">serviceaccounts</span><br>    <span class="hljs-attr">verbs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br>  <span class="hljs-comment"># The CNI plugin patches pods/status.</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">pods/status</span><br>    <span class="hljs-attr">verbs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">patch</span><br>  <span class="hljs-comment"># Calico monitors various CRDs for config.</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;crd.projectcalico.org&quot;</span>]<br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">globalfelixconfigs</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">felixconfigurations</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">bgppeers</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">globalbgpconfigs</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">bgpconfigurations</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">ippools</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">ipreservations</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">ipamblocks</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">globalnetworkpolicies</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">globalnetworksets</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">networkpolicies</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">networksets</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">clusterinformations</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">hostendpoints</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">blockaffinities</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">caliconodestatuses</span><br>    <span class="hljs-attr">verbs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br>  <span class="hljs-comment"># Calico must create and update some CRDs on startup.</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;crd.projectcalico.org&quot;</span>]<br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">ippools</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">felixconfigurations</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">clusterinformations</span><br>    <span class="hljs-attr">verbs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">create</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">update</span><br>  <span class="hljs-comment"># Calico must update some CRDs.</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [ <span class="hljs-string">&quot;crd.projectcalico.org&quot;</span> ]<br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">caliconodestatuses</span><br>    <span class="hljs-attr">verbs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">update</span><br>  <span class="hljs-comment"># Calico stores some configuration information on the node.</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]<br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">nodes</span><br>    <span class="hljs-attr">verbs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br>  <span class="hljs-comment"># These permissions are only required for upgrade from v2.6, and can</span><br>  <span class="hljs-comment"># be removed after upgrade or on fresh installations.</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;crd.projectcalico.org&quot;</span>]<br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">bgpconfigurations</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">bgppeers</span><br>    <span class="hljs-attr">verbs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">create</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">update</span><br>  <span class="hljs-comment"># These permissions are required for Calico CNI to perform IPAM allocations.</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;crd.projectcalico.org&quot;</span>]<br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">blockaffinities</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">ipamblocks</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">ipamhandles</span><br>    <span class="hljs-attr">verbs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">list</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">create</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">update</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">delete</span><br>  <span class="hljs-comment"># The CNI plugin and calico/node need to be able to create a default</span><br>  <span class="hljs-comment"># IPAMConfiguration</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;crd.projectcalico.org&quot;</span>]<br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">ipamconfigs</span><br>    <span class="hljs-attr">verbs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">create</span><br>  <span class="hljs-comment"># Block affinities must also be watchable by confd for route aggregation.</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;crd.projectcalico.org&quot;</span>]<br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">blockaffinities</span><br>    <span class="hljs-attr">verbs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">watch</span><br>  <span class="hljs-comment"># The Calico IPAM migration needs to get daemonsets. These permissions can be</span><br>  <span class="hljs-comment"># removed if not upgrading from an installation using host-local IPAM.</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span> [<span class="hljs-string">&quot;apps&quot;</span>]<br>    <span class="hljs-attr">resources:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">daemonsets</span><br>    <span class="hljs-attr">verbs:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/calico-kube-controllers-rbac.yaml</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRoleBinding</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">calico-kube-controllers</span><br><span class="hljs-attr">roleRef:</span><br>  <span class="hljs-attr">apiGroup:</span> <span class="hljs-string">rbac.authorization.k8s.io</span><br>  <span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRole</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">calico-kube-controllers</span><br><span class="hljs-attr">subjects:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">calico-kube-controllers</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/calico-node-rbac.yaml</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRoleBinding</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">calico-node</span><br><span class="hljs-attr">roleRef:</span><br>  <span class="hljs-attr">apiGroup:</span> <span class="hljs-string">rbac.authorization.k8s.io</span><br>  <span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRole</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">calico-node</span><br><span class="hljs-attr">subjects:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">calico-node</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/calico-node.yaml</span><br><span class="hljs-comment"># This manifest installs the calico-node container, as well</span><br><span class="hljs-comment"># as the CNI plugins and network config on</span><br><span class="hljs-comment"># each master and worker node in a Kubernetes cluster.</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">DaemonSet</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">calico-node</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">k8s-app:</span> <span class="hljs-string">calico-node</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">k8s-app:</span> <span class="hljs-string">calico-node</span><br>  <span class="hljs-attr">updateStrategy:</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">RollingUpdate</span><br>    <span class="hljs-attr">rollingUpdate:</span><br>      <span class="hljs-attr">maxUnavailable:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">k8s-app:</span> <span class="hljs-string">calico-node</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">nodeSelector:</span><br>        <span class="hljs-attr">kubernetes.io/os:</span> <span class="hljs-string">linux</span><br>      <span class="hljs-attr">hostNetwork:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">tolerations:</span><br>        <span class="hljs-comment"># Make sure calico-node gets scheduled on all nodes.</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">effect:</span> <span class="hljs-string">NoSchedule</span><br>          <span class="hljs-attr">operator:</span> <span class="hljs-string">Exists</span><br>        <span class="hljs-comment"># Mark the pod as a critical add-on for rescheduling.</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">CriticalAddonsOnly</span><br>          <span class="hljs-attr">operator:</span> <span class="hljs-string">Exists</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">effect:</span> <span class="hljs-string">NoExecute</span><br>          <span class="hljs-attr">operator:</span> <span class="hljs-string">Exists</span><br>      <span class="hljs-attr">serviceAccountName:</span> <span class="hljs-string">calico-node</span><br>      <span class="hljs-comment"># Minimize downtime during a rolling upgrade or deletion; tell Kubernetes to do a &quot;force</span><br>      <span class="hljs-comment"># deletion&quot;: https://kubernetes.io/docs/concepts/workloads/pods/pod/#termination-of-pods.</span><br>      <span class="hljs-attr">terminationGracePeriodSeconds:</span> <span class="hljs-number">0</span><br>      <span class="hljs-attr">priorityClassName:</span> <span class="hljs-string">system-node-critical</span><br>      <span class="hljs-attr">initContainers:</span><br>        <span class="hljs-comment"># This container performs upgrade from host-local IPAM to calico-ipam.</span><br>        <span class="hljs-comment"># It can be deleted if this is a fresh installation, or if you have already</span><br>        <span class="hljs-comment"># upgraded to use calico-ipam.</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">upgrade-ipam</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">docker.io/calico/cni:v3.25.0</span><br>          <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>          <span class="hljs-attr">command:</span> [<span class="hljs-string">&quot;/opt/cni/bin/calico-ipam&quot;</span>, <span class="hljs-string">&quot;-upgrade&quot;</span>]<br>          <span class="hljs-attr">envFrom:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">configMapRef:</span><br>              <span class="hljs-comment"># Allow KUBERNETES_SERVICE_HOST and KUBERNETES_SERVICE_PORT to be overridden for eBPF mode.</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">kubernetes-services-endpoint</span><br>              <span class="hljs-attr">optional:</span> <span class="hljs-literal">true</span><br>          <span class="hljs-attr">env:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">KUBERNETES_NODE_NAME</span><br>              <span class="hljs-attr">valueFrom:</span><br>                <span class="hljs-attr">fieldRef:</span><br>                  <span class="hljs-attr">fieldPath:</span> <span class="hljs-string">spec.nodeName</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">CALICO_NETWORKING_BACKEND</span><br>              <span class="hljs-attr">valueFrom:</span><br>                <span class="hljs-attr">configMapKeyRef:</span><br>                  <span class="hljs-attr">name:</span> <span class="hljs-string">calico-config</span><br>                  <span class="hljs-attr">key:</span> <span class="hljs-string">calico_backend</span><br>          <span class="hljs-attr">volumeMounts:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/var/lib/cni/networks</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">host-local-net-dir</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/host/opt/cni/bin</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">cni-bin-dir</span><br>          <span class="hljs-attr">securityContext:</span><br>            <span class="hljs-attr">privileged:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-comment"># This container installs the CNI binaries</span><br>        <span class="hljs-comment"># and CNI network config file on each node.</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">install-cni</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">docker.io/calico/cni:v3.25.0</span><br>          <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>          <span class="hljs-attr">command:</span> [<span class="hljs-string">&quot;/opt/cni/bin/install&quot;</span>]<br>          <span class="hljs-attr">envFrom:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">configMapRef:</span><br>              <span class="hljs-comment"># Allow KUBERNETES_SERVICE_HOST and KUBERNETES_SERVICE_PORT to be overridden for eBPF mode.</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">kubernetes-services-endpoint</span><br>              <span class="hljs-attr">optional:</span> <span class="hljs-literal">true</span><br>          <span class="hljs-attr">env:</span><br>            <span class="hljs-comment"># Name of the CNI config file to create.</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">CNI_CONF_NAME</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;10-calico.conflist&quot;</span><br>            <span class="hljs-comment"># The CNI network config to install on each node.</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">CNI_NETWORK_CONFIG</span><br>              <span class="hljs-attr">valueFrom:</span><br>                <span class="hljs-attr">configMapKeyRef:</span><br>                  <span class="hljs-attr">name:</span> <span class="hljs-string">calico-config</span><br>                  <span class="hljs-attr">key:</span> <span class="hljs-string">cni_network_config</span><br>            <span class="hljs-comment"># Set the hostname based on the k8s node name.</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">KUBERNETES_NODE_NAME</span><br>              <span class="hljs-attr">valueFrom:</span><br>                <span class="hljs-attr">fieldRef:</span><br>                  <span class="hljs-attr">fieldPath:</span> <span class="hljs-string">spec.nodeName</span><br>            <span class="hljs-comment"># CNI MTU Config variable</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">CNI_MTU</span><br>              <span class="hljs-attr">valueFrom:</span><br>                <span class="hljs-attr">configMapKeyRef:</span><br>                  <span class="hljs-attr">name:</span> <span class="hljs-string">calico-config</span><br>                  <span class="hljs-attr">key:</span> <span class="hljs-string">veth_mtu</span><br>            <span class="hljs-comment"># Prevents the container from sleeping forever.</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">SLEEP</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;false&quot;</span><br>          <span class="hljs-attr">volumeMounts:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/host/opt/cni/bin</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">cni-bin-dir</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/host/etc/cni/net.d</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">cni-net-dir</span><br>          <span class="hljs-attr">securityContext:</span><br>            <span class="hljs-attr">privileged:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-comment"># This init container mounts the necessary filesystems needed by the BPF data plane</span><br>        <span class="hljs-comment"># i.e. bpf at /sys/fs/bpf and cgroup2 at /run/calico/cgroup. Calico-node initialisation is executed</span><br>        <span class="hljs-comment"># in best effort fashion, i.e. no failure for errors, to not disrupt pod creation in iptable mode.</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;mount-bpffs&quot;</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">docker.io/calico/node:v3.25.0</span><br>          <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>          <span class="hljs-attr">command:</span> [<span class="hljs-string">&quot;calico-node&quot;</span>, <span class="hljs-string">&quot;-init&quot;</span>, <span class="hljs-string">&quot;-best-effort&quot;</span>]<br>          <span class="hljs-attr">volumeMounts:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/sys/fs</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">sys-fs</span><br>              <span class="hljs-comment"># Bidirectional is required to ensure that the new mount we make at /sys/fs/bpf propagates to the host</span><br>              <span class="hljs-comment"># so that it outlives the init container.</span><br>              <span class="hljs-attr">mountPropagation:</span> <span class="hljs-string">Bidirectional</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/var/run/calico</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">var-run-calico</span><br>              <span class="hljs-comment"># Bidirectional is required to ensure that the new mount we make at /run/calico/cgroup propagates to the host</span><br>              <span class="hljs-comment"># so that it outlives the init container.</span><br>              <span class="hljs-attr">mountPropagation:</span> <span class="hljs-string">Bidirectional</span><br>            <span class="hljs-comment"># Mount /proc/ from host which usually is an init program at /nodeproc. It&#x27;s needed by mountns binary,</span><br>            <span class="hljs-comment"># executed by calico-node, to mount root cgroup2 fs at /run/calico/cgroup to attach CTLB programs correctly.</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/nodeproc</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">nodeproc</span><br>              <span class="hljs-attr">readOnly:</span> <span class="hljs-literal">true</span><br>          <span class="hljs-attr">securityContext:</span><br>            <span class="hljs-attr">privileged:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-comment"># Runs calico-node container on each Kubernetes node. This</span><br>        <span class="hljs-comment"># container programs network policy and routes on each</span><br>        <span class="hljs-comment"># host.</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">calico-node</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">docker.io/calico/node:v3.25.0</span><br>          <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>          <span class="hljs-attr">envFrom:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">configMapRef:</span><br>              <span class="hljs-comment"># Allow KUBERNETES_SERVICE_HOST and KUBERNETES_SERVICE_PORT to be overridden for eBPF mode.</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">kubernetes-services-endpoint</span><br>              <span class="hljs-attr">optional:</span> <span class="hljs-literal">true</span><br>          <span class="hljs-attr">env:</span><br>            <span class="hljs-comment"># Use Kubernetes API as the backing datastore.</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">DATASTORE_TYPE</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;kubernetes&quot;</span><br>            <span class="hljs-comment"># Wait for the datastore.</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">WAIT_FOR_DATASTORE</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;true&quot;</span><br>            <span class="hljs-comment"># Set based on the k8s node name.</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">NODENAME</span><br>              <span class="hljs-attr">valueFrom:</span><br>                <span class="hljs-attr">fieldRef:</span><br>                  <span class="hljs-attr">fieldPath:</span> <span class="hljs-string">spec.nodeName</span><br>            <span class="hljs-comment"># Choose the backend to use.</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">CALICO_NETWORKING_BACKEND</span><br>              <span class="hljs-attr">valueFrom:</span><br>                <span class="hljs-attr">configMapKeyRef:</span><br>                  <span class="hljs-attr">name:</span> <span class="hljs-string">calico-config</span><br>                  <span class="hljs-attr">key:</span> <span class="hljs-string">calico_backend</span><br>            <span class="hljs-comment"># Cluster type to identify the deployment type</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">CLUSTER_TYPE</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;k8s,bgp&quot;</span><br>            <span class="hljs-comment"># Auto-detect the BGP IP address.</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">IP</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;autodetect&quot;</span><br>            <span class="hljs-comment"># Enable IPIP</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">CALICO_IPV4POOL_IPIP</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;Always&quot;</span><br>            <span class="hljs-comment"># Enable or Disable VXLAN on the default IP pool.</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">CALICO_IPV4POOL_VXLAN</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;Never&quot;</span><br>            <span class="hljs-comment"># Enable or Disable VXLAN on the default IPv6 IP pool.</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">CALICO_IPV6POOL_VXLAN</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;Never&quot;</span><br>            <span class="hljs-comment"># Set MTU for tunnel device used if ipip is enabled</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">FELIX_IPINIPMTU</span><br>              <span class="hljs-attr">valueFrom:</span><br>                <span class="hljs-attr">configMapKeyRef:</span><br>                  <span class="hljs-attr">name:</span> <span class="hljs-string">calico-config</span><br>                  <span class="hljs-attr">key:</span> <span class="hljs-string">veth_mtu</span><br>            <span class="hljs-comment"># Set MTU for the VXLAN tunnel device.</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">FELIX_VXLANMTU</span><br>              <span class="hljs-attr">valueFrom:</span><br>                <span class="hljs-attr">configMapKeyRef:</span><br>                  <span class="hljs-attr">name:</span> <span class="hljs-string">calico-config</span><br>                  <span class="hljs-attr">key:</span> <span class="hljs-string">veth_mtu</span><br>            <span class="hljs-comment"># Set MTU for the Wireguard tunnel device.</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">FELIX_WIREGUARDMTU</span><br>              <span class="hljs-attr">valueFrom:</span><br>                <span class="hljs-attr">configMapKeyRef:</span><br>                  <span class="hljs-attr">name:</span> <span class="hljs-string">calico-config</span><br>                  <span class="hljs-attr">key:</span> <span class="hljs-string">veth_mtu</span><br>            <span class="hljs-comment"># The default IPv4 pool to create on startup if none exists. Pod IPs will be</span><br>            <span class="hljs-comment"># chosen from this range. Changing this value after installation will have</span><br>            <span class="hljs-comment"># no effect. This should fall within `--cluster-cidr`.</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">CALICO_IPV4POOL_CIDR</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;10.250.0.0/16&quot;</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">CALICO_IPV4POOL_BLOCK_SIZE</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;24&quot;</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">USE_POD_CIDR</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;true&quot;</span><br>            <span class="hljs-comment"># Disable file logging so `kubectl logs` works.</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">CALICO_DISABLE_FILE_LOGGING</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;true&quot;</span><br>            <span class="hljs-comment"># Set Felix endpoint to host default action to ACCEPT.</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">FELIX_DEFAULTENDPOINTTOHOSTACTION</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;ACCEPT&quot;</span><br>            <span class="hljs-comment"># Disable IPv6 on Kubernetes.</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">FELIX_IPV6SUPPORT</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;false&quot;</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">FELIX_HEALTHENABLED</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;true&quot;</span><br>          <span class="hljs-attr">securityContext:</span><br>            <span class="hljs-attr">privileged:</span> <span class="hljs-literal">true</span><br>          <span class="hljs-attr">resources:</span><br>            <span class="hljs-attr">requests:</span><br>              <span class="hljs-attr">cpu:</span> <span class="hljs-string">250m</span><br>          <span class="hljs-attr">lifecycle:</span><br>            <span class="hljs-attr">preStop:</span><br>              <span class="hljs-attr">exec:</span><br>                <span class="hljs-attr">command:</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">/bin/calico-node</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">-shutdown</span><br>          <span class="hljs-attr">livenessProbe:</span><br>            <span class="hljs-attr">exec:</span><br>              <span class="hljs-attr">command:</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-string">/bin/calico-node</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-string">-felix-live</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-string">-bird-live</span><br>            <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span><br>            <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">10</span><br>            <span class="hljs-attr">failureThreshold:</span> <span class="hljs-number">6</span><br>            <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">10</span><br>          <span class="hljs-attr">readinessProbe:</span><br>            <span class="hljs-attr">exec:</span><br>              <span class="hljs-attr">command:</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-string">/bin/calico-node</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-string">-felix-ready</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-string">-bird-ready</span><br>            <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span><br>            <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">10</span><br>          <span class="hljs-attr">volumeMounts:</span><br>            <span class="hljs-comment"># For maintaining CNI plugin API credentials.</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/host/etc/cni/net.d</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">cni-net-dir</span><br>              <span class="hljs-attr">readOnly:</span> <span class="hljs-literal">false</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/lib/modules</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">lib-modules</span><br>              <span class="hljs-attr">readOnly:</span> <span class="hljs-literal">true</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/run/xtables.lock</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">xtables-lock</span><br>              <span class="hljs-attr">readOnly:</span> <span class="hljs-literal">false</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/var/run/calico</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">var-run-calico</span><br>              <span class="hljs-attr">readOnly:</span> <span class="hljs-literal">false</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/var/lib/calico</span><br>              <span class="hljs-attr">name:</span> <span class="hljs-string">var-lib-calico</span><br>              <span class="hljs-attr">readOnly:</span> <span class="hljs-literal">false</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">policysync</span><br>              <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/var/run/nodeagent</span><br>            <span class="hljs-comment"># For eBPF mode, we need to be able to mount the BPF filesystem at /sys/fs/bpf so we mount in the</span><br>            <span class="hljs-comment"># parent directory.</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">bpffs</span><br>              <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/sys/fs/bpf</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">cni-log-dir</span><br>              <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/var/log/calico/cni</span><br>              <span class="hljs-attr">readOnly:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">volumes:</span><br>        <span class="hljs-comment"># Used by calico-node.</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">lib-modules</span><br>          <span class="hljs-attr">hostPath:</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">/lib/modules</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">var-run-calico</span><br>          <span class="hljs-attr">hostPath:</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">/var/run/calico</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">var-lib-calico</span><br>          <span class="hljs-attr">hostPath:</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">/var/lib/calico</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">xtables-lock</span><br>          <span class="hljs-attr">hostPath:</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">/run/xtables.lock</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">FileOrCreate</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">sys-fs</span><br>          <span class="hljs-attr">hostPath:</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">/sys/fs/</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">DirectoryOrCreate</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">bpffs</span><br>          <span class="hljs-attr">hostPath:</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">/sys/fs/bpf</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">Directory</span><br>        <span class="hljs-comment"># mount /proc at /nodeproc to be used by mount-bpffs initContainer to mount root cgroup2 fs.</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">nodeproc</span><br>          <span class="hljs-attr">hostPath:</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">/proc</span><br>        <span class="hljs-comment"># Used to install CNI.</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">cni-bin-dir</span><br>          <span class="hljs-attr">hostPath:</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">/opt/cni/bin</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">cni-net-dir</span><br>          <span class="hljs-attr">hostPath:</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/cni/net.d</span><br>        <span class="hljs-comment"># Used to access CNI logs.</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">cni-log-dir</span><br>          <span class="hljs-attr">hostPath:</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">/var/log/calico/cni</span><br>        <span class="hljs-comment"># Mount in the directory for host-local IPAM allocations. This is</span><br>        <span class="hljs-comment"># used when upgrading from host-local to calico-ipam, and can be removed</span><br>        <span class="hljs-comment"># if not using the upgrade-ipam init container.</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">host-local-net-dir</span><br>          <span class="hljs-attr">hostPath:</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">/var/lib/cni/networks</span><br>        <span class="hljs-comment"># Used to create per-pod Unix Domain Sockets</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">policysync</span><br>          <span class="hljs-attr">hostPath:</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">DirectoryOrCreate</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">/var/run/nodeagent</span><br><span class="hljs-meta">---</span><br><span class="hljs-comment"># Source: calico/templates/calico-kube-controllers.yaml</span><br><span class="hljs-comment"># See https://github.com/projectcalico/kube-controllers</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">calico-kube-controllers</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">k8s-app:</span> <span class="hljs-string">calico-kube-controllers</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-comment"># The controllers can only have a single active instance.</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">k8s-app:</span> <span class="hljs-string">calico-kube-controllers</span><br>  <span class="hljs-attr">strategy:</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">Recreate</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">calico-kube-controllers</span><br>      <span class="hljs-attr">namespace:</span> <span class="hljs-string">kube-system</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">k8s-app:</span> <span class="hljs-string">calico-kube-controllers</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">nodeSelector:</span><br>        <span class="hljs-attr">kubernetes.io/os:</span> <span class="hljs-string">linux</span><br>      <span class="hljs-attr">tolerations:</span><br>        <span class="hljs-comment"># Mark the pod as a critical add-on for rescheduling.</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">CriticalAddonsOnly</span><br>          <span class="hljs-attr">operator:</span> <span class="hljs-string">Exists</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">node-role.kubernetes.io/master</span><br>          <span class="hljs-attr">effect:</span> <span class="hljs-string">NoSchedule</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">node-role.kubernetes.io/control-plane</span><br>          <span class="hljs-attr">effect:</span> <span class="hljs-string">NoSchedule</span><br>      <span class="hljs-attr">serviceAccountName:</span> <span class="hljs-string">calico-kube-controllers</span><br>      <span class="hljs-attr">priorityClassName:</span> <span class="hljs-string">system-cluster-critical</span><br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">calico-kube-controllers</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-string">docker.io/calico/kube-controllers:v3.25.0</span><br>          <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>          <span class="hljs-attr">env:</span><br>            <span class="hljs-comment"># Choose which controllers to run.</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">ENABLED_CONTROLLERS</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">node</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">DATASTORE_TYPE</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">kubernetes</span><br>          <span class="hljs-attr">livenessProbe:</span><br>            <span class="hljs-attr">exec:</span><br>              <span class="hljs-attr">command:</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-string">/usr/bin/check-status</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-string">-l</span><br>            <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span><br>            <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">10</span><br>            <span class="hljs-attr">failureThreshold:</span> <span class="hljs-number">6</span><br>            <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">10</span><br>          <span class="hljs-attr">readinessProbe:</span><br>            <span class="hljs-attr">exec:</span><br>              <span class="hljs-attr">command:</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-string">/usr/bin/check-status</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-string">-r</span><br>            <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span><br><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:/data/kubernetes/network/calico-for-k8s1.23.17# kubectl create -f calico.yaml <br></code></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹é›†ç¾¤çŠ¶æ€">2.2.12 æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:/data/kubernetes/network/calico-for-k8s1.23.17# kubectl get nodes<br>NAME           STATUS   ROLES                  AGE     VERSION<br>controller01   Ready    control-plane,master   3h56m   v1.23.17<br><br>root@controller01:/data/kubernetes/network/calico-for-k8s1.23.17# kubectl get cs<br>Warning: v1 ComponentStatus is deprecated in v1.19+<br>NAME                 STATUS    MESSAGE                         ERROR<br>scheduler            Healthy   ok                              <br>controller-manager   Healthy   ok                              <br>etcd-0               Healthy   &#123;&quot;health&quot;:&quot;true&quot;,&quot;reason&quot;:&quot;&quot;&#125;  <br><br>root@controller01:/data/kubernetes/network/calico-for-k8s1.23.17# kubectl get pods -A <br>NAMESPACE     NAME                                       READY   STATUS    RESTARTS   AGE<br>kube-system   calico-kube-controllers-6896bb667c-h8hbp   1/1     Running   0          56m<br>kube-system   calico-node-d8v6f                          1/1     Running   0          56m<br>kube-system   coredns-7fc497bbb9-b7rbp                   1/1     Running   0          4h52m<br>kube-system   coredns-7fc497bbb9-nxh8g                   1/1     Running   0          4h52m<br>kube-system   etcd-controller01                          1/1     Running   0          4h52m<br>kube-system   kube-apiserver-controller01                1/1     Running   0          4h52m<br>kube-system   kube-controller-manager-controller01       1/1     Running   0          4h52m<br>kube-system   kube-proxy-gp5s9                           1/1     Running   0          4h52m<br>kube-system   kube-scheduler-controller01                1/1     Running   0          4h52m<br></code></pre></td></tr></table></figure><h2 id="æ·»åŠ èŠ‚ç‚¹">2.3 æ·»åŠ èŠ‚ç‚¹</h2><p>å½“æˆ‘ä»¬ä½¿ç”¨kubeadmåˆå§‹åŒ–ä¸€ä¸ªé›†ç¾¤åï¼Œä¼šç”Ÿæˆä¸€ä¸ªtokenï¼Œç”¨è¿™ä¸ªtokenæ¥æ·»åŠ æ–°çš„èŠ‚ç‚¹è¿›å…¥æ­¤k8sé›†ç¾¤ï¼Œä½†æ­¤tokené»˜è®¤åªæœ‰24Hæœ‰æ•ˆæœŸã€‚</p><p>å¦‚æœè¿˜æ²¡æœ‰è¿‡æœŸï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æ˜¯å¦å­˜åœ¨æœ‰æ•ˆçš„ token å€¼</span><br>root@controller01:~# kubeadm token list<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è·å–token</span><br>root@controller01:~# kubeadm token list <br>TOKEN                     TTL         EXPIRES                USAGES                   DESCRIPTION                                                EXTRA GROUPS<br>4bwou4.h82yx951wezuo08a   23h         2025-02-10T04:14:45Z   authentication,signing   &lt;none&gt;                                                     system:bootstrappers:kubeadm:default-node-token<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è·å–CAè¯ä¹¦ sha256 ç¼–ç  <span class="hljs-built_in">hash</span> å€¼</span><br>root@controller01:~# openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2&gt;/dev/null | openssl dgst -sha256 -hex | sed &#x27;s/^.* //&#x27;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨ä¸Šé¢è¾“å‡ºçš„tokenä¸<span class="hljs-built_in">hash</span> å€¼ï¼Œæ·»åŠ æ–°èŠ‚ç‚¹ï¼ˆåœ¨æ–°èŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼‰</span><br>root@ksp-registry:~# kubeadm join 172.20.0.21:6443 --token 4bwou4.h82yx951wezuo08a  --discovery-token-ca-cert-hash  sha256:78f2d6dbcc9b8aab7b1edfcbd276fc0c70858dd60f1c6e15666020f6c91ca362 <br></code></pre></td></tr></table></figure><p>è¿‡æœŸä¹‹åï¼ˆæ²¡è¿‡æœŸä¹Ÿå¯ä»¥ç«‹åˆ»é‡æ–°ç”Ÿæˆï¼‰å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤é‡æ–°ç”Ÿæˆç›¸å…³tokenä¸æ·»åŠ èŠ‚ç‚¹çš„å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:~# kubeadm token create --print-join-command<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸Šè¿°å‘½ä»¤æ‰§è¡Œåï¼Œä¼šè¾“å‡ºä¸€è¡Œå‘½ä»¤ï¼Œå°†è¿™è¡Œå‘½ä»¤åœ¨æ–°èŠ‚ç‚¹ä¸Šæ‰§è¡Œ</span><br>root@ksp-registry:~# kubeadm join 172.20.0.21:6443 --token alvy7y.kvvw4xomybxj67o6 --discovery-token-ca-cert-hash sha256:78f2d6dbcc9b8aab7b1edfcbd276fc0c70858dd60f1c6e15666020f6c91ca362 <br></code></pre></td></tr></table></figure><hr /><p>ä¸ºæ–°èŠ‚ç‚¹æ‰“æ ‡ç­¾ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:~# kubectl label node ksp-registry node-role.kubernetes.io/worker=&quot;&quot;<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:/opt/cni/bin# kubectl get nodes<br>NAME           STATUS   ROLES                         AGE   VERSION<br>controller01   Ready    control-plane,master,worker   25d   v1.23.17<br>ksp-registry   Ready    worker                        23m   v1.23.17<br></code></pre></td></tr></table></figure><h2 id="å¸è½½é›†ç¾¤">2.4 å¸è½½é›†ç¾¤</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œï¼š</span><br>systemctl stop kubelet<br>systemctl stop etcd<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œï¼š</span><br>kubeadm reset <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œï¼š</span><br>dpkg -l | grep kube | awk &#x27;&#123;print $2&#125;&#x27; | xargs dpkg --purge <br>dpkg -l | grep kube<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œï¼š</span><br>rm -rf $HOME/.kube<br>rm -rf ~/.kube/<br>rm -rf /etc/kubernetes/<br>rm -rf /etc/systemd/system/kubelet.service.d<br>rm -rf /etc/systemd/system/kubelet.service<br>rm -rf /usr/bin/kube*<br>rm -rf /etc/cni<br>rm -rf /opt/cni<br>rm -rf /var/lib/etcd/*<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>k8säº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kubeadm k8s1.23.17</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>DeepSeek-R1-Distill-Llama-70Bå¤§æ¨¡å‹4bité‡åŒ–ç‰ˆéƒ¨ç½²</title>
    <link href="/2025/02/08/DeepSeek-R1-Distill-Llama-70B%E5%A4%A7%E6%A8%A1%E5%9E%8B4bit%E9%87%8F%E5%8C%96%E7%89%88%E9%83%A8%E7%BD%B2/"/>
    <url>/2025/02/08/DeepSeek-R1-Distill-Llama-70B%E5%A4%A7%E6%A8%A1%E5%9E%8B4bit%E9%87%8F%E5%8C%96%E7%89%88%E9%83%A8%E7%BD%B2/</url>
    
    <content type="html"><![CDATA[<h1 id="æ¨¡å‹ä¸‹è½½">æ¨¡å‹ä¸‹è½½</h1><h2 id="deepseek-r1-distill-llama-70b-4bit">DeepSeek-R1-Distill-Llama-70B-4bit</h2><p>æ­¤æ¨¡å‹åœ¨é­”æ­ç½‘ç«™ä¸Šçš„ä¸‹è½½åœ°å€ï¼šhttps://modelscope.cn/models/mlx-community/DeepSeek-R1-Distill-Llama-70B-4bit/files</p><figure><img src="https://s2.loli.net/2025/02/08/UsZFOxlNSyVEnki.png" alt="image-20250208144242151" /><figcaption aria-hidden="true">image-20250208144242151</figcaption></figure><p>å‘½ä»¤è¡Œä¸‹è½½</p><p>è¯·å…ˆé€šè¿‡å¦‚ä¸‹å‘½ä»¤å®‰è£…ModelScope</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> modelscope<br></code></pre></td></tr></table></figure><p>ä¸‹è½½å®Œæ•´æ¨¡å‹repo</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">modelscope</span> download --model mlx-community/DeepSeek-R1-Distill-Llama-<span class="hljs-number">70</span>B-<span class="hljs-number">4</span>bit<br></code></pre></td></tr></table></figure><p>ä¸‹è½½å•ä¸ªæ–‡ä»¶åˆ°æŒ‡å®šæœ¬åœ°æ–‡ä»¶å¤¹ï¼ˆä»¥ä¸‹è½½README.mdåˆ°å½“å‰è·¯å¾„ä¸‹â€œdirâ€ç›®å½•ä¸ºä¾‹ï¼‰</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">modelscope download <span class="hljs-params">--model</span> mlx-community/DeepSeek-R1-Distill-Llama-70B-4bit README.md <span class="hljs-params">--local_dir</span> <span class="hljs-string">./dir</span><br></code></pre></td></tr></table></figure><p>å®Œæ•´çš„ModelScopeå‘½ä»¤è¡Œä¸‹è½½é€‰é¡¹ï¼Œå¯å‚è§<a href="https://www.modelscope.cn/docs/æ¨¡å‹çš„ä¸‹è½½#ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·ä¸‹è½½æ¨¡å‹">å…·ä½“æ–‡æ¡£</a></p><h2 id="deepseek-r1-distill-llama-70b-ggufä¼˜å…ˆå°è¯•">DeepSeek-R1-Distill-Llama-70B-GGUFï¼ˆä¼˜å…ˆå°è¯•ï¼‰</h2><p>DeepSeek-R1-Distill-Llama-70B-GGUFæ¨¡å‹ä¸­æœ‰4Bité‡åŒ–æ¨¡å‹GGUFæ–‡ä»¶ï¼šhttps://www.modelscope.cn/models/lmstudio-community/DeepSeek-R1-Distill-Llama-70B-GGUF/files</p><p>ä¼˜å…ˆå°è¯•ï¼Œæœ‰ç°æˆçš„æ–‡æ¡£å¯ç”¨ï¼š<a href="ttps://cloud.tencent.com/developer/article/2494213">Ollamaå¯¼å…¥ä»é­”æ­ç½‘ç«™ä¸‹è½½çš„å¤§æ¨¡å‹.GGUFæ–‡ä»¶</a>ï¼Œä½†ç›¸å…³GGUFæ–‡ä»¶40å¤šGï¼Œå‡†å¤‡åœ¨2025å¹´2æœˆ8æ—¥ï¼ˆå‘¨å…­ï¼‰æ™šä¸Šä¸‹è½½ï¼Œä¸‹å‘¨ä¸€æ¥ä¸Šç­æ—¶ç»§ç»­åç»­æ“ä½œ</p><h1 id="é­”æ­ä¸huggingfaceæ¨¡å‹å¯¼å…¥åˆ°ollamaä¸­">é­”æ­ä¸huggingfaceæ¨¡å‹å¯¼å…¥åˆ°Ollamaä¸­</h1><p>Ollamaå¯¼å…¥ä»é­”æ­ç½‘ç«™ä¸‹è½½çš„å¤§æ¨¡å‹.GGUFæ–‡ä»¶ï¼šhttps://cloud.tencent.com/developer/article/2494213</p><p>Ollamaå¯¼å…¥å¤§æ¨¡å‹çš„.safatensorsæ–‡ä»¶ï¼šhttp://www.360doc.com/content/24/0919/11/37846289_1134459888.shtml</p><h1 id="æ¨¡å‹éƒ¨ç½²">æ¨¡å‹éƒ¨ç½²</h1><h2 id="é­”æ­.ggufæ–‡ä»¶å¯¼å…¥åˆ°ollamaä¸­">é­”æ­.GGUFæ–‡ä»¶å¯¼å…¥åˆ°Ollamaä¸­</h2><figure><img src="https://s2.loli.net/2025/02/10/56jhDQauU9lw3Tv.png" alt="image-20250210094555761" /><figcaption aria-hidden="true">image-20250210094555761</figcaption></figure><figure><img src="https://s2.loli.net/2025/02/10/YQBPgNIeq32yDsH.png" alt="image-20250210094631455" /><figcaption aria-hidden="true">image-20250210094631455</figcaption></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨é­”æ­ç½‘ç«™ä¸‹è½½4bité‡åŒ–æ¨¡å‹æ–‡ä»¶</span><br>root@controller01:/opt/code_repos/DeepSeek-R1-Distill-Llama-70B-GGUF# modelscope download --model lmstudio-community/DeepSeek-R1-Distill-Llama-70B-GGUF DeepSeek-R1-Distill-Llama-70B-Q4_K_M.gguf --local_dir ./   <br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:/opt/code_repos/DeepSeek-R1-Distill-Llama-70B-GGUF# ollama list<br>NAME                                    ID              SIZE    MODIFIED     <br>deepseek-r1:7b                          0a8c26691023    4.7 GB  4 days ago  <br>deepseek-coder:1.3b                     3ddd2d3fc8d2    776 MB  3 months ago<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†ä»é­”æ­ç½‘ç«™ä¸‹è½½çš„å¤§æ¨¡å‹.GGUFæ–‡ä»¶ å¯¼å…¥åˆ°Ollamaä¸­</span><br>root@controller01:/opt/code_repos/DeepSeek-R1-Distill-Llama-70B-GGUF# ollama create DeepSeek-R1-Distill-Llama-70B-Q4 -f ./DeepSeek-R1-Distill-Llama-70B-Q4_config.txt<br>transferring model data <br>using existing layer sha256:eb01fe3e90c4bd09b12f8d0849adf89a11a38174ecdaf56391267975d53e3bc9 <br>creating new layer sha256:ecf1d3ca1fb53d793cbaac0d1928dfa4cfea479cb9c746a09823ec5875cee90c <br>creating new layer sha256:e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855 <br>using existing layer sha256:f02dd72bb2423204352eabc5637b44d79d17f109fdb510a7c51455892aa2d216 <br>creating new layer sha256:737eec639e0b3d8bf80c36e83f59a9a7c0fa36f5712ee33d4c3d35fc1c195e0b <br>writing manifest <br>success <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯ä»¥çœ‹åˆ°Ollamaä¸­ç®¡ç†çš„å¤§æ¨¡å‹æ–°å¢äº†ä¸€ä¸ªâ€œDeepSeek-R1-Distill-Llama-70B-Q4:latestâ€</span><br>root@controller01:/opt# ollama list<br>NAME                                       ID              SIZE      MODIFIED     <br>DeepSeek-R1-Distill-Llama-70B-Q4:latest    573e09a767b2    42 GB     5 hours ago     <br>deepseek-r1:7b                             0a8c26691023    4.7 GB    4 days ago      <br>deepseek-coder:1.3b                        3ddd2d3fc8d2    776 MB    3 months ago         <br></code></pre></td></tr></table></figure><h2 id="è¿è¡Œæ¨¡å‹">è¿è¡Œæ¨¡å‹</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:/opt# ollama run DeepSeek-R1-Distill-Llama-70B-Q4:latest<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; ä½ æ˜¯è°</span><br>æ‚¨å¥½ï¼æˆ‘æ˜¯ç”±ä¸­å›½çš„æ·±åº¦æ±‚ç´¢ï¼ˆDeepSeekï¼‰å…¬å¸å¼€å‘çš„æ™ºèƒ½åŠ©æ‰‹DeepSeek-R1ã€‚å¦‚æ‚¨æœ‰ä»»ä½•ä»»ä½•é—®é¢˜ï¼Œæˆ‘ä¼šå°½æˆ‘æ‰€èƒ½ä¸ºæ‚¨æä¾›å¸®åŠ©ã€‚<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; è¯·è¯æ˜å‹¾è‚¡å®šç†</span><br>å¥½çš„ï¼Œç”¨æˆ·è®©æˆ‘è¯æ˜å‹¾è‚¡å®šç†ï¼Œä¹Ÿå°±æ˜¯æ¯•è¾¾å“¥æ‹‰æ–¯å®šç†ã€‚æˆ‘éœ€è¦ç”¨æ¸…æ™°çš„æ­¥éª¤æ¥è§£é‡Šã€‚é¦–å…ˆï¼Œæˆ‘å¾—ç¡®è®¤ç”¨æˆ·æ˜¯è°ï¼Œçœ‹èµ·æ¥ä»–å¯èƒ½æ˜¯ä¸ªå­¦ç”Ÿæˆ–è€…å¯¹æ•°å­¦æ„Ÿå…´è¶£çš„äººã€‚ä»–æƒ³è¦çš„æ˜¯ä¸€ä¸ªç»å…¸çš„å‡ ä½•è¯æ˜ï¼Œæ‰€ä»¥æˆ‘åº”è¯¥é€‰æ‹©ä¸€ç§ç›´è§‚ä¸”å®¹æ˜“ç†è§£çš„æ–¹æ³•ã€‚<br><br>è€ƒè™‘åˆ°å‹¾è‚¡å®šç†çš„ä¸åŒè¯æ˜æ–¹å¼ï¼Œæ¯”å¦‚æ¯•è¾¾å“¥æ‹‰æ–¯æœ¬äººçš„é¢ç§¯ç›¸ç­‰æ³•ï¼Œæˆ–è€…ä½¿ç”¨ç›¸ä¼¼ä¸‰è§’å½¢ã€‚æˆ‘è§‰å¾—ç”¨é¢ç§¯ç›¸ç­‰æ¥è¯æ˜å¯èƒ½æ›´ç®€å•æ˜äº†ï¼Œå› ä¸ºå®ƒç›´æ¥åˆ©ç”¨äº†å‡ ä½•å›¾å½¢çš„ç‰¹æ€§ï¼Œå®¹æ˜“è¢«å¤§å¤šæ•°äººç†è§£ã€‚<br><br>æ¥ä¸‹æ¥ï¼Œæˆ‘è¦ä¸€æ­¥æ­¥åˆ†è§£è¿™ä¸ªè¿‡ç¨‹ã€‚é¦–å…ˆç”»ä¸€ä¸ªç›´è§’ä¸‰è§’å½¢ï¼Œç„¶åæ„é€ ä¸€ä¸ªæ­£æ–¹å½¢ï¼Œè¿™æ ·å¯ä»¥æ¯”è¾ƒæ–œè¾¹å’Œä¸¤æ¡ç›´è§’è¾¹æ‰€å¯¹åº”çš„é¢ç§¯ã€‚ç„¶åé€šè¿‡ç§»åŠ¨ä¸¤ä¸ªå°ä¸‰è§’å½¢åˆ°é€‚å½“çš„ä½ç½®ï¼Œå½¢æˆä¸€ä¸ªæ›´å¤§çš„ç›´è§’ä¸‰è§’å½¢ï¼Œä»è€Œå±•ç¤ºå‡ºç­‰å¼aÂ² + bÂ² = cÂ²ã€‚<br><br>åœ¨è§£é‡Šçš„æ—¶å€™ï¼Œæˆ‘è¦ç¡®ä¿æ¯ä¸€æ­¥éƒ½æ¸…æ™°ï¼Œè®©è¯»è€…èƒ½å¤Ÿè·Ÿä¸Šæ€è·¯ã€‚åŒæ—¶ï¼Œä½¿ç”¨å…¬å¼å’Œå›¾ç¤ºå¯èƒ½ä¼šæœ‰å¸®åŠ©ï¼Œä½†å¦‚æœæ²¡æœ‰å›¾ç¤ºï¼Œæ–‡å­—æè¿°ä¹Ÿéœ€è¦è¶³å¤Ÿè¯¦ç»†ã€‚æ­¤å¤–ï¼Œè¿˜åº”è¯¥æåˆ°è¿™ä¸ªå®šç†é€‚ç”¨äºæ‰€æœ‰ç›´è§’ä¸‰è§’å½¢ï¼Œä¸ç®¡è¾¹é•¿æ˜¯ä»€ä¹ˆã€‚<br><br>æ€»çš„æ¥è¯´ï¼Œæˆ‘è¦ç¡®ä¿æˆ‘çš„è§£é‡Šæ—¢å‡†ç¡®åˆæ˜“äºç†è§£ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿè½»æ¾åœ°æŒæ¡å‹¾è‚¡å®šç†çš„è¯æ˜è¿‡ç¨‹ã€‚<br>&lt;/think&gt;<br><br>å¥½çš„ï¼æˆ‘æ¥ä¸ºæ‚¨è¯¦ç»†è®²è§£ä¸€ä¸‹å‹¾è‚¡å®šç†ï¼ˆæ¯•è¾¾å“¥æ‹‰æ–¯å®šç†ï¼‰çš„è¯æ˜è¿‡ç¨‹ã€‚è¿™ä¸ªå®šç†æ˜¯å‡ ä½•å­¦ä¸­çš„ä¸€ä¸ªé‡è¦å®šç†ï¼Œé€‚ç”¨äºæ‰€æœ‰ç›´è§’ä¸‰è§’å½¢ã€‚<br><br>**å‹¾è‚¡å®šç†å†…å®¹ï¼š**<br>åœ¨ä»»ä½•ä¸€ä¸ªç›´è§’ä¸‰è§’å½¢ä¸­ï¼Œä¸¤æ¡ç›´è§’è¾¹çš„å¹³æ–¹å’Œç­‰äºæ–œè¾¹çš„å¹³æ–¹ã€‚ç”¨æ•°å­¦è¡¨è¾¾å¼è¡¨ç¤ºä¸ºï¼š<br>\[ a^2 + b^2 = c^2 \]<br>å…¶ä¸­ï¼Œ\(a\) å’Œ \(b\) æ˜¯ç›´è§’è¾¹çš„é•¿åº¦ï¼Œ\(c\) æ˜¯æ–œè¾¹çš„é•¿åº¦ã€‚<br><br>---<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">## è¯æ˜è¿‡ç¨‹ï¼š</span></span><br><br>1. **ç”»ä¸€ä¸ªç›´è§’ä¸‰è§’å½¢ï¼š**<br>   é¦–å…ˆï¼Œç”»ä¸€ä¸ªç›´è§’ä¸‰è§’å½¢ \(ABC\)ï¼Œå…¶ä¸­ \(âˆ C\) ä¸ºç›´è§’ã€‚è®¾ç›´è§’è¾¹ \(AC = b\)ï¼Œ\(BC = a\)ï¼Œæ–œè¾¹ \(AB = c\)ã€‚<br><br>2. **æ„é€ ä¸æ–œè¾¹ç›¸ç­‰çš„æ­£æ–¹å½¢ï¼š**<br>   åœ¨æ–œè¾¹ \(AB\) çš„å¤–ä¾§æ„é€ ä¸€ä¸ªå¤§æ­£æ–¹å½¢ï¼Œå…¶è¾¹é•¿ä¸º \(c\)ã€‚è¿™æ ·ï¼Œå¤§æ­£æ–¹å½¢çš„ä¸€æ¡è¾¹å°±æ˜¯æ–œè¾¹ \(AB\)ï¼Œå…¶ä½™ä¸¤è¾¹å»¶ä¼¸åˆ°ç›´è§’ä¸‰è§’å½¢çš„å¤–éƒ¨ã€‚<br><br>3. **å°†ç›´è§’ä¸‰è§’å½¢ç§»åŠ¨å¹¶ç»„åˆï¼š**<br>   å°†ç›´è§’ä¸‰è§’å½¢ \(ABC\) æ²¿ç€æ–œè¾¹ \(AB\) ç§»åŠ¨ï¼Œå°†é¡¶ç‚¹ \(C\) æ”¾ç½®åœ¨å¤§æ­£æ–¹å½¢çš„ä¸€ä¸ªè§’è½ã€‚è¿™æ ·ï¼ŒåŸæ¥çš„ä¸¤ä¸ªè¾ƒå°çš„ç›´è§’ä¸‰è§’å½¢ä¼šè¢«é‡æ–°æ’åˆ—ã€‚<br><br>4. **å±•ç¤ºé¢ç§¯ç›¸ç­‰ï¼š**<br>   é€šè¿‡ç§»åŠ¨å’Œç»„åˆï¼Œå¯ä»¥å‘ç°è¿™ä¸¤ä¸ªå°ç›´è§’ä¸‰è§’å½¢æ°å¥½å¡«è¡¥äº†ä¸€ä¸ªè¾¹é•¿ä¸º \(a\) å’Œ \(b\) çš„æ­£æ–¹å½¢ä¸­çš„ç©ºç™½åŒºåŸŸã€‚è¿™æ ·ï¼ŒåŸæ¥çš„å¤§æ­£æ–¹å½¢çš„é¢ç§¯è¢«åˆ†è§£ä¸ºä¸¤éƒ¨åˆ†ï¼š<br>   \[ c^2 = a^2 + b^2 \]<br><br>5. **å¾—å‡ºç»“è®ºï¼š**<br>   é€šè¿‡ä¸Šè¿°å‡ ä½•æ„é€ å’Œé¢ç§¯åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ï¼š<br>   \[ a^2 + b^2 = c^2 \]<br>   è¿™å°±æ˜¯å‹¾è‚¡å®šç†çš„è¯æ˜ã€‚<br><br>---<br><br>**æ€»ç»“ï¼š**<br>è¿™ä¸ªè¯æ˜åˆ©ç”¨äº†å‡ ä½•å›¾å½¢çš„é¢ç§¯ç‰¹æ€§ï¼Œé€šè¿‡å°†ç›´è§’ä¸‰è§’å½¢é‡æ–°æ’åˆ—å¹¶ç»“åˆæ­£æ–¹å½¢çš„é¢ç§¯å…³ç³»ï¼Œæ¸…æ™°åœ°å±•ç¤ºäº†ä¸¤æ¡ç›´è§’è¾¹å¹³æ–¹å’Œç­‰äºæ–œè¾¹å¹³æ–¹çš„å…³ç³»ã€‚å¸Œæœ›è¿™ä¸ªè¿‡ç¨‹èƒ½å¸®åŠ©æ‚¨ç†è§£å‹¾è‚¡å®šç†çš„åŸºæœ¬åŸç†ï¼<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt;</span> <br></code></pre></td></tr></table></figure><h1 id="éƒ¨ç½²openwebui">éƒ¨ç½²openwebui</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹è½½å®¹å™¨é•œåƒ</span><br>docker pull ghcr.io/open-webui/open-webui:v0.5.10<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœæ— æ³•ä¸‹è½½æˆ–ä¸‹è½½é€Ÿåº¦å¤ªæ…¢ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹é•œåƒï¼Œå®ƒä»¬æ˜¯åŒæ­¥çš„</span><br>docker pull swr.cn-north-4.myhuaweicloud.com/ddn-k8s/ghcr.io/open-webui/open-webui:v0.5.10<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯åŠ¨open-webuiå®¹å™¨</span><br>(self-llm) root@controller01:~# docker run --name=open-webui \<br>        --hostname=open-webui \<br>        --user=0:0 \<br>        --volume=open-webui:/app/backend/data \<br>        --workdir=/app/backend \<br>        -p 18080:8080 \<br>        --restart=always \<br>        --log-opt max-size=50m \<br>        --log-opt max-file=5 \<br>        --add-host host.docker.internal:host-gateway \<br>        --runtime=nvidia \<br>        --detach=true \<br>        swr.cn-north-4.myhuaweicloud.com/ddn-k8s/ghcr.io/open-webui/open-webui:v0.5.10 \<br>        bash start.sh<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç­‰å¾…ä¸¤åˆ†é’Ÿç›´åˆ°å…¶çŠ¶æ€å˜ä¸ºhealthy</span><br>(self-llm) root@controller01:~# docker ps -a | grep open-webui<br>7954bc77bdd5   swr.cn-north-4.myhuaweicloud.com/ddn-k8s/ghcr.io/open-webui/open-webui:v0.5.10   &quot;bash start.sh&quot;          6 minutes ago   Up 6 minutes (healthy)           0.0.0.0:18080-&gt;8080/tcp, :::18080-&gt;8080/tcp            open-webui<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥å¦‚ä¸‹URL  http://172.20.0.21:18080/</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç™»å½•å‰éœ€è¦è¿›è¡Œæ³¨å†Œã€‚ç™»å½•å¦‚ä¸‹å›¾</span><br></code></pre></td></tr></table></figure><figure><img src="https://s2.loli.net/2025/02/10/9dbRKocQsCa2yEl.png" alt="image-20250210155610560" /><figcaption aria-hidden="true">image-20250210155610560</figcaption></figure><h1 id="open-webuiä¸­é…ç½®è”ç½‘æœç´¢">open-webuiä¸­é…ç½®è”ç½‘æœç´¢</h1><h2 id="googleå¼€å‘è€…è´¦å·">googleå¼€å‘è€…è´¦å·</h2><p>è®¿é—® https://developers.google.com/custom-search æ³¨å†Œgoogleå¼€å‘è€…è´¦å·ï¼Œå¦‚æœæœ‰Googleè´¦å·å¯ä»¥ç›´æ¥ä¸€é”®æ³¨å†Œ</p><h2 id="å¯ç¼–ç¨‹æœç´¢å¼•æ“">å¯ç¼–ç¨‹æœç´¢å¼•æ“</h2><p>è®¿é—® https://programmablesearchengine.google.com/controlpanel/all å³å¯ç¼–ç¨‹æœç´¢å¼•æ“(pse)æ§åˆ¶é¢æ¿é‡Œæ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰æœç´¢å¼•æ“</p><figure><img src="https://s2.loli.net/2025/02/10/AUtFpL3g4srVl2u.png" alt="image-20250210160450279" /><figcaption aria-hidden="true">image-20250210160450279</figcaption></figure><p>ä¸Šè¿°æœ€å¥½æŒ‡å®šâ€œåœ¨ç‰¹å®šç½‘ç«™æˆ–ç½‘é¡µä¸­æœç´¢â€ï¼Œæ¯”å¦‚æŒ‡å®šwww.baidu.com</p><figure><img src="C:\Users\jiangsanyin\AppData\Roaming\Typora\typora-user-images\image-20250210165144110.png" alt="image-20250210165144110" /><figcaption aria-hidden="true">image-20250210165144110</figcaption></figure><figure><img src="https://s2.loli.net/2025/02/10/1pCsac8uEdX6tNZ.png" alt="image-20250210160533683" /><figcaption aria-hidden="true">image-20250210160533683</figcaption></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">&lt;script async src=&quot;https://cse.google.com/cse.js?cx=b2ab2ea5c987a4eed&quot;&gt;<br>&lt;/script&gt;<br>&lt;div class=&quot;gcse-search&quot;&gt;&lt;/div&gt;<br><br><br>è®°ä½æœç´¢å¼•æ“ IDï¼š<br>b2ab2ea5c987a4eed<br></code></pre></td></tr></table></figure><h2 id="è°·æ­Œå¼€å‘è€…apiå¯†é’¥">è°·æ­Œå¼€å‘è€…apiå¯†é’¥</h2><p>è®¿é—® https://developers.google.com/custom-search/v1/introduction è·å–è°·æ­Œå¼€å‘è€…apiå¯†é’¥ï¼Œéœ€è¦å°†æ­¤å¯†é’¥ä¿å­˜ä¸‹æ¥ã€‚</p><figure><img src="https://s2.loli.net/2025/02/10/DAUBL7lrt6bsXoJ.png" alt="image-20250210160842494" /><figcaption aria-hidden="true">image-20250210160842494</figcaption></figure><figure><img src="https://s2.loli.net/2025/02/10/vKYfV2ir4Jmx5TE.png" alt="image-20250210161054098" /><figcaption aria-hidden="true">image-20250210161054098</figcaption></figure><figure><img src="https://s2.loli.net/2025/02/10/K8dXn95BZQHYaGR.png" alt="image-20250210161230162" /><figcaption aria-hidden="true">image-20250210161230162</figcaption></figure><figure><img src="https://s2.loli.net/2025/02/10/C8wTW2r5XFUpYJK.png" alt="image-20250210161247509" /><figcaption aria-hidden="true">image-20250210161247509</figcaption></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">AIzaSyB3E8VhYwYJDYAdFs68iMJrSbgM1SHaoYc<br></code></pre></td></tr></table></figure><h2 id="open-webuiè®¾ç½®">open-webuiè®¾ç½®</h2><figure><img src="https://s2.loli.net/2025/02/10/xOZw7BMUhpvWCoK.png" alt="image-20250210161537546" /><figcaption aria-hidden="true">image-20250210161537546</figcaption></figure><figure><img src="https://s2.loli.net/2025/02/10/ShtYTe984HBljyw.png" alt="image-20250210163830474" /><figcaption aria-hidden="true">image-20250210163830474</figcaption></figure><h2 id="ä½¿ç”¨è”ç½‘æœç´¢è¿›è¡Œå¯¹è¯">ä½¿ç”¨â€œè”ç½‘æœç´¢â€è¿›è¡Œå¯¹è¯</h2><figure><img src="https://s2.loli.net/2025/02/10/3MeF79wn2G5RBNd.png" alt="image-20250210164015528" /><figcaption aria-hidden="true">image-20250210164015528</figcaption></figure><p>ä½†å›ç­”çš„ç»“æœå¹¶ä¸ä¸€å®šæ­£ç¡®ï¼Œä¸”æœ‰æ—¶å¹¶ä¸èƒ½æ­£å¸¸ä½¿ç”¨</p>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤§æ¨¡å‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kubeflow1.6çš„æ­å»ºçš„ç¤ºä¾‹ä½¿ç”¨</title>
    <link href="/2025/02/07/Kubeflow1.6%E7%9A%84%E6%90%AD%E5%BB%BA%E7%9A%84%E7%A4%BA%E4%BE%8B%E4%BD%BF%E7%94%A8/"/>
    <url>/2025/02/07/Kubeflow1.6%E7%9A%84%E6%90%AD%E5%BB%BA%E7%9A%84%E7%A4%BA%E4%BE%8B%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="1-å®˜æ–¹æ–‡æ¡£"><a href="#1-å®˜æ–¹æ–‡æ¡£" class="headerlink" title="1 å®˜æ–¹æ–‡æ¡£"></a>1 å®˜æ–¹æ–‡æ¡£</h1><p>æ ¹æ®<a href="https://www.kubeflow.org/docs/releases/kubeflow-1.6/">kubeflow1.6å®˜ç½‘å‘è¡Œè®°å½•</a>ï¼Œä¸k8s 1.22é€‚é…çš„kubeflowç‰ˆæœ¬æ˜¯kubeflow-1.6ã€‚å½“å‰æœ€æ–°ç‰ˆæœ¬æ˜¯Kubeflow1.9ï¼Œå®˜æ–¹æ¨èä½¿ç”¨çš„k8sç‰ˆæœ¬æ˜¯1.29ã€‚</p><p>éƒ¨ç½²æ­¥éª¤å‚è€ƒï¼š<a href="https://github.com/kubeflow/manifests/tree/v1.6-branch">éƒ¨ç½²kubeflow1.6çš„å®˜æ–¹æ–‡æ¡£</a></p><p>ä»¥ä¸‹æ“ä½œæ¥è‡ªç¬”è€…åˆšå¼€å§‹æ¥è§¦k8sæ—¶æ‰€åšçš„æ“ä½œï¼Œä½¿ç”¨kubekeyéƒ¨ç½²äº†k8s+kspï¼Œä¸€äº›æ“ä½œä¹Ÿéƒ½ä¾èµ–äºå›¾å½¢åŒ–ç•Œé¢ã€‚ç»è¿‡ä¸€ä¸¤ä¸ªæœˆçš„é¼“æ£ç ”ç©¶æœ€ç»ˆè·‘é€šã€‚</p><h1 id="2-ç¯å¢ƒä¿¡æ¯è§„åˆ’"><a href="#2-ç¯å¢ƒä¿¡æ¯è§„åˆ’" class="headerlink" title="2 ç¯å¢ƒä¿¡æ¯è§„åˆ’"></a>2 ç¯å¢ƒä¿¡æ¯è§„åˆ’</h1><p>æœ¬æ¬¡åŸºäºk8s 1.22.10æ­å»ºkubeflow-1.6ç¯å¢ƒã€‚k8s 1.22.10æ­å»ºåœ¨å¦‚ä¸‹3å°è™šæ‹Ÿæœºä¸Šã€‚</p><table><thead><tr><th>ä¸»æœºå</th><th>æœåŠ¡ï¼ˆç”¨é€”ï¼‰</th><th>IP</th><th>rootç”¨æˆ·å¯†ç </th><th>è§„æ ¼</th><th>ç³»ç»Ÿç›˜</th><th>OS</th></tr></thead><tbody><tr><td>master-1</td><td>master</td><td>10.13.31.60</td><td>cloud@2020</td><td>8c16g</td><td>300G</td><td>Centos7.9</td></tr><tr><td>worker-1</td><td>worker</td><td>10.13.31.61</td><td>cloud@2020</td><td>8c16g</td><td>300G</td><td>Centos7.9</td></tr><tr><td>worker-2</td><td>worker</td><td>10.13.31.62</td><td>cloud@2020</td><td>8c16g</td><td>300G</td><td>Centos7.9</td></tr></tbody></table><h1 id="3-éƒ¨ç½²kubeflow-1-6ç¯å¢ƒ"><a href="#3-éƒ¨ç½²kubeflow-1-6ç¯å¢ƒ" class="headerlink" title="3 éƒ¨ç½²kubeflow 1.6ç¯å¢ƒ"></a>3 éƒ¨ç½²kubeflow 1.6ç¯å¢ƒ</h1><h2 id="3-1-ä¸‹è½½kubeflow-manifests1-6-1"><a href="#3-1-ä¸‹è½½kubeflow-manifests1-6-1" class="headerlink" title="3.1 ä¸‹è½½kubeflow-manifests1.6.1"></a>3.1 ä¸‹è½½kubeflow-manifests1.6.1</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@master01 ~]# mkdir /opt/installPkgs/install-kubeflow1.6<br>[root@master01 ~]# cd /opt/installPkgs/install-kubeflow1.6<br><br>[root@master01 install-kubeflow1.6]# wget https://github.com/kubeflow/manifests/archive/refs/tags/v1.6.1.tar.gz <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è§£å‹</span><br>[root@master01 install-kubeflow1.6]# tar -zxf v1.6.1.tar.gz<br>[root@master01 install-kubeflow1.6]# ll manifests-1.6.1/<br></code></pre></td></tr></table></figure><h2 id="3-2-ä¸‹è½½kustomize3-2-0"><a href="#3-2-ä¸‹è½½kustomize3-2-0" class="headerlink" title="3.2 ä¸‹è½½kustomize3.2.0"></a>3.2 ä¸‹è½½kustomize3.2.0</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@master01 manifests-1.6.1]# cd /opt/installPkgs/install-kubeflow1.6/<br>[root@master01 install-kubeflow1.6]# wget https://github.com/kubernetes-sigs/kustomize/releases/download/kustomize%2Fv5.0.3/kustomize_v5.0.3_linux_amd64.tar.gz<br>[root@master01 install-kubeflow1.6]# tar -zxf kustomize_v5.0.3_linux_amd64.tar.gz<br><br>[root@master01 install-kubeflow1.6]# chmod +x ./kustomize<br>[root@master01 install-kubeflow1.6]# cp -p kustomize /usr/local/bin<br></code></pre></td></tr></table></figure><h2 id="3-3-å°†gcr-ioé•œåƒæ›¿æ¢æˆå›½å†…ä»£ç†é•œåƒ"><a href="#3-3-å°†gcr-ioé•œåƒæ›¿æ¢æˆå›½å†…ä»£ç†é•œåƒ" class="headerlink" title="3.3 å°†gcr.ioé•œåƒæ›¿æ¢æˆå›½å†…ä»£ç†é•œåƒ"></a>3.3 å°†gcr.ioé•œåƒæ›¿æ¢æˆå›½å†…ä»£ç†é•œåƒ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@master01 manifests-1.6.1]# cd /opt/installPkgs/install-kubeflow1.6/manifests-1.6.1/<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ã€å¾ˆé‡è¦ã€‘gcr.ioæ˜¯è°·æ­Œå®˜æ–¹çš„dockeré•œåƒä»“å‚¨ï¼Œè®¿é—®éœ€è¦ç¿»å¢™ã€‚æ›¿æ¢æˆå…¶å¯¹åº”ä»£ç†é•œåƒ</span><br>[root@master01 manifests-1.6.1]# sed -i &quot;s/gcr.io/gcr.dockerproxy.com/g&quot; `grep gcr.io -rl /opt/installPkgs/install-kubeflow1.6/manifests-1.6.1`<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä»¥ä¸‹åˆ†æ­¥å®‰è£…ï¼Œéƒ½æ˜¯åœ¨ä»¥ä¸‹ç›®å½•æ‰§è¡Œå‘½ä»¤ï¼šâ€œ/opt/installPkgs/install-kubeflow1.6/manifests-1.6.1/â€</span><br></code></pre></td></tr></table></figure><h2 id="3-4-æ­£å¼éƒ¨ç½²"><a href="#3-4-æ­£å¼éƒ¨ç½²" class="headerlink" title="3.4 æ­£å¼éƒ¨ç½²"></a>3.4 æ­£å¼éƒ¨ç½²</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸€é”®å¼å®‰è£…ã€å®˜æ–¹ç»„ä»¶ (appsä¸‹) ä¸æ‰€æœ‰å…¬å…±æœåŠ¡ (commonä¸‹)ã€‘</span><br>[root@master01 manifests-1.6.1]# while ! kustomize build example | kubectl apply -f -; do echo &quot;Retrying to apply resources&quot;; sleep 10; done<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##æ‰§è¡Œå®Œæˆåï¼Œå¤§æ¦‚éœ€è¦ä¸€ä¸ªå°æ—¶çš„æ—¶é—´ï¼ˆç¬”è€…çš„æƒ…å†µæ˜¯è¿™æ ·ï¼‰æ¥æ‹‰å–ç›¸å…³é•œåƒå¹¶å¯åŠ¨æ‰€æœ‰çš„pod</span></span><br></code></pre></td></tr></table></figure><h2 id="3-5-å¼€å¯httpsç™»å½•kubeflow-UI"><a href="#3-5-å¼€å¯httpsç™»å½•kubeflow-UI" class="headerlink" title="3.5 å¼€å¯httpsç™»å½•kubeflow UI"></a>3.5 å¼€å¯httpsç™»å½•kubeflow UI</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å‚è€ƒæ–‡ç« ï¼šhttps://github.com/kubeflow/kubeflow/issues/5803</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> /opt/installPkgs/install-kubeflow/problem-cloud-not-found-CSRF-cookie</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> /opt/installPkgs/install-kubeflow/problem-cloud-not-found-CSRF-cookie</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é¦–é€‰æ£€æŸ¥å½“å‰k8sé›†ç¾¤ä¸­æ˜¯å¦å­˜åœ¨åä¸ºâ€œkubeflow-self-signing-issuerâ€çš„clusterissuersã€‚</span><br>kubectl get clusterissuers -A<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/07/yJGX8uKLNHPOz7e.png" alt="image-20250207094358148"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœä¸å­˜åœ¨çš„è¯ï¼Œåé¢åˆ›å»ºçš„certificateçš„ç±»å‹å°†ä¼šæ˜¯â€œOpaqueâ€ä¸”åå­—åé¢ä¼šåŠ ä¸€ä¸²éšæœºå­—ç¬¦ä¸²</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/07/Orah4MtfAdDN5mo.png" alt="image-20250207094434773"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœä¸å­˜åœ¨åä¸ºâ€œkubeflow-self-signing-issuerâ€çš„clusterissuersï¼Œåˆ™æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºï¼ˆå…¶ä¸­manifests-1.6.1å³ä¸ºkubeflowå®‰è£…æ–‡ä»¶ç›®å½•ï¼‰</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">kubectl apply -f manifests-1.6.1/common/cert-manager/kubeflow-issuer/base/cluster-issuer.yaml</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/07/oXmdZe3fTwIuWYz.png" alt="image-20250207094530311"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶gateways-issuer2.yamlã€kf-istio-resources2.yaml</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cat</span> &gt; gateways-issuer2.yaml &lt;&lt;<span class="hljs-string">EOF</span></span><br>apiVersion: cert-manager.io/v1alpha2<br>kind: Certificate<br>metadata:<br>  name: kubeflow-ingressgateway-certs<br>  namespace: istio-system<br>spec:<br>  secretName: kubeflow-ingressgateway-certs<br>  issuerRef:<br>    kind: ClusterIssuer<br>    name: kubeflow-self-signing-issuer<br>  commonName: istio-ingressgateway.istio-system.svc<br>EOF<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-string">cat &gt; kf-istio-resources2.yaml &lt;&lt;EOF</span></span><br>apiVersion: networking.istio.io/v1alpha3<br>kind: Gateway<br>metadata:<br>  name: kubeflow-gateway<br>  namespace: kubeflow<br>spec:<br>  selector:<br>    istio: ingressgateway<br>  servers:<br>  - hosts:<br>    - &quot;*&quot;<br>    port:<br>      name: http<br>      number: 80<br>      protocol: HTTP<br>    # Upgrade HTTP to HTTPS<br>    # tls:<br>    #   httpsRedirect: true<br>  - hosts:<br>    - &quot;*&quot;<br>    port:<br>      name: https<br>      number: 443<br>      protocol: HTTPS<br>    tls:<br>      mode: SIMPLE<br>      credentialName: kubeflow-ingressgateway-certs<br>EOF<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åº”ç”¨ä¸Šè¿°ä¸¤ä¸ªæ–‡ä»¶</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">kubectl apply -f gateways-issuer2.yaml</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">kubectl apply -f kf-istio-resources2.yaml</span><br></code></pre></td></tr></table></figure><h2 id="3-6-è·å–kubeflow-dashboardåœ°å€"><a href="#3-6-è·å–kubeflow-dashboardåœ°å€" class="headerlink" title="3.6 è·å–kubeflow dashboardåœ°å€"></a>3.6 è·å–kubeflow dashboardåœ°å€</h2><p>ä»¥ä¸‹ä¸¤ç§æ–¹æ³•é€‰å–å…¶ä¸€</p><h3 id="3-6-1-ä»kubesphereä¸­è·å–"><a href="#3-6-1-ä»kubesphereä¸­è·å–" class="headerlink" title="3.6.1 ä»kubesphereä¸­è·å–"></a>3.6.1 ä»kubesphereä¸­è·å–</h3><p><img src="https://s2.loli.net/2025/02/07/4GwkivJnb9V8LR1.png" alt="image-20250207094921952"></p><p><img src="https://s2.loli.net/2025/02/07/xomaGyYlOtJvZRI.png" alt="image-20250207094932005"></p><p><img src="https://s2.loli.net/2025/02/07/ZQ7jhXO3kxsiKUS.png" alt="image-20250207094949498"></p><p><img src="https://s2.loli.net/2025/02/07/dY9HtIRSDkwQhK5.png" alt="image-20250207095007191"></p><h3 id="3-6-2-ä»å‘½ä»¤è¡Œè·å–"><a href="#3-6-2-ä»å‘½ä»¤è¡Œè·å–" class="headerlink" title="3.6.2 ä»å‘½ä»¤è¡Œè·å–"></a>3.6.2 ä»å‘½ä»¤è¡Œè·å–</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl -n istio-system get svc | grep istio-Ingressgateway<br></code></pre></td></tr></table></figure><h2 id="3-7-ç™»å½•kubeflow-dashboard"><a href="#3-7-ç™»å½•kubeflow-dashboard" class="headerlink" title="3.7 ç™»å½•kubeflow dashboard"></a>3.7 ç™»å½•kubeflow dashboard</h2><p>kubeflow1.6çš„webç•Œé¢ç™»å½•ä¿¡æ¯ï¼š</p><ul><li>é»˜è®¤ç”¨æˆ·åï¼š<a href="mailto:&#117;&#115;&#x65;&#x72;&#x40;&#101;&#120;&#x61;&#109;&#112;&#x6c;&#101;&#x2e;&#x63;&#111;&#109;">user@example.com</a></li><li>é»˜è®¤å¯†ç ï¼š12341234</li></ul><h2 id="3-8-minio-serviceé…ç½®"><a href="#3-8-minio-serviceé…ç½®" class="headerlink" title="3.8 minio-serviceé…ç½®"></a>3.8 minio-serviceé…ç½®</h2><p><img src="https://s2.loli.net/2025/02/07/yjJGQx2pe5nhRgL.png" alt="image-20250207095305437"></p><p><img src="https://s2.loli.net/2025/02/07/dHhM4QWfxA2gRbq.png" alt="image-20250207095323082"></p><p><img src="https://s2.loli.net/2025/02/07/Tn2j6hN8JGO14g9.png" alt="image-20250207095336459"></p><p>é»˜è®¤ç”¨æˆ·åä¸å¯†ç ï¼š </p><ul><li>accessKey: minio</li><li>secretKey: minio123</li></ul><h1 id="4-Tensorflowç¤ºä¾‹"><a href="#4-Tensorflowç¤ºä¾‹" class="headerlink" title="4 Tensorflowç¤ºä¾‹"></a>4 Tensorflowç¤ºä¾‹</h1><p>kubeflowå®˜æ–¹æä¾›çš„ã€åœ¨kubeflowä½¿ç”¨æµæ°´çº¿æ‰§è¡Œtensorflowæœºå™¨å­¦ä¹ ä»»åŠ¡çš„ä¾‹å­ï¼š</p><p><a href="https://github.com/kubeflow/pipelines/blob/master/samples/contrib/kubeflow-e2e-mnist/kubeflow-e2e-mnist.ipynb">https://github.com/kubeflow/pipelines/blob/master/samples/contrib/kubeflow-e2e-mnist/kubeflow-e2e-mnist.ipynb</a></p><h1 id="5-Pytorchç¤ºä¾‹"><a href="#5-Pytorchç¤ºä¾‹" class="headerlink" title="5 Pytorchç¤ºä¾‹"></a>5 Pytorchç¤ºä¾‹</h1><h2 id="5-1-ç¤ºä¾‹1"><a href="#5-1-ç¤ºä¾‹1" class="headerlink" title="5.1 ç¤ºä¾‹1"></a>5.1 ç¤ºä¾‹1</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ç¤ºä¾‹ä»£ç ï¼š</span><br>https://github.com/kubeflow/pipelines/tree/master/samples/contrib/pytorch-samples<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å…¨æŒ‰å®˜æ–¹æ–‡æ¡£æ“ä½œä¼šæŠ¥é”™ï¼Œæ‰§è¡Œæ­¤ç¤ºä¾‹è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ï¼ˆk8sé›†ç¾¤å†…æ‰§è¡Œï¼‰Add Minio secret <span class="hljs-keyword">for</span> KServe</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> -p /opt/installPkgs/install-kubeflow/Document_test/Components/Training_Operators/PyTorch-Training-PyTorchJob/pytorch-samples-from-kubeflow_pipeline</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">touch</span> minio-secret.yaml</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">minio-secret.yamlæ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cat</span> minio-secret.yaml</span><br>apiVersion: v1<br>kind: Secret<br>metadata:<br>  name: mysecret<br>  annotations:<br>     serving.kserve.io/s3-endpoint: minio-service.kubeflow:9000<br>     serving.kserve.io/s3-usehttps: &quot;0&quot;<br>     serving.kserve.io/s3-region: &quot;minio&quot;<br>     serving.kserve.io/s3-useanoncredential: &quot;false&quot;<br>     serving.kubeflow.org/s3-endpoint: minio-service.kubeflow:9000<br>     serving.kubeflow.org/s3-region: minio<br>     serving.kubeflow.org/s3-useanoncredential: &quot;false&quot;<br>     serving.kubeflow.org/s3-usehttps: &quot;0&quot;<br>type: Opaque<br>data:<br>  AWS_ACCESS_KEY_ID: bWluaW8=<br>  AWS_SECRET_ACCESS_KEY: bWluaW8xMjM=<br>---<br>apiVersion: v1<br>kind: ServiceAccount<br>metadata:<br>  name: sa<br>secrets:<br>  - name: mysecret<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">Run the following <span class="hljs-built_in">command</span> to <span class="hljs-built_in">set</span> the secrets</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">kubectl apply -f minio-secret.yaml -n kubeflow-user-example-com</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">Run the following <span class="hljs-built_in">command</span> to <span class="hljs-built_in">disable</span> sidecar injection $ kubectl label namespace kubeflow-user-example-com istio-injection=disabled --overwrite</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é€šè¿‡kubeflow UIï¼ˆä»¥ä¸‹kubeflowç¯å¢ƒåº”è¯¥æ˜¯å¦å¤–ä¸€ä¸ªï¼Œæ‰€ä»¥ç›¸å…³ç«¯å£å·ä¸ä¸€è‡´ã€‚å½“æ—¶è®°å½•å­¦ä¹ ç¬”è®°æ—¶æ²¡æ³¨æ„å‰åæ–‡ä¸€è‡´ï¼‰åˆ›å»ºnotebookï¼Œä½¿ç”¨çš„é•œåƒå¦‚ä¸‹ã€‚ç„¶åconnect</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/07/IYeZFm6qxAcHrw3.png" alt="image-20250207095725081"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨æ‰“å¼€çš„JupterLabçª—å£ä¸­ï¼Œæ‰“å¼€ä¸€ä¸ª Terminalä¼šè¯çª—å£</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/07/IyMDaCif3G9YpBN.png" alt="image-20250207095753536"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹è½½ç¤ºä¾‹æ‰€åœ¨çš„gitä»£ç åº“</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git <span class="hljs-built_in">clone</span> https://github.com/kubeflow/pipelines.git</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/07/2EUwRQBXPytIkMq.png" alt="image-20250207095924924"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨å¦‚ä¸‹é“¾æ¥ä¸­ä¸‹è½½â€œEditThisCookieâ€ chromeæ’ä»¶çš„å®‰è£…æ–‡ä»¶ï¼Œå¹¶å®‰è£…åˆ°googleæµè§ˆå™¨ä¸­</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">https://chrome.zzzmh.cn/info/fngmhnnpilhplaeedifhccceomclgfbg</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†kubeflow-pipelines-v2/samples/contrib/pytorch-samples/Pipeline-Cifar10.ipynbæ–‡ä»¶å¤åˆ¶ä¸€ä»½ï¼Œæ“ä½œå¤åˆ¶å¾—åˆ°çš„æ–‡ä»¶</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/07/IPbfARqBhZp2DGU.png" alt="image-20250207100006254"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å› ä¸ºæˆ‘å¤åˆ¶äº†ä¸¤æ¬¡ï¼Œæˆ‘ç°åœ¨ç¼–è¾‘å¹¶æ‰§è¡ŒPipeline-Cifar10-Copy2.ipynb</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…kfp==1.8.12è¿™ä¸ªpython3åº“</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/07/J7tF5WyOPouAjvz.png" alt="image-20250207100038272"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨â€œEditThisCookieâ€ chromeæ’ä»¶è·å–https://172.24.0.31:30706/è¿™ä¸ªç½‘ç«™ä¿å­˜çš„cookieï¼Œè·å–å…¶ä¸­çš„authservice_sessionè¿™ä¸ªkeyå¯¹åº”çš„valueå€¼ï¼Œå°†valueå€¼ä¿å­˜åˆ°ç¤ºä¾‹ä¸­çš„AUTHå˜é‡ä¸­ï¼š</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/07/bftCycL6s5Wl49j.png" alt="image-20250207100136937"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ï¼ˆkubesphereä¸­æ“ä½œï¼‰å°†å®¹å™¨å†…çš„minioæœåŠ¡ç«¯å£æš´éœ²å‡ºæ¥</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/07/2thxQNaKeydBmDA.png" alt="image-20250207100309327"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ›¿æ¢MINIO_ENDPOINTã€‚TENSORBOARD_IMAGEä¹Ÿå»ºè®®æ›¿æ¢</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/07/y5vS4OwTGPkUnil.png" alt="image-20250207100344529"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">~/kubeflow-pipelines-v2/samples/contrib/pytorch-samples/utils/generate_templates.pyï¼Œéœ€è¦ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶å¦‚ä¸‹ä¸¤ä¸ªå˜é‡ï¼Œå¦åˆ™æ‰§è¡ŒæŠ¥é”™ä¸”ä¸èƒ½å®ç°æ—¢å®šåŠŸèƒ½</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/07/QS4W8xrFGHEPVYe.png" alt="image-20250207100408891"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨ptl_argså˜é‡çš„å€¼</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/07/st7gof8pPFa1j4E.png" alt="image-20250207100441336"></p><h2 id="5-2-ç¤ºä¾‹2"><a href="#5-2-ç¤ºä¾‹2" class="headerlink" title="5.2 ç¤ºä¾‹2"></a>5.2 ç¤ºä¾‹2</h2><p>æ­¤ç¤ºä¾‹æ¥è‡ª<a href="https://github.com/kubeflow/pipelines/blob/master/samples/contrib/pytorch-samples/Pipeline-Bert.ipynb">kubeflowå®˜æ–¹ç¤ºä¾‹pytorch-samples</a></p><p>bertæœºå™¨å­¦ä¹ åŸºç¡€çŸ¥è¯†ï¼š<a href="https://helloai.blog.csdn.net/article/details/120211601">ã€ç†è®ºç¯‡ã€‘æ˜¯æ—¶å€™å½»åº•å¼„æ‡‚BERTæ¨¡å‹äº†</a> ã€ <a href="https://blog.csdn.net/yjw123456/article/details/120232707">ã€å®æˆ˜ç¯‡ã€‘æ˜¯æ—¶å€™å½»åº•å¼„æ‡‚BERTæ¨¡å‹äº†</a></p><p>åˆ›å»ºçš„æµæ°´çº¿ä»»åŠ¡â€œpytorch-bertâ€åœ¨æ‰§è¡ŒTrainingæ­¥éª¤æ—¶ä¼šæŠ¥é”™å¤±è´¥ï¼š</p><p><img src="https://s2.loli.net/2025/02/07/xuND8gEJb74TkXr.png" alt="image-20250207151415759"></p><h3 id="é—®é¢˜è§£å†³åŠæ³•ï¼š"><a href="#é—®é¢˜è§£å†³åŠæ³•ï¼š" class="headerlink" title="é—®é¢˜è§£å†³åŠæ³•ï¼š"></a>é—®é¢˜è§£å†³åŠæ³•ï¼š</h3><p>åŸå› ï¼šå› ä¸ºéœ€è¦å»huggingfaceè¿™ä¸ªç¾å›½å…¬å¸çš„ç½‘ç«™ä¸‹è½½å¤–ç½‘çš„æ•°æ®ï¼Œä½†æ˜¯ç›¸å…³å¤–ç½‘åœ¨å¤§é™†æ— æ³•æ­£å¸¸è®¿é—®ã€‚</p><p>æœ€åæ‰§è¡Œæ—¶ï¼Œåšå¦‚ä¸‹ä¿®æ”¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿®æ”¹generate_templates.pyï¼ˆä¸‹å›¾æ˜¯ä¿®æ”¹åçš„æ ·å­ï¼‰</span><br>vi ~/kubeflow-pipelines/samples/contrib/pytorch-samples/utils/<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/07/YJtEz7kx4Vwpb9y.png" alt="image-20250207151607445"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿®æ”¹å¦‚ä¸‹æ–‡ä»¶ï¼Œä½¿ç”¨è‡ªå·±çš„å®¹å™¨é•œåƒï¼ˆä¸‹å›¾æ˜¯ä¿®æ”¹åçš„æ ·å­ï¼‰ï¼š</span><br>/home/jovyan/kubeflow-pipelines/samples/contrib/pytorch-samples/bert/template_mapping.json<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/07/z4C67QO9cRBLdKa.png" alt="image-20250207151701958"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#æ‰§è¡ŒPipeline-Bert.ipynbæ—¶ï¼Œå¦‚æœk8sç¯å¢ƒæ²¡æœ‰gpuå°±ä¿®æ”¹ptl_argså˜é‡çš„å€¼ï¼Œå°†gpuä¿®æ”¹ä¸ºcpu</span></span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/07/zLdywbTcKUhREPG.png" alt="image-20250207151725871"></p>]]></content>
    
    
    <categories>
      
      <category>k8säº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kubeflow k8s</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ollamaéƒ¨ç½²DeepSeekåŠåœ¨ragflowä¸­ä½¿ç”¨deepseek</title>
    <link href="/2025/02/05/ollama%E9%83%A8%E7%BD%B2DeepSeek%E5%8F%8A%E5%9C%A8ragflow%E4%B8%AD%E4%BD%BF%E7%94%A8deepseek/"/>
    <url>/2025/02/05/ollama%E9%83%A8%E7%BD%B2DeepSeek%E5%8F%8A%E5%9C%A8ragflow%E4%B8%AD%E4%BD%BF%E7%94%A8deepseek/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¯å¢ƒä¿¡æ¯"><a href="#ç¯å¢ƒä¿¡æ¯" class="headerlink" title="ç¯å¢ƒä¿¡æ¯"></a>ç¯å¢ƒä¿¡æ¯</h1><table><thead><tr><th>ä¸»æœºå</th><th>IP</th><th>æ“ä½œç³»ç»Ÿ</th><th>è§„æ ¼</th><th>GPUæƒ…å†µ</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>controller01</td><td>172.20.0.21</td><td>Ubuntu 20.04.3 LTS -amd64</td><td>16c64g+400G</td><td>NVIDIA A40*2</td><td></td></tr></tbody></table><h1 id="å®‰è£…é…ç½®Ollama"><a href="#å®‰è£…é…ç½®Ollama" class="headerlink" title="å®‰è£…é…ç½®Ollama"></a>å®‰è£…é…ç½®Ollama</h1><h2 id="è‡ªåŠ¨å®‰è£…"><a href="#è‡ªåŠ¨å®‰è£…" class="headerlink" title="è‡ªåŠ¨å®‰è£…"></a>è‡ªåŠ¨å®‰è£…</h2><p>å®˜ç½‘åœ°å€ï¼š<a href="https://ollama.com/">https://ollama.com/</a><br>ä¸‹è½½åœ°å€ï¼š<a href="https://ollama.com/download">https://ollama.com/download</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ­¤å¤„å®‰è£…Linuxç‰ˆæœ¬ollama</span><br>root@controller01:~# curl -fsSL https://ollama.com/install.sh | sh<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½†https://ollama.com/download/ollama-linux-amd64.tgzä¸€ç›´æ— æ³•æ­£å¸¸ä¸‹è½½ï¼Œæ‰€ä»¥å…ˆæ‰‹åŠ¨ä¸‹è½½æ”¾åˆ°æŒ‡å®šç›®å½•ã€‚å†ä¿®æ”¹ä¸Šè¿°è„šæœ¬æ–‡ä»¶ç»§ç»­å®‰è£…</span><br>root@t1-gpu:/opt/installPkgs# wget https://ollama.com/install.sh -O ollama-install.sh <br>root@t1-gpu:/opt/installPkgs# vi ollama-install.sh<br>...<br> 82 #curl --fail --show-error --location --progress-bar \<br> 83 #    &quot;https://ollama.com/download/ollama-linux-$&#123;ARCH&#125;.tgz$&#123;VER_PARAM&#125;&quot; | \<br> 84 #    $SUDO tar -xzf - -C &quot;$OLLAMA_INSTALL_DIR&quot;<br> 85 $SUDO tar -xzf ollama-linux-amd64.tgz -C &quot;$OLLAMA_INSTALL_DIR&quot;<br>...<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…æ—¶å°†è¾“å‡ºå¦‚ä¸‹å†…å®¹</span><br>root@controller01:/opt/installPkgs# bash ollama-install.sh <br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Cleaning up old version at /usr/local/lib/ollama</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Installing ollama to /usr/local</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Downloading Linux amd64 bundle</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Creating ollama user...</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Adding ollama user to render group...</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Adding ollama user to video group...</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Adding current user to ollama group...</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Creating ollama systemd service...</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Enabling and starting ollama service...</span><br>Created symlink /etc/systemd/system/default.target.wants/ollama.service â†’ /etc/systemd/system/ollama.service.<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; NVIDIA GPU installed.</span><br></code></pre></td></tr></table></figure><h2 id="æ‰‹åŠ¨å®‰è£…"><a href="#æ‰‹åŠ¨å®‰è£…" class="headerlink" title="æ‰‹åŠ¨å®‰è£…"></a>æ‰‹åŠ¨å®‰è£…</h2><p>å‚è€ƒï¼š<a href="https://github.com/datawhalechina/handy-ollama/blob/main/docs/C2/3.%20Ollama%20%E5%9C%A8%20Linux%20%E4%B8%8B%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE.md#ollama-%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE---linux-%E7%B3%BB%E7%BB%9F%E7%AF%87">https://github.com/datawhalechina/handy-ollama/blob/main/docs/C2/3.%20Ollama%20%E5%9C%A8%20Linux%20%E4%B8%8B%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE.md#ollama-%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE---linux-%E7%B3%BB%E7%BB%9F%E7%AF%87</a></p><h3 id="ä¸‹è½½-ollamaäºŒè¿›åˆ¶æ–‡ä»¶"><a href="#ä¸‹è½½-ollamaäºŒè¿›åˆ¶æ–‡ä»¶" class="headerlink" title="ä¸‹è½½ ollamaäºŒè¿›åˆ¶æ–‡ä»¶"></a>ä¸‹è½½ ollamaäºŒè¿›åˆ¶æ–‡ä»¶</h3><p>å°† Ollama çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸‹è½½åˆ° PATH ä¸­çš„ç›®å½•ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo curl -L https:<span class="hljs-regexp">//</span>ollama.com<span class="hljs-regexp">/download/</span>ollama-linux-amd64 -o <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/bin/</span>ollama<br>sudo chmod +x <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/bin/</span>ollama<br></code></pre></td></tr></table></figure><h3 id="å°†-Ollama-æ·»åŠ ä¸ºè‡ªå¯åŠ¨æœåŠ¡"><a href="#å°†-Ollama-æ·»åŠ ä¸ºè‡ªå¯åŠ¨æœåŠ¡" class="headerlink" title="å°† Ollama æ·»åŠ ä¸ºè‡ªå¯åŠ¨æœåŠ¡"></a>å°† Ollama æ·»åŠ ä¸ºè‡ªå¯åŠ¨æœåŠ¡</h3><p>é¦–å…ˆï¼Œä¸º Ollama åˆ›å»ºç”¨æˆ·ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo useradd -r -s /bin/false -m -d /usr/share/ollama ollama<br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨è¯¥ä½ç½®ï¼š<code>/etc/systemd/system/ollama.service</code> åˆ›å»ºæœåŠ¡æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">[Unit]<br>Description=Ollama Service<br>After=network-online.target<br><br>[Service]<br>ExecStart=/usr/local/bin/ollama serve<br>User=ollama<br>Group=ollama<br>Restart=always<br>RestartSec=3<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å…¶ä¸­PATHçš„å€¼å°±æ˜¯ç³»ç»Ÿç¯å¢ƒå˜é‡PATHçš„å€¼</span><br>Environment=&quot;PATH=/root/anaconda3/envs/graphrag-test/bin:/usr/local/cuda-12.4/bin:/root/anaconda3/bin:/root/anaconda3/condabin:/usr/local/jdk-11/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/usr/local/go/bin:/sbin:/usr/sbin:/usr/local/sbin&quot;<br>Environment=&quot;OLLAMA_HOST=0.0.0.0&quot;<br><br>[Install]<br>WantedBy=default.target<br></code></pre></td></tr></table></figure><p>æœ€åå¯åŠ¨æœåŠ¡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo systemctl daemon-reload<br>sudo systemctl enable ollama<br></code></pre></td></tr></table></figure><h3 id="å¯åŠ¨-Ollama"><a href="#å¯åŠ¨-Ollama" class="headerlink" title="å¯åŠ¨ Ollama"></a>å¯åŠ¨ Ollama</h3><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ Ollamaï¼š<code>systemd</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo systemctl start ollama<br></code></pre></td></tr></table></figure><h1 id="ä½¿ç”¨Ollamaè¿è¡ŒDeepSeek-r1-7b"><a href="#ä½¿ç”¨Ollamaè¿è¡ŒDeepSeek-r1-7b" class="headerlink" title="ä½¿ç”¨Ollamaè¿è¡ŒDeepSeek-r1:7b"></a>ä½¿ç”¨Ollamaè¿è¡ŒDeepSeek-r1:7b</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœæœ¬åœ°æ²¡æœ‰deepseek-r1:7bæ¨¡å‹ï¼Œå®ƒä¼šè‡ªåŠ¨ä¸‹è½½ç›¸å…³æ¨¡å‹æ–‡ä»¶ï¼Œæ­¤æ—¶è€—æ—¶4ä¸ªä¸¤ä¸ªå°æ—¶</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç„¶åå¼€å§‹æ‰§è¡Œæ­¤å¤§æ¨¡å‹</span><br>root@controller01:~# ollama run deepseek-r1:7b<br>pulling manifest <br>pulling manifest <br>pulling 96c415656d37... 100% â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– 4.7 GB                         <br>pulling 369ca498f347... 100% â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 387 B                         <br>pulling 6e4c38e1172f... 100% â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– 1.1 KB                         <br>pulling f4d24e9138dd... 100% â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  148 B                         <br>pulling 40fb844194b2... 100% â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  487 B                         <br>verifying sha256 digest <br>writing manifest <br>removing any unused layers <br>success <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è‡³æ­¤å°±å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¿›è¡Œå¯¹è¯äº†</span><br></code></pre></td></tr></table></figure><h1 id="å®‰è£…ragflow"><a href="#å®‰è£…ragflow" class="headerlink" title="å®‰è£…ragflow"></a>å®‰è£…ragflow</h1><p>å®˜ç½‘ ï¼š<a href="https://github.com/infiniflow/ragflow">https://github.com/infiniflow/ragflow</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:/opt/code_repos# git clone https://github.com/infiniflow/ragflow.git<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æˆ– root@controller01:/opt/code_repos# git <span class="hljs-built_in">clone</span> https://gitee.com/sy-jiang/ragflow.git</span><br><br>root@controller01:/opt/code_repos# cd ragflow/docker/<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿®æ”¹RAGFLOW_IMAGE é•œåƒä¸ºå›½å†…é•œåƒæºæä¾›çš„é•œåƒï¼ˆå»ºè®®ä¸è¦ä½¿ç”¨ç²¾ç®€ç‰ˆçš„ragflowé•œåƒï¼‰</span><br>root@controller01:/opt/code_repos/ragflow/docker# vi .env<br><span class="hljs-meta prompt_">#</span><span class="language-bash">RAGFLOW_IMAGE=infiniflow/ragflow:v0.15.1-slim</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">RAGFLOW_IMAGE=infiniflow/ragflow:v0.15.1</span><br>RAGFLOW_IMAGE=swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/infiniflow/ragflow:v0.15.1<br><br>root@controller01:/opt/code_repos/ragflow/docker# docker-compose -f docker-compose.yml up -d<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœæœ‰NVIDIA GPUï¼Œä½¿ç”¨å¦‚ä¸‹</span><br>root@controller01:/opt/code_repos/ragflow/docker# docker-compose -f docker-compose-gpu.yml up -d<br></code></pre></td></tr></table></figure><h1 id="ä½¿ç”¨ragflow"><a href="#ä½¿ç”¨ragflow" class="headerlink" title="ä½¿ç”¨ragflow"></a>ä½¿ç”¨ragflow</h1><h2 id="æ³¨å†Œä¸ç™»å½•"><a href="#æ³¨å†Œä¸ç™»å½•" class="headerlink" title="æ³¨å†Œä¸ç™»å½•"></a>æ³¨å†Œä¸ç™»å½•</h2><p>ç™»å½•å‰å¿…é¡»ä½¿ç”¨é‚®ç®±æ³¨å†Œï¼ˆæ³¨å†Œä¿¡æ¯ä¿å­˜åœ¨æœ¬åœ°ï¼‰ï¼Œç„¶åç™»å½•ï¼ˆç¬¬ä¸€ä¸ªæ³¨å†Œçš„ç”¨æˆ·é»˜è®¤å°±æ˜¯ç®¡ç†å‘˜ï¼‰</p><p><img src="https://s2.loli.net/2025/02/11/gOoV2h73r8sqFvX.png" alt="image-20250206095806493"></p><p><img src="https://s2.loli.net/2025/02/06/1re9RnYW6bmwvp5.png" alt="image-20250206100000908"></p><h2 id="å°†ollamaä¸­ç®¡ç†çš„DeepSeekæ¨¡å‹æ¥å…¥ragflow"><a href="#å°†ollamaä¸­ç®¡ç†çš„DeepSeekæ¨¡å‹æ¥å…¥ragflow" class="headerlink" title="å°†ollamaä¸­ç®¡ç†çš„DeepSeekæ¨¡å‹æ¥å…¥ragflow"></a>å°†ollamaä¸­ç®¡ç†çš„DeepSeekæ¨¡å‹æ¥å…¥ragflow</h2><p>å…ˆåœ¨æ¨¡å‹æä¾›å•†ä¸­æ·»åŠ åµŒå…¥æ¨¡å‹å’ŒLLMï¼Œç„¶ååœ¨â€œç³»ç»Ÿæ¨¡å‹è®¾ç½®â€ä¸­è®¾ç½®å®ƒä»¬ã€‚</p><p><img src="https://s2.loli.net/2025/02/06/Z23MyxmtfS8JqQo.png" alt="image-20250206100217493"></p><p><img src="https://s2.loli.net/2025/02/06/FqMHjzUmwOYRetC.png" alt="image-20250206100425361"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">chatå°±æ˜¯ç”¨æ¥å¯¹è¯çš„æ¨¡å‹ã€‚</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">embeddingæ˜¯ä¸€ç±»ç‰¹æ®Šçš„æ¨¡å‹ï¼Œç”¨æ¥å°†ç”¨æˆ·è¾“å…¥çš„å†…å®¹è¿›è¡Œä¸€ä¸ªç¼–ç ï¼Œç„¶åè¾“å…¥ç»™å¤§æ¨¡å‹ã€‚</span><br><br>root@controller01:/opt/code_repos/ragflow/docker# ollama list<br>NAME                                    ID              SIZE    MODIFIED     <br>deepseek-r1:7b                          0a8c26691023    4.7 GB  18 hours ago<br>qwen:7b                                 2091ee8c8d8f    4.5 GB  2 months ago<br>EntropyYue/chatglm3:6b                  254ec1286add    3.6 GB  2 months ago<br>qwen:14b                                80362ced6553    8.2 GB  2 months ago<br>qwen:0.5b                               b5dc5e784f2a    394 MB  2 months ago<br>deepseek-coder:1.3b                     3ddd2d3fc8d2    776 MB  2 months ago<br>quentinz/bge-large-zh-v1.5:latest       bc8ca0995fcd    651 MB  6 months ago<br>gemma2:9b                               ff02c3702f32    5.4 GB  6 months ago<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/02/06/gynacCU7fqPSvJZ.png" alt="image-20250206101409923"></p><p>æ·»åŠ æ¨¡å‹åï¼Œè¿›è¡Œç³»ç»Ÿæ¨¡å‹è®¾ç½®</p><p><img src="https://s2.loli.net/2025/02/06/DEaqA4ZY1Td2pOo.png" alt="image-20250206101725314"></p><p><img src="https://s2.loli.net/2025/02/06/FmcUf9dbOqtJklp.png" alt="image-20250206151941934"></p><p>å…¶ä¸­largeè¡¨ç¤ºåµŒå…¥æ¨¡å‹çš„è§„æ¨¡æ˜¯largeï¼Œå¦‚æœèµ„æºè¶³å¤Ÿï¼Œæ¨¡å‹è§„æ¨¡è¶Šå¤§æ•ˆæœè¶Šå¥½ï¼›zhè¡¨ç¤ºæ­¤åµŒå…¥æ¨¡å‹æ˜¯ä¸€ä¸ªä¸­æ–‡è§£ææ¨¡å‹ã€‚</p><h2 id="çŸ¥è¯†åº“"><a href="#çŸ¥è¯†åº“" class="headerlink" title="çŸ¥è¯†åº“"></a>çŸ¥è¯†åº“</h2><h3 id="åˆ›å»ºçŸ¥è¯†åº“"><a href="#åˆ›å»ºçŸ¥è¯†åº“" class="headerlink" title="åˆ›å»ºçŸ¥è¯†åº“"></a>åˆ›å»ºçŸ¥è¯†åº“</h3><p>æ­¤å¤„æˆ‘å‡†å¤‡äº†ä¸€ä¸ªã€Šä¸­åäººæ°‘å…±å’Œå›½é£Ÿå“å®‰å…¨æ³•.pdfã€‹æ–‡ä»¶ï¼Œç”¨æ¥åˆ›å»ºçŸ¥è¯†åº“</p><p><img src="https://s2.loli.net/2025/02/06/do1VKj3CHT8bhUF.png" alt="image-20250206102421822"></p><h3 id="çŸ¥è¯†åº“é…ç½®"><a href="#çŸ¥è¯†åº“é…ç½®" class="headerlink" title="çŸ¥è¯†åº“é…ç½®"></a>çŸ¥è¯†åº“é…ç½®</h3><p><img src="https://s2.loli.net/2025/02/06/PF1QBIheHO6t2i7.png" alt="image-20250206152608551"></p><h3 id="æ•°æ®é›†é…ç½®"><a href="#æ•°æ®é›†é…ç½®" class="headerlink" title="æ•°æ®é›†é…ç½®"></a>æ•°æ®é›†é…ç½®</h3><p><img src="https://s2.loli.net/2025/02/06/uAahNb9JYQORBci.png" alt="image-20250206152802622"></p><p><img src="https://s2.loli.net/2025/02/06/eyU3OQaSg4MTBhf.png" alt="image-20250206152833439"></p><p>ã€Šé£Ÿå“å®‰å…¨æ³•.pdfã€‹ä¸‹è½½åœ°å€ï¼š<a href="https://sj.als.gov.cn/attach/0/d50b5b9d5b7e4387abd14da4b1e05f73.pdf">https://sj.als.gov.cn/attach/0/d50b5b9d5b7e4387abd14da4b1e05f73.pdf</a></p><p><img src="https://s2.loli.net/2025/02/06/MevyOWxD13uq8ro.png" alt="image-20250206152929373"></p><p><img src="https://s2.loli.net/2025/02/06/m3Z2xtvRgTlseWF.png" alt="image-20250206153412950"></p><h2 id="èŠå¤©"><a href="#èŠå¤©" class="headerlink" title="èŠå¤©"></a>èŠå¤©</h2><h3 id="æ–°å»ºåŠ©ç†"><a href="#æ–°å»ºåŠ©ç†" class="headerlink" title="æ–°å»ºåŠ©ç†"></a>æ–°å»ºåŠ©ç†</h3><p><img src="https://s2.loli.net/2025/02/06/xVebYaBqKLy61Ei.png" alt="image-20250206154504678"></p><h3 id="æ–°å»ºèŠå¤©"><a href="#æ–°å»ºèŠå¤©" class="headerlink" title="æ–°å»ºèŠå¤©"></a>æ–°å»ºèŠå¤©</h3><p><img src="https://s2.loli.net/2025/02/06/hJOIvbS3zuyYU9C.png" alt="image-20250206154651562"></p><p><img src="https://s2.loli.net/2025/02/06/J4lj5gHoXDOKqWb.png" alt="image-20250206155149390"></p>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>DeepSeek Ollama</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>DeepSeekå¤§æ¨¡å‹å†å²åŠæ¦‚è¿°</title>
    <link href="/2025/01/27/DeepSeek%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%8E%86%E5%8F%B2%E5%8F%8A%E6%A6%82%E8%BF%B0/"/>
    <url>/2025/01/27/DeepSeek%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%8E%86%E5%8F%B2%E5%8F%8A%E6%A6%82%E8%BF%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€deepseekå…¬å¸">ä¸€ã€DeepSeekå…¬å¸</h1><p><strong><a href="https://baike.baidu.com/item/DeepSeek/65258669">DeepSeekå…¬å¸</a> </strong>æˆç«‹äº2023å¹´7æœˆ17æ—¥ï¼Œä¸­æ–‡åå­—å…¨ç§°æ˜¯ <strong>æ­å·æ·±åº¦æ±‚ç´¢äººå·¥æ™ºèƒ½åŸºç¡€æŠ€æœ¯ç ”ç©¶æœ‰é™å…¬å¸</strong> ï¼Œç”±çŸ¥åé‡åŒ–åŸºé‡‘å…¬å¸ <strong>å¹»æ–¹é‡åŒ–</strong> åˆ›ç«‹ï¼ˆæ³¨å†Œæ€»èµ„æœ¬1000ä¸‡ï¼Œå¹»æ–¹é‡åŒ–çš„åˆ›å§‹äººæ¢æ–‡é”‹å äº†1%çš„æŒè‚¡æ¯”ä¾‹ï¼‰ã€‚DeepSeek ä½œä¸ºä¸€å®¶åˆ›æ–°å‹ç§‘æŠ€å…¬å¸ï¼Œæˆç«‹ä»¥æ¥ä¸“æ³¨äºå¼€å‘å…ˆè¿›çš„å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰å’Œç›¸å…³æŠ€æœ¯ï¼Œä½œä¸ºå¤§å‚å¤–å”¯ä¸€ä¸€å®¶å‚¨å¤‡ä¸‡å¼  A100 èŠ¯ç‰‡çš„å…¬å¸ï¼Œå¹»æ–¹é‡åŒ–ä¸ºDeepSeekçš„æŠ€æœ¯ç ”å‘æä¾›äº†å¼ºå¤§çš„ç¡¬ä»¶æ”¯æŒã€‚</p><p><strong>å¹»æ–¹é‡åŒ–</strong> å…¬å¸ç”±ä¸‰åæ¯•ä¸šäºæµ™æ±Ÿå¤§å­¦çš„å·¥ç¨‹å¸ˆï¼ˆå…¶ä¸­å°±åŒ…æ‹¬æ¢æ–‡é”‹ï¼‰äº2015å¹´åˆ›ç«‹ï¼Œæ˜¯ä¸€å®¶æ€»éƒ¨ä½äºä¸­å›½æµ™æ±Ÿçœæ­å·å¸‚çš„å¯¹å†²åŸºé‡‘ã€é‡åŒ–åŸºé‡‘å’Œäººå·¥æ™ºèƒ½å…¬å¸ã€‚2017å¹´å¹»æ–¹é‡åŒ–å¼€å§‹åŸºäºæœºå™¨å­¦ä¹ è¿›è¡Œäº¤æ˜“ï¼Œå¹¶å®£ç§°å®ç°æŠ•èµ„ç­–ç•¥å…¨é¢AIåŒ–ã€‚æ­¤åçš„2023å¹´7æœˆåˆ›ç«‹DeepSeek å…¬å¸ï¼Œæ‰€ä»¥è¯´DeepSeek å…¬å¸æ˜¯å¹»æ–¹é‡åŒ–å…¬å¸çš„å­å…¬å¸ã€‚</p><h1 id="äºŒdeepseekå…¬å¸çš„æ¨¡å‹å†å²">äºŒã€DeepSeekå…¬å¸çš„æ¨¡å‹å†å²</h1><p>æ­¤ç« èŠ‚æŒ‰ç…§æ—¶é—´é¡ºåºé˜è¿°DeepSeekå…¬å¸å‘å¸ƒçš„é‡è¦æ¨¡å‹çš„æ¦‚è¿°ä¿¡æ¯ã€‚åé¢æœ‰å•ç‹¬çš„ç« èŠ‚æŠŠDeepSeek-V3åŠDeepSeek-R1æ¨¡å‹çš„æ¦‚è¿°ã€ç‰¹å¾ã€æ¨¡å‹ä¸‹è½½ç­‰è¿›è¡Œè¯´æ˜ã€‚</p><h2 id="deepseek-llm">DeepSeek LLM</h2><p>2024å¹´1æœˆ5æ—¥ï¼Œå‘å¸ƒç¬¬ä¸€ä¸ªæ¨¡å‹<a href="https://github.com/deepseek-ai/DeepSeek-LLM">DeepSeek LLM</a>ã€‚æ­¤æ¨¡å‹åŒ…å«670äº¿å‚æ•°ï¼Œåœ¨ä¸€ä¸ªåŒ…å«2ä¸‡äº¿tokençš„æ•°æ®é›†ä¸Šè¿›è¡Œäº†è®­ç»ƒï¼Œæ•°æ®é›†æ¶µç›–ä¸­è‹±æ–‡ã€‚ä¸ºäº†ä¿ƒè¿›ç ”ç©¶ç¤¾åŒºï¼Œå…¬å¸å…¨éƒ¨å¼€æºäº†DeepSeek LLM 7B/67B Baseå’ŒDeepSeek LLM 7B/67B Chatã€‚DeepSeek LLMçš„ä¸»è¦ç‰¹å¾æœ‰å¦‚ä¸‹ï¼š</p><ul><li>å“è¶Šçš„ç»¼åˆèƒ½åŠ›ï¼šDeepSeek LLM 67B Baseåœ¨æ¨ç†ã€ç¼–ç ã€æ•°å­¦å’Œä¸­æ–‡ç†è§£ç­‰æ–¹é¢è¶…è¶Šäº†Llama2 70B Baseã€‚</li><li>ç²¾é€šç¼–ç¨‹å’Œæ•°å­¦ï¼šDeepSeek LLM 67B Chatåœ¨ç¼–ç å’Œæ•°å­¦æ–¹é¢è¡¨ç°å‡ºè‰²ã€‚</li><li>ç²¾é€šä¸­æ–‡ï¼šDeepSeek LLM 67B Chatåœ¨ä¸­æ–‡è¡¨ç°ä¸Šè¶…è¶Šäº†GPT-3.5ã€‚</li></ul><p>å…¶ä»–è¯¦ç»†ä»‹ç»å‚è€ƒï¼š<a href="https://github.com/deepseek-ai/DeepSeek-LLM">DeepSeek-LLMçš„ä»£ç ä»“åº“</a></p><h2 id="deepseek-coder">DeepSeek-Coder</h2><p>2024å¹´1æœˆ25æ—¥ï¼Œå‘å¸ƒDeepSeek-Coderï¼ŒDeepSeek Coderç”±ä¸€ç³»åˆ—ä»£ç è¯­è¨€æ¨¡å‹ç»„æˆï¼Œæ¯ä¸ªæ¨¡å‹å‡ä»é›¶å¼€å§‹åœ¨2ä¸‡äº¿tokenä¸Šè®­ç»ƒï¼Œæ•°æ®é›†åŒ…å«87%çš„ä»£ç å’Œ13%çš„ä¸­è‹±æ–‡è‡ªç„¶è¯­è¨€ã€‚ä»£ç æ¨¡å‹å°ºå¯¸ä»1Båˆ°33Bç‰ˆæœ¬ä¸ç­‰ã€‚DeepSeek Coderåœ¨å¤šç§ç¼–ç¨‹è¯­è¨€å’Œå„ç§åŸºå‡†æµ‹è¯•ä¸­è¾¾åˆ°äº†å¼€æºä»£ç æ¨¡å‹çš„æœ€å…ˆè¿›æ€§èƒ½ã€‚DeepSeek LLMçš„ä¸»è¦ç‰¹å¾æœ‰å¦‚ä¸‹ï¼š</p><ul><li><p>æµ·é‡çš„è®­ç»ƒæ•°æ®ï¼šä»é›¶å¼€å§‹åœ¨æ‹¥æœ‰2ä¸‡äº¿tokençš„æ•°æ®é›†ä¸Šè¿›è¡Œäº†è®­ç»ƒï¼Œæ•°æ®é›†åŒ…æ‹¬87%çš„ä»£ç å’Œ13%çš„ä¸­è‹±æ–‡è¯­è¨€æ•°æ®ã€‚</p></li><li><p>é«˜åº¦çµæ´»æ€§å’Œå¯æ‰©å±•ï¼šæœ‰1Bã€5.7Bã€6.7Bã€33Bå››ç§è§„æ ¼å¯ä¾›é€‰æ‹©ï¼Œç”¨æˆ·å¯æ ¹æ®éœ€è¦é€‰æ‹©æœ€åˆé€‚çš„æ¨¡å‹åŠè§„æ ¼</p></li><li><p>å“è¶Šçš„æ¨¡å‹æ€§èƒ½ï¼šåœ¨HumanEvalã€MultiPL-Eã€MBPPã€DS-1000ã€ä¸APPSå¤šç§åŸºå‡†æµ‹è¯•ä¸­ï¼Œä¸å…¶ä»–å…¬å¼€ã€å¯ç”¨çš„å¤§æ¨¡å‹ç›¸æ¯”ï¼Œæ­¤æ¨¡å‹æ€»ä½“ä¸Šæ‹¥æœ‰æ›´å“è¶Šçš„æ€§èƒ½</p></li><li><p>é«˜é˜¶ä»£ç è¡¥å…¨èƒ½åŠ›ï¼šé‡‡ç”¨16Kçš„çª—å£å¤§å°å’Œé¢å¤–çš„å¡«ç©ºä»»åŠ¡è¿›è¡Œè®­ç»ƒï¼Œä»¥æ”¯æŒé¡¹ç›®çº§ä»£ç è¡¥å…¨å’Œå¡«å……ã€‚</p></li></ul><figure><img src="https://s2.loli.net/2025/01/27/iyXhSO8bdk6gx3T.png" alt="image-20250127223512626" /><figcaption aria-hidden="true">image-20250127223512626</figcaption></figure><p>å…¶ä»–è¯¦ç»†ä»‹ç»å‚è€ƒï¼š<a href="https://github.com/deepseek-ai/DeepSeek-Coder">DeepSeek-Coderçš„ä»£ç ä»“åº“</a></p><h2 id="deepseekmath">DeepSeekMath</h2><p>2024å¹´2æœˆ5æ—¥ï¼Œå‘å¸ƒ<a href="https://github.com/deepseek-ai/DeepSeek-Math">DeepSeekMath</a>ï¼ŒDeepSeekMathä»¥DeepSeek-Coder-v1.5 7Bä¸ºåŸºç¡€ï¼Œç»§ç»­åœ¨ä»Common Crawlä¸­æå–çš„æ•°å­¦ç›¸å…³tokenä»¥åŠè‡ªç„¶è¯­è¨€å’Œä»£ç æ•°æ®ä¸Šè¿›è¡Œé¢„è®­ç»ƒï¼Œè®­ç»ƒè§„æ¨¡è¾¾5000äº¿tokenã€‚DeepSeekMath 7Båœ¨ç«èµ›çº§MATHåŸºå‡†æµ‹è¯•ä¸­å–å¾—äº†51.7%çš„ä¼˜å¼‚æˆç»©ï¼Œä¸”æœªä¾èµ–å¤–éƒ¨å·¥å…·åŒ…å’ŒæŠ•ç¥¨æŠ€æœ¯ï¼Œæ¥è¿‘Gemini-Ultraå’ŒGPT-4çš„æ€§èƒ½æ°´å¹³ã€‚</p><figure><img src="https://s2.loli.net/2025/01/27/5dFG37UyD1CxXRe.png" alt="image-20250127222229328" /><figcaption aria-hidden="true">image-20250127222229328</figcaption></figure><p>å…¶ä»–è¯¦ç»†ä»‹ç»å‚è€ƒï¼š<a href="https://github.com/deepseek-ai/DeepSeek-Math">DeepSeek-Mathçš„ä»£ç ä»“åº“</a></p><h2 id="deepseek-vl">DeepSeek-VL</h2><p>2024å¹´3æœˆ11æ—¥ï¼Œå‘å¸ƒ<a href="https://github.com/deepseek-ai/DeepSeek-VL">DeepSeek-VL</a>ã€‚DeepSeek-VL æ˜¯ä¸€ä¸ªå¼€æºçš„è§†è§‰è¯­è¨€æ¨¡å‹ï¼Œä¸“ä¸ºç°å®ä¸–ç•Œçš„è§†è§‰å’Œè¯­è¨€ç†è§£åº”ç”¨è€Œè®¾è®¡ã€‚DeepSeek-VLå…·æœ‰é€šç”¨çš„å¤šæ¨¡æ€ç†è§£èƒ½åŠ›ï¼Œèƒ½å¤Ÿå¤„ç†é€»è¾‘å›¾ã€ç½‘é¡µã€å…¬å¼è¯†åˆ«ã€ç§‘å­¦æ–‡çŒ®ã€è‡ªç„¶å›¾åƒå’Œå¤æ‚åœºæ™¯ä¸‹çš„å…·èº«æ™ºèƒ½ï¼ŒåŒæ—¶ä¿æŒç›¸å¯¹è¾ƒä½çš„è®¡ç®—å¼€é”€ã€‚DeepSeek-VLç³»åˆ—ï¼ˆåŒ…æ‹¬1.3Bå’Œ7Bæ¨¡å‹ï¼‰åœ¨ç›¸åŒæ¨¡å‹å°ºå¯¸ä¸‹ï¼Œåœ¨å¹¿æ³›çš„è§†è§‰-è¯­è¨€åŸºå‡†æµ‹è¯•ä¸­è¾¾åˆ°äº†æœ€å…ˆè¿›æˆ–å¯ç«äº‰çš„æ€§èƒ½ã€‚</p><p>å…¶ä»–è¯¦ç»†ä»‹ç»å‚è€ƒï¼š<a href="https://github.com/deepseek-ai/DeepSeek-VL">DeepSeek-VLçš„ä»£ç ä»“åº“</a></p><h2 id="deepseek-v2">DeepSeek-V2</h2><p>2024å¹´5æœˆ7æ—¥ï¼Œå‘å¸ƒç¬¬äºŒä»£å¼€æºMixture-of-Expertsï¼ˆMoEï¼‰æ¨¡å‹â€”â€”<a href="https://github.com/deepseek-ai/DeepSeek-V2">DeepSeek-V2</a>ã€‚DeepSeek-V2æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ··åˆä¸“å®¶ï¼ˆMoEï¼‰è¯­è¨€æ¨¡å‹ï¼Œä»¥ç»æµé«˜æ•ˆçš„è®­ç»ƒå’Œæ¨ç†ä¸ºç‰¹ç‚¹ã€‚å®ƒåŒ…å«2360äº¿ä¸ªæ€»å‚æ•°ï¼Œå…¶ä¸­æ¯ä¸ªtokenæ¿€æ´»210äº¿ä¸ªå‚æ•°ã€‚ä¸DeepSeek 67Bç›¸æ¯”ï¼ŒDeepSeek-V2ä¸ä»…å®ç°äº†æ›´å¼ºçš„æ€§èƒ½ï¼ŒåŒæ—¶è¿˜èŠ‚çœäº†42.5%çš„è®­ç»ƒæˆæœ¬ï¼Œå°†KVç¼“å­˜å‡å°‘äº†93.3%ï¼Œå¹¶å°†æœ€å¤§ç”Ÿæˆååé‡æå‡è‡³5.76å€ã€‚DeepSeek-V2æ˜¯åœ¨ä¸€ä¸ªåŒ…å«8.1ä¸‡äº¿tokençš„å¤šæ ·åŒ–ä¸”é«˜è´¨é‡çš„è¯­æ–™åº“ä¸Šè¿›è¡Œçš„é¢„è®­ç»ƒã€‚åœ¨å®Œæˆå…¨é¢çš„é¢„è®­ç»ƒåï¼Œé€šè¿‡ç›‘ç£å¾®è°ƒï¼ˆSFTï¼‰å’Œå¼ºåŒ–å­¦ä¹ ï¼ˆRLï¼‰è¿›ä¸€æ­¥é‡Šæ”¾äº†æ¨¡å‹çš„æ½œåŠ›ã€‚è¯„ä¼°ç»“æœéªŒè¯äº†æ–¹æ³•çš„æœ‰æ•ˆæ€§ï¼ŒDeepSeek-V2åœ¨æ ‡å‡†åŸºå‡†æµ‹è¯•å’Œå¼€æ”¾å¼ç”Ÿæˆè¯„ä¼°ä¸­å‡å–å¾—äº†æ˜¾è‘—çš„è¡¨ç°ã€‚ DeepSeek V2æ¨¡å‹å› åœ¨ä¸­æ–‡ç»¼åˆèƒ½åŠ›è¯„æµ‹ä¸­çš„å‡ºè‰²è¡¨ç°ï¼Œä¸”ä»¥æä½çš„æ¨ç†æˆæœ¬å¼•å‘è¡Œä¸šå…³æ³¨ï¼Œè¢«ç§°ä¸ºâ€œAIç•Œçš„æ‹¼å¤šå¤šâ€ã€‚</p><figure><img src="https://s2.loli.net/2025/01/27/d1xasNLn94P6Ulq.png" alt="image-20250127223436895" /><figcaption aria-hidden="true">image-20250127223436895</figcaption></figure><p>å…¶ä»–è¯¦ç»†ä»‹ç»å‚è€ƒï¼š<a href="https://github.com/deepseek-ai/DeepSeek-V2">DeepSeek-V2çš„ä»£ç ä»“åº“</a></p><h2 id="deepseek-coder-v2">DeepSeek-Coder-V2</h2><p>2024å¹´6æœˆ17æ—¥ï¼Œå‘å¸ƒDeepSeek-Coder-V2ï¼ŒDeepSeek-Coder-V2æ˜¯ä¸€ä¸ªå¼€æºçš„æ··åˆä¸“å®¶ï¼ˆMoEï¼‰ä»£ç è¯­è¨€æ¨¡å‹ï¼Œåœ¨ä»£ç ç‰¹å®šä»»åŠ¡ä¸­è¾¾åˆ°äº†ä¸GPT4-Turboç›¸å½“çš„æ€§èƒ½ã€‚DeepSeek-Coder-V2æ˜¯ä»DeepSeek-V2çš„ä¸€ä¸ªä¸­é—´æ£€æŸ¥ç‚¹å¼€å§‹ï¼Œè¿›ä¸€æ­¥é¢„è®­ç»ƒäº†é¢å¤–çš„6ä¸‡äº¿tokenï¼Œæ˜¾è‘—å¢å¼ºäº†DeepSeek-V2çš„ç¼–ç å’Œæ•°å­¦æ¨ç†èƒ½åŠ›ï¼ŒåŒæ—¶åœ¨é€šç”¨è¯­è¨€ä»»åŠ¡ä¸­ä¿æŒäº†ç›¸å½“çš„æ€§èƒ½ã€‚å¹¶åœ¨ä»£ç ç›¸å…³ä»»åŠ¡ã€æ¨ç†èƒ½åŠ›å’Œé€šç”¨èƒ½åŠ›ç­‰å¤šä¸ªæ–¹é¢éƒ½å–å¾—äº†æ˜¾è‘—è¿›æ­¥ã€‚æ­¤å¤–ï¼ŒDeepSeek-Coder-V2å°†æ”¯æŒçš„ç¼–ç¨‹è¯­è¨€ä»86ç§æ‰©å±•åˆ°338ç§ï¼Œå¹¶å°†ä¸Šä¸‹æ–‡é•¿åº¦ä»16Kæ‰©å±•åˆ°128Kã€‚åœ¨æ ‡å‡†åŸºå‡†æµ‹è¯•ä¸­ï¼ŒDeepSeek-Coder-V2åœ¨ç¼–ç å’Œæ•°å­¦åŸºå‡†æµ‹è¯•ä¸­è¡¨ç°ä¼˜å¼‚ï¼Œè¶…è¶Šäº†GPT4-Turboã€Claude 3 Opuså’ŒGemini 1.5 Proç­‰é—­æºæ¨¡å‹ã€‚</p><figure><img src="https://s2.loli.net/2025/01/27/Pe2JGhEZMVDp6sc.png" alt="image-20250127223414157" /><figcaption aria-hidden="true">image-20250127223414157</figcaption></figure><p>å…¶ä»–è¯¦ç»†ä»‹ç»å‚è€ƒï¼š<a href="https://github.com/deepseek-ai/DeepSeek-Coder-V2">DeepSeek-Coder-V2çš„ä»£ç ä»“åº“</a></p><h2 id="deepseek-vl2">DeepSeek-VL2</h2><p>2024å¹´12æœˆ13æ—¥ï¼Œå‘å¸ƒç”¨äºé«˜çº§å¤šæ¨¡æ€ç†è§£çš„ä¸“å®¶æ··åˆè§†è§‰è¯­è¨€æ¨¡å‹â€”â€”<a href="https://github.com/deepseek-ai/DeepSeek-VL2">DeepSeek-VL2</a>ï¼ŒDeepSeek-VL2æ˜¯ä¸€ä¸ªå…ˆè¿›çš„å¤§å‹æ··åˆä¸“å®¶ï¼ˆMoEï¼‰è§†è§‰-è¯­è¨€æ¨¡å‹ç³»åˆ—ï¼Œç›¸è¾ƒäºå…¶å‰èº«DeepSeek-VLæœ‰äº†æ˜¾è‘—æ”¹è¿›ã€‚DeepSeek-VL2åœ¨å¤šç§ä»»åŠ¡ä¸­å±•ç°äº†å“è¶Šçš„èƒ½åŠ›ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºè§†è§‰é—®ç­”ã€å…‰å­¦å­—ç¬¦è¯†åˆ«ã€æ–‡æ¡£/è¡¨æ ¼/å›¾è¡¨ç†è§£ä»¥åŠè§†è§‰å®šä½ã€‚æ¨¡å‹ç³»åˆ—ç”±ä¸‰ä¸ªå˜ä½“ç»„æˆï¼šDeepSeek-VL2-Tinyã€DeepSeek-VL2-Smallå’ŒDeepSeek-VL2ï¼Œåˆ†åˆ«å…·æœ‰10äº¿ã€28äº¿å’Œ45äº¿æ¿€æ´»å‚æ•°ã€‚ä¸ç°æœ‰çš„å¼€æºå¯†é›†æ¨¡å‹å’ŒåŸºäºMoEçš„æ¨¡å‹ç›¸æ¯”ï¼ŒDeepSeek-VL2åœ¨ç›¸ä¼¼æˆ–æ›´å°‘çš„æ¿€æ´»å‚æ•°ä¸‹å®ç°äº†å…·æœ‰ç«äº‰åŠ›æˆ–æœ€å…ˆè¿›çš„æ€§èƒ½ã€‚</p><figure><img src="https://s2.loli.net/2025/01/27/mYFA1y2USp4PnNu.png" alt="image-20250127223908472" /><figcaption aria-hidden="true">image-20250127223908472</figcaption></figure><p>å…¶ä»–è¯¦ç»†ä»‹ç»å‚è€ƒï¼š<a href="https://github.com/deepseek-ai/DeepSeek-VL2">DeepSeek-VL2çš„ä»£ç ä»“åº“</a></p><h2 id="deepseek-v3">DeepSeek-V3</h2><p>2024å¹´12æœˆ26æ—¥æ™šï¼ŒDeepSeekå…¬å¸æ­£å¼ä¸Šçº¿å…¨æ–°ç³»åˆ—æ¨¡å‹ DeepSeek-V3 é¦–ä¸ªç‰ˆæœ¬å¹¶åŒæ­¥å¼€æºã€‚</p><p>åé¢å°†æœ‰ä¸€ä¸ªå•ç‹¬çš„ç« èŠ‚å¯¹æ­¤æ¨¡å‹åšä¸€ä¸ªè¯¦ç»†çš„ä»‹ç»ã€‚</p><h2 id="deepseek-r1">DeepSeek-R1</h2><p>2025å¹´1æœˆ20æ—¥ï¼ŒDeepSeekæ­£å¼å‘å¸ƒ DeepSeek-R1 æ¨¡å‹ï¼Œå¹¶åŒæ­¥å¼€æºæ¨¡å‹æƒé‡ã€‚</p><p>åé¢ä¹Ÿæœ‰ä¸€ä¸ªå•ç‹¬çš„ç« èŠ‚å¯¹æ­¤æ¨¡å‹åšä¸€ä¸ªè¯¦ç»†çš„ä»‹ç»ã€‚</p><h2 id="deepseek-janus-pro">DeepSeek-Janus-Pro</h2><p>2025å¹´1æœˆ28æ—¥å‡Œæ™¨ï¼ŒDeepSeek åœ¨ GitHub ä¸Šçš„ Janus é¡¹ç›®ç©ºé—´å®˜å®£å¼€æºäº† Janus-Pro æ¨¡å‹å’ŒæŠ€æœ¯æŠ¥å‘Šã€‚</p><p>DeepSeek-Janus-Proçš„ç‰¹å¾å¦‚ä¸‹ï¼š</p><ul><li>Janus-Pro æ¨¡å‹æ˜¯ä¸€ä¸ªå¤šæ¨¡æ€æ¨¡å‹ï¼Œå¯ä»¥åŒæ—¶è¿›è¡Œå¤šæ¨¡æ€ç†è§£å’Œå›¾åƒç”Ÿæˆä»»åŠ¡ã€‚å®ƒå…±æœ‰2ä¸ªå‚æ•°é‡ç‰ˆæœ¬ï¼ŒJanus-Pro-1B åŠ Janus-Pro-7Bã€‚</li><li>Janus-Pro çš„æ ¸å¿ƒåˆ›æ–°æ˜¯å°†å¤šæ¨¡æ€ç†è§£å’Œç”Ÿæˆï¼Œä¸¤ç§ä¸åŒçš„ä»»åŠ¡è§£è€¦ã€‚è®©è¿™ä¸¤ç§ä»»åŠ¡å¯ä»¥åœ¨åŒä¸€æ¨¡å‹ä¸­é«˜æ•ˆå®Œæˆã€‚</li><li>Janus-Pro ä¸å»å¹´10æœˆ DeepSeek å‘å¸ƒçš„ Janus æ¨¡å‹æ¶æ„ä¸€è‡´ï¼Œä½†å½“æ—¶ Janus æ²¡æœ‰å¤ªå¤šå…³æ³¨ä¸å…³æ³¨ã€‚</li><li>DeepSeekå®˜æ–¹ä»‹ç»ï¼ŒJanus-Pro ä¸ä»…èƒ½ç†è§£å›¾ç‰‡ã€å¯¹å›¾ç‰‡ä¸­çš„æ–‡å­—è¿›è¡Œæå–ä¸ç†è§£ï¼Œè¿˜èƒ½åŒæ—¶ç”Ÿæˆå›¾ç‰‡ã€‚</li></ul><p>å…¶ä»–è¯¦ç»†ä»‹ç»å‚è€ƒï¼š<a href="https://github.com/deepseek-ai/Janus">Janusçš„ä»£ç ä»“åº“</a></p><h1 id="ä¸‰deepseek-v3-æ¨¡å‹">ä¸‰ã€DeepSeek-V3 æ¨¡å‹</h1><p>2024å¹´12æœˆ26æ—¥æ™šï¼ŒDeepSeekå…¬å¸æ­£å¼ä¸Šçº¿å…¨æ–°ç³»åˆ—æ¨¡å‹ <a href="https://github.com/deepseek-ai/DeepSeek-V3">DeepSeek-V3</a> é¦–ä¸ªç‰ˆæœ¬å¹¶åŒæ­¥å¼€æºã€‚</p><p>è®ºæ–‡ä¸‹è½½æŸ¥çœ‹ï¼šhttps://github.com/deepseek-ai/DeepSeek-V3/blob/main/DeepSeek_V3.pdf æˆ– https://arxiv.org/abs/2412.19437 ã€‚</p><p>ä»¥ä¸‹å…³äºDeepSeek-V3æ¨¡å‹çš„é˜è¿°ï¼Œæ¥çœ‹DeepSeek-V3çš„githubä»“åº“å†…å®¹çš„ç¿»è¯‘ã€‚</p><h2 id="æ¨¡å‹ä»‹ç»">3.1 æ¨¡å‹ä»‹ç»</h2><p>æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ä¸“å®¶æ··åˆï¼ˆMoEï¼‰è¯­è¨€æ¨¡å‹ï¼Œå…·æœ‰671Bä¸ªæ€»å‚æ•°ï¼Œæ¯ä¸ªä»¤ç‰Œæ¿€æ´»37Bä¸ªå‚æ•°ã€‚ä¸ºäº†å®ç°é«˜æ•ˆçš„æ¨ç†å’Œä½æˆæœ¬çš„è®­ç»ƒï¼ŒDeepSeek-V3é‡‡ç”¨äº†å¤šå¤´æ½œæ³¨æ„ï¼ˆMLAï¼‰å’ŒDeepSeekMoEæ¶æ„ï¼Œè¿™ä¸¤ç§æ¶æ„åœ¨DeepSeek-V2ä¸­å¾—åˆ°äº†å……åˆ†çš„éªŒè¯ã€‚æ­¤å¤–ï¼ŒDeepSeek-V3å¼€åˆ›æ€§æå‡ºä»¥ä¸‹ä¸¤ç‚¹ï¼šæ— è¾…åŠ©æŸå¤±ç­–ç•¥ã€å¤šä»¤ç‰Œé¢„æµ‹ã€‚DeepSeek-V3åœ¨14.8ä¸‡äº¿ä¸ªä¸åŒçš„é«˜è´¨é‡ä»¤ç‰Œä¸Šè¿›è¡Œäº†é¢„è®­ç»ƒï¼Œç„¶åè¿›è¡Œç›‘ç£å¾®è°ƒå’Œå¼ºåŒ–å­¦ä¹ ã€‚æ®DeepSeekå®˜ç½‘æ‰€è¿°ï¼šç»¼åˆæ€§å®éªŒè¯„ä¼°è¡¨æ˜ï¼ŒDeepSeek-V3ä¼˜äºå…¶ä»–å¼€æºæ¨¡å‹ï¼Œå¹¶å®ç°äº†ä¸é¢†å…ˆçš„é—­æºæ¨¡å‹ç›¸å½“çš„æ€§èƒ½ã€‚è€Œå®ç°å¦‚æ­¤ä¼˜å¼‚æ€§èƒ½çš„æ¡ä»¶æ˜¯ï¼ŒDeepSeek-V3çš„å®Œæ•´è®­ç»ƒåªèŠ±è´¹äº† 278.8 m H800 GPUå°æ—¶ã€‚æ­¤å¤–ï¼ŒDeepSeek-V3çš„è®­ç»ƒè¿‡ç¨‹éå¸¸ç¨³å®šï¼Œåœ¨æ•´ä¸ªè®­ç»ƒè¿‡ç¨‹ä¸­æ²¡æœ‰ç»å†ä»»ä½•ä¸å¯æ¢å¤çš„æŸå¤±å³°å€¼æˆ–æ‰§è¡Œä»»ä½•å›æ»šã€‚</p><p>ä»ä¸‹å›¾ï¼ˆæ¥è‡ªDeepSeek-V3åœ¨githubä¸Šçš„ä»£ç ä»“åº“ï¼‰å¯ä»¥çœ‹å‡ºï¼ŒDeepSeek-V3åœ¨çŸ¥è¯†ç±»ä»»åŠ¡ï¼ˆMMLU, MMLU-Pro, GPQA, SimpleQAï¼‰ä¸Šçš„æ°´å¹³ç›¸æ¯”å‰ä»£ DeepSeek-V2.5æ˜¾è‘—æå‡ï¼Œæ¥è¿‘å½“å‰è¡¨ç°æœ€å¥½çš„ç”±Anthropicå…¬å¸äº10æœˆå‘å¸ƒçš„æ¨¡å‹Claude-3.5-Sonnet-1022ã€‚åœ¨ç¾å›½æ•°å­¦ç«èµ›ï¼ˆAIME 2024, MATHï¼‰ä¸Šï¼ŒDeepSeek-V3å¾ˆå¤§ç¨‹åº¦åœ°è¶…è¿‡äº†å…¶ä»–æ‰€æœ‰å¼€æºé—­æºæ¨¡å‹ã€‚åœ¨codeforcesæµ‹è¯„ä¸­ï¼ŒDeepSeek-V3å¤§å¹…è¶…è¿‡å…¶ä»–æ¨¡å‹ã€‚å¦å¤–ï¼Œåœ¨ç”Ÿæˆé€Ÿåº¦ä¸Šï¼ŒDeepSeek-V3çš„ç”Ÿæˆåå­—é€Ÿåº¦ä»20TPSï¼ˆTransactions Per Secondï¼‰å¤§å¹…æé«˜è‡³60TPSï¼Œç›¸æ¯”V2.5æ¨¡å‹å®ç°äº†3å€çš„æå‡ï¼Œèƒ½å¤Ÿå¸¦æ¥æ›´åŠ æµç•…çš„ä½¿ç”¨ä½“éªŒã€‚</p><figure><img src="https://s2.loli.net/2025/01/27/31HemjXDW5QbqLs.png" alt="image-20250127224259093" /><figcaption aria-hidden="true">image-20250127224259093</figcaption></figure><h2 id="æ¨¡å‹æ‘˜è¦">3.2 æ¨¡å‹æ‘˜è¦</h2><h3 id="æ¶æ„é‡‡ç”¨åˆ›æ–°çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ä¸è®­ç»ƒç›®æ ‡">æ¶æ„ï¼šé‡‡ç”¨åˆ›æ–°çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ä¸è®­ç»ƒç›®æ ‡</h3><p><em>DeepSeek</em>-<em>V3</em>å¼€åˆ›äº†ä¸€ç§æ— è¾…åŠ©æŸå¤±çš„<em>è´Ÿè½½</em>å¹³è¡¡<em>ç­–ç•¥</em>ï¼Œå¹¶ä¸ºæ›´å¼ºæ€§èƒ½è®¾ç½®äº†å¤štokensé¢„æµ‹è®­ç»ƒç›®æ ‡ã€‚</p><ul><li>åœ¨DeepSeek-V2çš„é«˜æ•ˆæ„æ¶åŸºç¡€ä¸Šï¼ŒDeepSeek-V3å¼€åˆ›æ€§åœ°æå‡ºäº†ä¸€ç§æ— è¾…åŠ©æŸå¤±çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œè¿™ç§ç­–ç•¥å¯ä»¥æœ€å°åŒ–ç”±è¿½æ±‚è´Ÿè½½å‡è¡¡è€Œå¼•èµ·çš„æ€§èƒ½ä¸‹é™ã€‚</li><li>DeepSeek-V3æå‡ºäº†ä¸€ç§å¤šä»¤ç‰Œé¢„æµ‹ï¼ˆMTPï¼‰ç›®æ ‡ï¼Œäº‹å®è¯æ˜å®ƒèƒ½æå‡æ¨¡å‹æ€§èƒ½ã€‚æ­¤å¤–å®ƒèƒ½åº”ç”¨äºæ¨æµ‹è§£ç ä»¥åŠ é€Ÿæ¨ç†è¿‡ç¨‹ã€‚</li></ul><h3 id="é¢„è®­ç»ƒæé«˜çš„è®­ç»ƒæ•ˆç‡">é¢„è®­ç»ƒï¼šæé«˜çš„è®­ç»ƒæ•ˆç‡</h3><ul><li>DeepSeek-V3è®¾è®¡äº†ä¸€ä¸ªFP8æ··åˆç²¾åº¦è®­ç»ƒæ¡†æ¶ï¼Œå¹¶é¦–æ¬¡éªŒè¯äº†FP8è®­ç»ƒåœ¨è¶…å¤§è§„æ¨¡æ¨¡å‹ä¸Šçš„å¯è¡Œæ€§ä¸æœ‰æ•ˆæ€§ã€‚</li><li>é€šè¿‡å¯¹ç®—æ³•ã€æ¡†æ¶ä¸ç¡¬ä»¶çš„ååŒè€ƒé‡ä¸è®¾è®¡ï¼ŒDeppSeek-V3å…‹æœäº†è·¨èŠ‚ç‚¹MoEè®­ç»ƒçš„é€šä¿¡ç“¶é¢ˆï¼Œå‡ ä¹è¾¾åˆ°äº†è®¡ç®—ä¸é€šä¿¡äºŒè€…çš„å®Œå…¨ä¸€è‡´æ€§ã€‚è¿™æ˜¾è‘—åœ°æå‡äº†è®­ç»ƒæ•ˆç‡å¹¶å‡å°‘äº†è®­ç»ƒæˆæœ¬ï¼Œä½¿å¾—ç ”ç©¶äººå‘˜ä¸ç”¨æˆ·å¯ä»¥è¿›ä¸€æ­¥æ‰©å±•æ¨¡å‹è§„æ¨¡è€Œæ— éœ€å…¶ä»–é¢å¤–çš„å¼€é”€ã€‚</li><li>åœ¨ä»…ä»…2.664Mï¼ˆç™¾ä¸‡ï¼‰ ä¸ªH800 GPUå°æ—¶çš„ç»æµä¸æ—¶é—´æˆæœ¬æ¡ä»¶ä¸‹ï¼Œåœ¨14.8Tï¼ˆä¸‡äº¿ï¼‰ä¸ªtokensä¸Šå®Œæˆäº†DeepSeek-V3çš„é¢„è®­ç»ƒï¼Œç”±æ­¤åˆ›å»ºå‡ºè¿™ä¸€å½“æ—¶æœ€å¼ºå¤§ï¼ˆé’ˆå¯¹DeepSeekå…¬å¸å½“æ—¶å¼€æºå®ƒä»¬çš„DeepSeek-V3 æ¨¡å‹æ—¶çš„æ—¶é—´ç‚¹æ¥è¯´ï¼‰çš„å¼€æºåŸºç¡€æ¨¡å‹ï¼ˆåº”è¯¥æ˜¯æŒ‡DeepSeek-V3-Baseï¼‰ã€‚é¢„è®­ç»ƒä¹‹åçš„åç»­è®­ç»ƒé˜¶æ®µä»…èŠ±è´¹äº†0.1Mï¼ˆç™¾ä¸‡ï¼‰ä¸ªGPUå°æ—¶ï¼ˆæ­¤å¤„çš„GPUåº”è¯¥ä»ç„¶æ˜¯æŒ‡H800ï¼‰ã€‚</li></ul><h3 id="åè®­ç»ƒä»deepseek-r1ä¸­è’¸é¦çŸ¥è¯†">åè®­ç»ƒï¼šä»DeepSeek-R1ä¸­è’¸é¦çŸ¥è¯†</h3><p>é€šè¿‡å¼•å…¥ä¸€ç§åˆ›æ–°çš„æ–¹æ³•ï¼Œä»é•¿æ€ç»´é“¾æ¨¡å‹ï¼ˆç‰¹åˆ«æ˜¯DeepSeek-R1ç³»åˆ—æ¨¡å‹ä¸­çš„æŸä¸ªï¼‰è’¸é¦ä¸æå–æ¨ç†èƒ½åŠ›åˆ°æ™®é€šçš„LLMsï¼ˆå¤§è¯­è¨€æ¨¡å‹ï¼Œæ­¤å¤„ç‰¹æŒ‡DeepSeek-V3ï¼‰ã€‚åœ¨æ•´ä¸ªåè®­ç»ƒå·¥ä½œæµç¨‹ä¸­ï¼Œé€šè¿‡ä¼˜é›…åœ°å°†DeepSeek-R1çš„éªŒè¯ä¸åæ€æ¨¡å¼é›†æˆåˆ°DeepSeek-V3 ä¸­ï¼Œæ˜¾è‘—åœ°æå‡äº†DeepSeek-V3 çš„æ¨ç†æ€§èƒ½ã€‚ä¸æ­¤åŒæ—¶ï¼ŒDeepSeek-V3 çš„è¾“å‡ºé£æ ¼ä¸è¾“å‡ºé•¿åº¦ä»å¤„äºå¯æ§èŒƒå›´å†…ã€‚</p><h2 id="æ¨¡å‹ä¸‹è½½">3.3 æ¨¡å‹ä¸‹è½½</h2><table><thead><tr class="header"><th><strong>Model</strong></th><th><strong>#Total Params</strong></th><th><strong>#Activated Params</strong></th><th><strong>Context Length</strong></th><th><strong>Huggingface ä¸‹è½½</strong></th><th>é­”æ­ä¸‹è½½</th></tr></thead><tbody><tr class="odd"><td>DeepSeek-V3-Base</td><td>671B</td><td>37B</td><td>128K</td><td><a href="https://huggingface.co/deepseek-ai/DeepSeek-V3-Base">ğŸ¤— Hugging Face</a></td><td><a href="https://modelscope.cn/models/deepseek-ai/DeepSeek-V3-Base">modelscope</a></td></tr><tr class="even"><td>DeepSeek-V3</td><td>671B</td><td>37B</td><td>128K</td><td><a href="https://huggingface.co/deepseek-ai/DeepSeek-V3">ğŸ¤— Hugging Face</a></td><td><a href="https://modelscope.cn/models/deepseek-ai/DeepSeek-V3">modelscope</a></td></tr></tbody></table><h2 id="å…·ä½“è¯„ä¼°ç»“æœ">3.4 å…·ä½“è¯„ä¼°ç»“æœ</h2><p>å‚è€ƒï¼šhttps://github.com/deepseek-ai/DeepSeek-V3?tab=readme-ov-file#4-evaluation-results</p><h1 id="å››deepseek-r1æ¨¡å‹">å››ã€DeepSeek-R1æ¨¡å‹</h1><p>2025å¹´1æœˆ20æ—¥ï¼ŒDeepSeekæ­£å¼å‘å¸ƒ <a href="https://github.com/deepseek-ai/DeepSeek-R1">DeepSeek-R1</a> æ¨¡å‹ï¼Œå¹¶åŒæ­¥å¼€æºæ¨¡å‹æƒé‡ã€‚DeepSeek-R1åœ¨åè®­ç»ƒé˜¶æ®µå¤§è§„æ¨¡ä½¿ç”¨äº†å¼ºåŒ–å­¦ä¹ æŠ€æœ¯ï¼Œåœ¨ä»…æœ‰æå°‘æ ‡æ³¨æ•°æ®çš„æƒ…å†µä¸‹ï¼Œæå¤§æå‡äº†æ¨¡å‹æ¨ç†èƒ½åŠ›ã€‚ DeepSeek-V3å’ŒDeepSeek-R1ä¸¤æ¬¾æ¨¡å‹ï¼Œæˆæœ¬ä»·æ ¼ä½å»‰ï¼Œæ€§èƒ½ä¸OpenAI-O1æ¨¡å‹ç›¸å½“ï¼Œå¼•èµ·äº†åŒ…æ‹¬ç¾å›½ç¡…è°·åœ¨å†…çš„å¤šå®¶çŸ¥åé¡¶å°–AIå…¬å¸çš„éœ‡æƒŠä¸å…´è¶£ã€‚</p><p>è®ºæ–‡ä¸‹è½½æŸ¥çœ‹ï¼šhttps://github.com/deepseek-ai/DeepSeek-R1/blob/main/DeepSeek_R1.pdf æˆ– https://arxiv.org/pdf/2501.12948 ã€‚</p><p>ä»¥ä¸‹å…³äºDeepSeek-R1æ¨¡å‹çš„é˜è¿°ï¼Œæ¥è‡ªDeepSeek-R1çš„githubä»“åº“å†…å®¹çš„ç¿»è¯‘ã€‚</p><h2 id="æ¨¡å‹ä»‹ç»-1">4.1 æ¨¡å‹ä»‹ç»</h2><p>DeepSeek-R1-Zero ä¸ DeepSeek-R1è¿™ä¸¤ä¸ªæ¨¡å‹æ˜¯åŒæ—¶å¼€æºçš„ï¼ŒDeepSeek-R1-Zero æ˜¯ DeepSeek-R1çš„åŸºç¡€ã€‚</p><p>DeepSeek-R1-Zeroæ¨¡å‹æ˜¯ä¸€ä¸ªæ²¡æœ‰äº‹å…ˆè¿›è¡Œä»»ä½•ï¼ˆsupervised fine-tuningï¼ŒSFTï¼‰ç›‘ç£å¾®è°ƒè€Œåªé€šè¿‡å¤§è§„æ¨¡å¼ºåŒ–å­¦ä¹ ï¼ˆeinforcement learningï¼ŒRLï¼‰è®­ç»ƒå¾—åˆ°çš„æ¨¡å‹ï¼Œæœ€ç»ˆç»“æœè¯æ˜DeepSeek-R1-Zeroæ¨¡å‹å±•ç¤ºäº†å“è¶Šçš„æ¨ç†èƒ½åŠ›ã€‚ä½†äº‹å®ä¸Šï¼ŒDeepSeek-R1-Zeroæ¨¡å‹å¹¶ä¸æ˜¯åå…¨åç¾ï¼Œå®ƒä¹Ÿæœ‰ä¸€äº›æ˜¾è‘—çš„ä¸è¶³æ¯”å¦‚æ— ç©·æ­¢çš„é‡å¤ã€ç³Ÿç³•çš„å¯è¯»æ€§ã€è¯­è¨€æ··åˆè¾“å‡ºç­‰ã€‚ä¸ºäº†è§£å†³è¿™äº›ä¸è¶³å¹¶è¿›ä¸€æ­¥å¼ºåŒ–æ¨ç†èƒ½åŠ›ä¸æå‡æ€§èƒ½ï¼ŒDeepSeek-R1è¢«è®­ç»ƒå‡ºæ¥ã€‚DeepSeek-R1é€šè¿‡å¼•å…¥å¼ºåŒ–å­¦ä¹ å‰çš„å†·å¯åŠ¨æ•°æ®å’Œå¤šé˜¶æ®µè®­ç»ƒæµç¨‹ï¼Œä¸ä»…è§£å†³å‰è¿°éƒ¨åˆ†é—®é¢˜ï¼Œè€Œä¸”æœ€ç»ˆè¾¾åˆ°åœ¨æ•°å­¦ã€ç¼–ç ã€æ¨ç†ç­‰ä»»åŠ¡ä¸Šä¸`OpenAI-o1-1217 æ¨¡å‹ç›¸åª²ç¾çš„æ°´å¹³ã€‚</p><p>ä¸ºäº†å¯¹ç ”ç©¶ç¤¾åŒºè¿›è¡Œæ”¯æŒï¼ŒDeepSeek åœ¨å¼€æºäº†DeepSeek-R1-Zero ä¸ DeepSeek-R1è¿™ä¸¤ä¸ªæ¨¡å‹çš„åŒæ—¶ï¼ŒDeepSeekå…¬å¸åœ¨DeepSeek-R1æ¨¡å‹ç”Ÿæˆçš„æ ·æœ¬æ•°æ®çš„åŸºç¡€ä¸Šå¯¹Llamaæˆ–Qwenæ¨¡å‹è¿›è¡Œäº†å¾®è°ƒä¸è’¸é¦ï¼Œæœ€ç»ˆäº§ç”Ÿäº†6ä¸ªæ€§èƒ½å“è¶Šçš„è’¸é¦æ¨¡å‹å¹¶ä¸”å®ƒä»¬ä¹Ÿè¢«å¼€æºæ¨å‡ºã€‚å…¶ä¸­è’¸é¦æ¨¡å‹<code>DeepSeek-R1-Distill-Qwen-32B</code>åœ¨å¤šé¡¹åŸºå‡†æµ‹è¯•ä¸­çš„è¡¨ç°è¶…è¿‡äº†<code>OpenAI-o1-mini</code>ï¼Œä¸å¤±ä¸ºä¸€ä¸ªæ€§èƒ½å“è‘—çš„ç¨ å¯†æ¨¡å‹ï¼ˆDeepSeekå…¬å¸è‡ªå·±çš„è¯„ä»·ã€‚å•ä»åŸºå‡†æµ‹è¯•ç»“æœä¸Šæ¥çœ‹ï¼Œç¡®å®æ˜¯è¿™æ ·ï¼‰ã€‚</p><p>ä»ä¸‹å›¾ï¼ˆæ¥è‡ªDeepSeek-R1åœ¨githubä¸Šçš„ä»£ç ä»“åº“ï¼‰å¯ä»¥çœ‹å‡ºï¼ŒDeepSeek-R1åœ¨çŸ¥è¯†ç±»ä»»åŠ¡ï¼ˆMMLU, MMLU-Pro, GPQA, SimpleQAï¼‰ä¸Šçš„æ°´å¹³ç›¸æ¯”å‰é¢çš„æœ€å¼ºæ¨¡å‹ DeepSeek-V3 ç¨æœ‰æå‡ï¼Œè¶…è¿‡å…¶ä»–ç»å¤§å¤šæ•°æ¨¡å‹ï¼Œç•¥é€Šäºå½“å‰è¡¨ç°æœ€å¥½çš„ç”±openaiå…¬å¸äºå‰ä¸€å¹´12æœˆå‘å¸ƒçš„æ¨¡å‹OpenAI-o1-1217ã€‚åœ¨ç¾å›½æ•°å­¦ç«èµ›ï¼ˆAIME 2024, MATHï¼‰ä¸Šï¼ŒDeepSeek-R1è¶…è¿‡æ‰€æœ‰å¼€æºé—­æºæ¨¡å‹ï¼Œç•¥èƒœäºOpenAI-o1-1217ã€‚åœ¨codeforcesæµ‹è¯„å³ç¼–ç ç›¸å…³çš„ä»»åŠ¡ä¸­ï¼ŒDeepSeek-R1åœ¨ä»£ç ç«èµ›ä»»åŠ¡ä¸­è¡¨ç°å‡ºä¸“å®¶æ°´å¹³ï¼Œè·å¾—äº†2029 Eloè¯„çº§ï¼Œåœ¨ç«èµ›ä¸­è¡¨ç°ä¼˜äº96.3%çš„äººç±»å‚ä¸è€…ï¼Œè¶…è¿‡å…¶ä»–ç»å¤§å¤šæ•°æ¨¡å‹ã€‚å¯¹äºå·¥ç¨‹ç›¸å…³çš„ä»»åŠ¡ï¼ˆSWE-bench Verifiedï¼‰ï¼ŒDeepSeek-R1çš„è¡¨ç°ç•¥ä¼˜äºOpenAI-o1-1217ã€‚</p><figure><img src="https://s2.loli.net/2025/01/27/4hwdVJaxQl16RMe.png" alt="image-20250127225153880" /><figcaption aria-hidden="true">image-20250127225153880</figcaption></figure><h2 id="æ¨¡å‹æ‘˜è¦-1">4.2 æ¨¡å‹æ‘˜è¦</h2><h3 id="åè®­ç»ƒåŸºäºåŸºç¡€æ¨¡å‹è¿›è¡Œå¤§è§„æ¨¡å¼ºåŒ–å­¦ä¹ ">åè®­ç»ƒï¼šåŸºäºåŸºç¡€æ¨¡å‹è¿›è¡Œå¤§è§„æ¨¡å¼ºåŒ–å­¦ä¹ </h3><ul><li>æˆ‘ä»¬äº‹å…ˆæ²¡æœ‰ä¾èµ–ç›‘ç£å¾®è°ƒï¼Œè€Œæ˜¯ç›´æ¥åœ¨åŸºç¡€æ¨¡å‹ä¸Šå®æ–½äº†å¼ºåŒ–å­¦ä¹ ã€‚è¿™ç§æ–¹æ³•å…è®¸æ¨¡å‹æ¢ç´¢æ€ç»´é“¾å»è§£å†³å¤æ‚é—®é¢˜ï¼Œæœ€ç»ˆè®­ç»ƒå‡ºDeepSeek-R1-Zero æ¨¡å‹ã€‚DeepSeek-R1-Zero åœ¨å±•ç°äº†å¤šæ–¹é¢çš„èƒ½åŠ›æ¯”å¦‚è‡ªæˆ‘éªŒè¯ã€åæ€ä¸ç”Ÿæˆé•¿æ€ç»´é“¾ï¼Œè¿™æˆä¸ºç§‘ç ”ç¤¾åŒºçš„ä¸€ä¸ªé‡è¦çš„é‡Œç¨‹ç¢‘ã€‚ç‰¹åˆ«åœ°ï¼Œè¿™æ˜¯ç¬¬ä¸€ä¸ªéªŒè¯äº†â€œæ²¡æœ‰ç›‘ç£å¾®è°ƒï¼ŒLLMçš„æ¨ç†èƒ½åŠ›ä¹Ÿå¯ä»¥ä»…é€šè¿‡å¼ºåŒ–æ¿€åŠ±å‡ºæ¥â€çš„å¼€æºç ”ç©¶ã€‚è¿™ä¸ªçªç ´ä¸ºæœªæ¥è¿™ä¸ªé¢†åŸŸçš„è¿›æ­¥é“ºå°±äº†é“è·¯ã€‚</li><li>æˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªå·¥ä½œæµæ°´çº¿æ¥ç ”å‘DeepSeek-R1ã€‚è¿™ä¸ªæµæ°´çº¿é‡‡ç”¨äº†ä¸¤ä¸ªå¼ºåŒ–å­¦ä¹ é˜¶æ®µï¼Œå®ƒä»¬æ—¨åœ¨æ¢ç´¢æ›´åŠ å‡†ç¡®é«˜æ•ˆçš„æ¨ç†æ¨¡å¼ã€ç¬¦åˆäººç±»åå¥½ï¼ŒåŒæ—¶ä¹Ÿé‡‡ç”¨äº†ä¸¤ä¸ªç›‘ç£å¾®è°ƒé˜¶æ®µä½œä¸ºæ¨¡å‹æ¨ç†å’Œéæ¨ç†èƒ½åŠ›çš„ç§å­ã€‚</li></ul><h3 id="è’¸é¦å°æ¨¡å‹ä¹Ÿèƒ½æ‹¥æœ‰å¤§æ™ºæ…§">è’¸é¦ï¼šå°æ¨¡å‹ä¹Ÿèƒ½æ‹¥æœ‰å¤§æ™ºæ…§</h3><ul><li>æˆ‘ä»¬è¯æ˜äº†å¤§æ¨¡å‹çš„çš„æ¨ç†æ¨¡å¼å¯ä»¥è¢«è’¸é¦åˆ°æ›´å°çš„æ¨¡å‹ä¸­ï¼Œè€Œä¸”å°æ¨¡å‹çš„æ¨ç†æ¨¡å¼æ¯”ç›´æ¥åœ¨å°æ¨¡å‹ä¸Šå®æ–½å¼ºåŒ–è€Œå¾—åˆ°çš„æ¨ç†æ¨¡å¼æ›´ä¼˜ã€‚å¼€æºçš„DeepSeek-R1åŠå…¶APIå°†æœ‰åŠ©äºç§‘ç ”ç•Œåœ¨æœªæ¥è’¸é¦å‡ºæ›´å°æ›´å¥½çš„æ¨¡å‹ã€‚</li><li>ä½¿ç”¨DeepSeek-R1ç”Ÿæˆçš„æ¨ç†æ•°æ®ï¼Œæˆ‘ä»¬å¯¹å‡ ä¸ªåœ¨ç§‘ç ”ç•Œè¢«å¹¿æ³›ä½¿ç”¨çš„çš„ç¨ å¯†æ¨¡å‹ã€‚è¯„ä¼°ç»“æœè¡¨æ˜ï¼Œè’¸é¦å‡ºæ¥çš„å°å‹ç¨ å¯†æ¨¡å‹åœ¨åŸºå‡†æµ‹è¯•ä¸­çš„è¡¨ç°å‡ºäººæ„æ–™åœ°å¥½ã€‚DeepSeekå…¬å¸åœ¨Qwen2.5 æˆ– Llama3æ¨¡å‹çš„åŸºç¡€ä¸Šè’¸é¦å‡ºäº†1.5Bã€7Bã€8Bã€14Bã€32B å’Œ 70B è¿™6ä¸ªä¸åŒå‚æ•°è§„æ¨¡çš„æ¨¡å‹ï¼Œå¹¶å°†å®ƒä»¬å…¨éƒ¨å¼€æºç»™äº†ç¤¾åŒºã€‚</li></ul><h2 id="æ¨¡å‹ä¸‹è½½-1">4.3 æ¨¡å‹ä¸‹è½½</h2><h3 id="deepseek-r1-æ¨¡å‹">DeepSeek-R1 æ¨¡å‹</h3><table><thead><tr class="header"><th><strong>Model</strong></th><th><strong>#Total Params</strong></th><th><strong>#Activated Params</strong></th><th><strong>Context Length</strong></th><th><strong>Huggingface ä¸‹è½½</strong></th><th>é­”æ­ä¸‹è½½</th></tr></thead><tbody><tr class="odd"><td>DeepSeek-R1-Zero</td><td>671B</td><td>37B</td><td>128K</td><td><a href="https://huggingface.co/deepseek-ai/DeepSeek-R1-Zero">ğŸ¤— HuggingFace</a></td><td><a href="https://modelscope.cn/models/deepseek-ai/DeepSeek-R1-Zero">modelscope</a></td></tr><tr class="even"><td>DeepSeek-R1</td><td>671B</td><td>37B</td><td>128K</td><td><a href="https://huggingface.co/deepseek-ai/DeepSeek-R1">ğŸ¤— HuggingFace</a></td><td><a href="https://modelscope.cn/models/deepseek-ai/DeepSeek-R1">modelscope</a></td></tr></tbody></table><p>DeepSeek-R1-Zero ä¸ DeepSeek-R1 éƒ½æ˜¯ä»DeepSeek-V3-Base è¿™ä¸€æ¨¡å‹è®­ç»ƒè€Œæ¥.</p><h2 id="deepseek-r1-çš„è’¸é¦æ¨¡å‹">DeepSeek-R1 çš„è’¸é¦æ¨¡å‹</h2><table><thead><tr class="header"><th><strong>Model</strong></th><th><strong>Base Model</strong></th><th><strong>Huggingface ä¸‹è½½</strong></th><th>é­”æ­ä¸‹è½½</th></tr></thead><tbody><tr class="odd"><td>DeepSeek-R1-Distill-Qwen-1.5B</td><td><a href="https://huggingface.co/Qwen/Qwen2.5-Math-1.5B">Qwen2.5-Math-1.5B</a></td><td><a href="https://huggingface.co/deepseek-ai/DeepSeek-R1-Distill-Qwen-1.5B">ğŸ¤— HuggingFace</a></td><td><a href="https://modelscope.cn/models/deepseek-ai/DeepSeek-R1-Distill-Qwen-1.5B">modelscope</a></td></tr><tr class="even"><td>DeepSeek-R1-Distill-Qwen-7B</td><td><a href="https://huggingface.co/Qwen/Qwen2.5-Math-7B">Qwen2.5-Math-7B</a></td><td><a href="https://huggingface.co/deepseek-ai/DeepSeek-R1-Distill-Qwen-7B">ğŸ¤— HuggingFace</a></td><td><a href="https://modelscope.cn/models/deepseek-ai/DeepSeek-R1-Distill-Qwen-7B">modelscope</a></td></tr><tr class="odd"><td>DeepSeek-R1-Distill-Llama-8B</td><td><a href="https://huggingface.co/meta-llama/Llama-3.1-8B">Llama-3.1-8B</a></td><td><a href="https://huggingface.co/deepseek-ai/DeepSeek-R1-Distill-Llama-8B">ğŸ¤— HuggingFace</a></td><td><a href="https://modelscope.cn/models/deepseek-ai/DeepSeek-R1-Distill-Llama-8B">modelscope</a></td></tr><tr class="even"><td>DeepSeek-R1-Distill-Qwen-14B</td><td><a href="https://huggingface.co/Qwen/Qwen2.5-14B">Qwen2.5-14B</a></td><td><a href="https://huggingface.co/deepseek-ai/DeepSeek-R1-Distill-Qwen-14B">ğŸ¤— HuggingFace</a></td><td><a href="https://modelscope.cn/models/deepseek-ai/DeepSeek-R1-Distill-Qwen-14B">modelscope</a></td></tr><tr class="odd"><td>DeepSeek-R1-Distill-Qwen-32B</td><td><a href="https://huggingface.co/Qwen/Qwen2.5-32B">Qwen2.5-32B</a></td><td><a href="https://huggingface.co/deepseek-ai/DeepSeek-R1-Distill-Qwen-32B">ğŸ¤— HuggingFace</a></td><td><a href="https://modelscope.cn/models/deepseek-ai/DeepSeek-R1-Distill-Qwen-32B">modelscope</a></td></tr><tr class="even"><td>DeepSeek-R1-Distill-Llama-70B</td><td><a href="https://huggingface.co/meta-llama/Llama-3.3-70B-Instruct">Llama-3.3-70B-Instruct</a></td><td><a href="https://huggingface.co/deepseek-ai/DeepSeek-R1-Distill-Llama-70B">ğŸ¤— HuggingFace</a></td><td><a href="https://modelscope.cn/models/deepseek-ai/DeepSeek-R1-Distill-Llama-70B">modelscope</a></td></tr></tbody></table><p>ä¸Šè¿° DeepSeek-R1-Distill-XXX è¿™äº›éƒ½æ˜¯å¯¹åŒç­‰å‚æ•°è§„æ¨¡çš„DeepSeek-R1 è¿›è¡Œå¾®è°ƒä¸è’¸é¦è€Œå¾—åˆ°çš„ï¼Œå®ƒä»¬ï¼ˆè¿™äº›è’¸é¦æ¨¡å‹ï¼‰ä½¿ç”¨çš„æ•°æ®éƒ½æ˜¯ç”±DeepSeek-R1 ç”Ÿæˆçš„ã€‚åœ¨å¾®è°ƒä¸è’¸é¦å‡ºæ¨¡å‹æ—¶ï¼Œå®ƒä»¬çš„é…ç½®ä¸tokenizerséƒ½æœ‰è¢«æˆ–å¤šæˆ–å°‘çš„æ”¹å˜è¿‡ï¼Œä½¿ç”¨è¿™äº›æ¨¡å‹æ—¶éœ€è¦æ³¨æ„ã€‚</p><h2 id="å…·ä½“è¯„ä¼°ç»“æœ-1">4.4 å…·ä½“è¯„ä¼°ç»“æœ</h2><p>å‚è€ƒï¼šhttps://github.com/deepseek-ai/DeepSeek-R1?tab=readme-ov-file#4-evaluation-results</p><h1 id="äº”ä¸“ä¸šåè¯è§£é‡Š">äº”ã€ä¸“ä¸šåè¯è§£é‡Š</h1><ul><li><p><strong>AGI</strong></p><p>è‹±æ–‡å…¨ç§°æ˜¯â€œartificial general intelligenceâ€ï¼Œä¸­æ–‡ç¿»è¯‘ä¸ºâ€œ<a href="https://zh.wikipedia.org/wiki/%E9%80%9A%E7%94%A8%E4%BA%BA%E5%B7%A5%E6%99%BA%E6%85%A7">é€šç”¨äººå·¥æ™ºèƒ½</a>â€ï¼Œä¹Ÿå«<strong>å¼ºäººå·¥æ™ºèƒ½</strong>ï¼ˆè‹±è¯­ï¼šstrong AIï¼‰ã€‚æ˜¯æŒ‡å…·å¤‡ä¸äººç±»åŒç­‰æ™ºèƒ½ã€æˆ–è¶…è¶Šäººç±»çš„äººå·¥æ™ºèƒ½ï¼Œèƒ½è¡¨ç°æ­£å¸¸äººç±»æ‰€å…·æœ‰çš„æ‰€æœ‰æ™ºèƒ½è¡Œä¸ºã€‚</p></li><li><p><strong><a href="https://huggingface.co/blog/zh/moe">MoE</a></strong></p><p>è‹±æ–‡å…¨ç§°æ˜¯â€Mixture of Expertsâ€œï¼Œä¸­æ–‡ç¿»è¯‘ä¸ºâ€æ··åˆä¸“å®¶æ¨¡å‹â€œï¼Œèµ·æºäº1991 å¹´çš„è®ºæ–‡Adaptive Mixture of Local Expertsã€‚æ··åˆä¸“å®¶æ¨¡å‹ (MoE) çš„ä¸€ä¸ªæ˜¾è‘—ä¼˜åŠ¿æ˜¯å®ƒä»¬èƒ½å¤Ÿåœ¨è¿œå°‘äºç¨ å¯†æ¨¡å‹æ‰€éœ€çš„è®¡ç®—èµ„æºä¸‹è¿›è¡Œæœ‰æ•ˆçš„é¢„è®­ç»ƒã€‚è¿™æ„å‘³ç€åœ¨ç›¸åŒçš„è®¡ç®—é¢„ç®—æ¡ä»¶ä¸‹ï¼Œæ‚¨å¯ä»¥æ˜¾è‘—æ‰©å¤§æ¨¡å‹æˆ–æ•°æ®é›†çš„è§„æ¨¡ã€‚ç‰¹åˆ«æ˜¯åœ¨é¢„è®­ç»ƒé˜¶æ®µï¼Œä¸ç¨ å¯†æ¨¡å‹ç›¸æ¯”ï¼Œæ··åˆä¸“å®¶æ¨¡å‹é€šå¸¸èƒ½å¤Ÿæ›´å¿«åœ°è¾¾åˆ°ç›¸åŒçš„è´¨é‡æ°´å¹³ã€‚</p></li><li><p><strong>è’¸é¦</strong></p><p>æ­¤å¤„çš„è’¸é¦å½“ç„¶ä¸æ˜¯æˆ‘ä»¬åˆä¸­ç‰©ç†å­¦ä¹ çš„è’¸é¦æŠ€æœ¯ï¼Œæ­¤å¤„æ˜¯æŒ‡è’¸é¦æŠ€æœ¯ï¼Œå®ƒå°±åƒæ˜¯å­¦æ ¡é‡Œçš„å­¦ä¹ è¿‡ç¨‹ï¼šè€å¸ˆæ‹¥æœ‰ä¸°å¯Œçš„çŸ¥è¯†å’Œç»éªŒï¼Œå­¦ç”Ÿé€šè¿‡å­¦ä¹ è€å¸ˆçš„çŸ¥è¯†é€æ¸æˆé•¿ã€‚AIä¸­çš„â€œæ•™å¸ˆæ¨¡å‹â€ç›¸å½“äºçŸ¥è¯†æ¸Šåšçš„è€å¸ˆï¼Œå®ƒé€šè¿‡å¤§é‡çš„æ•°æ®è®­ç»ƒï¼ŒæŒæ¡äº†å¤æ‚çš„æ¨¡å¼å’Œç‰¹å¾ï¼›è€Œâ€œå­¦ç”Ÿæ¨¡å‹â€åˆ™åƒæ˜¯ä¸€ä¸ªåˆšåˆšèµ·æ­¥çš„å­¦ç”Ÿï¼Œè™½ç„¶çŸ¥è¯†é¢ä¸å¦‚è€å¸ˆä¸°å¯Œï¼Œä½†é€šè¿‡å­¦ä¹ è€å¸ˆçš„â€œæ€è€ƒæ–¹å¼â€å’Œâ€œç»éªŒâ€ï¼Œå¯ä»¥åœ¨æ²¡æœ‰è¿‡å¤šè®¡ç®—èµ„æºçš„æƒ…å†µä¸‹å–å¾—ä¸é”™çš„æˆç»©ã€‚ä»¥ä¸ªäººç›®å‰çš„çŸ¥è¯†æ¥ç†è§£ï¼Œå°±åƒæ˜¯åº”è¯•æ•™è‚²ä¸è€ƒè¯•ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè’¸é¦æ˜¯ä¸€ç§ä»å·²æœ‰çš„æ¨¡å‹ï¼ˆå½“ç„¶æˆ‘ä»¬ä¼šå°½å¯èƒ½é‡‡ç”¨ä¸šç•Œæœ€é«˜æ°´å‡†çš„æ¨¡å‹ï¼‰ä¸­æå–çŸ¥è¯†çš„æ–¹æ³•ï¼šä½ å¯ä»¥ç»™æ•™å¸ˆæ¨¡å‹ï¼ˆteacher modelï¼‰è¾“å…¥æ•°æ®ï¼Œè®°å½•å®ƒçš„è¾“å‡ºï¼Œå¹¶ç”¨è¿™äº›æ•°æ®è®­ç»ƒå­¦ç”Ÿæ¨¡å‹ï¼ˆstudent modelï¼‰ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œå…¬å¸åªèƒ½å¯¹è‡ªå·±çš„æ¨¡å‹è¿›è¡Œè’¸é¦ï¼Œå› ä¸ºå…¬å¸å¯¹è‡ªå·±çš„æ¨¡å‹æ‹¥æœ‰æ‰€æœ‰çš„å½’å±æƒä¸è®¿é—®æ§åˆ¶æƒé™ã€‚ä¸€èˆ¬åœ°å¯¹å•†ä¸šå…¬å¸å‘å¸ƒçš„è¿›è¡Œè’¸é¦çš„æ–¹æ³•å°±æ˜¯é€šè¿‡ä¸æ–­ã€åå¤è°ƒç”¨å…¶APIæ¥å£ï¼Œè®°å½•è¾“å…¥è¾“å‡ºï¼Œè¾¾åˆ°å¯¹æ­¤å•†ä¸šæ¨¡å‹è¿›è¡Œè’¸é¦çš„ç›®çš„ï¼›ä½†å¯¹å•†ä¸šå…¬å¸å‘å¸ƒçš„å—å•†ä¸šæ¡æ¬¾ä¿æŠ¤çš„æ¨¡å‹è¿›è¡Œè’¸é¦æ˜¯éæ³•çš„ï¼Œå•†ä¸šå…¬å¸ä¹Ÿæ˜¯ä¸¥æŸ¥ä¸¥é˜²æ­¤ç±»è¡Œä¸ºï¼Œé€šå¸¸é€šè¿‡é™åˆ¶APIè®¿é—®ï¼ˆå¦‚åŒä¸€IPåœ¨å•ä½æ—¶é—´å†…è®¿é—®APIçš„é¢‘ç‡ç­‰ï¼‰ï¼Œç”šè‡³ç›´æ¥å°ç¦è®¿é—®IPï¼Œä½†è¿™ä»ç„¶æ˜¯ä¸€ç§æ™®éå­˜åœ¨çš„è®­ç»ƒç­–ç•¥ï¼Œå› æ­¤æˆ‘ä»¬æ‰çœ‹åˆ°è¶Šæ¥è¶Šå¤šçš„æ¨¡å‹åœ¨é€¼è¿‘GPT-4oï¼ˆGPT-4oå°±æ˜¯é€šè¿‡æ­¤æ–¹æ³•ä»GPT-4æ¼”åŒ–è€Œæ¥çš„ï¼‰çš„è´¨é‡ã€‚</p></li><li><p><strong><a href="https://cloud.baidu.com/article/3190441">ç¨€ç–æ¨¡å‹ä¸ç¨ å¯†æ¨¡å‹</a></strong></p><p>åœ¨äººå·¥æ™ºèƒ½é¢†åŸŸï¼Œæ¨¡å‹å¯ä»¥åˆ†ä¸ºç¨€ç–å’Œç¨ å¯†ä¸¤ç§ç±»å‹ã€‚ç¨€ç–æ¨¡å‹é€šå¸¸æ˜¯æŒ‡ç¥ç»ç½‘ç»œä¸­å¤§éƒ¨åˆ†å‚æ•°éƒ½æ˜¯é›¶æˆ–éå¸¸æ¥è¿‘é›¶çš„æ¨¡å‹ï¼Œè€Œç¨ å¯†æ¨¡å‹åˆ™æ˜¯æŒ‡ç¥ç»ç½‘ç»œä¸­å‚æ•°åˆ†å¸ƒè¾ƒä¸ºå‡åŒ€çš„æ¨¡å‹ã€‚</p><p>ç¨€ç–è¯­è¨€æ¨¡å‹æ˜¯ä¸€ç§åŸºäºç¨€ç–ç¼–ç çš„æ¨¡å‹ï¼Œä¸»è¦ç”¨äºè‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡ï¼Œå¦‚æ–‡æœ¬åˆ†ç±»ã€æƒ…æ„Ÿåˆ†æç­‰ã€‚è¯¥æ¨¡å‹åˆ©ç”¨äº†è¯­è¨€æœ¬èº«çš„è¯­æ³•å’Œè¯­ä¹‰ç»“æ„ï¼Œé€šè¿‡å°†æ–‡æœ¬åˆ†è§£ä¸ºä¸€ç³»åˆ—è¯ç»„æˆ–çŸ­è¯­ï¼Œç„¶åå¯¹è¿™äº›è¯ç»„æˆ–çŸ­è¯­è¿›è¡Œç¼–ç ï¼Œæœ€åå†åˆ©ç”¨è¿™äº›ç¼–ç è¿›è¡Œåˆ†ç±»æˆ–æƒ…æ„Ÿåˆ†æã€‚ç”±äºç¨€ç–è¯­è¨€æ¨¡å‹å¯ä»¥è‡ªåŠ¨åœ°è¯†åˆ«æ–‡æœ¬ä¸­çš„å…³é”®è¯å’ŒçŸ­è¯­ï¼Œå› æ­¤åœ¨å¤„ç†è‡ªç„¶è¯­è¨€ä»»åŠ¡æ—¶å…·æœ‰è¾ƒå¥½çš„æ•ˆæœã€‚</p><p>ç¨€ç–ä¼˜åŒ–æ¨¡å‹æ˜¯æŒ‡åŸºäºç¨€ç–æ€§çš„ä¼˜åŒ–ç®—æ³•ï¼Œå…¶åŸºæœ¬æ€æƒ³æ˜¯é€šè¿‡å¼•å…¥ç¨€ç–æ€§çº¦æŸæ¥ä¼˜åŒ–ç›®æ ‡å‡½æ•°ã€‚è¿™ç§ä¼˜åŒ–ç®—æ³•å¯ä»¥åœ¨å¤§è§„æ¨¡æ•°æ®é›†ä¸Šæ‰¾åˆ°æ›´å…·æœ‰ä»£è¡¨æ€§çš„ç‰¹å¾ï¼Œä»è€Œæ›´å¥½åœ°è¿›è¡Œåˆ†ç±»æˆ–å›å½’ç­‰ä»»åŠ¡ã€‚ç¨€ç–ä¼˜åŒ–ç®—æ³•åœ¨æœºå™¨å­¦ä¹ é¢†åŸŸæœ‰ç€å¹¿æ³›çš„åº”ç”¨ï¼Œå¦‚æ”¯æŒå‘é‡æœºã€éšæœºæ£®æ—ç­‰ç®—æ³•ä¸­éƒ½ä½¿ç”¨äº†ç¨€ç–æ€§çº¦æŸã€‚</p><p>ç¨ å¯†æ¨¡å‹åˆ™æ˜¯ç¥ç»ç½‘ç»œä¸­æœ€ä¸ºå¸¸è§çš„æ¨¡å‹ä¹‹ä¸€ï¼Œå…¶ç‰¹ç‚¹æ˜¯æ¯ä¸ªç¥ç»å…ƒéƒ½ä¸è¾“å…¥æ•°æ®ä¸­çš„æ¯ä¸ªå…ƒç´ ç›¸è¿ï¼Œå› æ­¤å¯ä»¥å¤„ç†ä»»æ„å½¢å¼çš„è¾“å…¥æ•°æ®ã€‚ç¨ å¯†æ¨¡å‹åœ¨å›¾åƒè¯†åˆ«ã€è¯­éŸ³è¯†åˆ«ç­‰é¢†åŸŸæœ‰ç€å¹¿æ³›çš„åº”ç”¨ã€‚ç”±äºç¨ å¯†æ¨¡å‹ä¸­å‚æ•°åˆ†å¸ƒè¾ƒä¸ºå‡åŒ€ï¼Œå› æ­¤åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å¯ä»¥å……åˆ†åˆ©ç”¨GPUç­‰ç¡¬ä»¶åŠ é€Ÿå™¨è¿›è¡Œå¹¶è¡Œè®¡ç®—ï¼Œä»è€Œæé«˜è®­ç»ƒé€Ÿåº¦ã€‚</p></li></ul><h1 id="å…­å…¶ä»–ä¿¡æ¯ä¸ç›¸å…³äº‹ä»¶">å…­ã€å…¶ä»–ä¿¡æ¯ä¸ç›¸å…³äº‹ä»¶</h1><h2 id="è¢«é›·å†›æŒ–è§’çš„å¤©æ‰å°‘å¥³ç½—ç¦è‰">6.1 è¢«é›·å†›æŒ–è§’çš„å¤©æ‰å°‘å¥³ç½—ç¦è‰</h2><p>2024å¹´12æœˆä»½ï¼Œé›·å†›ä»¥åƒä¸‡çº§è–ªé…¬æ‹›æ½DeepSeekæ ¸å¿ƒç ”ç©¶å‘˜ã€95åAIå¤©æ‰ç½—ç¦è‰ã€‚æœŸæœ›å¥¹èƒ½é¢†å†›å°ç±³AIå¤§æ¨¡å‹å›¢é˜Ÿçš„å‘å±•ã€‚</p><h2 id="å¹´1æœˆ27æ—¥deepseekç½‘é¡µapiä¸å¯ç”¨">6.2 2025å¹´1æœˆ27æ—¥DeepSeekç½‘é¡µ/APIä¸å¯ç”¨</h2><figure><img src="https://s2.loli.net/2025/01/27/2OhZ6r48oTnp1RQ.png" alt="image-20250127211800641" /><figcaption aria-hidden="true">image-20250127211800641</figcaption></figure><h2 id="deepseekç™»é¡¶ä¸­ç¾åº”ç”¨ä¸‹è½½æ¦œé¦–">6.3 DeepSeekç™»é¡¶ä¸­ç¾åº”ç”¨ä¸‹è½½æ¦œé¦–</h2><p>2025å¹´1æœˆ27æ—¥ï¼ŒDeepSeekåº”ç”¨ç™»é¡¶è‹¹æœç¾å›½åœ°åŒºåº”ç”¨å•†åº—å…è´¹APPä¸‹è½½æ’è¡Œæ¦œï¼Œåœ¨ç¾åŒºä¸‹è½½æ¦œä¸Šè¶…è¶Šäº†ChatGPTã€‚åŒæ—¥ï¼Œè‹¹æœä¸­å›½åŒºåº”ç”¨å•†åº—å…è´¹æ¦œæ˜¾ç¤ºï¼ŒDeepSeekæˆä¸ºä¸­å›½åŒºç¬¬ä¸€ã€‚</p><h2 id="å›½å†…çŸ¥åå…¬å¸çº·çº·æ¥å…¥deepseek">6.4 å›½å†…çŸ¥åå…¬å¸çº·çº·æ¥å…¥DeepSeek</h2><p>DeepSeekæ¨ªç©ºå‡ºä¸–æ¿€èµ·åƒå±‚æµªã€‚è¿‘æ—¥ï¼Œé‡‘å±±äº‘ã€è£è€€æ‰‹æœºã€ä¸œé£æ±½è½¦ç­‰çº·çº·å®£å¸ƒæ¥å…¥DeepSeekã€‚éƒ¨åˆ†åå•ä¸ç»†èŠ‚å‚è€ƒï¼š <a href="https://www.21jingji.com/article/20250208/herald/3d402c19a951d2de6adbd9af2111fe09.html">DeepSeekçœŸé¦™ï¼ä¸‰å¤§è¿è¥å•†ã€å•†æ±¤ç­‰å·²æ¥å…¥ï¼Œåå•è¿˜åœ¨æ‰©å¤§</a> ã€‚æœ€ç»ˆç»“æœè®©å¸‚åœºæ¥æ£€éªŒã€‚</p><h2 id="å›½äº§åŠ é€Ÿå¡çº·çº·åŠ é€Ÿé€‚é…deepseek">6.5 å›½äº§åŠ é€Ÿå¡çº·çº·åŠ é€Ÿé€‚é…DeepSeek</h2><p>DeepSeek-V3åŠDeepSeek-R1çˆ†ç«åï¼Œå›½äº§åŠ é€Ÿå¡å‚å•†å¦‚åä¸ºæ˜‡è…¾ã€å£ä»ç§‘æŠ€ã€å¤©æ•°æ™ºèŠ¯ã€æ‘©å°”çº¿ç¨‹ã€é¾™èŠ¯ä¸­ç§‘ã€æ˜†ä»‘èŠ¯ç­‰çº·çº·åŠ é€Ÿé€‚é…DeepSeekã€‚æœ€ç»ˆç»“æœè®©å¸‚åœºæ¥æ£€éªŒã€‚</p><h1 id="ä¸ƒæ€è€ƒä¸æ€»ç»“">ä¸ƒã€æ€è€ƒä¸æ€»ç»“</h1><ul><li>å¤§æ¨¡å‹ç°åœ¨å·²ç»è¿›å…¥çˆ†å‘é˜¶æ®µï¼Œä½œä¸ºä¸€ä¸ªITäººï¼Œå¦‚æœä¸è½¬è¡Œå°±åªèƒ½å‘å…¶é è¿‘ï¼Œä¸æ–­å­¦ä¹ å¤§æ¨¡å‹çš„åŸç†ã€ç ”å‘ä¸ä½¿ç”¨ã€‚</li><li>æ¨¡å‹è’¸é¦æŠ€æœ¯å¹¶ä¸æ˜¯DeepSeekå…¬å¸å‘æ˜çš„ï¼Œä½†ç¡®æ˜¯å®ƒä»¬å¼€æºDeepSeek-V3ä¸DeepSeek-R1åŠç›¸å…³è’¸é¦æ¨¡å‹åå¼•å‘ç§‘ç ”äººå‘˜ä¸ç ”å‘äººå‘˜å…³æ³¨çš„ï¼Œæ‰€ä»¥ä¸“æ³¨äºå½“å‰çš„æŸä»¶äº‹æƒ…å°†å…¶åšç²¾ï¼Œä¹Ÿèƒ½å–å¾—ä¸€å®šçš„â€œæˆåŠŸâ€ã€‚</li><li>ä»2024å¹´12æœˆåº•åˆ°ç°åœ¨ï¼Œä¸€ä¸ªåŠæœˆå·¦å³æ—¶é—´è¿‡å»äº†ï¼Œå›½å†…è¶Šæ¥è¶Šå¤šçš„å¤§å…¬å¸å¼€æºæ‹¥æŠ±ã€ç ”ç©¶DeepSeekå¼€æºçš„åŸºç¡€æ¨¡å‹åŠå…¶è’¸é¦æ¨¡å‹ï¼Œæ¥å…¥è¿™äº›æ¨¡å‹åˆ°è‡ªå·±çš„äº‘äº§å“æˆ–äººå·¥æ™ºèƒ½æˆ–æ™ºç®—äº§å“ä¸­ï¼Œè¿™äº›äº§å“æ°´å¹³è‚¯å®šæ˜¯å„æœ‰ç‰¹è‰²ï¼Œç”¨æˆ·è¦æ ¹æ®è‡ªå·±éœ€è¦ä¸æ¡ä»¶é€‰æ‹©é€‚åˆè‡ªå·±çš„äº§å“ï¼›æ­¤å¤–è¿™äº›äº§å“çš„æ°´å¹³è‚¯å®šå‚å·®ä¸é½çš„ï¼Œç°åœ¨ä¸ç®¡å¤§å…¬å¸è¿˜æ˜¯å°å…¬å¸éƒ½è¯´è‡ªå·±çš„äº§å“æ¥å…¥DeepSeekç›¸å…³æ¨¡å‹ï¼Œæœ€ç»ˆè¿˜éœ€è¦æˆ‘ä»¬å»å®åœ°æ£€éªŒå®ƒä»¬æ˜¯çœŸå¯ç”¨ï¼Œè¿˜æ˜¯è¯´åœ¨è·Ÿé£è¿½é€å™±å¤´ã€‚</li><li>è¶Šæ¥è¶Šå¤šçš„å›½äº§åŠ é€Ÿå¡ä¹Ÿå¼€å§‹é€‚é…DeepSeekæ¨¡å‹ï¼ŒçœŸæ­£çš„é€‚é…æˆåŠŸè¦çœŸå®ã€é«˜æ•ˆã€å¯ç”¨æ€§å¥½æ‰è¡Œï¼Œè¿™æ ·æ‰èƒ½å¸å¼•ç”¨æˆ·ã€æ‰“å¼€å¸‚åœºã€æ‰©å¤§ç”Ÿæ€ï¼Œæœ€ç»ˆçªç ´ç¾å›½å¯¹æˆ‘ä»¬æ­¤ç±»ç¡¬ä»¶è®¾å¤‡çš„å°é”ç®¡æ§ï¼Œå½¢æˆæˆ‘ä»¬å›½å®¶è‡ªå·±ç¡¬å®åŠ›ä¸ç‰¹è‰²ã€‚æ‹­ç›®ä»¥å¾…å§ï¼</li><li>å…¶ä»–å¾ˆå¤šæ¦‚å¿µä¸åŸç†æœºåˆ¶ï¼Œæš‚æ—¶æ— æ³•å…¨éƒ¨ç†è§£ä¸è§£é‡Šåˆ°ä½ï¼Œæœ‰å¾…åç»­ç»§ç»­å­¦ä¹ ä¸è®°å½•ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>DeepSeek æ·±åº¦æ±‚ç´¢</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>DockeråŠDockerä½œä¸ºé«˜çº§è¿è¡Œæ—¶çš„K8Sä¸­ä½¿ç”¨NVIDIA GPU</title>
    <link href="/2025/01/24/Docker%E5%8F%8ADocker%E4%BD%9C%E4%B8%BA%E9%AB%98%E7%BA%A7%E8%BF%90%E8%A1%8C%E6%97%B6%E7%9A%84K8S%E4%B8%AD%E4%BD%BF%E7%94%A8NVIDIA-GPU/"/>
    <url>/2025/01/24/Docker%E5%8F%8ADocker%E4%BD%9C%E4%B8%BA%E9%AB%98%E7%BA%A7%E8%BF%90%E8%A1%8C%E6%97%B6%E7%9A%84K8S%E4%B8%AD%E4%BD%BF%E7%94%A8NVIDIA-GPU/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€å†™åœ¨å‰é¢">ä¸€ã€å†™åœ¨å‰é¢</h1><p>æœ¬æ–‡ç« æ€»ç»“äº†åœ¨Dockerç¯å¢ƒä½¿ç”¨â€œNVIDIA GPUâ€ï¼Œå®ƒçš„æ•ˆç‡ä¸ç›´æ¥åœ¨ç‰©ç†æœåŠ¡å™¨å¯åŠ¨è¿›ç¨‹ä½¿ç”¨ç‰©ç†æœåŠ¡å™¨ä¸Šçš„NVIDIA GPUæ•ˆç‡å·®ä¸å¤šï¼Œæ‰€ä»¥æ˜¯ä¸€ç§é«˜æ•ˆä¸å¸¸ç”¨çš„NVIDIA GPUäº‘åŸç”Ÿåœºæ™¯ä¸‹çš„ä½¿ç”¨æ–¹å¼ã€‚èƒ½å¤Ÿåœ¨Dockerç¯å¢ƒä½¿ç”¨â€œNVIDIA GPUâ€åï¼Œåªéœ€è¦åœ¨Dockerç¯å¢ƒæ‰€åœ¨çš„æœåŠ¡å™¨ä¸Šå†éƒ¨ç½² Kubernetes ç¯å¢ƒã€å®‰è£…nvidia-device-plugin åå³å¯ä»¥åœ¨ Kubernetes ç¯å¢ƒä½¿ç”¨NVIDIA GPUã€‚</p><p>æœ¬æ–‡ä¸­æ¶‰åŠçš„Dockerç¯å¢ƒå®¿ä¸»æœºçš„æ“ä½œç³»ç»Ÿæœ‰ä¸¤ç§ï¼šUbuntu20-amd64ã€Centos7.9-amd64ã€‚</p><p><strong>å…¶ä»–è¯´æ˜</strong></p><ul><li>æœ¬æ–‡å‡è®¾æœåŠ¡å™¨å®‰è£…æœ‰NVIDIA GPUï¼Œä¸”æ“ä½œç³»ç»Ÿä¸Šå·²ç»å®‰è£…NVIDIAé©±åŠ¨</li><li>æœ¬æ–‡å‡è®¾æœåŠ¡å™¨çš„æ“ä½œç³»ç»Ÿä¸Šå·²ç»å®‰è£…å¥½ Docker æœåŠ¡</li><li>æœ¬æ–‡ä¸å¯¹å…¶ä¸­åŸç†ç»†èŠ‚ï¼ˆå¦‚nvidia-docker2/nvidia-container-toolkitçš„å·¥ä½œåŸç†ï¼‰è¿›è¡Œé˜è¿°ï¼Œæ­¤éƒ¨åˆ†å†…å®¹è¿‡å¤šï¼Œå°†å•ç‹¬æ•´ç†æˆæ–‡</li></ul><h1 id="äºŒubuntu202224-amd64">äºŒã€Ubuntu20/22/24-amd64</h1><p>æ­¤ç« èŠ‚åœ¨Ubuntu20-amd64ä¸­éªŒè¯æˆåŠŸã€‚Ubuntu22/24-amd64æ“ä½œç³»ç»Ÿä¸Šï¼Œå®‰è£…é…ç½®Dockerç¯å¢ƒåŠç›¸å…³é…ç½®æ­¥éª¤åº”è¯¥è·ŸUbuntu20-amd64ä¸­ä¸€æ ·ï¼ˆä¸ªäººçŒœæµ‹ï¼Œè¿˜æ²¡éªŒè¯ï¼‰</p><h2 id="è®¾ç½®-repository-å’Œ-gpg-key">2.1 è®¾ç½® repository å’Œ GPG key</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">distribution=$(. /etc/os-release;echo $ID$VERSION_ID)<br>curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add -<br>curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | sudo tee /etc/apt/sources.list.d/nvidia-docker.list<br></code></pre></td></tr></table></figure><h2 id="å®‰è£…-nvidia-docker2">2.2 å®‰è£… nvidia-docker2</h2><p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html">Installing the NVIDIA Container Toolkit</a>ã€<a href="https://github.com/NVIDIA/nvidia-container-toolkit">nvidia-container-toolkitçš„githubä»“åº“</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">nvidia-docker2 è½¯ä»¶åŒ…åŒ…æ‹¬ä¸€ä¸ªè‡ªå®šä¹‰çš„ daemon.json æ–‡ä»¶ï¼Œç”¨äºå°† NVIDIA è¿è¡Œæ—¶æ³¨å†Œä¸º Docker çš„é»˜è®¤è¿è¡Œæ—¶ï¼Œä»¥åŠä¸€ä¸ªå‘åå…¼å®¹ NVIDIA -Docker 1.0 çš„è„šæœ¬ã€‚</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœå®‰è£…äº† NVIDIA -docker 1.0 ï¼Œåˆ™éœ€è¦åœ¨å®‰è£… NVIDIA è¿è¡Œæ—¶ä¹‹å‰åˆ é™¤å®ƒå’Œä»»ä½•ç°æœ‰çš„ GPU å®¹å™¨ã€‚</span><br>apt-get update<br>apt-get install -y nvidia-docker2<br></code></pre></td></tr></table></figure><figure><img src="https://s2.loli.net/2025/01/24/i6HBhGcNQzgCm7q.png" alt="image-20250124161020395" /><figcaption aria-hidden="true">image-20250124161020395</figcaption></figure><h2 id="é…ç½®-docker-å®ˆæŠ¤è¿›ç¨‹æ–‡ä»¶">2.3 é…ç½® Docker å®ˆæŠ¤è¿›ç¨‹æ–‡ä»¶</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#é…ç½® Docker å®ˆæŠ¤è¿›ç¨‹ä»¥ä½¿ç”¨ NVIDIA å®¹å™¨è¿è¡Œæ—¶ï¼š å°†é»˜è®¤è¿è¡Œæ—¶è®¾ç½®ä¸º nvidiaã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºå®ƒã€‚å­˜åœ¨æ—¶å°±é…Œæƒ…ä¿®æ”¹/etc/docker/daemon.json</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¢åŠ å¦‚ä¸‹å†…å®¹</span><br>root@controller01:~# cat /etc/docker/daemon.json<br>&#123;<br>  &quot;default-runtime&quot;: &quot;nvidia&quot;,<br>  &quot;runtimes&quot;: &#123;<br>    &quot;nvidia&quot;: &#123;<br>      &quot;path&quot;: &quot;/usr/bin/nvidia-container-runtime&quot;,<br>      &quot;runtimeArgs&quot;: []<br>    &#125;<br>  &#125;<br><span class="hljs-meta prompt_">  #</span><span class="language-bash">å…¶ä»–çš„è‡ªå®šä¹‰é…ç½®</span><br>&#125;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æœ€ç»ˆå¾—åˆ°çš„daemon.jsonæ–‡ä»¶å†…å®¹å¯èƒ½å¦‚ä¸‹ï¼š</span><br>root@controller01:~# cat /etc/docker/daemon.json<br>&#123;<br>  &quot;default-runtime&quot;: &quot;nvidia&quot;,<br>  &quot;runtimes&quot;: &#123;<br>    &quot;nvidia&quot;: &#123;<br>      &quot;path&quot;: &quot;/usr/bin/nvidia-container-runtime&quot;,<br>      &quot;runtimeArgs&quot;: []<br>    &#125;<br>  &#125;,<br><span class="hljs-meta prompt_">  #</span><span class="language-bash">å…¶ä»–çš„è‡ªå®šä¹‰é…ç½®</span><br>  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],<br>  &quot;dns&quot;: [<br>    &quot;223.5.5.5&quot;,<br>    &quot;223.6.6.6&quot;,<br>    &quot;202.103.0.68&quot;,<br>    &quot;8.8.8.8&quot;<br>  ],<br>  &quot;insecure-registries&quot;: [<br>    &quot;172.20.0.21:4000&quot;, #è‡ªå·±çš„harborä»“åº“<br>    &quot;172.24.0.31:443&quot;<br>  ],<br>  &quot;log-opts&quot;: &#123;<br>    &quot;max-file&quot;: &quot;5&quot;,<br>    &quot;max-size&quot;: &quot;50m&quot;<br>  &#125;,<br>  &quot;registry-mirrors&quot;: [<br>    &quot;https://registry.aliyuncs.com&quot;,<br>    &quot;https://registry.docker-cn.com&quot;,<br>    &quot;https://docker.chenby.cn&quot;,<br>    &quot;https://docker.registry.cyou&quot;,<br>    &quot;https://docker-cf.registry.cyou&quot;,<br>    &quot;https://dockercf.jsdelivr.fyi&quot;,<br>    &quot;https://docker.jsdelivr.fyi&quot;,<br>    &quot;https://dockertest.jsdelivr.fyi&quot;,<br>    &quot;https://dockerproxy.com&quot;,<br>    &quot;https://docker.m.daocloud.io&quot;,<br>    &quot;https://docker.nju.edu.cn&quot;,<br>    &quot;https://docker.mirrors.sjtug.sjtu.edu.cn&quot;,<br>    &quot;https://docker.mirrors.ustc.edu.cn&quot;,<br>    &quot;https://mirror.iscas.ac.cn&quot;,<br>    &quot;https://docker.rainbond.cc&quot;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="é‡å¯dockerè¿›ç¨‹">2.4 é‡å¯dockerè¿›ç¨‹</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">é‡å¯dockerè¿›ç¨‹</span><br>systemctl daemon-reload <br>systemctl restart docker<br></code></pre></td></tr></table></figure><h2 id="è‡³æ­¤å·²å¯åœ¨dockerå®¹å™¨ä¸­ä½¿ç”¨nvidia-gpu">2.5 è‡³æ­¤å·²å¯åœ¨Dockerå®¹å™¨ä¸­ä½¿ç”¨NVIDIA GPU</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨ä¸€å¼ å¡ï¼š--gpus=<span class="hljs-string">&#x27;&quot;device=0&quot;&#x27;</span>ï¼›ä½¿ç”¨ç¬¬0,1å¼ å¡ï¼š--gpus=<span class="hljs-string">&#x27;&quot;device=0,1&quot;&#x27;</span>ï¼›ä½¿ç”¨å…¨éƒ¨GPUï¼š--gpus all</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é€šè¿‡åºå·æŒ‡å®šGPUï¼ˆæ­¤æ—¶ä¸è¦åŠ â€œ--privilegedâ€å‚æ•°ï¼Œå¦åˆ™ä»ç„¶å¯ä»¥çœ‹åˆ°æ‰€æœ‰GPUï¼‰</span><br>docker run -idt \<br>  --name ubuntu2204 \<br>  --gpus=&#x27;&quot;device=0,1&quot;&#x27; \<br>  ubuntu:22.04<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŒ‡å®šæ‰€æœ‰GPU</span><br>docker run -idt \<br>  --name ubuntu2204 \<br>  --gpus all \<br>  ubuntu:22.04<br></code></pre></td></tr></table></figure><h2 id="å®‰è£…nvidia-device-plugin">2.6 å®‰è£…nvidia-device-plugin</h2><p>æ­¤æ­¥éª¤åŠåç»­æ­¥éª¤éœ€è¦å…ˆå®‰è£…å¥½K8Sç¯å¢ƒï¼Œä¸”è¦æ±‚K8Sç¯å¢ƒä½¿ç”¨é«˜çº§å®¹å™¨è¿è¡Œæ—¶æ˜¯Dockerã€‚</p><p>éƒ¨ç½²ä½¿ç”¨é«˜çº§å®¹å™¨è¿è¡Œæ—¶æ˜¯Dockerçš„K8Sç¯å¢ƒæ–‡æ¡£ï¼Œå¯å‚è§å‰é¢å‘å¸ƒçš„åšå®¢æ–‡ç« </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹è½½å¹¶åº”ç”¨nvidia-device-pluginï¼ˆæœ€æ–°çš„æ–‡ä»¶è§https://github.com/NVIDIA/k8s-device-pluginï¼‰</span><br>wget https://raw.githubusercontent.com/NVIDIA/k8s-device-plugin/v0.14.1/nvidia-device-plugin.yml<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åº”ç”¨æ­¤yamlæ–‡ä»¶</span><br>kubectl create -f nvidia-device-plugin.yml <br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…æˆåŠŸåï¼Œå¯ä»¥åœ¨kube-systemç©ºé—´ä¸‹çœ‹åˆ°ä¸€ä¸ªè¿è¡Œæ­£å¸¸çš„ ds/nvidia-device-plugin-daemonset ï¼ˆç¬”è€…k8sç¯å¢ƒåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ­¤èŠ‚ç‚¹ä¸Šæœ‰NVIDIA GPUï¼‰</span><br>root@controller01:~# kubectl -n kube-system get daemonsets.apps <br>NAME                             DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE<br>...<br>nvidia-device-plugin-daemonset   1         1         1       1            1           &lt;none&gt;                   2m20s<br></code></pre></td></tr></table></figure><h2 id="éªŒè¯k8sä¸­gpuæ˜¯å¦å¯ç”¨">2.7 éªŒè¯k8sä¸­GPUæ˜¯å¦å¯ç”¨</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">1 éªŒè¯NVIDIA GPUæ˜¯å¦å·²ç»æ³¨å†Œåˆ°k8sèŠ‚ç‚¹</span><br>kubectl describe node controller01   #å‡è®¾controller01ä¸Šé¢æœ‰NVIDIA GPU<br></code></pre></td></tr></table></figure><figure><img src="https://s2.loli.net/2025/01/24/ObVELMWmphUcDly.png" alt="image-20250124163002248" /><figcaption aria-hidden="true">image-20250124163002248</figcaption></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">2 éªŒè¯k8sä¸­èƒ½å¦æ­£å¸¸ä½¿ç”¨NVIDIA GPU</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»ºä¸€ä¸ªpodä»¥è¯•ç”¨GPUï¼Œæ­¤podå®šä¹‰æ–‡ä»¶å¦‚ä¸‹</span><br>root@controller01:~# touch RunningGPUJobs.yaml<br>apiVersion: v1<br>kind: Pod<br>metadata:<br>  name: gpu-pod<br>spec:<br>  restartPolicy: Never<br>  containers:<br>    - name: cuda-container<br>      image: nvcr.io/nvidia/k8s/cuda-sample:vectoradd-cuda10.2<br>      resources:<br>        limits:<br>          nvidia.com/gpu: 1 # requesting 1 GPU<br>  tolerations:<br>  - key: nvidia.com/gpu<br>    operator: Exists<br>    effect: NoSchedule<br><br>root@controller01:~# kubectl apply -f RunningGPUJobs.yaml<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸Šè¿°å‘½ä»¤å°†åœ¨é»˜è®¤å‘½åç©ºé—´ä¸‹åˆ›å»ºä¸€ä¸ªpod/gpu-podï¼Œå®ƒå¤„äºRunningçŠ¶æ€åï¼Œå…¶ä¸­ç¨‹åºå¾ˆå¿«å°±ä¼šè¿è¡Œå®Œæˆä»é¢podå˜æˆCompletedçŠ¶æ€</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹pod/gpu-podçš„æ—¥å¿—</span><br>root@controller01:~# kubectl logs gpu-pod<br></code></pre></td></tr></table></figure><figure><img src="https://s2.loli.net/2025/01/24/XxIRLElK5gHhnBQ.png" alt="image-20250124163229713" /><figcaption aria-hidden="true">image-20250124163229713</figcaption></figure><h1 id="ä¸‰centos7.9-amd64">ä¸‰ã€Centos7.9-amd64</h1><h2 id="é…ç½®repository">3.1 é…ç½®Repository</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">distribution=$(. /etc/os-release;echo $ID$VERSION_ID)<br><br>curl -s -L https://nvidia.github.io/nvidia-container-runtime/$distribution/nvidia-container-runtime.repo | tee /etc/yum.repos.d/nvidia-container-runtime.repo<br></code></pre></td></tr></table></figure><h2 id="å®‰è£…-nvidia-docker2-1">3.2 å®‰è£… nvidia-docker2</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">yum makecache -<span class="hljs-attribute">y</span><br>yum install nvidia-docker2 -<span class="hljs-attribute">y</span><br></code></pre></td></tr></table></figure><figure><img src="https://s2.loli.net/2025/01/24/hzQefDJkBIiX86l.png" alt="image-20250124163714236" /><figcaption aria-hidden="true">image-20250124163714236</figcaption></figure><p>åç»­æ­¥éª¤è·Ÿâ€œUbuntu20/22/24-amd64â€ä¸Šæ—¶ä¸€æ ·</p><h1 id="å››å‡ ä¸ªå®¹å™¨é•œåƒåŒæ­¥ç½‘ç«™">å››ã€å‡ ä¸ªå®¹å™¨é•œåƒåŒæ­¥ç½‘ç«™</h1><p>docker proxyï¼š<a href="https://dockerproxy.net/">docker proxy</a></p><p>public-image-mirrorï¼š<a href="https://github.com/DaoCloud/public-image-mirror">public-image-mirror</a></p><p>æ¸¡æ¸¡é¸Ÿé•œåƒåŒæ­¥ç«™ï¼š<a href="https://docker.aityp.com/">https://docker.aityp.com/</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HAMiä½¿ç”¨è¿‡ç¨‹ä¸­é—®é¢˜å¤„ç†</title>
    <link href="/2025/01/23/HAMi%E4%BD%BF%E7%94%A8%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/"/>
    <url>/2025/01/23/HAMi%E4%BD%BF%E7%94%A8%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>HAMi-WebUIçš„éƒ¨ç½²ä¸ä½¿ç”¨</title>
    <link href="/2025/01/22/HAMi-WebUI%E7%9A%84%E9%83%A8%E7%BD%B2%E4%B8%8E%E4%BD%BF%E7%94%A8/"/>
    <url>/2025/01/22/HAMi-WebUI%E7%9A%84%E9%83%A8%E7%BD%B2%E4%B8%8E%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€ä»‹ç»"><a href="#ä¸€ã€ä»‹ç»" class="headerlink" title="ä¸€ã€ä»‹ç»"></a>ä¸€ã€ä»‹ç»</h1><p>HAMi-WebUIé¡¹ç›®å®˜ç½‘ï¼š<a href="https://github.com/Project-HAMi/HAMi-WebUI">https://github.com/Project-HAMi/HAMi-WebUI</a></p><p>æ ¹æ®å®˜ç½‘çš„ä»‹ç»ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºäºå¼€æºé¡¹ç›®HAMiçš„å¦ä¸€å¼€æºé¡¹ç›®ï¼Œä¸»è¦ç”¨æ¥ç®¡ç†ä¸ç›‘è§†GPUç­‰åŠ é€Ÿè®¾å¤‡èµ„æºçš„ã€‚å®ƒé€šè¿‡æä¾›ä¸€ä¸ªå¯è§†åŒ–çš„webæ¥å£æ‰©å±•äº†HAMiçš„åŠŸèƒ½ä¸å¯ç”¨æ€§ï¼Œè¿™ä¸ªwebæ¥å£å¯ä»¥æŸ¥çœ‹ä¸ç®¡ç†è·¨èŠ‚ç‚¹çš„GPUèµ„æºåˆ†é…ä¸ä½¿ç”¨æƒ…å†µã€‚HAMi-WebUIæ”¯æŒé’ˆå¯¹ä»»åŠ¡ä¸GPUä½¿ç”¨ç»†èŠ‚çš„æŸ¥çœ‹ï¼Œä½¿å¾—å›¢é˜Ÿäººå‘˜èƒ½é«˜æ•ˆåœ°æŸ¥çœ‹ä¸ç›‘æ§ç›¸å…³èµ„æºçš„ä½¿ç”¨ä¸æ¶ˆè€—æƒ…å†µï¼Œæ›´å¥½åœ°è¿›è¡Œå›¢é˜Ÿåä½œå¼€å‘ã€æ›´åŠ ä¾¿æ·ä¸å……åˆ†ä½¿ç”¨ç›¸å…³èµ„æºã€‚å®ƒå…·ä½“æä¾›å¦‚ä¸‹4ä¸ªåŠŸèƒ½ï¼š</p><ul><li><strong>èµ„æºæ¦‚è§ˆ:</strong> æä¾›æ‰€æœ‰èµ„æºçš„ç»¼åˆè§†å›¾ï¼ŒåŒ…æ‹¬èŠ‚ç‚¹å’Œæ˜¾å¡çš„èµ„æºä½¿ç”¨æƒ…å†µã€‚å¿«é€Ÿè¯„ä¼°æ‰€æœ‰èŠ‚ç‚¹å’Œæ˜¾å¡çš„çŠ¶æ€ã€‚</li><li><strong>èŠ‚ç‚¹ç®¡ç†:</strong> æµè§ˆè¯¦ç»†çš„èŠ‚ç‚¹ä¿¡æ¯ï¼ŒåŒ…æ‹¬èŠ‚ç‚¹çŠ¶æ€ã€èµ„æºä½¿ç”¨æƒ…å†µã€‚</li><li><strong>æ˜¾å¡ç®¡ç†:</strong> å¯è§†åŒ–å„èŠ‚ç‚¹çš„æ˜¾å¡ä½¿ç”¨æƒ…å†µï¼Œè¯¦ç»†å±•ç¤ºç®—åŠ›ä¸æ˜¾å­˜çš„åˆ†é…ä¸ä½¿ç”¨ã€‚</li><li><strong>ä»»åŠ¡ç®¡ç†:</strong> è¿½è¸ªä»»åŠ¡åŠå…¶èµ„æºæ¶ˆè€—ã€‚æŸ¥çœ‹ä»»åŠ¡åˆ›å»ºæ—¶é—´ã€çŠ¶æ€ã€æ˜¾å¡åˆ†é…ç­‰ä¿¡æ¯ã€‚</li></ul><h1 id="äºŒã€éƒ¨ç½²"><a href="#äºŒã€éƒ¨ç½²" class="headerlink" title="äºŒã€éƒ¨ç½²"></a>äºŒã€éƒ¨ç½²</h1><p>éƒ¨ç½²æ–‡æ¡£ï¼š<a href="https://github.com/Project-HAMi/HAMi-WebUI/blob/main/docs/installation/helm/index.md">https://github.com/Project-HAMi/HAMi-WebUI/blob/main/docs/installation/helm/index.md</a></p><p>éƒ¨ç½²HAMi-WebUIä¹‹å‰å¿…é¡»å…ˆæ»¡è¶³ä»¥ä¸‹å…ˆå†³æ¡ä»¶ï¼š</p><ul><li>å·²ç»éƒ¨ç½²å¥½äº†k8sç¯å¢ƒï¼ˆå¯¹k8sç‰ˆæœ¬è¦æ±‚ç”±HAMiç‰ˆæœ¬å†³å®šï¼Œå…·ä½“æŸ¥çœ‹HAMiå®˜æ–¹å®‰è£…æ–‡æ¡£ï¼‰</li><li>å·²ç»éƒ¨ç½²å¥½HAMiç¯å¢ƒä¸”å…¶ç‰ˆæœ¬&gt;&#x3D;2.4.0</li><li>éƒ¨ç½²å¥½Prometheusä¸”å…¶ç‰ˆæœ¬&gt;2.8.0</li><li>éƒ¨ç½²å¥½Helmä¸”å…¶ç‰ˆæœ¬&gt;3.0 ï¼ˆç›®å‰å®˜æ–¹æ–‡æ¡£ä¸­è¯´æ˜äº†é€šè¿‡helmå®‰è£…HAMi-WebUIè¿™ä¸€å®‰è£…é€”ç»ä¸å·¥å…·ï¼‰</li></ul><h2 id="2-1-éƒ¨ç½²HAMi-WebUI-Helm-charts"><a href="#2-1-éƒ¨ç½²HAMi-WebUI-Helm-charts" class="headerlink" title="2.1 éƒ¨ç½²HAMi-WebUI Helm charts"></a>2.1 éƒ¨ç½²HAMi-WebUI Helm charts</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">1.æ·»åŠ HAMi-WebUI repository</span><br>helm repo add hami-webui https://project-hami.github.io/HAMi-WebUI<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">2.ä½¿ç”¨helméƒ¨ç½²HAMi-WebUIï¼ˆå…¶ä¸­externalPrometheus.addresså‚æ•°çš„å€¼ä»¥k8sç¯å¢ƒä¸­prometheuså®é™…æœåŠ¡åä¸ºå‡†ï¼Œç«¯å£ä¸€èˆ¬éƒ½æ˜¯9090ï¼‰</span><br>helm install my-hami-webui hami-webui/hami-webui --set externalPrometheus.enabled=true --set externalPrometheus.address=&quot;http://prometheus-k8s.monitoring.svc.cluster.local:9090&quot; -n kube-system<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸Šè¿°å‘½ä»¤æ‰§è¡Œåï¼Œä¼šæœ‰å¦‚ä¸‹è¾“å‡º</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">NAME: my-hami-webui</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">LAST DEPLOYED: Wed Jan 22 14:46:54 2025</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">NAMESPACE: kube-system</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">STATUS: deployed</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">REVISION: 1</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">TEST SUITE: None</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">NOTES:</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">1. Get the application URL by running these commands:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"> <span class="hljs-built_in">export</span> POD_NAME=$(kubectl get pods --namespace kube-system -l <span class="hljs-string">&quot;app.kubernetes.io/name=hami-webui,app.kubernetes.io/instance=my-hami-webui&quot;</span> -o <span class="hljs-comment">#jsonpath=&quot;&#123;.items[0].metadata.name&#125;&quot;)</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"> <span class="hljs-built_in">export</span> CONTAINER_PORT=$(kubectl get pod --namespace kube-system <span class="hljs-variable">$POD_NAME</span> -o jsonpath=<span class="hljs-string">&quot;&#123;.spec.containers[0].ports[0].containerPort&#125;&quot;</span>)</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Visit http://127.0.0.1:3000 to use your application&quot;</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"> kubectl --namespace kube-system port-forward <span class="hljs-variable">$POD_NAME</span> 3000:<span class="hljs-variable">$CONTAINER_PORT</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä»¥ä¸‹æ˜¯æ‰§è¡Œ<span class="hljs-string">&quot;helm install xxx&quot;</span>å‰çš„ç¡®è®¤æ€§å‘½ä»¤</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹ä¸ç¡®è®¤k8sç¯å¢ƒä¸­prometheuså®é™…æœåŠ¡åä¸ç«¯å£</span><br>root@controller01:~# kubectl -n monitoring get svc | egrep &quot;NAME|prometheus&quot;<br>NAME                    TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                         AGE<br>prometheus-adapter      ClusterIP   10.68.33.74     &lt;none&gt;        443/TCP                         11d<br>prometheus-k8s          NodePort    10.68.168.213   &lt;none&gt;        9090:31819/TCP,8080:31903/TCP   11d<br>prometheus-operated     ClusterIP   None            &lt;none&gt;        9090/TCP                        11d<br>prometheus-operator     ClusterIP   None            &lt;none&gt;        8443/TCP                        11d<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç¡®è®¤ prometheus-k8s.monitoring.svc.cluster.local æœåŠ¡åæ˜¯å¦å¯ç”¨</span><br>root@controller01:~# kubectl run -it --restart=Never --image=swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/infoblox/dnstools:v3 dnstools --rm<br>If you don&#x27;t see a command prompt, try pressing enter.<br><span class="hljs-meta prompt_">dnstools# </span><span class="language-bash"></span><br><span class="language-bash">dnstools# nslookup prometheus-k8s.monitoring.svc.cluster.local</span><br>Server:         169.254.20.10<br>Address:        169.254.20.10#53<br><br>Name:   prometheus-k8s.monitoring.svc.cluster.local<br>Address: 10.68.168.213<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">dnstools# </span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">3.æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ç¡®è®¤å®‰è£…ç»“æœ</span><br>root@controller01:~# kubectl get pods -n kube-system | grep webui<br>my-hami-webui-c6f4b6c98-mpgd7                2/2     Running   0            17h<br>my-hami-webui-dcgm-exporter-v6gnx            1/1     Running   0            16m<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å…¶ä¸­ä½¿ç”¨åˆ°äº†é•œåƒâ€œnvcr.io/nvidia/k8s/dcgm-exporter:3.3.7-3.5.0-ubuntu22.04â€å¾ˆå¯èƒ½ä¸‹è½½å¤±è´¥</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">4.æŸ¥çœ‹svcå¹¶ä¿®æ”¹svcç±»å‹ä¸ºNodePort</span><br>root@controller01:~# kubectl -n kube-system get svc<br>NAME                          TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                         AGE<br>dashboard-metrics-scraper     ClusterIP   10.68.5.223     &lt;none&gt;        8000/TCP                        12d<br>hami-device-plugin-monitor    NodePort    10.68.183.209   &lt;none&gt;        31992:31992/TCP                 8d<br>hami-scheduler                NodePort    10.68.83.62     &lt;none&gt;        443:31998/TCP,31993:31993/TCP   8d<br>kube-dns                      ClusterIP   10.68.0.2       &lt;none&gt;        53/UDP,53/TCP,9153/TCP          12d<br>kube-dns-upstream             ClusterIP   10.68.48.155    &lt;none&gt;        53/UDP,53/TCP                   12d<br>kubelet                       ClusterIP   None            &lt;none&gt;        10250/TCP,10255/TCP,4194/TCP    12d<br>kubernetes-dashboard          NodePort    10.68.176.76    &lt;none&gt;        443:30119/TCP                   12d<br>metrics-server                ClusterIP   10.68.24.142    &lt;none&gt;        443/TCP                         12d<br>my-hami-webui                 ClusterIP   10.68.74.135    &lt;none&gt;        3000/TCP,8000/TCP               17h<br>my-hami-webui-dcgm-exporter   ClusterIP   10.68.174.215   &lt;none&gt;        9400/TCP                        17h<br>node-local-dns                ClusterIP   None            &lt;none&gt;        9253/TCP                        12d<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†svc/my-hami-webui ç±»å‹ç”±ClusterIPä¿®æ”¹ä¸ºNodePort</span><br>root@controller01:~# kubectl -n kube-system get svc | grep webui<br>my-hami-webui                 NodePort    10.68.74.135    &lt;none&gt;        3000:31254/TCP,8000:32691/TCP   17h<br>my-hami-webui-dcgm-exporter   ClusterIP   10.68.174.215   &lt;none&gt;        9400/TCP                        17h<br></code></pre></td></tr></table></figure><h2 id="2-2-è®¿é—®HAMi-WebUI"><a href="#2-2-è®¿é—®HAMi-WebUI" class="headerlink" title="2.2 è®¿é—®HAMi-WebUI"></a>2.2 è®¿é—®HAMi-WebUI</h2><p>http:&#x2F;&#x2F;{k8sé›†ç¾¤ä»»æ„èŠ‚ç‚¹IP}:{svc&#x2F;my-hami-webuiçš„åœ¨k8sèŠ‚ç‚¹ä¸Šçš„æ˜ å°„ç«¯å£å·}ï¼Œæ ¹æ®ä¸Šè¿°å‘½ä»¤çš„å›æ˜¾ç»“æœï¼Œsvc&#x2F;my-hami-webuiçš„åœ¨k8sèŠ‚ç‚¹ä¸Šçš„æ˜ å°„ç«¯å£å·æ˜¯31254ã€‚ å¦‚æœk8sé›†ç¾¤ä¸­æŸä¸ªæ§åˆ¶èŠ‚ç‚¹IPæ˜¯172.20.0.21ï¼Œåˆ™HAMi-WebUIçš„è®¿é—®urlæ˜¯å¦‚ä¸‹ï¼š</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">http:</span><span class="hljs-comment">//172.20.0.21:31254</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/23/skNFOavBxmIPH4z.png" alt="image-20250123093641069"></p><h2 id="2-3-å¸è½½HAMi-WebUI"><a href="#2-3-å¸è½½HAMi-WebUI" class="headerlink" title="2.3 å¸è½½HAMi-WebUI"></a>2.3 å¸è½½HAMi-WebUI</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:~# helm -n kube-system uninstall my-hami-webui <br></code></pre></td></tr></table></figure><h2 id="2-4-æŠ¥é”™ä¸å¤„ç†"><a href="#2-4-æŠ¥é”™ä¸å¤„ç†" class="headerlink" title="2.4 æŠ¥é”™ä¸å¤„ç†"></a>2.4 æŠ¥é”™ä¸å¤„ç†</h2><h3 id="2-4-1-pod-my-hami-webui-dcgm-exporteræç¤ºâ€Failed-to-watch-metrics-Error-watching-fields-The-third-party-Profiling-module-returned-an-unrecoverable-errorâ€"><a href="#2-4-1-pod-my-hami-webui-dcgm-exporteræç¤ºâ€Failed-to-watch-metrics-Error-watching-fields-The-third-party-Profiling-module-returned-an-unrecoverable-errorâ€" class="headerlink" title="2.4.1 pod&#x2F;my-hami-webui-dcgm-exporteræç¤ºâ€Failed to watch metrics: Error watching fields: The third-party Profiling module returned an unrecoverable errorâ€"></a>2.4.1 pod&#x2F;my-hami-webui-dcgm-exporteræç¤ºâ€Failed to watch metrics: Error watching fields: The third-party Profiling module returned an unrecoverable errorâ€</h3><p>å…·ä½“é—®é¢˜æè¿°åœ¨ï¼š<a href="https://github.com/Project-HAMi/HAMi-WebUI/issues/20">https://github.com/Project-HAMi/HAMi-WebUI/issues/20</a></p><p><img src="https://s2.loli.net/2025/01/22/RFNzHtKjCZTsDyB.png" alt="image-20250122162820887"></p><p>å¤„ç†åŠæ³•ï¼š</p><p>2025å¹´1æœˆ22æ—¥ï¼šä¸çŸ¥å¦‚ä½•å¤„ç†ï¼Œæš‚æ—¶æç½®ã€‚ç¤¾åŒºæé—®ä¸hamiå¾®ä¿¡ç¾¤æé—®ï¼Œæš‚æ—¶ï¼ˆ2025å¹´1æœˆ22æ—¥ï¼‰éƒ½æ— äººå›å¤ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯å¿«è¿‡å¹´äº†ï¼Œå¤§å®¶ä¸ä¸Šç­</p><p>2025å¹´1æœˆ23æ—¥ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿®æ”¹daemonsets/my-hami-webui-dcgm-exporterï¼Œå°†å‚æ•°â€œargs: -f /etc/dcgm-exporter/dcp-metrics-inclueded.csvâ€å»æ‰</span><br>root@controller01:~# kubectl -n kube-system edit daemonsets.apps my-hami-webui-dcgm-exporter <br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/23/mN1zj3qf9PdkBVH.png" alt="image-20250123092714778"></p><p><img src="https://s2.loli.net/2025/01/23/LAH1txd7pIyZ3Ql.png" alt="image-20250123092747161"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ç„¶åå¯ä»¥çœ‹åˆ°pod/my-hami-webui-dcgm-exporter-v6gnx æ­£å¸¸è¿è¡Œ</span><br>root@controller01:~# kubectl -n kube-system get pods<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/23/2rVwPOf54Kj8XMT.png" alt="image-20250123092608635"></p><h1 id="ä¸‰ã€ä½¿ç”¨"><a href="#ä¸‰ã€ä½¿ç”¨" class="headerlink" title="ä¸‰ã€ä½¿ç”¨"></a>ä¸‰ã€ä½¿ç”¨</h1><h2 id="åˆ›å»ºä»»åŠ¡"><a href="#åˆ›å»ºä»»åŠ¡" class="headerlink" title="åˆ›å»ºä»»åŠ¡"></a>åˆ›å»ºä»»åŠ¡</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:/opt/installPkgs/k8s-vgpu-basedon-HAMi# cat gpu-test4.yaml                 <br>apiVersion: v1<br>kind: Pod<br>metadata:<br>  name: gpu-test4<br>spec:<br>  restartPolicy: OnFailure<br><span class="hljs-meta prompt_">  # </span><span class="language-bash"> nodeName: controller01</span><br>  containers:<br>    - name: gpu-test4-01<br>      image: xxx/ubuntu2004:pytorch2.2.2-classification-example<br>      command:<br>        - python3<br>        - /opt/classification/train.py<br>      resources:<br>        limits:<br>          nvidia.com/vgpu: 2 # requesting 1 vGPUs<br>          nvidia.com/gpumem: 3000 # Each vGPU contains 3000m device memory ï¼ˆOptional,Integerï¼‰<br>          nvidia.com/gpucores: 10 # Each vGPU uses 10% of the entire GPU ï¼ˆOptional,Integer)<br><br>root@controller01:/opt/installPkgs/k8s-vgpu-basedon-HAMi# cat gpu-test6.yaml   <br>apiVersion: v1<br>kind: Pod<br>metadata:<br>  name: gpu-test6<br>spec:<br>  restartPolicy: OnFailure<br><span class="hljs-meta prompt_">  # </span><span class="language-bash"> nodeName: controller01</span><br>  containers:<br>    - name: gpu-test6-01<br>      image: 175.6.40.93:8196/k8s-kubekey/ubuntu2004:pytorch2.2.2-classification-example<br>      command:<br>        - python3<br>        - /opt/classification/train.py<br>      resources:<br>        limits:<br>          nvidia.com/vgpu: 1 # requesting 1 vGPUs<br>          nvidia.com/gpumem: 3000 # Each vGPU contains 3000m device memory ï¼ˆOptional,Integerï¼‰<br>          #nvidia.com/gpumem-percentage: 10 #Each vGPU containers 10% device memory of that GPU. Can not be used with nvidia.com/gpumem<br>          nvidia.com/gpucores: 10 # Utilization limit of this vGPU is set to 10% of total GPU utilization <br>          #nvidia.com/priority: 0 # We only have two priority class, 0(high) and 1(low), default: 1 <br>          #The utilization of high priority task won&#x27;t be limited to resourceCores unless sharing GPU node with other high priority tasks.<br>          #The utilization of low priority task won&#x27;t be limited to resourceCores if no other tasks sharing its GPU.<br><br><br>root@controller01:/opt/installPkgs/k8s-vgpu-basedon-HAMi# kubectl apply -f gpu-test4.yaml -f gpu-test6.yaml <br>root@controller01:/opt/installPkgs/k8s-vgpu-basedon-HAMi# kubectl get pods<br>NAME        READY   STATUS    RESTARTS   AGE<br>dnstools    1/1     Running   0          23h<br>gpu-test4   1/1     Running   0          2m17s<br>gpu-test6   1/1     Running   0          2m17s<br></code></pre></td></tr></table></figure><h2 id="èµ„æºæ€»è§ˆ"><a href="#èµ„æºæ€»è§ˆ" class="headerlink" title="èµ„æºæ€»è§ˆ"></a>èµ„æºæ€»è§ˆ</h2><p><img src="https://s2.loli.net/2025/01/23/ADkSXv7jTo6lWcu.png" alt="image-20250123103935595"></p><h2 id="ä»»åŠ¡ç®¡ç†"><a href="#ä»»åŠ¡ç®¡ç†" class="headerlink" title="ä»»åŠ¡ç®¡ç†"></a>ä»»åŠ¡ç®¡ç†</h2><p>æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡çš„èµ„æºä½¿ç”¨æƒ…å†µã€å•ä¸ªä»»åŠ¡çš„èµ„æºä½¿ç”¨è¯¦æƒ…</p><p><img src="https://s2.loli.net/2025/01/23/MkNHcUIBxJQ6bKY.png" alt="image-20250123103950833"></p><p><img src="https://s2.loli.net/2025/01/23/LmCIHVKDwNxM1OP.png" alt="image-20250123104011189"></p><p>æ›´å¤šç»†èŠ‚åˆ†æï¼Œå¾…ç»­</p><h1 id="å››ã€å¼€æºè´¡çŒ®"><a href="#å››ã€å¼€æºè´¡çŒ®" class="headerlink" title="å››ã€å¼€æºè´¡çŒ®"></a>å››ã€å¼€æºè´¡çŒ®</h1><p><a href="https://github.com/Project-HAMi/HAMi-WebUI/blob/main/README_ZH.md#%E5%8F%82%E4%B8%8E%E8%B4%A1%E7%8C%AE">https://github.com/Project-HAMi/HAMi-WebUI/blob/main/README_ZH.md#%E5%8F%82%E4%B8%8E%E8%B4%A1%E7%8C%AE</a> </p>]]></content>
    
    
    
    <tags>
      
      <tag>HAMi-WebUI</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Debianå„ä¸»æµç‰ˆæœ¬çš„å®‰è£…æºå½’æ¡£</title>
    <link href="/2025/01/21/Debian%E5%90%84%E4%B8%BB%E6%B5%81%E7%89%88%E6%9C%AC%E7%9A%84%E5%AE%89%E8%A3%85%E6%BA%90%E5%BD%92%E6%A1%A3/"/>
    <url>/2025/01/21/Debian%E5%90%84%E4%B8%BB%E6%B5%81%E7%89%88%E6%9C%AC%E7%9A%84%E5%AE%89%E8%A3%85%E6%BA%90%E5%BD%92%E6%A1%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="Debian11-amd64"><a href="#Debian11-amd64" class="headerlink" title="Debian11-amd64"></a>Debian11-amd64</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@debian11:~/ cat /etc/apt/sources.list<br>deb https://mirrors.aliyun.com/debian/ bullseye main non-free contrib<br>deb https://mirrors.aliyun.com/debian-security/ bullseye-security main<br>deb https://mirrors.aliyun.com/debian/ bullseye-updates main non-free contrib<br>deb https://mirrors.aliyun.com/debian/ bullseye-backports main non-free contrib<br></code></pre></td></tr></table></figure><h1 id="Debian12-amd64"><a href="#Debian12-amd64" class="headerlink" title="Debian12-amd64"></a>Debian12-amd64</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">é˜¿é‡Œäº‘é•œåƒç«™</span><br>deb https://mirrors.aliyun.com/debian/ bookworm main non-free non-free-firmware contrib<br>deb-src https://mirrors.aliyun.com/debian/ bookworm main non-free non-free-firmware contrib<br>deb https://mirrors.aliyun.com/debian-security/ bookworm-security main<br>deb-src https://mirrors.aliyun.com/debian-security/ bookworm-security main<br>deb https://mirrors.aliyun.com/debian/ bookworm-updates main non-free non-free-firmware contrib<br>deb-src https://mirrors.aliyun.com/debian/ bookworm-updates main non-free non-free-firmware contrib<br>deb https://mirrors.aliyun.com/debian/ bookworm-backports main non-free non-free-firmware contrib<br>deb-src https://mirrors.aliyun.com/debian/ bookworm-backports main non-free non-free-firmware contrib<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è…¾è®¯äº‘é•œåƒç«™</span><br>deb https://mirrors.tencent.com/debian/ bookworm main non-free non-free-firmware contrib<br>deb-src https://mirrors.tencent.com/debian/ bookworm main non-free non-free-firmware contrib<br>deb https://mirrors.tencent.com/debian-security/ bookworm-security main<br>deb-src https://mirrors.tencent.com/debian-security/ bookworm-security main<br>deb https://mirrors.tencent.com/debian/ bookworm-updates main non-free non-free-firmware contrib<br>deb-src https://mirrors.tencent.com/debian/ bookworm-updates main non-free non-free-firmware contrib<br>deb https://mirrors.tencent.com/debian/ bookworm-backports main non-free non-free-firmware contrib<br>deb-src https://mirrors.tencent.com/debian/ bookworm-backports main non-free non-free-firmware contrib<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç½‘æ˜“é•œåƒç«™</span><br>deb https://mirrors.163.com/debian/ bookworm main non-free non-free-firmware contrib<br>deb-src https://mirrors.163.com/debian/ bookworm main non-free non-free-firmware contrib<br>deb https://mirrors.163.com/debian-security/ bookworm-security main<br>deb-src https://mirrors.163.com/debian-security/ bookworm-security main<br>deb https://mirrors.163.com/debian/ bookworm-updates main non-free non-free-firmware contrib<br>deb-src https://mirrors.163.com/debian/ bookworm-updates main non-free non-free-firmware contrib<br>deb https://mirrors.163.com/debian/ bookworm-backports main non-free non-free-firmware contrib<br>deb-src https://mirrors.163.com/debian/ bookworm-backports main non-free non-free-firmware contrib<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>Debian å›½å†…å®‰è£…æº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HAMiä½¿ç”¨ç›¸å…³faq</title>
    <link href="/2025/01/21/HAMi%E4%BD%BF%E7%94%A8%E7%9B%B8%E5%85%B3faq/"/>
    <url>/2025/01/21/HAMi%E4%BD%BF%E7%94%A8%E7%9B%B8%E5%85%B3faq/</url>
    
    <content type="html"><![CDATA[<h1 id="001-HAMi-èƒ½å¦æ„ŸçŸ¥å…¶ä»–è¿›ç¨‹å¯¹ç‰©ç†GPUçš„ä½¿ç”¨ï¼Ÿ"><a href="#001-HAMi-èƒ½å¦æ„ŸçŸ¥å…¶ä»–è¿›ç¨‹å¯¹ç‰©ç†GPUçš„ä½¿ç”¨ï¼Ÿ" class="headerlink" title="001 HAMi èƒ½å¦æ„ŸçŸ¥å…¶ä»–è¿›ç¨‹å¯¹ç‰©ç†GPUçš„ä½¿ç”¨ï¼Ÿ"></a>001 HAMi èƒ½å¦æ„ŸçŸ¥å…¶ä»–è¿›ç¨‹å¯¹ç‰©ç†GPUçš„ä½¿ç”¨ï¼Ÿ</h1><p>æé—®å…·ä½“æè¿°ï¼šå¦‚æœä¸€ä¸ªç‰©ç†NVIDIA GPUå¡ï¼Œæ˜¾å­˜24Gã€‚å·²ç»åœ¨ç‰©ç†æœåŠ¡å™¨ä¸Šåˆ›å»ºäº†ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨æ­¤GPUå¡ï¼Œå ç”¨æ˜¾å­˜12Gï¼ˆå®ƒæ­¤æ—¶ç©ºé—²æ˜¾å­˜12Gï¼‰ã€‚æ­¤æ—¶æˆ‘èƒ½å¦åˆ›å»º4ä¸ªæ˜¾å­˜å¤§å°æ˜¯4Gçš„vGPUå‡ºæ¥ï¼ˆåˆ›å»ºå‡ºæ¥åå°±ä¼šä¸€ç›´å¤„äºä½¿ç”¨ä¸­ï¼‰ï¼Ÿ</p><p>å›ç­”ï¼šHAMiï¼ˆæˆ‘ä½¿ç”¨çš„æ˜¯2.4.1ï¼‰æ— æ³•æ„ŸçŸ¥å…¶ä»–è¿›ç¨‹å¯¹ç‰©ç†GPUçš„ä½¿ç”¨ã€‚æ¯”å¦‚ä¸Šè¿°é—®é¢˜ä¸­ï¼Œä¸€ä¸ªç‰©ç†NVIDIA GPUå¡ï¼Œæ˜¾å­˜24Gã€‚å·²ç»åœ¨ç‰©ç†æœåŠ¡å™¨ä¸Šåˆ›å»ºäº†ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨æ­¤GPUå¡ï¼Œå ç”¨æ˜¾å­˜12Gï¼ˆå®ƒæ­¤æ—¶ç©ºé—²æ˜¾å­˜12Gï¼‰ï¼Œæ­¤æ—¶è¿˜èƒ½ä½¿ç”¨HAMiåˆ›å»ºå‡º4ä¸ªæˆ–æ›´å¤šä¸ªæ•°çš„æ˜¾å­˜å¤§å°æ˜¯4Gçš„vGPUï¼Œä½†ä»…é™äºèƒ½åˆ›å»ºå‡ºæ¥ï¼Œå¦‚æœåç»­æŠŠè¿™4ä¸ªvGPUçš„æ˜¾å­˜å…¨éƒ¨è·‘æ»¡ï¼Œåˆ™ä¼šå‘ç”ŸOOMæ˜¾å­˜æº¢å‡ºæŠ¥é”™</p>]]></content>
    
    
    
    <tags>
      
      <tag>HAMi faq</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®¹å™¨é•œåƒçš„è·å–ä¸å¯¼å…¥</title>
    <link href="/2025/01/17/%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E7%9A%84%E8%8E%B7%E5%8F%96%E4%B8%8E%E5%AF%BC%E5%85%A5/"/>
    <url>/2025/01/17/%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E7%9A%84%E8%8E%B7%E5%8F%96%E4%B8%8E%E5%AF%BC%E5%85%A5/</url>
    
    <content type="html"><![CDATA[<h1 id="1-å®¹å™¨é•œåƒæ¦‚è¿°"><a href="#1-å®¹å™¨é•œåƒæ¦‚è¿°" class="headerlink" title="1 å®¹å™¨é•œåƒæ¦‚è¿°"></a>1 å®¹å™¨é•œåƒæ¦‚è¿°</h1><p>â€‹      å®¹å™¨é•œåƒï¼ˆImageï¼‰æ‰€æ‰¿è½½çš„æ˜¯å°è£…äº†åº”ç”¨ç¨‹åºåŠå…¶æ‰€æœ‰è½¯ä»¶ä¾èµ–çš„äºŒè¿›åˆ¶æ•°æ®ã€‚ å®¹å™¨é•œåƒæ˜¯å¯æ‰§è¡Œçš„è½¯ä»¶åŒ…ï¼Œå¯ä»¥å•ç‹¬è¿è¡Œï¼›è¯¥è½¯ä»¶åŒ…å¯¹æ‰€å¤„çš„è¿è¡Œæ—¶ç¯å¢ƒå…·æœ‰è‰¯å®šï¼ˆWell Definedï¼‰çš„å‡å®šã€‚</p><p>â€‹      å®¹å™¨é•œåƒä¸å®¹å™¨çš„å…³ç³»ï¼Œç±»ä¼¼äºå¯æ‰§è¡Œæ–‡ä»¶ä¸è¿›ç¨‹çš„å…³ç³»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥å°†å®¹å™¨ç†è§£ä¸ºå®¹å™¨é•œåƒçš„åŠ¨æ€å½¢å¼ï¼Œå®¹å™¨é•œåƒåˆ™å®¹å™¨çš„é™æ€å½¢å¼ã€‚ä¸€èˆ¬åœ°ï¼Œå®ç°æŸç‰¹å®šä¸šåŠ¡åŠŸèƒ½çš„å®¹å™¨é•œåƒéƒ½æ˜¯åœ¨æŸä¸€ä¸ªåŸºç¡€é•œåƒçš„åŸºç¡€ä¸Šæ„å»ºçš„ã€‚</p><p><img src="https://s2.loli.net/2025/01/17/4rxylmhikKt9AIa.png" alt="image-20250117211509892"></p><p>â€‹      <code>Docker</code>å®¹å™¨é•œåƒæ˜¯ç¬¦åˆ<code>OCI</code>è§„èŒƒçš„ï¼Œè€Œ<code>Containerd</code>æ”¯æŒæ‰€æœ‰ç¬¦åˆ<code>OCI</code>è§„èŒƒçš„å®¹å™¨é•œåƒã€‚ä½†<code>Containerd</code>æœ¬èº«é™„å¸¦çš„<code>ctr</code>å·¥å…·å¹¶ä¸æä¾›åˆ›å»ºå®¹å™¨é•œåƒçš„èƒ½åŠ›ï¼Œä½†<code>Containerd</code>çš„å­é¡¹ç›® <code>nerdctl</code>ï¼Œå®ƒå…¼å®¹ <code>docker cli</code>ï¼Œå¯ä»¥åƒ <code>docker</code> å‘½ä»¤ä¸€æ ·æ¥ç®¡ç†æœ¬åœ°çš„é•œåƒå’Œå®¹å™¨ã€‚ç¬”è€…ç›®å‰ä½¿ç”¨çš„å®¹å™¨åœºæ™¯ä¸äº‘åŸç”Ÿç¯å¢ƒä¸‹ï¼Œæš‚æ—¶è¿˜æ˜¯ä»¥<code>Docker</code>å‘½ä»¤ç®¡ç†é•œåƒä¸å®¹å™¨å±…å¤šï¼Œä½†æ­£åœ¨å¾€ä½¿ç”¨<code>Containerd</code>åŠå…¶å­é¡¹ç›®<code>nerdctl</code>è½¬ç§»ä¸­ã€‚</p><p>â€‹      å®¹å™¨é•œåƒå®é™…ä¸Šæ˜¯ç”±ä¸€å±‚ä¸€å±‚çš„ç³»ç»Ÿæ–‡ä»¶ç»„æˆï¼Œè¿™ç§å±‚çº§çš„æ–‡ä»¶ç³»ç»Ÿè¢«ç§°ä¸ºUnionFS( Union file system ç»Ÿä¸€æ–‡ä»¶ç³»ç»Ÿ)ï¼Œé•œåƒå¯ä»¥åŸºäºDockerfileæ„å»ºï¼ŒDockerfileæ˜¯ä¸€ä¸ªæè¿°æ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«äº†è‹¥å¹²æ¡å¯†ä»¤ï¼Œæ¯æ¡å‘½ä»¤éƒ½ä¼šå¯¹åŸºç¡€æ–‡ä»¶ç³»ç»Ÿåˆ›å»ºæ–°çš„å±‚æ¬¡ç»“æ„ã€‚<code>docker buildä¸nerdctl</code>åŠ<code>buildctl</code>å‘½ä»¤éƒ½å¯ä»¥ä½¿ç”¨Dockerfileæ–‡ä»¶æ¥æ„å»ºå®¹å™¨é•œåƒã€‚</p><h1 id="2-å®¹å™¨é•œåƒçš„è·å–ä¸ç”Ÿæˆæ–¹æ³•"><a href="#2-å®¹å™¨é•œåƒçš„è·å–ä¸ç”Ÿæˆæ–¹æ³•" class="headerlink" title="2 å®¹å™¨é•œåƒçš„è·å–ä¸ç”Ÿæˆæ–¹æ³•"></a>2 å®¹å™¨é•œåƒçš„è·å–ä¸ç”Ÿæˆæ–¹æ³•</h1><p>â€¢    <strong>æ–¹æ³•ä¸€ï¼šåœ¨DockerHubç›´æ¥ä¸‹è½½</strong></p><p>   DockerHubæ˜¯dockerå®¹å™¨é•œåƒçš„å®˜ç½‘ä¸Šä¼ ä¸ä¸‹è½½ç½‘ç«™ï¼ˆå½“ç„¶å…¨çƒè¿˜æœ‰å¾ˆå¤šå…¬å¸å¦‚é˜¿é‡Œäº‘æä¾›äº†å…¬å¼€çš„å®¹å™¨é•œåƒå¯ä¾›ä¸‹è½½ä¸ä½¿ç”¨ï¼‰ï¼Œä¸‹è½½ä¸‹æ¥çš„å®¹å™¨é•œåƒå¯ä»¥ç›´æ¥ç”¨æ¥åˆ›å»ºå®¹å™¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºè‡ªå®šä¹‰å®¹å™¨é•œåƒçš„åŸºç¡€é•œåƒã€‚</p><p>â€¢    <strong>æ–¹æ³•äºŒï¼šæŠŠæ“ä½œç³»ç»Ÿä¸­æ–‡ä»¶ç³»ç»Ÿæ‰“åŒ…ä¸ºå®¹å™¨é•œåƒ</strong></p><p>   åˆ©ç”¨Dockerå®¹å™¨å¼•æ“çš„åŠŸèƒ½ï¼Œå¯ä»¥å°†ç‰©ç†æœºæˆ–è™šæ‹Ÿæœºä¸Šæ­£åœ¨è¿è¡Œçš„æ“ä½œç³»ç»Ÿçš„å…¨éƒ¨æˆ–éƒ¨åˆ†å†…å®¹æ‰“åŒ…æˆä¸€ä¸ªå®¹å™¨é•œåƒã€‚</p><p>â€¢    <strong>æ–¹æ³•ä¸‰ï¼šæŠŠæ­£åœ¨è¿è¡Œçš„å®¹å™¨æ‰“åŒ…ä¸ºå®¹å™¨é•œåƒ</strong></p><p>   ç±»ä¼¼åœ°ï¼Œåˆ©ç”¨Dockerå®¹å™¨å¼•æ“çš„åŠŸèƒ½å¯ä»¥å°†ä¸€ä¸ªå®¹å™¨ä¿å­˜ä¸ºä¸€ä¸ªå®¹å™¨é•œåƒã€‚è¿™ä¹Ÿå¯ä»¥æ›´å½¢è±¡å…·ä½“åœ°å°†å®¹å™¨é•œåƒç†è§£ä¸ºå®¹å™¨çš„é™æ­¢çŠ¶æ€ã€‚</p><p>â€¢    <strong>æ–¹æ³•å››ï¼šé€šè¿‡Dockerfileå®ç°å®¹å™¨é•œåƒçš„è‡ªå®šä¹‰ä¸æ„å»º</strong></p><p>   è¿™æ˜¯å¼€å‘ä¸ç”Ÿäº§ç¯å¢ƒä¸­ç»å¸¸ç”¨åˆ°ä¸€ç§æ„å»ºå®¹å™¨çš„æ–¹å¼ã€‚</p><p>å®¹å™¨é•œåƒè·å–åï¼Œå¯ä»¥ä¿å­˜åˆ°æœ¬åœ°çš„registryæˆ–è‡ªå·±æ­å»ºçš„harboré•œåƒä»“åº“ä¸­ï¼Œä»¥ä¾¿åç»­ä½¿ç”¨ã€‚</p><h2 id="2-1-æ–¹æ³•ä¸€ï¼šåœ¨DockerHubç›´æ¥ä¸‹è½½"><a href="#2-1-æ–¹æ³•ä¸€ï¼šåœ¨DockerHubç›´æ¥ä¸‹è½½" class="headerlink" title="2.1 æ–¹æ³•ä¸€ï¼šåœ¨DockerHubç›´æ¥ä¸‹è½½"></a>2.1 æ–¹æ³•ä¸€ï¼šåœ¨DockerHubç›´æ¥ä¸‹è½½</h2><p>â€‹      è®¿é—®DockerHubå®˜ç½‘ï¼š <a href="https://hub.docker.com/">https://hub.docker.com/</a> ã€‚</p><p><img src="https://s2.loli.net/2025/01/17/M3BUG9NsPkfzhbD.png" alt="image-20250117213321848"></p><p>ï¼ˆ1ï¼‰å¯ä»¥çœ‹åˆ°DockerHubå¯ä»¥æ³¨å†Œç™»å½•ï¼Œç™»å½•åå¯ä»¥ä¸Šä¼ é•œåƒåˆ°ç”¨æˆ·ç©ºé—´å†…ã€‚è¿™äº›ä¸Šä¼ çš„é•œåƒå¯ä»¥è®¾ç½®ä¸ºpublicï¼Œè¿™æ ·å…¶ä»–äººéƒ½å¯ä»¥ä½¿ç”¨å®ƒã€‚ä¸æ­¤ç›¸åº”åœ°ï¼Œé•œåƒè®¾ç½®ä¸ºprivateæ—¶ï¼Œå…¶ä»–äººåˆ™æ˜¯ä¸å¯è§çš„ã€‚</p><p>ï¼ˆ2ï¼‰å¯ä»¥çœ‹åˆ°DockerHubä¸Šçš„å®¹å™¨é•œåƒæ”¯æŒå¤šç§ä¸åŒæ„æ¶ï¼ŒåŒä¸€ä¸ªé•œåƒä¸åŒçš„æ„æ¶åœ¨æ‹‰å–æ—¶ï¼Œä½¿ç”¨ä¸åŒçš„Digest</p><p>ï¼ˆ3ï¼‰åŒæ—¶ï¼Œ DockerHubå·²ç»æ£€æµ‹å¹¶å‘Šè¯‰ç”¨æˆ·ï¼Œå½“å‰é•œåƒæœ‰å¤šå°‘ä¸ªä¸åŒçº§åˆ«çš„æ¼æ´æˆ–å®‰å…¨éšæ‚£ï¼Œå¹¶å¯ä»¥æŸ¥çœ‹è¿™äº›æ¼æ´çš„è¯¦æƒ…ã€‚å¯¹å®¹å™¨é•œåƒå®‰å…¨æ€§æœ‰è¾ƒé«˜è¦æ±‚æ—¶è¦æ³¨æ„</p><p>ï¼ˆ4ï¼‰ä¸‹è½½é•œåƒã€‚</p><p><img src="https://s2.loli.net/2025/01/17/ZA8oQLOmq9KlyrP.png" alt="image-20250117213552141"></p><p>æ¯”å¦‚æˆ‘ä»¬è¦ä¸‹è½½<code>nginx:stable-perl</code>é•œåƒåœ¨arm64æ„æ¶å¹³å°ä¸Šå¯¹åº”çš„é•œåƒæ–‡ä»¶æ—¶ï¼Œæœ‰å¦‚ä¸‹ä¸¤ç§æ–¹æ³•ï¼š</p><ul><li>å·²æœ‰DockeræœåŠ¡è¿è¡Œåœ¨ä¸€ä¸ªarm64æ„æ¶å¹³å°ä¸Š</li></ul><p>æ­¤æ—¶å¯ä»¥ç›´æ¥<code>docker pull nginx:stable-perl</code>æ‹‰å–æ­¤é•œåƒï¼ŒdockeræœåŠ¡ä¼šæ‹‰å–ä¸€ä¸ªè·Ÿè‡ªå·±æ„æ¶ä¸€æ ·çš„<code>nginx:stable-perl</code>é•œåƒ</p><ul><li>å·²æœ‰DockeræœåŠ¡è¿è¡Œåœ¨ä¸€ä¸ªéarm64æ„æ¶å¹³å°ä¸Šï¼Œæ¯”å¦‚å¸¸è§çš„x86_64æ„æ¶çš„windowsç”µè„‘æˆ–ä¸€ä¸ªamd64æ„æ¶çš„LinuxæœåŠ¡å™¨ä¸Š</li></ul><p>æ­¤æ—¶å¹¶ä¸èƒ½ç›´æ¥ä½¿ç”¨<code>docker pull nginx:stable-perl</code>ï¼Œè¦æ˜¯è¦åƒä¸Šå›¾ä¸­å±•ç¤ºçš„ä¸€æ ·ï¼Œå•å‡»æ­¤æ„æ¶é•œåƒå¯¹åº”çš„Digest å³<code>61eaeb2c1479</code>ï¼Œè·³è½¬åˆ°å¦‚ä¸‹å›¾ç•Œé¢ã€‚ç„¶åå¤åˆ¶ä¸‹å›¾ä¸­Index digestå¯¹åº”çš„å€¼ï¼Œå¦‚ä¸‹æ˜¯<code>sha256:746bca4640fce6b18814e47162c26da63f185a2b4a1bbc5fd137cbf9bc8293e8</code>ï¼Œç„¶åç»„åˆæˆå‘½ä»¤å¦‚ä¸‹å‘½ä»¤æ‹‰å–nginx:stable-perlé•œåƒåœ¨arm64æ„æ¶å¹³å°ä¸Šå¯¹åº”çš„é•œåƒæ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull nginx@sha256:746bca4640fce6b18814e47162c26da63f185a2b4a1bbc5fd137cbf9bc8293e8<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/17/mcLwOzxoC41ap29.png" alt="image-20250117213752425"></p><p>â€‹      å¯ä»¥çœ‹åˆ°DockerHubå¯ä»¥æ³¨å†Œç™»å½•ï¼Œç™»å½•åå¯ä»¥ä¸Šä¼ é•œåƒåˆ°ç”¨æˆ·ç©ºé—´å†…ã€‚è¿™äº›ä¸Šä¼ çš„é•œåƒå¯ä»¥è®¾ç½®ä¸ºpublicï¼Œè¿™æ ·å…¶ä»–äººéƒ½å¯ä»¥ä½¿ç”¨å®ƒã€‚</p><p>â€‹      å¯ä»¥çœ‹åˆ°DockerHubä¸Šçš„å®¹å™¨é•œåƒæ”¯æŒå¤šç§ä¸åŒæ„æ¶ï¼ŒåŒä¸€ä¸ªé•œåƒä¸åŒçš„æ„æ¶åœ¨æ‹‰å–æ—¶ï¼Œä½¿ç”¨ä¸åŒçš„Digestã€‚</p><p>â€‹      åŒæ—¶ï¼Œè¿˜éœ€è¦DockerHubå·²ç»æ£€æµ‹å¹¶å‘Šè¯‰ç”¨æˆ·ï¼Œå½“å‰æœ‰å¤šå°‘ä¸ªä¸åŒçº§åˆ«çš„æ¼æ´æˆ–å®‰å…¨éšæ‚£ï¼Œå¹¶å¯ä»¥æŸ¥çœ‹è¿™äº›æ¼æ´çš„è¯¦æƒ…ã€‚å¯¹å®¹å™¨é•œåƒå®‰å…¨æ€§æœ‰è¾ƒé«˜è¦æ±‚æ—¶è¦æ³¨æ„ã€‚</p><h2 id="2-2-æ–¹æ³•äºŒï¼šæŠŠæ“ä½œç³»ç»Ÿä¸­æ–‡ä»¶ç³»ç»Ÿæ‰“åŒ…ä¸ºå®¹å™¨é•œåƒ"><a href="#2-2-æ–¹æ³•äºŒï¼šæŠŠæ“ä½œç³»ç»Ÿä¸­æ–‡ä»¶ç³»ç»Ÿæ‰“åŒ…ä¸ºå®¹å™¨é•œåƒ" class="headerlink" title="2.2 æ–¹æ³•äºŒï¼šæŠŠæ“ä½œç³»ç»Ÿä¸­æ–‡ä»¶ç³»ç»Ÿæ‰“åŒ…ä¸ºå®¹å™¨é•œåƒ"></a>2.2 æ–¹æ³•äºŒï¼šæŠŠæ“ä½œç³»ç»Ÿä¸­æ–‡ä»¶ç³»ç»Ÿæ‰“åŒ…ä¸ºå®¹å™¨é•œåƒ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰“åŒ…é•œåƒï¼ˆå…¶ä¸­--excludeå‚æ•°æŒ‡å®šä¸æ‰“åŒ…çš„ç›®å½•ï¼Œå¯ä»¥æŒ‡å®šå¤šæ¬¡ã€å–å¹¶é›†ï¼‰</span><br>tar --numeric-owner --exclude=/proc --exclude=/sys -cvf centos7u6.tar /<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯¼å…¥é•œåƒåˆ°æœ¬åœ°</span><br>docker import centos7u6.tar centos7u6:v1<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨æ­¤é•œåƒåˆ›å»ºå¹¶è¿›å…¥å®¹å™¨</span><br>docker run -it centos7u6:v1 bash<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/17/Xzwmuh4k7QO9SFv.png" alt="image-20250117220842655"></p><h2 id="2-3-æ–¹æ³•ä¸‰ï¼šæŠŠå®¹å™¨æ‰“åŒ…ä¸ºå®¹å™¨é•œåƒ"><a href="#2-3-æ–¹æ³•ä¸‰ï¼šæŠŠå®¹å™¨æ‰“åŒ…ä¸ºå®¹å™¨é•œåƒ" class="headerlink" title="2.3 æ–¹æ³•ä¸‰ï¼šæŠŠå®¹å™¨æ‰“åŒ…ä¸ºå®¹å™¨é•œåƒ"></a>2.3 æ–¹æ³•ä¸‰ï¼šæŠŠå®¹å™¨æ‰“åŒ…ä¸ºå®¹å™¨é•œåƒ</h2><p>â€‹      ç°æœ‰ä¸€ä¸ªå®¹å™¨<code>test01</code>ï¼Œåˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶<code>/opt/test01.txt</code>ï¼Œå¹¶åœ¨å…¶ä¸­å†™å…¥å­—ç¬¦ä¸²å†…å®¹<code>container test01</code>ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹æ‰€æœ‰å®¹å™¨</span><br>docker ps -a<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è¿›å…¥å®¹å™¨ï¼Œæ‰“å¼€ä¸€ä¸ªäº¤äº’å¼å‘½ä»¤è™šæ‹Ÿç»ˆç«¯</span><br>docker exec -it test01 bash<br>root@271b105e357f:/# echo &quot;container test01&quot; &gt; /opt/test01.txt<br>root@271b105e357f:/# cat /opt/test01.txt<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨ç»„åˆé”®â€œctrl+p+qâ€é€€å‡ºå®¹å™¨</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/17/XmOSNLVnKkBvxWU.png" alt="image-20250117214428285"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†å®¹å™¨ä¿å­˜ä¸ºé•œåƒï¼ˆå®¹å™¨å¤„äºUpæˆ–ExitedçŠ¶æ€éƒ½æ— æ‰€è°“ï¼‰</span><br>root@ubuntu20:~# docker commit -a &quot;a good man&quot; -m &quot;æµ‹è¯•&quot; test01 ubuntu:test01<br>root@ubuntu20:~# docker images | grep ubuntu<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/17/Kuv58rnx1dVJPpo.png" alt="image-20250117214858751"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨ä¸Šè¿°æ‰“åŒ…åçš„é•œåƒåˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨test001ï¼Œå¯ä»¥çœ‹åˆ°å®¹å™¨ä¸­çš„/opt/test01.txt æ–‡ä»¶å†…å®¹è·Ÿå‰é¢å†™å…¥çš„ä¸€æ ·</span><br>root@ubuntu20:~# docker run -it --name test001 ubuntu:test01 bash<br>root@66a8e5be6b13:/# ls -al /opt/<br>root@66a8e5be6b13:/# cat /opt/test01.txt<br>root@ubuntu20:~# docker ps -a | egrep &quot;NAME|test001&quot;<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/17/5NfjhmXIdg4DTqE.png" alt="image-20250117214936732"></p><h2 id="2-4-æ–¹æ³•å››ï¼šé€šè¿‡Dockerfileå®ç°å®¹å™¨é•œåƒçš„è‡ªå®šä¹‰ä¸æ„å»º"><a href="#2-4-æ–¹æ³•å››ï¼šé€šè¿‡Dockerfileå®ç°å®¹å™¨é•œåƒçš„è‡ªå®šä¹‰ä¸æ„å»º" class="headerlink" title="2.4 æ–¹æ³•å››ï¼šé€šè¿‡Dockerfileå®ç°å®¹å™¨é•œåƒçš„è‡ªå®šä¹‰ä¸æ„å»º"></a>2.4 æ–¹æ³•å››ï¼šé€šè¿‡Dockerfileå®ç°å®¹å™¨é•œåƒçš„è‡ªå®šä¹‰ä¸æ„å»º</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#åˆ›å»ºä¸€ä¸ªDockerfileæ–‡ä»¶ï¼Œå°±å–åDockerfile</span><br><span class="hljs-string">root@ubuntu20:/opt/manual-for-ppt#</span> <span class="hljs-string">cat</span> <span class="hljs-string">Dockerfile</span><br><span class="hljs-string">FROM</span> <span class="hljs-string">centos:centos7</span><br><span class="hljs-string">MAINTAINER</span> <span class="hljs-string">&quot;a good man&quot;</span><br><span class="hljs-string">RUN</span> <span class="hljs-string">yum</span> <span class="hljs-string">makecache</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">yum</span> <span class="hljs-string">-y</span> <span class="hljs-string">install</span> <span class="hljs-string">wget</span><br><span class="hljs-string">RUN</span> <span class="hljs-string">wget</span> <span class="hljs-string">-O</span> <span class="hljs-string">/etc/yum.repos.d/epel.repo</span> <span class="hljs-string">\</span><br>    <span class="hljs-string">http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="hljs-string">RUN</span> <span class="hljs-string">yum</span> <span class="hljs-string">-y</span> <span class="hljs-string">install</span> <span class="hljs-string">nginx</span><br><span class="hljs-string">RUN</span> <span class="hljs-string">echo</span> <span class="hljs-string">&quot;nginx index page!&quot;</span> <span class="hljs-string">&gt;</span> <span class="hljs-string">\</span><br>    <span class="hljs-string">/usr/share/nginx/html/index.html</span><br><span class="hljs-string">RUN</span> <span class="hljs-string">echo</span> <span class="hljs-string">&quot;daemon off;&quot;</span><span class="hljs-string">&gt;&gt;</span> <span class="hljs-string">/etc/nginx/nginx.conf</span><br><span class="hljs-string">EXPOSE</span> <span class="hljs-number">80</span><br><span class="hljs-string">CMD</span> <span class="hljs-string">/usr/sbin/nginx</span><br></code></pre></td></tr></table></figure><p>â€‹      ç›¸å…³æŒ‡ä»¤çš„æ„ä¹‰å¦‚ä¸‹ã€‚</p><p><img src="https://s2.loli.net/2025/01/17/kcve1uAWLjZG8Ka.png" alt="image-20250117215021189"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">ä¸Šè¿°Dockerfileæ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªæŒ‡ä»¤â€œMAINTAINERâ€åœ¨ä¸Šè¡¨ä¸­æœªåˆ—å‡ºï¼Œå®ƒæŒ‡å®šçš„æ˜¯é•œåƒçš„ç»´æŠ¤äººå‘˜ä¿¡æ¯ä¸€èˆ¬ä¹Ÿå°±æ˜¯é•œåƒä½œè€…<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœæœ¬åœ°æ²¡æœ‰é•œåƒâ€œcentos:centos7â€ï¼Œå»ºè®®å…ˆæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å°†æ­¤é•œåƒæ‹‰å–ä¸‹æ¥ï¼Œå‡å°‘dcoker buildé˜¶æ®µçš„æ—¶é—´</span><br>docker pull centos:centos7<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ¥ä¸‹æ¥å°±å¯ä»¥æ„å»ºé•œåƒäº†ï¼Œç¼–è¯‘é•œåƒçš„å‘½ä»¤å¦‚ä¸‹</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å…¶ä¸­buildæ˜¯dockerçš„å­å‘½ä»¤</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">./ è¡¨ç¤ºç¼–è¯‘é•œåƒæ—¶å®¿ä¸»çš„å·¥ä½œç›®å½•</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">-få‚æ•°æŒ‡å®šè¦ä½¿ç”¨çš„Dockerfileæ–‡ä»¶ã€‚å¦‚æœæœ‰å¦å¤–ä¸€ä¸ªnginx.Dockerfileåˆ™ä½¿ç”¨è¿™ä¸ªåå­—</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">-t å‚æ•°æŒ‡å®šç¼–è¯‘å®Œæˆç”Ÿæˆçš„é•œåƒçš„åç§°ä¸æ ‡ç­¾</span><br>root@ubuntu20:/opt/manual-for-ppt# docker build ./ -f Dockerfile -t nginx:v001<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä»ä¸‹å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæœ¬åœ°dockerç¯å¢ƒä¸­æœ‰äº†ä¸€ä¸ªé•œåƒ nginx:v001</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/17/SaByPpFNumClfqI.png" alt="image-20250117215154332"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹é•œåƒä¿¡æ¯</span><br>root@ubuntu20:/opt/manual-for-ppt# docker inspect nginx:v001 | grep -i &quot;good&quot;<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯ä»¥çœ‹åˆ°Dockerfileæ–‡ä»¶ä¸­MAINTAINERæŒ‡ä»¤æŒ‡å®šçš„å€¼å°±æ˜¯é•œåƒçš„Authtorå±æ€§å€¼ã€‚</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/17/zwXn9j7ZQfEMmJB.png" alt="image-20250117215246362"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ©ç”¨ä¸Šè¿°ç”Ÿæˆçš„é•œåƒåˆ›å»ºä¸€ä¸ªå¯åŠ¨nginxè¿›ç¨‹çš„å®¹å™¨</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä»¥ä¸‹å‘½ä»¤æŒ‡å®šå®¹å™¨åç§°ä¸ºnginx01ï¼Œ-dè¡¨ç¤ºä»¥åå°æ¨¡å¼è¿è¡Œï¼Œ-påšå®¿ä¸»æœºä¸å®¹å™¨ç«¯å£æ˜ å°„</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å› ä¸ºåˆ¶ä½œå®¹å™¨nginx:v001æ—¶ï¼Œå·²ç»æŒ‡å®šâ€ CMD /usr/sbin/nginxâ€è¡¨ç¤ºå®¹å™¨å¯åŠ¨åå°±ä¼šè‡ªåŠ¨æ‰§è¡Œ/usr/sbin/nginxï¼Œä¸éœ€è¦å†åœ¨docker runå‘½ä»¤åé¢å†æ·»åŠ æŒ‡ä»¤å‚æ•°ï¼Œæ·»åŠ æŒ‡ä»¤å‚æ•°å¦‚/bin/bashå°†ä¼šæ›¿æ¢â€œ/usr/sbin/nginxâ€ï¼Œåˆ™æ­¤å®¹å™¨å°†ä¸ä¼šè‡ªåŠ¨å¯åŠ¨nginxç›¸å…³è¿›ç¨‹</span><br>docker run -d --name nginx01 -p 8080:80 nginx:v001<br>docker ps -a | egrep &quot;NAME|nginx01&quot;<br>curl 127.0.0.1:8080<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/17/8jF6xlUL9HOaZMp.png" alt="image-20250117215313476"></p><p>â€‹      æ­¤æ—¶ï¼Œæ¯”å¦‚å½“å‰å®¿ä¸»æœºçš„ipæ˜¯10.10.0.51ï¼Œè‡ªå·±ç¬”è®°æœ¬ç”µè„‘ä¸Šæˆ–å…¶ä»–æœ‰æ¡Œé¢çš„æ“ä½œç³»ç»Ÿé€šè¿‡æµè§ˆå™¨è®¿é—® <a href="http://10.10.0.51:8080/">http://10.10.0.51:8080</a> ï¼Œä¹Ÿå¯ä»¥è®¿é—®ä¸Šè¿°nginxä¸»é¡µã€‚</p><p>â€‹      å…³äºDockerfileæ›´è¯¦ç»†çš„ç”¨æ³•ï¼Œå¯ä»¥å‚è€ƒ <a href="https://docs.docker.com/reference/dockerfile/">å®˜ç½‘æ–‡æ¡£Dockerfile reference</a> æˆ–  <a href="https://www.runoob.com/docker/docker-dockerfile.html">èœé¸Ÿæ•™ç¨‹Dockerfileæ–‡æ¡£</a> </p><h1 id="3-docker-saveä¸docker-load-å‘½ä»¤"><a href="#3-docker-saveä¸docker-load-å‘½ä»¤" class="headerlink" title="3 docker saveä¸docker load å‘½ä»¤"></a>3 docker saveä¸docker load å‘½ä»¤</h1><p>â€‹      <code>docker save</code>å‘½ä»¤çš„åŠŸèƒ½æ˜¯å°†ä¸€ä¸ªå®¹å™¨é•œåƒä¿å­˜ä¸ºä¸€ä¸ªæœ¬åœ°æ–‡ä»¶ï¼ˆç›¸å½“äºè¢«æŒä¹…åŒ–ä¿å­˜äº†ï¼‰ï¼Œ<code>docker load</code>å‘½ä»¤å°†<code>docker save</code>ç”Ÿæˆçš„æœ¬åœ°é•œåƒæ–‡ä»¶å¯¼å…¥åˆ°æœ¬åœ°dockerç¯å¢ƒä¸­ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†å®¹å™¨é•œåƒä¿å­˜ä¸ºæœ¬åœ°æ–‡ä»¶nginx-v001.tar</span><br>root@ubuntu20:~# docker save -o nginx-v001.tar nginx:v001<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/17/AcsGyjJk2mewr5z.png" alt="image-20250117215708133"></p><p><img src="https://s2.loli.net/2025/01/17/1Nj6Z45L7WqmMpy.png" alt="image-20250117215716903"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯ä»¥å°†æ–‡ä»¶ä¼ è¾“åˆ°å…¶ä»–å®‰è£…äº†dockerå®¹å™¨å¼•æ“çš„æœåŠ¡å™¨ä¸Šï¼Œå†ä½¿ç”¨docker loadå‘½ä»¤å¯¼å…¥å³æ˜¯ä¸€ä¸ªå¯ç”¨çš„å®¹å™¨é•œåƒ</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ¯”å¦‚ä¼ è¾“æ­¤æ–‡ä»¶åˆ°å¦å¤–ä¸€ä¸ªæœåŠ¡å™¨controller01ä¸Šï¼Œç„¶åå¯¼å…¥å¹¶ä½¿ç”¨</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:~# docker load -i nginx-v001.tar<br>root@controller01:~# docker run -d --name nginx-test -p 8085:80 nginx:v001<br>root@controller01:~# curl 127.0.0.1:8085<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/17/MKIiy79hOutlXW3.png" alt="image-20250117215853043"></p><h1 id="4-docker-exportä¸docker-importå‘½ä»¤"><a href="#4-docker-exportä¸docker-importå‘½ä»¤" class="headerlink" title="4 docker exportä¸docker importå‘½ä»¤"></a>4 docker exportä¸docker importå‘½ä»¤</h1><p>â€‹      <code>docker export</code>å‘½ä»¤ï¼Œç±»ä¼¼äº<code>docker save</code>ï¼Œä½†å‰è€…æ˜¯å°†ä¸€ä¸ªå®¹å™¨ä¿å­˜æˆä¸€ä¸ªæ–‡ä»¶ï¼Œåè€…æ˜¯å°†ä¸€ä¸ªå®¹å™¨é•œåƒä¿å­˜æˆä¸€ä¸ªæ–‡ä»¶ã€‚</p><p>â€‹      <code>docker import</code>å‘½ä»¤ï¼Œæœ‰ç‚¹ç±»ä¼¼äº<code>docker load</code>ï¼Œå°†<code>docker export</code>ä¿å­˜çš„æ–‡ä»¶å¯¼å…¥æˆ<code>docker</code>é•œåƒã€‚</p><p><strong>æ³¨æ„</strong>ï¼š<code>docker import</code>ä¸<code>docker export</code>æ˜¯ä¸€å¯¹çš„ï¼Œå®ƒä»¬æˆå¯¹ä½¿ç”¨ã€‚<code>docker import</code>ä¸èƒ½è·Ÿ<code>docker save</code>æ··ç”¨ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†centos01å®¹å™¨æ‰“åŒ…ä¿å­˜æˆé•œåƒæ–‡ä»¶centos-v0.2.taråˆ°æœ¬åœ°</span><br>root@kafka:/opt# docker export -o centos-v0.2.tar centos01<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/17/fGsZeQrVFNlgq3R.png" alt="image-20250117220238284"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">docker importæ—¶ï¼Œå¼ºçƒˆå»ºè®®è®¾å®šå¥½é•œåƒåä¸æ ‡ç­¾ï¼ˆå¦åˆ™å°±åƒä¸‹å›¾æœ€åº•è¡Œä¸€æ ·ï¼Œé•œåƒåä¸æ ‡ç­¾éƒ½æ²¡æœ‰ï¼Œåªèƒ½é€šè¿‡é•œåƒ<span class="hljs-built_in">id</span>æ¥å¼•ç”¨ï¼‰</span><br>root@kafka:/opt/msb_study# docker import centos-v0.2.tar centos:v0.2<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/17/I1Y9V27uoq5m4Cz.png" alt="image-20250117220654638"></p>]]></content>
    
    
    <categories>
      
      <category>k8säº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å®¹å™¨é•œåƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HAMiå®˜æ–¹ç›‘æ§æ–‡æ¡£ç›¸å…³å†…å®¹åˆ†æ</title>
    <link href="/2025/01/14/HAMi%E5%AE%98%E6%96%B9%E7%9B%91%E6%8E%A7%E6%96%87%E6%A1%A3%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9%E5%88%86%E6%9E%90/"/>
    <url>/2025/01/14/HAMi%E5%AE%98%E6%96%B9%E7%9B%91%E6%8E%A7%E6%96%87%E6%A1%A3%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯åŠç¯å¢ƒ"><a href="#èƒŒæ™¯åŠç¯å¢ƒ" class="headerlink" title="èƒŒæ™¯åŠç¯å¢ƒ"></a>èƒŒæ™¯åŠç¯å¢ƒ</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ“ä½œç³»ç»Ÿï¼šUbuntu 20.04.3 LTS x86_64</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">HAMiç‰ˆæœ¬ï¼š2.4.1</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">Kubernetesç‰ˆæœ¬ï¼š1.23.17</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:~# kubectl get nodes<br>NAME          STATUS     ROLES    AGE    VERSION<br>172.20.0.21   Ready      master   7d3h   v1.23.17<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç›¸å…³ä»»åŠ¡è´Ÿè½½</span><br>root@controller01:/opt/installPkgs/k8s-vgpu-basedon-HAMi# cat gpu-test5.yaml <br>apiVersion: v1<br>kind: Pod<br>metadata:<br>  name: gpu-test5-01<br>spec:<br>  restartPolicy: OnFailure<br><span class="hljs-meta prompt_">  # </span><span class="language-bash"> nodeName: controller01</span><br>  containers:<br>    - name: gpu-test111<br>      image: 175.6.40.93:8196/k8s-kubekey/ubuntu2004:pytorch2.2.2-classification-example<br>      command:<br>        - python3<br>        - /opt/classification/train.py<br>      resources:<br>        limits:<br>          nvidia.com/vgpu: 2 # requesting 2 vGPUs<br>          nvidia.com/gpumem: 3000 # Each vGPU contains 3000m device memory ï¼ˆOptional,Integerï¼‰<br>          #nvidia.com/gpumem-percentage: 10 #Each vGPU containers 10% device memory of that GPU. Can not be used with nvidia.com/gpumem<br>          <br>root@controller01:/opt/installPkgs/k8s-vgpu-basedon-HAMi# kubectl apply -f gpu-test5.yaml<br></code></pre></td></tr></table></figure><h1 id="ä¸€ã€å…³äºns-kube-systemä¸‹svcçš„åˆ†æ"><a href="#ä¸€ã€å…³äºns-kube-systemä¸‹svcçš„åˆ†æ" class="headerlink" title="ä¸€ã€å…³äºns&#x2F;kube-systemä¸‹svcçš„åˆ†æ"></a>ä¸€ã€å…³äºns&#x2F;kube-systemä¸‹svcçš„åˆ†æ</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:/opt/installPkgs/k8s-vgpu-basedon-HAMi/deploy-prometheus# kubectl -n kube-system get svc<br>NAME                         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                         AGE<br>dashboard-metrics-scraper    ClusterIP   10.68.5.223     &lt;none&gt;        8000/TCP                        4d2h<br>hami-device-plugin-monitor   NodePort    10.68.183.209   &lt;none&gt;        31992:31992/TCP                 6h35m<br>hami-scheduler               NodePort    10.68.83.62     &lt;none&gt;        443:31998/TCP,31993:31993/TCP   6h35m<br>kube-dns                     ClusterIP   10.68.0.2       &lt;none&gt;        53/UDP,53/TCP,9153/TCP          4d2h<br>kube-dns-upstream            ClusterIP   10.68.48.155    &lt;none&gt;        53/UDP,53/TCP                   4d2h<br>kubelet                      ClusterIP   None            &lt;none&gt;        10250/TCP,10255/TCP,4194/TCP    4d2h<br>kubernetes-dashboard         NodePort    10.68.176.76    &lt;none&gt;        443:30119/TCP                   4d2h<br>metrics-server               ClusterIP   10.68.24.142    &lt;none&gt;        443/TCP                         4d2h<br>node-local-dns               ClusterIP   None            &lt;none&gt;        9253/TCP                        4d2h<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å‡†å¤‡â€œä½¿ç”¨vGPUçš„yamlä¾‹â€</span><br>root@controller01:/opt/installPkgs/k8s-vgpu-basedon-HAMi# cat gpu-test5.yaml <br>apiVersion: v1<br>kind: Pod<br>metadata:<br>  name: gpu-test5-01<br>spec:<br>  restartPolicy: OnFailure<br><span class="hljs-meta prompt_">  # </span><span class="language-bash"> nodeName: controller01</span><br>  containers:<br>    - name: gpu-test111<br>      image: 175.6.40.93:8196/k8s-kubekey/ubuntu2004:pytorch2.2.2-classification-example<br>      command:<br>        - python3<br>        - /opt/classification/train.py<br>      resources:<br>        limits:<br>          nvidia.com/vgpu: 2 # requesting 1 vGPUs<br>          nvidia.com/gpumem: 3000 # Each vGPU contains 3000m device memory ï¼ˆOptional,Integerï¼‰<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:/opt/installPkgs/k8s-vgpu-basedon-HAMi# kubectl apply -f gpu-test5.yaml<br>pod/gpu-test5-01 created<br>root@controller01:/opt/installPkgs/k8s-vgpu-basedon-HAMi# kubectl get pods<br>NAME           READY   STATUS    RESTARTS   AGE<br>gpu-test5-01   1/1     Running   0          4s<br></code></pre></td></tr></table></figure><h2 id="1-1-svc-hami-device-plugin-monitor"><a href="#1-1-svc-hami-device-plugin-monitor" class="headerlink" title="1.1 svc&#x2F;hami-device-plugin-monitor"></a>1.1 svc&#x2F;hami-device-plugin-monitor</h2><h3 id="1-1-1-svcæœ¬èº«"><a href="#1-1-1-svcæœ¬èº«" class="headerlink" title="1.1.1 svcæœ¬èº«"></a>1.1.1 svcæœ¬èº«</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:~# kubectl -n kube-system get svc hami-device-plugin-monitor -o yaml<br>apiVersion: v1<br>kind: Service<br>metadata:<br>  annotations:<br>    meta.helm.sh/release-name: hami<br>    meta.helm.sh/release-namespace: kube-system<br>  creationTimestamp: &quot;2025-01-14T02:34:24Z&quot;<br>  labels:<br>    app.kubernetes.io/component: hami-device-plugin<br>    app.kubernetes.io/instance: hami<br>    app.kubernetes.io/managed-by: Helm<br>    app.kubernetes.io/name: hami<br>    app.kubernetes.io/version: 2.4.1<br>    helm.sh/chart: hami-2.4.1<br>  name: hami-device-plugin-monitor<br>  namespace: kube-system<br>  resourceVersion: &quot;737654&quot;<br>  uid: 167789e8-f5a4-483a-ab5c-a1d154c8337c<br>spec:<br>  clusterIP: 10.68.183.209<br>  clusterIPs:<br>  - 10.68.183.209<br>  externalTrafficPolicy: Local<br>  internalTrafficPolicy: Cluster<br>  ipFamilies:<br>  - IPv4<br>  ipFamilyPolicy: SingleStack<br>  ports:<br>  - name: monitorport<br>    nodePort: 31992<br>    port: 31992<br>    protocol: TCP<br>    targetPort: 9394<br>  selector:<br>    app.kubernetes.io/component: hami-device-plugin<br>  sessionAffinity: None<br>  type: NodePort<br>status:<br>  loadBalancer: &#123;&#125;<br></code></pre></td></tr></table></figure><h3 id="1-1-2-ç›‘æ§æŒ‡æ ‡"><a href="#1-1-2-ç›‘æ§æŒ‡æ ‡" class="headerlink" title="1.1.2 ç›‘æ§æŒ‡æ ‡"></a>1.1.2 ç›‘æ§æŒ‡æ ‡</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##hami-device-plugin-monitor çš„ç›‘æ§æŒ‡æ ‡ï¼Œæµè§ˆå™¨è®¿é—®ï¼šhttp://172.20.0.21:31992/metrics</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##è¿”å›ç»“æœå¦‚ä¸‹</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP Device_last_kernel_of_container Container device last kernel description</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE Device_last_kernel_of_container gauge</span><br>Device_last_kernel_of_container&#123;ctrname=&quot;gpu-test111&quot;,deviceuuid=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,podname=&quot;gpu-test5-01&quot;,podnamespace=&quot;default&quot;,vdeviceid=&quot;1&quot;,zone=&quot;vGPU&quot;&#125; 0<br>Device_last_kernel_of_container&#123;ctrname=&quot;gpu-test111&quot;,deviceuuid=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,podname=&quot;gpu-test5-01&quot;,podnamespace=&quot;default&quot;,vdeviceid=&quot;0&quot;,zone=&quot;vGPU&quot;&#125; 0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP Device_memory_desc_of_container Container device meory description</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE Device_memory_desc_of_container counter</span><br>Device_memory_desc_of_container&#123;context=&quot;0&quot;,ctrname=&quot;gpu-test111&quot;,data=&quot;0&quot;,deviceuuid=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,module=&quot;0&quot;,offset=&quot;0&quot;,podname=&quot;gpu-test5-01&quot;,podnamespace=&quot;default&quot;,vdeviceid=&quot;1&quot;,zone=&quot;vGPU&quot;&#125; 0<br>Device_memory_desc_of_container&#123;context=&quot;272629760&quot;,ctrname=&quot;gpu-test111&quot;,data=&quot;453545472&quot;,deviceuuid=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,module=&quot;0&quot;,offset=&quot;0&quot;,podname=&quot;gpu-test5-01&quot;,podnamespace=&quot;default&quot;,vdeviceid=&quot;0&quot;,zone=&quot;vGPU&quot;&#125; 7.26175232e+08<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP Device_utilization_desc_of_container Container device utilization description</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE Device_utilization_desc_of_container gauge</span><br>Device_utilization_desc_of_container&#123;ctrname=&quot;gpu-test111&quot;,deviceuuid=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,podname=&quot;gpu-test5-01&quot;,podnamespace=&quot;default&quot;,vdeviceid=&quot;1&quot;,zone=&quot;vGPU&quot;&#125; 0<br>Device_utilization_desc_of_container&#123;ctrname=&quot;gpu-test111&quot;,deviceuuid=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,podname=&quot;gpu-test5-01&quot;,podnamespace=&quot;default&quot;,vdeviceid=&quot;0&quot;,zone=&quot;vGPU&quot;&#125; 0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP HostCoreUtilization GPU core utilization</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE HostCoreUtilization gauge</span><br>HostCoreUtilization&#123;deviceidx=&quot;0&quot;,deviceuuid=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,zone=&quot;vGPU&quot;&#125; 17<br>HostCoreUtilization&#123;deviceidx=&quot;1&quot;,deviceuuid=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,zone=&quot;vGPU&quot;&#125; 0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP HostGPUMemoryUsage GPU device memory usage</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE HostGPUMemoryUsage gauge</span><br>HostGPUMemoryUsage&#123;deviceidx=&quot;0&quot;,deviceuuid=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,zone=&quot;vGPU&quot;&#125; 1.49651456e+09<br>HostGPUMemoryUsage&#123;deviceidx=&quot;1&quot;,deviceuuid=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,zone=&quot;vGPU&quot;&#125; 7.00317696e+08<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP vGPU_device_memory_limit_in_bytes vGPU device <span class="hljs-built_in">limit</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE vGPU_device_memory_limit_in_bytes gauge</span><br>vGPU_device_memory_limit_in_bytes&#123;ctrname=&quot;gpu-test111&quot;,deviceuuid=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,podname=&quot;gpu-test5-01&quot;,podnamespace=&quot;default&quot;,vdeviceid=&quot;1&quot;,zone=&quot;vGPU&quot;&#125; 3.145728e+09<br>vGPU_device_memory_limit_in_bytes&#123;ctrname=&quot;gpu-test111&quot;,deviceuuid=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,podname=&quot;gpu-test5-01&quot;,podnamespace=&quot;default&quot;,vdeviceid=&quot;0&quot;,zone=&quot;vGPU&quot;&#125; 3.145728e+09<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP vGPU_device_memory_usage_in_bytes vGPU device usage</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE vGPU_device_memory_usage_in_bytes gauge</span><br>vGPU_device_memory_usage_in_bytes&#123;ctrname=&quot;gpu-test111&quot;,deviceuuid=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,podname=&quot;gpu-test5-01&quot;,podnamespace=&quot;default&quot;,vdeviceid=&quot;1&quot;,zone=&quot;vGPU&quot;&#125; 0<br>vGPU_device_memory_usage_in_bytes&#123;ctrname=&quot;gpu-test111&quot;,deviceuuid=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,podname=&quot;gpu-test5-01&quot;,podnamespace=&quot;default&quot;,vdeviceid=&quot;0&quot;,zone=&quot;vGPU&quot;&#125; 7.26175232e+08<br></code></pre></td></tr></table></figure><h3 id="1-1-3-å¯¹åº”çš„smon"><a href="#1-1-3-å¯¹åº”çš„smon" class="headerlink" title="1.1.3 å¯¹åº”çš„smon"></a>1.1.3 å¯¹åº”çš„smon</h3><p>æ­¤servicemonitorç”±è‡ªå·±è¿›è¡Œå°è£…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¼ ç»Ÿæ–¹å¼éƒ¨ç½²prometheusæ—¶ï¼Œæ˜¯åŸºäºprometheus.yamlæ¥é…ç½®ç›‘æ§ç›®æ ‡çš„ï¼Œå¦‚æœéœ€è¦é…ç½®çš„å†…å®¹å¤šå°±ä¼šäº§ç”Ÿå¯è¯»æ€§é—®é¢˜</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"> æ‰€ä»¥åé¢æœ‰äº†æœåŠ¡å‘ç°å³å¢åŠ file_sd_configç­‰ï¼Œæ¥ä»¥å‡å°‘prometheus.yamlä¸­çš„é…ç½®å†…å®¹</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨k8sä¸­ï¼Œservicemonitorå°±æ˜¯æ‰¿æ‹…äº†â€œæœåŠ¡å‘ç°â€çš„ç±»ä¼¼çš„ä½œç”¨ã€‚å°±æ˜¯è¯´å¦‚æœæ²¡æœ‰smonï¼Œå¯ä»¥é€šè¿‡hamiè‡ªèº«éƒ¨ç½²åœ¨ns/kube-systemä¸­çš„svc/hami-device-plugin-monitoræŸ¥çœ‹åˆ°ç›¸åº”çš„ç›‘æ§æ•°æ®ï¼Œä½†ä¸ä¼šè¢«ä¿å­˜åˆ°prometheusæ—¶åºæ•°æ®åº“ä¸­ï¼ˆå¯ä»¥é€šè¿‡ä¸‹é¢ä¸¤å¼ æˆªå›¾å¾—åˆ°éªŒè¯ï¼Œå¯ä»¥æŸ¥çœ‹æˆªå›¾ä¸­åœ¨ç›¸å…³æ—¶é—´èŒƒå›´å†…æ£€ç´¢åˆ°çš„æ•°æ®ï¼š16:35å·¦å³å°†smon/hami-device-plugin-svc-monitoråˆ é™¤ï¼Œç„¶ååœ¨16:55å·¦å³åˆé‡æ–°åˆ›å»ºå‡ºæ¥ã€‚ï¼‰</span><br>root@controller01:/opt/installPkgs/k8s-vgpu-basedon-HAMi/deploy-prometheus# ll hami-device-plugin-svc-monitor.yaml <br>root@controller01:/opt/installPkgs/k8s-vgpu-basedon-HAMi/deploy-prometheus# cat hami-device-plugin-svc-monitor.yaml<br>apiVersion: monitoring.coreos.com/v1<br>kind: ServiceMonitor<br>metadata:<br>  name: hami-device-plugin-svc-monitor<br>  namespace: kube-system<br>spec:<br>  selector:<br>    matchLabels:<br>      app.kubernetes.io/component: hami-device-plugin<br>  namespaceSelector:<br>    matchNames:<br>      - &quot;kube-system&quot;<br>  endpoints:<br>  - path: /metrics<br>    port: monitorport<br>    interval: &quot;15s&quot;<br>    honorLabels: false<br>    relabelings:<br>    - sourceLabels: [__meta_kubernetes_endpoints_name]<br>      regex: hami-.*<br>      replacement: $1<br>      action: keep<br>    - sourceLabels: [__meta_kubernetes_pod_node_name]<br>      regex: (.*)<br>      targetLabel: node_name<br>      replacement: $&#123;1&#125;<br>      action: replace<br>    - sourceLabels: [__meta_kubernetes_pod_host_ip]<br>      regex: (.*)<br>      targetLabel: ip<br>      replacement: $1<br>      action: replace<br><br><br>root@controller01:/opt/installPkgs/k8s-vgpu-basedon-HAMi/deploy-prometheus# kubectl -n kube-system get smon hami-device-plugin-svc-monitor -o yaml<br><br>apiVersion: monitoring.coreos.com/v1<br>kind: ServiceMonitor<br>metadata:<br>  annotations:<br>    kubectl.kubernetes.io/last-applied-configuration: |<br>      &#123;&quot;apiVersion&quot;:&quot;monitoring.coreos.com/v1&quot;,&quot;kind&quot;:&quot;ServiceMonitor&quot;,&quot;metadata&quot;:&#123;&quot;annotations&quot;:&#123;&#125;,&quot;name&quot;:&quot;hami-device-plugin-svc-monitor&quot;,&quot;namespace&quot;:&quot;kube-system&quot;&#125;,&quot;spec&quot;:&#123;&quot;endpoints&quot;:[&#123;&quot;honorLabels&quot;:false,&quot;interval&quot;:&quot;15s&quot;,&quot;path&quot;:&quot;/metrics&quot;,&quot;port&quot;:&quot;monitorport&quot;,&quot;relabelings&quot;:[&#123;&quot;action&quot;:&quot;keep&quot;,&quot;regex&quot;:&quot;hami-.*&quot;,&quot;replacement&quot;:&quot;$1&quot;,&quot;sourceLabels&quot;:[&quot;__meta_kubernetes_endpoints_name&quot;]&#125;,&#123;&quot;action&quot;:&quot;replace&quot;,&quot;regex&quot;:&quot;(.*)&quot;,&quot;replacement&quot;:&quot;$&#123;1&#125;&quot;,&quot;sourceLabels&quot;:[&quot;__meta_kubernetes_pod_node_name&quot;],&quot;targetLabel&quot;:&quot;node_name&quot;&#125;,&#123;&quot;action&quot;:&quot;replace&quot;,&quot;regex&quot;:&quot;(.*)&quot;,&quot;replacement&quot;:&quot;$1&quot;,&quot;sourceLabels&quot;:[&quot;__meta_kubernetes_pod_host_ip&quot;],&quot;targetLabel&quot;:&quot;ip&quot;&#125;]&#125;],&quot;namespaceSelector&quot;:&#123;&quot;matchNames&quot;:[&quot;kube-system&quot;]&#125;,&quot;selector&quot;:&#123;&quot;matchLabels&quot;:&#123;&quot;app.kubernetes.io/component&quot;:&quot;hami-device-plugin&quot;&#125;&#125;&#125;&#125;<br>  creationTimestamp: &quot;2025-01-14T06:40:10Z&quot;<br>  generation: 1<br>  name: hami-device-plugin-svc-monitor<br>  namespace: kube-system<br>  resourceVersion: &quot;764614&quot;<br>  uid: 8eab0c04-7047-4811-af8a-425df908b797<br>spec:<br>  endpoints:<br>  - honorLabels: false<br>    interval: 15s<br>    path: /metrics<br>    port: monitorport<br>    relabelings:<br>    - action: keep<br>      regex: hami-.*<br>      replacement: $1<br>      sourceLabels:<br>      - __meta_kubernetes_endpoints_name<br>    - action: replace<br>      regex: (.*)<br>      replacement: $&#123;1&#125;<br>      sourceLabels:<br>      - __meta_kubernetes_pod_node_name<br>      targetLabel: node_name<br>    - action: replace<br>      regex: (.*)<br>      replacement: $1<br>      sourceLabels:<br>      - __meta_kubernetes_pod_host_ip<br>      targetLabel: ip<br>  namespaceSelector:<br>    matchNames:<br>    - kube-system<br>  selector:<br>    matchLabels:<br>      app.kubernetes.io/component: hami-device-plugin<br></code></pre></td></tr></table></figure><p><img src="C:\Users\jiangsanyin\AppData\Roaming\Typora\typora-user-images\image-20250116165340426.png" alt="image-20250116165340426"></p><p><img src="C:\Users\jiangsanyin\AppData\Roaming\Typora\typora-user-images\image-20250116165713613.png" alt="image-20250116165713613"></p><h2 id="1-2-svc-hami-scheduler"><a href="#1-2-svc-hami-scheduler" class="headerlink" title="1.2 svc&#x2F;hami-scheduler"></a>1.2 svc&#x2F;hami-scheduler</h2><h3 id="1-2-1-svcæœ¬èº«"><a href="#1-2-1-svcæœ¬èº«" class="headerlink" title="1.2.1 svcæœ¬èº«"></a>1.2.1 svcæœ¬èº«</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:~# kubectl -n kube-system get svc hami-scheduler -o yaml<br>apiVersion: v1<br>kind: Service<br>metadata:<br>  annotations:<br>    meta.helm.sh/release-name: hami<br>    meta.helm.sh/release-namespace: kube-system<br>  creationTimestamp: &quot;2025-01-14T02:34:24Z&quot;<br>  labels:<br>    app.kubernetes.io/component: hami-scheduler<br>    app.kubernetes.io/instance: hami<br>    app.kubernetes.io/managed-by: Helm<br>    app.kubernetes.io/name: hami<br>    app.kubernetes.io/version: 2.4.1<br>    helm.sh/chart: hami-2.4.1<br>  name: hami-scheduler<br>  namespace: kube-system<br>  resourceVersion: &quot;737655&quot;<br>  uid: 6b1d223f-6d80-4ae8-a930-7878193dc200<br>spec:<br>  clusterIP: 10.68.83.62<br>  clusterIPs:<br>  - 10.68.83.62<br>  externalTrafficPolicy: Cluster<br>  internalTrafficPolicy: Cluster<br>  ipFamilies:<br>  - IPv4<br>  ipFamilyPolicy: SingleStack<br>  ports:<br>  - name: http<br>    nodePort: 31998<br>    port: 443<br>    protocol: TCP<br>    targetPort: 443<br>  - name: monitor<br>    nodePort: 31993<br>    port: 31993<br>    protocol: TCP<br>    targetPort: 9395<br>  selector:<br>    app.kubernetes.io/component: hami-scheduler<br>    app.kubernetes.io/instance: hami<br>    app.kubernetes.io/name: hami<br>  sessionAffinity: None<br>  type: NodePort<br>status:<br>  loadBalancer: &#123;&#125;<br></code></pre></td></tr></table></figure><h3 id="1-2-2-ç›‘æ§æŒ‡æ ‡"><a href="#1-2-2-ç›‘æ§æŒ‡æ ‡" class="headerlink" title="1.2.2 ç›‘æ§æŒ‡æ ‡"></a>1.2.2 ç›‘æ§æŒ‡æ ‡</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##hami-scheduler çš„ç›‘æ§æŒ‡æ ‡ï¼Œæµè§ˆå™¨è®¿é—®ï¼šhttp://172.20.0.21:31993/metrics</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##è¿”å›ç»“æœå¦‚ä¸‹</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP GPUDeviceCoreAllocated Device core allocated <span class="hljs-keyword">for</span> a certain GPU</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE GPUDeviceCoreAllocated gauge</span><br>GPUDeviceCoreAllocated&#123;deviceidx=&quot;0&quot;,deviceuuid=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,nodeid=&quot;172.20.0.21&quot;,zone=&quot;vGPU&quot;&#125; 0<br>GPUDeviceCoreAllocated&#123;deviceidx=&quot;0&quot;,deviceuuid=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,nodeid=&quot;172.20.0.21&quot;,zone=&quot;vGPU&quot;&#125; 0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP GPUDeviceCoreLimit Device memory core <span class="hljs-built_in">limit</span> <span class="hljs-keyword">for</span> a certain GPU</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE GPUDeviceCoreLimit gauge</span><br>GPUDeviceCoreLimit&#123;deviceidx=&quot;0&quot;,deviceuuid=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,nodeid=&quot;172.20.0.21&quot;,zone=&quot;vGPU&quot;&#125; 100<br>GPUDeviceCoreLimit&#123;deviceidx=&quot;0&quot;,deviceuuid=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,nodeid=&quot;172.20.0.21&quot;,zone=&quot;vGPU&quot;&#125; 100<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP GPUDeviceMemoryAllocated Device memory allocated <span class="hljs-keyword">for</span> a certain GPU</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE GPUDeviceMemoryAllocated gauge</span><br>GPUDeviceMemoryAllocated&#123;devicecores=&quot;0&quot;,deviceidx=&quot;0&quot;,deviceuuid=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,nodeid=&quot;172.20.0.21&quot;,zone=&quot;vGPU&quot;&#125; 3.145728e+09<br>GPUDeviceMemoryAllocated&#123;devicecores=&quot;0&quot;,deviceidx=&quot;0&quot;,deviceuuid=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,nodeid=&quot;172.20.0.21&quot;,zone=&quot;vGPU&quot;&#125; 3.145728e+09<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP GPUDeviceMemoryLimit Device memory <span class="hljs-built_in">limit</span> <span class="hljs-keyword">for</span> a certain GPU</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE GPUDeviceMemoryLimit gauge</span><br>GPUDeviceMemoryLimit&#123;deviceidx=&quot;0&quot;,deviceuuid=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,nodeid=&quot;172.20.0.21&quot;,zone=&quot;vGPU&quot;&#125; 4.8305799168e+10<br>GPUDeviceMemoryLimit&#123;deviceidx=&quot;0&quot;,deviceuuid=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,nodeid=&quot;172.20.0.21&quot;,zone=&quot;vGPU&quot;&#125; 4.8305799168e+10<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP GPUDeviceSharedNum Number of containers sharing this GPU</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE GPUDeviceSharedNum gauge</span><br>GPUDeviceSharedNum&#123;deviceidx=&quot;0&quot;,deviceuuid=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,nodeid=&quot;172.20.0.21&quot;,zone=&quot;vGPU&quot;&#125; 1<br>GPUDeviceSharedNum&#123;deviceidx=&quot;0&quot;,deviceuuid=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,nodeid=&quot;172.20.0.21&quot;,zone=&quot;vGPU&quot;&#125; 1<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP nodeGPUMemoryPercentage GPU Memory Allocated Percentage on a certain GPU</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE nodeGPUMemoryPercentage gauge</span><br>nodeGPUMemoryPercentage&#123;deviceidx=&quot;0&quot;,deviceuuid=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,nodeid=&quot;172.20.0.21&quot;,zone=&quot;vGPU&quot;&#125; 0.06512112529304506<br>nodeGPUMemoryPercentage&#123;deviceidx=&quot;0&quot;,deviceuuid=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,nodeid=&quot;172.20.0.21&quot;,zone=&quot;vGPU&quot;&#125; 0.06512112529304506<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP nodeGPUOverview GPU overview on a certain node</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE nodeGPUOverview gauge</span><br>nodeGPUOverview&#123;devicecores=&quot;0&quot;,deviceidx=&quot;0&quot;,devicememorylimit=&quot;46068&quot;,devicetype=&quot;NVIDIA-NVIDIA A40&quot;,deviceuuid=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,nodeid=&quot;172.20.0.21&quot;,sharedcontainers=&quot;1&quot;,zone=&quot;vGPU&quot;&#125; 3.145728e+09<br>nodeGPUOverview&#123;devicecores=&quot;0&quot;,deviceidx=&quot;0&quot;,devicememorylimit=&quot;46068&quot;,devicetype=&quot;NVIDIA-NVIDIA A40&quot;,deviceuuid=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,nodeid=&quot;172.20.0.21&quot;,sharedcontainers=&quot;1&quot;,zone=&quot;vGPU&quot;&#125; 3.145728e+09<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP vGPUCorePercentage vGPU core allocated from a container</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE vGPUCorePercentage gauge</span><br>vGPUCorePercentage&#123;containeridx=&quot;0&quot;,deviceuuid=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,nodename=&quot;172.20.0.21&quot;,podname=&quot;gpu-test5-01&quot;,podnamespace=&quot;default&quot;,zone=&quot;vGPU&quot;&#125; 0<br>vGPUCorePercentage&#123;containeridx=&quot;0&quot;,deviceuuid=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,nodename=&quot;172.20.0.21&quot;,podname=&quot;gpu-test5-01&quot;,podnamespace=&quot;default&quot;,zone=&quot;vGPU&quot;&#125; 0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP vGPUMemoryPercentage vGPU memory percentage allocated from a container</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE vGPUMemoryPercentage gauge</span><br>vGPUMemoryPercentage&#123;containeridx=&quot;0&quot;,deviceuuid=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,nodename=&quot;172.20.0.21&quot;,podname=&quot;gpu-test5-01&quot;,podnamespace=&quot;default&quot;,zone=&quot;vGPU&quot;&#125; 0.06512112529304506<br>vGPUMemoryPercentage&#123;containeridx=&quot;0&quot;,deviceuuid=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,nodename=&quot;172.20.0.21&quot;,podname=&quot;gpu-test5-01&quot;,podnamespace=&quot;default&quot;,zone=&quot;vGPU&quot;&#125; 0.06512112529304506<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP vGPUPodsDeviceAllocated vGPU Allocated from pods</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE vGPUPodsDeviceAllocated gauge</span><br>vGPUPodsDeviceAllocated&#123;containeridx=&quot;0&quot;,deviceusedcore=&quot;0&quot;,deviceuuid=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,nodename=&quot;172.20.0.21&quot;,podname=&quot;gpu-test5-01&quot;,podnamespace=&quot;default&quot;,zone=&quot;vGPU&quot;&#125; 3.145728e+09<br>vGPUPodsDeviceAllocated&#123;containeridx=&quot;0&quot;,deviceusedcore=&quot;0&quot;,deviceuuid=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,nodename=&quot;172.20.0.21&quot;,podname=&quot;gpu-test5-01&quot;,podnamespace=&quot;default&quot;,zone=&quot;vGPU&quot;&#125; 3.145728e+09<br></code></pre></td></tr></table></figure><h3 id="1-2-3-å¯¹åº”çš„smon"><a href="#1-2-3-å¯¹åº”çš„smon" class="headerlink" title="1.2.3 å¯¹åº”çš„smon"></a>1.2.3 å¯¹åº”çš„smon</h3><p>æ­¤servicemonitorç”±è‡ªå·±è¿›è¡Œå°è£…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:/opt/installPkgs/k8s-vgpu-basedon-HAMi/deploy-prometheus# ll hami-scheduler-svc-monitor.yaml  <br>root@controller01:/opt/installPkgs/k8s-vgpu-basedon-HAMi/deploy-prometheus# cat hami-scheduler-svc-monitor.yaml <br>apiVersion: monitoring.coreos.com/v1<br>kind: ServiceMonitor<br>metadata:<br>  name: hami-scheduler-svc-monitor<br>  namespace: kube-system<br>spec:<br>  selector:<br>    matchLabels:<br>      app.kubernetes.io/component: hami-scheduler<br>  namespaceSelector:<br>    matchNames:<br>      - &quot;kube-system&quot;<br>  endpoints:<br>  - path: /metrics<br>    port: monitor<br>    interval: &quot;15s&quot;<br>    honorLabels: false<br>    relabelings:<br>    - sourceLabels: [__meta_kubernetes_endpoints_name]<br>      regex: hami-.*<br>      replacement: $1<br>      action: keep<br>    - sourceLabels: [__meta_kubernetes_pod_node_name]<br>      regex: (.*)<br>      targetLabel: node_name<br>      replacement: $&#123;1&#125;<br>      action: replace<br>    - sourceLabels: [__meta_kubernetes_pod_host_ip]<br>      regex: (.*)<br>      targetLabel: ip<br>      replacement: $1<br>      action: replace<br><br><br><br>root@controller01:/opt/installPkgs/k8s-vgpu-basedon-HAMi/deploy-prometheus# kubectl -n kube-system get smon hami-scheduler-svc-monitor -o yaml<br><br>apiVersion: monitoring.coreos.com/v1<br>kind: ServiceMonitor<br>metadata:<br>  annotations:<br>    kubectl.kubernetes.io/last-applied-configuration: |<br>      &#123;&quot;apiVersion&quot;:&quot;monitoring.coreos.com/v1&quot;,&quot;kind&quot;:&quot;ServiceMonitor&quot;,&quot;metadata&quot;:&#123;&quot;annotations&quot;:&#123;&#125;,&quot;name&quot;:&quot;hami-scheduler-svc-monitor&quot;,&quot;namespace&quot;:&quot;kube-system&quot;&#125;,&quot;spec&quot;:&#123;&quot;endpoints&quot;:[&#123;&quot;honorLabels&quot;:false,&quot;interval&quot;:&quot;15s&quot;,&quot;path&quot;:&quot;/metrics&quot;,&quot;port&quot;:&quot;monitor&quot;,&quot;relabelings&quot;:[&#123;&quot;action&quot;:&quot;keep&quot;,&quot;regex&quot;:&quot;hami-.*&quot;,&quot;replacement&quot;:&quot;$1&quot;,&quot;sourceLabels&quot;:[&quot;__meta_kubernetes_endpoints_name&quot;]&#125;,&#123;&quot;action&quot;:&quot;replace&quot;,&quot;regex&quot;:&quot;(.*)&quot;,&quot;replacement&quot;:&quot;$&#123;1&#125;&quot;,&quot;sourceLabels&quot;:[&quot;__meta_kubernetes_pod_node_name&quot;],&quot;targetLabel&quot;:&quot;node_name&quot;&#125;,&#123;&quot;action&quot;:&quot;replace&quot;,&quot;regex&quot;:&quot;(.*)&quot;,&quot;replacement&quot;:&quot;$1&quot;,&quot;sourceLabels&quot;:[&quot;__meta_kubernetes_pod_host_ip&quot;],&quot;targetLabel&quot;:&quot;ip&quot;&#125;]&#125;],&quot;namespaceSelector&quot;:&#123;&quot;matchNames&quot;:[&quot;kube-system&quot;]&#125;,&quot;selector&quot;:&#123;&quot;matchLabels&quot;:&#123;&quot;app.kubernetes.io/component&quot;:&quot;hami-scheduler&quot;&#125;&#125;&#125;&#125;<br>  creationTimestamp: &quot;2025-01-14T06:42:15Z&quot;<br>  generation: 1<br>  name: hami-scheduler-svc-monitor<br>  namespace: kube-system<br>  resourceVersion: &quot;764901&quot;<br>  uid: ba0dc589-4ebe-4fb8-aa11-978f5288adbd<br>spec:<br>  endpoints:<br>  - honorLabels: false<br>    interval: 15s<br>    path: /metrics<br>    port: monitor<br>    relabelings:<br>    - action: keep<br>      regex: hami-.*<br>      replacement: $1<br>      sourceLabels:<br>      - __meta_kubernetes_endpoints_name<br>    - action: replace<br>      regex: (.*)<br>      replacement: $&#123;1&#125;<br>      sourceLabels:<br>      - __meta_kubernetes_pod_node_name<br>      targetLabel: node_name<br>    - action: replace<br>      regex: (.*)<br>      replacement: $1<br>      sourceLabels:<br>      - __meta_kubernetes_pod_host_ip<br>      targetLabel: ip<br>  namespaceSelector:<br>    matchNames:<br>    - kube-system<br>  selector:<br>    matchLabels:<br>      app.kubernetes.io/component: hami-scheduler<br></code></pre></td></tr></table></figure><h2 id="1-3-å‘ç°é—®é¢˜"><a href="#1-3-å‘ç°é—®é¢˜" class="headerlink" title="1.3 å‘ç°é—®é¢˜"></a>1.3 å‘ç°é—®é¢˜</h2><ul><li><p>è¿›å…¥podå†…å®¹å™¨ä¸­æ‰§è¡Œ<code>nvidia-smi</code>å‘½ä»¤è¾“å‡ºæ­£å¸¸ï¼Œå³å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªâ€œNVIDIA GPUâ€ï¼Œæ˜¾å­˜æ˜¯3000M</p></li><li><p>æŸ¥çœ‹podæ—¥å¿—æ­£å¸¸</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:/opt/installPkgs/k8s-vgpu-basedon-HAMi/deploy-prometheus# kubectl logs gpu-test5-01 | more<br>[HAMI-core Msg(1:139687502968448:libvgpu.c:836)]: Initializing.....<br>2025-01-15 07:46:41.274 | INFO     | __main__:&lt;module&gt;:97 - Namespace(batch_size=32, epochs=10, lr=0.01, save_dir=&#x27;./output&#x27;, train_data_dir=&#x27;./data/cifar10/train&#x27;, val_data_dir=&#x27;./data/cifar10/val&#x27;, weights=None)<br>[HAMI-core Msg(1:139687502968448:libvgpu.c:855)]: Initialized<br>2025-01-15 07:46:41.588 | INFO     | __main__:main:21 - Using device: cuda<br>2025-01-15 07:46:41.995 | INFO     | __main__:main:50 - Epoch: 1/10<br>2025-01-15 07:46:41.996 | INFO     | __main__:main:52 - Training<br>[HAMI-core Msg(1:139687502968448:memory.c:511)]: orig free=47283240960 total=47608692736 limit=3145728000 usage=310526720<br>...<br>2025-01-15 07:46:42.572 | INFO     | __main__:main:60 - Step: 1 Loss: 2.253140<br>[HAMI-core Msg(1:139682238363392:memory.c:511)]: orig free=47088205824 total=47608692736 limit=3145728000 usage=451448320<br>...<br>2025-01-15 07:46:42.920 | INFO     | __main__:main:60 - Step: 2 Loss: 2.400440<br>2025-01-15 07:46:42.944 | INFO     | __main__:main:60 - Step: 3 Loss: 2.344008<br>2025-01-15 07:46:42.964 | INFO     | __main__:main:60 - Step: 4 Loss: 2.309544<br>...<br>2025-01-15 07:52:53.087 | INFO     | __main__:main:60 - Step: 1561 Loss: 0.496849<br>2025-01-15 07:52:53.107 | INFO     | __main__:main:60 - Step: 1562 Loss: 0.342890<br>2025-01-15 07:52:53.128 | INFO     | __main__:main:60 - Step: 1563 Loss: 0.425614<br>2025-01-15 07:52:53.178 | INFO     | __main__:main:64 - Evaluating<br>2025-01-15 07:52:56.328 | INFO     | __main__:main:74 - Accuracy: 7591/10000<br>2025-01-15 07:52:56.328 | INFO     | __main__:main:79 - Saving model weights to ./output/epoch10.pth<br>2025-01-15 07:52:56.430 | INFO     | __main__:main:84 - Done<br>[HAMI-core Msg(1:139687502968448:multiprocess_memory_limit.c:497)]: Calling exit handler 1<br></code></pre></td></tr></table></figure><ul><li>Device_memory_desc_of_container ç›‘æ§æ•°æ®æ­£å¸¸</li><li><em><strong>Device_utilization_desc_of_container</strong> <strong>ç›‘æ§æ•°æ®ä¸æ­£å¸¸ï¼Œä¸€ç›´ä¸º0</strong></em></li></ul><p><img src="https://s2.loli.net/2025/01/15/tmAqdpMjJu1IwCh.png" alt="image-20250115155308205"></p><h1 id="äºŒã€å…³äºns-monitoringä¸‹svcçš„åˆ†æ"><a href="#äºŒã€å…³äºns-monitoringä¸‹svcçš„åˆ†æ" class="headerlink" title="äºŒã€å…³äºns&#x2F;monitoringä¸‹svcçš„åˆ†æ"></a>äºŒã€å…³äºns&#x2F;monitoringä¸‹svcçš„åˆ†æ</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:~# kubectl -n monitoring get svc<br>NAME                    TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                         AGE<br>alertmanager-main       NodePort    10.68.143.71    &lt;none&gt;        9093:30854/TCP,8080:30320/TCP   5d<br>alertmanager-operated   ClusterIP   None            &lt;none&gt;        9093/TCP,9094/TCP,9094/UDP      5d<br>blackbox-exporter       ClusterIP   10.68.0.167     &lt;none&gt;        9115/TCP,19115/TCP              5d<br>dcgm-exporter           ClusterIP   10.68.32.112    &lt;none&gt;        9400/TCP                        25h<br>grafana                 NodePort    10.68.79.63     &lt;none&gt;        3000:30300/TCP                  5d<br>kube-state-metrics      ClusterIP   None            &lt;none&gt;        8443/TCP,9443/TCP               5d<br>node-exporter           ClusterIP   None            &lt;none&gt;        9100/TCP                        5d<br>prometheus-adapter      ClusterIP   10.68.33.74     &lt;none&gt;        443/TCP                         5d<br>prometheus-k8s          NodePort    10.68.168.213   &lt;none&gt;        9090:31819/TCP,8080:31903/TCP   5d<br>prometheus-operated     ClusterIP   None            &lt;none&gt;        9090/TCP                        5d<br>prometheus-operator     ClusterIP   None            &lt;none&gt;        8443/TCP                        5d<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç€é‡æŸ¥çœ‹svc/dcgm-exporter</span> <br></code></pre></td></tr></table></figure><h2 id="2-1-svc-dcgm-exporter-æœ¬èº«"><a href="#2-1-svc-dcgm-exporter-æœ¬èº«" class="headerlink" title="2.1 svc&#x2F;dcgm-exporter æœ¬èº«"></a>2.1 svc&#x2F;dcgm-exporter æœ¬èº«</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:~# kubectl -n monitoring get svc dcgm-exporter -o yaml<br>apiVersion: v1<br>kind: Service<br>metadata:<br>  annotations:<br>    meta.helm.sh/release-name: dcgm-exporter<br>    meta.helm.sh/release-namespace: monitoring<br>  creationTimestamp: &quot;2025-01-14T06:37:49Z&quot;<br>  labels:<br>    app.kubernetes.io/component: dcgm-exporter<br>    app.kubernetes.io/instance: dcgm-exporter<br>    app.kubernetes.io/managed-by: Helm<br>    app.kubernetes.io/name: dcgm-exporter<br>    app.kubernetes.io/version: 3.1.7<br>    helm.sh/chart: dcgm-exporter-3.1.7<br>  name: dcgm-exporter<br>  namespace: monitoring<br>  resourceVersion: &quot;764255&quot;<br>  uid: ebe9c178-4252-43af-9ef5-01682bb7aceb<br>spec:<br>  clusterIP: 10.68.32.112<br>  clusterIPs:<br>  - 10.68.32.112<br>  internalTrafficPolicy: Cluster<br>  ipFamilies:<br>  - IPv4<br>  ipFamilyPolicy: SingleStack<br>  ports:<br>  - name: metrics<br>    port: 9400<br>    protocol: TCP<br>    targetPort: 9400<br>  selector:<br>    app.kubernetes.io/instance: dcgm-exporter<br>    app.kubernetes.io/name: dcgm-exporter<br>  sessionAffinity: None<br>  type: ClusterIP<br>status:<br>  loadBalancer: &#123;&#125;<br></code></pre></td></tr></table></figure><h2 id="2-2-svc-dcgm-exporter-ç›‘æ§"><a href="#2-2-svc-dcgm-exporter-ç›‘æ§" class="headerlink" title="2.2 svc&#x2F;dcgm-exporter ç›‘æ§"></a>2.2 svc&#x2F;dcgm-exporter ç›‘æ§</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°svc/dcgm-exporter çš„ç±»å‹æ˜¯ClusterIPï¼Œå®ƒçš„å·¥ä½œç«¯å£æ˜¯9400</span><br>root@controller01:/opt/installPkgs/k8s-vgpu-basedon-HAMi# curl 10.68.32.112:9400/metrics<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP DCGM_FI_DEV_SM_CLOCK SM clock frequency (<span class="hljs-keyword">in</span> MHz).</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE DCGM_FI_DEV_SM_CLOCK gauge</span><br>DCGM_FI_DEV_SM_CLOCK&#123;gpu=&quot;0&quot;,UUID=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,device=&quot;nvidia0&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 1740<br>DCGM_FI_DEV_SM_CLOCK&#123;gpu=&quot;1&quot;,UUID=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,device=&quot;nvidia1&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 210<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP DCGM_FI_DEV_MEM_CLOCK Memory clock frequency (<span class="hljs-keyword">in</span> MHz).</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE DCGM_FI_DEV_MEM_CLOCK gauge</span><br>DCGM_FI_DEV_MEM_CLOCK&#123;gpu=&quot;0&quot;,UUID=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,device=&quot;nvidia0&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 7250<br>DCGM_FI_DEV_MEM_CLOCK&#123;gpu=&quot;1&quot;,UUID=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,device=&quot;nvidia1&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 405<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP DCGM_FI_DEV_GPU_TEMP GPU temperature (<span class="hljs-keyword">in</span> C).</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE DCGM_FI_DEV_GPU_TEMP gauge</span><br>DCGM_FI_DEV_GPU_TEMP&#123;gpu=&quot;0&quot;,UUID=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,device=&quot;nvidia0&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 66<br>DCGM_FI_DEV_GPU_TEMP&#123;gpu=&quot;1&quot;,UUID=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,device=&quot;nvidia1&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 37<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP DCGM_FI_DEV_POWER_USAGE Power draw (<span class="hljs-keyword">in</span> W).</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE DCGM_FI_DEV_POWER_USAGE gauge</span><br>DCGM_FI_DEV_POWER_USAGE&#123;gpu=&quot;0&quot;,UUID=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,device=&quot;nvidia0&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 124.967000<br>DCGM_FI_DEV_POWER_USAGE&#123;gpu=&quot;1&quot;,UUID=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,device=&quot;nvidia1&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 30.280000<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP DCGM_FI_DEV_TOTAL_ENERGY_CONSUMPTION Total energy consumption since boot (<span class="hljs-keyword">in</span> mJ).</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE DCGM_FI_DEV_TOTAL_ENERGY_CONSUMPTION counter</span><br>DCGM_FI_DEV_TOTAL_ENERGY_CONSUMPTION&#123;gpu=&quot;0&quot;,UUID=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,device=&quot;nvidia0&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 7187773583<br>DCGM_FI_DEV_TOTAL_ENERGY_CONSUMPTION&#123;gpu=&quot;1&quot;,UUID=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,device=&quot;nvidia1&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 7015882815<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP DCGM_FI_DEV_PCIE_REPLAY_COUNTER Total number of PCIe retries.</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE DCGM_FI_DEV_PCIE_REPLAY_COUNTER counter</span><br>DCGM_FI_DEV_PCIE_REPLAY_COUNTER&#123;gpu=&quot;0&quot;,UUID=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,device=&quot;nvidia0&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 0<br>DCGM_FI_DEV_PCIE_REPLAY_COUNTER&#123;gpu=&quot;1&quot;,UUID=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,device=&quot;nvidia1&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP DCGM_FI_DEV_GPU_UTIL GPU utilization (<span class="hljs-keyword">in</span> %).</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE DCGM_FI_DEV_GPU_UTIL gauge</span><br>DCGM_FI_DEV_GPU_UTIL&#123;gpu=&quot;0&quot;,UUID=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,device=&quot;nvidia0&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 16<br>DCGM_FI_DEV_GPU_UTIL&#123;gpu=&quot;1&quot;,UUID=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,device=&quot;nvidia1&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP DCGM_FI_DEV_MEM_COPY_UTIL Memory utilization (<span class="hljs-keyword">in</span> %).</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE DCGM_FI_DEV_MEM_COPY_UTIL gauge</span><br>DCGM_FI_DEV_MEM_COPY_UTIL&#123;gpu=&quot;0&quot;,UUID=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,device=&quot;nvidia0&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 8<br>DCGM_FI_DEV_MEM_COPY_UTIL&#123;gpu=&quot;1&quot;,UUID=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,device=&quot;nvidia1&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP DCGM_FI_DEV_ENC_UTIL Encoder utilization (<span class="hljs-keyword">in</span> %).</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE DCGM_FI_DEV_ENC_UTIL gauge</span><br>DCGM_FI_DEV_ENC_UTIL&#123;gpu=&quot;0&quot;,UUID=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,device=&quot;nvidia0&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 0<br>DCGM_FI_DEV_ENC_UTIL&#123;gpu=&quot;1&quot;,UUID=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,device=&quot;nvidia1&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP DCGM_FI_DEV_DEC_UTIL Decoder utilization (<span class="hljs-keyword">in</span> %).</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE DCGM_FI_DEV_DEC_UTIL gauge</span><br>DCGM_FI_DEV_DEC_UTIL&#123;gpu=&quot;0&quot;,UUID=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,device=&quot;nvidia0&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 0<br>DCGM_FI_DEV_DEC_UTIL&#123;gpu=&quot;1&quot;,UUID=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,device=&quot;nvidia1&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP DCGM_FI_DEV_XID_ERRORS Value of the last XID error encountered.</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE DCGM_FI_DEV_XID_ERRORS gauge</span><br>DCGM_FI_DEV_XID_ERRORS&#123;gpu=&quot;0&quot;,UUID=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,device=&quot;nvidia0&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 0<br>DCGM_FI_DEV_XID_ERRORS&#123;gpu=&quot;1&quot;,UUID=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,device=&quot;nvidia1&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP DCGM_FI_DEV_FB_FREE Framebuffer memory free (<span class="hljs-keyword">in</span> MiB).</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE DCGM_FI_DEV_FB_FREE gauge</span><br>DCGM_FI_DEV_FB_FREE&#123;gpu=&quot;0&quot;,UUID=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,device=&quot;nvidia0&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 44718<br>DCGM_FI_DEV_FB_FREE&#123;gpu=&quot;1&quot;,UUID=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,device=&quot;nvidia1&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 45400<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP DCGM_FI_DEV_FB_USED Framebuffer memory used (<span class="hljs-keyword">in</span> MiB).</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE DCGM_FI_DEV_FB_USED gauge</span><br>DCGM_FI_DEV_FB_USED&#123;gpu=&quot;0&quot;,UUID=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,device=&quot;nvidia0&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 684<br>DCGM_FI_DEV_FB_USED&#123;gpu=&quot;1&quot;,UUID=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,device=&quot;nvidia1&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 3<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP DCGM_FI_DEV_NVLINK_BANDWIDTH_TOTAL Total number of NVLink bandwidth counters <span class="hljs-keyword">for</span> all lanes.</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE DCGM_FI_DEV_NVLINK_BANDWIDTH_TOTAL counter</span><br>DCGM_FI_DEV_NVLINK_BANDWIDTH_TOTAL&#123;gpu=&quot;0&quot;,UUID=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,device=&quot;nvidia0&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 0<br>DCGM_FI_DEV_NVLINK_BANDWIDTH_TOTAL&#123;gpu=&quot;1&quot;,UUID=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,device=&quot;nvidia1&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP DCGM_FI_DEV_VGPU_LICENSE_STATUS vGPU License status</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE DCGM_FI_DEV_VGPU_LICENSE_STATUS gauge</span><br>DCGM_FI_DEV_VGPU_LICENSE_STATUS&#123;gpu=&quot;0&quot;,UUID=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,device=&quot;nvidia0&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 0<br>DCGM_FI_DEV_VGPU_LICENSE_STATUS&#123;gpu=&quot;1&quot;,UUID=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,device=&quot;nvidia1&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP DCGM_FI_DEV_UNCORRECTABLE_REMAPPED_ROWS Number of remapped rows <span class="hljs-keyword">for</span> uncorrectable errors</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE DCGM_FI_DEV_UNCORRECTABLE_REMAPPED_ROWS counter</span><br>DCGM_FI_DEV_UNCORRECTABLE_REMAPPED_ROWS&#123;gpu=&quot;0&quot;,UUID=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,device=&quot;nvidia0&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 0<br>DCGM_FI_DEV_UNCORRECTABLE_REMAPPED_ROWS&#123;gpu=&quot;1&quot;,UUID=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,device=&quot;nvidia1&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP DCGM_FI_DEV_CORRECTABLE_REMAPPED_ROWS Number of remapped rows <span class="hljs-keyword">for</span> correctable errors</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE DCGM_FI_DEV_CORRECTABLE_REMAPPED_ROWS counter</span><br>DCGM_FI_DEV_CORRECTABLE_REMAPPED_ROWS&#123;gpu=&quot;0&quot;,UUID=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,device=&quot;nvidia0&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 0<br>DCGM_FI_DEV_CORRECTABLE_REMAPPED_ROWS&#123;gpu=&quot;1&quot;,UUID=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,device=&quot;nvidia1&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP DCGM_FI_DEV_ROW_REMAP_FAILURE Whether remapping of rows has failed</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE DCGM_FI_DEV_ROW_REMAP_FAILURE gauge</span><br>DCGM_FI_DEV_ROW_REMAP_FAILURE&#123;gpu=&quot;0&quot;,UUID=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,device=&quot;nvidia0&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 0<br>DCGM_FI_DEV_ROW_REMAP_FAILURE&#123;gpu=&quot;1&quot;,UUID=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,device=&quot;nvidia1&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP DCGM_FI_PROF_GR_ENGINE_ACTIVE Ratio of <span class="hljs-keyword">time</span> the graphics engine is active (<span class="hljs-keyword">in</span> %).</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE DCGM_FI_PROF_GR_ENGINE_ACTIVE gauge</span><br>DCGM_FI_PROF_GR_ENGINE_ACTIVE&#123;gpu=&quot;0&quot;,UUID=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,device=&quot;nvidia0&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 0.160959<br>DCGM_FI_PROF_GR_ENGINE_ACTIVE&#123;gpu=&quot;1&quot;,UUID=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,device=&quot;nvidia1&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 0.000000<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP DCGM_FI_PROF_PIPE_TENSOR_ACTIVE Ratio of cycles the tensor (HMMA) pipe is active (<span class="hljs-keyword">in</span> %).</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE DCGM_FI_PROF_PIPE_TENSOR_ACTIVE gauge</span><br>DCGM_FI_PROF_PIPE_TENSOR_ACTIVE&#123;gpu=&quot;0&quot;,UUID=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,device=&quot;nvidia0&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 0.010100<br>DCGM_FI_PROF_PIPE_TENSOR_ACTIVE&#123;gpu=&quot;1&quot;,UUID=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,device=&quot;nvidia1&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 0.000000<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP DCGM_FI_PROF_DRAM_ACTIVE Ratio of cycles the device memory interface is active sending or receiving data (<span class="hljs-keyword">in</span> %).</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE DCGM_FI_PROF_DRAM_ACTIVE gauge</span><br>DCGM_FI_PROF_DRAM_ACTIVE&#123;gpu=&quot;0&quot;,UUID=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,device=&quot;nvidia0&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 0.061415<br>DCGM_FI_PROF_DRAM_ACTIVE&#123;gpu=&quot;1&quot;,UUID=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,device=&quot;nvidia1&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 0.000325<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP DCGM_FI_PROF_PCIE_TX_BYTES The rate of data transmitted over the PCIe bus - including both protocol headers and data payloads - <span class="hljs-keyword">in</span> bytes per second.</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE DCGM_FI_PROF_PCIE_TX_BYTES gauge</span><br>DCGM_FI_PROF_PCIE_TX_BYTES&#123;gpu=&quot;0&quot;,UUID=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,device=&quot;nvidia0&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 6811221<br>DCGM_FI_PROF_PCIE_TX_BYTES&#123;gpu=&quot;1&quot;,UUID=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,device=&quot;nvidia1&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 1837182<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP DCGM_FI_PROF_PCIE_RX_BYTES The rate of data received over the PCIe bus - including both protocol headers and data payloads - <span class="hljs-keyword">in</span> bytes per second.</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE DCGM_FI_PROF_PCIE_RX_BYTES gauge</span><br>DCGM_FI_PROF_PCIE_RX_BYTES&#123;gpu=&quot;0&quot;,UUID=&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;,device=&quot;nvidia0&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 40172789<br>DCGM_FI_PROF_PCIE_RX_BYTES&#123;gpu=&quot;1&quot;,UUID=&quot;GPU-c10058bc-1eae-1b32-ba0d-85d26c9ed9ff&quot;,device=&quot;nvidia1&quot;,modelName=&quot;NVIDIA A40&quot;,Hostname=&quot;172.20.0.21&quot;,DCGM_FI_DRIVER_VERSION=&quot;550.54.15&quot;,container=&quot;&quot;,namespace=&quot;&quot;,pod=&quot;&quot;&#125; 1166047<br>root@controller01:/opt/installPkgs/k8s-vgpu-basedon-HAMi# <br></code></pre></td></tr></table></figure><h2 id="2-3-å¯¹åº”çš„smon-dcgm-exporter"><a href="#2-3-å¯¹åº”çš„smon-dcgm-exporter" class="headerlink" title="2.3 å¯¹åº”çš„smon&#x2F;dcgm-exporter"></a>2.3 å¯¹åº”çš„smon&#x2F;dcgm-exporter</h2><p>æ­¤smonæ˜¯åœ¨éƒ¨ç½²dcgmç»„ä»¶æ—¶ï¼Œç”±å…¶è‡ªåŠ¨åˆ›å»ºçš„ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:/opt/installPkgs/k8s-vgpu-basedon-HAMi# kubectl -n monitoring get smon<br>NAME                      AGE<br>...<br>dcgm-exporter             26h<br>...<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹smon/dcgm-exporter æœ¬èº«çš„å†…å®¹</span><br>root@controller01:/opt/installPkgs/k8s-vgpu-basedon-HAMi# kubectl -n monitoring get smon dcgm-exporter -o yaml<br>apiVersion: monitoring.coreos.com/v1<br>kind: ServiceMonitor<br>metadata:<br>  annotations:<br>    meta.helm.sh/release-name: dcgm-exporter<br>    meta.helm.sh/release-namespace: monitoring<br>  creationTimestamp: &quot;2025-01-14T06:37:49Z&quot;<br>  generation: 1<br>  labels:<br>    app.kubernetes.io/component: dcgm-exporter<br>    app.kubernetes.io/instance: dcgm-exporter<br>    app.kubernetes.io/managed-by: Helm<br>    app.kubernetes.io/name: dcgm-exporter<br>    app.kubernetes.io/version: 3.1.7<br>    helm.sh/chart: dcgm-exporter-3.1.7<br>  name: dcgm-exporter<br>  namespace: monitoring<br>  resourceVersion: &quot;764260&quot;<br>  uid: cb9c11ee-6702-48b6-9780-52b15c3e78a9<br>spec:<br>  endpoints:<br>  - honorLabels: false<br>    interval: 15s<br>    path: /metrics<br>    port: metrics<br>    relabelings:<br>    - action: keep<br>      regex: dcgm-exporter<br>      replacement: $1<br>      sourceLabels:<br>      - __meta_kubernetes_endpoints_name<br>    - action: replace<br>      regex: (.*)<br>      replacement: $&#123;1&#125;<br>      sourceLabels:<br>      - __meta_kubernetes_pod_node_name<br>      targetLabel: node_name<br>    - action: replace<br>      regex: (.*)<br>      replacement: $1<br>      sourceLabels:<br>      - __meta_kubernetes_pod_host_ip<br>      targetLabel: ip<br>  namespaceSelector:<br>    matchNames:<br>    - monitoring<br>  selector:<br>    matchLabels:<br>      app.kubernetes.io/component: dcgm-exporter<br>      app.kubernetes.io/instance: dcgm-exporter<br>      app.kubernetes.io/name: dcgm-exporter<br></code></pre></td></tr></table></figure><h2 id="2-4-é—®é¢˜å¤„ç†"><a href="#2-4-é—®é¢˜å¤„ç†" class="headerlink" title="2.4 é—®é¢˜å¤„ç†"></a>2.4 é—®é¢˜å¤„ç†</h2><h3 id="2-4-1-Device-utilization-desc-of-container-ç›‘æ§æ•°æ®ä¸æ­£å¸¸ï¼Œä¸€ç›´ä¸º0"><a href="#2-4-1-Device-utilization-desc-of-container-ç›‘æ§æ•°æ®ä¸æ­£å¸¸ï¼Œä¸€ç›´ä¸º0" class="headerlink" title="2.4.1 Device_utilization_desc_of_container ç›‘æ§æ•°æ®ä¸æ­£å¸¸ï¼Œä¸€ç›´ä¸º0"></a>2.4.1 Device_utilization_desc_of_container ç›‘æ§æ•°æ®ä¸æ­£å¸¸ï¼Œä¸€ç›´ä¸º0</h3><p><img src="https://s2.loli.net/2025/01/23/TNprH1JUtcSihWB.png" alt="image-20250123105319763"></p><p>å¤„ç†åŠæ³•ï¼š</p><p>å…ˆå‰æ²¡æœ‰åœ¨ä»»åŠ¡ä¸­åŠ â€œnvidia.com&#x2F;gpucores: xxxâ€ å‘ç°Device_utilization_desc_of_containerä¸€ç›´ä¸º0ã€‚ä¸éœ€è¦æ˜¾å¼åŠ  hostPidï¼Œå£°æ˜äº†â€œnvidia.com&#x2F;gpucores: xxxâ€Device_utilization_desc_of_container å°±æœ‰ç›‘æ§æ•°æ®äº† </p><p>ç›¸å…³æºç ï¼š<a href="https://github.com/Project-HAMi/HAMi-core/blob/88dd82117e057b88d5c3c19a546002838242a64f/src/multiprocess/multiprocess_utilization_watcher.c#L223">https://github.com/Project-HAMi/HAMi-core/blob/88dd82117e057b88d5c3c19a546002838242a64f/src/multiprocess/multiprocess_utilization_watcher.c#L223</a></p><p>hami-coreé‡Œé¢åªæœ‰åœ¨ sm_limit å¤§äº 0 å°äºç­‰äº 100 æ—¶æ‰å¯åŠ¨ç›‘æ§çº¿ç¨‹ï¼Œç„¶å <a href="https://github.com/Project-HAMi/HAMi/blob/4b1cda2ea77107826e0d6836f7b2f2dd1dbfb3b7/charts/hami/templates/scheduler/device-configmap.yaml#L21">https://github.com/Project-HAMi/HAMi/blob/4b1cda2ea77107826e0d6836f7b2f2dd1dbfb3b7/charts/hami/templates/scheduler/device-configmap.yaml#L21</a> è¿™ä¸ª nvidia.defaultCores: 0 ä¸å†™ nvidia.com&#x2F;gpucores å°±æ˜¯ é»˜è®¤ 0ï¼Œæ˜¯éœ€è¦æ˜¾ç¤ºå£°æ˜ç®—åŠ›é™åˆ¶æ‰ä¼šæœ‰å¯¹åº”çš„ç›‘æ§</p>]]></content>
    
    
    
    <tags>
      
      <tag>HAMi2.4.1 k8s servicemonitor</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HAMiå®‰è£…éƒ¨ç½²æ—¶æŠ¥é”™å¤„ç†å½’çº³</title>
    <link href="/2025/01/13/HAMi%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E6%97%B6%E6%8A%A5%E9%94%99%E5%A4%84%E7%90%86%E5%BD%92%E7%BA%B3/"/>
    <url>/2025/01/13/HAMi%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E6%97%B6%E6%8A%A5%E9%94%99%E5%A4%84%E7%90%86%E5%BD%92%E7%BA%B3/</url>
    
    <content type="html"><![CDATA[<h1 id="1-pod-hami-device-pluginä¸€ç›´å¤„äºCrashLoopBackOff"><a href="#1-pod-hami-device-pluginä¸€ç›´å¤„äºCrashLoopBackOff" class="headerlink" title="1. pod&#x2F;hami-device-pluginä¸€ç›´å¤„äºCrashLoopBackOff"></a>1. pod&#x2F;hami-device-pluginä¸€ç›´å¤„äºCrashLoopBackOff</h1><p>å…·ä½“æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:~# kubectl -n kube-system get pods<br>NAME                                         READY   STATUS             RESTARTS      AGE<br>calico-kube-controllers-754966f84c-7nm8r     1/1     Running            3 (17h ago)   3d19h<br>calico-node-84csz                            1/1     Running            3 (17h ago)   3d19h<br>coredns-596755dbff-94m7w                     1/1     Running            4 (17h ago)   3d19h<br>dashboard-metrics-scraper-799d786dbf-swl8b   1/1     Running            4 (17h ago)   3d19h<br>hami-device-plugin-n9s94                     1/2     CrashLoopBackOff   4 (88s ago)   2m57s<br>hami-scheduler-cdcc75c6f-s2hp5               2/2     Running            0             2m57s<br>kubernetes-dashboard-9f8c8b989-f4cqj         1/1     Running            4 (17h ago)   3d19h<br>metrics-server-5d648558d9-49q98              1/1     Running            5 (17h ago)   3d19h<br>nfs-client-provisioner-6994b84bd-2w7vr       1/1     Running            4 (17h ago)   3d19h<br>node-local-dns-2mqv2                         1/1     Running            5 (17h ago)   3d19h<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹pod/hami-device-plugin-n9s94 æ—¥å¿—</span><br>root@controller01:~# kubectl -n kube-system describe pod hami-device-plugin-n9s94<br>...<br>Events:<br>  Type     Reason               Age                From               Message<br>  ----     ------               ----               ----               -------<br>  Normal   Scheduled            60s                default-scheduler  Successfully assigned kube-system/hami-device-plugin-n9s94 to 172.20.0.21<br>  Normal   Pulled               58s                kubelet            Container image &quot;projecthami/hami:latest&quot; already present on machine<br>  Normal   Created              58s                kubelet            Created container vgpu-monitor<br>  Normal   Started              58s                kubelet            Started container vgpu-monitor<br>  Warning  FailedPostStartHook  42s (x3 over 59s)  kubelet            Exec lifecycle hook ([/bin/sh -c cp -f /k8s-vgpu/lib/nvidia/* /usr/local/vgpu/]) for Container &quot;device-plugin&quot; in Pod &quot;hami-device-plugin-n9s94_kube-system(70f823fa-d042-400d-abd1-0527921e60a6)&quot; failed - error: command &#x27;/bin/sh -c cp -f /k8s-vgpu/lib/nvidia/* /usr/local/vgpu/&#x27; exited with 126: , message: &quot;OCI runtime exec failed: exec failed: cannot exec in a stopped container: unknown\r\n&quot;<br>  Normal   Killing              42s (x3 over 59s)  kubelet            FailedPostStartHook<br>  Warning  BackOff              26s (x4 over 56s)  kubelet            Back-off restarting failed container<br>  Normal   Pulled               14s (x4 over 59s)  kubelet            Container image &quot;projecthami/hami:latest&quot; already present on machine<br>  Normal   Created              14s (x4 over 59s)  kubelet            Created container device-plugin<br>  Normal   Started              13s (x4 over 59s)  kubelet            Started container device-plugin<br></code></pre></td></tr></table></figure><p><strong>åˆ†æå®šä½ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:~# ll /usr/local/vgpu/<br>total 636<br>drwxr-xr-x  3 root root   4096 Aug 28 15:37 ./<br>drwxr-xr-x 17 root root   4096 Nov 15 16:56 ../<br>drwxr-xr-x  5 root root   4096 Jan  8 15:27 containers/<br>-rw-r--r--  1 root root     26 Jan  8 17:20 ld.so.preload<br>-rwxr-xr-x  1 root root 631456 Jan  8 17:20 libvgpu.so*<br>root@controller01:~# <br>root@controller01:~# cd /usr/local/vgpu/<br>root@controller01:/usr/local/vgpu# ll<br>total 636<br>drwxr-xr-x  3 root root   4096 Aug 28 15:37 ./<br>drwxr-xr-x 17 root root   4096 Nov 15 16:56 ../<br>drwxr-xr-x  5 root root   4096 Jan  8 15:27 containers/<br>-rw-r--r--  1 root root     26 Jan  8 17:20 ld.so.preload<br>-rwxr-xr-x  1 root root 631456 Jan  8 17:20 libvgpu.so*<br>root@controller01:/usr/local/vgpu# cd containers/<br>root@controller01:/usr/local/vgpu/containers# ll<br>total 20<br>drwxr-xr-x 5 root root 4096 Jan  8 15:27 ./<br>drwxr-xr-x 3 root root 4096 Aug 28 15:37 ../<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:~# kubectl -n kube-system logs hami-device-plugin-n9s94 -c device-plugin<br>I0114 02:25:43.181802   36787 client.go:53] BuildConfigFromFlags failed for file /root/.kube/config: stat /root/.kube/config: no such file or directory using inClusterConfig<br>Incorrect Usage: invalid value &quot;false&quot; for flag -v: parse error<br><br>NAME:<br>   NVIDIA Device Plugin - NVIDIA device plugin for Kubernetes<br><br>USAGE:<br>   NVIDIA Device Plugin [global options] command [command options] <br><br>COMMANDS:<br>   version  Show the version of NVIDIA Device Plugin<br>   help, h  Shows a list of commands or help for one command<br><br>GLOBAL OPTIONS:<br>   --mig-strategy value                                           the desired strategy for exposing MIG devices on GPUs that support it:<br>                                                                    [none | single | mixed] (default: &quot;none&quot;) [$MIG_STRATEGY]<br>   --fail-on-init-error                                           fail the plugin if an error is encountered during initialization, otherwise block indefinitely (default: true) [$FAIL_ON_INIT_ERROR]<br>   --nvidia-driver-root value                                     the root path for the NVIDIA driver installation (typical values are &#x27;/&#x27; or &#x27;/run/nvidia/driver&#x27;) (default: &quot;/&quot;) [$NVIDIA_DRIVER_ROOT]<br>   --pass-device-specs                                            pass the list of DeviceSpecs to the kubelet on Allocate() (default: false) [$PASS_DEVICE_SPECS]<br>   --device-list-strategy value [ --device-list-strategy value ]  the desired strategy for passing the device list to the underlying runtime:<br>                                                                    [envvar | volume-mounts | cdi-annotations] (default: &quot;envvar&quot;) [$DEVICE_LIST_STRATEGY]<br>   --device-id-strategy value                                     the desired strategy for passing device IDs to the underlying runtime:<br>                                                                    [uuid | index] (default: &quot;uuid&quot;) [$DEVICE_ID_STRATEGY]<br>   --gds-enabled                                                  ensure that containers are started with NVIDIA_GDS=enabled (default: false) [$GDS_ENABLED]<br>   --mofed-enabled                                                ensure that containers are started with NVIDIA_MOFED=enabled (default: false) [$MOFED_ENABLED]<br>   --config-file value                                            the path to a config file as an alternative to command line options or environment variables [$CONFIG_FILE]<br>   --cdi-annotation-prefix value                                  the prefix to use for CDI container annotation keys (default: &quot;cdi.k8s.io/&quot;) [$CDI_ANNOTATION_PREFIX]<br>   --nvidia-ctk-path value                                        the path to use for the nvidia-ctk in the generated CDI specification (default: &quot;/usr/bin/nvidia-ctk&quot;) [$NVIDIA_CTK_PATH]<br>   --container-driver-root value                                  the path where the NVIDIA driver root is mounted in the container; used for generating CDI specifications (default: &quot;/driver-root&quot;) [$CONTAINER_DRIVER_ROOT]<br>   -v value                                                       number for the log level verbosity (default: 0)<br>   --node-name value                                              node name (default: &quot;172.20.0.21&quot;) [$NodeName]<br>   --device-split-count value                                     the number for NVIDIA device split (default: 2) [$DEVICE_SPLIT_COUNT]<br>   --device-memory-scaling value                                  the ratio for NVIDIA device memory scaling (default: 1) [$DEVICE_MEMORY_SCALING]<br>   --device-cores-scaling value                                   the ratio for NVIDIA device cores scaling (default: 1) [$DEVICE_CORES_SCALING]<br>   --disable-core-limit                                           If set, the core utilization limit will be ignored (default: false) [$DISABLE_CORE_LIMIT]<br>   --resource-name value                                          the name of field for number GPU visible in container (default: &quot;nvidia.com/gpu&quot;)<br>   --help, -h                                                     show help<br>E0114 02:25:43.184839   36787 main.go:153] invalid value &quot;false&quot; for flag -v: parse error<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:~# kubectl -n kube-system logs hami-device-plugin-n9s94 -c vgpu-monitor | more<br>I0114 02:04:27.527629   34952 client.go:53] BuildConfigFromFlags failed for file /root/.kube/config: stat /root/.kube/config: no such file or directory using inClusterConfig<br>W0114 02:04:27.528191   34952 client_config.go:618] Neither --kubeconfig nor --master was specified.  Using the inClusterConfig.  This might not work.<br>I0114 02:04:27.528497   34952 metrics.go:353] Initializing metrics for vGPUmonitor<br>E0114 02:04:32.537271   34952 feedback.go:269] Failed to update container list: env NODE_NAME not set<br>E0114 02:04:37.541471   34952 feedback.go:269] Failed to update container list: env NODE_NAME not set<br>E0114 02:04:42.541695   34952 feedback.go:269] Failed to update container list: env NODE_NAME not set<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸€ç›´é‡å¤â€œE0114 02:04:42.541695   34952 feedback.go:269] Failed to update container list: <span class="hljs-built_in">env</span> NODE_NAME not <span class="hljs-built_in">set</span>â€</span><br>...<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:~# helm -n kube-system uninstall hami<br>root@controller01:~# rm -rf /usr/local/vgpu<br><span class="hljs-meta prompt_">#</span><span class="language-bash">é‡æ–°å®‰è£…HAMi</span><br>root@controller01:~# helm install hami hami-charts/hami --set resourceName=nvidia.com/vgpu -n kube-system --version 2.4.0<br><span class="hljs-meta prompt_">#</span><span class="language-bash">è¿˜æ˜¯æŠ¥ä¸€æ ·çš„é”™è¯¯</span><br></code></pre></td></tr></table></figure><p>æ ¹æ®é¡¹ç›®ç»´æŠ¤äººå‘˜å›å¤è¯´å¯èƒ½æ˜¯é•œåƒè¢«æ±¡æŸ“äº†</p><p><strong>å¤„ç†æ–¹æ³•ï¼š</strong></p><p>å·²ç»issueï¼š<a href="https://github.com/Project-HAMi/HAMi/issues/805">https://github.com/Project-HAMi/HAMi/issues/805</a></p><p>å‡çº§åˆ°HAMi2.4.1åï¼Œé—®é¢˜ä¸å†å­˜åœ¨ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>containerdå®¹å™¨å¼•æ“æœåŠ¡çš„å®‰è£…ä¸ä½¿ç”¨</title>
    <link href="/2025/01/05/containerd%E5%AE%B9%E5%99%A8%E5%BC%95%E6%93%8E%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/"/>
    <url>/2025/01/05/containerd%E5%AE%B9%E5%99%A8%E5%BC%95%E6%93%8E%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="1-å®‰è£…æ–¹æ³•åˆ—ä¸¾"><a href="#1-å®‰è£…æ–¹æ³•åˆ—ä¸¾" class="headerlink" title="1 å®‰è£…æ–¹æ³•åˆ—ä¸¾"></a>1 å®‰è£…æ–¹æ³•åˆ—ä¸¾</h1><p>   ä»¥ä¸‹ä»¥åœ¨Ubuntu 20.04.3 LTS-amd64 å®¿ä¸»æœºï¼ˆarm64å®¿ä¸»æœºåªéœ€è¦è½¬æ¢å¯¹åº”æ–‡ä»¶æˆ–å‘½ä»¤åç§°å³å¯ï¼‰ä¸Šéƒ¨ç½²containerd å®¹å™¨å¼•æ“æœåŠ¡ä¸ºä¾‹ã€‚</p><ul><li><p>aptå½¢å¼å®‰è£…</p><p>apt install containerd.io</p></li><li><p>äºŒè¿›åˆ¶å½¢å¼å®‰è£…</p><p>è®¿é—® <a href="https://github.com/containerd/">https://github.com/containerd/</a> ä¸‹è½½å¯¹åº”æ„æ¶ä¸æ“ä½œç³»ç»Ÿçš„äºŒè¿›åˆ¶å®‰è£…æ–‡ä»¶ï¼Œè§£å‹åˆ°è‡ªå®šä¹‰ç›®å½•å¹¶è¿›è¡Œæ‰‹åŠ¨é…ç½®</p></li><li><p>é€šè¿‡æºç ç¼–è¯‘å®‰è£…</p></li></ul><h1 id="2-aptå½¢å¼å®‰è£…"><a href="#2-aptå½¢å¼å®‰è£…" class="headerlink" title="2 aptå½¢å¼å®‰è£…"></a>2 aptå½¢å¼å®‰è£…</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">å®‰è£…containerd.ioç»„ä»¶</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">apt install containerd.io</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å®‰è£…å¥½containerdæœåŠ¡åï¼Œ/etc/containerd/config.tomlæ–‡ä»¶é»˜è®¤ä¸å­˜åœ¨</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ç”Ÿæˆé…ç½®æ–‡ä»¶</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">containerd config default &gt; /etc/containerd/config.toml</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿®æ”¹é…ç½®æ–‡ä»¶åéœ€è¦é‡å¯containerdæœåŠ¡</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">systemctl daemon-reload &amp;&amp; systemctl restart containerd</span><br><span class="hljs-meta prompt_"> </span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¸è½½æ–¹æ³•ï¼ˆæ³¨æ„ï¼šä¼šå°†dockeræœåŠ¡ç«¯åŒæ—¶å¸è½½ï¼‰</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">apt remove containerd.io</span><br></code></pre></td></tr></table></figure><h1 id="3-äºŒè¿›åˆ¶æ–¹å¼"><a href="#3-äºŒè¿›åˆ¶æ–¹å¼" class="headerlink" title="3 äºŒè¿›åˆ¶æ–¹å¼"></a>3 äºŒè¿›åˆ¶æ–¹å¼</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">1.å®‰è£…containerdæœ¬èº«</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹è½½ containerd-1.7.24-linux-amd64.tar.gz äºŒè¿›åˆ¶å‹ç¼©æ–‡ä»¶</span> <br>root@ubuntu20:/opt/installPkgs# wget https://github.com/containerd/containerd/releases/download/v1.7.24/containerd-1.7.24-linux-amd64.tar.gz<br><span class="hljs-meta prompt_">#</span><span class="language-bash">åªæŸ¥çœ‹ä¸è§£å‹ å½’æ¡£å‹ç¼©æ–‡ä»¶ä¸­çš„å†…å®¹</span><br>root@ubuntu20:/opt/installPkgs# tar -tvf containerd-1.7.24-linux-amd64.tar.gz<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è§£å‹åˆ°/usr/ ç›®å½•ä¸‹</span> <br>root@ubuntu20:/opt/installPkgs# tar -zxf containerd-1.7.24-linux-amd64.tar.gz -C /usr/<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å°è£…containerd.serviceï¼Œä»¥ä½¿ç”¨ systemdå¯¹containerd.service è¿›è¡Œç®¡ç†</span> <br>root@ubuntu20:/opt/installPkgs# cat &gt; /lib/systemd/system/containerd.service &lt;&lt;EOF<br>[Unit]<br>Description=containerd container runtime<br>Documentation=https://containerd.io<br>After=network.target local-fs.target<br> <br>[Service]<br><span class="hljs-meta prompt_">#</span><span class="language-bash">uncomment to <span class="hljs-built_in">enable</span> the experimental</span><br>sbservice (sandboxed) version of containerd/cri integration<br><span class="hljs-meta prompt_">#</span><span class="language-bash">Environment=<span class="hljs-string">&quot;ENABLE_CRI_SANDBOXES=sandboxed&quot;</span></span><br>ExecStartPre=-/sbin/modprobe overlay<br>ExecStart=/usr/bin/containerd<br> <br>Type=notify<br>Delegate=yes<br>KillMode=process<br>Restart=always<br>RestartSec=5<br><span class="hljs-meta prompt_"># </span><span class="language-bash">Having non-zero Limit*s causes</span><br>performance problems due to accounting overhead<br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-keyword">in</span> the kernel. We recommend using cgroups</span><br>to do container-local accounting.<br>LimitNPROC=infinity<br>LimitCORE=infinity<br>LimitNOFILE=infinity<br><span class="hljs-meta prompt_"># </span><span class="language-bash">Comment TasksMax <span class="hljs-keyword">if</span> your systemd version</span><br>does not supports it.<br><span class="hljs-meta prompt_"># </span><span class="language-bash">Only systemd 226 and above support this</span><br>version.<br>TasksMax=infinity<br>OOMScoreAdjust=-999<br> <br>[Install]<br>WantedBy=multi-user.target<br>EOF<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é‡å¯containerdæœåŠ¡</span> <br>root@ubuntu20:/opt/installPkgs# systemctl daemon-reload<br>root@ubuntu20:/opt/installPkgs# systemctl unmask containerd<br>root@ubuntu20:/opt/installPkgs# systemctl start containerd<br> <br>root@ubuntu20:/opt/installPkgs# systemctl enable containerd <br>root@ubuntu20:/opt/installPkgs# systemctl status containerd<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">2.å®‰è£…runc</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦å¤–ï¼Œéœ€è¦æ‰‹åŠ¨ä¸‹è½½å®‰è£…runcï¼ˆåé¢åˆ›å»ºå®¹å™¨æ—¶éœ€è¦ç”¨åˆ°ï¼‰</span><br>root@ubuntu20:/opt/installPkgs# wget https://github.com/opencontainers/runc/releases/download/v1.1.13/runc.amd64<br>root@ubuntu20:/opt/installPkgs# chmod a+x runc.amd64 <br>root@ubuntu20:/opt/installPkgs# cp -p runc.amd64 /usr/bin/runc<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">3.å®‰è£…cniæ’ä»¶</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä»https://github.com/containernetworking/plugins/releases ä¸‹è½½åˆé€‚ç‰ˆæœ¬ã€æ“ä½œç³»ç»Ÿã€æ„æ¶å¯¹åº”çš„å‹ç¼©æ–‡ä»¶</span><br>root@ubuntu20:/opt/installPkgs# wget https://github.com/containernetworking/plugins/releases/download/v1.6.0/cni-plugins-linux-amd64-v1.6.0.tgz<br>root@ubuntu20:/opt/installPkgs# tar -zxf cni-plugins-linux-amd64-v1.6.0.tgz -C /opt/cni/bin/<br></code></pre></td></tr></table></figure><h1 id="4-æºç ç¼–è¯‘å®‰è£…"><a href="#4-æºç ç¼–è¯‘å®‰è£…" class="headerlink" title="4 æºç ç¼–è¯‘å®‰è£…"></a>4 æºç ç¼–è¯‘å®‰è£…</h1><p>   æš‚ç•¥ï¼Œåç»­æœ‰éœ€è¦æ›´æ–°è¡¥å……åˆ°ä¸ªäººåšå®¢åŒæ­¥æ–‡ç« ã€‚</p><h1 id="5-å®‰è£…ä¸ä½¿ç”¨containerdæœåŠ¡CLI"><a href="#5-å®‰è£…ä¸ä½¿ç”¨containerdæœåŠ¡CLI" class="headerlink" title="5 å®‰è£…ä¸ä½¿ç”¨containerdæœåŠ¡CLI"></a>5 å®‰è£…ä¸ä½¿ç”¨containerdæœåŠ¡CLI</h1><p>â€‹      ä¸€å…±æœ‰3ç§ä¸containerdæœåŠ¡è¿›è¡Œäº¤äº’çš„å‘½ä»¤è¡Œå·¥å…·ï¼šnerdctlã€ctrã€crictlã€‚</p><h2 id="å®‰è£…ä¸ä½¿ç”¨nerdctl"><a href="#å®‰è£…ä¸ä½¿ç”¨nerdctl" class="headerlink" title="å®‰è£…ä¸ä½¿ç”¨nerdctl"></a>å®‰è£…ä¸ä½¿ç”¨nerdctl</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…nerdctl</span><br>root@ubuntu20:~# cd /opt/installPkgs/ <br>root@ubuntu20:~# wget https://github.com/containerd/nerdctl/releases/download/v2.0.1/nerdctl-2.0.1-linux-amd64.tar.gz<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è§£å‹ï¼ˆä¿è¯/usr/local/bin ç›®å½•åœ¨æ“ä½œç³»ç»ŸPATHè·¯å¾„å†…ï¼‰</span><br>root@ubuntu20:/opt/installPkgs# tar Cxzvvf /usr/local/bin nerdctl-2.0.1-linux-amd64.tar.gz<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…buildkitï¼ˆbuildkit æ˜¯ä¸€ä¸ªå°† <span class="hljs-built_in">source</span> code è½¬æ¢ä¸º build artifacts çš„å¼€æºå·¥å…·ï¼Œbuildctl å®¢æˆ·ç«¯å¯ç”¨äº Linuxã€macOS å’Œ Windowsï¼Œä½† buildkitd å®ˆæŠ¤è¿›ç¨‹ç›®å‰ä»…é€‚ç”¨äº Linuxã€‚buildkitæš‚æ—¶æ²¡ç”¨åˆ°ï¼Œä¸å¼ºåˆ¶å®‰è£…ï¼Œä½†å¦‚æœä¸å®‰è£…æ‰§è¡Œnerdctl ç›¸å…³å‘½ä»¤æ—¶ä¼šå‘Šè­¦ï¼‰</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä¸‹è½½buildkit-v0.11.5å®‰è£…åŒ…</span><br>root@ubuntu20:~# wget https://github.com/moby/buildkit/releases/download/v0.11.5/buildkit-v0.11.5.linux-amd64.tar.gz<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è§£å‹ buildkit-v0.11.5å®‰è£…åŒ…</span><br>root@ubuntu20:~# tar -zxvf buildkit-v0.11.5.linux-amd64.tar.gz -C /usr/local<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">éªŒè¯nerdctl å‘½ä»¤ã€æŸ¥çœ‹containerdç‰ˆæœ¬</span><br>root@ubuntu20:~# nerdctl version<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/05/ybK5m2Mdauvile6.png" alt="image-20250105234139252"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨nerdctlç®¡ç†é•œåƒ</span><br>root@ubuntu20:~# nerdctl pull registry.cn-hangzhou.aliyuncs.com/quectel/ubuntu:secboot_v2<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹é•œåƒ</span><br>root@ubuntu20:~# nerdctl images æˆ– nerdctl image ls<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹nerdctlå¸®åŠ©</span><br>root@ubuntu20:~# nerdctl --help<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»ºå®¹å™¨å¹¶è¿›å…¥å®¹å™¨å†…</span><br>root@ubuntu20:~# nerdctl run -it registry.cn-hangzhou.aliyuncs.com/quectel/ubuntu:secboot_v2 /bin/bash<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä»å®¹å™¨é€€å‡ºå›åˆ°å®¿ä¸»æœºä¸Šï¼ˆå°½é‡ä½¿ç”¨ç»„åˆé”®ï¼šctrl+p+qã€‚åœ¨ä½¿ç”¨Dockerå®¹å™¨å¼•æ“æ—¶ï¼Œä½¿ç”¨<span class="hljs-built_in">exit</span>é€€å‡ºå®¹å™¨ä¼šç›´æ¥å°†å®¹å™¨åœæ‰ï¼Œä½¿ç”¨nerdctlæ—¶è™½æœªå‘ç°æ­¤æƒ…å†µï¼Œä½†å»ºè®®è¿˜æ˜¯å…»æˆä¸Šè¿°å¥½ä¹ æƒ¯è¾ƒå¥½ï¼‰</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é…ç½®nerdctlå‘½ä»¤è‡ªåŠ¨è¡¥å…¨</span><br>root@ubuntu20:~# echo &quot;source &lt;(nerdctl completion bash)&quot; &gt;&gt; /root/.bashrc<br>root@ubuntu20:~# source /root/.bashrc<br><br></code></pre></td></tr></table></figure><h2 id="å®‰è£…ä¸ä½¿ç”¨ctr"><a href="#å®‰è£…ä¸ä½¿ç”¨ctr" class="headerlink" title="å®‰è£…ä¸ä½¿ç”¨ctr"></a>å®‰è£…ä¸ä½¿ç”¨ctr</h2><p>â€‹      ctrå‘½ä»¤è¡Œå·¥å…·æ˜¯è·ŸéšcontainerdæœåŠ¡ä¸€å…±è¢«å®‰è£…éƒ¨ç½²å¥½çš„ï¼Œæ­¤æ—¶å¯ç›´æ¥ä½¿ç”¨ã€‚</p><h3 id="é•œåƒæ“ä½œ"><a href="#é•œåƒæ“ä½œ" class="headerlink" title="é•œåƒæ“ä½œ"></a>é•œåƒæ“ä½œ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">containerdä¸­æ–°å¼•å…¥å‘½åç©ºé—´çš„æ¦‚å¿µï¼Œæ‰€æœ‰é•œåƒä¸å®¹å™¨éƒ½å±äºæŸä¸ªç‰¹å®šçš„å‘½åç©ºé—´</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¹Ÿåªåœ¨ç‰¹å®šçš„å‘½åç©ºé—´å†…å¯è§ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šå‘½åç©ºé—´ï¼Œåˆ™æ‰€æœ‰æ“ä½œåœ¨defaultå‘½åç©ºé—´å†…æ‰§è¡Œ</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">containerdé»˜è®¤å·²ç»åˆ›å»ºå¦‚ä¸‹3ä¸ªå‘½åç©ºé—´</span><br>root@ubuntu20:~# ctr ns ls<br>NAME    LABELS <br>default        <br>k8s.io         <br>moby<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‹‰å–é•œåƒï¼ˆå¦‚ä¸‹å‘½åç›¸å½“äºçœç•¥äº†<span class="hljs-string">&quot;-n default&quot;</span>ï¼‰</span><br>root@ubuntu20:~# ctr image pull registry.cn-hangzhou.aliyuncs.com/quectel/ubuntu:secboot_v2<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹é•œåƒï¼ˆå¦‚ä¸‹imageå¯è¢«iæ›¿æ¢ï¼Œlistå¯è¢«<span class="hljs-built_in">ls</span>æ›¿æ¢ï¼Œå³<span class="hljs-string">&quot;ctr i ls&quot;</span>ï¼Œç”šè‡³æ··åˆç€ä½¿ç”¨ä¹Ÿè¡Œï¼‰</span><br>root@ubuntu20:~# ctr -n default image list<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/07/p63FibfTskaxRqD.png" alt="image-20250107224942505"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">é•œåƒæ ‡è®°tag</span><br>ctr -n default i tag registry.cn-hangzhou.aliyuncs.com/quectel/ubuntu:secboot_v2 175.6.40.93:8196/base/ubuntu:secboot_v2<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœæ–°é•œåƒ reference å·²å­˜åœ¨, åˆ™éœ€è¦å…ˆåˆ é™¤æ–°reference, æˆ–è€…åŠ ä¸Š<span class="hljs-string">&quot;--force&quot;</span>å¼ºåˆ¶æ›¿æ¢</span><br>ctr -n default i tag --force registry.cn-hangzhou.aliyuncs.com/quectel/ubuntu:secboot_v2 175.6.40.93:8196/base/ubuntu:secboot_v2<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ¨é€é•œåƒ</span><br>ctr -n default i push -k 175.6.40.93:8196/base/ubuntu:secboot_v2<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‹‰å–é•œåƒ</span><br>ctr -n default i pull -k 175.6.40.93:8196/base/ubuntu:secboot_v2<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ é™¤é•œåƒ</span><br>ctr -n default i rm 175.6.40.93:8196/base/ubuntu:secboot_v2<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯¼å‡ºé•œåƒ</span><br>ctr -n default i export ubuntu-secboot_v2.tar 175.6.40.93:8196/base/ubuntu:secboot_v2<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯¼å…¥é•œåƒ</span><br>ctr -n default i import ubuntu-secboot_v2.tar<br></code></pre></td></tr></table></figure><h3 id="å®¹å™¨æ“ä½œ"><a href="#å®¹å™¨æ“ä½œ" class="headerlink" title="å®¹å™¨æ“ä½œ"></a>å®¹å™¨æ“ä½œ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»ºå®¹å™¨ï¼ˆä¼šè‡ªåŠ¨è¿›å…¥å®¹å™¨å†…ã€‚æ­¤æ–¹å¼åˆ›å»ºçš„é»˜è®¤æ˜¯é™æ€çš„å®¹å™¨ï¼Œé™æ€å®¹å™¨ä¸åŠ¨æ€å®¹å™¨æ˜¯cträ¸­çš„æ¦‚å¿µï¼‰</span><br>root@ubuntu20:~# ctr run -t registry.cn-hangzhou.aliyuncs.com/quectel/ubuntu:secboot_v2 test01<br><span class="hljs-meta prompt_">#</span><span class="language-bash">é€€å‡ºå®¹å™¨ä½¿ç”¨<span class="hljs-built_in">exit</span>å‘½ä»¤æˆ–ç»„åˆé”®â€œctrl+dâ€</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹å®¹å™¨</span><br>root@ubuntu20:~# ctr c ls<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/05/e2Lqb9IXJ7pEMrj.png" alt="image-20250105234351116"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯</span><br>ctr container info test01<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é™æ€å®¹å™¨å¯åŠ¨ä¸ºåŠ¨æ€å®¹å™¨</span><br>å¤åˆ¶containerdè¿æ¥runCå«ç‰‡å·¥å…·è‡³ç³»ç»Ÿå³ä¿è¯/usr/bin/ç›®å½•æœ‰ä¸€ä¸ªcontainerd-shim-runc-v2æ‰§è¡Œæ–‡ä»¶<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯åŠ¨taskï¼Œå³è¡¨ç¤ºåœ¨å®¹å™¨ä¸­è¿è¡Œäº†è¿›ç¨‹ï¼Œå³ä¸ºåŠ¨æ€å®¹å™¨ï¼ˆ-dè¡¨ç¤ºdaemonæˆ–è€…åå°çš„æ„æ€ï¼‰</span><br>ctr task start -d test01<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹taskä¹Ÿæ˜¯æŸ¥çœ‹å®¹å™¨æ‰€åœ¨å®¿ä¸»æœºè¿›ç¨‹ï¼ˆå®ƒå…¶å®æ˜¯ä¸€ä¸ªå®¿ä¸»æœºè¿›ç¨‹ï¼Œå³165225ä¸Šä¸€ä¸ªå®¿ä¸»æœºè¿›ç¨‹<span class="hljs-built_in">id</span>ï¼‰</span><br>ctr task ls<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/05/lKXzAImqbPa5foJ.png" alt="image-20250105234414968"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹å®¹å™¨çš„è¿›ç¨‹(éƒ½æ˜¯å®¿ä¸»æœºçš„è¿›ç¨‹)</span><br>ctr task ps test01<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/05/sTpCgMyOjDuzWBi.png" alt="image-20250105234439449"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å®¿ä¸»æœºæŸ¥çœ‹åˆ°ç›¸åº”çš„è¿›ç¨‹</span><br>ps -ef | grep 165225<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/05/uHoxfd8JVj2GyzY.png" alt="image-20250105234512202"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹æ­£åœ¨è¿è¡Œä¸­çš„å®¹å™¨</span><br>ctr task ls<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é‡æ–°è¿›å…¥åŠ¨æ€å®¹å™¨å†…</span><br>root@ubuntu20:~# ctr -n default task exec --exec-id $RANDOM -t test01 bash<br><span class="hljs-meta prompt_">#</span><span class="language-bash">é€€å‡ºåŠ¨æ€å®¹å™¨ï¼Œä½¿ç”¨<span class="hljs-built_in">exit</span>æˆ–ç»„åˆé”®<span class="hljs-string">&quot;ctrl+d&quot;</span>ã€‚æ­¤åæ­¤åŠ¨æ€å®¹å™¨ä»ç„¶æ˜¯å¤„äºRunningçŠ¶æ€</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/05/qUG7LjgvbKS1k4J.png" alt="image-20250105234549550"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ç›´æ¥åˆ›å»ºä¸€ä¸ªåŠ¨æ€çš„å®¹å™¨ç„¶åè¿›å…¥å®¹å™¨å†…ï¼Œå…¶ä¸­--net-host ä»£è¡¨å®¹å™¨çš„IPå°±æ˜¯å®¿ä¸»æœºçš„IP(ç›¸å½“äºdockeré‡Œçš„hostç±»å‹ç½‘ç»œ)ï¼Œ</span><br>ctr run -d --net-host registry.cn-hangzhou.aliyuncs.com/quectel/ubuntu:secboot_v2 test02<br>ctr task ls<br>ctr -n default task exec --exec-id $RANDOM -t test02 bash<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/05/3jPE29pgeHMRKOk.png" alt="image-20250105234638744"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ é™¤å®¹å™¨</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é¦–å…ˆè¦å°†åŠ¨æ€å®¹å™¨å¯¹åº”çš„taskæ€æ­»ã€åˆ é™¤</span><br>root@ubuntu20:~# ctr task kill test01<br>root@ubuntu20:~# ctr task delete test01<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ­¤æ—¶test01å®¹å™¨æ˜¯å¤„äºCreatedçŠ¶æ€ï¼ˆå¦‚æœå®‰è£…äº†nerdctlï¼Œå¯ä»¥ä½¿ç”¨â€œnerdctl ps -aâ€æŸ¥çœ‹ï¼‰</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ­¤æ—¶æ‰èƒ½åˆ é™¤test01å®¹å™¨</span><br>root@ubuntu20:~# ctr c delete test01<br></code></pre></td></tr></table></figure><p>ç¬”è€…è®¤ä¸ºctrå‘½ä»¤è¡Œå·¥å…·çš„æ‰§è¡Œä¹ æƒ¯ä¸åƒnerdctlã€crictlï¼Œå¹³æ—¶ç”¨èµ·æ¥ä¸å¤ªæ–¹ä¾¿ã€‚ä½†å¦‚æœæ˜¯ç”¨æ¥è°ƒè¯•ï¼Œè¿˜æ˜¯å¯ä»¥çš„</p><h2 id="å®‰è£…ä¸ä½¿ç”¨crictl"><a href="#å®‰è£…ä¸ä½¿ç”¨crictl" class="headerlink" title="å®‰è£…ä¸ä½¿ç”¨crictl"></a>å®‰è£…ä¸ä½¿ç”¨crictl</h2><p>â€‹      crictlä¸Kubernetesçš„ç´§å¯†é›†æˆï¼Œå®ƒæ— æ³•ç›´æ¥æŸ¥çœ‹æˆ–è°ƒè¯•éKubernetesåˆ›å»ºçš„å®¹å™¨ã€‚æ‰€ä»¥æ— æ³•åœ¨ékubernetesç¯å¢ƒç›´æ¥æ“ä½œå®¹å™¨ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹è½½å®‰è£…</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ­¤å¤„ä½¿ç”¨v1.30.0ç‰ˆæœ¬ï¼Œæ‰€æœ‰åŠæœ€æ–°ç‰ˆæœ¬å¯åœ¨æ­¤æŸ¥çœ‹ï¼šhttps://github.com/kubernetes-sigs/cri-tools/releases</span><br>cd /opt/installPkgs<br>VERSION=&quot;v1.30.0&quot;   <br>wget https://github.com/kubernetes-sigs/cri-tools/releases/download/$VERSION/crictl-$VERSION-linux-amd64.tar.gz<br><span class="hljs-meta prompt_">#</span><span class="language-bash">è§£å‹</span><br>tar zxvf crictl-$VERSION-linux-amd64.tar.gz -C /usr/local/bin<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/05/rApazmoXFYftiLv.png" alt="image-20250105234828836"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">è¯¥ WARN æ¶ˆæ¯(å›¾æœªæˆªå…¨)è¡¨æ˜ï¼Œcrictl æˆ–å…¶ä»–ç›¸å…³å·¥å…·åœ¨å°è¯•è¿æ¥å®¹å™¨è¿è¡Œæ—¶ï¼ˆå¦‚ containerdï¼‰æ—¶ï¼Œæ­£åœ¨ä½¿ç”¨é»˜è®¤çš„è®¾ç½®ä¸­çš„ç«¯ç‚¹åˆ—è¡¨ã€‚ä½†é»˜è®¤çš„è®¾ç½®å·²ç»è¢«å¼ƒç”¨ï¼Œè€Œåˆæœªæ˜ç¡®è®¾ç½®crictlçš„runtime-endpointã€‚è§£å†³ä¸Šè¿°è­¦å‘Šçš„æ–¹æ³•</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é…ç½®å®¹å™¨è¿è¡Œæ—¶å’Œé•œåƒæœåŠ¡çš„ç«¯ç‚¹</span><br>cat &gt; /etc/crictl.yaml &lt;&lt;EOF<br>runtime-endpoint: unix:///run/containerd/containerd.sock<br><span class="hljs-meta prompt_">#</span><span class="language-bash">image-endpoint: unix:///run/containerd/containerd.sock</span><br>timeout: 10<br>debug: false<br>EOF<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‹‰å–é•œåƒ</span><br>root@ubuntu20:~# crictl pull registry.cn-hangzhou.aliyuncs.com/quectel/ubuntu:secboot<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å…¶ä»–ç”¨æ³•å‚è€ƒä¸‹å›¾</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/09/UTmBDE5FGKcRlLn.png" alt="image-20250109211000203"></p><h1 id="6-å‚è€ƒèµ„æº"><a href="#6-å‚è€ƒèµ„æº" class="headerlink" title="6 å‚è€ƒèµ„æº"></a>6 å‚è€ƒèµ„æº</h1><ul><li>å…³äºbuildkitçš„ä»‹ç»å¯å‚è€ƒï¼š<a href="https://github.com/moby/buildkit">https://github.com/moby/buildkit</a></li><li>containerdå…¥é—¨ï¼š<a href="https://github.com/containerd/containerd/blob/main/docs/getting-started.md">https://github.com/containerd/containerd/blob/main/docs/getting-started.md</a></li><li>ctrç”¨æ³•ï¼šç›´æ¥æ‰§è¡Œâ€œctr â€“helpâ€ã€<a href="https://github.com/projectatomic/containerd/blob/master/docs/cli.md%E3%80%81https://www.akiraka.net/kubernetes/1139.html%E3%80%81https://www.cnblogs.com/lldhsds/p/18262839">https://github.com/projectatomic/containerd/blob/master/docs/cli.mdã€https://www.akiraka.net/kubernetes/1139.htmlã€https://www.cnblogs.com/lldhsds/p/18262839</a></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>containerd å®‰è£… nerdctl ctr crictl</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LXCå®¹å™¨è¿è¡Œæ—¶</title>
    <link href="/2024/12/27/LXC%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6/"/>
    <url>/2024/12/27/LXC%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6/</url>
    
    <content type="html"><![CDATA[<h1 id="1-LXCé¡¹ç›®ä»‹ç»"><a href="#1-LXCé¡¹ç›®ä»‹ç»" class="headerlink" title="1 LXCé¡¹ç›®ä»‹ç»"></a>1 LXCé¡¹ç›®ä»‹ç»</h1><p>â€‹        LXCæ˜¯åœ¨crgoupè¢«å¼•å…¥Linuxå†…æ ¸åç«‹å³è¢«åˆ›å»ºçš„é¡¹ç›®ï¼Œå®ƒè¢«è®¾è®¡ç”¨äºâ€full-systemâ€ å®¹å™¨ï¼Œæ˜¯ç”¨æ¥åˆ›å»ºLinuxå®¹å™¨çš„ï¼Œæ­¤æ—¶çš„Linuxå®¹å™¨è·Ÿæˆ‘ä»¬ç°åœ¨å¸¸ç”¨çš„Linuxä¸ŠDockerå®¹å™¨æˆ–containerdå®¹å™¨æ˜¯æœ‰åŒºåˆ«çš„ï¼Œæœ€æ˜¾è‘—çš„åŒºåˆ«åœ¨äºå®ƒä»¬ä½¿ç”¨ä¸æ˜¯å®¹å™¨è¿è¡Œæ—¶ä¸åŒã€‚åŒæ—¶Systemdä¹Ÿè·å¾—äº†ç±»ä¼¼çš„å®¹å™¨æ”¯æŒï¼Œsystemd-nspawnå¯ä»¥è¿è¡Œå‘½åç©ºé—´è¿›ç¨‹ï¼Œsystemdæœ¬èº«å¯ä»¥æ§åˆ¶cgroupã€‚å°½ç®¡lxcä¸systemd-nspawnä¹Ÿåœ¨å…¶ä»–é¡¹ç›®ä¸­è¢«åˆ©ç”¨åˆ°äº†ï¼Œä½†å®ƒä»¬è¿˜æ˜¯æ²¡æœ‰èƒ½å¤Ÿå¸å¼•è¶³å¤Ÿå¤šçš„ç»ˆç«¯ç”¨æˆ·ã€‚ç°åœ¨å¹¶ä¸æ˜¯ä¸€ä¸ªæµè¡Œçš„å¼€æºå®¹å™¨åŒ–é¡¹ç›®ã€‚</p><h1 id="2-LXCå®¹å™¨è¿è¡Œæ—¶ä»‹ç»"><a href="#2-LXCå®¹å™¨è¿è¡Œæ—¶ä»‹ç»" class="headerlink" title="2 LXCå®¹å™¨è¿è¡Œæ—¶ä»‹ç»"></a>2 LXCå®¹å™¨è¿è¡Œæ—¶ä»‹ç»</h1><p>â€‹        LXC æ˜¯ä¸€ä¸ªæ—©æœŸçŸ¥åçš„Linux å®¹å™¨è¿è¡Œæ—¶ï¼Œä¸»è¦ç”±Cè¯­è¨€å®ç°ã€‚å®˜ç½‘å‚è€ƒ <a href="https://linuxcontainers.org/lxc/introduction/">https://linuxcontainers.org/lxc/introduction/</a> ã€‚</p><p><img src="https://s2.loli.net/2024/12/27/s2lMK6STe1YJvDw.png" alt="image-20241227233124311"></p><p><img src="https://s2.loli.net/2024/12/27/62NApc1QeoqavCX.png" alt="image-20241227233051173"></p><p>â€‹        OCIï¼ˆOpen Container Initiativeï¼‰è§„èŒƒä¸»è¦å®šä¹‰äº†å®¹å™¨è¿è¡Œæ—¶çš„æ ‡å‡†ï¼ŒåŒ…æ‹¬å®¹å™¨çš„é•œåƒæ ¼å¼ã€å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆå¦‚åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤ï¼‰ã€é…ç½®ç®¡ç†ï¼ˆå¦‚æŒ‚è½½ç‚¹ã€ç¯å¢ƒå˜é‡ç­‰ï¼‰ä»¥åŠèµ„æºç®¡ç†ï¼ˆå¦‚CPUã€å†…å­˜åˆ†é…ï¼‰ç­‰å¤šä¸ªæ–¹é¢ã€‚ç¬¦åˆ OCI è§„èŒƒçš„å®¹å™¨è¿è¡Œæ—¶å¯ä»¥æ›´å¥½åœ°ä¸å…¶ä»–ç¬¦åˆè¯¥è§„èŒƒçš„å·¥å…·å’Œå¹³å°è¿›è¡Œäº¤äº’å’Œåä½œã€‚</p><p>â€‹        LXC å¹¶ä¸å®Œå…¨ç¬¦åˆOCI è§„èŒƒã€‚LXC æœ‰è‡ªå·±ç‹¬ç«‹çš„ä¸€å¥—å®¹å™¨åˆ›å»ºå’Œç®¡ç†æœºåˆ¶ï¼Œå®ƒä¸»è¦æ˜¯åˆ©ç”¨Linux å†…æ ¸çš„ cgroups å’Œ namespaces ç‰¹æ€§æ¥å®ç°å®¹å™¨çš„éš”ç¦»å’Œèµ„æºç®¡ç†ã€‚</p><p>â€‹        å°½ç®¡ LXC æœ¬èº«ä¸ç¬¦åˆOCI è§„èŒƒï¼Œä½†åœ¨æŸäº›åœºæ™¯ä¸‹å¯ä»¥å®ç°ä¸€å®šç¨‹åº¦çš„å…¼å®¹ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡ä¸€äº›ä¸­é—´å±‚å·¥å…·æˆ–è€…é€‚é…å±‚æ¥ä½¿ LXC å®¹å™¨ä¸åŸºäº OCI è§„èŒƒçš„ç”Ÿæ€ç³»ç»Ÿè¿›è¡Œäº¤äº’ã€‚ä¸è¿‡ï¼Œè¿™ç§æ–¹å¼ç›¸å¯¹å¤æ‚ï¼Œå¹¶ä¸”å¯èƒ½ä¼šæŸå¤±ä¸€äº›LXC æœ¬èº«çš„ç‰¹æ€§æˆ–è€…å¼•å…¥é¢å¤–çš„å¼€é”€ï¼Œç¬”è€…æœªåšæ¢è®¨ç ”ç©¶ï¼Œæ­¤æ–‡ä¸æ¶‰åŠã€‚</p><h1 id="3-å®‰è£…LXC"><a href="#3-å®‰è£…LXC" class="headerlink" title="3 å®‰è£…LXC"></a>3 å®‰è£…LXC</h1><h2 id="è½¯ç¡¬ä»¶è¦æ±‚"><a href="#è½¯ç¡¬ä»¶è¦æ±‚" class="headerlink" title="è½¯ç¡¬ä»¶è¦æ±‚"></a>è½¯ç¡¬ä»¶è¦æ±‚</h2><ul><li><p>æ”¯æŒå¤šç§æ„æ¶å¦‚amd64ã€arm64ã€riscv64ã€armhfç­‰</p></li><li><p>è¦ä½¿ç”¨ lxc-attachåŠéç‰¹æƒå®¹å™¨ï¼Œå°±å¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p></li><li><ul><li>Linux kernel &gt;&#x3D; 3.12</li></ul></li><li><ul><li>è‡³å°‘æœ‰glibc, musl libc, uclib or bionic å…¶ä¸­ä¸€ä¸ªä½œä¸ºæ“ä½œç³»ç»Ÿçš„ C library</li></ul></li><li><p>å…¶ä½™æ¨èçš„ä¿¡èµ–åº“ï¼š</p></li><li><ul><li>libcap (to allow for capability drops)</li></ul></li><li><ul><li>libapparmor (to set a different apparmor profile for the container)</li></ul></li><li><ul><li>libselinux (to set a different selinux context for the container)</li></ul></li><li><ul><li>libseccomp (to set a seccomp policy for the container)</li></ul></li><li><ul><li>libgnutls (for various checksumming)</li></ul></li><li><ul><li>liblua (for the LUA binding)</li></ul></li><li><ul><li>python3-dev (for the python3 binding)</li></ul></li></ul><h2 id="å®‰è£…æ­¥éª¤"><a href="#å®‰è£…æ­¥éª¤" class="headerlink" title="å®‰è£…æ­¥éª¤"></a>å®‰è£…æ­¥éª¤</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨ubuntu20.04LTS-amd64ä¸Šå®‰è£…lxc</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">apt-getÂ install lxc</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">éªŒè¯å®‰è£…æˆåŠŸï¼ˆæˆåŠŸæ—¶è¾“å‡ºå¤§è‡´å¦‚ä¸‹ï¼‰</span><br>root@ubuntu20:~# lxc-infoÂ --version4.0.12<br></code></pre></td></tr></table></figure><h1 id="4-ç®€å•ä½¿ç”¨LXC"><a href="#4-ç®€å•ä½¿ç”¨LXC" class="headerlink" title="4 ç®€å•ä½¿ç”¨LXC"></a>4 ç®€å•ä½¿ç”¨LXC</h1><h2 id="å‘½ä»¤è¡Œå½¢å¼"><a href="#å‘½ä»¤è¡Œå½¢å¼" class="headerlink" title="å‘½ä»¤è¡Œå½¢å¼"></a>å‘½ä»¤è¡Œå½¢å¼</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»ºlxcå®¹å™¨(ç¬¬ä¸€æ¬¡åˆ›å»ºlxcå®¹å™¨æ—¶è€—æ—¶è¾ƒé•¿)</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">4.1Â åªé€šè¿‡-tæŒ‡å®šæ¨¡æ¿ï¼ˆå…¶å®å°±æ˜¯å®¹å™¨é•œåƒï¼‰åç§°ï¼Œä¸æŒ‡å®šæ ‡ç­¾ä¸æ„æ¶ï¼Œé‚£ä¹ˆæ ‡ç­¾ä¸æ„æ¶ä¸å®¿ä¸»æœºé é½</span><br>root@ubuntu20:~# lxc-createÂ -n my_lxc_ubuntuÂ -t ubuntu<br><span class="hljs-meta prompt_">#</span><span class="language-bash">4.2Â æ‰§è¡Œåˆ›å»ºlxcå®¹å™¨çš„å‘½ä»¤æ—¶ä¸æŒ‡å®šæ¨¡æ¿åç§°ï¼Œåˆ›å»ºè¿‡ç¨‹ä¸­äº’åŠ¨æŒ‡å®šï¼ˆæŒ‡å®šDistributionã€Releaseã€Architectureï¼‰</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰€æœ‰å®¹å™¨æ¨¡æ¿å¥½åƒæ˜¯è¢«å®˜æ–¹ç»´æŠ¤çš„ï¼ˆå…·ä½“è¿˜æœªç ”ç©¶ï¼‰</span><br>root@ubuntu20:~# lxc-createÂ --template download --name my-container<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœå·²ç»çŸ¥é“è¿™ä¸‰ä¸ªå‚æ•°å¯ä»¥æ˜¯ä»€ä¹ˆï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åœ¨ä¸Šè¿°å‘½ä»¤ç›´æ¥æŒ‡å®šä¸‹é¢çš„3ä¸ªå‚æ•°</span><br>root@ubuntu20:~# lxc-create --template download --name my-container -- --dist opensuse --release 15.5 --arch amd64<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ²¡æœ‰æŒ‡å®š--distã€--releaseã€--<span class="hljs-built_in">arch</span>å‚æ•°æ—¶ï¼Œåˆ›å»ºä¸­é€šè¿‡å¦‚ä¸‹æ–¹å¼æŒ‡å®š</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/12/27/GWfEhz2O3c1RaCr.png" alt="image-20241227232807348"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">4.3Â å¯åŠ¨å®¹å™¨ï¼šåˆ›å»ºå‡ºæ¥çš„lxcå®¹å™¨é»˜è®¤æ˜¯åœæ­¢çŠ¶æ€ï¼Œéœ€è¦æ‰‹åŠ¨å¯åŠ¨</span><br>root@ubuntu20:~# lxc-startÂ -n my-container<br><span class="hljs-meta prompt_">#</span><span class="language-bash">4.4Â è¿›å…¥lxcå®¹å™¨å†…</span><br>root@ubuntu20:~# lxc-attachÂ -n my-container<br><span class="hljs-meta prompt_">#</span><span class="language-bash">4.5Â æ‰§è¡Œå‘½ä»¤ï¼šè¿›å…¥å®¹å™¨å†…åï¼Œå¯ä»¥åœ¨å®¹å™¨å†…æ‰§è¡Œå‘½ä»¤</span><br>my-container:~Â # catÂ /etc/os-releaseÂ <br>NAME=&quot;openSUSE Leap&quot;<br>VERSION=&quot;15.5&quot;<br>ID=&quot;opensuse-leap&quot;<br>ID_LIKE=&quot;suse opensuse&quot;<br>â€¦<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">4.6Â ä»lxcå®¹å™¨å†…é€€å‡º</span><br>my-container:~Â # exit<br><span class="hljs-meta prompt_">#</span><span class="language-bash">4.7æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨</span><br>root@ubuntu20:~# lxc-lsÂ -f<br><span class="hljs-meta prompt_">#</span><span class="language-bash">4.8æŸ¥çœ‹å®¹å™¨ä¿¡æ¯</span>Â <br>root@ubuntu20:~# lxc-infoÂ -n my-container<br><span class="hljs-meta prompt_">#</span><span class="language-bash">4.9Â åœæ‰å®¹å™¨</span><br>root@ubuntu20:~# lxc-stopÂ -n my-container<br><span class="hljs-meta prompt_">#</span><span class="language-bash">4.10Â åˆ é™¤å®¹å™¨</span><br>root@ubuntu20:~# lxc-destroyÂ -n my-containerÂ <br><span class="hljs-meta prompt_">#</span><span class="language-bash">æš‚æ—¶æœªå¼„æ¸…æ¥šæ˜¯å¦å¯ä»¥å®šåˆ¶lxcå®¹å™¨é•œåƒï¼Œç†è®ºä¸Šåº”è¯¥æ˜¯å¯ä»¥çš„ã€‚</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å› ä¸ºè¿™ä¸ªlxcå®¹å™¨æš‚æ—¶æœªçœŸæ­£ä½¿ç”¨ï¼Œæš‚æ—¶ä¸å†ç ”ç©¶</span><br></code></pre></td></tr></table></figure><p>â€‹        å…¶ä»–å…³äºå‘½ä»¤è¡Œå¯¹lxcå®¹å™¨è¿›è¡Œæ“ä½œçš„è¯´æ˜ï¼Œå‚è§å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://linuxcontainers.org/lxc/getting-started/">https://linuxcontainers.org/lxc/getting-started/</a></p><h2 id="APIè°ƒç”¨å½¢å¼"><a href="#APIè°ƒç”¨å½¢å¼" class="headerlink" title="APIè°ƒç”¨å½¢å¼"></a>APIè°ƒç”¨å½¢å¼</h2><p>â€‹        ä»å®˜ç½‘çœ‹åˆ°çš„å†…å®¹ï¼Œç›®å‰æ”¯æŒCè¯­è¨€ä¸Pythonè¯­è¨€é€šè¿‡APIå½¢å¼å¯¹lxcå®¹å™¨ç›¸å…³æ“ä½œã€‚å…·ä½“å‚è§ï¼š<a href="https://linuxcontainers.org/lxc/documentation/">https://linuxcontainers.org/lxc/documentation/</a></p><h1 id="5-LXCå…¶ä»–èµ„æºä»‹ç»"><a href="#5-LXCå…¶ä»–èµ„æºä»‹ç»" class="headerlink" title="5 LXCå…¶ä»–èµ„æºä»‹ç»"></a>5 LXCå…¶ä»–èµ„æºä»‹ç»</h1><p>1ï¼‰lxcå®¹å™¨å½“å‰è™½ç„¶å¹¶ä¸æ˜¯å¾ˆç«ï¼Œä½†å…¶ä¸€ç›´åœ¨è¿­ä»£ï¼Œå…¶æ‰€æœ‰ç‰ˆæœ¬ä¿¡æ¯åŠä¸‹è½½ï¼š<a href="https://linuxcontainers.org/lxc/downloads/">https://linuxcontainers.org/lxc/downloads/</a> </p><p>2ï¼‰lxcé¡¹ç›®å¯¹åº”ä»£å¼€æºä»£ç ä»“åº“åœ°å€ï¼š<a href="https://github.com/lxc/lxc">https://github.com/lxc/lxc</a> </p><p>3ï¼‰lxcç›¸å…³æŒ‡ä»¤çš„manpageï¼š<a href="https://linuxcontainers.org/lxc/manpages">https://linuxcontainers.org/lxc/manpages</a> </p><p>4ï¼‰lxcå®¹å™¨å®‰å…¨æœºåˆ¶ä»‹ç»ï¼š<a href="https://linuxcontainers.org/lxc/security">https://linuxcontainers.org/lxc/security</a></p><h1 id="6-å¤‡æ³¨ä¸å‚è€ƒæ–‡ç« "><a href="#6-å¤‡æ³¨ä¸å‚è€ƒæ–‡ç« " class="headerlink" title="6 å¤‡æ³¨ä¸å‚è€ƒæ–‡ç« "></a>6 å¤‡æ³¨ä¸å‚è€ƒæ–‡ç« </h1><p>â€‹        è®¢é˜…å·æ–‡ç« ä¸æ–¹ä¾¿æ›´æ–°ï¼Œå¦‚åç»­æœ‰ä¿®æ”¹æˆ–å®Œå–„ï¼Œå°†æ›´æ–°åˆ°ä¸ªäººåšå®¢ï¼Œåšå®¢åœ°å€å‚è€ƒæ–‡é¦–ã€‚æŠ€æœ¯æ“ä½œç±»æ–‡ç« æ¨èç›´æ¥è®¿é—®ä¸ªäººåšå®¢æŸ¥é˜…ï¼Œé˜…è¯»æ•ˆæœæ›´ä½³ã€‚</p><p>â€‹        æŸäº›è§‚ç‚¹æˆ–é˜è¿°ï¼Œç¬”è€…æ°´å¹³æœ‰é™æ— æ³•ç»™å‡ºæ­£å¼ä¸¥è°¨çš„ç­”æ¡ˆï¼Œå”¯æœ‰å¼•ç”¨æˆ–å‚è€ƒä¼ä¸šå•ä½çš„å®˜ç½‘ä¸å…¶ä»–å‰è¾ˆçš„æè¿°ã€‚æœ¬æ–‡æŸäº›å†…å®¹æ¥è‡ªä»¥ä¸‹æ–‡ç« ï¼š**</p><ul><li>lxcå®˜ç½‘ï¼š<a href="https://linuxcontainers.org/lxc">https://linuxcontainers.org/lxc</a></li><li>PolarSPARCæ–‡ç« ï¼š<a href="https://www.polarsparc.com/xhtml/LXC.html">https://www.polarsparc.com/xhtml/LXC.html</a></li><li>csdnåšå®¢ï¼š<a href="https://blog.csdn.net/qq_44281591/article/details/132251767">https://blog.csdn.net/qq_44281591/article/details/132251767</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>k8säº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼€æºå®¹å™¨è¿è¡Œæ—¶ LXC å®¹å™¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024å¹´å†¬å­£å²³éº“å±±éšæ‹</title>
    <link href="/2024/12/27/2024%E5%B9%B4%E5%86%AC%E5%AD%A3%E5%B2%B3%E9%BA%93%E5%B1%B1%E9%9A%8F%E6%8B%8D/"/>
    <url>/2024/12/27/2024%E5%B9%B4%E5%86%AC%E5%AD%A3%E5%B2%B3%E9%BA%93%E5%B1%B1%E9%9A%8F%E6%8B%8D/</url>
    
    <content type="html"><![CDATA[<p>â€‹æœŸé—´æœ‰ä¸‰å¯¹ç”·å¥³çœ‹è‡ªå·±æ‹¿ç›¸æœºåœ¨æ‹ç…§ï¼Œæ‰¾ç¬”è€…å¸®ä»–ä»¬æ‹æ‘„ç…§ç‰‡ï¼Œä½†æ˜¯ç”¨ä»–ä»¬è‡ªå·±çš„æ‰‹æœºæ‹æ‘„çš„ï¼Œå¯¹æ–¹è§‰å¾—æ‹å¾—ä¸é”™å¾ˆå¥½ï¼Œå…¶ä¸­ä¸¤å¯¹è‡ªå·±ä¹Ÿè§‰å¾—æ‹å¾—ä¸é”™ã€‚</p><p>â€‹ä¸‹æ¬¡å†å»é‡ä¸Šæ­¤ç±»æƒ…å†µï¼Œå°è¯•å¾æ±‚å¯¹æ–¹æ„è§â€œç”¨ä»–ä»¬æ‰‹æœºæ‹æ‘„çš„åŒæ—¶ï¼Œèƒ½å¦ç”¨è‡ªå·±çš„ç›¸æœºæ‹æ‘„å‡ å¼ â€ï¼Œå¸Œæœ›èƒ½å¢åŠ è‡ªå·±çš„æ‘„å½±å®è·µç»éªŒã€æå‡è‡ªå·±çš„æ‘„å½±å®è·µæ°´å¹³ã€‚</p><p>â€‹è®°å½•ä¸‹å½“å¤©è‡ªå·±æ‹æ‘„çš„ç…§ç‰‡ï¼Œä½¿ç”¨çš„æ˜¯å…¥é—¨çº§ç›¸æœºCanon EOS800Dï¼Œæœ‰æ—¶æ„Ÿè§‰æœ‰è´­ç½®æ–°ç›¸æœºçš„æƒ³æ³•äº†ï¼Œå­˜é’±ä¸­ã€‚</p><p>â€‹        ä»¥åå¯èƒ½ä¼šå°è¯•æ¥æ‹ç…§ç‰‡ï¼Œå‘¨æœ«æœ‰ç©ºå¯çº¦ã€‚å¯èƒ½ä¹Ÿæ˜¯ä¸ºè‡ªå·±ä»¥åå¤±ä¸šäº†æå‰æ‰¾ä¸€ä»½å…¼èŒå§ã€‚</p><p>â€‹ä¸Šä¼ åˆ°ä¸ªäººåšå®¢çš„å­˜å‚¨ä¸­æ—¶ï¼ŒåŸå›¾æ–‡ä»¶å¤ªå¤§ä¸Šä¼ å¤±è´¥ï¼Œå·²ç»ä¸Šä¼ å‹ç¼©åçš„ç…§ç‰‡ï¼Œæ‰€ä»¥æœ‰ç‚¹æ¨¡ç³Šã€‚ä¸ªäººå¾®ä¿¡å…¬ä¼—å·jxytalkä¸Šå¯æŸ¥çœ‹è¾ƒæ¸…æ™°å›¾ç‰‡</p><p><img src="https://s2.loli.net/2024/12/27/5EaXTVwqNidM8zt.jpg" alt="å¾®ä¿¡å›¾ç‰‡_20241227234958"></p><p><img src="https://s2.loli.net/2024/12/27/MDNIh8ftJyZkzAW.png" alt="image-20241227235403300"></p><p><img src="https://s2.loli.net/2024/12/27/3gK6UHwdayfVzib.png" alt="image-20241227235434207"></p><p><img src="https://s2.loli.net/2024/12/27/dqBT4nRHNVZwSIi.png" alt="image-20241227235442742"></p><p><img src="https://s2.loli.net/2024/12/27/s5yMZdgelYNFntv.png" alt="image-20241227235453122"></p><p><img src="https://s2.loli.net/2024/12/27/B7Hr5xMS8ZVuFf3.png" alt="image-20241227235459299"></p><p><img src="https://s2.loli.net/2024/12/27/DQfHimj78XWw9Rp.png" alt="image-20241227235507944"></p><p><img src="https://s2.loli.net/2024/12/27/quXoyQ8ws9Kc5MV.png" alt="image-20241227235513687"></p>]]></content>
    
    
    
    <tags>
      
      <tag>å²³éº“å±±é™„è¿‘ éšæ‹ ä½³èƒ½EOS800D</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è‡ªå·±æäº¤çš„PRè¢«å¼€æºé¡¹ç›®HAMiåˆå…¥ä¸»çº¿åˆ†æ”¯äº†</title>
    <link href="/2024/12/27/%E8%87%AA%E5%B7%B1%E6%8F%90%E4%BA%A4%E7%9A%84PR%E8%A2%AB%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AEHAMi%E5%90%88%E5%85%A5%E4%B8%BB%E7%BA%BF%E5%88%86%E6%94%AF%E4%BA%86/"/>
    <url>/2024/12/27/%E8%87%AA%E5%B7%B1%E6%8F%90%E4%BA%A4%E7%9A%84PR%E8%A2%AB%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AEHAMi%E5%90%88%E5%85%A5%E4%B8%BB%E7%BA%BF%E5%88%86%E6%94%AF%E4%BA%86/</url>
    
    <content type="html"><![CDATA[<h1 id="1-è‡ªå·±æäº¤çš„PRè¢«æ¥çº³"><a href="#1-è‡ªå·±æäº¤çš„PRè¢«æ¥çº³" class="headerlink" title="1 è‡ªå·±æäº¤çš„PRè¢«æ¥çº³"></a>1 è‡ªå·±æäº¤çš„PRè¢«æ¥çº³</h1><p>â€‹æ˜¨å¤©ï¼Œè‡ªå·±åœ¨ä¸¤ä¸ªæœˆå‰æäº¤çš„PRç»ˆäºè¢«å¼€æºé¡¹ç›®HAMiæ¥çº³ï¼Œå¹¶è¢«åˆå¹¶åˆ°masteråˆ†æ”¯ä¸­ã€‚è™½ç„¶æäº¤çš„PRä¸­æ¶‰åŠçš„å†…å®¹å¹¶ä¸æ˜¯å¼€æºé¡¹ç›®å…³é”®åŠŸèƒ½ï¼Œä½†è‡ªå·±è¿˜æ˜¯å¾ˆé«˜å…´èƒ½èƒ½å¤Ÿå‚ä¸åˆ°å¼€æºé¡¹ç›®çš„å­¦ä¹ ä¸è´¡çŒ®ä¸­æ¥<img src="https://s2.loli.net/2024/12/27/ZEwbWv3zUKJY4jQ.png" alt="å›¾ç‰‡" style="zoom:25%;" />ã€‚</p><p>â€‹ç°åœ¨ä»é¡¹ç›®ä¸»é¡µâ€œ<a href="https://github.com/Project-HAMi/HAMi%E2%80%9D%E4%B8%8B%E9%9D%A2%E2%80%9CMonitor%EF%BC%88%E5%AF%B9%E5%BA%94%E7%9A%84%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3%E6%98%BE%E7%A4%BA%E7%9A%84%E6%98%AF%E2%80%9C%E7%9B%91%E6%8E%A7%E2%80%9D%EF%BC%89%E2%80%9D%E7%9B%91%E6%8E%A7%E7%9B%B8%E5%85%B3%E7%AB%A0%E8%8A%82%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E6%88%91%E6%8F%90%E4%BA%A4%E7%9A%84%E5%86%85%E5%AE%B9%EF%BC%8C%E8%8B%B1%E6%96%87%E7%89%88%E6%9C%AC%E4%B8%8E%E4%B8%AD%E6%96%87%E7%89%88%E6%9C%AC%E9%83%BD%E6%9C%89%E3%80%82">https://github.com/Project-HAMi/HAMiâ€ä¸‹é¢â€œMonitorï¼ˆå¯¹åº”çš„ä¸­æ–‡æ–‡æ¡£æ˜¾ç¤ºçš„æ˜¯â€œç›‘æ§â€ï¼‰â€ç›‘æ§ç›¸å…³ç« èŠ‚å¯ä»¥çœ‹åˆ°æˆ‘æäº¤çš„å†…å®¹ï¼Œè‹±æ–‡ç‰ˆæœ¬ä¸ä¸­æ–‡ç‰ˆæœ¬éƒ½æœ‰ã€‚</a></p><p>â€‹å¦‚ä¸‹æ˜¯æ˜¨å¤©è‡ªå·±é‚®ç®±æ”¶åˆ°çš„PRè¢«åˆå¹¶é€šçŸ¥æˆªå›¾ï¼š</p><img src="https://s2.loli.net/2024/12/27/UoTaVOwJqKRDEr2.png" alt="image-20241227231818630" style="zoom:50%;" /><p>â€‹å¦‚ä¸‹æ˜¯PRæœ€åè¢«åˆå¹¶åˆ°ä¸»çº¿åˆ†æ”¯æ—¶çš„ç›¸å…³æˆªå›¾ï¼š</p><img src="https://s2.loli.net/2024/12/27/TpoA678XsS31qHe.png" alt="image-20241227231833699" style="zoom:50%;" /><h1 id="2-è‡ªå·±æäº¤çš„PRä¸­æ¶‰åŠçš„å†…å®¹"><a href="#2-è‡ªå·±æäº¤çš„PRä¸­æ¶‰åŠçš„å†…å®¹" class="headerlink" title="2 è‡ªå·±æäº¤çš„PRä¸­æ¶‰åŠçš„å†…å®¹"></a>2 è‡ªå·±æäº¤çš„PRä¸­æ¶‰åŠçš„å†…å®¹</h1><p>â€‹PRé“¾æ¥æ˜¯ï¼š<a href="https://github.com/Project-HAMi/HAMi/pull/543">https://github.com/Project-HAMi/HAMi/pull/543</a>. å…¶ä¸­ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªæ–‡æ¡£ï¼ˆä¸€ä¸ªè‹±æ–‡ï¼Œä¸€ä¸ªä¸­æ–‡ï¼‰ï¼Œæè¿°çš„æ˜¯å¦‚ä½•è¿›è¡Œåœ¨K8S&#x2F;prometheus&#x2F;grafanaä¸­è¿›è¡Œå®‰è£…é…ç½®ï¼Œå®ç°å¯¹HAMié¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„å„ç±»GPUæˆ–åŠ é€Ÿå¡èµ„æºåŠå…¶è™šæ‹ŸåŒ–çš„è™šæ‹Ÿèµ„æºè¿›è¡Œç›‘æ§ã€‚</p><p>â€‹è‹±æ–‡ç‰ˆæœ¬å¦‚ä¸‹ï¼šGrafana dashboard exampleï¼ˆ<a href="https://github.com/Project-HAMi/HAMi/blob/master/docs/dashboard.md%EF%BC%89">https://github.com/Project-HAMi/HAMi/blob/master/docs/dashboard.mdï¼‰</a> </p><p>â€‹ä¸­æ–‡ç‰ˆæœ¬å¦‚ä¸‹ï¼šGrafana ä»ªè¡¨æ¿ç¤ºä¾‹ï¼ˆ<a href="https://github.com/Project-HAMi/HAMi/blob/master/docs/dashboard.md%EF%BC%89">https://github.com/Project-HAMi/HAMi/blob/master/docs/dashboard.mdï¼‰</a></p><img src="https://s2.loli.net/2024/12/27/KnjOdTsXoFVpJRb.png" alt="image-20241227231926974" style="zoom:50%;" /><h1 id="3-å¤‡æ³¨ä¸è‡´è°¢"><a href="#3-å¤‡æ³¨ä¸è‡´è°¢" class="headerlink" title="3 å¤‡æ³¨ä¸è‡´è°¢"></a>3 å¤‡æ³¨ä¸è‡´è°¢</h1><p>â€‹æ–‡æ¡£ä¸­ä½¿ç”¨çš„grafanaè§†å›¾ä¸»è¦ç”± fangfenghuangï¼Œè‡ªå·±åœ¨å…¶grafanaè§†å›¾çš„åŸºç¡€ä¸Šè¿›è¡Œäº†å°‘é‡ä¿®æ”¹ä¸è¯´æ˜ï¼Œå¹¶é‡æ–°å‘å¸ƒäº†proemtheusç¤¾åŒºã€‚åŒæ—¶æ„Ÿè°¢å…¶å¯¹æˆ‘ç¬¬ä¸€æ¬¡æäº¤PRæ—¶ç»™äºˆçš„å¸®æŒ‡å¯¼ã€‚</p><p>â€‹å¦å¤–æ„Ÿè°¢HAMiå¼€æºè´¡çŒ®è€…æˆ–çˆ±å¥½è€… yxl ä¸ fangfenghuang çš„è¯„å®¡ï¼Œè¿˜æœ‰HAMiå®˜æ–¹ç¤¾åŒºå¼€å‘ç»´æŠ¤äººå‘˜ Nimbus318 çš„è¯„å®¡ã€‚æœ€åæ„Ÿè°¢ wawa0210 æ‰§è¡Œçš„åˆå¹¶ã€‚</p><p>â€‹æ„Ÿè°¢å¤§å®¶æä¾›çš„å¸®å¿™ï¼Œè‡ªå·±å°†ç»§ç»­å­¦ä¹ å’Œå‚ä¸æ­¤å¼€æºé¡¹ç›®çš„è´¡çŒ®<img src="https://s2.loli.net/2024/12/27/CgX47TU3a1FGP5R.png" alt="å›¾ç‰‡" style="zoom:25%;" /></p>]]></content>
    
    
    <categories>
      
      <category>ç®—åŠ›è™šæ‹ŸåŒ–ä¸­é—´ä»¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HAMi æäº¤PR åˆå¹¶ å¼€æºè´¡çŒ®</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®¹å™¨è¿è¡Œæ—¶çš„å®šä¹‰ã€åˆ†ç±»ã€å†å²ä¸ç®€ä»‹</title>
    <link href="/2024/12/23/%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6%E7%9A%84%E5%AE%9A%E4%B9%89%E3%80%81%E5%88%86%E7%B1%BB%E3%80%81%E5%8E%86%E5%8F%B2%E4%B8%8E%E7%AE%80%E4%BB%8B/"/>
    <url>/2024/12/23/%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6%E7%9A%84%E5%AE%9A%E4%B9%89%E3%80%81%E5%88%86%E7%B1%BB%E3%80%81%E5%8E%86%E5%8F%B2%E4%B8%8E%E7%AE%80%E4%BB%8B/</url>
    
    <content type="html"><![CDATA[<p>â€‹æœ¬æ–‡70%å·¦å³å†…å®¹æ¥è‡ªå¯¹è‹±æ–‡æ–‡ç«  â€œ<a href="https://www.capitalone.com/tech/cloud/container-runtime/%E2%80%9D">https://www.capitalone.com/tech/cloud/container-runtime/â€</a> çš„ç¿»è¯‘ã€‚ç¬”è€…é¦–å…ˆçœ‹åˆ°æ–‡ç«  â€œ<a href="https://www.zhangjiee.com/blog/2021/container-runtime.html%E2%80%9D">https://www.zhangjiee.com/blog/2021/container-runtime.htmlâ€</a> ï¼Œå‘ç°æ­¤æ–‡æ˜¯å¯¹ä¸Šè¿°æ–‡ç« çš„å®Œå…¨ç¿»è¯‘ï¼Œå› ä¸ºç¬”è€…ä¸ªäººè§‰å¾—æ­¤ä¸­æ–‡æ–‡ç« ä¸€äº›åœ°æ–¹ç¿»è¯‘å¾—ä¸å¤Ÿå‡†ç¡®ä¸ä¸å¤Ÿå¯è¯»ï¼Œæ‰€ä»¥ç¬”è€…ä¸ªäººå°è¯•å¯¹ä¸Šè¿°è‹±æ–‡æ–‡ç« è¿›è¡Œäº†å†æ¬¡ç¿»è¯‘ï¼ŒåŒæ—¶åœ¨å…¶ä¸­æŸäº›æ®µè½æ’å…¥äº†ä¸€äº›è‡ªå·±ç¼–è¾‘çš„å›¾æ–‡ï¼Œä»¥æ›´å¥½åœ°ç†è§£ç›¸å…³æ¦‚å¿µï¼Œåœ¨æ­¤åšä¸‹è®°å½•ä»¥å¤‡åç»­å›å¿†ä¸å­¦ä¹ ã€‚</p><h1 id="1-å®¹å™¨è¿è¡Œæ—¶çš„å®šä¹‰"><a href="#1-å®¹å™¨è¿è¡Œæ—¶çš„å®šä¹‰" class="headerlink" title="1 å®¹å™¨è¿è¡Œæ—¶çš„å®šä¹‰"></a>1 å®¹å™¨è¿è¡Œæ—¶çš„å®šä¹‰</h1><p>â€‹å®¹å™¨æœ¬è´¨ä¸Šæ˜¯ç”±å‡ ä¸ªåº•å±‚çš„å†…æ ¸åŸè¯­ç›¸å…³ç»„ä»¶æ†ç»‘åœ¨ä¸€èµ·ç»„æˆï¼Œæ¯æ¬¡åˆ›å»ºéš”ç¦»è¿›ç¨‹æ—¶ï¼Œéƒ½ä¸éœ€è¦æ‰‹åŠ¨éš”ç¦»ã€è‡ªå®šä¹‰å‘½åç©ºé—´ç­‰ï¼ŒæŠŠè¿™äº›ç»„ä»¶æ†ç»‘åœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå®¹å™¨ã€‚å®¹å™¨è¿è¡Œæ—¶å°±æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œè¿™ä¸ªå·¥å…·å°†è¿™äº›ç»„ä»¶ä»¥ä¸€èµ·æœ‰åºé«˜æ•ˆåœ°æ–¹å¼ç»„åˆèµ·æ¥ï¼Œä»è€Œæ„å»ºã€ç®¡ç†ä¸é”€æ¯ä¸€ä¸ªéš”ç¦»çš„ã€å®‰å…¨çš„æ‰§è¡Œç¯å¢ƒï¼ˆå³å®¹å™¨ï¼‰ï¼Œè®©ç”¨æˆ·ä¸å†éœ€è¦æ‰‹åŠ¨éš”ç¦»ã€è‡ªå®šä¹‰å‘½åç©ºé—´ç­‰ï¼ŒåŒæ—¶èƒ½å¤Ÿä»¥ä¸€ç§ç®€æ´æ–¹ä¾¿çš„æ–¹å¼å»å¯¹å®¹å™¨çš„æ•´ä¸ªå‘¨æœŸè¿›è¡Œç®¡ç†ã€‚</p><p>â€‹éšç€æŠ€æœ¯çš„å‘å±•å’Œè¿­ä»£ï¼Œå®ƒä»¬çš„è¿è¡Œæ—¶ä¹Ÿåœ¨éšç€å˜åŒ–ã€‚</p><h1 id="2-å®¹å™¨è¿è¡Œæ—¶çš„æ—©æœŸå†å²"><a href="#2-å®¹å™¨è¿è¡Œæ—¶çš„æ—©æœŸå†å²" class="headerlink" title="2 å®¹å™¨è¿è¡Œæ—¶çš„æ—©æœŸå†å²"></a>2 å®¹å™¨è¿è¡Œæ—¶çš„æ—©æœŸå†å²</h1><p>â€‹éšç€æŠ€æœ¯çš„å‘å±•å’Œè¿­ä»£ï¼Œå®ƒä»¬çš„è¿è¡Œæ—¶ä¹Ÿåœ¨éšç€å˜åŒ–ã€‚</p><p>â€‹è‡ªä»2007å¹´cgroupè¢«åŠ å…¥Linuxå†…æ ¸åï¼Œè®¯é€Ÿå‡ºç°äº†å‡ ä¸ªåˆ©ç”¨åŒ…æ‹¬cgroupå‘½åç©ºé—´åœ¨å†…çš„7ä¸ªLinuxå‘½åç©ºé—´çš„é¡¹ç›®ï¼Œè¿™äº›é¡¹ç›®éƒ½æ˜¯çš„ç›®çš„éƒ½æ˜¯ä¸ºäº†åˆ›å»ºå®¹å™¨åŒ–è¿›ç¨‹ã€‚è¿™äº›é¡¹ç›®ä¸»è¦å¦‚ä¸‹å‡ ä¸ªï¼š</p><ul><li>LXCï¼ˆ<a href="https://linuxcontainers.org/lxc/%EF%BC%89">https://linuxcontainers.org/lxc/ï¼‰</a></li><li>LMCTFYï¼ˆ<a href="https://github.com/google/lmctfy%EF%BC%89">https://github.com/google/lmctfyï¼‰</a></li><li>systemd-nspawnï¼ˆ<a href="https://www.freedesktop.org/software/systemd/man/systemd-nspawn.html%EF%BC%89">https://www.freedesktop.org/software/systemd/man/systemd-nspawn.htmlï¼‰</a></li><li>rktï¼ˆ<a href="https://github.com/rkt/rkt%EF%BC%89">https://github.com/rkt/rktï¼‰</a></li></ul><h2 id="LXCå³Linux-Containers"><a href="#LXCå³Linux-Containers" class="headerlink" title="LXCå³Linux Containers"></a>LXCå³Linux Containers</h2><p>â€‹LXCæ˜¯åœ¨crgoupè¢«å¼•å…¥Linuxå†…æ ¸åç«‹å³è¢«åˆ›å»ºçš„é¡¹ç›®ï¼Œå®ƒè¢«è®¾è®¡ç”¨äºâ€full-systemâ€ å®¹å™¨ï¼Œæ˜¯ç”¨æ¥åˆ›å»ºLinuxå®¹å™¨çš„ï¼Œæ­¤æ—¶çš„Linuxå®¹å™¨è·Ÿæˆ‘ä»¬ç°åœ¨å¸¸ç”¨çš„Linuxä¸ŠDockerå®¹å™¨æˆ–containerdå®¹å™¨æ˜¯æœ‰åŒºåˆ«çš„ï¼Œæœ€æ˜¾è‘—çš„åŒºåˆ«åœ¨äºå®ƒä»¬ä½¿ç”¨ä¸æ˜¯å®¹å™¨è¿è¡Œæ—¶ä¸åŒã€‚åŒæ—¶Systemdä¹Ÿè·å¾—äº†ç±»ä¼¼çš„å®¹å™¨æ”¯æŒï¼Œsystemd-nspawnå¯ä»¥è¿è¡Œå‘½åç©ºé—´è¿›ç¨‹ï¼Œsystemdæœ¬èº«å¯ä»¥æ§åˆ¶cgroupã€‚å°½ç®¡lxcä¸systemd-nspawnä¹Ÿåœ¨å…¶ä»–é¡¹ç›®ä¸­è¢«åˆ©ç”¨åˆ°äº†ï¼Œä½†å®ƒä»¬è¿˜æ˜¯æ²¡æœ‰èƒ½å¤Ÿå¸å¼•è¶³å¤Ÿå¤šçš„ç»ˆç«¯ç”¨æˆ·ã€‚ç›´åˆ°ç°åœ¨ä¹Ÿæ˜¯ä¸€ä¸ªä¸æµè¡Œçš„å¼€æºå®¹å™¨åŒ–é¡¹ç›®ã€‚</p><h2 id="dotCloudå³åæ¥çš„Dockerï¼‰"><a href="#dotCloudå³åæ¥çš„Dockerï¼‰" class="headerlink" title="dotCloudå³åæ¥çš„Dockerï¼‰"></a>dotCloudå³åæ¥çš„Dockerï¼‰</h2><p>â€‹dotCloudï¼ˆå®ƒå°±æ˜¯ç°åœ¨çš„Dockerå…¬å¸çš„å‰èº«ï¼‰å¼€å§‹å›´ç»•LXCå¼€å‘å„ç§å·¥å…·ä»¥ä½¿å®¹å™¨å¯¹å¼€å‘äººå‘˜ä¸ç”¨æˆ·ä½“éªŒæ›´å‹å¥½ã€‚ä½†ä¸ä¹…åï¼ŒdotCloudæŠ›å¼ƒäº†LXCï¼Œåˆ›å»ºäº† å¼€æ”¾å®¹å™¨å€¡è®®ï¼ˆOCIï¼Œ <a href="https://github.com/opencontainers/runtime-spec">https://github.com/opencontainers/runtime-spec</a> ï¼‰æ¥å»ºç«‹ä¸šå†…å®¹å™¨æ ‡å‡†ï¼Œå¹¶å°†ä¸€äº›å®¹å™¨ç»„ä»¶å¼€æºä¸º libcontainerï¼ˆåœ°å€ï¼š <a href="https://github.com/docker-archive/libcontainer">https://github.com/docker-archive/libcontainer</a> ï¼‰ é¡¹ç›®ã€‚</p><h2 id="LMCTFY"><a href="#LMCTFY" class="headerlink" title="LMCTFY"></a>LMCTFY</h2><p>â€‹Googleå¼€æºä¹Ÿå…¶å†…éƒ¨å®¹å™¨æŠ€æœ¯æ ˆçš„å¼€æºç‰ˆæœ¬ï¼šLMCTFYï¼ˆ <a href="https://github.com/google/lmctfy">https://github.com/google/lmctfy</a> ï¼‰ã€‚ä½†éšç€dotCloudï¼ˆåæ¥æ”¹åä¸ºDockerï¼‰å˜å¾—æµè¡Œèµ·æ¥ï¼ŒLMCTFY é¡¹ç›®æœ€ç»ˆè¢«æŠ›å¼ƒï¼ŒLMCTFY é¡¹ç›®ä¸­çš„ç»å¤§éƒ¨åˆ†åŠŸèƒ½ä¹Ÿè¢«å…¶å¼€å‘äººå‘˜å¤åˆ¶èå…¥åˆ°äº†Dockerçš„å¼€æºé¡¹ç›®libcontainer ä¸­ã€‚</p><h2 id="rktä¸appc"><a href="#rktä¸appc" class="headerlink" title="rktä¸appc"></a>rktä¸appc</h2><p>â€‹CoreOSèµ·åˆåœ¨å…¶Containerd Linuxäº§å“ä¸­åªä½¿ç”¨DockeræŠ€æœ¯æ ˆï¼Œä¸€æ®µæ—¶é—´åä¹Ÿå‘è¡Œäº†ä¸€ä¸ªåä¸ºrkt é¡¹ç›®ï¼ˆ <a href="https://github.com/rkt/rkt">https://github.com/rkt/rkt</a> ï¼‰ä½œä¸ºDockerçš„æ›¿ä»£å“ã€‚åœ¨å½“æ—¶ï¼Œrktæå‰å…·å¤‡äº†åŒºåˆ«äºDockerä¸å…¶ä»– æ—©æœŸå®¹å™¨è¿è¡Œæ—¶çš„ç‰¹æ€§ã€‚å®ƒä¸éœ€è¦ä»¥rootç”¨æˆ·è¿è¡Œã€æ²¡æœ‰å®ˆæŠ¤è¿›ç¨‹ã€æ˜¯CLIé©±åŠ¨çš„ï¼ŒåŒæ—¶å®ƒä¹Ÿå…·æœ‰ä¸€äº›ç‹¬åˆ°ç‰¹æ€§å¦‚åŠ å¯†éªŒè¯å’Œå®Œå…¨çš„ Docker é•œåƒå…¼å®¹ã€‚  ä»¤äººæƒ‹æƒœåœ°æ˜¯ï¼Œåœ¨Docker åˆ›å»º å¼€æ”¾å®¹å™¨å€¡è®®ï¼ˆOCIï¼Œ <a href="https://github.com/opencontainers/runtime-spec">https://github.com/opencontainers/runtime-spec</a> ï¼‰ä¹‹å‰ï¼ŒCoreOSå‘å¸ƒäº†ä¸€ä¸ªå«åš appc çš„å®¹å™¨æ ‡å‡†ã€‚ä½†æŠ—ä¸ä½åèµ·è¿™ç§€ OCI åœ¨å…¨çƒèŒƒå›´å†…çš„æµè¡Œï¼ŒCoreOSæœ€ç»ˆæ”¾å¼ƒäº†appc è½¬è€Œæ”¯æŒ OCIï¼Œå¹¶å°†appcçš„éƒ¨åˆ†ç‰¹æ€§åŠŸèƒ½ä¹Ÿæäº¤ç»™ OCI ã€‚è‡³æ­¤ï¼Œrktä¸appcæœ€ç»ˆéƒ½è¢«æŠ›å¼ƒã€‚</p><p>â€‹ç›´è‡³Kubernetes1.24ä¹‹å‰ï¼ŒOCI æˆä¸ºå¹¶ä¸€ç›´æ˜¯ä¸šç•Œæœ€æµè¡Œçš„å®¹å™¨æ ‡å‡†ã€‚</p><h1 id="3-å®¹å™¨è¿è¡Œæ—¶çš„æ±‡æ€»"><a href="#3-å®¹å™¨è¿è¡Œæ—¶çš„æ±‡æ€»" class="headerlink" title="3 å®¹å™¨è¿è¡Œæ—¶çš„æ±‡æ€»"></a>3 å®¹å™¨è¿è¡Œæ—¶çš„æ±‡æ€»</h1><p>â€‹å½“å‰å®¹å™¨è¿è¡Œæ—¶æœ‰å¤šç§ç±»å‹ï¼Œä½†å®ƒä»¬å¯ä»¥è¢«åˆ†ä¸¤å¤§ç±»ï¼šOCI è¿è¡Œæ—¶å’Œ CRIï¼ˆå®¹å™¨è¿è¡Œæ¥å£ï¼‰ã€‚</p><p><img src="https://s2.loli.net/2024/12/23/qo9kmvG7t1JLrny.png" alt="image-20241223205205598"></p><h1 id="4-å¼€æ”¾å®¹å™¨è§„èŒƒï¼ˆOCIï¼‰"><a href="#4-å¼€æ”¾å®¹å™¨è§„èŒƒï¼ˆOCIï¼‰" class="headerlink" title="4 å¼€æ”¾å®¹å™¨è§„èŒƒï¼ˆOCIï¼‰"></a>4 å¼€æ”¾å®¹å™¨è§„èŒƒï¼ˆOCIï¼‰</h1><p>â€‹æœ‰æ—¶ç§°ä¸ºä½çº§åˆ«è¿è¡Œæ—¶ï¼Œå®ç° OCI è¿è¡Œæ—¶è§„èŒƒä¸“æ³¨äºç®¡ç†å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä¸”æ— éœ€å…¶å®ƒæ“ä½œã€‚ ä½çº§åˆ«è¿è¡Œæ—¶åˆ›å»ºå’Œè¿è¡Œå®¹å™¨ã€‚</p><p>â€‹éšç€æŠ€æœ¯çš„å‘å±•å’Œè¿­ä»£ï¼Œå®ƒä»¬çš„è¿è¡Œæ—¶ä¹Ÿåœ¨éšç€å˜åŒ–ã€‚</p><h2 id="æœ¬åœ°è¿è¡Œæ—¶"><a href="#æœ¬åœ°è¿è¡Œæ—¶" class="headerlink" title="æœ¬åœ°è¿è¡Œæ—¶"></a>æœ¬åœ°è¿è¡Œæ—¶</h2><p>â€‹æœ¬åœ°å®¹å™¨è¿è¡Œæ—¶åœ¨åŒä¸€ä¸ªä¸»æœºå†…æ ¸ä¸Šè¿è¡Œå®¹å™¨åŒ–è¿›ç¨‹ã€‚æ—©æœŸå‡ºç°çš„æœ‰è¾ƒå¤§å½±å“åŠ›çš„æœ¬åœ°å®¹å™¨è¿è¡Œæ—¶æœ‰å¦‚ä¸‹ï¼Œå®ƒä»¬å½“ä¸­çš„å…¶ä¸­æŸäº›ä»ç„¶åœ¨è¢«å¹¿æ³›ä½¿ç”¨ã€‚</p><p>â€‹runCæ˜¯Dockeråœ¨å¼€æºé¡¹ç›®libcontainerä¸å¼€æ”¾å®¹å™¨è§„èŒƒOCIæ‰€æœ‰å·¥ä½œçš„ç»“æ™¶ã€‚å®ƒæ˜¯äº‹å®ä¸Šçš„æ ‡å‡†ä½çº§è¿è¡Œæ—¶ï¼Œç”±Goè¯­è¨€å®ç°å¹¶ç”±Dockerä¸‹çš„å¼€æºé¡¹ç›®mobyç»´æŠ¤ã€‚</p><p>â€‹Railcaræ˜¯ä¸€ä¸ªç”±Oracleåˆ›å»ºçš„OCIè¿è¡Œæ—¶å®ç°ã€‚å®ƒæ˜¯ç”¨Rustè¯­è¨€å®ç°çš„ï¼Œå¯¹äºä¸å†…æ ¸æ‰§è¡Œä½çº§çš„äº¤äº’æ“ä½œçš„å®¹å™¨è¿è¡Œæ—¶ç»„ä»¶æ¥è¯´ï¼Œä¸runCçš„Goè¯­è¨€ä»£ç ç›¸æ¯”ä¹‹ä¸‹ï¼ŒRustæ˜¯ä¸€é—¨æ›´åŠ ä¼˜ç§€çš„è¯­è¨€ã€‚ä½†ä¸å¹¸åœ°æ˜¯Railcar å·²ç»è¢«æŠ›å¼ƒäº†ã€‚</p><p>â€‹crunæ˜¯ä¸€ä¸ªç”±Redhatå¼•é¢†çš„OCIè¿è¡Œæ—¶å®ç°ã€‚å®ƒæ˜¯containers projectï¼ˆ <a href="https://github.com/containers">https://github.com/containers</a> ï¼‰ çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯libpodçš„å§Šå¦¹é¡¹ç›®ã€‚æ˜¯ç”±Cè¯­è¨€å®ç°çš„ï¼Œå…·æœ‰æ€§èƒ½å¥½ã€è½»é‡çº§ç­‰ç‰¹ç‚¹ï¼Œæ˜¯ç¬¬ä¸€æ‰¹æ”¯æŒ cgroups v2ï¼ˆ <a href="https://medium.com/nttlabs/cgroup-v2-596d035be4d7">https://medium.com/nttlabs/cgroup-v2-596d035be4d7</a> ï¼‰ çš„å®¹å™¨è¿è¡Œæ—¶ä¹‹ä¸€ã€‚</p><p>â€‹rktä¸æ˜¯ä¸€ä¸ªOCIè¿è¡Œæ—¶å®ç°ï¼Œä½†æ˜¯å®ƒæ˜¯ä¸€ä¸ªç±»ä½çº§å®¹å™¨è¿è¡Œæ—¶ã€‚é™¤äº†æ”¯æŒappcè½¯ä»¶é›†å¤–ï¼Œå®ƒè¿˜æ”¯æŒè¿è¡ŒDockerä¸OCIé•œåƒï¼Œä½†å®ƒä¸èƒ½ä¸ä½¿ç”¨OCIè¿è¡Œæ—¶çš„æ›´é«˜çº§ç»„ä»¶è¿›è¡Œäº¤äº’ã€‚</p><p>â€‹ä»ç°æœ‰å®¹å™¨è¿è¡Œæ—¶æ¥çœ‹ï¼Œä½çº§å®¹å™¨è¿è¡Œæ—¶åªæœ‰åœ¨å®¹å™¨åˆ›å»ºä¸åˆ é™¤é˜¶æ®µæ‰æ˜¾å¾—å°¤ä¸ºé‡è¦ï¼Œä¸€æ—¦ç›¸å…³è¿›ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œä½çº§å®¹å™¨è¿è¡Œæ—¶å°±ä¸å†è¢«é‡è¦å…³æ³¨äº†å³å°†å®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€ä¸­æ—¶ä½çº§å®¹å™¨è¿è¡Œæ—¶æ˜¾å¾—ä¸é‚£ä¹ˆé‡è¦äº†ã€‚</p><h2 id="æ²™ç®±å’Œè™šæ‹ŸåŒ–è¿è¡Œæ—¶"><a href="#æ²™ç®±å’Œè™šæ‹ŸåŒ–è¿è¡Œæ—¶" class="headerlink" title="æ²™ç®±å’Œè™šæ‹ŸåŒ–è¿è¡Œæ—¶"></a>æ²™ç®±å’Œè™šæ‹ŸåŒ–è¿è¡Œæ—¶</h2><p>â€‹å¯¹äºå¼€æ”¾å®¹å™¨è§„èŒƒOCIï¼Œå®ƒä¸ä»…æœ‰æœ¬åœ°è¿è¡Œæ—¶å®ç°æ–¹æ¡ˆï¼Œè¿˜æœ‰è™šæ‹ŸåŒ–æ–¹å‘å®ç°æ–¹æ¡ˆï¼Œæ—©æœŸå‡ºç°çš„è™šæ‹ŸåŒ–å®ç°æ–¹æ¡ˆæœ‰å¦‚ä¸‹ï¼Œå…¶ä¸­æŸäº›å½“å‰ä»è¢«ä½¿ç”¨ä¸­ã€‚</p><p>â€‹gVisorï¼ˆ <a href="https://gvisor.dev/">https://gvisor.dev/</a> ï¼‰ ä¸Nablaï¼ˆ <a href="https://nabla-containers.github.io/">https://nabla-containers.github.io/</a> ï¼‰éƒ½æ˜¯æ²™ç®±è¿è¡Œæ—¶å®ç°æ–¹æ¡ˆï¼Œå®ƒä»¬åœ¨å®¿ä¸»æœºä¸å®¹å™¨è¿›ç¨‹é—´æä¾›äº†æ›´è¿›ä¸€æ­¥çš„éš”ç¦»ã€‚ä¸åƒæœ¬åœ°å®¹å™¨è¿è¡Œæ—¶é‚£æ ·ä¸å®¿ä¸»æœºå…±äº«å†…æ ¸ï¼Œæ­¤æ—¶å®¹å™¨åŒ–è¿›ç¨‹è¿è¡Œåœ¨â€œunikernel or kernel proxyâ€å±‚ï¼Œå®¹å™¨åŒ–è¿›ç¨‹ä¸è¿™ä¸ªå±‚è¿›è¡Œäº¤äº’é€šä¿¡ï¼Œç„¶åå†ç”±è¿™ä¸ªå±‚ä»£è¡¨å®¹å™¨ä¸å®¿ä¸»æœºå†…æ ¸è¿›è¡Œäº¤äº’ã€‚å› ä¸ºå¢åŠ äº†éš”ç¦»ï¼Œè¿™ä¸¤ä¸ªæ²™ç®±è¿è¡Œæ—¶é™ä½äº†æ”»å‡»é¢ï¼Œä½¿å¾—å®¹å™¨åŒ–è¿›ç¨‹å¯¹å®¿ä¸»æœºå®æ–½ç ´åæˆ–ä¸å¾—å½±å“çš„åŠŸèƒ½æ€§æ›´ä½äº†ã€‚</p><p>â€‹runVï¼ˆ <a href="https://github.com/hyperhq/runv">https://github.com/hyperhq/runv</a> ï¼‰ï¼ŒClear ( <a href="https://github.com/clearcontainers">https://github.com/clearcontainers</a> ï¼‰ä¸Kataï¼ˆ <a href="https://github.com/kata-containers">https://github.com/kata-containers</a> ï¼‰éƒ½æ˜¯è™šæ‹ŸåŒ–è¿è¡Œæ—¶ã€‚å®ƒä»¬éƒ½æ˜¯OCIè¿è¡Œæ—¶å®ç°æ–¹æ¡ˆï¼Œåº•å±‚ç”±è™šæ‹Ÿæœºæ¥å£è€Œä¸æ˜¯å®¿ä¸»æœºå†…æ ¸æä¾›æ”¯æŒã€‚å‰ä¸¤è€…å½“å‰å·²ç»è¢«åºŸå¼ƒä¸”å®ƒä»¬ç‰¹æ€§å·²ç»è¢«Kataæ‰€å¸æ”¶ã€‚å®ƒï¼ˆä»¬ï¼‰èƒ½å¤Ÿä½¿ç”¨æ ‡å‡†çš„OCIå®¹å™¨é•œåƒï¼Œä½†åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­åœ¨å®¹å™¨ä¸å®¿ä¸»æœºä¹‹é—´æä¾›äº†å¼ºæœ‰åŠ›çš„éš”ç¦»ï¼Œå®ƒï¼ˆä»¬ï¼‰ä½¿ç”¨ä¸€ä¸ªæ ‡å‡†çš„Linuxå†…æ ¸é•œåƒæ¥å¯åŠ¨ä¸€ä¸ªè½»é‡çº§è™šæ‹Ÿæœºï¼Œç„¶ååœ¨è¿™ä¸ªè™šæ‹Ÿæœºä¸­è¿è¡Œå®¹å™¨åŒ–è¿›ç¨‹ã€‚   </p><p>â€‹ä¸æœ¬åœ°åŒ–è¿è¡Œæ—¶ç›¸æ¯”ï¼Œæ²™ç®±è¿è¡Œæ—¶ä¸è™šæ‹ŸåŒ–è¿è¡Œæ—¶åœ¨å®¹å™¨çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­å¢åŠ äº†æ›´å¤šæ€§èƒ½ä¸Šçš„è´Ÿé¢å½±å“ã€‚åœ¨æ²™ç®±è¿è¡Œæ—¶å®¹å™¨ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªé¢å¤–çš„æŠ½è±¡å±‚å³å®¹å™¨è¿›ç¨‹è¿è¡Œåœ¨æ²™ç®±unikernel&#x2F;proxy å±‚ï¼Œç”±è¿™ä¸ªå±‚æ¥ä¼ é€’å®¹å™¨æŒ‡ä»¤ç»™å®¿ä¸»æœºå†…æ ¸ã€‚ è€Œåœ¨è™šæ‹ŸåŒ–è¿è¡Œæ—¶å®¹å™¨ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªé¢å¤–çš„è™šæ‹ŸåŒ–å±‚å³æ•´ä¸ªå®¹å™¨è¿›ç¨‹éƒ½æ˜¯è¿è¡Œåœ¨è™šæ‹Ÿæœºä¸Šçš„ï¼Œç”±è™šæ‹Ÿæœºå†ä¸å®¿ä¸»æœºå†…æ ¸è¿›è¡Œäº¤äº’ï¼Œè¿™æ¯”æœ¬åœ°è¿è¡Œæ—¶ç›´æ¥ä¸å†…æ ¸è¿›è¡Œäº¤äº’æ›´æ…¢ï¼›å¹¸è¿åœ°æ˜¯ï¼Œä¸“æ³¨äºè™šæ‹ŸåŒ–è¿è¡Œæ—¶ä¸‹å®¹å™¨æ€§èƒ½çš„ AWS Firecracker ï¼ˆ <a href="https://github.com/kata-containers">https://github.com/kata-containers</a> ï¼‰åœ¨è¿™æ–¹é¢åšå‡ºäº†åŠªåŠ›ï¼Œæä¾›çš„è¿™ç§åº•å±‚è™šæ‹Ÿæœºèƒ½å¤Ÿå°½å¯èƒ½åœ°å°†æ€§èƒ½å½±å“é™åˆ°æœ€å°ã€‚</p><p>â€‹ä»¥ä¸‹æ˜¯å¯¹æœ¬åœ°è¿è¡Œæ—¶æ²™ç®±ã€è™šæ‹ŸåŒ–è¿è¡Œæ—¶ä»£è¡¨æ€§å®ç°æ–¹æ¡ˆçš„å¯¹æ¯”ã€‚</p><p><img src="https://s2.loli.net/2024/12/23/atpU5XfLC9Zucbl.png" alt="image-20241223205527496"></p><h1 id="5-å®¹å™¨è¿è¡Œæ—¶æ¥å£ï¼ˆCRIï¼‰"><a href="#5-å®¹å™¨è¿è¡Œæ—¶æ¥å£ï¼ˆCRIï¼‰" class="headerlink" title="5 å®¹å™¨è¿è¡Œæ—¶æ¥å£ï¼ˆCRIï¼‰"></a>5 å®¹å™¨è¿è¡Œæ—¶æ¥å£ï¼ˆCRIï¼‰</h1><p>â€‹å½“Kubernetesï¼ˆ2014å¹´9æœˆç¬¬ä¸€ä¸ªæ­£å¼ç‰ˆæœ¬v0.2ï¼Œ2015å¹´7æœˆv1.0ç‰ˆæœ¬æ­£å¼å‘å¸ƒå¹¶å¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼‰è¿™ä¸€å®¹å™¨ç¼–æ’å·¥å…·å‡ºç°æ—¶ï¼ŒDockerå·²ç»åœ¨ä¸šç•Œå¤§ä¸ºæµè¡Œï¼Œæ˜¯ä¸šç•Œæ ‡å‡†çš„é«˜çº§å®¹å™¨è¿è¡Œæ—¶ï¼Œæ‰€ä»¥å½“æ—¶Kuberneteså½“æ—¶åªèƒ½è¿å°±Dockerï¼Œå°†Dockerè¿™ä¸€é«˜çº§è¿è¡Œæ—¶ç¡¬ç¼–ç åˆ°Kubernetesçš„å®ˆæŠ¤è¿›ç¨‹kubeletä¸­ã€‚ä¹‹åï¼Œéšç€Kubernetesåœ¨ä¸šç•Œçš„å¤§ç«ï¼Œç¤¾åŒºä¸ä¼ä¸šåŠéƒ½äº§ç”Ÿäº†åˆ›å»ºä¸€ä¸ªæ›¿ä»£Dockerè¿™ä¸€é«˜çº§è¿è¡Œæ—¶çš„è¦æ±‚ã€‚</p><p>â€‹å…³äºKuberneteså¼ƒç”¨dockerçš„åŸå› ï¼Œå†…å®¹è¾ƒå¤šï¼Œç¬”è€…æ‰“ç®—å¦åšå­¦ä¹ æ€»ç»“ç„¶ååšè®°å½•ã€‚</p><p>â€‹rktæ˜¯ä¸€ä¸ªå°è¯•è¿™ä¸€è¦æ±‚çš„æ”¯æŒè€…ï¼Œé€šè¿‡å®šåˆ¶åŒ–kubeletçš„ä»£ç äº§ç”Ÿäº†rktletã€‚ä½†æ˜¯ï¼Œè¿™ç§æŒ‰è¿è¡Œæ—¶å®šåˆ¶çš„æ„å»ºè¿‡ç¨‹æ— æ³•æ‰©å±•ï¼Œæ­¤æ—¶ä¹Ÿæ­£å¥½æš´éœ²å‡ºäº†Kubernetesä¸­å¯¹æŠ½è±¡è¿è¡Œæ—¶æ¨¡å‹çš„éœ€æ±‚ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªç—›ç‚¹ï¼ŒHyperã€CoreOSã€Googleå’ŒKubernetesçš„å…¶ä»–èµåŠ©å•†ä¸€èµ·åå•†åˆä½œï¼Œç«™åœ¨å®¹å™¨ç¼–æ’è§’åº¦æ¨å‡ºäº†ä¸€ä¸ªå®¹å™¨è¿è¡Œæ—¶çš„ä¸€ä¸ªé«˜çº§è§„èŒƒå³é«˜çº§å®¹å™¨è¿è¡Œè§„èŒƒï¼Œè¿™ä¸ªè§„èŒƒå°±æ˜¯å®¹å™¨è¿è¡Œæ—¶æ¥å£ï¼ˆè‹±æ–‡åŸåæ˜¯Container Runtime Interfaceï¼Œç®€ç§°CRIï¼Œ <a href="https://kubernetes.io/blog/2016/12/container-runtime-interface-cri-in-kubernetes/">https://kubernetes.io/blog/2016/12/container-runtime-interface-cri-in-kubernetes/</a> ï¼‰ã€‚é€šè¿‡ä¸CRIé›†æˆè€Œä¸æ˜¯ä¸ç‰¹å®šçš„ä½çº§è¿è¡Œæ—¶è€¦åˆï¼Œkubeletä¸éœ€è¦é’ˆå¯¹æ¯ç§ä½çº§è¿è¡Œæ—¶è¿›è¡Œç¡¬ç¼–ç ä¸é‡ç¼–è¯‘ï¼Œå°±å¯ä»¥çµæ´»åœ°æ”¯æŒå¤šä¸ªå®¹å™¨è¿è¡Œæ—¶ã€‚è¿™ä¸ä»…ç¬¦åˆè½¯ä»¶è®¾è®¡çš„è§£è€¦è®¾è®¡è§„èŒƒï¼Œä¹Ÿä¸ºæ»¡è¶³äº†ä¸šç•Œä¸­æƒ³è¦Kubernetes çµæ´»åœ°æ”¯æŒå¤šä¸ªå®¹å™¨è¿è¡Œæ—¶çš„è¦æ±‚ã€‚</p><p>â€‹CRIåŒæ—¶ä¹Ÿå¯¹OCIè¿è¡Œæ—¶çš„é•œåƒç®¡ç†ä¸åˆ†å‘ï¼Œä¹Ÿå¯¹å®¹å™¨å­˜å‚¨ã€å¿«ç…§ã€ç½‘ç»œç­‰å…¶ä»–å®¹å™¨ä¸é•œåƒç”Ÿå‘½å‘¨æœŸä¸­ç”¨åˆ°çš„äº‹ç‰©ä¹Ÿç»™äºˆäº†åº”æœ‰å…³æ³¨ã€‚ä¸åƒOCIè¿è¡Œæ—¶ä¸»è¦ç´§å¯†å…³æ³¨äºåœ¨å®¿ä¸»ä¸Šåˆ›å»ºä¸è¿è¡Œå®¹å™¨ï¼ŒCRIå…·å¤‡åœ¨åŠ¨æ€äº‘ç¯å¢ƒä¸­å……åˆ†åˆ©ç”¨å®¹å™¨æ‰€éœ€çš„åŠŸèƒ½ã€‚æ›´æœ‰ç”šè€…ï¼ŒCRIé€šå¸¸ä¹Ÿæ˜¯å§”æ‰˜ä¸€ä¸ªä½çº§çš„OCIè¿è¡Œæ—¶ä½œä¸ºå…¶å®é™…ä¸Šçš„åº•å±‚è¿è¡Œæ—¶ã€‚é€šè¿‡å¼•å…¥CRIï¼ŒKubernetesä»¥ä¸€ç§é«˜åº¦å¯æ‰©å±•çš„æ–¹å¼é«˜æ•ˆåœ°è¾¾åˆ°å°†kubeletä¸åº•å±‚å®¹å™¨è¿è¡Œæ—¶è¿›è¡Œè§£è€¦è¿™ä¸€ç›®çš„ã€‚</p><p>â€‹CRIçš„ç¬¬ä¸€ä¸ªå®ç°æ˜¯dockershimï¼Œå®ƒåœ¨Dockerå®¹å™¨å¼•æ“çš„ä¸Šé¢æä¾›äº†ä¸€ä¸ªæŠ½è±¡å±‚ï¼ˆè¿™ä¹Ÿæ˜¯Kubernetesåœ¨Dockeråœ¨ä¸šç•Œä»ç„¶å æ®ä¸»å¯¼åœ°ä½æ—¶çš„ä¸€ä¸ªæŠ˜ä¸­é€‰æ‹©ï¼‰ã€‚éšç€containerdä¸runcä»DockeræŠ€æœ¯æ ˆçš„æ ¸å¿ƒä¸­è¢«åˆ†ç¦»å‡ºæ¥ï¼Œdockershimå®é™…çš„åœ°ä½ç»ˆäºè¢«æ’¼åŠ¨ï¼Œcontainerdå½“å‰æä¾›äº†CRIçš„å®Œæ•´å®ç°å¹¶é€æ¸æˆä¸ºï¼ˆæˆ–è¯´æ­£åœ¨æˆä¸ºï¼‰ä¸»æµã€‚</p><p><img src="https://s2.loli.net/2024/12/23/24HoaA6m1t7TX9z.png" alt="image-20241223205703497"></p><p>â€‹ä¹Ÿæœ‰ä¸€ä¸ªè™šæ‹ŸåŒ–æ–¹å‘çš„CRIå®ç°ï¼Œå®ƒå°±æ˜¯frakti(v1)ï¼Œå®ƒä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªédockerå¼çš„CRIå®ç°æ–¹æ¡ˆï¼ˆå‚è€ƒï¼šUnified Kubernetes CRI runtimes based on Kata Containersï¼Œ <a href="https://object-storage-ca-ymq-1.vexxhost.net/swift/v1/6e4619c416ff4bd19e1c087f27a43eea/www-assets-prod/presentation-media/hyper-kata-frakti-cri2.pdf">https://object-storage-ca-ymq-1.vexxhost.net/swift/v1/6e4619c416ff4bd19e1c087f27a43eea/www-assets-prod/presentation-media/hyper-kata-frakti-cri2.pdf</a> ï¼‰ã€‚å®ƒæœ¬æ¥æ˜¯ä¸ºrunVè€Œå¼€å‘çš„ï¼ŒåŒæ—¶ä¹Ÿè¢«è®¾è®¡ä¸runVååŒå·¥ä½œçš„ã€‚è™½ç„¶æ˜¯è™šæ‹ŸåŒ–æ–¹å‘çš„ï¼Œä½†å®ƒæä¾›çš„åŠŸèƒ½è·ŸåŸºäºæœ¬åœ°OCIåº•å±‚æ”¯æŒçš„CRIå®ç°æ˜¯ä¸€æ ·çš„ã€‚å› ä¸ºrunVè¢«åºŸå¼ƒäº†åŒæ—¶Clear Containers ä¸runVçš„ç‰¹æ€§ä¹Ÿè¢« kata æ‰€å¸æ”¶ï¼Œç°åœ¨fraktiå·²ç»ä¸å†æµè¡Œã€‚â€œfraktiåŠ runVç»„åˆâ€ä¹Ÿè¢«å½“å‰çš„â€œcontainerdåŠ kataç»„åˆâ€è¢«å–ä»£ï¼Œæ¢å¥è¯è¯´â€œcontainerdåŠ kataç»„åˆâ€å°±æ˜¯å½“å‰â€œfraktiåŠ runVç»„åˆâ€æ–¹æ¡ˆå®ç°ã€‚</p><p>â€‹å½“å‰ï¼ŒCRIé¢†åŸŸå†…æœ‰ä¸¤ä¸ªä¸»è¦æ´»è·ƒé¡¹ç›®ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯containerdä¸cri-oã€‚ä»¥ä¸‹æ˜¯å¯¹å®ƒä»¬çš„ç®€å•ä»‹ç»ã€‚</p><h2 id="containerd"><a href="#containerd" class="headerlink" title="containerd"></a>containerd</h2><p>â€‹containerdæ˜¯ä»Dockerä¸­å­•è‚²å‡ºæ¥çš„é«˜çº§è¿è¡Œæ—¶ï¼Œæ˜¯å¼€æºé¡¹ç›®Mobyåœ¨ç®¡ç†ä¸ç ”å‘å‡ºæ¥çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œcontainerdä¹Ÿæ˜¯ä½¿ç”¨runcä½œä¸ºå…¶ä½çº§è¿è¡Œæ—¶ã€‚è·Ÿå…¶ä»–æºè‡ªDockerçš„å®¹å™¨å·¥å…·ä¸€æ ·ï¼Œcontainerdå½“å‰æ˜¯äº‹å®ä¸Šçš„æ ‡å‡†é«˜çº§è¿è¡Œæ—¶ã€‚å®ƒå®ç°ä¸æä¾›äº†CRIçš„å…¨éƒ¨æ ¸å¿ƒåŠŸèƒ½ï¼Œä¸”å¢åŠ äº†ä¸€äº›é¢å¤–åŠŸèƒ½ã€‚containerdä¸­æœ‰ä¸€ä¸ªæ’ä»¶è®¾è®¡å³ cri-containerd ï¼ˆ <a href="https://github.com/containerd/cri">https://github.com/containerd/cri</a> ï¼‰ï¼Œå®ƒå®ç°äº†CRIï¼Œå¹¶ä¸”å­˜åœ¨å¤šç§å«ç‰‡è®¾è®¡ä¸å®ç°ä»¥å°†containerdä¸å„ç§ä½çº§è¿è¡Œæ—¶å¦‚kataã€runcç­‰è¿›è¡Œé›†æˆã€‚</p><p>   ä¸Šé¢æåˆ°çš„è¿™äº›CRIå®ç°èƒ½å¤Ÿä¸æ‰€æœ‰çš„OCIè¿è¡Œæ—¶ï¼ˆä¸ä»…åŒ…æ‹¬æœ¬åœ°è¿è¡Œæ—¶ï¼Œè¿˜åŒ…å«æ²™ç®±è¿è¡Œæ—¶ä¸è™šæ‹ŸåŒ–è¿è¡Œæ—¶ï¼‰è¿›è¡Œäº¤äº’ï¼Œäº¤äº’çš„æ–¹å¼å¯èƒ½æ˜¯æœ¬åœ°äº¤äº’ä¹Ÿå¯èƒ½æ˜¯é€šè¿‡åœ¨ä¸­é—´æ’å…¥ä¸€ä¸ªæ’ä»¶æˆ–å«ç‰‡ã€‚</p><h2 id="cri-o"><a href="#cri-o" class="headerlink" title="cri-o"></a>cri-o</h2><p>â€‹cri-oæ˜¯ä¸€ä¸ªç”±Redhaté¢†å¯¼çš„ç²¾ç®€CRIå®ç°æ–¹æ¡ˆï¼Œä¸“ä¸ºKubernetesè€Œè®¾è®¡ã€‚å®ƒæ„åœ¨å……å½“ä¸ºCRIä¸å„ç§åº•å±‚ä½çº§OCIè¿è¡Œæ—¶ä¹‹é—´è½»é‡çº§æ¡¥æ¢ã€‚ä¸containdç›¸æ¯”ï¼Œå®ƒçš„å¤–å›´åŠŸèƒ½æ›´å°‘ï¼Œå¹¶å§”æ‰˜æ¥è‡ªlibpodå’Œâ€œContainer Toolsâ€é¡¹ç›®çš„ç»„ä»¶è¿›è¡Œé•œåƒç®¡ç†å’Œå­˜å‚¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œcri-oä¹Ÿæ˜¯ä½¿ç”¨runcä½œä¸ºå…¶åº•å±‚ä½çº§è¿è¡Œæ—¶ï¼Œä½†åœ¨RedHat Fedora installations (with cgroups v2) é¡¹ç›®ä¸­ï¼Œå®ƒä½¿ç”¨äº†crunè¿™ä¸€ä½çº§è¿è¡Œæ—¶ã€‚å› ä¸ºcri-oèƒ½å¤Ÿå¯¹OCIå®ç°å®Œå…¨å…¼å®¹ï¼Œ cri-o ä¸ä½çº§åˆ«çš„è¿è¡Œæ—¶æ¯”å¦‚ kataå¼€ç®±å³ç”¨ï¼Œä¸éœ€è¦å…¶å®ƒçš„ç»„ä»¶ï¼Œåªéœ€è¦å¾ˆå°‘çš„é…ç½®å³å¯ã€‚</p><h1 id="6-å®¹å™¨å¼•æ“"><a href="#6-å®¹å™¨å¼•æ“" class="headerlink" title="6 å®¹å™¨å¼•æ“"></a>6 å®¹å™¨å¼•æ“</h1><h2 id="dockerå®¹å™¨å¼•æ“"><a href="#dockerå®¹å™¨å¼•æ“" class="headerlink" title="dockerå®¹å™¨å¼•æ“"></a>dockerå®¹å™¨å¼•æ“</h2><p>â€‹Dockerå¹¶ä¸æ˜¯ä¸€ä¸ªçº¯ç²¹çš„CRIå®ç°æˆ–OCIå®ç°ï¼Œä½†æ˜¯å®ƒåŒ…å«äº†CRIçš„ä¸€ä¸ªå®ç°å³containerdï¼Œä¹ŸåŒ…å«ä¸€ä¸ªOCIçš„å®ç°ã€‚äº‹å®ä¸Šï¼Œå®ƒå…·æœ‰ CRI æˆ–è€… OCI èŒƒå›´ä¹‹å¤–çš„å…¶ä»–åŠŸèƒ½ï¼Œæ¯”å¦‚é•œåƒæ„å»ºä¸ç­¾åã€‚é‚£ä¹ˆåˆ°åº•è¯¥å¦‚ä½•å®šä¹‰Dockerï¼Ÿæ ¹æ®æˆ‘å¯¹æ­¤æ–‡ä¸å…¶ä»–æŠ€æœ¯æ–‡æ¡£çš„å­¦ä¹ ï¼Œæœ€åå¯ä»¥å¾—å‡ºå¦‚ä¸‹å¤§è‡´æ€»ç»“ï¼š</p><p>â€‹ç¬¬ä¸€ï¼ŒDockerç°åœ¨å…¨ç§°åº”è¯¥å«Docker å®¹å™¨å¼•æ“ï¼Œå¹¶ä¸”é€šå¸¸å°†è¿™äº›å®Œæ•´çš„å®¹å™¨å·¥å…·å¥—ä»¶ç§°ä¹‹ä¸ºå®¹å™¨å¼•æ“ã€‚è€Œä¸”ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨LinuxæœåŠ¡å™¨ï¼ˆæ¯”å¦‚Ubuntu20.04 LTSï¼‰ä¸Šé€šè¿‡æ‰§è¡Œâ€œapt-get install docker-ce docker-ce-cli containerd.ioâ€å‘½ä»¤å®‰è£…æ‰€è°“Dockerå…¶å®å°±æ˜¯å®‰è£…æ•´ä¸ªDockerå®¹å™¨å¼•æ“å¥—ä»¶ã€‚é™¤äº†Dockerï¼Œæ²¡æœ‰å…¶ä»–å•ä¸€å¯æ‰§è¡Œæ–‡ä»¶èƒ½æä¾›è¿™æ ·ä¸€ä¸ªå®Œæ•´åŠŸèƒ½ï¼Œå¦‚æœä¸€å®šéœ€è¦æ‰¾åˆ°ä¸€ä¸ªæ›¿æ¢è§£å†³æ–¹æ¡ˆçš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ä»container toolsé¡¹ç›®ä¸­æ‹¼å‡‘å‡ºä¸€ä¸ªç±»ä¼¼çš„å·¥å…·å¥—ä»¶ã€‚Container Tools é¡¹ç›®éµå¾ªäº† UNIX å°å‹å·¥å…·å“²å­¦ï¼Œæ¯ä¸ªå·¥å…·åªåšå¥½ä¸€ä»¶äº‹æƒ…ï¼š</p><ul><li>podman - è¿è¡Œé•œåƒ</li><li>buildah - æ„å»ºé•œåƒ</li><li>skopeo - åˆ†å‘é•œåƒ</li><li>å…¶ä»–çš„</li></ul><p>â€‹ç¬¬äºŒï¼ŒDockeræ˜¯ä¸€ä¸ªå¤§è€Œå®Œå¤‡çš„é«˜çº§è¿è¡Œæ—¶ï¼Œå…¶ç”¨æˆ·ç«¯æ ¸å¿ƒå«åšDocker Engineï¼ˆ <a href="https://docs.docker.com/engine/">https://docs.docker.com/engine/</a> ï¼‰ï¼Œç”± 3 éƒ¨åˆ†æ„æˆï¼šDocker Server (docker daemon, ç®€ç§° dockerd)ã€REST API å’ŒDocker cliã€‚å€ŸåŠ© Docker Engine æ—¢èƒ½ä¾¿æ·åœ°è¿è¡Œå®¹å™¨è¿›ç¨‹è¿›è¡Œé›†æˆå¼€å‘ã€ä¹Ÿèƒ½å¿«é€Ÿæ„å»ºåˆ†å‘é•œåƒã€‚ä¸‹å›¾æ¥è‡ªæ–‡ç«  â€œ<a href="https://www.zeng.dev/post/2020-container-runtimes/%E2%80%9D">https://www.zeng.dev/post/2020-container-runtimes/â€</a> ã€‚</p><p><img src="https://s2.loli.net/2024/12/23/aQewkdiogORbfnP.png" alt="image-20241223205843274"></p><h2 id="containerdå®¹å™¨å¼•æ“"><a href="#containerdå®¹å™¨å¼•æ“" class="headerlink" title="containerdå®¹å™¨å¼•æ“"></a>containerdå®¹å™¨å¼•æ“</h2><p>â€‹containerdå…¶å®å°±æ˜¯Dockerä»è‡ªèº«ä¸­å‰¥ç¦»å‡ºæ¥å¹¶æèµ ç»™CNCFã€‚ä»Dockerä¸­å‰¥ç¦»å‡ºæ¥åï¼Œcontainerdç°åœ¨ä¹Ÿæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å®¹å™¨å¼•æ“ï¼Œä¸‹å›¾ï¼ˆæ¥è‡ªcontainerdå®˜ç½‘ï¼‰å±•ç¤ºäº†æ•´ä¸ªå®¹å™¨æŠ€æœ¯æ¶æ„åŠcontainerdåœ¨å…¶ä¸­çš„ä½ç½®ã€‚</p><p><img src="https://s2.loli.net/2024/12/23/ATYLiecyoh6m7nt.png" alt="img"></p><p>â€‹å…³äºcontainerdè¿˜ä¸å¤Ÿäº†è§£ï¼Œæ›´å¤šå†…å®¹æœ‰å¾…è¿›ä¸€æ­¥æ¢ç´¢ä¸è¡¥å……ã€‚</p><h1 id="8-å¤‡æ³¨ä¸å‚è€ƒæ–‡ç« "><a href="#8-å¤‡æ³¨ä¸å‚è€ƒæ–‡ç« " class="headerlink" title="8 å¤‡æ³¨ä¸å‚è€ƒæ–‡ç« "></a>8 å¤‡æ³¨ä¸å‚è€ƒæ–‡ç« </h1><p>â€‹è®¢é˜…å·æ–‡ç« ä¸æ–¹ä¾¿æ›´æ–°ï¼Œå¦‚åç»­æœ‰ä¿®æ”¹æˆ–å®Œå–„ï¼Œå°†æ›´æ–°åˆ°ä¸ªäººåšå®¢ï¼Œåšå®¢åœ°å€å‚è€ƒæ–‡é¦–ã€‚æŠ€æœ¯æ“ä½œç±»æ–‡ç« æ¨èç›´æ¥è®¿é—®ä¸ªäººåšå®¢æŸ¥é˜…ï¼Œé˜…è¯»æ•ˆæœæ›´ä½³ã€‚</p><p>â€‹æŸäº›è§‚ç‚¹æˆ–é˜è¿°ï¼Œç¬”è€…æ°´å¹³æœ‰é™æ— æ³•ç»™å‡ºæ­£å¼ä¸¥è°¨çš„ç­”æ¡ˆï¼Œå”¯æœ‰å¼•ç”¨æˆ–å‚è€ƒä¼ä¸šå•ä½çš„å®˜ç½‘ä¸å…¶ä»–å‰è¾ˆçš„æè¿°ã€‚æœ¬æ–‡æŸäº›å†…å®¹æ¥è‡ªä»¥ä¸‹æ–‡ç« ï¼š</p><ul><li><a href="https://www.capitalone.com/tech/cloud/container-runtime/">https://www.capitalone.com/tech/cloud/container-runtime/</a></li><li><a href="https://www.zhangjiee.com/blog/2021/container-runtime.html#org4b14f92">https://www.zhangjiee.com/blog/2021/container-runtime.html#org4b14f92</a></li><li><a href="https://www.zeng.dev/post/2020-container-runtimes/">https://www.zeng.dev/post/2020-container-runtimes/</a></li><li><a href="https://help.aliyun.com/zh/ack/ack-managed-and-ack-dedicated/user-guide/comparison-of-docker-containerd-and-sandboxed-container">https://help.aliyun.com/zh/ack/ack-managed-and-ack-dedicated/user-guide/comparison-of-docker-containerd-and-sandboxed-container</a></li><li><a href="https://mp.weixin.qq.com/s/qEKyEseD370xWI-2yIyUzg">https://mp.weixin.qq.com/s/qEKyEseD370xWI-2yIyUzg</a></li><li><a href="https://containerd.io/">https://containerd.io/</a></li><li><a href="https://www.cnblogs.com/ricklz/p/17032914.html">https://www.cnblogs.com/ricklz/p/17032914.html</a></li><li><a href="https://blog.csdn.net/projim_tao/article/details/129534626">https://blog.csdn.net/projim_tao/article/details/129534626</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>k8säº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å®¹å™¨ è¿è¡Œæ—¶ kubernetes k8s</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å®¹å™¨æ¦‚è¿°</title>
    <link href="/2024/12/18/%E5%AE%B9%E5%99%A8%E6%A6%82%E8%BF%B0/"/>
    <url>/2024/12/18/%E5%AE%B9%E5%99%A8%E6%A6%82%E8%BF%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="1-å®¹å™¨çš„å®šä¹‰"><a href="#1-å®¹å™¨çš„å®šä¹‰" class="headerlink" title="1 å®¹å™¨çš„å®šä¹‰"></a>1 å®¹å™¨çš„å®šä¹‰</h1><p>â€‹å®¹å™¨æ˜¯ä¸€ç§è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œç”¨äºå°†åº”ç”¨ç¨‹åºåŠå…¶æ‰€æœ‰ä¾èµ–é¡¹æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œä»¥ä¾¿åœ¨ä¸åŒçš„è®¡ç®—ç¯å¢ƒä¸­è¿›è¡Œç§»æ¤å’Œè¿è¡Œã€‚</p><p>â€‹æ¯ä¸ªè¿è¡Œçš„å®¹å™¨éƒ½æ˜¯å¯é‡å¤çš„ï¼Œæ„å‘³ç€æ— è®ºåœ¨å“ªé‡Œè¿è¡Œå®ƒéƒ½ä¼šå¾—åˆ°ç›¸åŒçš„è¡Œä¸ºã€‚å®¹å™¨å°†åº”ç”¨ç¨‹åºä»åº•å±‚çš„ä¸»æœºè®¾æ–½ä¸­è§£è€¦ã€‚è¿™ä½¿å¾—åœ¨ä¸åŒçš„äº‘æˆ–OSç¯å¢ƒä¸­éƒ¨ç½²æ›´åŠ å®¹æ˜“ã€‚</p><p>â€‹å®¹å™¨æä¾›äº†ä¸€ç§éš”ç¦»çš„è¿è¡Œç¯å¢ƒï¼Œä½¿ä¸åŒåº”ç”¨ç¨‹åºèƒ½å¤Ÿåœ¨ç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œå’Œè¿›ç¨‹ç©ºé—´ç­‰ç‹¬ç«‹è¿è¡Œç¯å¢ƒä¸­è¿è¡Œï¼Œæå‡äº†å®‰å…¨æ€§å’Œç¨³å®šæ€§ã€‚é€šè¿‡åˆ©ç”¨å®¹å™¨æŠ€æœ¯ï¼Œå¯ä»¥å°†åº”ç”¨åŠå…¶æ•´ä¸ªè¿è¡Œæ—¶ç¯å¢ƒï¼ˆåŒ…æ‹¬éœ€è¦çš„æ‰€æœ‰æ–‡ä»¶åŠä¿¡èµ–ç¯å¢ƒï¼‰ä¸€èµ·è¿›è¡Œæ‰“åŒ…å’Œéš”ç¦»ã€‚ä»è€Œå¯ä»¥åœ¨ä¸åŒç¯å¢ƒï¼ˆå¦‚å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç­‰ç¯å¢ƒï¼‰ä¹‹é—´è½»æ¾è¿ç§»åº”ç”¨ï¼ŒåŒæ—¶è¿˜å¯ä¿ç•™åº”ç”¨çš„å…¨éƒ¨åŠŸèƒ½ã€‚å®¹å™¨ä¹Ÿæ˜¯ä¿éšœITå®‰å…¨çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ã€‚å°†å®‰å…¨é˜²æŠ¤å†…ç½®äºå®¹å™¨ç®¡é“å¹¶ä¸ºåŸºç¡€æ¶æ„å¢æ·»é˜²æŠ¤ï¼Œå¯ä»¥ä¿éšœå®¹å™¨çš„å¯é æ€§ã€å¯æ‰©å±•æ€§å’Œä¿¡èµ–åº¦ã€‚åˆ©ç”¨å®¹å™¨ï¼Œè¿˜å¯ä»¥è½»æ¾åœ°åœ¨å…·æœ‰ä¸€è‡´è¡Œä¸ºå’ŒåŠŸèƒ½çš„å…¬å…±ã€ç§æœ‰å’Œæ··åˆäº‘ç¯å¢ƒå’Œæ•°æ®ä¸­å¿ƒï¼ˆæˆ–æœ¬åœ°ç¯å¢ƒï¼‰ä¹‹é—´ç§»åŠ¨å®¹å™¨åŒ–åº”ç”¨ã€‚</p><h1 id="2-å®¹å™¨ä¸è™šæ‹Ÿæœºçš„åŒºåˆ«"><a href="#2-å®¹å™¨ä¸è™šæ‹Ÿæœºçš„åŒºåˆ«" class="headerlink" title="2 å®¹å™¨ä¸è™šæ‹Ÿæœºçš„åŒºåˆ«"></a>2 å®¹å™¨ä¸è™šæ‹Ÿæœºçš„åŒºåˆ«</h1><p>â€‹        å®¹å™¨å’Œè™šæ‹Ÿæœºä¹‹é—´çš„ä¸»è¦åŒºåˆ«åœ¨äºè™šæ‹ŸåŒ–å±‚çº§ã€èµ„æºåˆ©ç”¨æ•ˆç‡ã€å¯åŠ¨é€Ÿåº¦å’Œæ€§èƒ½ä»¥åŠéš”ç¦»æ€§ã€‚</p><p><img src="https://s2.loli.net/2024/12/18/XlrPybfMmukY3tL.png" alt="image-20241218234125009"></p><p>â€‹ç›¸æ¯”äºä¼ ç»Ÿçš„è™šæ‹ŸæœºæŠ€æœ¯ï¼Œå®¹å™¨å…·æœ‰æ›´å¿«çš„å¯åŠ¨å’Œåœæ­¢é€Ÿåº¦ï¼Œæ›´å°‘çš„èµ„æºå ç”¨ï¼Œæ›´é«˜çš„å¯ä¼¸ç¼©æ€§å’Œæ›´å¥½çš„æ€§èƒ½ã€‚å®¹å™¨è¿˜æä¾›äº†æ›´å¥½çš„ç¯å¢ƒéš”ç¦»å’Œæ›´é«˜çš„åº”ç”¨ç¨‹åºå¯†åº¦ï¼Œå¯ä»¥åœ¨ç›¸åŒçš„ç¡¬ä»¶èµ„æºä¸Šè¿è¡Œæ›´å¤šçš„åº”ç”¨ç¨‹åºå®ä¾‹ã€‚</p><p>â€‹å®¹å™¨å’Œä¼ ç»Ÿçš„è™šæ‹ŸæœºæŠ€æœ¯æœ‰æ‰€ä¸åŒã€‚ä¼ ç»Ÿçš„è™šæ‹ŸæœºæŠ€æœ¯æ˜¯é€šè¿‡åœ¨ç‰©ç†æœåŠ¡å™¨ä¸Šè¿è¡Œä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿå®ä¾‹æ¥å®ç°è™šæ‹ŸåŒ–ï¼Œæ¯ä¸ªè™šæ‹Ÿæœºéƒ½æœ‰è‡ªå·±çš„å†…æ ¸å’Œæ“ä½œç³»ç»Ÿã€‚è€Œå®¹å™¨æ˜¯åœ¨å®¿ä¸»æœºçš„æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œï¼Œå…±äº«å®¿ä¸»æœºçš„å†…æ ¸å’Œæ“ä½œç³»ç»Ÿï¼Œæ¯ä¸ªå®¹å™¨åªåŒ…å«åº”ç”¨ç¨‹åºåŠå…¶ä¾èµ–é¡¹ã€‚</p><h1 id="3-å®¹å™¨æ˜¯å¦‚ä½•å·¥ä½œçš„"><a href="#3-å®¹å™¨æ˜¯å¦‚ä½•å·¥ä½œçš„" class="headerlink" title="3 å®¹å™¨æ˜¯å¦‚ä½•å·¥ä½œçš„"></a>3 å®¹å™¨æ˜¯å¦‚ä½•å·¥ä½œçš„</h1><p>â€‹å®¹å™¨æŠ€æœ¯åŸºäºæ“ä½œç³»ç»Ÿçº§çš„è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œåˆ©ç”¨Linuxå†…æ ¸çš„å‘½åç©ºé—´å’Œæ§åˆ¶ç»„ç­‰ç‰¹æ€§ï¼Œå®ç°äº†å®¹å™¨çš„éš”ç¦»å’Œèµ„æºç®¡ç†ã€‚å®¹å™¨ä½¿ç”¨äº†ä¸€ç§ç§°ä¸ºå®¹å™¨é•œåƒçš„æ‰“åŒ…æ ¼å¼ï¼ŒåŒ…å«äº†åº”ç”¨ç¨‹åºåŠå…¶ä¾èµ–é¡¹ï¼Œä»¥åŠè¿è¡Œæ—¶æ‰€éœ€çš„æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œå’Œè¿›ç¨‹ç©ºé—´ç­‰ã€‚å®¹å™¨é•œåƒå¯ä»¥é€šè¿‡å®¹å™¨è¿è¡Œæ—¶åˆ›å»ºå’Œå¯åŠ¨ï¼Œå½¢æˆä¸€ä¸ªç‹¬ç«‹çš„è¿è¡Œç¯å¢ƒã€‚</p><p>â€‹åœ¨Linuxå†…æ ¸ä¸­ï¼Œå®¹å™¨ä¸æ˜¯ä¸€ç±»å¯¹è±¡ã€‚å®¹å™¨æœ¬è´¨ä¸Šç”±å‡ ä¸ªåº•å±‚çš„å†…æ ¸åŸè¯­ç»„æˆï¼šnamespaceï¼ˆå…è®¸ä½ è·Ÿè°äº¤è°ˆï¼‰ï¼Œcgroupsï¼ˆå…è®¸ä½¿ç”¨çš„èµ„æºé‡ï¼‰ï¼Œå’ŒLSMsï¼ˆLinuxå®‰å…¨æ¨¡å—â€”â€”å…è®¸ä½ åšçš„äº‹æƒ…ï¼‰ã€‚è¿™äº›å‡‘åœ¨ä¸€èµ·èƒ½å¤Ÿä¸ºæˆ‘ä»¬çš„è¿›ç¨‹è®¾ç½®å®‰å…¨ã€éš”ç¦»å’Œå¯è®¡é‡çš„æ‰§è¡Œç¯å¢ƒã€‚</p><p>â€‹æœ‰å…´è¶£çš„æˆ–æƒ³è¿›è¡Œæ›´æ·±å…¥å­¦ä¹ çš„â€œåŒå­¦â€ï¼Œå¯ä»¥å†è¿›ä¸€æ­¥å»å­¦ä¹ Linuxå†…æ ¸çš„å‘½åç©ºé—´ã€æ§åˆ¶ç»„ç­‰ç›¸å…³çŸ¥è¯†ã€‚Linuxå†…æ ¸çš„å‘½åç©ºé—´ä¸€å…±åŒ…æ‹¬mntã€utsã€pidã€netã€ipcã€userã€cgroupè¿™7ç§ä¸åŒå‘½åç©ºé—´ã€‚</p><p>â€‹Linuxå†…æ ¸å‘½åç©ºé—´å‚è€ƒæ–‡ç« ï¼š</p><ul><li><p>Linux kernelå†…æ ¸å®˜ç½‘ï¼š</p><p><a href="https://www.kernel.org/doc/html/latest/admin-guide/namespaces/index.html">https://www.kernel.org/doc/html/latest/admin-guide/namespaces/index.html</a></p></li><li><p>man7.orgç½‘ç«™ï¼š<a href="https://man7.org/linux/man-pages/man7/namespaces.7.html">https://man7.org/linux/man-pages/man7/namespaces.7.html</a></p></li></ul><h1 id="4-å®¹å™¨ä¸è™šæ‹Ÿæœºçš„æ„æ¶å¯¹æ¯”"><a href="#4-å®¹å™¨ä¸è™šæ‹Ÿæœºçš„æ„æ¶å¯¹æ¯”" class="headerlink" title="4 å®¹å™¨ä¸è™šæ‹Ÿæœºçš„æ„æ¶å¯¹æ¯”"></a>4 å®¹å™¨ä¸è™šæ‹Ÿæœºçš„æ„æ¶å¯¹æ¯”</h1><p><img src="https://s2.loli.net/2024/12/18/KyaMD6qQFgxBGU2.png" alt="image-20241218234218202"></p><h1 id="5-å®¹å™¨çš„ä¼˜åŠ¿"><a href="#5-å®¹å™¨çš„ä¼˜åŠ¿" class="headerlink" title="5 å®¹å™¨çš„ä¼˜åŠ¿"></a>5 å®¹å™¨çš„ä¼˜åŠ¿</h1><ul><li><strong>å¯ç§»æ¤æ€§</strong></li></ul><p>å®¹å™¨å·²ç»æˆä¸ºåº”ç”¨åˆ†å‘å’Œäº¤ä»˜çš„æ ‡å‡†æŠ€æœ¯ï¼Œå°†åº”ç”¨ä¸åº•å±‚è¿è¡Œç¯å¢ƒè¿›è¡Œè§£è€¦ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºå¯ä»¥åœ¨ä¸åŒçš„è®¡ç®—ç¯å¢ƒä¸­å¿«é€Ÿç§»æ¤å’Œè¿è¡Œã€‚</p><ul><li><strong>é«˜æ•ˆæ€§</strong></li></ul><p>ç›¸æ¯”äºä¼ ç»Ÿçš„è™šæ‹ŸæœºæŠ€æœ¯ï¼Œå®¹å™¨æ›´åŠ è½»é‡çº§ï¼Œå¯åŠ¨å’Œåœæ­¢é€Ÿåº¦æ›´å¿«ï¼Œå ç”¨çš„èµ„æºæ›´å°‘ã€‚å®¹å™¨å…±äº«æ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶èµ„æºï¼Œæé«˜äº†èµ„æºåˆ©ç”¨ç‡ï¼Œé™ä½äº†è¿è¡Œæˆæœ¬ã€‚</p><ul><li><strong>ç¯å¢ƒéš”ç¦»</strong></li></ul><p>å®¹å™¨æä¾›äº†ä¸€ç§éš”ç¦»çš„è¿è¡Œç¯å¢ƒï¼Œæ¯ä¸ªå®¹å™¨éƒ½æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œå’Œè¿›ç¨‹ç©ºé—´ï¼Œä¿è¯äº†åº”ç”¨ç¨‹åºä¹‹é—´çš„ç›¸äº’éš”ç¦»ã€‚è¿™æ ·å¯ä»¥æé«˜åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ï¼Œé¿å…äº†ä¸åŒåº”ç”¨ç¨‹åºä¹‹é—´çš„å†²çªå’Œå¹²æ‰°ã€‚</p><ul><li><strong>å¯ä¼¸ç¼©æ€§</strong></li></ul><p>å®¹å™¨å¯ä»¥æ ¹æ®éœ€æ±‚è¿›è¡Œæ°´å¹³å’Œå‚ç›´æ‰©å±•ï¼Œå¿«é€Ÿå®ç°åº”ç”¨ç¨‹åºçš„å¼¹æ€§ä¼¸ç¼©ã€‚é€šè¿‡å®¹å™¨ç¼–æ’å·¥å…·ï¼Œå¯ä»¥è‡ªåŠ¨ç®¡ç†å’Œè°ƒåº¦å®¹å™¨çš„éƒ¨ç½²å’Œæ‰©å±•ï¼Œæé«˜äº†åº”ç”¨ç¨‹åºçš„å¯ä¼¸ç¼©æ€§å’Œå¯é æ€§ã€‚</p><h1 id="6-å®¹å™¨æœ‰å“ªäº›å®é™…åº”ç”¨"><a href="#6-å®¹å™¨æœ‰å“ªäº›å®é™…åº”ç”¨" class="headerlink" title="6 å®¹å™¨æœ‰å“ªäº›å®é™…åº”ç”¨"></a>6 å®¹å™¨æœ‰å“ªäº›å®é™…åº”ç”¨</h1><p>â€‹å®¹å™¨åœ¨å„ç§åº”ç”¨åœºæ™¯ä¸­æœ‰ç€å¹¿æ³›çš„åº”ç”¨ï¼Œä»¥ä¸‹æ˜¯å…¶ä¸­å‡ ä¸ªä¸»è¦åº”ç”¨åœºæ™¯ï¼š</p><ul><li><strong>åº”ç”¨ç¨‹åºå¼€å‘å’Œæµ‹è¯•</strong></li></ul><p>å®¹å™¨æä¾›äº†ä¸€ä¸ªä¸€è‡´çš„è¿è¡Œç¯å¢ƒï¼Œä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥åœ¨å¼€å‘å’Œæµ‹è¯•é˜¶æ®µå¿«é€Ÿæ„å»ºå’Œéƒ¨ç½²åº”ç”¨ç¨‹åºã€‚å®¹å™¨å¯ä»¥å°†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒä¿æŒä¸€è‡´ï¼Œæé«˜äº†å¼€å‘æ•ˆç‡å’Œè´¨é‡ã€‚</p><ul><li><strong>å¾®æœåŠ¡æ¶æ„</strong></li></ul><p>å¾®æœåŠ¡æ¶æ„å°†åº”ç”¨ç¨‹åºæ‹†åˆ†ä¸ºå¤šä¸ªå°å‹çš„ã€ç‹¬ç«‹éƒ¨ç½²çš„æœåŠ¡ã€‚å®¹å™¨å¯ä»¥ä¸ºæ¯ä¸ªæœåŠ¡æä¾›ä¸€ä¸ªç‹¬ç«‹çš„è¿è¡Œç¯å¢ƒï¼Œä½¿å¾—å¾®æœåŠ¡ä¹‹é—´äº’ç›¸éš”ç¦»ï¼Œæé«˜äº†æ•´ä½“ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œå¯ä¼¸ç¼©æ€§ã€‚</p><ul><li><strong>æŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²</strong></li></ul><p>å®¹å™¨å¯ä»¥ä¸æŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²å·¥å…·é›†æˆï¼Œå®ç°è‡ªåŠ¨åŒ–çš„æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²ã€‚å®¹å™¨å¯ä»¥å¿«é€Ÿå¯åŠ¨å’Œåœæ­¢ï¼Œæä¾›äº†å¿«é€Ÿè¿­ä»£å’Œå‘å¸ƒçš„èƒ½åŠ›ï¼ŒåŠ å¿«äº†è½¯ä»¶äº¤ä»˜çš„é€Ÿåº¦ã€‚</p><h1 id="7-å¤‡æ³¨ä¸å¼•ç”¨"><a href="#7-å¤‡æ³¨ä¸å¼•ç”¨" class="headerlink" title="7 å¤‡æ³¨ä¸å¼•ç”¨"></a>7 å¤‡æ³¨ä¸å¼•ç”¨</h1><p>â€‹æŸäº›è§‚ç‚¹æˆ–é˜è¿°ï¼Œç¬”è€…æ°´å¹³æœ‰é™æ— æ³•ç»™å‡ºæ­£å¼ä¸¥è°¨çš„ç­”æ¡ˆï¼Œå”¯æœ‰å¼•ç”¨ä¼ä¸šæˆ–å•ä½çš„å®˜ç½‘æ­£å¼æè¿°ã€‚æœ¬æ–‡æŸäº›å†…å®¹æ¥è‡ªä»¥ä¸‹æ–‡ç« ï¼š</p><ul><li>å®¹å™¨çš„å®šä¹‰ä¸ä¼˜åŠ¿ï¼šæ¥è‡ªé˜¿é‡Œäº‘å®˜ç½‘â€œ<a href="https://www.aliyun.com/getting-started/what-is/what-is-container%E2%80%9D">https://www.aliyun.com/getting-started/what-is/what-is-containerâ€</a></li><li>å®¹å™¨æŠ€æœ¯çš„ç”¨é€”æˆ–ä½œç”¨ï¼šæ¥è‡ªredhatå®˜ç½‘â€œ<a href="https://www.redhat.com/zh/topics/containers%E2%80%9D">https://www.redhat.com/zh/topics/containersâ€</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>k8säº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å®¹å™¨ è™šæ‹ŸåŒ– ç®—åŠ›è°ƒåº¦ k8s</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç®—åŠ›è°ƒåº¦æ¦‚è¿°</title>
    <link href="/2024/12/14/%E7%AE%97%E5%8A%9B%E8%B0%83%E5%BA%A6%E6%A6%82%E8%BF%B0/"/>
    <url>/2024/12/14/%E7%AE%97%E5%8A%9B%E8%B0%83%E5%BA%A6%E6%A6%82%E8%BF%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="1-ç®—åŠ›è°ƒåº¦æ˜¯ä»€ä¹ˆ"><a href="#1-ç®—åŠ›è°ƒåº¦æ˜¯ä»€ä¹ˆ" class="headerlink" title="1 ç®—åŠ›è°ƒåº¦æ˜¯ä»€ä¹ˆ"></a>1 ç®—åŠ›è°ƒåº¦æ˜¯ä»€ä¹ˆ</h1><p>  ç®—åŠ›è°ƒåº¦ï¼Œç®€å•ç›´ç™½åœ°è¯´ï¼Œå°±æ˜¯è°ƒåº¦ç®—åŠ›ï¼ˆè®¡ç®—èƒ½åŠ›ï¼‰çš„è¿‡ç¨‹ã€‚å…·ä½“åœ°è¯´å°±æ˜¯â€œåŸºäºäººå·¥æ™ºèƒ½åº”ç”¨å¯¹ç®—åŠ›çš„éœ€æ±‚ç‰¹ç‚¹ï¼Œé€šè¿‡è™šæ‹ŸåŒ–ã€å®¹å™¨åŒ–ç­‰æŠ€æœ¯ï¼Œå°†ç®—åŠ›èµ„æºæ± åŒ–ä¸ºæ ‡å‡†ç®—åŠ›å•å…ƒï¼Œé€šè¿‡é€‚åº”æ€§ç­–ç•¥åŠæ•æ·æ¡†æ¶å¯¹ç®—åŠ›è¿›è¡Œç²¾å‡†è°ƒåº¦é…ç»™ï¼Œä¿éšœAIå¼€å‘å’ŒAIä¸šåŠ¡çš„é«˜æ•ˆè¿è¡Œâ€çš„è¿‡ç¨‹ã€‚</p><p>â€‹    è°ƒåº¦èƒ½åŠ›æ˜¯æ™ºç®—ä¸­å¿ƒè¿æ¥ä¸Šå±‚åº”ç”¨ä¸åº•å±‚è®¡ç®—è®¾å¤‡çš„æ ¸å¿ƒèƒ½åŠ›ï¼Œå°†èšåˆçš„CPUã€GPUã€FPGAã€ASICç­‰ç®—åŠ›èµ„æºè¿›è¡Œæ ‡å‡†åŒ–å’Œç»†ç²’åº¦åˆ‡åˆ†ï¼Œæ»¡è¶³ä¸Šå±‚ä¸åŒç±»å‹æ™ºèƒ½åº”ç”¨å¯¹ç®—åŠ›çš„å¤šæ ·åŒ–éœ€æ±‚ï¼Œè®©ä¸Šå±‚åº”ç”¨æ›´é«˜æ•ˆã€æ›´ä¾¿æ·åœ°å¯¹ç®—åŠ›èµ„æºè¿›è¡Œåˆ©ç”¨ã€‚ç®—åŠ›è°ƒåº¦åˆ†ä¸ºä¸‰ä¸ªç®—åŠ›æ± åŒ–ã€ç®—åŠ›è°ƒåº¦ã€ç®—åŠ›æœåŠ¡è¿‡ç¨‹ã€‚</p><p><img src="https://s2.loli.net/2024/12/14/BKH3ZCTca2F9plJ.png" alt="image-20241214232453929"></p><p>   ä¸Šå›¾æ˜¯â€œæ™ºèƒ½è®¡ç®—ä¸­å¿ƒæ€»ä½“æ¶æ„å›¾â€ï¼Œé˜è¿°äº†ç®—åŠ›è°ƒåº¦åœ¨æ™ºç®—ä¸­å¿ƒæ‰€å¤„ä½ç½®ã€‚ï¼ˆåŸå›¾æ¥è‡ªå›½å®¶ä¿¡æ¯ä¸­å¿ƒåœ¨2020å¹´12æœˆä»½å‘å¸ƒçš„ã€Šæ™ºèƒ½è®¡ç®—ä¸­å¿ƒè§„åˆ’å»ºè®¾æŒ‡å—å…¨æ–‡ã€‹ï¼Œæœ¬æ–‡å°†å…¶è¿›è¡Œäº†ç¨è®¸ä¿®æ”¹é‡ç”»ã€‚ï¼‰</p><h2 id="ç®—åŠ›æ± åŒ–"><a href="#ç®—åŠ›æ± åŒ–" class="headerlink" title="ç®—åŠ›æ± åŒ–"></a>ç®—åŠ›æ± åŒ–</h2><p>   ç¡¬ä»¶æŠ€æœ¯çš„ä¸æ–­è¿­ä»£ä¸æ›´æ–°çš„åŒæ—¶ï¼Œæ¶Œç°äº†å„ç±»å¼‚æ„åŠ é€ŸèŠ¯ç‰‡ä¸è®¾å¤‡ï¼Œä»¥æ»¡è¶³å„ç±»ä¸Šå±‚åº”ç”¨å¯¹è®¡ç®—èµ„æºä¸è®¡ç®—èƒ½åŠ›çš„è¦æ±‚ã€‚é€šè¿‡å°†è®¡ç®—èµ„æºæ± åŒ–ï¼Œå¯ä»¥ç®€åŒ–ç®—åŠ›è°ƒç”¨è¿‡ç¨‹ï¼Œç”¨æˆ·å°±åƒä½¿ç”¨äº‘è®¡ç®—èƒ½åŠ›ä¸€æ ·ç”³è¯·è®¡ç®—èµ„æºè€Œæ— éœ€å…³æ³¨è®¡ç®—è®¾å¤‡çš„ç§ç±»ï¼Œæ–¹ä¾¿ç”¨æˆ·å¯¹å¤§è§„æ¨¡é›†ç¾¤å†…çš„è®¡ç®—èµ„æºè¿›è¡ŒæŒ‰éœ€ç”³è¯·ä¸æœ‰æ•ˆåˆ©ç”¨ã€‚ç®—åŠ›æ± åŒ–ä¸»è¦<strong>ç®—åŠ›è™šæ‹ŸåŒ–</strong>å’Œ<strong>åº”ç”¨å®¹å™¨åŒ–</strong>ã€‚</p><p>â€‹    <strong>ç®—åŠ›è™šæ‹ŸåŒ–</strong>çš„æ ¸å¿ƒï¼Œæ˜¯å‘ç”¨æˆ·ç›´æ¥æä¾›è®¡ç®—èƒ½åŠ›ï¼Œé¿å…ç”¨æˆ·åœ¨ç”³è¯·ã€ä½¿ç”¨è®¡ç®—èƒ½åŠ›çš„è¿‡ç¨‹ä¸­å¯¹é›†ç¾¤å†…è®¾ å¤‡çš„åˆ†å¸ƒã€ç±»åˆ«ã€æ€§èƒ½ç­‰äº§ç”Ÿå…³æ³¨ã€‚é€šè¿‡ç®—åŠ›è™šæ‹ŸåŒ–ï¼Œç”¨æˆ·é¿å¼€åœ¨å¤§è§„æ¨¡è®¡ç®—è®¾å¤‡é›†ç¾¤ä¸­è¿›è¡Œè®¾å¤‡é€‰æ‹©ã€è®¾ å¤‡é€‚é…çš„ç¹æ‚å·¥ä½œã€‚</p><p>â€‹    <strong>åº”ç”¨å®¹å™¨åŒ–</strong>ï¼ŒåŸºäºå®¹å™¨åŒ–çš„åº”ç”¨éƒ¨ç½²ç­–ç•¥èƒ½å¤Ÿæ˜¾è‘—é™ä½ç®¡ç†åº”ç”¨ã€æ”¯æŒä¸šåŠ¡çš„è®¡ç®—å¼€é”€ï¼Œå…·æœ‰è¾ƒé«˜çš„çµæ´»æ€§ï¼Œä¾¿äºå¿«é€Ÿåœ¨è¾¹ç¼˜ç«¯ã€è®¡ç®—ä¸­å¿ƒç«¯ç­‰è®¡ç®—åœºæ™¯ä¸­çµæ´»éƒ¨ç½²å’Œè¿ç§»ã€‚</p><h2 id="ç®—åŠ›è°ƒåº¦"><a href="#ç®—åŠ›è°ƒåº¦" class="headerlink" title="ç®—åŠ›è°ƒåº¦"></a>ç®—åŠ›è°ƒåº¦</h2><p>â€‹    é€šè¿‡æœ‰æ•ˆç®—åŠ›è°ƒåº¦ï¼Œæé«˜ç®—åŠ›è®¾å¤‡çš„åˆ©ç”¨ç‡ï¼Œé™ä½è®¾å¤‡é—²ç½®ç‡ï¼›èƒ½å¤Ÿæœ‰æ•ˆæ•´åˆåˆ†æ•£çš„ç®—åŠ›èµ„æºï¼Œå®ç°è·¨åœ°åŸŸã€è·¨æ¶æ„ã€è·¨å¼‚æ„çš„é«˜æ•ˆè°ƒåº¦ä¸ä¼˜åŒ–é…ç½®ï¼Œç¡®ä¿ç®—åŠ›èµ„æºæŒ‰éœ€åˆ†é…ã€é«˜æ•ˆåˆ©ç”¨ï¼›å¯¹ç”¨æˆ·è¡Œä¸ºè¿›è¡Œåˆ†æå’Œç›‘ç®¡ï¼Œä¼˜åŒ–ç®—åŠ›è®¾å¤‡å¸ƒå±€è§„åˆ’ï¼Œæå‡ä¸šåŠ¡éƒ¨ç½²æ•ˆèƒ½ï¼Œä½¿åº”ç”¨å…·æœ‰æ›´å¥½çš„ç¨³å®šæ€§å’Œæ‰©å±•æ€§ã€‚ç®—åŠ›è°ƒåº¦æ¶‰åŠ<strong>é…é¢ç­–ç•¥ã€å…±äº«è¶…åˆ†ã€è´Ÿè½½å‡è¡¡</strong>ç­‰ç­–ç•¥ã€‚</p><p>â€‹    ç®—åŠ›<strong>é…é¢ç­–ç•¥</strong>ï¼Œæ™ºç®—ä¸­å¿ƒä¼šå°†æ± åŒ–çš„è®¡ç®—èµ„æºæä¾›ç»™ç”¨æˆ·ï¼Œä¸ºç”¨æˆ·çš„ç®—åŠ›é…ç»™è¿›è¡Œäº†æœ‰æ•ˆçš„åˆ’åˆ†ã€‚</p><p>â€‹    ç®—åŠ›<strong>å…±äº«è¶…åˆ†ç­–ç•¥</strong>ï¼Œåœ¨ä¿è¯ä¸šåŠ¡æ­£å¸¸ç”³è¯·éœ€æ±‚ä¸æ‰©å®¹éœ€æ±‚çš„åŒæ—¶ï¼Œå‡å°‘ç®—åŠ›èµ„æºé—²ç½®ï¼Œæå‡è®¡ç®—è®¾å¤‡åˆ©ç”¨ç‡ï¼Œä¿è¯è®­ç»ƒå’Œæ¨ç†ä¸šåŠ¡é¡ºåˆ©è¿›è¡Œã€‚</p><p>â€‹    <strong>è´Ÿè½½å‡è¡¡</strong>ï¼Œä»¥äººå·¥æ™ºèƒ½çš„æ¨ç†ç±»ä¸šåŠ¡ä¸ºä»£è¡¨ï¼Œå¯¹ç®—åŠ›çš„ä½¿ç”¨ã€ç”³è¯·ã€æ¥å…¥ç­‰éœ€æ±‚è¿›è¡Œå‡è¡¡åˆ†é…ï¼Œå¯¹åº”ç”¨çš„ç¨³å®šæ€§ã€æœåŠ¡èƒ½åŠ›ã€å“åº”é€Ÿåº¦è¾¾åˆ°æœ€ä¼˜çš„é…ç½®ã€‚</p><h2 id="ç®—åŠ›æœåŠ¡"><a href="#ç®—åŠ›æœåŠ¡" class="headerlink" title="ç®—åŠ›æœåŠ¡"></a>ç®—åŠ›æœåŠ¡</h2><p>   <strong>è®­ç»ƒæœåŠ¡</strong>ï¼Œä¾æ‰˜å®¹å™¨åŒ–æŠ€æœ¯ï¼Œå°†è¿è¡Œç¯å¢ƒã€æ¡†æ¶é€‚é…è¿‡ç¨‹æ ‡å‡†åŒ–ã€æ¨¡å—åŒ–ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿä¾¿æ·é«˜æ•ˆåœ°æ„å»ºè¿è¡Œç¯å¢ƒï¼Œæäº¤è®­ç»ƒä»»åŠ¡ï¼Œä¿è¯æ™ºç®—ä¸­å¿ƒå†…èƒ½å¤Ÿéƒ¨ç½²å¤šæ ·åŒ–çš„å¼€å‘ç¯å¢ƒå’Œè®­ç»ƒç¯å¢ƒï¼Œä¸”å½¼æ­¤éš”ç¦»ã€ä¸ä¼šäº’ç›¸å½±å“ï¼›</p><p>â€‹    <strong>æ¨ç†æœåŠ¡</strong>ï¼Œç®€åŒ–åº”ç”¨éƒ¨ç½²æµç¨‹å’Œäº¤äº’æ¨¡å¼ï¼Œæ–¹ä¾¿ç”¨æˆ·åœ¨æ™ºç®—ä¸­å¿ƒä¸­è¿›è¡Œåº”ç”¨éƒ¨ç½²ï¼Œä¿éšœæ¨ç†ä¸šåŠ¡çš„ç®—åŠ›åˆ†é…éšæ¨ç†ä¸šåŠ¡é‡å˜åŒ–å®ç°å¼¹æ€§ä¼¸ç¼©ï¼Œä¿éšœä¸šåŠ¡ç¨³å®šå¯é ã€‚</p><p><strong>æ³¨ï¼š</strong></p><p>   ç®—åŠ›è°ƒåº¦çš„åè¯å®šä¹‰ï¼Œä¸åŒçš„ç ”ç©¶æœºæ„æˆ–å•ä½å¯¹å…¶ç¨æœ‰ä¸åŒï¼Œä½†åŸºæœ¬ä¸Šéƒ½æ˜¯ä»¥â€œå¯¹è®¡ç®—çš„èƒ½åŠ›çš„è°ƒåº¦â€ä¸ºä¸­å¿ƒã€‚ä»¥ä¸‹æ˜¯å…¶ä»–ä¸¤ä¸ªç ”ç©¶æœºæ„æˆ–å•ä½çš„å®šä¹‰ã€‚</p><p>ï¼ˆ1ï¼‰ä¸œå´è¯åˆ¸ã€Šè®¡ç®—æœºè¡Œä¸šæ·±åº¦æŠ¥å‘Šï¼šç®—åŠ›è°ƒåº¦ï¼Œç®—åŠ›æ—¶ä»£çš„å›½å®¶ç”µç½‘ã€‹ä¸­å¯¹ç®—åŠ›è°ƒåº¦çš„å®šä¹‰ï¼šæŒ‡åœ¨ä¸€å®šåŒºåŸŸæˆ–è€…ç³»ç»Ÿä¸­åˆç†åˆ†é…å’Œåˆ©ç”¨è®¡ç®—æœºèµ„æºçš„è¿‡ç¨‹ã€‚</p><p>ï¼ˆ2ï¼‰Imaginationå®˜æ–¹åšå®¢å¯¹ç®—åŠ›è°ƒåº¦ï¼ˆComputational Power Schedulingæˆ–Computing Resource Schedulingï¼‰çš„å®šä¹‰ï¼šæ˜¯æŒ‡åœ¨è®¡ç®—æœºé›†ç¾¤ã€æ•°æ®ä¸­å¿ƒæˆ–äº‘è®¡ç®—ç¯å¢ƒä¸­ï¼Œå¯¹è®¡ç®—èµ„æºè¿›è¡Œåˆ†é…å’Œç®¡ç†çš„è¿‡ç¨‹ã€‚å°¤å…¶æ˜¯é’ˆå¯¹å¤§è§„æ¨¡è®¡ç®—ä»»åŠ¡ï¼Œå¦‚äººå·¥æ™ºèƒ½è®­ç»ƒã€å¤§æ•°æ®åˆ†æã€é«˜æ€§èƒ½è®¡ç®—ç­‰ï¼Œéœ€è¦å°†æœ‰é™çš„ç®—åŠ›ç²¾å‡†åœ°åˆ†é…åˆ°å¯¹åº”çš„ä»»åŠ¡ä¸­ï¼Œæé«˜è®¡ç®—æ•ˆç‡å’Œèµ„æºåˆ©ç”¨ç‡ã€‚</p><h1 id="2-ç®—åŠ›è°ƒåº¦çš„æ ¸å¿ƒæŠ€æœ¯"><a href="#2-ç®—åŠ›è°ƒåº¦çš„æ ¸å¿ƒæŠ€æœ¯" class="headerlink" title="2 ç®—åŠ›è°ƒåº¦çš„æ ¸å¿ƒæŠ€æœ¯"></a>2 ç®—åŠ›è°ƒåº¦çš„æ ¸å¿ƒæŠ€æœ¯</h1><p>  å®ç°ç®—åŠ›è°ƒåº¦çš„æŠ€æœ¯æ¶‰åŠå¤šä¸ªæ–¹é¢ï¼Œè¿™äº›æŠ€æœ¯å…±åŒæ„æˆäº†ç®—åŠ›è°ƒåº¦ç³»ç»Ÿçš„æ ¸å¿ƒï¼Œä¸»è¦çš„æœ‰å¦‚ä¸‹å†…å®¹ã€‚</p><ul><li><strong>ç®—åŠ›æ„ŸçŸ¥</strong></li></ul><p>ç®—åŠ›æ„ŸçŸ¥æ˜¯å®ç°ç®—åŠ›è°ƒåº¦çš„åŸºç¡€ï¼Œé€šè¿‡æ„ŸçŸ¥å…¨ç½‘çš„ç®—åŠ›èµ„æºä¿¡æ¯ï¼ŒåŒ…æ‹¬è®¡ç®—èµ„æºã€å­˜å‚¨èµ„æºç­‰ï¼Œç¡®ä¿èƒ½å¤ŸæŒ‰éœ€ã€å®æ—¶åœ°è°ƒåº¦ä¸åŒä½ç½®çš„ç®—åŠ›èµ„æºã€‚</p><ul><li><strong>ç®—åŠ›åº¦é‡</strong></li></ul><p>ç®—åŠ›åº¦é‡æ ‡å‡†çš„å»ºç«‹å¯ä»¥å°†ç®—åŠ›èµ„æºç»Ÿä¸€è¡¨è¾¾ä¸ºåŒ…å«è®¡ç®—ã€ç½‘ç»œã€å­˜å‚¨ç­‰å¤šç»´åº¦èµ„æºçš„ç»¼åˆæ¨¡å‹ï¼Œæ˜¯å®ç°çµæ´»è°ƒåº¦å¤šå…ƒå¼‚æ„ç®—åŠ›èµ„æºçš„å‰æã€‚</p><ul><li><strong>ç®—åŠ›è·¯ç”±</strong></li></ul><p>ç®—åŠ›è·¯ç”±çš„ä½œç”¨æ˜¯æ ¹æ®æ‰€æ„ŸçŸ¥çš„æŠ½è±¡ç®—ç½‘èµ„æºï¼Œç»¼åˆè€ƒè™‘è®¡ç®—èµ„æºåŠç½‘ç»œçŠ¶æ€ï¼ŒæŒ‰éœ€å°†ä¸šåŠ¡æµé‡çµæ´»è·¯ç”±è‡³é€‚å½“çš„è®¡ç®—èŠ‚ç‚¹ä¸­ã€‚</p><ul><li><strong>ç®—åŠ›è°ƒåº¦ç®—æ³•</strong></li></ul><p>ç®—åŠ›è°ƒåº¦ç®—æ³•æ˜¯ç®—åŠ›è°ƒåº¦ç³»ç»Ÿçš„æ ¸å¿ƒï¼Œå®ƒæ ¹æ®ä»»åŠ¡ç‰¹æ€§ã€èµ„æºå¯ç”¨æ€§ã€ç”¨æˆ·éœ€æ±‚ç­‰å› ç´ ï¼Œå®ç°æœ€ä¼˜çš„ä»»åŠ¡åˆ†é…ã€‚</p><ul><li><strong>è™šæ‹ŸåŒ–æŠ€æœ¯</strong></li></ul><p>é€šè¿‡è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå¯ä»¥å°†ç‰©ç†ç®—åŠ›èµ„æºåˆ’åˆ†ä¸ºå¤šä¸ªè™šæ‹Ÿèµ„æºï¼Œå…è®¸å¤šä¸ªç”¨æˆ·æˆ–ä»»åŠ¡å…±äº«åŒä¸€å—ç‰©ç†ç®—åŠ›èµ„æºï¼ŒåŒæ—¶ä¿è¯æ€§èƒ½å’Œèµ„æºçš„éš”ç¦»ã€‚</p><ul><li><strong>å®¹å™¨ç¼–æ’æŠ€æœ¯</strong></li></ul><p>åœ¨ç®—åŠ›è°ƒåº¦ä¸­ï¼Œå®¹å™¨ç¼–æ’æŠ€æœ¯æ‰®æ¼”ç€å…³é”®è§’è‰²ï¼Œå°¤å…¶æ˜¯åœ¨é«˜æ€§èƒ½è®¡ç®—åœºæ™¯ä¸‹ã€‚å®¹å™¨ç¼–æ’æŠ€æœ¯å¯ä»¥å®ç°å¯¹å®¹å™¨åŒ–åº”ç”¨çš„é«˜æ•ˆè°ƒåº¦å’Œç®¡ç†ï¼Œç¡®ä¿åº”ç”¨èƒ½å¤ŸæŒ‰éœ€ã€å®æ—¶åœ°è·å¾—æ‰€éœ€çš„ç®—åŠ›èµ„æºã€‚</p><ul><li><strong>ç¡®å®šæ€§ç½‘ç»œæŠ€æœ¯</strong></li></ul><p>ç¡®å®šæ€§ç½‘ç»œæŠ€æœ¯ä¸ºæ•°æ®æµä¼ è¾“æä¾›æä¾›å¸¦å®½ã€æ—¶å»¶ã€æŠ–åŠ¨ç­‰è´¨é‡å¯ç¡®å®šçš„æœåŠ¡ï¼Œæœ‰åŠ©äºä¿éšœç®—åŠ›ç½‘ç»œä¸­çš„æ•°æ®ä¼ è¾“è´¨é‡å’Œç¨³å®šæ€§ã€‚</p><ul><li><strong>ç®—ç½‘ç¼–æ’æŠ€æœ¯</strong></li></ul><p>ç®—ç½‘ç¼–æ’æŠ€æœ¯èƒ½å¤Ÿå®ç°å¯¹ç®—åŠ›èµ„æºå’Œç½‘ç»œèµ„æºçš„ç»Ÿä¸€ç¼–æ’å’Œéƒ¨ç½²ï¼Œç¡®ä¿ç®—åŠ›ä»»åŠ¡èƒ½å¤ŸæŒ‰ç…§é¢„å®šçš„è·¯å¾„å’Œç­–ç•¥æ‰§è¡Œã€‚</p><p>â€‹    é€šè¿‡ä¸æ–­ä¼˜åŒ–ç®—åŠ›è°ƒåº¦æŠ€æœ¯ï¼Œä¹Ÿå°†æ¨åŠ¨ç®—ç½‘ååŒè°ƒåº¦çš„æ·±åŒ–å‘å±•ï¼Œè¿›ä¸€æ­¥å®ç°è®¡ç®—èµ„æºå’Œç½‘ç»œèµ„æºçš„ç»Ÿä¸€ç®¡ç†å’ŒååŒå·¥ä½œï¼Œèƒ½å¤Ÿç»“åˆç½‘ç»œä¼˜åŠ¿ä»¥æ›´é«˜æ€§èƒ½ã€æ›´ä¼˜ç¨³å®šæ€§ä¸ºå„ç±»ä»»åŠ¡çš„é«˜æ•ˆå¤„ç†æä¾›æ”¯æ’‘ã€‚</p><h1 id="3-ç®—åŠ›è°ƒåº¦çš„æ ¸å¿ƒæŠ€æœ¯"><a href="#3-ç®—åŠ›è°ƒåº¦çš„æ ¸å¿ƒæŠ€æœ¯" class="headerlink" title="3 ç®—åŠ›è°ƒåº¦çš„æ ¸å¿ƒæŠ€æœ¯"></a>3 ç®—åŠ›è°ƒåº¦çš„æ ¸å¿ƒæŠ€æœ¯</h1><p>  ä»¥ä¸‹å¯¹ç®—åŠ›è°ƒåº¦å¹³å°çš„ç›¸å…³æè¿°ï¼Œä¸ä»…é€‚åº”äºAIç®—åŠ›è°ƒåº¦å¹³å°ï¼Œä¹Ÿé€‚åº”äºæ™®é€šçš„ä¸åŒ…å«æˆ–åªåŒ…å«å°‘é‡AIèµ„æºçš„ç®—åŠ›è°ƒåº¦å¹³å°ã€‚ä½†ä¸»è¦ä»æŒ‡AIç®—åŠ›è°ƒåº¦å¹³å°ï¼Œå› ä¸ºå½“åœ¨åˆ†æä¸ä½¿ç”¨ç®—åŠ›è°ƒåº¦å¹³å°æ—¶ï¼Œä¸»è¦æ˜¯å…³æ³¨å…¶ä¸­çš„AIåº”ç”¨åŠç›¸å…³è½¯ç¡¬ä»¶èµ„æºã€‚å®ƒçš„æ ¸å¿ƒåŠŸèƒ½ä¸»è¦æœ‰å¦‚ä¸‹å‡ ç‚¹ã€‚</p><ul><li><strong>èµ„æºç›‘æ§å’Œç®¡ç†</strong></li></ul><p>ç®—åŠ›è°ƒåº¦å¹³å°é¦–å…ˆéœ€è¦ç›‘æ§å„ç§è®¡ç®—èµ„æºï¼ŒåŒ…æ‹¬CPUã€GPUã€TPUç­‰ï¼Œä»¥åŠå­˜å‚¨å’Œç½‘ç»œèµ„æºçš„ä½¿ç”¨æƒ…å†µã€‚é€šè¿‡æ”¶é›†å’Œåˆ†æè¿™äº›æ•°æ®ï¼Œå¹³å°å¯ä»¥å®æ—¶äº†è§£èµ„æºçš„è´Ÿè½½å’Œå¯ç”¨æ€§ï¼Œå¹¶è¿›è¡Œç›¸åº”çš„ç®¡ç†å’Œè°ƒæ•´ã€‚</p><ul><li><strong>ä»»åŠ¡è°ƒåº¦ä¸ä¼˜å…ˆçº§ç®¡ç†</strong></li></ul><p>ç®—åŠ›è°ƒåº¦å¹³å°éœ€è¦æ ¹æ®ä»»åŠ¡çš„ç±»å‹ã€ä¼˜å…ˆçº§å’Œéœ€æ±‚ï¼Œè¿›è¡Œæ™ºèƒ½çš„ä»»åŠ¡è°ƒåº¦ã€‚é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡é€šå¸¸ä¼šè¢«ä¼˜å…ˆåˆ†é…è®¡ç®—èµ„æºï¼Œä»¥ä¿è¯é‡è¦ä»»åŠ¡èƒ½å¤ŸåŠæ—¶å®Œæˆã€‚è€Œä½ä¼˜å…ˆçº§çš„ä»»åŠ¡åˆ™å¯èƒ½è¢«æ¨è¿Ÿæˆ–æš‚åœï¼Œä»¥ä¾¿è®©æ›´ç´§æ€¥çš„ä»»åŠ¡å¾—åˆ°æ›´å¤šèµ„æºã€‚</p><ul><li><strong>å¼¹æ€§æ‰©ç¼©å®¹</strong></li></ul><p>ç®—åŠ›è°ƒåº¦å¹³å°éœ€è¦å…·å¤‡å¼¹æ€§æ‰©ç¼©å®¹çš„èƒ½åŠ›ã€‚å½“ä»»åŠ¡é‡å¢åŠ æ—¶ï¼Œå¹³å°åº”èƒ½è‡ªåŠ¨æ‰©å±•è®¡ç®—èµ„æºï¼Œä»¥æ»¡è¶³éœ€æ±‚ã€‚è€Œåœ¨ä»»åŠ¡é‡å‡å°‘æ—¶ï¼Œå¹³å°ä¹Ÿèƒ½è‡ªåŠ¨é‡Šæ”¾å¤šä½™çš„èµ„æºï¼Œé¿å…èµ„æºæµªè´¹ã€‚</p><ul><li><strong>èµ„æºåˆ†é…ç­–ç•¥</strong></li></ul><p>ç®—åŠ›è°ƒåº¦å¹³å°éœ€è¦è®¾è®¡åˆç†çš„èµ„æºåˆ†é…ç­–ç•¥ï¼Œä»¥ç¡®ä¿æ¯ä¸ªä»»åŠ¡éƒ½èƒ½å¾—åˆ°è¶³å¤Ÿçš„è®¡ç®—èµ„æºï¼Œå¹¶ä¸”åœ¨ä¸åŒèµ„æºé—´å®ç°å‡è¡¡çš„è´Ÿè½½ã€‚è¿™éœ€è¦å¹³å°è€ƒè™‘åˆ°ä»»åŠ¡çš„å¤§å°ã€èµ„æºçš„ç±»å‹ã€ç½‘ç»œå»¶è¿Ÿç­‰å› ç´ ï¼Œåˆ¶å®šç›¸åº”çš„è°ƒåº¦ç­–ç•¥ã€‚</p><ul><li><strong>ä»»åŠ¡è¿ç§»ä¸å®¹é”™</strong></li></ul><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç¡¬ä»¶æ•…éšœæˆ–å…¶ä»–æ„å¤–æƒ…å†µéš¾å…å‘ç”Ÿã€‚ç®—åŠ›è°ƒåº¦å¹³å°åº”å…·å¤‡ä»»åŠ¡è¿ç§»å’Œå®¹é”™çš„èƒ½åŠ›ï¼Œä½¿å¾—ä»»åŠ¡å¯ä»¥ä»ä¸€ä¸ªæ•…éšœèŠ‚ç‚¹æ— ç¼è¿ç§»åˆ°å…¶ä»–æ­£å¸¸èŠ‚ç‚¹ä¸Šï¼Œä¿è¯ä»»åŠ¡çš„å¯é æ‰§è¡Œã€‚</p><ul><li><strong>å®‰å…¨å’Œåˆè§„</strong></li></ul><p>ç¡®ä¿è®¡ç®—ä»»åŠ¡åœ¨å®‰å…¨çš„ç¯å¢ƒä¸­æ‰§è¡Œï¼Œç®¡ç†ç”¨æˆ·çš„è®¿é—®æƒé™ï¼Œä¿æŠ¤æ•°æ®çš„å®‰å…¨æ€§å’Œéšç§ã€‚</p><h1 id="4-ç®—åŠ›è°ƒåº¦å¹³å°çš„åº”ç”¨åœºæ™¯"><a href="#4-ç®—åŠ›è°ƒåº¦å¹³å°çš„åº”ç”¨åœºæ™¯" class="headerlink" title="4 ç®—åŠ›è°ƒåº¦å¹³å°çš„åº”ç”¨åœºæ™¯"></a>4 ç®—åŠ›è°ƒåº¦å¹³å°çš„åº”ç”¨åœºæ™¯</h1><p>   åº”ç”¨åœºæ™¯åŒ…æ‹¬å¦‚ä¸‹ï¼Œå¯èƒ½è¿˜æœ‰æ›´å¤šå†…å®¹ä¸”è¿˜åœ¨å‘å±•æ›´æ–°ä¸­ï¼Œç¬”è€…çŸ¥è¯†é¢ä¸æ°´å¹³æœ‰é™æœªèƒ½å…¨éƒ¨åˆ—ä¸¾å‡ºæ¥ï¼š</p><ul><li><strong>AIè®­ç»ƒä¸æ¨ç†ï¼š</strong></li></ul><p>åœ¨AIå¤§æ¨¡å‹è®­ç»ƒå’Œæ¨ç†è¿‡ç¨‹ä¸­ï¼Œç®—åŠ›è°ƒåº¦å¹³å°èƒ½å¤Ÿå®ç°è·¨èµ„æºæ± ã€è·¨æ¶æ„ã€è·¨å‚å•†çš„å¼‚æ„ç®—åŠ›èµ„æºè°ƒåº¦ï¼Œæ»¡è¶³AIè®­ç»ƒä½œä¸šçš„é«˜ç®—åŠ›éœ€æ±‚ã€‚</p><ul><li><strong>äº‘è®¡ç®—ä¸æ•°æ®ä¸­å¿ƒï¼š</strong></li></ul><p>åœ¨äº‘è®¡ç®—å’Œæ•°æ®ä¸­å¿ƒé¢†åŸŸï¼Œç®—åŠ›è°ƒåº¦å¹³å°èƒ½å¤Ÿæ•´åˆä¸åŒæ¥æºã€ç±»å‹å’Œæ¶æ„çš„ç®—åŠ›èµ„æºï¼Œä¸ºç”¨æˆ·æä¾›æŒ‰éœ€è·å–å’Œè°ƒåº¦çš„æœåŠ¡ã€‚</p><ul><li><strong>æ™ºæ…§åŸå¸‚ä¸ç‰©è”ç½‘ï¼š</strong></li></ul><p>åœ¨æ™ºæ…§åŸå¸‚å’Œç‰©è”ç½‘é¢†åŸŸï¼Œç®—åŠ›è°ƒåº¦å¹³å°èƒ½å¤Ÿå®ç°å¯¹æµ·é‡æ•°æ®çš„å¿«é€Ÿå¤„ç†å’Œåˆ†æï¼Œä¸ºåŸå¸‚ç®¡ç†å’Œç‰©è”ç½‘åº”ç”¨æä¾›å¼ºå¤§çš„ç®—åŠ›æ”¯æŒã€‚</p><p>   ç®—åŠ›è°ƒåº¦å¹³å°ä½œä¸ºæ¨åŠ¨æˆ‘å›½æ•°å­—ç»æµå‘å±•çš„é‡è¦åŸºç¡€è®¾æ–½ä¹‹ä¸€ï¼Œå…·æœ‰å¹¿é˜”çš„å‘å±•å‰æ™¯å’Œåº”ç”¨ç©ºé—´ã€‚éšç€æŠ€æœ¯çš„ä¸æ–­è¿›æ­¥å’Œåº”ç”¨åœºæ™¯çš„ä¸æ–­æ‹“å±•ï¼Œç®—åŠ›è°ƒåº¦å¹³å°å°†åœ¨æœªæ¥å‘æŒ¥æ›´åŠ é‡è¦çš„ä½œç”¨ã€‚æœªæ¥ï¼Œéšç€å…¨å›½ä¸€ä½“åŒ–ç®—åŠ›è°ƒåº¦å¹³å°çš„å»ºè®¾å°†æœ‰åˆ©äºå…¨å›½ç®—åŠ›ä¾›éœ€çš„ç²¾å‡†å¯¹æ¥ï¼Œæ¨åŠ¨ç®—åŠ›åƒæ°´ç”µç…¤æ°”ç½‘ä¸€æ ·â€œéšæ—¶éšåœ°ã€å³å–å³ç”¨â€ã€‚</p><h1 id="5-å‚è€ƒæ–‡ç« "><a href="#5-å‚è€ƒæ–‡ç« " class="headerlink" title="5 å‚è€ƒæ–‡ç« "></a>5 å‚è€ƒæ–‡ç« </h1><p>ï¼ˆ1ï¼‰å›½å®¶ä¿¡æ¯ä¸­å¿ƒåœ¨2020å¹´12æœˆä»½å‘å¸ƒçš„ã€Šæ™ºèƒ½è®¡ç®—ä¸­å¿ƒè§„åˆ’å»ºè®¾æŒ‡å—å…¨æ–‡ã€‹</p><p>ï¼ˆ2ï¼‰<a href="https://www.cloudchef.io/h-nd-303.html">https://www.cloudchef.io/h-nd-303.html</a></p><p>ï¼ˆ3ï¼‰Imaginationå®˜æ–¹åšå®¢</p><p>â€‹     æœ¬æ–‡ä¸ªäººå­¦ä¹ åçš„å†…å®¹æ€»ç»“ï¼Œå¦‚æœè§‰å¾—æœ‰ç”¨ï¼Œæ¬¢è¿ç‚¹èµä¸åœ¨çœ‹ï¼<img src="https://res.wx.qq.com/t/wx_fed/we-emoji/res/assets/Expression/Expression_82@2x.png" alt="img" style="zoom:25%;" /></p><p>â€‹     åç»­å¦‚æœ‰å®Œå–„æˆ–ä¿®æ­£ï¼Œå°†ç»§ç»­æ›´æ–°æ­¤åšå®¢ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>ç®—åŠ›åŠè°ƒåº¦</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç®—åŠ›è°ƒåº¦ ç®—åŠ›æ± åŒ– ç®—åŠ›æœåŠ¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>docker-composeæœ¬åœ°éƒ¨ç½²FastGPTä¸ç®€å•ä½¿ç”¨</title>
    <link href="/2024/12/07/docker-compose%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2FastGPT%E4%B8%8E%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
    <url>/2024/12/07/docker-compose%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2FastGPT%E4%B8%8E%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€èƒŒæ™¯ä¸ç¯å¢ƒè¯´æ˜">ä¸€ã€èƒŒæ™¯ä¸ç¯å¢ƒè¯´æ˜</h1><p>æœ¬æ–‡ä¸»è¦å¯¹å¦‚ä½•åœ¨æœ¬åœ°éƒ¨ç½²FastGPTè¿›è¡Œè®°å½•ä¸è¯´æ˜ï¼Œå› ä¸ºç¬”è€…æš‚æ—¶ä¸æ˜¯ä¸“é—¨ä»äº‹AIä¸å¤§æ¨¡å‹ç ”ç©¶å·¥ä½œä¸”ç›®å‰ç†è§£ä¸å¤Ÿï¼Œæ‰€ä»¥è¿˜ä¸èƒ½å¯¹å…¶ä¸­é…ç½®ç»†èŠ‚ä¸åŸç†é˜è¿°æ¸…æ¥šï¼Œæœ‰å¾…åç»­å‘æ˜ã€‚</p><table><thead><tr class="header"><th>ä¸»æœºå</th><th>IP</th><th>æ“ä½œç³»ç»Ÿ</th><th>è§„æ ¼</th><th>GPUæƒ…å†µ</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr class="odd"><td>t1-gpu</td><td>10.12.62.25</td><td>Ubuntu 20.04.3 LTS -amd64</td><td>8c16g+400G</td><td>NVIDIA A10*1</td><td>éƒ¨ç½²m3eå‘é‡æ¨¡å‹</td></tr><tr class="even"><td>controller01</td><td>172.20.0.21</td><td>Ubuntu 20.04.3 LTS -amd64</td><td>16c64g+400G</td><td>æ— </td><td>éƒ¨ç½²å…¶ä»–æ‰€æœ‰æœåŠ¡æˆ–è¿›ç¨‹</td></tr></tbody></table><h1 id="äºŒollamaå®‰è£…ä¸ä½¿ç”¨">äºŒã€ollamaå®‰è£…ä¸ä½¿ç”¨</h1><p>ollamaå®˜ç½‘ï¼šwww.ollama.com</p><p>ollamaçš„githubä»“åº“åœ°å€ï¼šhttps://github.com/ollama/ollama</p><p>é€šè¿‡ollmaä¸‹è½½æ¨¡å‹ï¼šollama pull æ¨¡å‹é“¾æ¥ï¼Œ æ¨¡å‹é“¾æ¥æŸ¥çœ‹åœ°å€ï¼šhttps://www.ollama.com/library</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä»¥ä¸‹æ“ä½œåœ¨172.20.0.21ä¸Šæ“ä½œï¼Œæ“ä½œç³»ç»Ÿæ˜¯Ubuntu 20.04.3 LTS -amd64</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç›¸å…³æ“ä½œåœ¨ä¸€ä¸ªåä¸ºself-llmçš„condaç¯å¢ƒæ‰§è¡Œï¼š</span><br>conda activate /root/miniconda3/envs/self-llm<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ollamaçš„systemd serviceé…ç½®æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿®æ”¹ollamaçš„systemd serviceé…ç½®æ–‡ä»¶</span><br>(self-llm) root@controller01:~# vi /etc/systemd/system/ollama.service<br>[Unit]<br>Description=Ollama Service<br>After=network-online.target<br>[Service]<br>ExecStart=/usr/local/bin/ollama serve<br>User=ollama<br>Group=ollama<br>Restart=always<br>RestartSec=3<br>Environment=&quot;PATH=/root/anaconda3/envs/graphrag-test/bin:...&quot;<br>Environment=&quot;OLLAMA_HOST=0.0.0.0&quot;   #æ·»åŠ æ­¤è¡Œå†…å®¹ï¼ˆå¦åˆ™åé¢dockerå®¹å™¨åŒ–éƒ¨ç½²çš„open-webuiä¸èƒ½è¯»å–åˆ°æ­¤æœåŠ¡å™¨ä¸Šçš„æ¨¡å‹ï¼‰<br>[Install]<br>WantedBy=default.target<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é‡å¯ollamaæœåŠ¡</span><br>(self-llm) root@controller01:~# systemctl daemon-reload<br>(self-llm) root@controller01:~# systemctl restart ollama<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹ollamaç®¡ç†çš„æ¨¡å‹</span><br>(self-llm) root@controller01:~# ollama list<br>NAME                                    ID              SIZE    MODIFIED     <br>qwen:0.5b                               b5dc5e784f2a    394 MB  5 hours ago <br>deepseek-coder:1.3b                     3ddd2d3fc8d2    776 MB  6 hours ago <br>quentinz/bge-large-zh-v1.5:latest       bc8ca0995fcd    651 MB  3 months ago<br>gemma2:9b                               ff02c3702f32    5.4 GB  3 months ago<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹ollamaå‘½ä»¤çš„ç”¨æ³•</span><br>(self-llm) root@controller01:~# ollama <br>Usage:<br>  ollama [flags]<br>  ollama [command]<br><br>Available Commands:<br>  serve       Start ollama<br>  create      Create a model from a Modelfile<br>  show        Show information for a model<br>  run         Run a model<br>  pull        Pull a model from a registry<br>  push        Push a model to a registry<br>  list        List models<br>  ps          List running models<br>  cp          Copy a model<br>  rm          Remove a model<br>  help        Help about any command<br><br>Flags:<br>  -h, --help      help for ollama<br>  -v, --version   Show version information<br><br>Use &quot;ollama [command] --help&quot; for more information about a command.<br></code></pre></td></tr></table></figure><p>ä»ollamaå®˜ç½‘çš„æ¨¡å‹åˆ—è¡¨ä¸­æŸ¥çœ‹æŸä¸ªå…·ä½“æ¨¡å‹çš„ä¿¡æ¯ï¼š</p><figure><img src="https://s2.loli.net/2024/12/07/eiaMLGkXj56rHRF.png" alt="image-20241111100916875" /><figcaption aria-hidden="true">image-20241111100916875</figcaption></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">é€šè¿‡ollamaè¿è¡Œä¸Šè¿°æ¨¡å‹ï¼Œå¦‚æœæ¨¡å‹æ–‡ä»¶æœ¬èº«ä¸å­˜åœ¨ï¼Œollamaä¼šå…ˆå»ä¸‹è½½æ¨¡å‹æ–‡ä»¶æœ¬èº«åˆ°æœ¬åœ°</span><br>(self-llm) root@controller01:~# ollama run deepseek-coder:1.3b<br>pulling manifest <br>pulling d040cc185215... 100% â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– 776 MB <br>pulling a3a0e9449cb6... 100% â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– 13 KB         <br>pulling 8893e08fa9f9... 100% â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– 59 B           <br>pulling 8972a96b8ff1... 100% â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– 297 B         <br>pulling d55c9eb1669a... 100% â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– 483 B         <br>verifying sha256 digest <br>writing manifest <br>removing any unused layers <br>success <br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; ä½ æ˜¯è°ï¼Ÿ                      <span class="hljs-comment">#æ­¤å¤„å°±å¯ä»¥è¾“å…¥é—®é¢˜è¿›è¡Œæé—®ã€‚å¦‚æœè¦ç»“æŸè¿è¡Œå°±è¾“å…¥â€œctrl+dâ€</span></span><br></code></pre></td></tr></table></figure><h2 id="dockeréƒ¨ç½²open-webui">2.1 dockeréƒ¨ç½²open webui</h2><p>å®˜ç½‘åœ°å€ï¼šhttps://github.com/open-webui/open-webui</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">é€šè¿‡å®¹å™¨æ–¹å¼å¯åŠ¨ä¸è¿è¡Œ</span><br>(self-llm) root@controller01:~# docker run -d -p 18080:8080 --add-host=host.docker.internal:host-gateway -v open-webui:/app/backend/data --name open-webui --restart always ghcr.io/open-webui/open-webui:main<br></code></pre></td></tr></table></figure><p>ç„¶åå¯ä»¥é€šè¿‡æœåŠ¡å™¨IP+18080ç«¯å£ï¼Œå³ http://172.20.0.21:18080 è®¿é—® open webuiçš„webç•Œé¢ã€‚</p><figure><img src="https://s2.loli.net/2024/12/07/IVGKa9ANP5FpC2f.png" alt="image-20241111150810100" /><figcaption aria-hidden="true">image-20241111150810100</figcaption></figure><p>ç¬¬ä¸€æ¬¡ç™»å½•éœ€è¦æ³¨å†Œä¸€ä¸ªç”¨æˆ·ï¼Œç„¶åä½¿ç”¨æ­¤ç”¨æˆ·ç™»å½•ä¸ä½¿ç”¨ã€‚</p><p>é€‰æ‹©ä¸€ä¸ªollamaç®¡ç†çš„æ¨¡å‹ï¼Œç„¶åå¯ä»¥è¿›è¡Œå¯¹è¯ï¼š</p><figure><img src="https://s2.loli.net/2024/12/07/TaDLvesCHEWP1qr.png" alt="image-20241111162231984" /><figcaption aria-hidden="true">image-20241111162231984</figcaption></figure><figure><img src="https://s2.loli.net/2024/12/07/IogtvyiHPr917Ff.png" alt="image-20241111172408647" /><figcaption aria-hidden="true">image-20241111172408647</figcaption></figure><h1 id="ä¸‰docker-composeå¿«é€Ÿéƒ¨ç½²fastgpt">ä¸‰ã€Docker composeå¿«é€Ÿéƒ¨ç½²fastgpt</h1><h2 id="fastgptä»‹ç»">3.1 FastGPTä»‹ç»</h2><p>FastGPT æ˜¯ä¸€ä¸ªåŸºäº LLM å¤§è¯­è¨€æ¨¡å‹çš„çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿï¼Œæä¾›å¼€ç®±å³ç”¨çš„æ•°æ®å¤„ç†ã€æ¨¡å‹è°ƒç”¨ç­‰èƒ½åŠ›ã€‚åŒæ—¶å¯ä»¥é€šè¿‡ Flow å¯è§†åŒ–è¿›è¡Œå·¥ä½œæµç¼–æ’ï¼Œä»è€Œå®ç°å¤æ‚çš„é—®ç­”åœºæ™¯ï¼FastGPT æ˜¯å¼€æºé¡¹ç›®ï¼Œéµå¾ªé™„åŠ æ¡ä»¶ Apache License 2.0 å¼€æºåè®®ï¼Œå¯ä»¥ <a href="https://github.com/labring/FastGPT/fork">Fork</a> ä¹‹åè¿›è¡ŒäºŒæ¬¡å¼€å‘å’Œå‘å¸ƒã€‚FastGPT ç¤¾åŒºç‰ˆå°†ä¿ç•™æ ¸å¿ƒåŠŸèƒ½ï¼Œå•†ä¸šç‰ˆä»…åœ¨ç¤¾åŒºç‰ˆåŸºç¡€ä¸Šä½¿ç”¨ API çš„å½¢å¼è¿›è¡Œæ‰©å±•ï¼Œä¸å½±å“å­¦ä¹ ä½¿ç”¨ã€‚</p><h3 id="fastgpt-èƒ½åŠ›">3.1.1 FastGPT èƒ½åŠ›</h3><h4 id="ä¸“å±-ai-å®¢æœ">3.1.1.1 ä¸“å± AI å®¢æœ</h4><p>é€šè¿‡å¯¼å…¥æ–‡æ¡£æˆ–å·²æœ‰é—®ç­”å¯¹è¿›è¡Œè®­ç»ƒï¼Œè®© AI æ¨¡å‹èƒ½æ ¹æ®ä½ çš„æ–‡æ¡£ä»¥äº¤äº’å¼å¯¹è¯æ–¹å¼å›ç­”é—®é¢˜ã€‚</p><h4 id="ç®€å•æ˜“ç”¨çš„å¯è§†åŒ–ç•Œé¢">3.1.1.2 ç®€å•æ˜“ç”¨çš„å¯è§†åŒ–ç•Œé¢</h4><p>FastGPT é‡‡ç”¨ç›´è§‚çš„å¯è§†åŒ–ç•Œé¢è®¾è®¡ï¼Œä¸ºå„ç§åº”ç”¨åœºæ™¯æä¾›äº†ä¸°å¯Œå®ç”¨çš„åŠŸèƒ½ã€‚é€šè¿‡ç®€æ´æ˜“æ‡‚çš„æ“ä½œæ­¥éª¤ï¼Œå¯ä»¥è½»æ¾å®Œæˆ AI å®¢æœçš„åˆ›å»ºå’Œè®­ç»ƒæµç¨‹ã€‚</p><h4 id="è‡ªåŠ¨æ•°æ®é¢„å¤„ç†">3.1.1.3 è‡ªåŠ¨æ•°æ®é¢„å¤„ç†</h4><p>æä¾›æ‰‹åŠ¨è¾“å…¥ã€ç›´æ¥åˆ†æ®µã€LLM è‡ªåŠ¨å¤„ç†å’Œ CSV ç­‰å¤šç§æ•°æ®å¯¼å…¥é€”å¾„ï¼Œå…¶ä¸­â€œç›´æ¥åˆ†æ®µâ€æ”¯æŒé€šè¿‡ PDFã€WORDã€Markdown å’Œ CSV æ–‡æ¡£å†…å®¹ä½œä¸ºä¸Šä¸‹æ–‡ã€‚FastGPT ä¼šè‡ªåŠ¨å¯¹æ–‡æœ¬æ•°æ®è¿›è¡Œé¢„å¤„ç†ã€å‘é‡åŒ–å’Œ QA åˆ†å‰²ï¼ŒèŠ‚çœæ‰‹åŠ¨è®­ç»ƒæ—¶é—´ï¼Œæå‡æ•ˆèƒ½ã€‚</p><h4 id="å·¥ä½œæµç¼–æ’">3.1.1.4 å·¥ä½œæµç¼–æ’</h4><p>åŸºäº Flow æ¨¡å—çš„å·¥ä½œæµç¼–æ’ï¼Œå¯ä»¥å¸®åŠ©ä½ è®¾è®¡æ›´åŠ å¤æ‚çš„é—®ç­”æµç¨‹ã€‚ä¾‹å¦‚æŸ¥è¯¢æ•°æ®åº“ã€æŸ¥è¯¢åº“å­˜ã€é¢„çº¦å®éªŒå®¤ç­‰ã€‚</p><h4 id="å¼ºå¤§çš„-api-é›†æˆ">3.1.1.5 å¼ºå¤§çš„ API é›†æˆ</h4><p>FastGPT å¯¹å¤–çš„ API æ¥å£å¯¹é½äº† OpenAI å®˜æ–¹æ¥å£ï¼Œå¯ä»¥ç›´æ¥æ¥å…¥ç°æœ‰çš„ GPT åº”ç”¨ï¼Œä¹Ÿå¯ä»¥è½»æ¾é›†æˆåˆ°ä¼ä¸šå¾®ä¿¡ã€å…¬ä¼—å·ã€é£ä¹¦ç­‰å¹³å°ã€‚</p><h3 id="å…¶ä»–è¯´æ˜">3.1.2 å…¶ä»–è¯´æ˜</h3><p>å‚è€ƒï¼šhttps://doc.tryfastgpt.ai/docs/development/docker/</p><ul><li>MongoDBï¼šç”¨äºå­˜å‚¨é™¤äº†å‘é‡å¤–çš„å„ç±»æ•°æ®</li><li>PostgreSQL/Milvusï¼šå­˜å‚¨å‘é‡æ•°æ®</li><li>OneAPI: èšåˆå„ç±» AI APIï¼Œæ”¯æŒå¤šæ¨¡å‹è°ƒç”¨ ï¼ˆä»»ä½•æ¨¡å‹é—®é¢˜ï¼Œå…ˆè‡ªè¡Œé€šè¿‡ OneAPI æµ‹è¯•æ ¡éªŒï¼‰</li></ul><h2 id="å®‰è£…docker-å’Œ-docker-compose">3.2 å®‰è£…docker å’Œ docker-compose</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">å®‰è£… Docker</span><br>curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun<br>systemctl enable --now docker<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å®‰è£… docker-compose</span><br>curl -L https://github.com/docker/compose/releases/download/v2.20.3/docker-compose-`uname -s`-`uname -m` -o /usr/bin/docker-compose<br>chmod +x /usr/bin/docker-compose<br><span class="hljs-meta prompt_"># </span><span class="language-bash">éªŒè¯å®‰è£…</span><br>docker -v<br>docker-compose -v<br></code></pre></td></tr></table></figure><h2 id="ä¸‹è½½docker-compose.yml">3.3 ä¸‹è½½docker-compose.yml</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:~# conda activate /root/miniconda3/envs/self-llm<br>root@controller01:~# cd /root/miniconda3/envs/self-llm<br>(self-llm) root@controller01:~/miniconda3/envs/self-llm# mkdir fastgpt<br>(self-llm) root@controller01:~/miniconda3/envs/self-llm# cd fastgpt<br>(self-llm) root@controller01:~/miniconda3/envs/self-llm# wget https://raw.githubusercontent.com/labring/FastGPT/refs/heads/main/projects/app/data/config.json<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">pgvector ç‰ˆæœ¬(æµ‹è¯•æ¨èï¼Œç®€å•å¿«æ·)</span><br>(self-llm) root@controller01:~/miniconda3/envs/self-llm# curl -o docker-compose.yml https://raw.githubusercontent.com/labring/FastGPT/main/files/docker/docker-compose-pgvector.yml<br><br>(self-llm) root@controller01:~/miniconda3/envs/self-llm/fastgpt# cp -p docker-compose-pgvector.yml docker-compose.yml <br>(self-llm) root@controller01:~/miniconda3/envs/self-llm/fastgpt# ll<br>total 32<br>drwxr-xr-x  2 root root 4096 Nov  7 16:26 ./<br>drwxr-xr-x 14 root root 4096 Nov  7 16:35 ../<br>-rw-r--r--  1 root root 6771 Nov  7 16:25 config.json<br>-rw-r--r--  1 root root 5644 Nov  7 16:26 docker-compose-pgvector.yml<br>-rw-r--r--  1 root root 5644 Nov  7 16:26 docker-compose.yml<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">1ï¼‰ç¼–è¾‘docker-compose.ymlï¼Œä½¿ç”¨é˜¿é‡Œäº‘é•œåƒ</span><br>(self-llm) root@controller01:~/miniconda3/envs/self-llm/fastgpt# vi docker-compose.yml<br>(self-llm) root@controller01:~/miniconda3/envs/self-llm/fastgpt# grep &quot;image:&quot; docker-compose.yml <br>    #image: pgvector/pgvector:0.7.0-pg15 # docker hub<br>    image: registry.cn-hangzhou.aliyuncs.com/fastgpt/pgvector:v0.7.0 # é˜¿é‡Œäº‘<br>    #image: mongo:5.0.18 # dockerhub<br>    image: registry.cn-hangzhou.aliyuncs.com/fastgpt/mongo:5.0.18 # é˜¿é‡Œäº‘<br>    # image: mongo:4.4.29 # cpuä¸æ”¯æŒAVXæ—¶å€™ä½¿ç”¨<br>    #image: ghcr.io/labring/fastgpt-sandbox:v4.8.11 # git<br>    image: registry.cn-hangzhou.aliyuncs.com/fastgpt/fastgpt-sandbox:v4.8.11 # é˜¿é‡Œäº‘<br>    #image: ghcr.io/labring/fastgpt:v4.8.11 # git<br>    image: registry.cn-hangzhou.aliyuncs.com/fastgpt/fastgpt:v4.8.11 # é˜¿é‡Œäº‘<br>    image: registry.cn-hangzhou.aliyuncs.com/fastgpt/mysql:8.0.36 # é˜¿é‡Œäº‘<br>    #image: mysql:8.0.36<br>    #image: ghcr.io/songquanpeng/one-api:v0.6.7<br>    image: registry.cn-hangzhou.aliyuncs.com/fastgpt/one-api:v0.6.6 # é˜¿é‡Œäº‘<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">2ï¼‰ä¿®æ”¹mysqlå®¹å™¨åœ¨å®¿ä¸»æœºä¸Šçš„æ˜ å°„ç«¯å£ä¸º3307ï¼ˆæˆ‘å®¿ä¸»æœºä¸Š3307ç«¯å£å·²ç»è¢«å…¶ä»–æœåŠ¡å ç”¨äº†ï¼‰</span><br>(self-llm) root@controller01:~/miniconda3/envs/self-llm/fastgpt# vi docker-compose.yml<br><span class="hljs-meta prompt_">   # </span><span class="language-bash">oneapi</span><br>   mysql:<br>     image: registry.cn-hangzhou.aliyuncs.com/fastgpt/mysql:8.0.36 # é˜¿é‡Œäº‘<br>     #image: mysql:8.0.36<br>     container_name: mysql<br>     restart: always<br>     ports:<br>       - 3307:3306           #æ­¤ä¿®æ”¹æ­¤å¤„<br>     networks:<br>       - fastgpt<br>     command: --default-authentication-plugin=mysql_native_password<br>     environment:<br>       # é»˜è®¤rootå¯†ç ï¼Œä»…é¦–æ¬¡è¿è¡Œæœ‰æ•ˆ<br>       MYSQL_ROOT_PASSWORD: oneapimmysql<br>       MYSQL_DATABASE: oneapi<br>     volumes:<br>       - ./mysql:/var/lib/mysql<br>   oneapi:<br>     container_name: oneapi<br>     #image: ghcr.io/songquanpeng/one-api:v0.6.7<br>     image: registry.cn-hangzhou.aliyuncs.com/fastgpt/one-api:v0.6.6 # é˜¿é‡Œäº‘<br>     ports:<br>       - 3001:3000<br>     depends_on:<br>       - mysql<br>     networks:<br>       - fastgpt<br>     restart: always<br>     environment:<br>       # mysql è¿æ¥å‚æ•°<br>       - SQL_DSN=root:oneapimmysql@tcp(mysql:3306)/oneapi<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">3ï¼‰ä¿®æ”¹OPENAI_BASE_URLçš„å€¼ï¼ŒCHAT_API_KEYçš„å€¼æš‚æ—¶ä¸å˜åç»­å†æ”¹</span><br>(self-llm) root@controller01:~/miniconda3/envs/self-llm/fastgpt# vi docker-compose.yml<br><span class="hljs-meta prompt_"># </span><span class="language-bash">AIæ¨¡å‹çš„APIåœ°å€å“¦ã€‚åŠ¡å¿…åŠ  /v1ã€‚è¿™é‡Œé»˜è®¤å¡«å†™äº†OneApiçš„è®¿é—®åœ°å€ã€‚</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##- OPENAI_BASE_URL=http://oneapi:3000/v1</span></span><br>- OPENAI_BASE_URL=http://172.20.0.21:3001/v1<br><span class="hljs-meta prompt_"># </span><span class="language-bash">AIæ¨¡å‹çš„API Keyã€‚ï¼ˆè¿™é‡Œé»˜è®¤å¡«å†™äº†OneAPIçš„å¿«é€Ÿé»˜è®¤keyï¼Œæµ‹è¯•é€šåï¼ŒåŠ¡å¿…åŠæ—¶ä¿®æ”¹ï¼‰</span><br>- CHAT_API_KEY=sk-fastgpt<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">4ï¼‰åœ¨oneapiå®¹å™¨åï¼Œå†æ·»åŠ ä¸€ä¸ªm3eå®¹å™¨</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">(self-llm) root@controller01:~/miniconda3/envs/self-llm/fastgpt# vi docker-compose.yml</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"> m3e:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   image: registry.cn-hangzhou.aliyuncs.com/fastgpt_docker/m3e-large-api:latest</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   container_name: m3e</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   restart: always</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   ports:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">     - 6008:6008</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   networks:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">     - fastgpt</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   deploy:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">     resources:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">       reservations:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">         devices:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">           - driver: nvidia</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">             count: 1</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">             capabilities: [gpu]</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç›¸å…³å®¹å™¨è¯´æ˜ï¼š</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">pgvectorï¼šå‘é‡æ•°æ®åº“</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">mongdbï¼šå­˜å‚¨ç”¨æˆ·ä¿¡æ¯ã€æ–‡ä»¶æ–‡æ¡£ä¿¡æ¯</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">fastgptï¼šä¸»ç¨‹åºï¼Œå…¶ä¸­ç”¨åˆ°äº†config.jsonæ–‡ä»¶</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">mysqlï¼š</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">oneapiï¼šæ¥å£ç»Ÿä¸€</span><br><br></code></pre></td></tr></table></figure><h2 id="å¯åŠ¨m3eå‘é‡æ¨¡å‹">3.4 å¯åŠ¨m3eå‘é‡æ¨¡å‹</h2><p>å¯åŠ¨m3eå‘é‡æ¨¡å‹(å¦‚æœåœ¨docker-compose.ymä¸­æ²¡é…ç½®)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯åŠ¨m3eå‘é‡æ¨¡å‹åœ¨ä¸Šè¿°è¯´æ˜çš„å®‰è£…æœ‰ä¸€ä¸ªNVIDIA A10 GPUçš„æœåŠ¡å™¨t1-gpuï¼ˆipï¼š10.12.62.25ï¼‰ä¸Šæ“ä½œ</span><br>docker pull registry.cn-hangzhou.aliyuncs.com/fastgpt_docker/m3e-large-api:latest<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">GPUæ¨¡å¼å¯åŠ¨ï¼Œ å¹¶æŠŠm3eåŠ è½½åˆ°fastgptåŒä¸€ä¸ªç½‘ç»œï¼ˆä½¿ç”¨ä¸€å¼ å¡ï¼š--gpus=<span class="hljs-string">&#x27;&quot;device=0&quot;&#x27;</span>ï¼›ä½¿ç”¨ç¬¬0,1å¼ å¡ï¼š--gpus=<span class="hljs-string">&#x27;&quot;device=0,1&quot;&#x27;</span>ï¼›ä½¿ç”¨å…¨éƒ¨GPUï¼š--gpus allï¼‰ã€‚ä»¥ä¸‹é»˜è®¤ä¼šå°†å®¹å™¨çš„6008ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºçš„6008ç«¯å£</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŒ‡å®šæ‰€æœ‰GPU</span><br>docker run -dt \<br>  --name m3e-large-api \<br>  --gpus all \<br>  --privileged \<br>  --net=host \<br>  --ipc=host \<br>  --ulimit memlock=-1 \<br>  --ulimit stack=67108864 \<br>  registry.cn-hangzhou.aliyuncs.com/fastgpt_docker/m3e-large-api:latest<br><span class="hljs-meta prompt_">#</span><span class="language-bash">é€šè¿‡åºå·æŒ‡å®šGPUï¼ˆæ­¤æ—¶ä¸è¦åŠ â€œ--privilegedâ€å‚æ•°ï¼Œå¦åˆ™ä»ç„¶å¯ä»¥çœ‹åˆ°æ‰€æœ‰GPUï¼‰</span><br>docker run -dt \<br>  --name m3e-large-api \<br>  --gpus=&#x27;&quot;device=0&quot;&#x27; \<br>  --net=host \<br>  --ipc=host \<br>  --ulimit memlock=-1 \<br>  --ulimit stack=67108864 \<br>  registry.cn-hangzhou.aliyuncs.com/fastgpt_docker/m3e-large-api:latest<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">###CPUæ¨¡å¼å¯åŠ¨ï¼Œ å¹¶æŠŠm3eåŠ è½½åˆ°fastgptåŒä¸€ä¸ªç½‘ç»œï¼ˆä¸å¿…è¦æ˜¯ä½¿ç”¨fastgptç½‘ç»œï¼‰</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##docker run -d -p 6008:6008 --name m3e --network fastgpt_fastgpt registry.cn-hangzhou.aliyuncs.com/fastgpt_docker/m3e-large-api:latest</span></span><br></code></pre></td></tr></table></figure><h2 id="ä¿®æ”¹-config.json-æ–‡ä»¶">3.5 ä¿®æ”¹ config.json æ–‡ä»¶</h2><p>FastGPT æ¨¡å‹é…ç½®è¯´æ˜ï¼šhttps://doc.tryfastgpt.ai/docs/development/modelconfig/intro/</p><p>å…³äºconfig.jsonæ–‡ä»¶çš„è¯´æ˜ï¼šhttps://github.com/labring/FastGPT/blob/main/projects/app/data/model.json</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨llmModelséƒ¨åˆ†æ·»åŠ å¦‚ä¸‹æ¨¡å‹é…ç½®</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å…¶ä¸­ deepseek-coder:1.3b æ˜¯å…ˆå‰é€šè¿‡ollamaå·²ç»æ‹‰å–ä¸‹æ¥çš„æ¨¡å‹</span><br>    &#123;<br>      &quot;model&quot;: &quot;deepseek-coder:1.3b&quot;,<br>      &quot;name&quot;: &quot;deepseek-coder:1.3b&quot;,<br>      &quot;avatar&quot;: &quot;/imgs/model/openai.svg&quot;,<br>      &quot;maxContext&quot;: 128000,<br>      &quot;maxResponse&quot;: 4000,<br>      &quot;quoteMaxToken&quot;: 100000,<br>      &quot;maxTemperature&quot;: 1.2,<br>      &quot;charsPointsPrice&quot;: 0,<br>      &quot;censor&quot;: false,<br>      &quot;vision&quot;: false,<br>      &quot;datasetProcess&quot;: true,<br>      &quot;usedInClassify&quot;: true,<br>      &quot;usedInExtractFields&quot;: true,<br>      &quot;usedInToolCall&quot;: true,<br>      &quot;usedInQueryExtension&quot;: true,<br>      &quot;toolChoice&quot;: false,<br>      &quot;functionCall&quot;: false,<br>      &quot;customCQPrompt&quot;: &quot;&quot;,<br>      &quot;customExtractPrompt&quot;: &quot;&quot;,<br>      &quot;defaultSystemChatPrompt&quot;: &quot;&quot;,<br>      &quot;defaultConfig&quot;: &#123;<br>        &quot;temperature&quot;: 1,<br>        &quot;stream&quot;: false<br>      &#125;,<br>      &quot;fieldMap&quot;: &#123;<br>        &quot;max_tokens&quot;: &quot;max_completion_tokens&quot;<br>      &#125;<br>    &#125;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨ vectorModels éƒ¨åˆ†æ·»åŠ å¦‚ä¸‹æ¨¡å‹é…ç½®ã€‚</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å…¶ä¸­è¿™ä¸ªm3eæ¨¡å‹å°±æ˜¯å…ˆå‰åœ¨docker-compose.ymæ–‡ä»¶ä¸­æ‰‹åŠ¨æ–°æ·»åŠ çš„å‘é‡æ¨¡å‹</span><br>    &#123;<br>      &quot;model&quot;: &quot;m3e&quot;,<br>      &quot;name&quot;: &quot;M3E&quot;,<br>      &quot;price&quot;: 0,<br>      &quot;defaultToken&quot;: 500,<br>      &quot;maxToken&quot;: 1800<br>    &#125;<br></code></pre></td></tr></table></figure><h2 id="å¯åŠ¨å®¹å™¨">3.6 å¯åŠ¨å®¹å™¨</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">(self-llm) root@controller01:~/miniconda3/envs/self-llm/fastgpt# docker-compose up -d<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯åŠ¨å®Œæˆåï¼ŒæŸ¥çœ‹å®¹å™¨åˆ—è¡¨</span><br>(self-llm) root@controller01:~/miniconda3/envs/self-llm/fastgpt# docker-compose ps<br>NAME                IMAGE                                                               COMMAND                  SERVICE             CREATED             STATUS              PORTS<br>fastgpt             registry.cn-hangzhou.aliyuncs.com/fastgpt/fastgpt:v4.8.11           &quot;sh -c &#x27;node --max-oâ€¦&quot;   fastgpt             39 seconds ago      Up 37 seconds       0.0.0.0:3000-&gt;3000/tcp, :::3000-&gt;3000/tcp<br>mongo               registry.cn-hangzhou.aliyuncs.com/fastgpt/mongo:5.0.18              &quot;bash -c &#x27;openssl raâ€¦&quot;   mongo               39 seconds ago      Up 37 seconds       0.0.0.0:27017-&gt;27017/tcp, :::27017-&gt;27017/tcp<br>mysql               registry.cn-hangzhou.aliyuncs.com/fastgpt/mysql:8.0.36              &quot;docker-entrypoint.sâ€¦&quot;   mysql               39 seconds ago      Up 37 seconds       33060/tcp, 0.0.0.0:3307-&gt;3306/tcp, :::3307-&gt;3306/tcp<br>oneapi              registry.cn-hangzhou.aliyuncs.com/fastgpt/one-api:v0.6.6            &quot;/one-api&quot;               oneapi              39 seconds ago      Up 35 seconds       0.0.0.0:3001-&gt;3000/tcp, :::3001-&gt;3000/tcp<br>pg                  registry.cn-hangzhou.aliyuncs.com/fastgpt/pgvector:v0.7.0           &quot;docker-entrypoint.sâ€¦&quot;   pg                  39 seconds ago      Up 37 seconds       0.0.0.0:5432-&gt;5432/tcp, :::5432-&gt;5432/tcp<br>sandbox             registry.cn-hangzhou.aliyuncs.com/fastgpt/fastgpt-sandbox:v4.8.11   &quot;docker-entrypoint.sâ€¦&quot;   sandbox             39 seconds ago      Up 37 seconds       <br></code></pre></td></tr></table></figure><h2 id="æ‰“å¼€-oneapi-æ·»åŠ æ¨¡å‹">3.7 æ‰“å¼€ OneAPI æ·»åŠ æ¨¡å‹</h2><p>å¯ä»¥é€šè¿‡<code>ip:3001</code>è®¿é—®OneAPIï¼Œé»˜è®¤è´¦å·ä¸º<code>root</code>å¯†ç ä¸º<code>123456</code>ã€‚</p><p>åœ¨OneApiä¸­æ·»åŠ åˆé€‚çš„AIæ¨¡å‹æ¸ é“ã€‚<a href="https://doc.tryfastgpt.ai/docs/development/one-api/">ç‚¹å‡»æŸ¥çœ‹ç›¸å…³æ•™ç¨‹</a></p><h3 id="ç™»å½•oneapi">3.7.1 ç™»å½•OneApi</h3><figure><img src="https://s2.loli.net/2024/11/07/DjFvZTXokm7AKuR.png" alt="image-20241107171404284" /><figcaption aria-hidden="true">image-20241107171404284</figcaption></figure><h3 id="åˆ›å»ºä»¤ç‰Œå’Œæ¸ é“">3.7.2 åˆ›å»ºä»¤ç‰Œå’Œæ¸ é“</h3><h4 id="åˆ›å»ºä»¤ç‰Œ">3.7.2.1 åˆ›å»ºä»¤ç‰Œ</h4><figure><img src="https://s2.loli.net/2024/12/07/hRwvzuoDTW15SpF.png" alt="image-20241113183540805" /><figcaption aria-hidden="true">image-20241113183540805</figcaption></figure><h4 id="åˆ›å»ºæ¸ é“">3.7.2.2 åˆ›å»ºæ¸ é“</h4><figure><img src="https://s2.loli.net/2024/11/07/E5r8mgfh9Bcz1Dw.png" alt="image-20241107172511431" /><figcaption aria-hidden="true">image-20241107172511431</figcaption></figure><figure><img src="https://s2.loli.net/2024/11/07/rdZ5Q2mSYkUiP4H.png" alt="image-20241107172632721" /><figcaption aria-hidden="true">image-20241107172632721</figcaption></figure><h5 id="åˆ›å»ºollamaæ¸ é“">3.7.2.1.1 åˆ›å»ºollamaæ¸ é“</h5><figure><img src="https://s2.loli.net/2024/12/07/BZh3bckW8KrVjRs.png" alt="image-20241113184117696" /><figcaption aria-hidden="true">image-20241113184117696</figcaption></figure><ul><li><strong>ä¸Šå›¾ä¸­Base URLæ ·ä¸­ï¼Œæ›´å»ºè®®å°†host.docker.internal æ¢æˆå¯¹åº”çš„ipåœ°å€ã€‚</strong></li><li>ä¸Šå›¾ä¸­åˆ›å»ºollamaæ¸ é“æ—¶ï¼Œæ¨¡å‹æ å¯ä»¥å°†ollamaä¸­å·²ç»æ‹‰å–åˆ°æ‰€æœ‰æ¨¡å‹éƒ½å¡«å†™è¿›å»ã€‚</li></ul><p>æäº¤åï¼Œå¯ä»¥ç‚¹å‡»"æµ‹è¯•"æŒ‰é’®è¿›è¡Œæµ‹è¯•ï¼š</p><figure><img src="https://s2.loli.net/2024/12/07/9PGFvrMk4AHBVqo.png" alt="image-20241113184505093" /><figcaption aria-hidden="true">image-20241113184505093</figcaption></figure><h5 id="åˆ›å»ºm3eæ¸ é“">3.7.2.1.2 åˆ›å»ºm3eæ¸ é“</h5><figure><img src="https://s2.loli.net/2024/12/07/AV516fy9PmYjrIs.png" alt="image-20241113185816938" /><figcaption aria-hidden="true">image-20241113185816938</figcaption></figure><figure><img src="https://s2.loli.net/2024/12/07/CS4NhUMVYX5vRor.png" alt="image-20241113190216645" /><figcaption aria-hidden="true">image-20241113190216645</figcaption></figure><p>æ­¤å¤„ m3e æ¸ é“æµ‹è¯•æ—¶æŠ¥404ï¼Œæš‚æ—¶ä¸ç†ä¼šã€‚</p><h2 id="é‡å¯fastgptç›¸å…³å®¹å™¨">3.8 é‡å¯fastgptç›¸å…³å®¹å™¨</h2><p><strong>å¤åˆ¶ ollama ä»¤ç‰Œçš„å¯†é’¥ï¼š</strong></p><figure><img src="https://s2.loli.net/2024/12/07/Tx34lGbOifz5vdc.png" alt="image-20241113190828105" /><figcaption aria-hidden="true">image-20241113190828105</figcaption></figure><p>sk-ZJ0I49yR2NYUG9mu326cF283380b46159d2b347eB00eD8E3</p><p><strong>ä¿®æ”¹docker.compose.ymlæ–‡ä»¶ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs shell">(self-llm) root@controller01:~/miniconda3/envs/self-llm/fastgpt# vi docker-compose.yml<br>...<br>  fastgpt:<br>    container_name: fastgpt<br>    #image: ghcr.io/labring/fastgpt:v4.8.11 # git<br>    image: registry.cn-hangzhou.aliyuncs.com/fastgpt/fastgpt:v4.8.11 # é˜¿é‡Œäº‘<br>    ports:<br>      - 3000:3000<br>    networks:<br>      - fastgpt<br>    depends_on:<br>      - mongo<br>      - pg<br>      - sandbox<br>      - oneapi<br>    restart: always<br>    environment:<br>      # root å¯†ç ï¼Œç”¨æˆ·åä¸º: rootã€‚å¦‚æœéœ€è¦ä¿®æ”¹ root å¯†ç ï¼Œç›´æ¥ä¿®æ”¹è¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œå¹¶é‡å¯å³å¯ã€‚<br>      - DEFAULT_ROOT_PSW=1234<br>      # AIæ¨¡å‹çš„APIåœ°å€å“¦ã€‚åŠ¡å¿…åŠ  /v1ã€‚è¿™é‡Œé»˜è®¤å¡«å†™äº†OneApiçš„è®¿é—®åœ°å€ã€‚<br>      ###- OPENAI_BASE_URL=http://oneapi:3000/v1<br>      - OPENAI_BASE_URL=http://172.20.0.21:3001/v1<br>      # AIæ¨¡å‹çš„API Keyã€‚ï¼ˆè¿™é‡Œé»˜è®¤å¡«å†™äº†OneAPIçš„å¿«é€Ÿé»˜è®¤keyï¼Œæµ‹è¯•é€šåï¼ŒåŠ¡å¿…åŠæ—¶ä¿®æ”¹ï¼‰<br>      #- CHAT_API_KEY=sk-fastgpt<br>      - CHAT_API_KEY=sk-ZJ0I49yR2NYUG9mu326cF283380b46159d2b347eB00eD8E3              #####ä¿®æ”¹è¿™é‡Œ<br>...<br></code></pre></td></tr></table></figure><p><strong>æ‰§è¡Œé‡å¯å®¹å™¨ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">(self-llm) root@controller01:~/miniconda3/envs/self-llm/fastgpt# docker-compose restart<br><br>(self-llm) root@controller01:~/miniconda3/envs/self-llm/fastgpt# docker-compose ps  <br>NAME                IMAGE                                                               COMMAND                  SERVICE             CREATED             STATUS              PORTS<br>fastgpt             registry.cn-hangzhou.aliyuncs.com/fastgpt/fastgpt:v4.8.11           &quot;sh -c &#x27;node --max-oâ€¦&quot;   fastgpt             8 seconds ago       Up 5 seconds        0.0.0.0:3000-&gt;3000/tcp, :::3000-&gt;3000/tcp<br>mongo               registry.cn-hangzhou.aliyuncs.com/fastgpt/mongo:5.0.18              &quot;bash -c &#x27;openssl raâ€¦&quot;   mongo               8 seconds ago       Up 6 seconds        0.0.0.0:27017-&gt;27017/tcp, :::27017-&gt;27017/tcp<br>mysql               registry.cn-hangzhou.aliyuncs.com/fastgpt/mysql:8.0.36              &quot;docker-entrypoint.sâ€¦&quot;   mysql               8 seconds ago       Up 6 seconds        33060/tcp, 0.0.0.0:3307-&gt;3306/tcp, :::3307-&gt;3306/tcp<br>oneapi              registry.cn-hangzhou.aliyuncs.com/fastgpt/one-api:v0.6.6            &quot;/one-api&quot;               oneapi              8 seconds ago       Up 5 seconds        0.0.0.0:3001-&gt;3000/tcp, :::3001-&gt;3000/tcp<br>pg                  registry.cn-hangzhou.aliyuncs.com/fastgpt/pgvector:v0.7.0           &quot;docker-entrypoint.sâ€¦&quot;   pg                  8 seconds ago       Up 6 seconds        0.0.0.0:5432-&gt;5432/tcp, :::5432-&gt;5432/tcp<br>sandbox             registry.cn-hangzhou.aliyuncs.com/fastgpt/fastgpt-sandbox:v4.8.11   &quot;docker-entrypoint.sâ€¦&quot;   sandbox             8 seconds ago       Up 7 seconds        <br></code></pre></td></tr></table></figure><h1 id="å››fastgptä¸­é…ç½®çŸ¥è¯†åº“ä¸åº”ç”¨">å››ã€FastGPTä¸­é…ç½®çŸ¥è¯†åº“ä¸åº”ç”¨</h1><p>ç›®å‰å¯ä»¥é€šè¿‡ <code>ip:3000</code> ç›´æ¥è®¿é—®(æ³¨æ„é˜²ç«å¢™)ã€‚ç™»å½•ç”¨æˆ·åä¸º <code>root</code>ï¼Œå¯†ç ä¸º<code>docker-compose.yml</code>ç¯å¢ƒå˜é‡é‡Œè®¾ç½®çš„ <code>DEFAULT_ROOT_PSW</code>ã€‚</p><p>å¦‚æœéœ€è¦åŸŸåè®¿é—®ï¼Œè¯·è‡ªè¡Œå®‰è£…å¹¶é…ç½® Nginxã€‚</p><p>é¦–æ¬¡è¿è¡Œï¼Œä¼šè‡ªåŠ¨åˆå§‹åŒ– root ç”¨æˆ·ï¼Œå¯†ç ä¸º <code>1234</code>ï¼ˆä¸ç¯å¢ƒå˜é‡ä¸­çš„<code>DEFAULT_ROOT_PSW</code>ä¸€è‡´ï¼‰ï¼Œæ—¥å¿—é‡Œä¼šæç¤ºä¸€æ¬¡<code>MongoServerError: Unable to read from a snapshot due to pending collection catalog changes;</code>å¯å¿½ç•¥ã€‚</p><figure><img src="https://s2.loli.net/2024/11/07/B2VQsCWbHkgwP6E.png" alt="image-20241107174345779" /><figcaption aria-hidden="true">image-20241107174345779</figcaption></figure><p>ç™»å½•åï¼Œé»˜è®¤æ˜¯æ²¡æœ‰å¯ç”¨çš„åº”ç”¨çš„ã€‚</p><h2 id="åˆ›å»ºé€šç”¨çŸ¥è¯†åº“">4.1 åˆ›å»ºé€šç”¨çŸ¥è¯†åº“</h2><figure><img src="https://s2.loli.net/2024/12/07/8wMdQznlHbxKZOy.png" alt="image-20241113192714415" /><figcaption aria-hidden="true">image-20241113192714415</figcaption></figure><h2 id="çŸ¥è¯†åº“å¯¼å…¥æ•°æ®é›†">4.2 çŸ¥è¯†åº“å¯¼å…¥æ•°æ®é›†</h2><figure><img src="https://s2.loli.net/2024/12/07/v75reJxjiG9gqn4.png" alt="image-20241113192910065" /><figcaption aria-hidden="true">image-20241113192910065</figcaption></figure><figure><img src="https://s2.loli.net/2024/12/07/ThOAMz6vWDQwHYI.png" alt="image-20241113192954019" /><figcaption aria-hidden="true">image-20241113192954019</figcaption></figure><p>æ­¤å¤„é€‰æ‹©æœ¬åœ°ä¸€ä¸ªdoc æ–‡ä»¶ï¼Œç„¶åä¸‹ä¸€æ­¥ï¼š</p><figure><img src="https://s2.loli.net/2024/12/07/jEtFWpG1SJKbaAm.png" alt="image-20241113193141780" /><figcaption aria-hidden="true">image-20241113193141780</figcaption></figure><p>é€‰æ‹©é—®ç­”æ‹†åˆ†ï¼Œç„¶åä¸‹ä¸€æ­¥ï¼š</p><figure><img src="https://s2.loli.net/2024/12/07/vFn4KZJ7wzhPdtk.png" alt="image-20241113193227525" /><figcaption aria-hidden="true">image-20241113193227525</figcaption></figure><p>å¼€å§‹ä¸Šä¼ ï¼š</p><figure><img src="https://s2.loli.net/2024/12/07/xyszi7J8TLfPetV.png" alt="image-20241113193305696" /><figcaption aria-hidden="true">image-20241113193305696</figcaption></figure><p>ä¸Šä¼ å®Œæˆåï¼š</p><figure><img src="https://s2.loli.net/2024/12/07/Ood5EkGS72TBnD4.png" alt="image-20241113193357782" /><figcaption aria-hidden="true">image-20241113193357782</figcaption></figure><p><strong>è¯·ç­‰å¾…çŸ¥è¯†åº“æ–‡ä»¶æ¡ç›®çš„çŠ¶æ€å˜æ›´ä¸ºâ€œå·²å°±ç»ªâ€</strong></p><h2 id="åˆ›å»ºåº”ç”¨">4.3 åˆ›å»ºåº”ç”¨</h2><figure><img src="https://s2.loli.net/2024/12/07/a8A3yPgYBjsUCMu.png" alt="image-20241113193630915" /><figcaption aria-hidden="true">image-20241113193630915</figcaption></figure><p><strong>é€‰æ‹©â€œçŸ¥è¯†åº“+å¯¹è¯å¼•å¯¼â€ï¼š</strong></p><figure><img src="https://s2.loli.net/2024/12/07/cFd4DCh8g12rJlo.png" alt="image-20241113193709870" /><figcaption aria-hidden="true">image-20241113193709870</figcaption></figure><h2 id="é…ç½®åº”ç”¨">4.4 é…ç½®åº”ç”¨</h2><figure><img src="https://s2.loli.net/2024/12/07/MPEqAaIFS3Be2uK.png" alt="image-20241113193846005" /><figcaption aria-hidden="true">image-20241113193846005</figcaption></figure><p><strong>é€‰æ‹©deepseek-coder:1.3bï¼š</strong></p><figure><img src="https://s2.loli.net/2024/12/07/sdHmcM9w1FuyYOC.png" alt="image-20241113193942936" /><figcaption aria-hidden="true">image-20241113193942936</figcaption></figure><p><strong>å…³è”çŸ¥è¯†åº“ï¼š</strong></p><figure><img src="https://s2.loli.net/2024/12/07/GL1ATKN5gCXv4qc.png" alt="image-20241113200034815" /><figcaption aria-hidden="true">image-20241113200034815</figcaption></figure><p><strong>é€‰æ‹©å…ˆå‰åˆ›å»ºçš„çŸ¥è¯†åº“ï¼š</strong></p><figure><img src="https://s2.loli.net/2024/12/07/xnSr6IUYf8T4uX7.png" alt="image-20241113200112918" /><figcaption aria-hidden="true">image-20241113200112918</figcaption></figure><p>ç„¶åï¼Œå³ä¸Šè§’ï¼Œç‚¹å‡»â€œä¿å­˜å¹¶å‘å¸ƒâ€ã€‚</p><figure><img src="https://s2.loli.net/2025/01/23/9Pgco5fByaDNt1Z.png" alt="image-20250123150725679" /><figcaption aria-hidden="true">image-20250123150725679</figcaption></figure><h2 id="æŸ¥çœ‹åº”ç”¨ä¸ä½¿ç”¨">4.5 æŸ¥çœ‹åº”ç”¨ä¸ä½¿ç”¨</h2><h3 id="åœ¨å·¥ä½œå°ä¸­ä½¿ç”¨">4.5.1 åœ¨å·¥ä½œå°ä¸­ä½¿ç”¨</h3><figure><img src="https://s2.loli.net/2025/01/23/ZBflSOd2r8sHRwq.png" alt="image-20250123150751085" /><figcaption aria-hidden="true">image-20250123150751085</figcaption></figure><figure><img src="https://s2.loli.net/2025/01/23/va7EnfJ5hObQk43.png" alt="image-20250123150948199" /><figcaption aria-hidden="true">image-20250123150948199</figcaption></figure><h3 id="åœ¨èŠå¤©ä¸­ç›´æ¥ä½¿ç”¨">4.5.2 åœ¨èŠå¤©ä¸­ç›´æ¥ä½¿ç”¨</h3><figure><img src="https://s2.loli.net/2025/01/23/ntHVWKXOGog9bZQ.png" alt="image-20250123151056398" /><figcaption aria-hidden="true">image-20250123151056398</figcaption></figure><figure><img src="https://s2.loli.net/2025/01/23/nfNAKcoMDOEeVZJ.png" alt="image-20250123151156093" /><figcaption aria-hidden="true">image-20250123151156093</figcaption></figure><h1 id="äº”å¤‡æ³¨">äº”ã€å¤‡æ³¨</h1><h2 id="ç°æœ‰é—®é¢˜">5.1 ç°æœ‰é—®é¢˜</h2><h3 id="æ¯æ¬¡ä½¿ç”¨é—®ç­”åŠŸèƒ½æ—¶fastgptå®¹å™¨æ—¥å¿—ä¸­ä¼šæœ‰å¦‚ä¸‹é”™è¯¯">5.1.1 æ¯æ¬¡ä½¿ç”¨é—®ç­”åŠŸèƒ½æ—¶ï¼Œfastgptå®¹å™¨æ—¥å¿—ä¸­ä¼šæœ‰å¦‚ä¸‹é”™è¯¯</h3><figure><img src="https://s2.loli.net/2024/12/08/4QeDjE9WngOTHUS.png" alt="image-20241208094204434" /><figcaption aria-hidden="true">image-20241208094204434</figcaption></figure><p>è§£å†³åŠæ³•ï¼š</p><p>æš‚æœªè§£å†³ã€‚ä»ç½‘ä¸ŠæŸ¥çœ‹çš„èµ„æ–™æ¥çœ‹ï¼Œæå¯èƒ½æ˜¯config.jsonæ–‡ä»¶ä¸­å…³äºæ¨¡å‹çš„æŸä¸ªå‚æ•°é…ç½®ä¸æ­£ç¡®æˆ–ä¸æ°å½“æ‰€è‡´ï¼Œä½†ä¸çŸ¥æ˜¯å“ªä¸ªå…·ä½“æ˜¯å“ªä¸ªåœ°æ–¹çš„é…ç½®ä¸å½“æ‰€è‡´ã€‚æ­¤æŠ¥é”™æš‚æ—¶ä¸å½±å“æ•´ä½“åŠŸèƒ½</p><h2 id="å‚è€ƒè§†é¢‘">5.2 å‚è€ƒè§†é¢‘</h2><p>https://www.bilibili.com/video/BV1xMyGYwEdk/?spm_id_from=333.337.search-card.all.click&amp;vd_source=0b5fe5d5aa31f64bf7462d1d094b70a2</p><h2 id="åç»­æ›´æ–°">5.3 åç»­æ›´æ–°</h2><p>ç¬”è€…ä¸ªäººåšå®¢â€œhttps://jiangsanyin.github.io/archives/â€2024å¹´12æœˆ7æ—¥çš„æ–‡ç« </p>]]></content>
    
    
    <categories>
      
      <category>å¤§æ¨¡å‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>FastGPT</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>k8sç¦»çº¿éƒ¨ç½²-ä½¿ç”¨kubekeyéƒ¨ç½²aarch64é«˜å¯ç”¨ç‰ˆk8s1.23.17+ksp3.4.1</title>
    <link href="/2024/12/06/k8s%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B2-%E4%BD%BF%E7%94%A8kubekey%E9%83%A8%E7%BD%B2arm64%E9%AB%98%E5%8F%AF%E7%94%A8%E7%89%88k8s1-23-17-ksp3-4-1/"/>
    <url>/2024/12/06/k8s%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B2-%E4%BD%BF%E7%94%A8kubekey%E9%83%A8%E7%BD%B2arm64%E9%AB%98%E5%8F%AF%E7%94%A8%E7%89%88k8s1-23-17-ksp3-4-1/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€ç¯å¢ƒä¿¡æ¯ä»‹ç»"><a href="#ä¸€ã€ç¯å¢ƒä¿¡æ¯ä»‹ç»" class="headerlink" title="ä¸€ã€ç¯å¢ƒä¿¡æ¯ä»‹ç»"></a>ä¸€ã€ç¯å¢ƒä¿¡æ¯ä»‹ç»</h1><table><thead><tr><th><strong>ä¸»æœºå</strong></th><th><strong>IP</strong></th><th><strong>rootå¯†ç </strong></th><th><strong>è§„æ ¼</strong></th><th><strong>ç£ç›˜</strong></th><th><strong>æ“ä½œç³»ç»Ÿ</strong></th><th><strong>å¤‡æ³¨</strong></th></tr></thead><tbody><tr><td>ksp-deploy</td><td>172.25.253.106</td><td>cloud@123</td><td>4c8g</td><td>400g</td><td>Ubuntu 20.04.3 LTS-aarch64</td><td>è”ç½‘ï¼Œç”Ÿæˆartifactç­‰æ–‡ä»¶</td></tr><tr><td>node01</td><td>172.25.253.93</td><td>cloud@123</td><td>8c16g</td><td>400g</td><td>Ubuntu 20.04.3 LTS-aarch64</td><td>æ§åˆ¶èŠ‚ç‚¹</td></tr><tr><td>node02</td><td>172.25.253.94</td><td>cloud@123</td><td>8c16g</td><td>400g</td><td>Ubuntu 20.04.3 LTS-aarch64</td><td>æ§åˆ¶èŠ‚ç‚¹</td></tr><tr><td>node03</td><td>172.25.253.95</td><td>cloud@123</td><td>8c16g</td><td>400g</td><td>Ubuntu 20.04.3 LTS-aarch64</td><td>æ§åˆ¶èŠ‚ç‚¹</td></tr><tr><td>node04</td><td>172.25.253.113</td><td>cloud@123</td><td>8c16g</td><td>400g</td><td>Ubuntu 20.04.3 LTS-aarch64</td><td>å·¥ä½œèŠ‚ç‚¹</td></tr><tr><td>node05</td><td>172.25.253.114</td><td>cloud@123</td><td>8c16g</td><td>400g</td><td>Ubuntu 20.04.3 LTS-aarch64</td><td>å·¥ä½œèŠ‚ç‚¹</td></tr></tbody></table><p>ç¯å¢ƒæ¶‰åŠè½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯ï¼š</p><ul><li>K8SèŠ‚ç‚¹æ“ä½œç³»ç»Ÿï¼š<strong>Ubuntu 20.04.3 LTS -aarch64</strong></li><li>KubeSphereï¼š<strong>v3.4.1</strong></li><li>K8Sï¼š<strong>v1.23.17</strong></li><li>Dockerï¼š<strong>24.0.6</strong></li><li>KubeKey: <strong>v3.0.13</strong></li><li>cni-plugins: <strong>v1.2.0</strong></li><li>crictl: <strong>v1.24.0</strong></li><li>etcd: <strong>v3.4.13</strong></li><li>helm: <strong>v3.9.0</strong></li><li>kubeadmã€kubectlã€kubelet: <strong>v1.23.17</strong></li></ul><p>â€‹        <a href="https://github.com/kubesphere/kubekey">KubeKey</a> ä½¿ç”¨ <code>/var/lib/docker</code> ä½œä¸ºé»˜è®¤è·¯å¾„æ¥å­˜å‚¨æ‰€æœ‰ Docker ç›¸å…³æ–‡ä»¶ï¼ˆåŒ…æ‹¬é•œåƒï¼‰ã€‚å»ºè®®æ·»åŠ é™„åŠ å­˜å‚¨å·ï¼ˆæœ¬æ–‡ä¸­æœªæ·»åŠ ï¼‰ï¼Œåˆ†åˆ«ç»™ <code>/var/lib/docker</code> å’Œ <code>/mnt/registry</code> æŒ‚è½½è‡³å°‘ <strong>100G</strong>ã€‚</p><p>â€‹        æœ¬æ–‡å‡è®¾è”ç½‘çš„æœåŠ¡å™¨ksp-deployä¸Šç›¸å…³åŸºç¡€æ“ä½œå¦‚å®‰è£…ã€é…ç½®dockerç­‰å·²ç»å®Œæˆï¼Œæœªè¿›è¡Œä»‹ç»è¯´æ˜ã€‚</p><h1 id="äºŒã€ç¦»çº¿å®‰è£…ä»‹ç»"><a href="#äºŒã€ç¦»çº¿å®‰è£…ä»‹ç»" class="headerlink" title="äºŒã€ç¦»çº¿å®‰è£…ä»‹ç»"></a>äºŒã€ç¦»çº¿å®‰è£…ä»‹ç»</h1><p>â€‹        KubeKey ä» v2.1.0 ç‰ˆå¼€å§‹æ–°å¢äº†æ¸…å• (manifest) å’Œåˆ¶å“ (artifact) çš„æ¦‚å¿µï¼Œä¸ºç”¨æˆ·ç¦»çº¿éƒ¨ç½² KubeSphere å’Œ K8s é›†ç¾¤æä¾›äº†ä¸€ç§ç®€å•ä¾¿æ·çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>â€‹        manifest æ˜¯ä¸€ä¸ªæè¿°å½“å‰ Kubernetes é›†ç¾¤ä¿¡æ¯å’Œå®šä¹‰ artifact åˆ¶å“ä¸­éœ€è¦åŒ…å«å“ªäº›å†…å®¹çš„æ–‡æœ¬æ–‡ä»¶ã€‚</p><p>â€‹        ä½¿ç”¨ KubeKeyï¼Œç”¨æˆ·åªéœ€ä½¿ç”¨æ¸…å• manifest æ–‡ä»¶æ¥å®šä¹‰å°†è¦ç¦»çº¿éƒ¨ç½²çš„é›†ç¾¤ç¯å¢ƒéœ€è¦çš„å†…å®¹ï¼Œå†é€šè¿‡è¯¥ manifest æ¥å¯¼å‡ºåˆ¶å“ artifact æ–‡ä»¶å³å¯å®Œæˆå‡†å¤‡å·¥ä½œã€‚ç¦»çº¿éƒ¨ç½²æ—¶åªéœ€è¦ KubeKey å’Œ artifact å°±å¯å¿«é€Ÿã€ç®€å•çš„åœ¨ç¯å¢ƒä¸­éƒ¨ç½²é•œåƒä»“åº“ Harbor å’Œ KubeSphere ä»¥åŠ K8s é›†ç¾¤ã€‚</p><p>â€‹        KubeKey ç”Ÿæˆ manifest æ–‡ä»¶æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>åˆ©ç”¨ç°æœ‰è¿è¡Œä¸­çš„é›†ç¾¤ä½œä¸ºæºç”Ÿæˆ manifest æ–‡ä»¶ï¼Œæ˜¯å®˜æ–¹æ¨èçš„ä¸€ç§æ–¹å¼ï¼Œå…·ä½“å‚è€ƒ KubeSphere <a href="https://v3-1.docs.kubesphere.io/zh/docs/installing-on-linux/introduction/air-gapped-installation/">å®˜ç½‘çš„ç¦»çº¿éƒ¨ç½²æ–‡æ¡£</a>ã€‚</li><li>æ ¹æ® <a href="https://github.com/kubesphere/kubekey/blob/master/docs/manifest-example.md">manifest æ¨¡æ¿æ–‡ä»¶</a> æ‰‹åŠ¨ç¼–å†™ manifest æ–‡ä»¶ã€‚</li></ul><p>â€‹        ç¬¬ä¸€ç§æ–¹å¼çš„å¥½å¤„æ˜¯å¯ä»¥æ ¹æ® 1:1 çš„è¿è¡Œé›†ç¾¤æ„å»ºç¦»çº¿é›†ç¾¤ï¼Œä¾èµ–äºå·²æœ‰é›†ç¾¤ï¼Œçµæ´»åº¦ä¸å¤Ÿï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰äººéƒ½å…·å¤‡è¿™ç§æ¡ä»¶ã€‚</p><p>â€‹        ä½†æœ¬æ–‡ä¸­æ¶‰åŠçš„æ˜¯arm64æ„æ¶æœåŠ¡å™¨ä¸Šæ­å»ºk8s1.23.17+ksp3.4.1ç¯å¢ƒï¼Œä¸Šè¿°æ–¹æ³•åœ¨amd64æ„æ¶æœåŠ¡å™¨ä¸Šèƒ½æˆåŠŸï¼Œåœ¨æ­¤å¤„ä¸èƒ½æˆåŠŸï¼ˆè‡³å°‘ç¬”è€…è‡ªå·±æœªæˆåŠŸã€‚å…¶ä¸­ç¬”è€…é‡åˆ°å¤±è´¥ä¹‹å¤„å°±æ˜¯ä¸è®ºæ˜¯å¦ä½¿ç”¨harboråšé•œåƒä»“åº“ï¼Œå®‰è£…è¿‡ç¨‹ä¸­éƒ½ä¼šå°è¯•å»ä¸‹è½½harborå®‰è£…æ–‡ä»¶ï¼Œä½†harborå®˜æ–¹å¹¶æœªæä¾›arm64çš„å®‰è£…æ–‡ä»¶ï¼Œæ‰€ä»¥åå¤ä¸‹è½½ã€åå¤å¤±è´¥ï¼‰ã€‚æ‰€ä»¥ç¬”è€…é€‰æ‹©äº†é€æ­¥æ‰‹åŠ¨ä¸‹è½½ç›¸å…³å®‰è£…äºŒè¿›åˆ¶æ–‡ä»¶ã€é•œåƒä¸å…¶ä»–å·¥å…·æ–‡ä»¶ç­‰ï¼Œæœ€åå®Œæˆarm64æ„æ¶æœåŠ¡å™¨ä¸Šk8s1.23.17+ksp3.4.1ç¯å¢ƒçš„å®‰è£…éƒ¨ç½²ã€‚å…¶ä¸­æœ€å…³é”®çš„åœ¨äºæå‰ä¸‹è½½å‡†å¤‡å¥½ç¦»çº¿å®‰è£…k8s1.23.17+ksp3.4.1ç¯å¢ƒä¸­ç”¨åˆ°<strong>KubernetesäºŒè¿›åˆ¶æ–‡ä»¶ã€Kubernetesä¸Kubesphereç”¨åˆ°çš„é•œåƒ</strong>ï¼Œå…¶ä»–çš„å¤§è‡´éƒ½æ˜¯å›´ç»•æ­¤äºŒè€…å±•å¼€è¿›è¡Œå‡†å¤‡ã€‚</p><h1 id="ä¸‰ã€æœåŠ¡å™¨çš„å‰ç½®æ“ä½œ"><a href="#ä¸‰ã€æœåŠ¡å™¨çš„å‰ç½®æ“ä½œ" class="headerlink" title="ä¸‰ã€æœåŠ¡å™¨çš„å‰ç½®æ“ä½œ"></a>ä¸‰ã€æœåŠ¡å™¨çš„å‰ç½®æ“ä½œ</h1><p>å»ºè®®æ‰€æœ‰æœåŠ¡å™¨éƒ½è¦æ‰§è¡Œã€‚</p><h2 id="3-1-è®¾ç½®å„æœåŠ¡å™¨æ—¶åŒº"><a href="#3-1-è®¾ç½®å„æœåŠ¡å™¨æ—¶åŒº" class="headerlink" title="3.1 è®¾ç½®å„æœåŠ¡å™¨æ—¶åŒº"></a>3.1 è®¾ç½®å„æœåŠ¡å™¨æ—¶åŒº</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">timedatectl set-timezone Asia/Shanghai<br></code></pre></td></tr></table></figure><h2 id="3-2-è®¾ç½®å„æœåŠ¡å™¨ä¸»æœºå"><a href="#3-2-è®¾ç½®å„æœåŠ¡å™¨ä¸»æœºå" class="headerlink" title="3.2 è®¾ç½®å„æœåŠ¡å™¨ä¸»æœºå"></a>3.2 è®¾ç½®å„æœåŠ¡å™¨ä¸»æœºå</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">hostnamectl set-hostname xxx<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç„¶åé€€å‡ºç»ˆç«¯å¹¶é‡æ–°åˆ›å»ºä¸€ä¸ªç»ˆç«¯ä¼šè¯</span><br></code></pre></td></tr></table></figure><h2 id="3-3-è®¾ç½®ä¸»æœºä¸ipçš„æ˜ å°„ä¿¡æ¯"><a href="#3-3-è®¾ç½®ä¸»æœºä¸ipçš„æ˜ å°„ä¿¡æ¯" class="headerlink" title="3.3 è®¾ç½®ä¸»æœºä¸ipçš„æ˜ å°„ä¿¡æ¯"></a>3.3 è®¾ç½®ä¸»æœºä¸ipçš„æ˜ å°„ä¿¡æ¯</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &gt;&gt; /etc/hosts &lt;&lt;EOF<br>172.25.253.106 ksp-deploy<br>172.25.253.93 node01<br>172.25.253.94 node02<br>172.25.253.95 node03<br>172.25.253.113 node04<br>172.25.253.114 node05<br>EOF<br></code></pre></td></tr></table></figure><h2 id="3-4-è®¾ç½®æ—¶é—´åŒæ­¥"><a href="#3-4-è®¾ç½®æ—¶é—´åŒæ­¥" class="headerlink" title="3.4 è®¾ç½®æ—¶é—´åŒæ­¥"></a>3.4 è®¾ç½®æ—¶é—´åŒæ­¥</h2><p>â€‹        æœ€å¥½ä»¥ç¦»çº¿k8sç¯å¢ƒçš„æŸä¸ªèŠ‚ç‚¹åšæ—¶é—´åŒæ­¥çš„æºæœåŠ¡å™¨ã€‚æœ¬æ–‡ä¸ºäº†ç®€åŒ–æ“ä½œï¼Œæœªæ‰§è¡Œã€‚ç”Ÿäº§ç¯å¢ƒä¸­å»ºè®®æ‰§è¡Œã€‚</p><h1 id="å››ã€ç¦»çº¿éƒ¨ç½²èµ„æºåˆ¶ä½œ"><a href="#å››ã€ç¦»çº¿éƒ¨ç½²èµ„æºåˆ¶ä½œ" class="headerlink" title="å››ã€ç¦»çº¿éƒ¨ç½²èµ„æºåˆ¶ä½œ"></a>å››ã€ç¦»çº¿éƒ¨ç½²èµ„æºåˆ¶ä½œ</h1><p>åˆ¶ä½œç¦»çº¿éƒ¨ç½²èµ„æºéœ€è¦æ‰¾ä¸€å°èƒ½è”é€šäº’è”ç½‘çš„èŠ‚ç‚¹ï¼ˆæœ¬æ–‡ä¸­æ˜¯ksp-deployï¼‰ï¼Œæœ¬æ–‡ä¸ºäº†èµ„æºçš„åˆ¶ä½œå’Œç¦»çº¿éƒ¨ç½²éªŒè¯ï¼Œå•ç‹¬å¢åŠ äº†ä¸€ä¸ªèƒ½è”ç½‘çš„ <strong>ksp-deploy</strong> èŠ‚ç‚¹ã€‚</p><p>åœ¨è¯¥èŠ‚ç‚¹ä¸‹è½½ KubeKey ï¼ˆä¸‹æ–‡ç®€ç§° KKï¼‰<strong>v3.0.13</strong>ã€‚å…·ä½“ KK ç‰ˆæœ¬å·å¯ä»¥åœ¨ <a href="https://github.com/kubesphere/kubekey/releases">KubeKey å‘è¡Œé¡µé¢</a> æŸ¥çœ‹ã€‚</p><h2 id="4-1-ä¸‹è½½-KubeKey"><a href="#4-1-ä¸‹è½½-KubeKey" class="headerlink" title="4.1 ä¸‹è½½ KubeKey"></a>4.1 ä¸‹è½½ KubeKey</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@ksp-deploy:~# mkdir /root/kubekey<br>root@ksp-deploy:~# cd /root/kubekey<br><span class="hljs-meta prompt_"># </span><span class="language-bash">é€‰æ‹©ä¸­æ–‡åŒºä¸‹è½½(è®¿é—® GitHub å—é™æ—¶ä½¿ç”¨)</span><br>root@ksp-deploy:~/kubekey# export KKZONE=cn<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ‰§è¡Œä¸‹è½½å‘½ä»¤ï¼Œè·å–æŒ‡å®šç‰ˆæœ¬çš„ kkï¼ˆå—é™äºç½‘ç»œå¯èƒ½ä¼šå¤±è´¥ï¼Œå¯èƒ½éœ€è¦æ‰§è¡Œå¤šæ¬¡ï¼‰</span><br>root@ksp-deploy:~/kubekey# curl -sfL https://get-kk.kubesphere.io | VERSION=v3.0.13 sh -<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/12/28/qSkxtXjcFlwdTOs.png" alt="image-20241228172413417"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@ksp-deploy:~/kubekey# chown root:root kk<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹kubekey3.0.13ç‰ˆæœ¬</span><br>root@ksp-deploy:~/kubekey# ./kk version<br>kk version: &amp;version.Info&#123;Major:&quot;3&quot;, Minor:&quot;0&quot;, GitVersion:&quot;v3.0.13-dirty&quot;, GitCommit:&quot;ac75d3ef3c22e6a9d999dcea201234d6651b3e72&quot;, GitTreeState:&quot;dirty&quot;, BuildDate:&quot;2023-11-07T08:43:42Z&quot;, GoVersion:&quot;go1.19.2&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/arm64&quot;&#125;<br></code></pre></td></tr></table></figure><h2 id="4-2-å‡†å¤‡å®‰è£…é•œåƒ"><a href="#4-2-å‡†å¤‡å®‰è£…é•œåƒ" class="headerlink" title="4.2 å‡†å¤‡å®‰è£…é•œåƒ"></a>4.2 å‡†å¤‡å®‰è£…é•œåƒ</h2><p>â€‹åœ¨ Linux ä¸Šå®‰è£… KubeSphere å’Œ Kubernetes æ—¶ï¼Œéœ€è¦å‡†å¤‡æ‰€æœ‰å¿…éœ€é•œåƒæ–‡ä»¶ï¼Œå¹¶äº‹å…ˆä¸‹è½½ Kubernetes äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤è·å–å®˜æ–¹ releases v3.4.1 å¯¹åº”çš„ images-list</span><br>root@ksp-deploy:~/kubekey# wget https://github.com/kubesphere/ks-installer/releases/download/v3.4.1/images-list.txt<br></code></pre></td></tr></table></figure><p>â€‹ä½†ä¸Šè¿°æ–‡ä»¶ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼ˆä»å®˜ç½‘ä¸Šä¸‹è½½ä¸‹æ¥çš„è¿™ä¸ªæ–‡ä»¶åº”è¯¥åªæ˜¯x86å¹³å°ä¸ŠéªŒè¯è¿‡çš„ã€‚è¿™ä¸ªæ–‡ä»¶ä¸­æœ‰äº›é•œåƒå¹¶æ²¡æœ‰å¯¹åº”arm64ç‰ˆæœ¬é•œåƒï¼›æ­¤å¤–ï¼Œéå…¨é‡å®‰è£…æ—¶ä¸æ˜¯æ‰€æœ‰é•œåƒéƒ½æ˜¯éœ€è¦çš„ï¼‰ã€‚<br>â€‹ç»è¿‡ä¿®æ”¹åimage-list.txtæ–‡ä»¶å¦‚ä¸‹ï¼ˆå·²ç»ç»è¿‡éªŒè¯ï¼‰ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@ksp-deploy:~/kubekey#  cat images-list.txt<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#k8s-images</span></span><br>kubesphere/pause:3.6<br>kubesphere/kube-apiserver:v1.23.17<br>kubesphere/kube-controller-manager:v1.23.17<br>kubesphere/kube-scheduler:v1.23.17<br>kubesphere/kube-proxy:v1.23.17<br>coredns/coredns:1.8.6<br>kubesphere/k8s-dns-node-cache:1.15.12<br>calico/kube-controllers:v3.26.1<br>calico/cni:v3.26.1<br>calico/node:v3.26.1<br>calico/pod2daemon-flexvol:v3.26.1<br>openebs/provisioner-localpv:3.3.0<br>openebs/linux-utils:3.3.0<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#kubesphere-images</span></span><br>kubesphere/ks-installer:v3.4.1<br>kubesphere/ks-apiserver:v3.4.1<br>kubesphere/ks-console:v3.4.1<br>kubesphere/ks-controller-manager:v3.4.1<br>kubesphere/kubectl:v1.20.0<br>kubesphere/kubectl:v1.22.0<br>kubesphere/kubefed:v0.8.1<br>kubesphere/tower:v0.2.1<br>minio/minio:RELEASE.2024-08-17T01-24-54Z<br>minio/mc:RELEASE.2024-08-17T11-33-50Z<br>csiplugin/snapshot-controller:v4.0.0<br>kubesphere/nginx-ingress-controller:v1.3.1<br>mirrorgooglecontainers/defaultbackend-arm64:1.4<br>kubesphere/metrics-server:v0.4.2<br>redis:5.0.14-alpine<br>haproxy:2.0.25-alpine<br>haproxy:2.3<br>alpine:3.14<br>osixia/openldap:1.3.0<br>kubesphere/netshoot:v1.0<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#kubeedge-images</span></span><br>kubeedge/cloudcore:v1.13.0<br>kubesphere/iptables-manager:v1.13.0<br>kubesphere/edgeservice:v0.3.0<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#gatekeeper-images</span></span><br>openpolicyagent/gatekeeper:v3.5.2<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#openpitrix-images</span></span><br>kubesphere/openpitrix-jobs:v3.3.2<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#kubesphere-devops-images</span></span><br>kubesphere/devops-apiserver:ks-v3.4.1<br>kubesphere/devops-controller:ks-v3.4.1<br>kubesphere/devops-tools:ks-v3.4.1<br>kubesphere/ks-jenkins:v3.4.0-2.319.3-1<br>jenkins/inbound-agent:4.10-2<br>kubesphere/s2ioperator:v3.2.1<br>kubesphere/java-11-centos7:v3.2.0<br>kubesphere/java-8-centos7:v3.2.0<br>quay.io/argoproj/argocd:v2.3.3<br>quay.io/argoproj/argocd-applicationset:v0.4.1<br>ghcr.io/dexidp/dex:v2.30.2<br>redis:6.2.6-alpine<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#kubesphere-monitoring-images</span></span><br>jimmidyson/configmap-reload:v0.7.1<br>prom/prometheus:v2.39.1<br>kubesphere/prometheus-config-reloader:v0.55.1<br>kubesphere/prometheus-operator:v0.55.1<br>kubesphere/kube-rbac-proxy:v0.11.0<br>kubesphere/kube-state-metrics:v2.6.0<br>prom/node-exporter:v1.3.1<br>prom/alertmanager:v0.23.0<br>thanosio/thanos:v0.31.0<br>grafana/grafana:8.3.3<br>kubesphere/kube-rbac-proxy:v0.11.0<br>kubesphere/notification-manager-operator:v2.3.0<br>kubesphere/notification-manager:v2.3.0<br>kubesphere/notification-tenant-sidecar:v3.2.0<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#kubesphere-logging-images</span></span><br>kubesphere/opensearch-curator:v0.0.5<br>kubesphere/fluent-bit:v1.9.4<br>kubesphere/log-sidecar-injector:v1.2.0<br>elastic/filebeat:6.7.0<br>kubesphere/kube-events-operator:v0.6.0<br>kubesphere/kube-events-ruler:v0.6.0<br>kubesphere/kube-auditing-operator:v0.2.0<br>kubesphere/kube-auditing-webhook:v0.2.0<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#istio-images</span></span><br>jaegertracing/jaeger-operator:1.29<br>jaegertracing/jaeger-agent:1.29<br>jaegertracing/jaeger-collector:1.29<br>jaegertracing/jaeger-query:1.29<br>jaegertracing/jaeger-es-index-cleaner:1.29<br>kubesphere/kiali-operator:v1.50.1<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#example-images</span></span><br>busybox:1.31.1<br></code></pre></td></tr></table></figure><h2 id="4-3-ä¸‹è½½-Kubernetes-äºŒè¿›åˆ¶æ–‡ä»¶"><a href="#4-3-ä¸‹è½½-Kubernetes-äºŒè¿›åˆ¶æ–‡ä»¶" class="headerlink" title="4.3 ä¸‹è½½ Kubernetes äºŒè¿›åˆ¶æ–‡ä»¶"></a>4.3 ä¸‹è½½ Kubernetes äºŒè¿›åˆ¶æ–‡ä»¶</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹è½½ offline-installation-tool.sh</span><br>root@ksp-deploy:~/kubekey# curl -L -O https://github.com/kubesphere/ks-installer/releases/download/v3.4.1/offline-installation-tool.sh<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç»™æ–‡ä»¶å¢åŠ å¯æ‰§è¡Œæƒé™</span><br>root@ksp-deploy:~/kubekey# chmod +x offline-installation-tool.sh<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰§æŸ¥çœ‹å¦‚ä½•ä½¿ç”¨è„šæœ¬</span><br>root@ksp-deploy:~/kubekey# ./offline-installation-tool.sh -h<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹è½½ Kubernetes äºŒè¿›åˆ¶æ–‡ä»¶</span><br>root@ksp-deploy:~/kubekey# export KKZONE=cn<br>root@ksp-deploy:~/kubekey# export HELM_VERSION=v3.9.0 &amp;&amp; export CNI_VERSION=v1.2.0 &amp;&amp; export CRICTL_VERSION=v1.24.0 &amp;&amp; export ETCD_VERSION=v3.4.13 &amp;&amp; export DOCKER_VERSION=24.0.6;<br>root@ksp-deploy:~/kubekey# ./offline-installation-tool.sh -b -v v1.23.17<br><span class="hljs-meta prompt_">#</span><span class="language-bash">è¿è¡Œè„šæœ¬åï¼Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ kubekeyã€‚è¯·æ³¨æ„ï¼Œåé¢åˆ›å»ºé›†ç¾¤æ—¶ï¼Œè¯¥æ–‡ä»¶å¤¹å’Œ kk å¿…é¡»æ”¾åœ¨åŒä¸€ä¸ªç›®å½•</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/12/30/figQNSrTJ5RIWeZ.png" alt="image-20241230195525723"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">è¿˜éœ€è¦ä¸‹è½½ä¸€ä¸ªcalicoctl-linux-arm64 æ–‡ä»¶</span><br>root@ksp-deploy:~/kubekey# curl -L -o kubekey/v1.23.17/arm64/calicoctl-linux-arm64 https://github.com/projectcalico/calico/releases/download/v3.26.1/calicoctl-linux-arm64 -O <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹åˆ›å»ºçš„æ–‡ä»¶å¤¹åŠä¸‹è½½çš„æ–‡ä»¶</span><br>root@ksp-deploy:~/kubekey# ls -alh kubekey/v1.23.17/arm64/<br>total 419M<br>drwxr-xr-x 2 root root 4.0K Dec 30 20:12 .<br>drwxr-xr-x 3 root root 4.0K Dec 29 17:05 ..<br>-rw-r--r-- 1 root root  59M Dec 30 19:30 calicoctl-linux-arm64<br>-rw-r--r-- 1 root root  37M Dec 30 19:53 cni-plugins-linux-arm64-v1.2.0.tgz<br>-rw-r--r-- 1 root root  13M Dec 30 19:53 crictl-v1.24.0-linux-arm64.tar.gz<br>-rw-r--r-- 1 root root  61M Oct 26  2023 docker-24.0.6.tgz<br>-rw-r--r-- 1 root root  16M Dec 30 19:53 etcd-v3.4.13-linux-arm64.tar.gz<br>-rw-r--r-- 1 root root  44M Dec 30 19:52 helm<br>-rw-r--r-- 1 root root  41M Dec 30 19:51 kubeadm<br>-rw-r--r-- 1 root root  42M Dec 30 19:52 kubectl<br>-rw-r--r-- 1 root root 110M Dec 30 19:52 kubelet<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç¬”è€…åœ¨ä¸‹è½½æ—¶dockerè™½ç„¶æ˜¾ç¤ºæˆåŠŸä½†å…¶å®ä¸‹è½½ä¸‹æ¥çš„ kubekey/v1.23.17/arm64/docker-24.0.6.tgz æ–‡ä»¶åªæœ‰2.3Kï¼Œå¹¶ä¸å¯ç”¨</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">äºæ˜¯æ‰‹åŠ¨é‡æ–°ä¸‹è½½</span><br>root@ksp-deploy:~/kubekey# wget https://download.docker.com/linux/static/stable/aarch64/docker-24.0.6.tgz -O kubekey/v1.23.17/arm64/docker-24.0.6.tgz<br>root@ksp-deploy:~/kubekey# ls -alh kubekey/v1.23.17/arm64/docker-24.0.6.tgz<br>-rw-r--r-- 1 root root 61M Oct 26  2023 kubekey/v1.23.17/arm64/docker-24.0.6.tgz<br></code></pre></td></tr></table></figure><h2 id="4-4-æ‹‰å–éƒ¨ç½²è¿‡ç¨‹ä¸­çš„é•œåƒ"><a href="#4-4-æ‹‰å–éƒ¨ç½²è¿‡ç¨‹ä¸­çš„é•œåƒ" class="headerlink" title="4.4 æ‹‰å–éƒ¨ç½²è¿‡ç¨‹ä¸­çš„é•œåƒ"></a>4.4 æ‹‰å–éƒ¨ç½²è¿‡ç¨‹ä¸­çš„é•œåƒ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@ksp-deploy:~/kubekey# ./offline-installation-tool.sh -s -l images-list.txt -d ./kubesphere-images<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ€»å…±å¤§æ¦‚æœ‰4Gå·¦å³</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/12/29/VKPmkQFJB6pUXbs.png" alt="image-20241229171432036"></p><h2 id="4-5-å‡†å¤‡registry-2é•œåƒ"><a href="#4-5-å‡†å¤‡registry-2é•œåƒ" class="headerlink" title="4.5 å‡†å¤‡registry:2é•œåƒ"></a>4.5 å‡†å¤‡registry:2é•œåƒ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@ksp-deploy:~/kubekey# docker pull registry:2<br>root@ksp-deploy:~/kubekey# docker save -o registry-2.tar.gz registry:2<br></code></pre></td></tr></table></figure><h2 id="4-6-æ‰“åŒ…å‹ç¼©éƒ¨ç½²é•œåƒæ–‡ä»¶"><a href="#4-6-æ‰“åŒ…å‹ç¼©éƒ¨ç½²é•œåƒæ–‡ä»¶" class="headerlink" title="4.6 æ‰“åŒ…å‹ç¼©éƒ¨ç½²é•œåƒæ–‡ä»¶"></a>4.6 æ‰“åŒ…å‹ç¼©éƒ¨ç½²é•œåƒæ–‡ä»¶</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å°† æ•´ä¸ªkubesphere-images/ ç›®å½•æ‰“åŒ…å‹ç¼©æˆä¸€ä¸ªæ–‡ä»¶</span><br>root@ksp-deploy:~/kubekey# tar -zcf kubesphere-images.tar.gz kubesphere-images/<br>root@ksp-deploy:~/kubekey# ls -alh kubesphere-images.tar.gz<br>-rw-r--r-- 1 root root 4.0G Dec 29 17:26 kubesphere-images.tar.gz<br></code></pre></td></tr></table></figure><h2 id="4-7-å‡†å¤‡ä¸æ‰“åŒ…å‹ç¼©ä¾èµ–ç»„ä»¶ç¦»çº¿å®‰è£…åŒ…"><a href="#4-7-å‡†å¤‡ä¸æ‰“åŒ…å‹ç¼©ä¾èµ–ç»„ä»¶ç¦»çº¿å®‰è£…åŒ…" class="headerlink" title="4.7 å‡†å¤‡ä¸æ‰“åŒ…å‹ç¼©ä¾èµ–ç»„ä»¶ç¦»çº¿å®‰è£…åŒ…"></a>4.7 å‡†å¤‡ä¸æ‰“åŒ…å‹ç¼©ä¾èµ–ç»„ä»¶ç¦»çº¿å®‰è£…åŒ…</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ–¹æ³•1ï¼šå¦‚ä¸‹æ–¹æ³•åªä¸‹è½½éƒ¨ç½²k8sä¸kubesphereæ—¶éœ€è¦ç”¨åˆ°çš„ä¾èµ–ç»„ä»¶ çš„ç¦»çº¿å®‰è£…æ–‡ä»¶</span><br>root@ksp-deploy:~/kubekey# mkdir dependent-components<br>root@ksp-deploy:~/kubekey# cd dependent-components<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹ä¾èµ–ï¼š</span><br>root@ksp-deploy:~/kubekey/dependent-components# apt-cache depends socat conntrack ebtables ipset ipvsadm<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹è½½ deb ä¾èµ–åŒ…</span><br>root@ksp-deploy:~/kubekey/dependent-components# apt-get download $(apt-cache depends --recurse --no-recommends --no-suggests --no-conflicts --no-breaks --no-replaces --no-enhances --no-pre-depends depends socat conntrack ebtables ipset ipvsadm | grep -v i386 | grep &quot;^\w&quot;)<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰“åŒ…å‹ç¼©</span><br>root@ksp-deploy:~/kubekey# tar -zcf dependent-components.tar.gz dependent-components/<br>root@ksp-deploy:~/kubekey# ls -alh dependent-components.tar.gz <br>-rw-r--r-- 1 root root 6.8M Dec 30 13:03 dependent-components.tar.gz<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ–¹æ³•2ï¼šçœŸæ­£åœ¨ç¦»çº¿éƒ¨ç½²æ­¤ç±»ç¯å¢ƒåº”è¯¥ä¼šå‡†å¤‡ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„å¸¸ç”¨ç»„ä»¶ç¦»çº¿å®‰è£…æœ¬åœ°æºï¼Œæ­¤å¤„ä¸å±•å¼€é˜è¿°</span><br></code></pre></td></tr></table></figure><h2 id="4-8-æ‰“åŒ…å‹ç¼©å…¶ä»–æ–‡ä»¶"><a href="#4-8-æ‰“åŒ…å‹ç¼©å…¶ä»–æ–‡ä»¶" class="headerlink" title="4.8 æ‰“åŒ…å‹ç¼©å…¶ä»–æ–‡ä»¶"></a>4.8 æ‰“åŒ…å‹ç¼©å…¶ä»–æ–‡ä»¶</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŠŠ KubeKeyæ–‡ä»¶å¤¹ã€kubekey-v3.0.13-linux-arm64.tar.gzã€offline-installation-tool.shç­‰5ä¸ªæ–‡ä»¶ï¼ˆå¤¹ï¼‰ä¹Ÿåˆ¶ä½œæˆå‹ç¼©åŒ…ï¼Œä¾¿äºæ‹·è´åˆ°ç¦»çº¿èŠ‚ç‚¹ã€‚</span><br>root@ksp-deploy:~/kubekey# tar -zcf deploy-files.tar.gz kubekey kubekey-v3.0.13-linux-arm64.tar.gz offline-installation-tool.sh registry-2.tar.gz images-list.txt<br>root@ksp-deploy:~/kubekey# ls -alh deploy-files.tar.gz <br>-rw-r--r-- 1 root root 250M Dec 30 20:15 deploy-files.tar.gz<br></code></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å‡†å¤‡äº†å¦‚ä¸‹ç¦»çº¿éƒ¨ç½²èµ„æºåŒ…ï¼š</p><ul><li>éƒ¨ç½²é•œåƒæ–‡ä»¶ï¼š<strong>kubesphere-images.tar.gzï¼ˆ4.0Gï¼‰</strong></li><li>éƒ¨ç½²å·¥å…·æ–‡ä»¶ï¼š<strong>deploy-files.tar.gzï¼ˆ250Mï¼‰</strong></li><li>ä¾èµ–ç»„ä»¶ç¦»çº¿å®‰è£…åŒ…ï¼š<strong>dependent-components.tar.gzï¼ˆ6.8Mï¼‰</strong></li></ul><h1 id="äº”ã€éƒ¨ç½²-KSP-å’Œ-K8S-çš„å‰ç½®å‡†å¤‡æ“ä½œ"><a href="#äº”ã€éƒ¨ç½²-KSP-å’Œ-K8S-çš„å‰ç½®å‡†å¤‡æ“ä½œ" class="headerlink" title="äº”ã€éƒ¨ç½² KSP å’Œ K8S çš„å‰ç½®å‡†å¤‡æ“ä½œ"></a>äº”ã€éƒ¨ç½² KSP å’Œ K8S çš„å‰ç½®å‡†å¤‡æ“ä½œ</h1><h2 id="5-1-ä¸Šä¼ ç¦»çº¿éƒ¨ç½²èµ„æºåŒ…åˆ°éƒ¨ç½²èŠ‚ç‚¹"><a href="#5-1-ä¸Šä¼ ç¦»çº¿éƒ¨ç½²èµ„æºåŒ…åˆ°éƒ¨ç½²èŠ‚ç‚¹" class="headerlink" title="5.1 ä¸Šä¼ ç¦»çº¿éƒ¨ç½²èµ„æºåŒ…åˆ°éƒ¨ç½²èŠ‚ç‚¹"></a>5.1 ä¸Šä¼ ç¦»çº¿éƒ¨ç½²èµ„æºåŒ…åˆ°éƒ¨ç½²èŠ‚ç‚¹</h2><p>å°†ä»¥ä¸‹ç¦»çº¿éƒ¨ç½²èµ„æºåŒ…ï¼ˆkubesphere-images.tar.gzã€dependent-components.tar.gzä¸deploy-files.tar.gz ï¼‰ï¼Œä¸Šä¼ è‡³ç¦»çº¿ç¯å¢ƒéƒ¨ç½²èŠ‚ç‚¹ (æ­¤å¤„æ˜¯ <strong>node01</strong> èŠ‚ç‚¹ï¼Œæ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯å‚è€ƒæ–‡æ¡£æœ€å¼€å§‹å¤„çš„æè¿°) çš„ &#x2F;opt&#x2F;deploy-k8s-ksp ç›®å½•ï¼ˆå¯æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ï¼‰ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ›ç¦»çº¿èµ„æºå­˜æ”¾çš„æ•°æ®ç›®å½•</span><br>root@node01:/# mkdir /opt/deploy-k8s-ksp<br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä¸Šä¼ kubesphere-images.tar.gzä¸deploy-files.tar.gz æ–‡ä»¶åˆ°node01:/opt/deploy-k8s-ksp ç›®å½•ä¸‹</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè§£å‹ç›¸å…³æ–‡ä»¶ï¼š</span><br>root@node01:/opt/deploy-k8s-ksp# tar -zxf kubesphere-images.tar.gz<br>root@node01:/opt/deploy-k8s-ksp# tar -zxf deploy-files.tar.gz<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è‡³æ­¤è·å¾—å¦‚ä¸‹æ–‡ä»¶ï¼ˆå¤¹ï¼‰</span><br>root@node01:/opt/deploy-k8s-ksp# ls -alh<br>total 4.3G<br>drwxr-xr-x  7 root root 4.0K Dec 30 20:17 .<br>drwxr-xr-x  5 root root 4.0K Dec 30 19:32 ..<br>-rw-r--r--  1 root root 6.8M Dec 30 13:04 dependent-components.tar.gz<br>-rw-r--r--  1 root root 250M Dec 30 20:17 deploy-files.tar.gz<br>-rw-r--r--  1 root root 2.7K Dec 30 19:34 images-list.txt<br>drwxr-xr-x 16 root root 4.0K Dec 29 17:05 kubekey<br>-rw-r--r--  1 root root  32M Dec 28 17:23 kubekey-v3.0.13-linux-arm64.tar.gz<br>drwxr-xr-x  2 root root 4.0K Dec 29 17:10 kubesphere-images<br>-rw-r--r--  1 root root 4.0G Dec 29 17:35 kubesphere-images.tar.gz<br>-rwxr-xr-x  1 root root 8.6K Dec  6 22:52 offline-installation-tool.sh<br>-rw-------  1 root root  25M Dec 29 17:29 registry-2.tar.gz<br></code></pre></td></tr></table></figure><h2 id="5-2-å®‰è£…dockerå®¹å™¨æœåŠ¡"><a href="#5-2-å®‰è£…dockerå®¹å™¨æœåŠ¡" class="headerlink" title="5.2 å®‰è£…dockerå®¹å™¨æœåŠ¡"></a>5.2 å®‰è£…dockerå®¹å™¨æœåŠ¡</h2><p>â€‹k8sé›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦å®‰è£…ä¸é…ç½®ã€‚å°†node01èŠ‚ç‚¹ä¸Šçš„ &#x2F;opt&#x2F;deploy-k8s-ksp&#x2F;kubekey&#x2F;v1.23.17&#x2F;arm64&#x2F;docker-24.0.6.tgz å¤åˆ¶åˆ°k8sé›†ç¾¤çš„å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹ä¸Šï¼Œç„¶åæŒ‰ç…§å¦‚ä¸‹æ–¹å¼è§£å‹ä¸éƒ¨ç½²dockeræœåŠ¡ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŒ‰ç…§å¦‚ä¸‹æ–¹å¼è§£å‹ä¸éƒ¨ç½²dockeræœåŠ¡</span><br>root@node01:/opt/deploy-k8s-ksp# tar -zxf kubekey/v1.23.17/arm64/docker-24.0.6.tgz<br>root@node01:/opt/deploy-k8s-ksp# chown root:root -R docker/<br>root@node01:/opt/deploy-k8s-ksp# mv docker/* /usr/bin/ &amp;&amp; rmdir docker<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨systemdç®¡ç†dockeræœåŠ¡</span><br>root@node01:/opt/deploy-k8s-ksp# cat &gt; /etc/systemd/system/docker.service &lt;&lt;EOF<br>[Unit]<br>Description=Docker Application Container Engine<br>Documentation=https://docs.docker.com<br>After=network-online.target firewalld.service<br>Wants=network-online.target<br><br>[Service]<br>Type=notify<br>ExecStart=/usr/bin/dockerd<br>ExecReload=/bin/kill -s HUP $MAINPID<br>LimitNOFILE=infinity<br>LimitNPROC=infinity<br>TimeoutStartSec=0<br>Delegate=yes<br>KillMode=process<br>Restart=on-failure<br>StartLimitBurst=3<br>StartLimitInterval=60s<br><br>[Install]<br>WantedBy=multi-user.target<br>EOF<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">é…ç½®dockerå®ˆæŠ¤è¿›ç¨‹é…ç½®æ–‡ä»¶ï¼š/etc/docker/daemon.json</span><br>root@node01:/opt/deploy-k8s-ksp# mkdir -p /etc/docker<br>root@node01:/opt/deploy-k8s-ksp# cat &gt; /etc/docker/daemon.json &lt;&lt;EOF<br>&#123;<br>    &quot;insecure-registries&quot;: [<br>        &quot;dockerhub.kubekey.local&quot;<br>    ],<br>    &quot;log-opts&quot;: &#123;<br>        &quot;max-file&quot;: &quot;5&quot;,<br>        &quot;max-size&quot;: &quot;50m&quot;<br>    &#125;,<br>    &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;]<br>&#125;<br>EOF<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨ /etc/hosts ä¸­æ·»åŠ ä¸€ä¸ªæ¡ç›®ï¼Œå°†ä¸»æœºåï¼ˆå³ä»“åº“åŸŸåï¼›åœ¨æœ¬ç¤ºä¾‹ä¸­æ˜¯ dockerhub.kubekey.localï¼‰æ˜ å°„åˆ°docker resgistryæ‰€åœ¨æœåŠ¡å™¨çš„ç§æœ‰ IP åœ°å€ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œä»¥ä¸‹è§„åˆ’172.25.253.93æ˜¯docker resgistryæ‰€åœ¨æœåŠ¡å™¨</span><br>root@node01:/opt/deploy-k8s-ksp# cat &gt;&gt; /etc/hosts &lt;&lt;EOF<br>172.25.253.93 dockerhub.kubekey.local<br>EOF<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åº”ç”¨ä¸Šè¿°æ–‡ä»¶å¹¶å¯åŠ¨dickeræœåŠ¡ï¼Œè®¾ç½®å¼€æœºè‡ªå¯åŠ¨</span><br>root@node01:/opt/deploy-k8s-ksp# systemctl daemon-reload &amp;&amp; systemctl restart docker<br>root@node01:/opt/deploy-k8s-ksp# systemctl status docker<br>root@node01:/opt/deploy-k8s-ksp# systemctl enable docker.service<br><br>root@node01:/opt/deploy-k8s-ksp# docker version          <br>Client:<br> Version:           24.0.6<br> API version:       1.43<br> Go version:        go1.20.7<br> Git commit:        ed223bc<br> Built:             Mon Sep  4 12:30:04 2023<br> OS/Arch:           linux/arm64<br> Context:           default<br><br>Server: Docker Engine - Community<br> Engine:<br>  Version:          24.0.6<br>  API version:      1.43 (minimum version 1.12)<br>  Go version:       go1.20.7<br>  Git commit:       1a79695<br>  Built:            Mon Sep  4 12:31:30 2023<br>  OS/Arch:          linux/arm64<br>  Experimental:     false<br> containerd:<br>  Version:          v1.7.3<br>  GitCommit:        7880925980b188f4c97b462f709d0db8e8962aff<br> runc:<br>  Version:          1.1.9<br>  GitCommit:        v1.1.9-0-gccaecfc<br> docker-init:<br>  Version:          0.19.0<br>  GitCommit:        de40ad0<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯åŠ¨dockerå‘½ä»¤è‡ªåŠ¨è¡¥å…¨</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@node01:/opt/deploy-k8s-ksp# <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;source &lt;(docker completion bash)&quot;</span> &gt;&gt; /root/.bashrc</span> <br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@node01:/opt/deploy-k8s-ksp# <span class="hljs-built_in">source</span> /root/.bashrc</span><br></code></pre></td></tr></table></figure><h2 id="5-3-å®‰è£…ä¾èµ–ç»„ä»¶"><a href="#5-3-å®‰è£…ä¾èµ–ç»„ä»¶" class="headerlink" title="5.3 å®‰è£…ä¾èµ–ç»„ä»¶"></a>5.3 å®‰è£…ä¾èµ–ç»„ä»¶</h2><p>â€‹k8sé›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦å®‰è£…ä¸é…ç½®ã€‚å°†node01èŠ‚ç‚¹ä¸Šçš„&#x2F;opt&#x2F;deploy-k8s-ksp&#x2F;kubekey&#x2F;dependent-components.tar.gz å¤åˆ¶åˆ°k8sé›†ç¾¤çš„å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹ä¸Šï¼Œç„¶åæŒ‰ç…§å¦‚ä¸‹æ–¹å¼è§£å‹ä¸å®‰è£…ä¾èµ–ç»„ä»¶ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@node01:/opt/deploy-k8s-ksp# tar -zxf dependent-components.tar.gz<br>root@node01:/opt/deploy-k8s-ksp# cd dependent-components<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨dpkgå‘½ä»¤è¿›è¡Œç¦»çº¿å®‰è£…</span><br>root@node01:/opt/deploy-k8s-ksp/dependent-components# dpkg -i *.deb<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯ä»¥å…ˆåšå¥½sshå…å¯†ç™»å½•</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¼ è¾“ dependent-components.tar.gz åˆ°node01ä¹‹å¤–çš„å…¶ä»–k8sèŠ‚ç‚¹ /opt/deploy-k8s-ksp/ ç›®å½•ä¸‹</span><br>root@node01:/opt/deploy-k8s-ksp# for i in &#123;2..5&#125;; do ssh -t root@node0$&#123;i&#125; &quot;mkdir -p /opt/deploy-k8s-ksp&quot;; done<br>root@node01:/opt/deploy-k8s-ksp# for i in &#123;2..5&#125;; do scp dependent-components.tar.gz root@node0$&#123;i&#125;:/opt/deploy-k8s-ksp/; done <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">k8sé›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹å®‰è£…ä¾èµ–ç»„ä»¶</span><br>root@node01:/opt/deploy-k8s-ksp# for i in &#123;1..5&#125;; do ssh -t root@node0$&#123;i&#125; &quot;cd /opt/deploy-k8s-ksp &amp;&amp; tar -zxf dependent-components.tar.gz &amp;&amp; cd dependent-components &amp;&amp; dpkg -i *.deb&quot;; done<br></code></pre></td></tr></table></figure><h2 id="5-4-å‡†å¤‡ä¸€ä¸ªç§æœ‰é•œåƒä»“åº“"><a href="#5-4-å‡†å¤‡ä¸€ä¸ªç§æœ‰é•œåƒä»“åº“" class="headerlink" title="5.4 å‡†å¤‡ä¸€ä¸ªç§æœ‰é•œåƒä»“åº“"></a>5.4 å‡†å¤‡ä¸€ä¸ªç§æœ‰é•œåƒä»“åº“</h2><p>â€‹Harborå®˜æ–¹æœªæä¾›harborå®‰è£…æ–‡ä»¶ï¼Œè™½ç„¶ç¬”è€…å·²ç»æ‰¾åˆ°åœ¨arm64æœåŠ¡å™¨ä¸Šéƒ¨ç½²harborçš„æ–¹æ³•ï¼Œä½†æœ¬æ–‡ä»¥ Docker ä»“åº“ä½œä¸ºé•œåƒä»“åº“å­˜å‚¨k8séƒ¨ç½²è¿‡ç¨‹ä¸­éœ€è¦ç”¨åˆ°çš„é•œåƒï¼Œå¹¶ä½¿ç”¨<a href="https://docs.docker.com/registry/insecure/#use-self-signed-certificates">è‡ªç­¾åè¯ä¹¦</a>ã€‚</p><p>â€‹æœ¬æ–‡åœ¨node01ä¸Šæ­å»º Docker ä»“åº“ã€‚</p><h3 id="ä½¿ç”¨è‡ªç­¾åè¯ä¹¦"><a href="#ä½¿ç”¨è‡ªç­¾åè¯ä¹¦" class="headerlink" title="ä½¿ç”¨è‡ªç­¾åè¯ä¹¦"></a>ä½¿ç”¨è‡ªç­¾åè¯ä¹¦</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆæ‚¨è‡ªå·±çš„è¯ä¹¦</span><br>root@node01:/opt/deploy-k8s-ksp# mkdir certs<br>root@node01:/opt/deploy-k8s-ksp# openssl req -addext &quot;subjectAltName = DNS:dockerhub.kubekey.local&quot; \<br>  -newkey rsa:4096 -nodes -sha256 -keyout certs/domain.key \<br>  -x509 -days 36500 -out certs/domain.crt<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/12/29/PtgGJ71CjWSfEZY.png" alt="image-20241229221911321"></p><h3 id="å¯åŠ¨-Docker-ä»“åº“"><a href="#å¯åŠ¨-Docker-ä»“åº“" class="headerlink" title="å¯åŠ¨ Docker ä»“åº“"></a>å¯åŠ¨ Docker ä»“åº“</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åŠ è½½registry:2é•œåƒ</span><br>root@node01:/opt/deploy-k8s-ksp# docker load -i registry-2.tar.gz <br>2ee1e756df5d: Loading layer [==================================================&gt;]  7.955MB/7.955MB<br>9ef0c8e13134: Loading layer [==================================================&gt;]  898.6kB/898.6kB<br>a7c03a80ddda: Loading layer [==================================================&gt;]  16.65MB/16.65MB<br>55f11e417f9b: Loading layer [==================================================&gt;]  3.584kB/3.584kB<br>caa2189153ef: Loading layer [==================================================&gt;]  2.048kB/2.048kB<br>Loaded image: registry:2<br>root@node01:/opt/deploy-k8s-ksp# docker images <br>REPOSITORY   TAG       IMAGE ID       CREATED         SIZE<br>registry     2         1c6adc34955d   15 months ago   25MB<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è®©Dockerä¿¡ä»»åˆšç”Ÿæˆçš„è¯ä¹¦</span><br>root@node01:/opt/deploy-k8s-ksp# mkdir -p  /etc/docker/certs.d/dockerhub.kubekey.local<br>root@node01:/opt/deploy-k8s-ksp# cp certs/domain.crt  /etc/docker/certs.d/dockerhub.kubekey.local/ca.crt<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨ Docker ä»“åº“</span><br>root@node01:/opt/deploy-k8s-ksp# docker run -d \<br> --restart=always \<br> --name registry \<br> -v &quot;$(pwd)&quot;/certs:/certs \<br> -v /mnt/registry:/var/lib/registry \<br> -e REGISTRY_HTTP_ADDR=0.0.0.0:443 \<br> -e REGISTRY_HTTP_TLS_CERTIFICATE=/certs/domain.crt \<br> -e REGISTRY_HTTP_TLS_KEY=/certs/domain.key \<br> -p 443:443 \<br> registry:2<br></code></pre></td></tr></table></figure><h3 id="éªŒè¯ä»“åº“"><a href="#éªŒè¯ä»“åº“" class="headerlink" title="éªŒè¯ä»“åº“"></a>éªŒè¯ä»“åº“</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">è¦éªŒè¯ç§æœ‰ä»“åº“æ˜¯å¦æœ‰æ•ˆï¼Œå¯ä»¥ä¿®æ”¹é•œåƒregistry:2çš„namespaceï¼Œç„¶åä½¿ç”¨ docker push å’Œ docker pull æ¥æµ‹è¯•ã€‚</span><br>root@node01:/opt/deploy-k8s-ksp# docker tag registry:2 dockerhub.kubekey.local/registry:2<br>root@node01:/opt/deploy-k8s-ksp# docker push dockerhub.kubekey.local/registry:2<br>root@node01:/opt/deploy-k8s-ksp# docker pull dockerhub.kubekey.local/registry:2<br></code></pre></td></tr></table></figure><h2 id="5-5-æ¨é€é•œåƒè‡³ç§æœ‰ä»“åº“"><a href="#5-5-æ¨é€é•œåƒè‡³ç§æœ‰ä»“åº“" class="headerlink" title="5.5 æ¨é€é•œåƒè‡³ç§æœ‰ä»“åº“"></a>5.5 æ¨é€é•œåƒè‡³ç§æœ‰ä»“åº“</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†æ‰“åŒ…çš„é•œåƒæ–‡ä»¶ä¼ è¾“è‡³æ‚¨çš„æœ¬åœ°æœºå™¨ï¼Œå¹¶è¿è¡Œä»¥ä¸‹å‘½ä»¤æŠŠå®ƒæ¨é€è‡³ä»“åº“</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å‘½ä»¤ä¸­çš„åŸŸåæ˜¯ dockerhub.kubekey.localï¼Œå®ƒæ˜¯docker registryä»“åº“çš„åˆ«å</span><br>root@node01:/opt/deploy-k8s-ksp# ./offline-installation-tool.sh -l images-list.txt -d ./kubesphere-images -r dockerhub.kubekey.local<br></code></pre></td></tr></table></figure><h2 id="5-6-åˆ›å»ºç¦»çº¿é›†ç¾¤é…ç½®æ–‡ä»¶"><a href="#5-6-åˆ›å»ºç¦»çº¿é›†ç¾¤é…ç½®æ–‡ä»¶" class="headerlink" title="5.6 åˆ›å»ºç¦»çº¿é›†ç¾¤é…ç½®æ–‡ä»¶"></a>5.6 åˆ›å»ºç¦»çº¿é›†ç¾¤é…ç½®æ–‡ä»¶</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºç¦»çº¿é›†ç¾¤é…ç½®æ–‡ä»¶</span><br>root@node01:/opt/deploy-k8s-ksp# tar -zxf kubekey-v3.0.13-linux-arm64.tar.gz <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœåœ¨è¿™ä¸€æ­¥çš„å‘½ä»¤ä¸­ä¸æ·»åŠ æ ‡å¿— --with-kubesphereï¼Œåˆ™ä¸ä¼šéƒ¨ç½² KubeSphereï¼Œåªèƒ½ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„ addons å­—æ®µå®‰è£…ï¼Œæˆ–è€…åç»­ä½¿ç”¨ ./kk create cluster å‘½ä»¤æ—¶å†æ¬¡æ·»åŠ è¿™ä¸ªæ ‡å¿—ã€‚</span><br>root@node01:/opt/deploy-k8s-ksp# ./kk create config --with-kubesphere v3.4.1 --with-kubernetes v1.23.17 -f ksp-v341-v12317-offline.yaml<br></code></pre></td></tr></table></figure><p>å‘½ä»¤æ‰§è¡ŒæˆåŠŸåï¼Œåœ¨å½“å‰ç›®å½•ä¼šç”Ÿæˆæ–‡ä»¶åä¸º ksp-v341-v12317-offline.yaml çš„é…ç½®æ–‡ä»¶ã€‚</p><h2 id="5-7-ä¿®æ”¹-Cluster-é…ç½®"><a href="#5-7-ä¿®æ”¹-Cluster-é…ç½®" class="headerlink" title="5.7 ä¿®æ”¹ Cluster é…ç½®"></a>5.7 ä¿®æ”¹ Cluster é…ç½®</h2><p>â€‹åœ¨ç¦»çº¿é›†ç¾¤é…ç½®æ–‡ä»¶æ–‡ä»¶ä¸­ <strong>kind: Cluster</strong> å°èŠ‚çš„ä½œç”¨æ˜¯éƒ¨ç½² Kubernetes é›†ç¾¤ã€‚æœ¬æ–‡ç¤ºä¾‹é‡‡ç”¨ 3 ä¸ªèŠ‚ç‚¹åŒæ—¶ä½œä¸º control-planeã€etcd èŠ‚ç‚¹ï¼Œä¸¤ä¸ªèŠ‚ç‚¹ä½œä¸º worker èŠ‚ç‚¹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä¿®æ”¹ç¦»çº¿é›†ç¾¤é…ç½®æ–‡ä»¶ ksp-v341-v12317-offline.yaml</span><br>root@node01:/data/kubekey# vi ksp-v341-v12317-offline.yaml<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ <strong>kind: Cluster</strong> å°èŠ‚ä¸­ hosts å’Œ roleGroups ç­‰ä¿¡æ¯ï¼Œä¿®æ”¹è¯´æ˜å¦‚ä¸‹ã€‚</p><ul><li>hostsï¼šæŒ‡å®šèŠ‚ç‚¹çš„ IPã€sshç™»å½•ç”¨æˆ·ã€sshç™»å½•å¯†ç ï¼Œå¹¶æŒ‡æ˜æœåŠ¡å™¨æ„æ¶ã€‚</li><li>roleGroupsï¼šæŒ‡å®š 3 ä¸ª etcdã€control-plane èŠ‚ç‚¹ï¼Œ2 ä¸ª worker èŠ‚ç‚¹</li></ul><p>ä¿®æ”¹controlPlaneEndpointç»„çš„é…ç½®ï¼š</p><ul><li>internalLoadbalancerï¼š å¯ç”¨å†…ç½®çš„ HAProxy è´Ÿè½½å‡è¡¡å™¨</li></ul><p>æ·»åŠ storageç»„çš„é…ç½®ï¼š</p><ul><li>storage.openebs.basePathï¼š<strong>æ–°å¢é…ç½®</strong>ï¼ŒæŒ‡å®š     openebs é»˜è®¤å­˜å‚¨è·¯å¾„ä¸º <strong>&#x2F;data&#x2F;openebs&#x2F;local</strong></li></ul><p>ä¿®æ”¹registryç»„çš„é…ç½®ï¼š</p><ul><li>registryï¼šä½¿ç”¨ docker registryï¼Œå®ƒçš„åœ°å€æ˜¯â€dockerhub.kubekey.localâ€</li></ul><p>ä¿®æ”¹æˆ–æ·»åŠ çš„å†…å®¹å¦‚ä¸‹ï¼ˆå…¶ä½™ä¿æŒé»˜è®¤ï¼‰ï¼š</p><p><img src="https://s2.loli.net/2024/12/30/cpIRmhfQl69xLZ3.png" alt="image-20241230203614561"></p><h2 id="5-8-æœ€åçš„é…ç½®"><a href="#5-8-æœ€åçš„é…ç½®" class="headerlink" title="5.8 æœ€åçš„é…ç½®"></a>5.8 æœ€åçš„é…ç½®</h2><p>â€‹ç»è¿‡ä¸Šè¿°æ­¥éª¤ï¼Œæˆ‘ä»¬æˆåŠŸå®Œæˆäº†å¯¹ç¦»çº¿é›†ç¾¤é…ç½®æ–‡ä»¶ ksp-v341-v12317-offline.yaml çš„ä¿®æ”¹ã€‚æ­¤æ—¶ï¼Œä¿®æ”¹åçš„ ksp-v341-v12317-offline.yamlæ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">kubekey.kubesphere.io/v1alpha2</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Cluster</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">sample</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">hosts:</span><br>  <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">name:</span> <span class="hljs-string">node01</span>, <span class="hljs-attr">address:</span> <span class="hljs-number">172.25</span><span class="hljs-number">.253</span><span class="hljs-number">.93</span>, <span class="hljs-attr">internalAddress:</span> <span class="hljs-number">172.25</span><span class="hljs-number">.253</span><span class="hljs-number">.93</span>, <span class="hljs-attr">user:</span> <span class="hljs-string">root</span>, <span class="hljs-attr">password:</span> <span class="hljs-string">&quot;cloud@123&quot;</span>, <span class="hljs-attr">arch:</span> <span class="hljs-string">arm64</span> &#125;<br>  <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">name:</span> <span class="hljs-string">node02</span>, <span class="hljs-attr">address:</span> <span class="hljs-number">172.25</span><span class="hljs-number">.253</span><span class="hljs-number">.94</span>, <span class="hljs-attr">internalAddress:</span> <span class="hljs-number">172.25</span><span class="hljs-number">.253</span><span class="hljs-number">.94</span>, <span class="hljs-attr">user:</span> <span class="hljs-string">root</span>, <span class="hljs-attr">password:</span> <span class="hljs-string">&quot;cloud@123&quot;</span>, <span class="hljs-attr">arch:</span> <span class="hljs-string">arm64</span> &#125;<br>  <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">name:</span> <span class="hljs-string">node03</span>, <span class="hljs-attr">address:</span> <span class="hljs-number">172.25</span><span class="hljs-number">.253</span><span class="hljs-number">.95</span>, <span class="hljs-attr">internalAddress:</span> <span class="hljs-number">172.25</span><span class="hljs-number">.253</span><span class="hljs-number">.95</span>, <span class="hljs-attr">user:</span> <span class="hljs-string">root</span>, <span class="hljs-attr">password:</span> <span class="hljs-string">&quot;cloud@123&quot;</span>, <span class="hljs-attr">arch:</span> <span class="hljs-string">arm64</span> &#125;<br>  <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">name:</span> <span class="hljs-string">node04</span>, <span class="hljs-attr">address:</span> <span class="hljs-number">172.25</span><span class="hljs-number">.253</span><span class="hljs-number">.113</span>, <span class="hljs-attr">internalAddress:</span> <span class="hljs-number">172.25</span><span class="hljs-number">.253</span><span class="hljs-number">.113</span>, <span class="hljs-attr">user:</span> <span class="hljs-string">root</span>, <span class="hljs-attr">password:</span> <span class="hljs-string">&quot;cloud@123&quot;</span>, <span class="hljs-attr">arch:</span> <span class="hljs-string">arm64</span> &#125;<br>  <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">name:</span> <span class="hljs-string">node05</span>, <span class="hljs-attr">address:</span> <span class="hljs-number">172.25</span><span class="hljs-number">.253</span><span class="hljs-number">.114</span>, <span class="hljs-attr">internalAddress:</span> <span class="hljs-number">172.25</span><span class="hljs-number">.253</span><span class="hljs-number">.114</span>, <span class="hljs-attr">user:</span> <span class="hljs-string">root</span>, <span class="hljs-attr">password:</span> <span class="hljs-string">&quot;cloud@123&quot;</span>, <span class="hljs-attr">arch:</span> <span class="hljs-string">arm64</span> &#125;<br>  <span class="hljs-attr">roleGroups:</span><br>    <span class="hljs-attr">etcd:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">node01</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">node02</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">node03</span><br>    <span class="hljs-attr">control-plane:</span> <br>    <span class="hljs-bullet">-</span> <span class="hljs-string">node01</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">node02</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">node03</span><br>    <span class="hljs-attr">worker:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">node04</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">node05</span><br>  <span class="hljs-attr">controlPlaneEndpoint:</span><br>    <span class="hljs-comment">## Internal loadbalancer for apiservers </span><br>    <span class="hljs-attr">internalLoadbalancer:</span> <span class="hljs-string">haproxy</span><br>    <span class="hljs-attr">domain:</span> <span class="hljs-string">lb.kubesphere.local</span><br>    <span class="hljs-attr">address:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6443</span><br>  <span class="hljs-attr">kubernetes:</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-string">v1.23.17</span><br>    <span class="hljs-attr">clusterName:</span> <span class="hljs-string">cluster.local</span><br>    <span class="hljs-attr">autoRenewCerts:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">containerManager:</span> <span class="hljs-string">docker</span><br>  <span class="hljs-attr">etcd:</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">kubekey</span><br>  <span class="hljs-attr">network:</span><br>    <span class="hljs-attr">plugin:</span> <span class="hljs-string">calico</span><br>    <span class="hljs-attr">kubePodsCIDR:</span> <span class="hljs-number">10.233</span><span class="hljs-number">.64</span><span class="hljs-number">.0</span><span class="hljs-string">/18</span><br>    <span class="hljs-attr">kubeServiceCIDR:</span> <span class="hljs-number">10.233</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-string">/18</span><br>    <span class="hljs-comment">## multus support. https://github.com/k8snetworkplumbingwg/multus-cni</span><br>    <span class="hljs-attr">multusCNI:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">storage:</span><br>    <span class="hljs-attr">openebs:</span><br>      <span class="hljs-attr">basePath:</span> <span class="hljs-string">/mnt/openebs/local</span> <span class="hljs-comment"># é»˜è®¤æ²¡æœ‰ï¼Œæ–°å¢çš„é…ç½®ï¼Œbase path of the local PV provisioner</span><br>  <span class="hljs-attr">registry:</span><br>    <span class="hljs-attr">privateRegistry:</span> <span class="hljs-string">&quot;dockerhub.kubekey.local&quot;</span><br>    <span class="hljs-attr">namespaceOverride:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">registryMirrors:</span> []<br>    <span class="hljs-attr">insecureRegistries:</span> []<br>  <span class="hljs-attr">addons:</span> []<br><br><br><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">installer.kubesphere.io/v1alpha1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterConfiguration</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">ks-installer</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kubesphere-system</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-string">v3.4.1</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">persistence:</span><br>    <span class="hljs-attr">storageClass:</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">authentication:</span><br>    <span class="hljs-attr">jwtSecret:</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">local_registry:</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-comment"># dev_tag: &quot;&quot;</span><br>  <span class="hljs-attr">etcd:</span><br>    <span class="hljs-attr">monitoring:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">endpointIps:</span> <span class="hljs-string">localhost</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">2379</span><br>    <span class="hljs-attr">tlsEnable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">common:</span><br>    <span class="hljs-attr">core:</span><br>      <span class="hljs-attr">console:</span><br>        <span class="hljs-attr">enableMultiLogin:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-attr">port:</span> <span class="hljs-number">30880</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">NodePort</span><br>    <span class="hljs-comment"># apiserver:</span><br>    <span class="hljs-comment">#  resources: &#123;&#125;</span><br>    <span class="hljs-comment"># controllerManager:</span><br>    <span class="hljs-comment">#  resources: &#123;&#125;</span><br>    <span class="hljs-attr">redis:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">enableHA:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">volumeSize:</span> <span class="hljs-string">2Gi</span><br>    <span class="hljs-attr">openldap:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">volumeSize:</span> <span class="hljs-string">2Gi</span><br>    <span class="hljs-attr">minio:</span><br>      <span class="hljs-attr">volumeSize:</span> <span class="hljs-string">20Gi</span><br>    <span class="hljs-attr">monitoring:</span><br>      <span class="hljs-comment"># type: external</span><br>      <span class="hljs-attr">endpoint:</span> <span class="hljs-string">http://prometheus-operated.kubesphere-monitoring-system.svc:9090</span><br>      <span class="hljs-attr">GPUMonitoring:</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">gpu:</span><br>      <span class="hljs-attr">kinds:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">resourceName:</span> <span class="hljs-string">&quot;nvidia.com/gpu&quot;</span><br>        <span class="hljs-attr">resourceType:</span> <span class="hljs-string">&quot;GPU&quot;</span><br>        <span class="hljs-attr">default:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">es:</span><br>      <span class="hljs-comment"># master:</span><br>      <span class="hljs-comment">#   volumeSize: 4Gi</span><br>      <span class="hljs-comment">#   replicas: 1</span><br>      <span class="hljs-comment">#   resources: &#123;&#125;</span><br>      <span class="hljs-comment"># data:</span><br>      <span class="hljs-comment">#   volumeSize: 20Gi</span><br>      <span class="hljs-comment">#   replicas: 1</span><br>      <span class="hljs-comment">#   resources: &#123;&#125;</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">logMaxAge:</span> <span class="hljs-number">7</span><br>      <span class="hljs-attr">elkPrefix:</span> <span class="hljs-string">logstash</span><br>      <span class="hljs-attr">basicAuth:</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>        <span class="hljs-attr">username:</span> <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">password:</span> <span class="hljs-string">&quot;&quot;</span><br>      <span class="hljs-attr">externalElasticsearchHost:</span> <span class="hljs-string">&quot;&quot;</span><br>      <span class="hljs-attr">externalElasticsearchPort:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">opensearch:</span><br>      <span class="hljs-comment"># master:</span><br>      <span class="hljs-comment">#   volumeSize: 4Gi</span><br>      <span class="hljs-comment">#   replicas: 1</span><br>      <span class="hljs-comment">#   resources: &#123;&#125;</span><br>      <span class="hljs-comment"># data:</span><br>      <span class="hljs-comment">#   volumeSize: 20Gi</span><br>      <span class="hljs-comment">#   replicas: 1</span><br>      <span class="hljs-comment">#   resources: &#123;&#125;</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">logMaxAge:</span> <span class="hljs-number">7</span><br>      <span class="hljs-attr">opensearchPrefix:</span> <span class="hljs-string">whizard</span><br>      <span class="hljs-attr">basicAuth:</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-attr">username:</span> <span class="hljs-string">&quot;admin&quot;</span><br>        <span class="hljs-attr">password:</span> <span class="hljs-string">&quot;admin&quot;</span><br>      <span class="hljs-attr">externalOpensearchHost:</span> <span class="hljs-string">&quot;&quot;</span><br>      <span class="hljs-attr">externalOpensearchPort:</span> <span class="hljs-string">&quot;&quot;</span><br>      <span class="hljs-attr">dashboard:</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">alerting:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-comment"># thanosruler:</span><br>    <span class="hljs-comment">#   replicas: 1</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>  <span class="hljs-attr">auditing:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-comment"># operator:</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>    <span class="hljs-comment"># webhook:</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>  <span class="hljs-attr">devops:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">jenkinsCpuReq:</span> <span class="hljs-number">0.5</span><br>    <span class="hljs-attr">jenkinsCpuLim:</span> <span class="hljs-number">1</span><br>    <span class="hljs-attr">jenkinsMemoryReq:</span> <span class="hljs-string">4Gi</span><br>    <span class="hljs-attr">jenkinsMemoryLim:</span> <span class="hljs-string">4Gi</span><br>    <span class="hljs-attr">jenkinsVolumeSize:</span> <span class="hljs-string">16Gi</span><br>  <span class="hljs-attr">events:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-comment"># operator:</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>    <span class="hljs-comment"># exporter:</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>    <span class="hljs-attr">ruler:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>  <span class="hljs-attr">logging:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">logsidecar:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span><br>      <span class="hljs-comment"># resources: &#123;&#125;</span><br>  <span class="hljs-attr">metrics_server:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">monitoring:</span><br>    <span class="hljs-attr">storageClass:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">node_exporter:</span><br>      <span class="hljs-attr">port:</span> <span class="hljs-number">9100</span><br>      <span class="hljs-comment"># resources: &#123;&#125;</span><br>    <span class="hljs-comment"># kube_rbac_proxy:</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>    <span class="hljs-comment"># kube_state_metrics:</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>    <span class="hljs-comment"># prometheus:</span><br>    <span class="hljs-comment">#   replicas: 1</span><br>    <span class="hljs-comment">#   volumeSize: 20Gi</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>    <span class="hljs-comment">#   operator:</span><br>    <span class="hljs-comment">#     resources: &#123;&#125;</span><br>    <span class="hljs-comment"># alertmanager:</span><br>    <span class="hljs-comment">#   replicas: 1</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>    <span class="hljs-comment"># notification_manager:</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>    <span class="hljs-comment">#   operator:</span><br>    <span class="hljs-comment">#     resources: &#123;&#125;</span><br>    <span class="hljs-comment">#   proxy:</span><br>    <span class="hljs-comment">#     resources: &#123;&#125;</span><br>    <span class="hljs-attr">gpu:</span><br>      <span class="hljs-attr">nvidia_dcgm_exporter:</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>        <span class="hljs-comment"># resources: &#123;&#125;</span><br>  <span class="hljs-attr">multicluster:</span><br>    <span class="hljs-attr">clusterRole:</span> <span class="hljs-string">none</span><br>  <span class="hljs-attr">network:</span><br>    <span class="hljs-attr">networkpolicy:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">ippool:</span><br>      <span class="hljs-attr">type:</span> <span class="hljs-string">none</span><br>    <span class="hljs-attr">topology:</span><br>      <span class="hljs-attr">type:</span> <span class="hljs-string">none</span><br>  <span class="hljs-attr">openpitrix:</span><br>    <span class="hljs-attr">store:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">servicemesh:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">istio:</span><br>      <span class="hljs-attr">components:</span><br>        <span class="hljs-attr">ingressGateways:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">istio-ingressgateway</span><br>          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>        <span class="hljs-attr">cni:</span><br>          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">edgeruntime:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">kubeedge:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">cloudCore:</span><br>        <span class="hljs-attr">cloudHub:</span><br>          <span class="hljs-attr">advertiseAddress:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">service:</span><br>          <span class="hljs-attr">cloudhubNodePort:</span> <span class="hljs-string">&quot;30000&quot;</span><br>          <span class="hljs-attr">cloudhubQuicNodePort:</span> <span class="hljs-string">&quot;30001&quot;</span><br>          <span class="hljs-attr">cloudhubHttpsNodePort:</span> <span class="hljs-string">&quot;30002&quot;</span><br>          <span class="hljs-attr">cloudstreamNodePort:</span> <span class="hljs-string">&quot;30003&quot;</span><br>          <span class="hljs-attr">tunnelNodePort:</span> <span class="hljs-string">&quot;30004&quot;</span><br>        <span class="hljs-comment"># resources: &#123;&#125;</span><br>        <span class="hljs-comment"># hostNetWork: false</span><br>      <span class="hljs-attr">iptables-manager:</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-attr">mode:</span> <span class="hljs-string">&quot;external&quot;</span><br>        <span class="hljs-comment"># resources: &#123;&#125;</span><br>      <span class="hljs-comment"># edgeService:</span><br>      <span class="hljs-comment">#   resources: &#123;&#125;</span><br>  <span class="hljs-attr">gatekeeper:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-comment"># controller_manager:</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>    <span class="hljs-comment"># audit:</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>  <span class="hljs-attr">terminal:</span><br>    <span class="hljs-attr">timeout:</span> <span class="hljs-number">600</span><br><br><br><br></code></pre></td></tr></table></figure><h2 id="5-9-å®‰è£…é…ç½®-Harbor"><a href="#5-9-å®‰è£…é…ç½®-Harbor" class="headerlink" title="5.9 å®‰è£…é…ç½® Harbor"></a>5.9 å®‰è£…é…ç½® Harbor</h2><p>â€‹arm64æœåŠ¡å™¨ä¸Šæ­å»ºharborç¯å¢ƒå¯ä»¥å‚è€ƒï¼š<a href="https://jiangsanyin.github.io/2024/10/30/arm64%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8B%E7%9A%84Harbor-v2-11-1%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/%E3%80%82">https://jiangsanyin.github.io/2024/10/30/arm64%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8B%E7%9A%84Harbor-v2-11-1%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/ã€‚</a></p><p>â€‹åç»­ç”¨æ³•è·Ÿx86_64æ„æ¶æœåŠ¡å™¨ä¸Šçš„harborä¸€æ ·ã€‚</p><h1 id="å…­ã€å®‰è£…-KubeSphere-å’Œ-K8s-é›†ç¾¤"><a href="#å…­ã€å®‰è£…-KubeSphere-å’Œ-K8s-é›†ç¾¤" class="headerlink" title="å…­ã€å®‰è£… KubeSphere å’Œ K8s é›†ç¾¤"></a>å…­ã€å®‰è£… KubeSphere å’Œ K8s é›†ç¾¤</h1><h2 id="6-1-æ‰§è¡Œå®‰è£…KubeSphere-å’Œ-K8s-é›†ç¾¤"><a href="#6-1-æ‰§è¡Œå®‰è£…KubeSphere-å’Œ-K8s-é›†ç¾¤" class="headerlink" title="6.1 æ‰§è¡Œå®‰è£…KubeSphere å’Œ K8s é›†ç¾¤"></a>6.1 æ‰§è¡Œå®‰è£…KubeSphere å’Œ K8s é›†ç¾¤</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»ºmkdir-copyfile.sh</span><br>root@node01:/opt/deploy-k8s-ksp# touch mkdir-copyfile.sh<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å…¶å†…å®¹å¦‚ä¸‹</span><br>root@node01:/opt/deploy-k8s-ksp# cat mkdir-copyfile.sh<br>cd /opt/deploy-k8s-ksp<br>mkdir kubekey/kube<br>mkdir -p kubekey/kube/v1.23.17/arm64/ kubekey/helm/v3.9.0/arm64/ kubekey/cni/v1.2.0/arm64/ kubekey/crictl/v1.24.0/arm64/ kubekey/etcd/v3.4.13/arm64/ kubekey/docker/24.0.6/arm64/ kubekey/cni/v3.26.1/arm64/<br>cp -rp kubekey/v1.23.17/arm64/kube* kubekey/kube/v1.23.17/arm64/<br>cp -rp kubekey/v1.23.17/arm64/helm kubekey/helm/v3.9.0/arm64/<br>cp -rp kubekey/v1.23.17/arm64/cni-plugins-linux-arm64-v1.2.0.tgz kubekey/cni/v1.2.0/arm64/<br>cp -rp kubekey/v1.23.17/arm64/crictl-v1.24.0-linux-arm64.tar.gz kubekey/crictl/v1.24.0/arm64/<br>cp -rp kubekey/v1.23.17/arm64/etcd-v3.4.13-linux-arm64.tar.gz kubekey/etcd/v3.4.13/arm64/<br>cp -rp kubekey/v1.23.17/arm64/docker-24.0.6.tgz kubekey/docker/24.0.6/arm64/<br>cp -rp kubekey/v1.23.17/arm64/calicoctl-linux-arm64 kubekey/cni/v3.26.1/arm64/calicoctl<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœ /mnt/openebs/local ç›®å½•éç©ºï¼Œè¯·å°†æ­¤ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶æ¸…ç©ºï¼Œå¦åˆ™å®‰è£…å°†å¤±è´¥ã€æç¤ºå¦‚ä¸‹</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">TASK [common : debug] **********************************************************</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ok: [localhost] =&gt; &#123;</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   <span class="hljs-string">&quot;msg&quot;</span>: [</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">       <span class="hljs-string">&quot;1. check the storage configuration and storage server&quot;</span>,</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">       <span class="hljs-string">&quot;2. make sure the DNS address in /etc/resolv.conf is available&quot;</span>,</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">       <span class="hljs-string">&quot;3. execute &#x27;kubectl logs -n kubesphere-system -l job-name=minio-make-bucket-job&#x27; to watch logs&quot;</span>,</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">       <span class="hljs-string">&quot;4. execute &#x27;helm -n kubesphere-system uninstall ks-minio &amp;&amp; kubectl -n kubesphere-system delete job minio-make-bucket-job&#x27;&quot;</span>,</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">       <span class="hljs-string">&quot;5. Restart the installer pod in kubesphere-system namespace&quot;</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   ]</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">&#125;</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå®‰è£… KubeSphere å’Œ K8s é›†ç¾¤</span><br>root@node01:/opt/deploy-k8s-ksp# bash mkdir-copyfile.sh<br>root@node01:/opt/deploy-k8s-ksp# ./kk create cluster -f ksp-v341-v12317-offline.yaml --yes<br></code></pre></td></tr></table></figure><p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p><ul><li><strong>ksp-v341-v12317-offline.yaml</strong>ï¼šç¦»çº¿ç¯å¢ƒé›†ç¾¤çš„é…ç½®æ–‡ä»¶</li></ul><p>ä¸Šé¢çš„å‘½ä»¤æ‰§è¡Œåï¼Œé¦–å…ˆ KubeKey ä¼šæ£€æŸ¥éƒ¨ç½² K8s çš„ä¾èµ–åŠå…¶ä»–è¯¦ç»†è¦æ±‚ã€‚æ£€æŸ¥åˆæ ¼åï¼Œç³»ç»Ÿå°†æç¤ºç¡®è®¤å®‰è£…ã€‚è¾“å…¥ <strong>yes</strong> å¹¶æŒ‰ ENTER ç»§ç»­éƒ¨ç½²ã€‚</p><p><img src="https://s2.loli.net/2024/12/30/3LfSJPVpq6zwTAe.png" alt="image-20241230205705028"></p><h2 id="6-2-éƒ¨ç½²åç½®å¤„ç†"><a href="#6-2-éƒ¨ç½²åç½®å¤„ç†" class="headerlink" title="6.2 éƒ¨ç½²åç½®å¤„ç†"></a>6.2 éƒ¨ç½²åç½®å¤„ç†</h2><h3 id="6-2-1-pod-default-http-backend-75f5768976-6svwx-ä¸€ç›´å¤„äºImagePullBackOff-çŠ¶æ€"><a href="#6-2-1-pod-default-http-backend-75f5768976-6svwx-ä¸€ç›´å¤„äºImagePullBackOff-çŠ¶æ€" class="headerlink" title="6.2.1 pod&#x2F;default-http-backend-75f5768976-6svwx ä¸€ç›´å¤„äºImagePullBackOff çŠ¶æ€"></a>6.2.1 pod&#x2F;default-http-backend-75f5768976-6svwx ä¸€ç›´å¤„äºImagePullBackOff çŠ¶æ€</h3><p><img src="https://s2.loli.net/2024/12/31/TkcI3ZlBXCdhmvA.png" alt="image-20241231095318516"></p><ul><li>åˆ†æï¼š</li></ul><p>å› ä¸ºå®‰è£…ç¨‹åºå°è¯•æ‹‰å–ä¸ä½¿ç”¨çš„é•œåƒæ˜¯amd64æ„æ¶é•œåƒï¼Œåº”è¯¥æ˜¯å®‰è£…ç¨‹åºï¼ˆå…·ä½“åœ°è¯´æ˜¯kkå·¥å…·ï¼‰å†…éƒ¨çš„é”™è¯¯ã€‚ä¸”åœ¨æ­¤å¤„ç§æœ‰é•œåƒé•œåƒä»“åº“ä¸­å°è¯•æ‹‰å–çš„é•œåƒå¹¶ä¸å­˜åœ¨ï¼Œæ‰€ä»¥ä¸€ç›´æ‹‰å–ä¸æˆåŠŸã€‚</p><ul><li>è§£å†³åŠæ³•ï¼š</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿®æ”¹ å‘½åç©ºé—´kubesphere-controls-systemä¸‹çš„pod/default-http-backend-75f5768976-6svwx</span><br>root@node01:/opt/deploy-k8s-ksp# kubectl -n kubesphere-controls-system edit pod default-http-backend-75f5768976-6svwx<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†specä¸­ä½¿ç”¨çš„é•œåƒä¿®æ”¹ä¸ºâ€œdockerhub.kubekey.local/mirrorgooglecontainers/defaultbackend-arm64:1.4â€</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/12/31/RKht1DJzk2FAogm.png" alt="image-20241231095456573"></p><h2 id="6-3-æ§åˆ¶èŠ‚ç‚¹é…ç½®keepalived"><a href="#6-3-æ§åˆ¶èŠ‚ç‚¹é…ç½®keepalived" class="headerlink" title="6.3 æ§åˆ¶èŠ‚ç‚¹é…ç½®keepalived"></a>6.3 æ§åˆ¶èŠ‚ç‚¹é…ç½®keepalived</h2><p>â€‹æš‚ç•¥ã€‚é…ç½®keepalivedç›¸å…³æ–¹æ³•å¯ä»¥å‚è€ƒï¼š<a href="https://jiangsanyin.github.io/2024/08/10/%E6%90%AD%E5%BB%BA%E4%BA%92%E4%B8%BA%E4%B8%BB%E5%A4%87MySQL5-7%E9%9B%86%E7%BE%A4%E5%B9%B6%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E5%88%87%E6%8D%A2/#2-3-%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AEkeepalived">https://jiangsanyin.github.io/2024/08/10/%E6%90%AD%E5%BB%BA%E4%BA%92%E4%B8%BA%E4%B8%BB%E5%A4%87MySQL5-7%E9%9B%86%E7%BE%A4%E5%B9%B6%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E5%88%87%E6%8D%A2/#2-3-%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AEkeepalived</a></p><h1 id="ä¸ƒã€éƒ¨ç½²ç»“æœéªŒè¯"><a href="#ä¸ƒã€éƒ¨ç½²ç»“æœéªŒè¯" class="headerlink" title="ä¸ƒã€éƒ¨ç½²ç»“æœéªŒè¯"></a>ä¸ƒã€éƒ¨ç½²ç»“æœéªŒè¯</h1><p>â€‹è®¿é—®kubesphere3.4.1çš„webç®¡ç†ç•Œé¢ï¼š <a href="http://172.25.253.93:30880/login">http://172.25.253.93:30880/login</a> ã€‚é»˜è®¤ç”¨æˆ·åï¼šadminï¼Œå…¶é»˜è®¤å¯†ç ï¼šP@88w0rd</p><p>ç™»å½•æˆåŠŸåçœ‹åˆ°çš„ç•Œé¢ï¼š</p><p><img src="https://s2.loli.net/2024/12/30/FuNh3jOedGBbZwC.png" alt="image-20241230205947409"></p><p>æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼š</p><p><img src="https://s2.loli.net/2024/12/30/OsUv98dunWCNKJy.png" alt="image-20241230205929259"></p><h1 id="å…«ã€å‚è€ƒæ–‡æ¡£"><a href="#å…«ã€å‚è€ƒæ–‡æ¡£" class="headerlink" title="å…«ã€å‚è€ƒæ–‡æ¡£"></a>å…«ã€å‚è€ƒæ–‡æ¡£</h1><ul><li><a href="https://v3-1.docs.kubesphere.io/zh/docs/installing-on-linux/introduction/air-gapped-installation/">https://v3-1.docs.kubesphere.io/zh/docs/installing-on-linux/introduction/air-gapped-installation/</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>k8säº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kubekey ç¦»çº¿éƒ¨ç½² arm64 k8s kubesphere</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>k8såœ¨çº¿éƒ¨ç½²-ä½¿ç”¨kubeaszéƒ¨ç½²amd64é«˜å¯ç”¨k8s1-23-17</title>
    <link href="/2024/12/01/k8s%E5%9C%A8%E7%BA%BF%E9%83%A8%E7%BD%B2-%E4%BD%BF%E7%94%A8kubeasz%E9%83%A8%E7%BD%B2amd64%E9%AB%98%E5%8F%AF%E7%94%A8k8s1-23-17/"/>
    <url>/2024/12/01/k8s%E5%9C%A8%E7%BA%BF%E9%83%A8%E7%BD%B2-%E4%BD%BF%E7%94%A8kubeasz%E9%83%A8%E7%BD%B2amd64%E9%AB%98%E5%8F%AF%E7%94%A8k8s1-23-17/</url>
    
    <content type="html"><![CDATA[<h1 id="äºŒã€éƒ¨ç½²k8sé«˜å¯ç”¨é›†ç¾¤"><a href="#äºŒã€éƒ¨ç½²k8sé«˜å¯ç”¨é›†ç¾¤" class="headerlink" title="äºŒã€éƒ¨ç½²k8sé«˜å¯ç”¨é›†ç¾¤"></a>äºŒã€éƒ¨ç½²k8sé«˜å¯ç”¨é›†ç¾¤</h1><h2 id="2-1-é«˜å¯ç”¨é›†ç¾¤è§„åˆ’"><a href="#2-1-é«˜å¯ç”¨é›†ç¾¤è§„åˆ’" class="headerlink" title="2.1 é«˜å¯ç”¨é›†ç¾¤è§„åˆ’"></a>2.1 é«˜å¯ç”¨é›†ç¾¤è§„åˆ’</h2><p>é«˜å¯ç”¨é›†ç¾¤æ„æ¶å›¾å¤§è‡´å¦‚ä¸‹ï¼ˆä¸‹å›¾æ˜¯ä»å®˜ç½‘å¤åˆ¶è¿‡æ¥çš„ï¼Œè·Ÿæœ¬æ–‡ä¸­k8sé›†ç¾¤èŠ‚ç‚¹å¸ƒå±€ç¨æœ‰å·®åˆ«ï¼Œä½†å¤§è‡´ä¸å˜ï¼‰ï¼š</p><img src="https://s2.loli.net/2024/10/11/9pqcV4iXyCxbjsW.png" alt="image-20241011112321181" style="zoom: 50%;" /><ul><li>æ³¨æ„1ï¼šç¡®ä¿å„èŠ‚ç‚¹æ—¶åŒºè®¾ç½®ä¸€è‡´ã€æ—¶é—´åŒæ­¥ã€‚ å¦‚æœä½ çš„ç¯å¢ƒæ²¡æœ‰æä¾›NTP æ—¶é—´åŒæ­¥ï¼Œæ¨èé›†æˆå®‰è£…<a href="https://github.com/easzlab/kubeasz/blob/3.5.3/docs/guide/chrony.md">chrony</a></li><li>æ³¨æ„2ï¼šç¡®ä¿åœ¨å¹²å‡€çš„ç³»ç»Ÿä¸Šå¼€å§‹å®‰è£…ï¼Œä¸è¦ä½¿ç”¨æ›¾ç»è£…è¿‡kubeadmæˆ–å…¶ä»–k8så‘è¡Œç‰ˆçš„ç¯å¢ƒ</li><li>æ³¨æ„3ï¼šå»ºè®®æ“ä½œç³»ç»Ÿå‡çº§åˆ°æ–°çš„ç¨³å®šå†…æ ¸ï¼Œè¯·ç»“åˆé˜…è¯»<a href="https://github.com/easzlab/kubeasz/blob/3.5.3/docs/guide/kernel_upgrade.md">å†…æ ¸å‡çº§æ–‡æ¡£</a></li><li>æ³¨æ„4ï¼šåœ¨å…¬æœ‰äº‘ä¸Šåˆ›å»ºå¤šä¸»é›†ç¾¤ï¼Œè¯·ç»“åˆé˜…è¯»<a href="https://github.com/easzlab/kubeasz/blob/3.5.3/docs/setup/kubeasz_on_public_cloud.md">åœ¨å…¬æœ‰äº‘ä¸Šéƒ¨ç½² kubeasz</a></li></ul><p>é«˜å¯ç”¨é›†ç¾¤æ‰€éœ€èŠ‚ç‚¹é…ç½®å¦‚ä¸‹ï¼š</p><table><thead><tr><th>è§’è‰²</th><th>æ•°é‡</th><th>æè¿°</th></tr></thead><tbody><tr><td>éƒ¨ç½²èŠ‚ç‚¹</td><td>1</td><td>è¿è¡Œansible&#x2F;ezctlå‘½ä»¤ï¼Œä¸€èˆ¬å¤ç”¨ç¬¬ä¸€ä¸ªmasterèŠ‚ç‚¹</td></tr><tr><td>etcdèŠ‚ç‚¹</td><td>3</td><td>æ³¨æ„etcdé›†ç¾¤éœ€è¦1,3,5,â€¦å¥‡æ•°ä¸ªèŠ‚ç‚¹ï¼Œä¸€èˆ¬å¤ç”¨masterèŠ‚ç‚¹</td></tr><tr><td>masterèŠ‚ç‚¹</td><td>3</td><td>é«˜å¯ç”¨é›†ç¾¤è‡³å°‘3ä¸ªmasterèŠ‚ç‚¹ï¼ˆä¸Šå›¾æ¥è‡ªkubeaszå®˜ç½‘ï¼Œåªç”»å‡ºä¸¤ä¸ªmasterèŠ‚ç‚¹ä¸å‡†ç¡®ï¼‰</td></tr><tr><td>nodeèŠ‚ç‚¹</td><td>n</td><td>è¿è¡Œåº”ç”¨è´Ÿè½½çš„èŠ‚ç‚¹ï¼Œå¯æ ¹æ®éœ€è¦æå‡æœºå™¨é…ç½®&#x2F;å¢åŠ èŠ‚ç‚¹æ•°</td></tr></tbody></table><p>æœºå™¨é…ç½®ï¼š</p><ul><li>masterèŠ‚ç‚¹ï¼š4c&#x2F;8gå†…å­˜&#x2F;50gç¡¬ç›˜</li><li>workerèŠ‚ç‚¹ï¼šå»ºè®®8c&#x2F;32gå†…å­˜&#x2F;200gç¡¬ç›˜ä»¥ä¸Š</li></ul><p>æ³¨æ„ï¼šé»˜è®¤é…ç½®ä¸‹å®¹å™¨è¿è¡Œæ—¶å’Œkubeletä¼šå ç”¨&#x2F;varçš„ç£ç›˜ç©ºé—´ï¼Œå¦‚æœç£ç›˜åˆ†åŒºç‰¹æ®Šï¼Œå¯ä»¥è®¾ç½®config.ymlä¸­çš„å®¹å™¨è¿è¡Œæ—¶å’Œkubeletæ•°æ®ç›®å½•ï¼š<code>CONTAINERD_STORAGE_DIR</code> <code>DOCKER_STORAGE_DIR</code> <code>KUBELET_ROOT_DIR</code></p><p>åœ¨ kubeasz 2x ç‰ˆæœ¬ï¼Œå¤šèŠ‚ç‚¹é«˜å¯ç”¨é›†ç¾¤å®‰è£…å¯ä»¥ä½¿ç”¨2ç§æ–¹å¼ï¼š</p><ul><li>1.æŒ‰ç…§æœ¬æ–‡æ­¥éª¤å…ˆè§„åˆ’å‡†å¤‡ï¼Œé¢„å…ˆé…ç½®èŠ‚ç‚¹ä¿¡æ¯åï¼Œç›´æ¥å®‰è£…å¤šèŠ‚ç‚¹é«˜å¯ç”¨é›†ç¾¤</li><li>2.å…ˆéƒ¨ç½²å•èŠ‚ç‚¹é›†ç¾¤ <a href="https://github.com/easzlab/kubeasz/blob/3.5.3/docs/setup/quickStart.md">AllinOneéƒ¨ç½²</a>ï¼Œç„¶åé€šè¿‡ <a href="https://github.com/easzlab/kubeasz/blob/3.5.3/docs/op/op-index.md">èŠ‚ç‚¹æ·»åŠ </a> æ‰©å®¹æˆé«˜å¯ç”¨é›†ç¾¤</li></ul><h2 id="2-2-é«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²æ­¥éª¤"><a href="#2-2-é«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²æ­¥éª¤" class="headerlink" title="2.2 é«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²æ­¥éª¤"></a>2.2 é«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²æ­¥éª¤</h2><p>ä»¥ä¸‹ç¤ºä¾‹åˆ›å»ºä¸€ä¸ª5èŠ‚ç‚¹çš„å¤šä¸»é«˜å¯ç”¨é›†ç¾¤ï¼Œæœ€åæ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹k8s03-6ï¼Œæ–‡æ¡£ä¸­å‘½ä»¤é»˜è®¤éƒ½éœ€è¦rootæƒé™è¿è¡Œã€‚</p><table><thead><tr><th>ä¸»æœºå</th><th>IP</th><th>rootå¯†ç </th><th>è§„æ ¼</th><th>ç£ç›˜</th><th>æ“ä½œç³»ç»Ÿ</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>k8s03-1</td><td>10.13.15.61</td><td>cloud@2020</td><td>8c16g</td><td>400G</td><td>Ubuntu20.04.3 LTS-amd64</td><td>æ§åˆ¶èŠ‚ç‚¹ã€HarboræœåŠ¡å™¨</td></tr><tr><td>k8s03-2</td><td>10.13.15.62</td><td>cloud@2020</td><td>8c16g</td><td>400G</td><td>Ubuntu20.04.3 LTS-amd64</td><td>æ§åˆ¶èŠ‚ç‚¹</td></tr><tr><td>k8s03-3</td><td>10.13.15.63</td><td>cloud@2020</td><td>8c16g</td><td>400G</td><td>Ubuntu20.04.3 LTS-amd64</td><td>æ§åˆ¶èŠ‚ç‚¹</td></tr><tr><td></td><td>10.13.15.70</td><td></td><td></td><td></td><td></td><td>å¤šæ§åˆ¶èŠ‚ç‚¹åškeepalivedä¸l4lbåçš„è™šæ‹Ÿip</td></tr><tr><td>k8s03-4</td><td>10.13.15.64</td><td>cloud@2020</td><td>8c16g</td><td>400G</td><td>Ubuntu20.04.3 LTS-amd64</td><td>å·¥ä½œèŠ‚ç‚¹</td></tr><tr><td>k8s03-5</td><td>10.13.15.65</td><td>cloud@2020</td><td>8c16g</td><td>400G</td><td>Ubuntu20.04.3 LTS-amd64</td><td>å·¥ä½œèŠ‚ç‚¹</td></tr><tr><td>k8s03-6</td><td>10.13.15.66</td><td>cloud@2020</td><td>8c16g</td><td>400G</td><td>Ubuntu20.04.3 LTS-amd64</td><td>æ§åˆ¶èŠ‚ç‚¹ï¼ˆæ¼”ç¤ºæ·»åŠ å·¥ä½œèŠ‚ç‚¹ï¼‰</td></tr></tbody></table><h3 id="2-2-1-åŸºç¡€ç³»ç»Ÿé…ç½®"><a href="#2-2-1-åŸºç¡€ç³»ç»Ÿé…ç½®" class="headerlink" title="2.2.1 åŸºç¡€ç³»ç»Ÿé…ç½®"></a>2.2.1 åŸºç¡€ç³»ç»Ÿé…ç½®</h3><ul><li>å¼€å‘ç¯å¢ƒæ¯ä¸ªèŠ‚ç‚¹8Cæ ¸å¿ƒ16Gå†…æ ¸&#x2F;50Gç£ç›˜+ï¼Œç”Ÿäº§ç¯å¢ƒçš„é…ç½®è¦æ›´é«˜ï¼ˆå…·ä½“çœ‹ä¸šåŠ¡æ•°é‡ã€‚å»ºè®®ç›´æ¥ç”¨128C256G+ç‰©ç†æœåŠ¡å™¨ï¼‰ã€ç£ç›˜ç©ºé—´å»ºè®®1T+</li><li>æœ€å°åŒ–å®‰è£…<code>Ubuntu 16.04+ serveræˆ–è€…CentOS 7+ Minimal</code></li><li>é…ç½®åŸºç¡€ç½‘ç»œã€æ›´æ–°æºã€SSHç™»å½•ç­‰</li><li>æ¨èä½¿ç”¨ansible in docker å®¹å™¨åŒ–æ–¹å¼è¿è¡Œï¼Œæ— éœ€å®‰è£…é¢å¤–ä¾èµ–</li></ul><h3 id="2-2-2-åœ¨æ¯ä¸ªèŠ‚ç‚¹é…ç½®æ—¶é—´åŒæ­¥"><a href="#2-2-2-åœ¨æ¯ä¸ªèŠ‚ç‚¹é…ç½®æ—¶é—´åŒæ­¥" class="headerlink" title="2.2.2 åœ¨æ¯ä¸ªèŠ‚ç‚¹é…ç½®æ—¶é—´åŒæ­¥"></a>2.2.2 åœ¨æ¯ä¸ªèŠ‚ç‚¹é…ç½®æ—¶é—´åŒæ­¥</h3><h4 id="2-2-2-1-é…ç½®æ—¶åŒº"><a href="#2-2-2-1-é…ç½®æ—¶åŒº" class="headerlink" title="2.2.2.1 é…ç½®æ—¶åŒº"></a>2.2.2.1 é…ç½®æ—¶åŒº</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰€æœ‰èŠ‚ç‚¹æ—¶åŒºéƒ½é…ç½®ä¸ºä¸œå…«åŒº</span><br>timedatectl set-timezone Asia/Shanghai<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰‹åŠ¨è®¾ç½®æ—¶é—´ä¸ºåŒ—äº¬æ—¶é—´ï¼ˆå°½é‡é è¿‘å‡†ç¡®çš„åŒ—äº¬æ—¶é—´ï¼‰</span><br>timedatectl set-time &quot;YYYY-MM-DD HH:MM:SS&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹æ—¶åŒºä¸æ—¶é—´</span><br>timedatectl<br></code></pre></td></tr></table></figure><h4 id="2-2-2-2-å®‰è£…é…ç½®æ—¶é—´åŒæ­¥æœåŠ¡"><a href="#2-2-2-2-å®‰è£…é…ç½®æ—¶é—´åŒæ­¥æœåŠ¡" class="headerlink" title="2.2.2.2 å®‰è£…é…ç½®æ—¶é—´åŒæ­¥æœåŠ¡"></a>2.2.2.2 å®‰è£…é…ç½®æ—¶é—´åŒæ­¥æœåŠ¡</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">1.å®‰è£… chrony ä½œä¸ºæ—¶é—´åŒæ­¥è½¯ä»¶ï¼š</span><br>apt-get install chrony -qy<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">2.ä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/chrony/chrony.confï¼Œä¿®æ”¹ ntp æœåŠ¡å™¨é…ç½®ï¼ˆä»¥ä¸‹3ç§æ–¹å¼ä»»é€‰å…¶ä¸€ï¼‰ï¼š</span><br>vi /etc/chrony/chrony.conf<br><span class="hljs-meta prompt_"># </span><span class="language-bash">2.1 ä½¿ç”¨é»˜è®¤çš„ pool é…ç½®</span><br>pool ntp.ubuntu.com        iburst maxsources 4<br>pool 0.ubuntu.pool.ntp.org iburst maxsources 1<br>pool 1.ubuntu.pool.ntp.org iburst maxsources 1<br>pool 2.ubuntu.pool.ntp.org iburst maxsources 2<br><span class="hljs-meta prompt_"># </span><span class="language-bash">2.2 å¢åŠ å›½å†…çš„ ntp æœåŠ¡å™¨ï¼Œæˆ–æ˜¯æŒ‡å®šå…¶ä»–å¸¸ç”¨çš„æ—¶é—´æœåŠ¡å™¨</span><br>server ntp.aliyun.com iburst<br>server ntp1.aliyun.com iburst<br>server ntp2.aliyun.com iburst<br>server ntp1.cloud.aliyuncs.com iburst<br>server ntp2.cloud.aliyuncs.com iburst<br>server ntp3.cloud.aliyuncs.com iburst<br>server ntp7.cloud.aliyuncs.com iburst<br>server ntp8.cloud.aliyuncs.com iburst<br>server ntp9.cloud.aliyuncs.com iburst<br>server ntp.api.bz iburst<br><span class="hljs-meta prompt_"># </span><span class="language-bash">2.3 è‹¥è¦ä½¿ç”¨æœ¬åœ°NTPæœåŠ¡å™¨ï¼Œå¯ä»¥å°†ä¸Šé¢çš„åˆ é™¤ï¼Œç„¶åæ·»åŠ è‡ªå·±çš„NTPæœåŠ¡å™¨ï¼ˆå‡è®¾10.0.0.1æ˜¯æœ¬åœ°NTPæœåŠ¡å™¨ï¼‰ï¼š</span><br>server 10.0.0.1 iburst<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">é‡å¯ chrony æœåŠ¡ï¼š</span><br>systemctl restart chrony<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">éªŒè¯ chrony åŒæ­¥çŠ¶æ€ï¼š</span><br>chronyc sourcestats -v<br><span class="hljs-meta prompt_">#</span><span class="language-bash">è¾“å‡ºå†…å®¹å¤§è‡´å¦‚ä¸‹</span><br>210 Number of sources = 8<br>                             .- Number of sample points in measurement set.<br>                            /    .- Number of residual runs with same sign.<br>                           |    /    .- Length of measurement set (time).<br>                           |   |    /      .- Est. clock freq error (ppm).<br>                           |   |   |      /           .- Est. error in freq.<br>                           |   |   |     |           /         .- Est. offset.<br>                           |   |   |     |          |          |   On the -.<br>                           |   |   |     |          |          |   samples. \<br>                           |   |   |     |          |          |             |<br>Name/IP Address            NP  NR  Span  Frequency  Freq Skew  Offset  Std Dev<br>==============================================================================<br>prod-ntp-3.ntp1.ps5.cano&gt;   4   3     9   +704.136  21532.734    -17ms  4358us<br>prod-ntp-4.ntp1.ps5.cano&gt;   4   3    10  +1534.234  26545.184   +395us  5834us<br>alphyn.canonical.com        4   3    11   -633.039  22169.467  -3371us  4248us<br>prod-ntp-5.ntp4.ps5.cano&gt;   4   3     9   -218.393   5069.837    -28ms  1108us<br>tick.ntp.infomaniak.ch      4   3     9   +179.013  18164.828  +4135us  3693us<br>ntp5.flashdance.cx          0   0     0     +0.000   2000.000     +0ns  4000ms<br>ntp7.flashdance.cx          4   3     9  -2025.918  26238.625    -25ms  5856us<br>dns1.synet.edu.cn           4   3     8    +53.828   9119.362   +422us  1610us<br></code></pre></td></tr></table></figure><h3 id="2-2-3-åœ¨æ¯ä¸ªèŠ‚ç‚¹å®‰è£…ä¾èµ–å·¥å…·"><a href="#2-2-3-åœ¨æ¯ä¸ªèŠ‚ç‚¹å®‰è£…ä¾èµ–å·¥å…·" class="headerlink" title="2.2.3 åœ¨æ¯ä¸ªèŠ‚ç‚¹å®‰è£…ä¾èµ–å·¥å…·"></a>2.2.3 åœ¨æ¯ä¸ªèŠ‚ç‚¹å®‰è£…ä¾èµ–å·¥å…·</h3><p>æ¨èä½¿ç”¨ansible in docker å®¹å™¨åŒ–æ–¹å¼è¿è¡Œï¼Œæ— éœ€å®‰è£…é¢å¤–ä¾èµ–</p><h3 id="2-2-4-å®‰è£…k8s"><a href="#2-2-4-å®‰è£…k8s" class="headerlink" title="2.2.4 å®‰è£…k8s"></a>2.2.4 å®‰è£…k8s</h3><p>k8sä¸kubeaszæ¨èçš„åŒ¹é…ç‰ˆæœ¬å¯¹ç…§è¡¨ï¼š</p><table><thead><tr><th>Kubernetes version</th><th>1.19</th><th>1.20</th><th>1.21</th><th>1.22</th><th>1.23</th><th>1.24</th><th>1.25</th><th>1.26</th><th>1.27</th><th>1.28</th><th>1.29</th><th>1.30</th><th>1.31</th></tr></thead><tbody><tr><td>kubeasz version</td><td>2.2.2</td><td>3.0.1</td><td>3.1.0</td><td>3.1.1</td><td>3.2.0</td><td>3.6.2</td><td>3.6.2</td><td>3.6.2</td><td>3.6.2</td><td>3.6.2</td><td>3.6.3</td><td>3.6.4</td><td>3.6.5</td></tr></tbody></table><h4 id="2-2-4-1-ä¸‹è½½é¡¹ç›®æºç ã€äºŒè¿›åˆ¶åŠç¦»çº¿é•œåƒ"><a href="#2-2-4-1-ä¸‹è½½é¡¹ç›®æºç ã€äºŒè¿›åˆ¶åŠç¦»çº¿é•œåƒ" class="headerlink" title="2.2.4.1 ä¸‹è½½é¡¹ç›®æºç ã€äºŒè¿›åˆ¶åŠç¦»çº¿é•œåƒ"></a>2.2.4.1 ä¸‹è½½é¡¹ç›®æºç ã€äºŒè¿›åˆ¶åŠç¦»çº¿é•œåƒ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹è½½å·¥å…·è„šæœ¬ezdownï¼Œä¸¾ä¾‹ä½¿ç”¨kubeaszç‰ˆæœ¬3.2.0</span><br>root@k8s03-1:~# mkdir /opt/kubeasz-deployk8s<br>root@k8s03-1:~# cd /opt/kubeasz-deployk8s<br>root@k8s03-1:/opt/kubeasz-deployk8s# export release=3.2.0<br>root@k8s03-1:/opt/kubeasz-deployk8s# wget https://github.com/easzlab/kubeasz/releases/download/$&#123;release&#125;/ezdown<br>root@k8s03-1:/opt/kubeasz-deployk8s# chmod +x ./ezdown<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹è½½kubeaszä»£ç ã€äºŒè¿›åˆ¶ã€é»˜è®¤å®¹å™¨é•œåƒï¼ˆæ›´å¤šå…³äºezdownçš„å‚æ•°ï¼Œè¿è¡Œ./ezdown æŸ¥çœ‹ï¼‰</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å›½å†…ç¯å¢ƒï¼ˆ-kæŒ‡å®šk8sç‰ˆæœ¬ï¼Œå…¶ä»–å‚æ•°æ‰§è¡Œâ€œ./ezdownâ€æŸ¥çœ‹ï¼‰ï¼Œä»¥ä¸‹å‘½ä»¤ä¼šåˆ›å»ºå¹¶å¯åŠ¨local_registryå®¹å™¨</span><br>./ezdown -D -m &quot;CN&quot; -k &quot;v1.23.17&quot;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æµ·å¤–ç¯å¢ƒ</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">./ezdown -D -m standard</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹è½½harborç›¸å…³é•œåƒ</span><br>root@k8s03-1:/opt/kubeasz-deployk8s# ./ezdown -R -m &quot;CN&quot;<br>root@k8s03-1:/opt/kubeasz-deployk8s# ls -alh /etc/kubeasz/down/harbor-offline-installer*<br>-rw-r--r-- 1 root root 534M Feb  6  2021 /etc/kubeasz/down/harbor-offline-installer-v2.1.3.tgz<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ã€å¯é€‰ã€‘ä¸‹è½½é¢å¤–å®¹å™¨é•œåƒï¼ˆcilium,flannel,prometheusç­‰ï¼‰</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">./ezdown -X -m <span class="hljs-string">&quot;CN&quot;</span> -k <span class="hljs-string">&quot;v1.23.17&quot;</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ã€å¯é€‰ã€‘ä¸‹è½½ç¦»çº¿ç³»ç»ŸåŒ… (é€‚ç”¨äºæ— æ³•ä½¿ç”¨yum/aptä»“åº“æƒ…å½¢)</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">./ezdown -P -m <span class="hljs-string">&quot;CN&quot;</span> -k <span class="hljs-string">&quot;v1.23.17&quot;</span></span><br></code></pre></td></tr></table></figure><p>ä¸Šè¿°è„šæœ¬è¿è¡ŒæˆåŠŸåï¼Œæ‰€æœ‰æ–‡ä»¶ï¼ˆkubeaszä»£ç ã€äºŒè¿›åˆ¶ã€ç¦»çº¿é•œåƒï¼‰å‡å·²æ•´ç†å¥½æ”¾å…¥ç›®å½•<code>/etc/kubeasz</code></p><h4 id="2-2-4-2-åˆ›å»ºé›†ç¾¤é…ç½®å®ä¾‹"><a href="#2-2-4-2-åˆ›å»ºé›†ç¾¤é…ç½®å®ä¾‹" class="headerlink" title="2.2.4.2 åˆ›å»ºé›†ç¾¤é…ç½®å®ä¾‹"></a>2.2.4.2 åˆ›å»ºé›†ç¾¤é…ç½®å®ä¾‹</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">å®¹å™¨åŒ–è¿è¡Œkubeaszï¼ˆä¼šåˆ›å»ºå¹¶å¯åŠ¨kubeaszå®¹å™¨ï¼‰</span><br>./ezdown -S<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ›å»ºæ–°é›†ç¾¤ k8s03</span><br>root@k8s03-1:/opt/kubeasz-deployk8s# docker exec -it kubeasz ezctl new k8s03<br>2024-10-15 11:33:29 DEBUG generate custom cluster files in /etc/kubeasz/clusters/k8s03<br>2024-10-15 11:33:30 DEBUG set versions<br>2024-10-15 11:33:30 DEBUG cluster k8s03: files successfully created.<br>2024-10-15 11:33:30 INFO next steps 1: to config &#x27;/etc/kubeasz/clusters/k8s03/hosts&#x27;<br>2024-10-15 11:33:30 INFO next steps 2: to config &#x27;/etc/kubeasz/clusters/k8s03/config.yml&#x27;<br></code></pre></td></tr></table></figure><p>ç„¶åæ ¹æ®æç¤ºé…ç½®â€™&#x2F;etc&#x2F;kubeasz&#x2F;clusters&#x2F;k8s03&#x2F;hostsâ€™ å’Œ â€˜&#x2F;etc&#x2F;kubeasz&#x2F;clusters&#x2F;k8s03&#x2F;config.ymlâ€™ï¼šæ ¹æ®å‰é¢èŠ‚ç‚¹è§„åˆ’ä¿®æ”¹hosts æ–‡ä»¶å’Œå…¶ä»–é›†ç¾¤å±‚é¢çš„ä¸»è¦é…ç½®é€‰é¡¹ï¼›å…¶ä»–é›†ç¾¤ç»„ä»¶ç­‰é…ç½®é¡¹å¯ä»¥åœ¨config.yml æ–‡ä»¶ä¸­ä¿®æ”¹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŒ‰ä½alté”® + é¼ æ ‡å·¦é”®ï¼Œå¯ä»¥æŒ‰åˆ—é€‰æ‹©</span><br>root@k8s03-1:/opt/kubeasz-deployk8s# vi /etc/kubeasz/clusters/k8s03/hosts<br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-string">&#x27;etcd&#x27;</span> cluster should have odd member(s) (1,3,5,...)</span><br>[etcd]<br>10.13.15.61   #è¿™ä¸ªéœ€è¦ä¿®æ”¹æˆæ§åˆ¶èŠ‚ç‚¹ip<br>10.13.15.62   #è¿™ä¸ªéœ€è¦ä¿®æ”¹æˆæ§åˆ¶èŠ‚ç‚¹ip<br>10.13.15.63   #è¿™ä¸ªéœ€è¦ä¿®æ”¹æˆæ§åˆ¶èŠ‚ç‚¹ip<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">master node(s), <span class="hljs-built_in">set</span> unique <span class="hljs-string">&#x27;k8s_nodename&#x27;</span> <span class="hljs-keyword">for</span> each node</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">CAUTION: <span class="hljs-string">&#x27;k8s_nodename&#x27;</span> must consist of lower <span class="hljs-keyword">case</span> alphanumeric characters, <span class="hljs-string">&#x27;-&#x27;</span> or <span class="hljs-string">&#x27;.&#x27;</span>,</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">and must start and end with an alphanumeric character</span><br>[kube_master]<br><span class="hljs-meta prompt_">#</span><span class="language-bash">10.13.15.61 k8s_nodename=<span class="hljs-string">&quot;k8s03-1&quot;</span>   <span class="hljs-comment">#è¿™ä¸ªéœ€è¦ä¿®æ”¹ï¼ˆå¦‚æœæ²¡æœ‰k8s_nodenameé…ç½®ï¼Œåˆ™å®‰è£…åå°†ç›´æ¥ä½¿ç”¨ipä½œä¸ºk8sèŠ‚ç‚¹åï¼‰</span></span><br>10.13.15.61                          #è¿™ä¸ªéœ€è¦ä¿®æ”¹æˆæ§åˆ¶èŠ‚ç‚¹ip<br>10.13.15.62                          #è¿™ä¸ªéœ€è¦ä¿®æ”¹æˆæ§åˆ¶èŠ‚ç‚¹ip<br>10.13.15.63                          #è¿™ä¸ªéœ€è¦ä¿®æ”¹æˆæ§åˆ¶èŠ‚ç‚¹ip<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">work node(s), <span class="hljs-built_in">set</span> unique <span class="hljs-string">&#x27;k8s_nodename&#x27;</span> <span class="hljs-keyword">for</span> each node</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">CAUTION: <span class="hljs-string">&#x27;k8s_nodename&#x27;</span> must consist of lower <span class="hljs-keyword">case</span> alphanumeric characters, <span class="hljs-string">&#x27;-&#x27;</span> or <span class="hljs-string">&#x27;.&#x27;</span>,</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">and must start and end with an alphanumeric character</span><br>[kube_node]<br>10.13.15.64                          #è¿™ä¸ªéœ€è¦ä¿®æ”¹æˆå·¥ä½œèŠ‚ç‚¹ip<br>10.13.15.65                          #è¿™ä¸ªéœ€è¦ä¿®æ”¹æˆå·¥ä½œèŠ‚ç‚¹ip<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">[optional] harbor server, a private docker registry</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-string">&#x27;NEW_INSTALL&#x27;</span>: <span class="hljs-string">&#x27;true&#x27;</span> to install a harbor server; <span class="hljs-string">&#x27;false&#x27;</span> to integrate with existed one</span><br>[harbor]<br>10.13.15.61 NEW_INSTALL=true        #éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šæ­å»ºharboræœåŠ¡ï¼Œå°±é…ç½®æˆæ­¤æœåŠ¡å™¨çš„ip <br><span class="hljs-meta prompt_">#</span><span class="language-bash">192.168.1.8 NEW_INSTALL=<span class="hljs-literal">false</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">[optional] loadbalance <span class="hljs-keyword">for</span> accessing k8s from outside</span><br>[ex_lb]<br><span class="hljs-meta prompt_">#</span><span class="language-bash">10.13.15.70æ˜¯3ä¸ªæ§åˆ¶èŠ‚ç‚¹ç»„æˆkeepalivedä¸l4lbé›†ç¾¤åçš„è™šæ‹Ÿip</span><br>10.13.15.63 LB_ROLE=backup EX_APISERVER_VIP=10.13.15.70 EX_APISERVER_PORT=8443   <br>10.13.15.62 LB_ROLE=backup EX_APISERVER_VIP=10.13.15.70 EX_APISERVER_PORT=8443<br>10.13.15.61 LB_ROLE=master EX_APISERVER_VIP=10.13.15.70 EX_APISERVER_PORT=8443<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">[optional] ntp server <span class="hljs-keyword">for</span> the cluster</span><br>[chrony]<br><span class="hljs-meta prompt_">#</span><span class="language-bash">192.168.1.1</span><br><br>[all:vars]<br><span class="hljs-meta prompt_"># </span><span class="language-bash">--------- Main Variables ---------------</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Secure port <span class="hljs-keyword">for</span> apiservers</span><br>SECURE_PORT=&quot;6443&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Cluster container-runtime supported: docker, containerd</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-keyword">if</span> k8s version &gt;= 1.24, docker is not supported</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">CONTAINER_RUNTIME=<span class="hljs-string">&quot;containerd&quot;</span></span><br>CONTAINER_RUNTIME=&quot;docker&quot;   #è¿™ä¸ªéœ€è¦ä¿®æ”¹<br>...<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@k8s03-1:/opt/kubeasz-deployk8s# vi /etc/kubeasz/clusters/k8s03/config.yml <br><span class="hljs-meta prompt_"># </span><span class="language-bash">k8s version</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">K8S_VER: <span class="hljs-string">&quot;1.23.1&quot;</span></span><br>K8S_VER: &quot;1.23.17&quot;  #ä¿®æ”¹<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">###########################</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">role:etcd</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">###########################</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è®¾ç½®ä¸åŒçš„walç›®å½•ï¼Œå¯ä»¥é¿å…ç£ç›˜ioç«äº‰ï¼Œæé«˜æ€§èƒ½</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ETCD_DATA_DIR: <span class="hljs-string">&quot;/var/lib/etcd&quot;</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ETCD_WAL_DIR: <span class="hljs-string">&quot;&quot;</span></span><br>ETCD_DATA_DIR: &quot;/var/lib/etcd/data&quot;  #ä¿®æ”¹<br>ETCD_WAL_DIR: &quot;/var/lib/etcd/wal&quot;    #ä¿®æ”¹<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">###########################</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">role:runtime [containerd,docker]</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">###########################</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">[containerd]..................</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">SANDBOX_IMAGE: <span class="hljs-string">&quot;easzlab/pause:3.6&quot;</span></span><br>SANDBOX_IMAGE: &quot;easzlab.io.local/easzlab/pause:3.6&quot;  #å¦‚æœåˆ›å»ºäº†docker registryå°±ä¿®æ”¹æˆæ­¤è¡Œé…ç½®ï¼Œå¦åˆ™ä¿æŒé»˜è®¤<br><span class="hljs-meta prompt_"># </span><span class="language-bash">[docker].........HTTP......</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">INSECURE_REG: <span class="hljs-string">&#x27;[&quot;127.0.0.1/8&quot;]&#x27;</span></span><br>INSECURE_REG: &#x27;[&quot;easzlab.io.local&quot;]&#x27;  #å¦‚æœåˆ›å»ºäº†docker registryå°±ä¿®æ”¹æˆæ­¤è¡Œé…ç½®ï¼Œå¦åˆ™ä¿æŒé»˜è®¤<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">nfs-provisioner ............</span><br>nfs_provisioner_install: &quot;yes&quot;  #ä¿®æ”¹ä¸ºyesï¼Œå¯ä»¥è‡ªåŠ¨å®‰è£…nfsç±»å‹çš„scï¼ˆå‰ææ˜¯å…ˆæœ‰ä¸€ä¸ªå¯ç”¨çš„nfsæœåŠ¡ç«¯ï¼‰<br>nfs_provisioner_namespace: &quot;kube-system&quot;<br>nfs_provisioner_ver: &quot;v4.0.2&quot;<br>nfs_storage_class: &quot;managed-nfs-storage&quot;<br>nfs_server: &quot;10.13.15.61&quot;  #ä¿®æ”¹ï¼ˆä¿®æ”¹æˆnfsæœåŠ¡ç«¯çš„ipï¼‰<br>nfs_path: &quot;/nfs&quot;           #ä¿®æ”¹ï¼ˆä¿®æ”¹æˆnfsæœåŠ¡ç«¯çš„å…±äº«ç›®å½•ï¼‰<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">###########################</span></span>   <br><span class="hljs-meta prompt_"># </span><span class="language-bash">role:harbor</span>    <br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">###########################</span></span>       <br><span class="hljs-meta prompt_"># </span><span class="language-bash">harbor version..................</span><br>HARBOR_VER: &quot;v2.1.3&quot;<br>HARBOR_DOMAIN: &quot;harbor.yourdomain.com&quot;<br>HARBOR_TLS_PORT: 8444                #8443æ”¹æˆ8444<br></code></pre></td></tr></table></figure><h4 id="2-2-4-3-å¼€å§‹å®‰è£…"><a href="#2-2-4-3-å¼€å§‹å®‰è£…" class="headerlink" title="2.2.4.3 å¼€å§‹å®‰è£…"></a>2.2.4.3 å¼€å§‹å®‰è£…</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä»¥ä¸‹æ“ä½œæ˜¯åœ¨k8sèŠ‚ç‚¹æ“ä½œç³»ç»Ÿä¸Šï¼Œä¸æ˜¯åœ¨å®¹å™¨å†…ã€‚ä¹Ÿå¯ä»¥è¿›å®¹å™¨kubeaszç›´æ¥æ“ä½œ</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å»ºè®®ä½¿ç”¨<span class="hljs-built_in">alias</span>å‘½ä»¤ï¼ŒæŸ¥çœ‹~/.bashrc æ–‡ä»¶åº”è¯¥åŒ…å«ï¼š<span class="hljs-built_in">alias</span> dk=<span class="hljs-string">&#x27;docker exec -it kubeasz&#x27;</span></span><br>source ~/.bashrc<br></code></pre></td></tr></table></figure><h5 id="2-2-4-3-0-å®‰è£…é…ç½®docker-registry"><a href="#2-2-4-3-0-å®‰è£…é…ç½®docker-registry" class="headerlink" title="2.2.4.3.0 å®‰è£…é…ç½®docker registry"></a>2.2.4.3.0 å®‰è£…é…ç½®docker registry</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@k8s03-1:/opt/kubeasz-deployk8s# openssl req  -addext &quot;subjectAltName = DNS:easzlab.io.local&quot; \<br>  -newkey rsa:4096 -nodes -sha256 -keyout certs/domain.key \<br>  -x509 -days 36500 -out certs/domain.crt<br><br>root@k8s03-1:/opt/kubeasz-deployk8s# docker run -d \<br> --restart=always \<br> --name local_registry \<br> -v &quot;$(pwd)&quot;/certs:/certs \<br> -v /mnt/registry:/var/lib/registry \<br> -e REGISTRY_HTTP_ADDR=0.0.0.0:443 \<br> -e REGISTRY_HTTP_TLS_CERTIFICATE=/certs/domain.crt \<br> -e REGISTRY_HTTP_TLS_KEY=/certs/domain.key \<br> -p 443:443 \<br> registry:2<br><br>root@k8s03-1:/opt/kubeasz-deployk8s# mkdir -p  /etc/docker/certs.d/easzlab.io.local<br>root@k8s03-1:/opt/kubeasz-deployk8s# cp certs/domain.crt  /etc/docker/certs.d/easzlab.io.local/ca.crt<br><br>root@k8s03-1:/opt/kubeasz-deployk8s# docker tag registry:2 easzlab.io.local/registry:2<br>root@k8s03-1:/opt/kubeasz-deployk8s# docker push easzlab.io.local/registry:2<br>root@k8s03-1:/opt/kubeasz-deployk8s# docker pull easzlab.io.local/registry:2<br><br>docker tag registry:2 easzlab.io.local/library/registry:2<br>docker push easzlab.io.local/library/registry:2<br>docker pull easzlab.io.local/library/registry:2<br></code></pre></td></tr></table></figure><h5 id="2-2-4-3-1-é…ç½®sshå…å¯†ç™»å½•"><a href="#2-2-4-3-1-é…ç½®sshå…å¯†ç™»å½•" class="headerlink" title="2.2.4.3.1 é…ç½®sshå…å¯†ç™»å½•"></a>2.2.4.3.1 é…ç½®sshå…å¯†ç™»å½•</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@k8s03-1:~# cat /etc/hosts<br>...<br>10.13.15.61    k8s03-1<br>10.13.15.62    k8s03-2<br>10.13.15.63    k8s03-3<br>10.13.15.64    k8s03-4<br>10.13.15.65    k8s03-5<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-variable">$IP</span>ä¸ºæ‰€æœ‰èŠ‚ç‚¹åœ°å€åŒ…æ‹¬è‡ªèº«ï¼ŒæŒ‰ç…§æç¤ºè¾“å…¥<span class="hljs-built_in">yes</span> å’Œrootå¯†ç </span><br>root@k8s03-1:~# ssh-keygen -P &quot;&quot;<br>root@k8s03-1:~# ssh-copy-id root@$IP<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä¸ºæ¯ä¸ªèŠ‚ç‚¹è®¾ç½®pythonè½¯é“¾æ¥</span><br>for i in &#123;61..65&#125;; do<br>  ssh root@10.13.15.$&#123;i&#125; &#x27;if [ ! -L /usr/bin/python ];then ln -s /usr/bin/python3 /usr/bin/python; fi&#x27;;<br>done<br></code></pre></td></tr></table></figure><h5 id="2-2-4-3-2-æ­å»ºnfsæœåŠ¡å™¨"><a href="#2-2-4-3-2-æ­å»ºnfsæœåŠ¡å™¨" class="headerlink" title="2.2.4.3.2 æ­å»ºnfsæœåŠ¡å™¨"></a>2.2.4.3.2 æ­å»ºnfsæœåŠ¡å™¨</h5><p>æœ¬æ–‡ä»¥åœ¨k8s03-1èŠ‚ç‚¹ä¸Šæ­å»ºnfsæœåŠ¡ç«¯ä¸ºä¾‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##nfsæœåŠ¡ç«¯</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£… NFS æœåŠ¡ï¼Œ</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">apt ä¼šè‡ªåŠ¨å®‰è£… nfs-commonã€rpcbind ç­‰è½¯ä»¶åŒ…</span><br>root@k8s03-1:~# apt install nfs-kernel-server -y<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»ºä½œä¸ºnfsæœåŠ¡ç«¯çš„æ ¹ç›®å½•</span><br>root@k8s03-1:~# mkdir /nfs<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç¼–å†™é…ç½®æ–‡ä»¶</span><br>root@k8s03-1:~# vim /etc/exports<br><span class="hljs-meta prompt_">#</span><span class="language-bash">[ä»»æ„ä¸»æœºæ‰€æœ‰æƒé™]</span><br>root@k8s03-1:~# /nfs   *(rw,sync,insecure,no_subtree_check,no_root_squash)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é‡å¯ NFS æœåŠ¡</span><br>root@k8s03-1:~# systemctl restart nfs-kernel-server<br>root@k8s03-1:~# systemctl enable nfs-kernel-server &amp;&amp; systemctl status nfs-kernel-server <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¸¸ç”¨å‘½ä»¤å·¥å…·</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨å®‰è£… NFS æœåŠ¡å™¨æ—¶ï¼Œå·²åŒ…å«å¸¸ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ— éœ€é¢å¤–å®‰è£…</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ˜¾ç¤ºå·²ç» mount åˆ°æœ¬æœº NFS ç›®å½•çš„å®¢æˆ·ç«¯æœºå™¨</span><br>sudo showmount -e localhost<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†é…ç½®æ–‡ä»¶ä¸­çš„ç›®å½•å…¨éƒ¨é‡æ–° <span class="hljs-built_in">export</span> ä¸€æ¬¡ï¼Œæ— éœ€é‡å¯æœåŠ¡</span><br>sudo exportfs -rv<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹ NFS çš„è¿è¡ŒçŠ¶æ€</span><br>sudo nfsstat<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹ rpc æ‰§è¡Œä¿¡æ¯ï¼Œå¯ä»¥ç”¨äºæ£€æµ‹ rpc è¿è¡Œæƒ…å†µ</span><br>sudo rpcinfo<br></code></pre></td></tr></table></figure><h5 id="2-2-4-3-3-ä¸€é”®éƒ¨ç½²ä¸åˆ†æ­¥éƒ¨ç½²"><a href="#2-2-4-3-3-ä¸€é”®éƒ¨ç½²ä¸åˆ†æ­¥éƒ¨ç½²" class="headerlink" title="2.2.4.3.3 ä¸€é”®éƒ¨ç½²ä¸åˆ†æ­¥éƒ¨ç½²"></a>2.2.4.3.3 ä¸€é”®éƒ¨ç½²ä¸åˆ†æ­¥éƒ¨ç½²</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨k8sèŠ‚ç‚¹ä¸Šæ“ä½œï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è¿›å®¹å™¨kubeaszå†…æ“ä½œ</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å»ºè®®ä½¿ç”¨<span class="hljs-built_in">alias</span>å‘½ä»¤ï¼ŒæŸ¥çœ‹~/.bashrc æ–‡ä»¶åº”è¯¥åŒ…å«ï¼š<span class="hljs-built_in">alias</span> dk=<span class="hljs-string">&#x27;docker exec -it kubeasz&#x27;</span></span><br>root@k8s03-1:~# source ~/.bashrc<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä¸€é”®å®‰è£…ï¼Œç­‰ä»·äºæ‰§è¡Œdocker <span class="hljs-built_in">exec</span> -it kubeasz ezctl setup k8s03 all</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯¹äºä¸ç†Ÿæ‚‰çš„æ“ä½œè€…è€Œè¨€ï¼Œå»ºè®®åˆ†æ­¥æ‰§è¡Œï¼Œæ‰§è¡Œå®Œä¸€ä¸ªæ­¥éª¤åæŸ¥çœ‹æ­¤æ­¥éª¤çš„ç»“æœä»¥ç†Ÿæ‚‰æ•´ä¸ªéƒ¨ç½²æµç¨‹</span><br>root@k8s03-1:~# dk ezctl setup k8s03 all<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æˆ–è€…åˆ†æ­¥å®‰è£…ï¼Œå…·ä½“ä½¿ç”¨ dk ezctl <span class="hljs-built_in">help</span> setup æŸ¥çœ‹åˆ†æ­¥å®‰è£…å¸®åŠ©ä¿¡æ¯</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">dk ezctl setup k8s03 01</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">dk ezctl setup k8s03 02</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">dk ezctl setup k8s03 03</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">dk ezctl setup k8s03 04</span><br>...<br></code></pre></td></tr></table></figure><h5 id="2-2-4-3-4-01-åˆ›å»ºè¯ä¹¦å’Œå®‰è£…å‡†å¤‡"><a href="#2-2-4-3-4-01-åˆ›å»ºè¯ä¹¦å’Œå®‰è£…å‡†å¤‡" class="headerlink" title="2.2.4.3.4 01-åˆ›å»ºè¯ä¹¦å’Œå®‰è£…å‡†å¤‡"></a>2.2.4.3.4 01-åˆ›å»ºè¯ä¹¦å’Œå®‰è£…å‡†å¤‡</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å®¹å™¨å†…æ“ä½œ</span><br>k8s03-1:/# ezctl setup k8s03 01<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨k8sèŠ‚ç‚¹ä¸Šæ“ä½œ</span><br>root@k8s03-1:~# source ~/.bashrc<br>root@k8s03-1:~# dk ezctl setup k8s03 01<br></code></pre></td></tr></table></figure><h5 id="2-2-4-3-5-02-å®‰è£…etcdé›†ç¾¤"><a href="#2-2-4-3-5-02-å®‰è£…etcdé›†ç¾¤" class="headerlink" title="2.2.4.3.5 02-å®‰è£…etcdé›†ç¾¤"></a>2.2.4.3.5 02-å®‰è£…etcdé›†ç¾¤</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">k8s03-1:/# ezctl setup k8s03 02<br></code></pre></td></tr></table></figure><h5 id="2-2-4-3-6-03-å®‰è£…å®¹å™¨è¿è¡Œæ—¶"><a href="#2-2-4-3-6-03-å®‰è£…å®¹å™¨è¿è¡Œæ—¶" class="headerlink" title="2.2.4.3.6 03-å®‰è£…å®¹å™¨è¿è¡Œæ—¶"></a>2.2.4.3.6 03-å®‰è£…å®¹å™¨è¿è¡Œæ—¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">k8s03-1:/# ezctl setup k8s03 03<br></code></pre></td></tr></table></figure><h5 id="2-2-4-3-7-04-å®‰è£…masterèŠ‚ç‚¹"><a href="#2-2-4-3-7-04-å®‰è£…masterèŠ‚ç‚¹" class="headerlink" title="2.2.4.3.7 04-å®‰è£…masterèŠ‚ç‚¹"></a>2.2.4.3.7 04-å®‰è£…masterèŠ‚ç‚¹</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">k8s03-1:/# ezctl setup k8s03 04<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸Šè¿°å®‰è£…masterèŠ‚ç‚¹ç›¸å…³å‘½ä»¤æ‰§è¡ŒæˆåŠŸåï¼Œå¯ä»¥æŸ¥çœ‹é›†ç¾¤ä¸­çš„masterèŠ‚ç‚¹ï¼Œå¦‚ä¸‹</span><br>k8s03-1:/etc/kubeasz/clusters/k8s03# kubectl get nodes<br>NAME      STATUS                     ROLES    AGE   VERSION<br>10.13.15.61   Ready,SchedulingDisabled   master   57s   v1.23.17<br>10.13.15.62   Ready,SchedulingDisabled   master   57s   v1.23.17<br>10.13.15.63   Ready,SchedulingDisabled   master   57s   v1.23.17<br></code></pre></td></tr></table></figure><h5 id="2-2-4-3-8-05-å®‰è£…nodeèŠ‚ç‚¹"><a href="#2-2-4-3-8-05-å®‰è£…nodeèŠ‚ç‚¹" class="headerlink" title="2.2.4.3.8 05-å®‰è£…nodeèŠ‚ç‚¹"></a>2.2.4.3.8 05-å®‰è£…nodeèŠ‚ç‚¹</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">k8s03-1:/# ezctl setup k8s03 05<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸Šè¿°å®‰è£…nodeèŠ‚ç‚¹ç›¸å…³å‘½ä»¤æ‰§è¡ŒæˆåŠŸåï¼Œå¯ä»¥æŸ¥çœ‹é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œå¦‚ä¸‹</span><br>k8s03-1:/etc/kubeasz/clusters/k8s03# kubectl get nodes   <br>NAME          STATUS                     ROLES    AGE     VERSION<br>10.13.15.61   Ready,SchedulingDisabled   master   4m59s   v1.23.17<br>10.13.15.62   Ready,SchedulingDisabled   master   4m59s   v1.23.17<br>10.13.15.63   Ready,SchedulingDisabled   master   4m59s   v1.23.17<br>10.13.15.64   Ready                      node     22s     v1.23.17<br>10.13.15.65   Ready                      node     22s     v1.23.17<br></code></pre></td></tr></table></figure><h5 id="2-2-4-3-906-å®‰è£…é›†ç¾¤ç½‘ç»œ"><a href="#2-2-4-3-906-å®‰è£…é›†ç¾¤ç½‘ç»œ" class="headerlink" title="2.2.4.3.906-å®‰è£…é›†ç¾¤ç½‘ç»œ"></a>2.2.4.3.906-å®‰è£…é›†ç¾¤ç½‘ç»œ</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">k8s03-1:/# ezctl setup k8s03 06<br></code></pre></td></tr></table></figure><h5 id="2-2-4-3-10-07-å®‰è£…é›†ç¾¤æ’ä»¶"><a href="#2-2-4-3-10-07-å®‰è£…é›†ç¾¤æ’ä»¶" class="headerlink" title="2.2.4.3.10 07-å®‰è£…é›†ç¾¤æ’ä»¶"></a>2.2.4.3.10 07-å®‰è£…é›†ç¾¤æ’ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">k8s03-1:/# ezctl setup k8s03 07<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹åˆ›å»ºçš„sc</span><br>root@k8s03-1:/# kubectl get sc<br>NAME                  PROVISIONER                                   RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE<br>managed-nfs-storage   k8s-sigs.io/nfs-subdir-external-provisioner   Delete          Immediate              false                  7m47s<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†sc/managed-nfs-storage è®¾ç½®ä¸ºé»˜è®¤çš„sc</span><br>root@k8s03-1:/# kubectl patch storageclass managed-nfs-storage -p &#x27;&#123;&quot;metadata&quot;: &#123;&quot;annotations&quot;:&#123;&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;&#125;&#125;&#125;&#x27;<br>root@k8s03-1:/# kubectl get sc<br>NAME                            PROVISIONER                                   RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE<br>managed-nfs-storage (default)   k8s-sigs.io/nfs-subdir-external-provisioner   Delete          Immediate              false                  9m13s<br></code></pre></td></tr></table></figure><h5 id="2-2-4-3-11-10-ex-lb"><a href="#2-2-4-3-11-10-ex-lb" class="headerlink" title="2.2.4.3.11 10-ex-lb"></a>2.2.4.3.11 10-ex-lb</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">k8s03-1:/# ezctl setup k8s03 10<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">3ä¸ªæ§åˆ¶èŠ‚ç‚¹ä¸Šç°åœ¨åº”è¯¥éƒ½æ­£å¸¸è¿è¡Œäº†ä»¥ä¸‹ä¸¤ä¸ªæœåŠ¡</span><br>root@k8s03-1:~# systemctl status l4lb.service <br>root@k8s03-1:~# systemctl status keepalived.service <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼Œk8s03-1 æ˜¯keepalived é›†ç¾¤çš„ä¸»èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ­¤æ—¶VIP 10.13.15.70 åº”è¯¥æ˜¯åœ¨k8s03-1ä¸Š</span><br>root@k8s03-1:~# ip a<br>...<br>2: ens3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000<br>    link/ether fa:16:3e:65:87:be brd ff:ff:ff:ff:ff:ff<br>    inet 10.13.15.61/24 brd 10.13.15.255 scope global dynamic ens3<br>       valid_lft 72162sec preferred_lft 72162sec<br>    inet 10.13.15.70/32 scope global ens3<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::f816:3eff:fe65:87be/64 scope link <br>       valid_lft forever preferred_lft forever<br>...<br></code></pre></td></tr></table></figure><h6 id="2-2-4-3-11-1-è´Ÿè½½å‡è¡¡ç›¸å…³è®¾ç½®"><a href="#2-2-4-3-11-1-è´Ÿè½½å‡è¡¡ç›¸å…³è®¾ç½®" class="headerlink" title="2.2.4.3.11.1 è´Ÿè½½å‡è¡¡ç›¸å…³è®¾ç½®"></a>2.2.4.3.11.1 è´Ÿè½½å‡è¡¡ç›¸å…³è®¾ç½®</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#ä»¥ä¸‹æ˜¯OpenStackè™šæ‹Ÿæœºç‰¹å®šæ“ä½œï¼Œåœ¨openstack æ§åˆ¶èŠ‚ç‚¹ä¸Šæ‰§è¡Œ</span></span><br>root@controller01:~# docker exec -it kolla-ansible bash<br>root@controller01:~# source /root/admin-openrc.sh <br>root@controller01:~# openstack port list | egrep &quot;10.13.15.61|10.13.15.62|10.13.15.63&quot;<br>| 10194efa-abee-4f04-9638-dd7e554d0be9 | 10.13.15.61  | fa:16:3e:65:87:be | ip_address=&#x27;10.13.15.61&#x27;, subnet_id=&#x27;596d5b92-6db8-480c-a8b3-e672cc39b531&#x27;   | ACTIVE |<br>| 23ef271f-40ee-489c-a219-3f8ca6fab8e1 | 10.13.15.63  | fa:16:3e:87:3a:47 | ip_address=&#x27;10.13.15.63&#x27;, subnet_id=&#x27;596d5b92-6db8-480c-a8b3-e672cc39b531&#x27;   | ACTIVE |<br>| ec016664-03d5-45a2-94b2-c2306c3c0136 | 10.13.15.62  | fa:16:3e:97:af:b4 | ip_address=&#x27;10.13.15.62&#x27;, subnet_id=&#x27;596d5b92-6db8-480c-a8b3-e672cc39b531&#x27;   | ACTIVE |<br><br>root@controller01:~# openstack port set --allowed-address ip-address=10.13.15.70 10194efa-abee-4f04-9638-dd7e554d0be9<br>root@controller01:~# openstack port set --allowed-address ip-address=10.13.15.70 23ef271f-40ee-489c-a219-3f8ca6fab8e1<br>root@controller01:~# openstack port set --allowed-address ip-address=10.13.15.70 ec016664-03d5-45a2-94b2-c2306c3c0136<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å›åˆ°k8sèŠ‚ç‚¹ä¸Šæ“ä½œ</span><br>root@k8s03-1:/var/data/harbor# kubectl -n kube-system get svc<br>NAME                        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                  AGE<br>dashboard-metrics-scraper   ClusterIP   10.68.38.156    &lt;none&gt;        8000/TCP                 49m<br>kube-dns                    ClusterIP   10.68.0.2       &lt;none&gt;        53/UDP,53/TCP,9153/TCP   50m<br>kube-dns-upstream           ClusterIP   10.68.209.167   &lt;none&gt;        53/UDP,53/TCP            50m<br>kubernetes-dashboard        NodePort    10.68.173.217   &lt;none&gt;        443:32268/TCP            49m<br>metrics-server              ClusterIP   10.68.168.180   &lt;none&gt;        443/TCP                  50m<br>node-local-dns              ClusterIP   None            &lt;none&gt;        9253/TCP                 50m<br><span class="hljs-meta prompt_">#</span><span class="language-bash">NodePortç±»å‹çš„ service/kubernetes-dashboard åœ¨k8sèŠ‚ç‚¹ä¸Šæ˜ å°„çš„ç«¯å£æ˜¯ 32268</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä»¥ä¸‹ä½¿ç”¨vip + 32268 å³ https://10.13.15.70:32268 æ¥è®¿é—®kuboardï¼ˆå»ºè®®ä½¿ç”¨ firefox æµè§ˆå™¨è®¿é—®ï¼‰</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦å¤–ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨k8sé›†ç¾¤ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹çš„IP+32268ï¼Œä»¥è®¿é—®kubernetesåŸç”Ÿdashboardå³kuboardï¼ˆå»ºè®®ä½¿ç”¨ firefox æµè§ˆå™¨è®¿é—®ï¼‰</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/10/31/IMNoUuGV98bCBir.png" alt="image-20241031173526066"></p><h4 id="2-2-4-4-æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ä¸çŠ¶æ€"><a href="#2-2-4-4-æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ä¸çŠ¶æ€" class="headerlink" title="2.2.4.4 æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ä¸çŠ¶æ€"></a>2.2.4.4 æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ä¸çŠ¶æ€</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹k8sèŠ‚ç‚¹åˆ—è¡¨</span><br>root@k8s03-1:/var/data/harbor# kubectl get nodes<br>NAME      STATUS                     ROLES    AGE   VERSION<br>k8s03-1   Ready,SchedulingDisabled   master   32m   v1.23.17<br>k8s03-2   Ready,SchedulingDisabled   master   32m   v1.23.17<br>k8s03-3   Ready,SchedulingDisabled   master   32m   v1.23.17<br>k8s03-4   Ready                      node     16m   v1.23.17<br>k8s03-5   Ready                      node     16m   v1.23.17<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹é›†ç¾¤ä¸­podåˆ—è¡¨</span><br>root@k8s03-1:/var/data/harbor# kubectl get pods -A<br>NAMESPACE     NAME                                         READY   STATUS    RESTARTS   AGE<br>kube-system   calico-kube-controllers-754966f84c-mmsdm     1/1     Running   0          15m<br>kube-system   calico-node-5dgf7                            1/1     Running   0          15m<br>kube-system   calico-node-c2gn5                            1/1     Running   0          15m<br>kube-system   calico-node-j5xbk                            1/1     Running   0          15m<br>kube-system   calico-node-rfdbh                            1/1     Running   0          15m<br>kube-system   calico-node-s9r9k                            1/1     Running   0          15m<br>kube-system   coredns-596755dbff-d6ds5                     1/1     Running   0          4m36s<br>kube-system   dashboard-metrics-scraper-799d786dbf-rc4kn   1/1     Running   0          3m56s<br>kube-system   kubernetes-dashboard-9f8c8b989-448zj         1/1     Running   0          3m56s<br>kube-system   metrics-server-5d648558d9-npj5m              1/1     Running   0          4m25s<br>kube-system   nfs-client-provisioner-f97c77ddd-ltrdv       1/1     Running   0          4m25s<br>kube-system   node-local-dns-5zxbn                         1/1     Running   0          4m34s<br>kube-system   node-local-dns-jt7hh                         1/1     Running   0          4m34s<br>kube-system   node-local-dns-p52ck                         1/1     Running   0          4m34s<br>kube-system   node-local-dns-vk2sc                         1/1     Running   0          4m34s<br>kube-system   node-local-dns-vr87v                         1/1     Running   0          4m34s<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹component status</span><br>root@k8s03-1:/var/data/harbor# kubectl get cs<br>Warning: v1 ComponentStatus is deprecated in v1.19+<br>NAME                 STATUS    MESSAGE                         ERROR<br>controller-manager   Healthy   ok                              <br>scheduler            Healthy   ok                              <br>etcd-0               Healthy   &#123;&quot;health&quot;:&quot;true&quot;,&quot;reason&quot;:&quot;&quot;&#125;   <br>etcd-2               Healthy   &#123;&quot;health&quot;:&quot;true&quot;,&quot;reason&quot;:&quot;&quot;&#125;   <br>etcd-1               Healthy   &#123;&quot;health&quot;:&quot;true&quot;,&quot;reason&quot;:&quot;&quot;&#125; <br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹namespace/kube-systemä¸‹çš„svc</span><br>root@k8s03-1:/var/data/harbor# kubectl -n kube-system get svc<br>NAME                        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                  AGE<br>dashboard-metrics-scraper   ClusterIP   10.68.38.156    &lt;none&gt;        8000/TCP                 49m<br>kube-dns                    ClusterIP   10.68.0.2       &lt;none&gt;        53/UDP,53/TCP,9153/TCP   50m<br>kube-dns-upstream           ClusterIP   10.68.209.167   &lt;none&gt;        53/UDP,53/TCP            50m<br>kubernetes-dashboard        NodePort    10.68.173.217   &lt;none&gt;        443:32268/TCP            49m<br>metrics-server              ClusterIP   10.68.168.180   &lt;none&gt;        443/TCP                  50m<br>node-local-dns              ClusterIP   None            &lt;none&gt;        9253/TCP                 50m<br></code></pre></td></tr></table></figure><h4 id="2-2-4-5-ç™»å½•kubernetes-dashboard"><a href="#2-2-4-5-ç™»å½•kubernetes-dashboard" class="headerlink" title="2.2.4.5 ç™»å½•kubernetes-dashboard"></a>2.2.4.5 ç™»å½•kubernetes-dashboard</h4><p><img src="https://s2.loli.net/2025/01/10/9mbfwSHUe7C5ozy.png" alt="image-20250110145004619"></p><p>é€‰æ‹©Kubeconfigæ—¶ï¼Œå¦‚æœæç¤ºâ€œInternal error (500): Not enough data to create auth info structure.â€ï¼Œè¯·å‚ç…§å¦‚ä¸‹æ–¹å¼å¤„ç†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»ºå¦‚ä¸‹3ä¸ªæ–‡ä»¶ï¼Œç„¶ååˆ†åˆ«applyæˆ–bashæ‰§è¡Œ</span><br>root@k8s03-1:/opt/kubeasz-deployk8s# cat 01-ServiceAccount-admin-user.yaml <br>apiVersion: v1<br>kind: ServiceAccount<br>metadata:<br>  name: admin-user<br>  namespace: kubernetes-dashboard<br><br>root@k8s03-1:/opt/kubeasz-deployk8s# cat 02-ClusterRoleBinding-admin-user.yaml <br>apiVersion: rbac.authorization.k8s.io/v1<br>kind: ClusterRoleBinding<br>metadata:<br>  name: admin-user<br>roleRef:<br>  apiGroup: rbac.authorization.k8s.io<br>  kind: ClusterRole<br>  name: cluster-admin<br>subjects:<br>- kind: ServiceAccount<br>  name: admin-user<br>  namespace: kubernetes-dashboard<br><br>root@k8s03-1:/opt/kubeasz-deployk8s# kubectl apply -f 01-ServiceAccount-admin-user.yaml <br>root@k8s03-1:/opt/kubeasz-deployk8s# kubectl apply -f 02-ClusterRoleBinding-admin-user.yaml <br>root@k8s03-1:/opt/kubeasz-deployk8s# cat 03-Getting-a-Bearer-Token-for-ServiceAccount.sh <br><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br>kubectl -n kubernetes-dashboard get secret $(kubectl -n kubernetes-dashboard get sa/admin-user -o jsonpath=&quot;&#123;.secrets[0].name&#125;&quot;) -o go-template=&quot;&#123;&#123;.data.token | base64decode&#125;&#125;&quot;<br><br>root@k8s03-1:/opt/kubeasz-deployk8s# bash 03-Getting-a-Bearer-Token-for-ServiceAccount.sh <br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸Šè¿°è„šæœ¬æ–‡ä»¶æ‰§è¡Œæ—¶è¾“å‡ºå¦‚ä¸‹å†…å®¹</span><br>eyJhbGciOiJSUzI1NiIsImtpZCI6IkJyV2xQLWZ5REZ6cUtOb1VBVzB0ZVZCUzBoVElWcWNyVVhtM1lhZnpGVjgifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyLXRva2VuLWRnYmJsIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiI2N2ViMWIzZi0wYjU0LTQ5M2ItOWQ4Mi00MWU0OGMxNzRmMDQiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZXJuZXRlcy1kYXNoYm9hcmQ6YWRtaW4tdXNlciJ9.ieO-n3yTYnz7Z0PkGLvaoNq_0VxO9ENWh5gJXK6qzf3h7ifUC4kbSbr5M7ksF7A3Z6pGl9w7ZLnGuXF7Hguva7NmF_-3gXKQYRstDePrZNo0pBZFO13SZmCOKiLIMNyJFYv93WYJYwLeXhfRf61bi1BNxMapGC62oVyyjQ0UTpbqIzVbWElkhKPzwYl_shp_nyCXwDO0KVZsq8z0Tln-Xne7CwQGjDcoZBtqFfaRalTolS7iUwKBkXqp98luShk-Tecik11ICacCQLpYRMgi-3NE-WR4bnbAe2PKwYkYMv0TlfNL1MSA4-9zhQD9gHOik-eWfscPG_a6s7tknRaaWQ<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†ä¸Šè¿°è¾“å‡ºå†…å®¹å¤åˆ¶ï¼ŒæŒ‰å¦‚ä¸‹å½¢å¼ç²˜è´´åˆ°/root/.kube/configæ–‡ä»¶ä¸­</span><br>apiVersion: v1<br>clusters:<br>- cluster:<br>    server: https://XXXX<br>  name: kubernetes<br>contexts:<br>- context:<br>    cluster: kubernetes<br>    user: YOUR UER<br>  name: kubernetes<br>current-context: &quot;kubernetes&quot;<br>kind: Config<br>preferences: &#123;&#125;<br>users:<br>- name: YOUR USER<br>  user:<br>    client-certificate-data: CODED<br>    client-key-data: CODED<br>    token: CODED  #ç²˜è´´åˆ°è¿™é‡Œï¼Œæ›¿æ¢æ­¤å¤„çš„CODED<br><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸Šè¿°&#x2F;root&#x2F;.kube&#x2F;config æ–‡ä»¶å³å¯ç™»å½•kubernetes-dashboard ã€‚</p><h3 id="2-2-5-å®‰è£…harbor"><a href="#2-2-5-å®‰è£…harbor" class="headerlink" title="2.2.5 å®‰è£…harbor"></a>2.2.5 å®‰è£…harbor</h3><h4 id="2-2-5-1-ä½¿ç”¨é»˜è®¤é…ç½®å®‰è£…Harbor"><a href="#2-2-5-1-ä½¿ç”¨é»˜è®¤é…ç½®å®‰è£…Harbor" class="headerlink" title="2.2.5.1 ä½¿ç”¨é»˜è®¤é…ç½®å®‰è£…Harbor"></a>2.2.5.1 ä½¿ç”¨é»˜è®¤é…ç½®å®‰è£…Harbor</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœæ˜¯å½»åº•é‡æ–°å®‰è£…harborï¼Œè¦å…ˆåˆ é™¤harboræœåŠ¡å™¨ä¸Š /var/data/database /var/data/registry /var/data/redis /var/data/job_logs /var/data/harbor è¿™å‡ ä¸ªç›®å½•</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">k8sèŠ‚ç‚¹ä¸Šã€kubeaszå®¹å™¨å¤–æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹harborç›¸å…³å®¹å™¨</span><br>root@k8s03-1:~# rm -rf /var/data/database /var/data/registry /var/data/redis /var/data/job_logs /var/data/harbor<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…harborï¼ˆkubeaszå®¹å™¨å†…æ‰§è¡Œï¼‰</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœæ˜¯å‰é¢å®‰è£…äº†ex-lbï¼Œåˆ™k8s03-1èŠ‚ç‚¹ä¸Šçš„8443ç«¯å£å°†è¢«å ç”¨äº†ã€‚è€Œå®‰è£…harboræ—¶ä¹Ÿå°è¯•å»ä½¿ç”¨8443ç«¯å£ï¼Œæ­¤æ—¶æ­¤æ­¥éª¤å°±ä¼šåœ¨æœ€åé˜¶æ®µå¤±è´¥ï¼Œå³â€œTASK [harbor : å®‰è£… harbor]â€ä»»åŠ¡å¤±è´¥ï¼Œ<span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;non-zero return code&quot;</span>ã€‚</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰€ä»¥ä½¿ç”¨kubeaszå®‰è£…harborä¹‹å‰è¦å…ˆå°† clusters/k8s03/config.yml æ–‡ä»¶ä¸­çš„ HARBOR_TLS_PORT å‚æ•°å€¼ä¿®æ”¹ä¸ºå…¶ä»–å€¼ï¼Œæ¯”å¦‚ä¿®æ”¹ä¸º8444</span><br>k8s03-1:/etc/kubeasz/clusters/k8s03# ezctl setup k8s03 11 æˆ– ezctl setup k8s03 harbor                      <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">k8sèŠ‚ç‚¹ä¸Šã€kubeaszå®¹å™¨å¤–æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹harborç›¸å…³å®¹å™¨</span><br>root@k8s03-1:~# cd /var/data/harbor<br>root@k8s03-1:/var/data/harbor# docker-compose ps<br>chartmuseum         ./docker-entrypoint.sh           Up (healthy)                                                                                 <br>harbor-core         /harbor/entrypoint.sh            Up (healthy)                                                                                 <br>harbor-db           /docker-entrypoint.sh            Up (healthy)                                                                                 <br>harbor-jobservice   /harbor/entrypoint.sh            Up (healthy)                                                                                 <br>harbor-log          /bin/sh -c /usr/local/bin/ ...   Up (healthy)   127.0.0.1:1514-&gt;10514/tcp                                                     <br>harbor-portal       nginx -g daemon off;             Up (healthy)                                                                                 <br>nginx               nginx -g daemon off;             Up (healthy)   0.0.0.0:80-&gt;8080/tcp,:::80-&gt;8080/tcp, 0.0.0.0:8444-&gt;8443/tcp,:::8444-&gt;8443/tcp<br>redis               redis-server /etc/redis.conf     Up (healthy)                                                                                 <br>registry            /home/harbor/entrypoint.sh       Up (healthy)                                                                                 <br>registryctl         /home/harbor/start.sh            Up (healthy)   <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">harborçš„å®‰è£…ç›®å½•é»˜è®¤åœ¨ï¼š/var/dataï¼Œå®ƒç”±â€œ/etc/kubeasz/clusters/k8s03/config.ymlâ€ä¸­çš„ HARBOR_PATH é…ç½®é¡¹å†³å®š</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">harborç³»ç»Ÿadminç”¨æˆ·çš„å¯†ç ï¼Œåœ¨harboréƒ¨ç½²æœåŠ¡å™¨çš„å¦‚ä¸‹æ–‡ä»¶ä¸­æŸ¥çœ‹ï¼š/var/data/harbor/harbor.yml</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">Dgyj08NOYtvhMc7x</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨k8sé›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹ä¸Šï¼Œå¯ä»¥ç™»å½•æ­¤harborä»“åº“ã€‚ç”¨æˆ·ï¼šadminï¼Œå¯†ç å°±æ˜¯åœ¨harboréƒ¨ç½²æœåŠ¡å™¨çš„å¦‚ä¸‹æ–‡ä»¶/var/data/harbor/harbor.ymlä¸­harbor_admin_password é…ç½®å€¼</span><br>root@k8s03-1:/etc/kubeasz# docker login harbor.easzlab.io.local:8444<br>Username: admin<br>Password: <br>WARNING! Your password will be stored unencrypted in /root/.docker/config.json.<br>Configure a credential helper to remove this warning. See<br>https://docs.docker.com/engine/reference/commandline/login/#credentials-store<br><br>Login Succeeded<br></code></pre></td></tr></table></figure><h4 id="2-2-5-2-ä¿®æ”¹HarboræœåŠ¡çš„ç«¯å£"><a href="#2-2-5-2-ä¿®æ”¹HarboræœåŠ¡çš„ç«¯å£" class="headerlink" title="2.2.5.2 ä¿®æ”¹HarboræœåŠ¡çš„ç«¯å£"></a>2.2.5.2 ä¿®æ”¹HarboræœåŠ¡çš„ç«¯å£</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@k8s03-1:~# cd /var/data/harbor<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å…ˆåœæ‰harborç›¸å…³å®¹å™¨</span><br>root@k8s03-1:/var/data/harbor# docker-compose down<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†æ‰€æœ‰ 8444 å­—ç¬¦ä¸²æ›¿æ¢æˆ 8445</span><br>root@k8s03-1:/var/data/harbor# sed -i &quot;s/8444/8445/g&quot; `grep 8444 -rl ./`<br><span class="hljs-meta prompt_">#</span><span class="language-bash">é‡æ–°å¯åŠ¨harborç›¸å…³å®¹å™¨</span><br>root@k8s03-1:/var/data/harbor# docker-compose up -d<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿®æ”¹è¯ä¹¦ç›®å½•</span><br>root@k8s03-1:/var/data/harbor# cd /etc/docker/certs.d/<br>root@k8s03-1:/etc/docker/certs.d# mkdir harbor.yourdomain.com\:8445<br>root@k8s03-1:/etc/docker/certs.d# docker cp kubeasz:/etc/kubeasz/down/ca.pem ./harbor.yourdomain.com:8445/<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç™»å½•</span><br>root@k8s03-1:/etc/docker/certs.d# docker login harbor.yourdomain.com:8445<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å°è¯•æäº¤é•œåƒ...</span><br></code></pre></td></tr></table></figure><h3 id="2-2-6-ç»§ç»­å®‰è£…Kubesphere"><a href="#2-2-6-ç»§ç»­å®‰è£…Kubesphere" class="headerlink" title="2.2.6 ç»§ç»­å®‰è£…Kubesphere"></a>2.2.6 ç»§ç»­å®‰è£…Kubesphere</h3><p>â€‹æœ¬æ–‡å·²ç»ä½¿ç”¨kubeasz3.2.0 å®‰è£…å¥½kubernetes1.23.17ï¼Œç°å‡†å¤‡éƒ¨ç½²kubesphere3.4.1ã€‚</p><p><strong>å‰ææ¡ä»¶</strong></p><blockquote><ul><li>å®‰è£…ä¹‹å‰ï¼ŒKubernetes é›†ç¾¤å·²é…ç½®<strong>é»˜è®¤</strong>å­˜å‚¨ç±»å‹ (StorageClass)ï¼›</li><li>å½“ä½¿ç”¨ <code>--cluster-signing-cert-file</code> å’Œ <code>--cluster-signing-key-file</code> å‚æ•°å¯åŠ¨æ—¶ï¼Œåœ¨ <code>kube-apiserver</code> ä¸­ä¼šæ¿€æ´» CSR ç­¾ååŠŸèƒ½ã€‚è¯·å‚è§ <a href="https://github.com/kubesphere/kubesphere/issues/1925#issuecomment-591698309">RKE å®‰è£…é—®é¢˜</a>ï¼›ï¼ˆæš‚æ—¶æ— éœ€å…³æ³¨ï¼‰</li><li>æœ‰å…³åœ¨ Kubernetes ä¸Šå®‰è£… KubeSphere çš„å‡†å¤‡å·¥ä½œï¼Œè¯·å‚è§<a href="https://kubesphere.io/zh/docs/installing-on-kubernetes/introduction/prerequisites/">å‡†å¤‡å·¥ä½œ</a>ã€‚</li></ul></blockquote><h4 id="2-2-6-1-æ‰‹åŠ¨åˆ›å»ºsc-local"><a href="#2-2-6-1-æ‰‹åŠ¨åˆ›å»ºsc-local" class="headerlink" title="2.2.6.1 æ‰‹åŠ¨åˆ›å»ºsc&#x2F;local"></a>2.2.6.1 æ‰‹åŠ¨åˆ›å»ºsc&#x2F;local</h4><p>â€‹ä½¿ç”¨kubeadmæˆ–kubeaszéƒ¨ç½²çš„k8sç¯å¢ƒï¼Œæ²¡æœ‰åˆ›å»ºä»»ä½•storage classèµ„æºå¯¹è±¡ï¼Œéœ€è¦è‡ªå·±åˆ›å»ºã€‚ä¸€ä¸ªé»˜è®¤çš„scæ˜¯éƒ¨ç½²çš„kubesphereçš„å‰ææ¡ä»¶ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@k8s03-1:~# cd /etc/kubeasz/clusters/k8s03/<br>root@k8s03-1:/etc/kubeasz/clusters/k8s03# cat &gt;&gt; default-storage-class.yaml &lt;&lt;-EOF<br>kind: StorageClass<br>apiVersion: storage.k8s.io/v1<br>metadata:<br>  name: local<br>  annotations:<br>    cas.openebs.io/config: |<br>      - name: StorageType<br>        value: &quot;hostpath&quot;<br>      - name: BasePath<br>        value: &quot;/var/openebs/local/&quot;<br>    openebs.io/cas-type: local<br>    storageclass.beta.kubernetes.io/is-default-class: &#x27;false&#x27;<br>    storageclass.kubesphere.io/supported-access-modes: &#x27;[&quot;ReadWriteOnce&quot;]&#x27;<br>provisioner: openebs.io/local<br>reclaimPolicy: Delete<br>volumeBindingMode: WaitForFirstConsumer<br>EOF<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åº”ç”¨ä¸Šè¿°yamlæ–‡ä»¶ï¼Œåˆ›å»º<span class="hljs-built_in">local</span> sc</span><br>root@k8s03-1:/etc/kubeasz/clusters/k8s03# kubectl get sc<br>No resources found<br>root@k8s03-1:/etc/kubeasz/clusters/k8s03# kubectl apply -f default-storage-class.yaml<br>storageclass.storage.k8s.io/local created<br>root@k8s03-1:/etc/kubeasz/clusters/k8s03# kubectl get sc<br>NAME              PROVISIONER        RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE<br>local             openebs.io/local   Delete          WaitForFirstConsumer   false                  1s<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è®¾ç½®ä¸ºé»˜è®¤StorageClass</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">kubectl patch storageclass <span class="hljs-built_in">local</span> -p <span class="hljs-string">&#x27;&#123;&quot;metadata&quot;: &#123;&quot;annotations&quot;:&#123;&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;&#125;&#125;&#125;&#x27;</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é›†ç¾¤ä¸­åˆ›å»ºé»˜è®¤StorageClass</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">é»˜è®¤æ²¡æœ‰ï¼Œå¯ä»¥è‡ªå»º</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»º StorageClassï¼šhttps://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è®¾ç½®é»˜è®¤ StorageClassï¼šhttps://kubernetes.io/zh-cn/docs/tasks/administer-cluster/change-default-storage-class/</span><br></code></pre></td></tr></table></figure><h4 id="2-2-6-2-æ‰‹åŠ¨åˆ›å»ºsc-nfs"><a href="#2-2-6-2-æ‰‹åŠ¨åˆ›å»ºsc-nfs" class="headerlink" title="2.2.6.2 æ‰‹åŠ¨åˆ›å»ºsc&#x2F;nfs"></a>2.2.6.2 æ‰‹åŠ¨åˆ›å»ºsc&#x2F;nfs</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨k8s03-1èŠ‚ç‚¹ä¸Šæ­å»ºnfsæœåŠ¡ç«¯ï¼šå‚è€ƒâ€œ2.2.4.3.2 æ­å»ºnfsæœåŠ¡å™¨â€ç« èŠ‚</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">1 ä¸‹è½½å¹¶åˆ›å»ºstorageclass</span><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341# mkdir sc-nfs &amp;&amp; cd sc-nfs<br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341/sc-nfs# wget https://raw.githubusercontent.com/kubernetes-sigs/nfs-subdir-external-provisioner/master/deploy/class.yaml<br><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341/sc-nfs# mv class.yaml storageclass-nfs.yml<br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341/sc-nfs# cat storageclass-nfs.yml <br>apiVersion: storage.k8s.io/v1<br>kind: StorageClass # ç±»å‹<br>metadata:<br>  name: nfs-client # åç§°,è¦ä½¿ç”¨å°±éœ€è¦è°ƒç”¨æ­¤åç§°<br>provisioner: k8s-sigs.io/nfs-subdir-external-provisioner # or choose another name, must match deployment&#x27;s env PROVISIONER_NAME&#x27;<br>parameters:<br>  archiveOnDelete: &quot;false&quot; # åˆ é™¤æ•°æ®æ—¶æ˜¯å¦å­˜æ¡£ï¼Œfalseè¡¨ç¤ºä¸å­˜æ¡£ï¼Œtrueè¡¨ç¤ºå­˜æ¡£<br><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341/sc-nfs# kubectl apply -f storageclass-nfs.yml<br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341/sc-nfs# kubectl get sc<br>NAME         PROVISIONER                                   RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE<br>local        kubernetes.io/no-provisioner                  Delete          WaitForFirstConsumer   false                  2m16s<br>nfs-client   k8s-sigs.io/nfs-subdir-external-provisioner   Delete          Immediate              false                  4s<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†nfs-client scè®¾ç½®ä¸ºé»˜è®¤sc</span><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341/sc-nfs# kubectl patch storageclass nfs-client -p &#x27;&#123;&quot;metadata&quot;: &#123;&quot;annotations&quot;:&#123;&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;&#125;&#125;&#125;&#x27;<br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341/sc-nfs# kubectl get sc<br>NAME                   PROVISIONER                                   RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE<br>local                  kubernetes.io/no-provisioner                  Delete          WaitForFirstConsumer   false                  2m40s<br>nfs-client (default)   k8s-sigs.io/nfs-subdir-external-provisioner   Delete          Immediate              false                  28s<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">RECLAIMPOLICY pvå›æ”¶ç­–ç•¥ï¼Œpodæˆ–pvcè¢«åˆ é™¤åï¼Œpvæ˜¯å¦åˆ é™¤è¿˜æ˜¯ä¿ç•™ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">VOLUMEBINDINGMODE Immediate æ¨¡å¼ä¸‹PVCä¸PVç«‹å³ç»‘å®šï¼Œä¸»è¦æ˜¯ä¸ç­‰å¾…ç›¸å…³Podè°ƒåº¦å®Œæˆï¼Œä¸å…³å¿ƒå…¶è¿è¡ŒèŠ‚ç‚¹ï¼Œç›´æ¥å®Œæˆç»‘å®šã€‚ç›¸åçš„ WaitForFirstConsumeræ¨¡å¼ä¸‹éœ€è¦ç­‰å¾…Podè°ƒåº¦å®Œæˆåè¿›è¡ŒPVç»‘å®šã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ALLOWVOLUMEEXPANSION pvcæ‰©å®¹</span><br><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">2 ä¸‹è½½å¹¶åˆ›å»ºrbac</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å› ä¸ºstorageè‡ªåŠ¨åˆ›å»ºpvéœ€è¦ç»è¿‡kube-apiserverï¼Œæ‰€ä»¥éœ€è¦æˆæƒ</span><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341/sc-nfs# wget https://raw.githubusercontent.com/kubernetes-sigs/nfs-subdir-external-provisioner/master/deploy/rbac.yaml<br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341/sc-nfs# mv rbac.yaml storageclass-nfs-rbac.yaml<br><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341/sc-nfs# kubectl apply -f storageclass-nfs-rbac.yaml<br>serviceaccount/nfs-client-provisioner created<br>clusterrole.rbac.authorization.k8s.io/nfs-client-provisioner-runner created<br>clusterrolebinding.rbac.authorization.k8s.io/run-nfs-client-provisioner created<br>role.rbac.authorization.k8s.io/leader-locking-nfs-client-provisioner created<br>rolebinding.rbac.authorization.k8s.io/leader-locking-nfs-client-provisioner created<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">3 åˆ›å»ºåŠ¨æ€ä¾›ç»™çš„deployment</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">éœ€è¦ä¸€ä¸ªdeploymentæ¥ä¸“é—¨å®ç°pvä¸pvcçš„è‡ªåŠ¨åˆ›å»º</span><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341/sc-nfs# cat deploy-nfs-client-provisioner.yml<br>apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  name: nfs-client-provisioner<br>spec:<br>  replicas: 1<br>  strategy:<br>    type: Recreate<br>  selector:<br>    matchLabels:<br>      app: nfs-client-provisioner<br>  template:<br>    metadata:<br>      labels:<br>        app: nfs-client-provisioner<br>    spec:<br>      serviceAccount: nfs-client-provisioner<br>      containers:<br>        - name: nfs-client-provisioner<br>          image: registry.cn-beijing.aliyuncs.com/pylixm/nfs-subdir-external-provisioner:v4.0.0<br>          volumeMounts:<br>            - name: nfs-client-root<br>              mountPath: /persistentvolumes<br>          env:<br>            - name: PROVISIONER_NAME<br>              value: k8s-sigs.io/nfs-subdir-external-provisioner<br>            - name: NFS_SERVER<br>              value: 10.13.15.61          #nfsæœåŠ¡å™¨ip<br>            - name: NFS_PATH<br>              value: /nfs          #nfsæœåŠ¡å™¨å…±äº«ç›˜æŒ‚è½½åœ¨nfsæœåŠ¡å™¨ä¸Šçš„ç›®å½•<br>      volumes:<br>        - name: nfs-client-root<br>          nfs:<br>            server: 10.13.15.61<br>            path: /nfs<br><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341/sc-nfs# kubectl apply -f deploy-nfs-client-provisioner.yml <br>deployment.apps/nfs-client-provisioner created<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹</span><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341/sc-nfs# kubectl get pods -o wide<br>NAME                                      READY   STATUS    RESTARTS   AGE   IP               NODE          NOMINATED NODE   READINESS GATES<br>nfs-client-provisioner-7cdb58c49d-4slt7   1/1     Running   0          44s   172.20.197.147   10.13.15.65   &lt;none&gt;           &lt;none&gt;<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">4 æµ‹è¯•å­˜å‚¨åŠ¨æ€ä¾›ç»™æ˜¯å¦å¯ç”¨</span><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341/sc-nfs# cat nginx-sc.yaml<br>---<br>apiVersion: v1<br>kind: Service<br>metadata:<br>  name: nginx<br>  labels:<br>    app: nginx<br>spec:<br>  ports:<br>  - port: 80<br>    name: web<br>  clusterIP: None<br>  selector:<br>    app: nginx<br>---<br>apiVersion: apps/v1<br>kind: StatefulSet<br>metadata:<br>  name: web<br>spec:<br>  selector:<br>    matchLabels:<br>      app: nginx<br>  serviceName: &quot;nginx&quot;<br>  replicas: 2<br>  template:<br>    metadata:<br>      labels:<br>        app: nginx<br>    spec:<br>      imagePullSecrets:<br>      - name: huoban-harbor<br>      terminationGracePeriodSeconds: 10<br>      containers:<br>      - name: nginx<br>        image: nginx:latest<br>        ports:<br>        - containerPort: 80<br>          name: web<br>        volumeMounts:<br>        - name: www<br>          mountPath: /usr/share/nginx/html<br>  volumeClaimTemplates:<br>  - metadata:<br>      name: www<br>    spec:<br>      accessModes: [ &quot;ReadWriteOnce&quot; ]<br>      storageClassName: &quot;nfs-client&quot;<br>      resources:<br>        requests:<br>          storage: 1Gi<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åº”ç”¨</span><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341/sc-nfs# kubectl apply -f nginx-sc.yaml <br>service/nginx created<br>statefulset.apps/web created<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹pvä¸pvcåˆ›å»ºæƒ…å†µ</span><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341/sc-nfs# kubectl get pv<br>NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM               STORAGECLASS   REASON   AGE<br>pvc-0a9b8046-b364-4146-816d-815dd5696ac5   1Gi        RWO            Delete           Bound    default/www-web-0   nfs-client              64s<br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341/sc-nfs# kubectl get pvc<br>NAME        STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE<br>www-web-0   Bound    pvc-0a9b8046-b364-4146-816d-815dd5696ac5   1Gi        RWO            nfs-client     60s<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹pod</span><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341/sc-nfs# kubectl get pods -o wide | egrep &quot;NAME|web&quot;<br>NAME                           READY   STATUS    RESTARTS   AGE     IP               NODE          NOMINATED NODE   READINESS GATES<br>web-0                          1/1     Running   0          5m11s   172.20.46.31     10.13.15.64   &lt;none&gt;           &lt;none&gt;<br>web-1                          1/1     Running   0          3m23s   172.20.197.148   10.13.15.65   &lt;none&gt;           &lt;none&gt;<br></code></pre></td></tr></table></figure><p>å¦‚æœè¦åˆ é™¤stoarageclass&#x2F;nfs-client ç›¸å…³èµ„æºå¯¹è±¡ä¸é…ç½®ï¼Œæ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341/sc-nfs# kubectl delete -f deploy-nfs-client-provisioner.yml<br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341/sc-nfs# kubectl delete -f storageclass-nfs-rbac.yaml<br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341/sc-nfs# kubectl delete -f storageclass-nfs.yml<br></code></pre></td></tr></table></figure><h4 id="2-2-6-3-æ‰‹åŠ¨åˆ›å»ºsc-ceph"><a href="#2-2-6-3-æ‰‹åŠ¨åˆ›å»ºsc-ceph" class="headerlink" title="2.2.6.3 æ‰‹åŠ¨åˆ›å»ºsc&#x2F;ceph"></a>2.2.6.3 æ‰‹åŠ¨åˆ›å»ºsc&#x2F;ceph</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æš‚ç•¥ï¼Œåç»­å¯èƒ½æ›´æ–°åœ¨ä¸ªäººgithubåšå®¢ï¼šhttps://jiangsanyin.github.io/archives/</span><br></code></pre></td></tr></table></figure><h4 id="2-2-6-4-ä¸‹è½½kubesphereå®‰è£…æ–‡ä»¶"><a href="#2-2-6-4-ä¸‹è½½kubesphereå®‰è£…æ–‡ä»¶" class="headerlink" title="2.2.6.4 ä¸‹è½½kubesphereå®‰è£…æ–‡ä»¶"></a>2.2.6.4 ä¸‹è½½kubesphereå®‰è£…æ–‡ä»¶</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341# wget https://github.com/kubesphere/ks-installer/releases/download/v3.4.1/kubesphere-installer.yaml<br><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341# wget https://github.com/kubesphere/ks-installer/releases/download/v3.4.1/cluster-configuration.yaml<br></code></pre></td></tr></table></figure><h4 id="2-2-6-5-å‡†å¤‡å®‰è£…é•œåƒ"><a href="#2-2-6-5-å‡†å¤‡å®‰è£…é•œåƒ" class="headerlink" title="2.2.6.5 å‡†å¤‡å®‰è£…é•œåƒ"></a>2.2.6.5 å‡†å¤‡å®‰è£…é•œåƒ</h4><h5 id="2-2-6-5-1-å‡†å¤‡é•œåƒæ¸…å•æ–‡ä»¶"><a href="#2-2-6-5-1-å‡†å¤‡é•œåƒæ¸…å•æ–‡ä»¶" class="headerlink" title="2.2.6.5.1 å‡†å¤‡é•œåƒæ¸…å•æ–‡ä»¶"></a>2.2.6.5.1 å‡†å¤‡é•œåƒæ¸…å•æ–‡ä»¶</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»ºé•œåƒæ¸…å•æ–‡ä»¶ images-list-aliyuncs.txt</span><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341# touch images-list-aliyuncs.txt<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">images-list-aliyuncs.txtæ–‡ä»¶å†…å®¹å¦‚ä¸‹</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨ç»éªŒå‘Šè¯‰ç¬”è€…ï¼Œå¦‚æœåªä½¿ç”¨æœ€åŸºç¡€çš„kubesphereåŠŸèƒ½ï¼Œä¸‹åˆ—é•œåƒåˆ—è¡¨å¯ä»¥è¿›ä¸€æ­¥è¢«è£å‰ªï¼ˆç¬”è€…æš‚æœªåšè£å‰ªï¼‰</span><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341# cat images-list-aliyuncs.txt<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#kubesphere-images</span></span><br>registry.cn-beijing.aliyuncs.com/kubesphereio/ks-installer:v3.4.1<br>registry.cn-beijing.aliyuncs.com/kubesphereio/ks-apiserver:v3.4.1<br>registry.cn-beijing.aliyuncs.com/kubesphereio/ks-console:v3.4.1<br>registry.cn-beijing.aliyuncs.com/kubesphereio/ks-controller-manager:v3.4.1<br>registry.cn-beijing.aliyuncs.com/kubesphereio/kubectl:v1.20.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/kubectl:v1.22.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/kubefed:v0.8.1<br>registry.cn-beijing.aliyuncs.com/kubesphereio/tower:v0.2.1<br>registry.cn-beijing.aliyuncs.com/kubesphereio/minio:RELEASE.2019-08-07T01-59-21Z<br>registry.cn-beijing.aliyuncs.com/kubesphereio/mc:RELEASE.2019-08-07T23-14-43Z<br>registry.cn-beijing.aliyuncs.com/kubesphereio/snapshot-controller:v4.0.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/nginx-ingress-controller:v1.3.1<br>registry.cn-beijing.aliyuncs.com/kubesphereio/defaultbackend-amd64:1.4<br>registry.cn-beijing.aliyuncs.com/kubesphereio/metrics-server:v0.4.2<br>registry.cn-beijing.aliyuncs.com/kubesphereio/redis:5.0.14-alpine<br>registry.cn-beijing.aliyuncs.com/kubesphereio/haproxy:2.0.25-alpine<br>registry.cn-beijing.aliyuncs.com/kubesphereio/alpine:3.14<br>registry.cn-beijing.aliyuncs.com/kubesphereio/openldap:1.3.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/netshoot:v1.0<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#kubeedge-images</span></span><br>registry.cn-beijing.aliyuncs.com/kubesphereio/cloudcore:v1.13.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/iptables-manager:v1.13.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/edgeservice:v0.3.0<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#gatekeeper-images</span></span><br>registry.cn-beijing.aliyuncs.com/kubesphereio/gatekeeper:v3.5.2<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#openpitrix-images</span></span><br>registry.cn-beijing.aliyuncs.com/kubesphereio/openpitrix-jobs:v3.3.2<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#kubesphere-devops-images</span></span><br>registry.cn-beijing.aliyuncs.com/kubesphereio/devops-apiserver:ks-v3.4.1<br>registry.cn-beijing.aliyuncs.com/kubesphereio/devops-controller:ks-v3.4.1<br>registry.cn-beijing.aliyuncs.com/kubesphereio/devops-tools:ks-v3.4.1<br>registry.cn-beijing.aliyuncs.com/kubesphereio/ks-jenkins:v3.4.0-2.319.3-1<br>registry.cn-beijing.aliyuncs.com/kubesphereio/inbound-agent:4.10-2<br>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-base:v3.2.2<br>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-nodejs:v3.2.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-maven:v3.2.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-maven:v3.2.1-jdk11<br>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-python:v3.2.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-go:v3.2.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-go:v3.2.2-1.16<br>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-go:v3.2.2-1.17<br>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-go:v3.2.2-1.18<br>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-base:v3.2.2-podman<br>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-nodejs:v3.2.0-podman<br>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-maven:v3.2.0-podman<br>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-maven:v3.2.1-jdk11-podman<br>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-python:v3.2.0-podman<br>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-go:v3.2.0-podman<br>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-go:v3.2.2-1.16-podman<br>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-go:v3.2.2-1.17-podman<br>registry.cn-beijing.aliyuncs.com/kubesphereio/builder-go:v3.2.2-1.18-podman<br>registry.cn-beijing.aliyuncs.com/kubesphereio/s2ioperator:v3.2.1<br>registry.cn-beijing.aliyuncs.com/kubesphereio/s2irun:v3.2.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/s2i-binary:v3.2.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/tomcat85-java11-centos7:v3.2.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/tomcat85-java11-runtime:v3.2.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/tomcat85-java8-centos7:v3.2.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/tomcat85-java8-runtime:v3.2.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/java-11-centos7:v3.2.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/java-8-centos7:v3.2.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/java-8-runtime:v3.2.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/java-11-runtime:v3.2.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/nodejs-8-centos7:v3.2.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/nodejs-6-centos7:v3.2.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/nodejs-4-centos7:v3.2.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/python-36-centos7:v3.2.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/python-35-centos7:v3.2.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/python-34-centos7:v3.2.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/python-27-centos7:v3.2.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/argocd:v2.3.3<br>registry.cn-beijing.aliyuncs.com/kubesphereio/argocd-applicationset:v0.4.1<br>registry.cn-beijing.aliyuncs.com/kubesphereio/dex:v2.30.2<br>registry.cn-beijing.aliyuncs.com/kubesphereio/redis:6.2.6-alpine<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#kubesphere-monitoring-images</span></span><br>registry.cn-beijing.aliyuncs.com/kubesphereio/configmap-reload:v0.7.1<br>registry.cn-beijing.aliyuncs.com/kubesphereio/prometheus:v2.39.1<br>registry.cn-beijing.aliyuncs.com/kubesphereio/prometheus-config-reloader:v0.55.1<br>registry.cn-beijing.aliyuncs.com/kubesphereio/prometheus-operator:v0.55.1<br>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-rbac-proxy:v0.11.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-state-metrics:v2.6.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/node-exporter:v1.3.1<br>registry.cn-beijing.aliyuncs.com/kubesphereio/alertmanager:v0.23.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/thanos:v0.31.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/grafana:8.3.3<br>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-rbac-proxy:v0.11.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/notification-manager-operator:v2.3.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/notification-manager:v2.3.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/notification-tenant-sidecar:v3.2.0<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#kubesphere-logging-images</span></span><br>registry.cn-beijing.aliyuncs.com/kubesphereio/elasticsearch-curator:v5.7.6<br>registry.cn-beijing.aliyuncs.com/kubesphereio/opensearch-curator:v0.0.5<br>registry.cn-beijing.aliyuncs.com/kubesphereio/elasticsearch-oss:6.8.22<br>registry.cn-beijing.aliyuncs.com/kubesphereio/opensearch:2.6.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/opensearch-dashboards:2.6.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/fluentbit-operator:v0.14.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/docker:19.03<br>registry.cn-beijing.aliyuncs.com/kubesphereio/fluent-bit:v1.9.4<br>registry.cn-beijing.aliyuncs.com/kubesphereio/log-sidecar-injector:v1.2.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/filebeat:6.7.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-events-operator:v0.6.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-events-exporter:v0.6.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-events-ruler:v0.6.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-auditing-operator:v0.2.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/kube-auditing-webhook:v0.2.0<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#istio-images</span></span><br>registry.cn-beijing.aliyuncs.com/kubesphereio/pilot:1.14.6<br>registry.cn-beijing.aliyuncs.com/kubesphereio/proxyv2:1.14.6<br>registry.cn-beijing.aliyuncs.com/kubesphereio/jaeger-operator:1.29<br>registry.cn-beijing.aliyuncs.com/kubesphereio/jaeger-agent:1.29<br>registry.cn-beijing.aliyuncs.com/kubesphereio/jaeger-collector:1.29<br>registry.cn-beijing.aliyuncs.com/kubesphereio/jaeger-query:1.29<br>registry.cn-beijing.aliyuncs.com/kubesphereio/jaeger-es-index-cleaner:1.29<br>registry.cn-beijing.aliyuncs.com/kubesphereio/kiali-operator:v1.50.1<br>registry.cn-beijing.aliyuncs.com/kubesphereio/kiali:v1.50<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#example-images</span></span><br>registry.cn-beijing.aliyuncs.com/kubesphereio/busybox:1.31.1<br>registry.cn-beijing.aliyuncs.com/kubesphereio/nginx:1.14-alpine<br>registry.cn-beijing.aliyuncs.com/kubesphereio/wget:1.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/hello:plain-text<br>registry.cn-beijing.aliyuncs.com/kubesphereio/wordpress:4.8-apache<br>registry.cn-beijing.aliyuncs.com/kubesphereio/hpa-example:latest<br>registry.cn-beijing.aliyuncs.com/kubesphereio/fluentd:v1.4.2-2.0<br>registry.cn-beijing.aliyuncs.com/kubesphereio/perl:latest<br>registry.cn-beijing.aliyuncs.com/kubesphereio/examples-bookinfo-productpage-v1:1.16.2<br>registry.cn-beijing.aliyuncs.com/kubesphereio/examples-bookinfo-reviews-v1:1.16.2<br>registry.cn-beijing.aliyuncs.com/kubesphereio/examples-bookinfo-reviews-v2:1.16.2<br>registry.cn-beijing.aliyuncs.com/kubesphereio/examples-bookinfo-details-v1:1.16.2<br>registry.cn-beijing.aliyuncs.com/kubesphereio/examples-bookinfo-ratings-v1:1.16.3<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#weave-scope-images</span></span><br>registry.cn-beijing.aliyuncs.com/kubesphereio/scope:1.13.0<br></code></pre></td></tr></table></figure><h5 id="2-2-6-5-2-ä¸‹è½½-offline-installation-tool-sh"><a href="#2-2-6-5-2-ä¸‹è½½-offline-installation-tool-sh" class="headerlink" title="2.2.6.5.2 ä¸‹è½½ offline-installation-tool.sh"></a>2.2.6.5.2 ä¸‹è½½ <code>offline-installation-tool.sh</code></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹è½½offline-installation-tool.sh</span> <br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341# curl -L -O https://github.com/kubesphere/ks-installer/releases/download/v3.4.1/offline-installation-tool.sh<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœä¸èƒ½æ­£å¸¸ä¸‹è½½ï¼Œæ­¤å¤„å‡†å¤‡äº†æ­¤æ–‡ä»¶çš„å†…å®¹ï¼Œå¦‚ä¸‹</span><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341# cat offline-installation-tool.sh<br><span class="hljs-meta prompt_">#</span><span class="language-bash">!/usr/bin/env bash</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Copyright 2018 The KubeSphere Authors.</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">you may not use this file except <span class="hljs-keyword">in</span> compliance with the License.</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">You may obtain a copy of the License at</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment">#     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># Unless required by applicable law or agreed to in writing, software</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">distributed under the License is distributed on an <span class="hljs-string">&quot;AS IS&quot;</span> BASIS,</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">See the License <span class="hljs-keyword">for</span> the specific language governing permissions and</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">limitations under the License.</span><br><br><br>CurrentDIR=$(cd &quot;$(dirname &quot;$0&quot;)&quot; || exit;pwd)<br>ImagesDirDefault=$&#123;CurrentDIR&#125;/kubesphere-images<br>save=&quot;false&quot;<br>registryurl=&quot;&quot;<br>reposUrl=(&quot;quay.azk8s.cn&quot; &quot;gcr.azk8s.cn&quot; &quot;docker.elastic.co&quot; &quot;quay.io&quot; &quot;k8s.gcr.io&quot;)<br>KUBERNETES_VERSION=$&#123;KUBERNETES_VERSION:-&quot;v1.21.5&quot;&#125;<br>HELM_VERSION=$&#123;HELM_VERSION:-&quot;v3.6.3&quot;&#125;<br>CNI_VERSION=$&#123;CNI_VERSION:-&quot;v0.9.1&quot;&#125;<br>ETCD_VERSION=$&#123;ETCD_VERSION:-&quot;v3.4.13&quot;&#125;<br>CRICTL_VERSION=$&#123;CRICTL_VERSION:-&quot;v1.22.0&quot;&#125;<br>DOCKER_VERSION=$&#123;DOCKER_VERSION:-&quot;20.10.8&quot;&#125;<br><br>func() &#123;<br>    echo &quot;Usage:&quot;<br>    echo<br>    echo &quot;  $0 [-l IMAGES-LIST] [-d IMAGES-DIR] [-r PRIVATE-REGISTRY] [-v KUBERNETES_VERSION ]&quot;<br>    echo<br>    echo &quot;Description:&quot;<br>    echo &quot;  -b                     : save kubernetes&#x27; binaries.&quot;<br>    echo &quot;  -d IMAGES-DIR          : the dir of files (tar.gz) which generated by \`docker save\`. default: $&#123;ImagesDirDefault&#125;&quot;<br>    echo &quot;  -l IMAGES-LIST         : text file with list of images.&quot;<br>    echo &quot;  -r PRIVATE-REGISTRY    : target private registry:port.&quot;<br>    echo &quot;  -s                     : save model will be applied. Pull the images in the IMAGES-LIST and save images as a tar.gz file.&quot;<br>    echo &quot;  -v KUBERNETES_VERSION  : download kubernetes&#x27; binaries. default: v1.21.5&quot;<br>    echo &quot;  -h                     : usage message&quot;<br>    echo<br>    echo &quot;Examples:&quot;<br>    echo<br>    echo &quot;# Download the default kubernetes version dependency binaries.(default: [kubernetes: v1.21.5], [helm: v3.6.3], [cni: v0.9.1], [etcd: v3.4.13])&quot;<br>    echo &quot;./offline-installtion-tool.sh -b&quot;<br>    echo<br>    echo &quot;# Custom download the kubernetes version dependecy binaries.&quot;<br>    echo &quot;export KUBERNETES_VERSION=v1.22.1;export HELM_VERSION=v3.6.3;&quot;<br>    echo &quot;./offline-installtion-tool.sh -b&quot;<br>    exit<br>&#125;<br><br>while getopts &#x27;bsl:r:d:v:h&#x27; OPT; do<br>    case $OPT in<br>        b) binary=&quot;true&quot;;;<br>        d) ImagesDir=&quot;$OPTARG&quot;;;<br>        l) ImagesList=&quot;$OPTARG&quot;;;<br>        r) Registry=&quot;$OPTARG&quot;;;<br>        s) save=&quot;true&quot;;;<br>        v) KUBERNETES_VERSION=&quot;$OPTARG&quot;;;<br>        h) func;;<br>        ?) func;;<br>        *) func;;<br>    esac<br>done<br><br>if [ -z &quot;$&#123;ImagesDir&#125;&quot; ]; then<br>    ImagesDir=$&#123;ImagesDirDefault&#125;<br>fi<br><br>if [ -n &quot;$&#123;Registry&#125;&quot; ]; then<br>   registryurl=$&#123;Registry&#125;<br>fi<br><br>if [ -z &quot;$&#123;ARCH&#125;&quot; ]; then<br>  case &quot;$(uname -m)&quot; in<br>  x86_64)<br>    ARCH=amd64<br>    ;;<br>  armv8*)<br>    ARCH=arm64<br>    ;;<br>  aarch64*)<br>    ARCH=arm64<br>    ;;<br>  armv*)<br>    ARCH=armv7<br>    ;;<br>  *)<br>    echo &quot;$&#123;ARCH&#125;, isn&#x27;t supported&quot;<br>    exit 1<br>    ;;<br>  esac<br>fi<br><br>binariesDIR=$&#123;CurrentDIR&#125;/kubekey/$&#123;KUBERNETES_VERSION&#125;/$&#123;ARCH&#125;<br><br>if [[ $&#123;binary&#125; == &quot;true&quot; ]]; then<br>  mkdir -p $&#123;binariesDIR&#125;<br>  if [ -n &quot;$&#123;KKZONE&#125;&quot; ] &amp;&amp; [ &quot;x$&#123;KKZONE&#125;&quot; == &quot;xcn&quot; ]; then<br>     echo &quot;Download kubeadm ...&quot;<br>     curl -L -o $&#123;binariesDIR&#125;/kubeadm https://kubernetes-release.pek3b.qingstor.com/release/$&#123;KUBERNETES_VERSION&#125;/bin/linux/$&#123;ARCH&#125;/kubeadm<br>     echo &quot;Download kubelet ...&quot;<br>     curl -L -o $&#123;binariesDIR&#125;/kubelet https://kubernetes-release.pek3b.qingstor.com/release/$&#123;KUBERNETES_VERSION&#125;/bin/linux/$&#123;ARCH&#125;/kubelet<br>     echo &quot;Download kubectl ...&quot;<br>     curl -L -o $&#123;binariesDIR&#125;/kubectl https://kubernetes-release.pek3b.qingstor.com/release/$&#123;KUBERNETES_VERSION&#125;/bin/linux/$&#123;ARCH&#125;/kubectl<br>     echo &quot;Download helm ...&quot;<br>     curl -L -o $&#123;binariesDIR&#125;/helm https://kubernetes-helm.pek3b.qingstor.com/linux-$&#123;ARCH&#125;/$&#123;HELM_VERSION&#125;/helm<br>     echo &quot;Download cni plugins ...&quot;<br>     curl -L -o $&#123;binariesDIR&#125;/cni-plugins-linux-$&#123;ARCH&#125;-$&#123;CNI_VERSION&#125;.tgz https://containernetworking.pek3b.qingstor.com/plugins/releases/download/$&#123;CNI_VERSION&#125;/cni-plugins-linux-$&#123;ARCH&#125;-$&#123;CNI_VERSION&#125;.tgz<br>     echo &quot;Download etcd ...&quot;<br>     curl -L -o $&#123;binariesDIR&#125;/etcd-$&#123;ETCD_VERSION&#125;-linux-$&#123;ARCH&#125;.tar.gz https://kubernetes-release.pek3b.qingstor.com/etcd/release/download/$&#123;ETCD_VERSION&#125;/etcd-$&#123;ETCD_VERSION&#125;-linux-$&#123;ARCH&#125;.tar.gz<br>     echo &quot;Download crictl ...&quot;<br>     curl -L -o $&#123;binariesDIR&#125;/crictl-$&#123;CRICTL_VERSION&#125;-linux-$&#123;ARCH&#125;.tar.gz https://kubernetes-release.pek3b.qingstor.com/cri-tools/releases/download/$&#123;CRICTL_VERSION&#125;/crictl-$&#123;CRICTL_VERSION&#125;-linux-$&#123;ARCH&#125;.tar.gz<br>     echo &quot;Download docker ...&quot;<br>     curl -L -o $&#123;binariesDIR&#125;/docker-$&#123;DOCKER_VERSION&#125;.tgz https://mirrors.aliyun.com/docker-ce/linux/static/stable/$&#123;ARCH&#125;/docker-$&#123;DOCKER_VERSION&#125;.tgz<br>  else<br>     echo &quot;Download kubeadm ...&quot;<br>     curl -L -o $&#123;binariesDIR&#125;/kubeadm https://storage.googleapis.com/kubernetes-release/release/$&#123;KUBERNETES_VERSION&#125;/bin/linux/$&#123;ARCH&#125;/kubeadm<br>     echo &quot;Download kubelet ...&quot;<br>     curl -L -o $&#123;binariesDIR&#125;/kubelet https://storage.googleapis.com/kubernetes-release/release/$&#123;KUBERNETES_VERSION&#125;/bin/linux/$&#123;ARCH&#125;/kubelet<br>     echo &quot;Download kubectl ...&quot;<br>     curl -L -o $&#123;binariesDIR&#125;/kubectl https://storage.googleapis.com/kubernetes-release/release/$&#123;KUBERNETES_VERSION&#125;/bin/linux/$&#123;ARCH&#125;/kubectl<br>     echo &quot;Download helm ...&quot;<br>     curl -L -o $&#123;binariesDIR&#125;/helm-$&#123;HELM_VERSION&#125;-linux-$&#123;ARCH&#125;.tar.gz https://get.helm.sh/helm-$&#123;HELM_VERSION&#125;-linux-$&#123;ARCH&#125;.tar.gz &amp;&amp; cd $&#123;binariesDIR&#125; &amp;&amp; tar -zxf helm-$&#123;HELM_VERSION&#125;-linux-$&#123;ARCH&#125;.tar.gz &amp;&amp; mv linux-$&#123;ARCH&#125;/helm . &amp;&amp; rm -rf *linux-$&#123;ARCH&#125;* &amp;&amp; cd -<br>     echo &quot;Download cni plugins ...&quot;<br>     curl -L -o $&#123;binariesDIR&#125;/cni-plugins-linux-$&#123;ARCH&#125;-$&#123;CNI_VERSION&#125;.tgz https://github.com/containernetworking/plugins/releases/download/$&#123;CNI_VERSION&#125;/cni-plugins-linux-$&#123;ARCH&#125;-$&#123;CNI_VERSION&#125;.tgz<br>     echo &quot;Download etcd ...&quot;<br>     curl -L -o $&#123;binariesDIR&#125;/etcd-$&#123;ETCD_VERSION&#125;-linux-$&#123;ARCH&#125;.tar.gz https://github.com/coreos/etcd/releases/download/$&#123;ETCD_VERSION&#125;/etcd-$&#123;ETCD_VERSION&#125;-linux-$&#123;ARCH&#125;.tar.gz<br>     echo &quot;Download crictl ...&quot;<br>     curl -L -o $&#123;binariesDIR&#125;/crictl-$&#123;CRICTL_VERSION&#125;-linux-$&#123;ARCH&#125;.tar.gz https://github.com/kubernetes-sigs/cri-tools/releases/download/$&#123;CRICTL_VERSION&#125;/crictl-$&#123;CRICTL_VERSION&#125;-linux-$&#123;ARCH&#125;.tar.gz<br>     echo &quot;Download docker ...&quot;<br>     curl -L -o $&#123;binariesDIR&#125;/docker-$&#123;DOCKER_VERSION&#125;.tgz https://download.docker.com/linux/static/stable/$&#123;ARCH&#125;/docker-$&#123;DOCKER_VERSION&#125;.tgz<br>  fi<br>fi<br><br>if [[ $&#123;save&#125; == &quot;true&quot; ]] &amp;&amp; [[ -n &quot;$&#123;ImagesList&#125;&quot; ]]; then<br>    if [ ! -d $&#123;ImagesDir&#125; ]; then<br>       mkdir -p $&#123;ImagesDir&#125;<br>    fi<br>    ImagesListLen=$(cat $&#123;ImagesList&#125; | wc -l)<br>    name=&quot;&quot;<br>    images=&quot;&quot;<br>    index=0<br>    for image in $(&lt;$&#123;ImagesList&#125;); do<br>        if [[ $&#123;image&#125; =~ ^\#\#.* ]]; then<br>           if [[ -n $&#123;images&#125; ]]; then<br>              echo &quot;&quot;<br>              echo &quot;Save images: &quot;$&#123;name&#125;&quot; to &quot;$&#123;ImagesDir&#125;&quot;/&quot;$&#123;name&#125;&quot;.tar.gz  &lt;&lt;&lt;&quot;<br>              docker save $&#123;images&#125; | gzip -c &gt; $&#123;ImagesDir&#125;&quot;/&quot;$&#123;name&#125;.tar.gz<br>              echo &quot;&quot;<br>           fi<br>           images=&quot;&quot;<br>           name=$(echo &quot;$&#123;image&#125;&quot; | sed &#x27;s/#//g&#x27; | sed -e &#x27;s/[[:space:]]//g&#x27;)<br>           ((index++))<br>           continue<br>        fi<br><br>        image=$(echo &quot;$&#123;image&#125;&quot; |tr -d &#x27;\r&#x27;)<br>        docker pull &quot;$&#123;image&#125;&quot;<br>        images=$&#123;images&#125;&quot; &quot;$&#123;image&#125;<br><br>        if [[ $&#123;index&#125; -eq $&#123;ImagesListLen&#125;-1 ]]; then<br>           if [[ -n $&#123;images&#125; ]]; then<br>              docker save $&#123;images&#125; | gzip -c &gt; $&#123;ImagesDir&#125;&quot;/&quot;$&#123;name&#125;.tar.gz<br>           fi<br>        fi<br>        ((index++))<br>    done<br>elif [ -n &quot;$&#123;ImagesList&#125;&quot; ]; then<br>    # shellcheck disable=SC2045<br>    for image in $(ls $&#123;ImagesDir&#125;/*.tar.gz); do<br>      echo &quot;Load images: &quot;$&#123;image&#125;&quot;  &lt;&lt;&lt;&quot;<br>      docker load  &lt; $image<br>    done<br><br>    if [[ -n $&#123;registryurl&#125; ]]; then<br>       for image in $(&lt;$&#123;ImagesList&#125;); do<br>          if [[ $&#123;image&#125; =~ ^\#\#.* ]]; then<br>             continue<br>          fi<br>          url=$&#123;image%%/*&#125;   # $&#123;image&#125;ç¬¬ä¸€ä¸ª/å·¦è¾¹çš„æ‰€æœ‰å­—ç¬¦ä¸²<br>          ImageName=$&#123;image#*/&#125;   # $&#123;image&#125;ç¬¬ä¸€ä¸ª/å³è¾¹çš„æ‰€æœ‰å­—ç¬¦ä¸²<br>          echo $image<br><br>          if echo &quot;$&#123;reposUrl[@]&#125;&quot; | grep -Fx &quot;$url&quot; &amp;&gt;/dev/null; then<br>            imageurl=$registryurl&quot;/&quot;$&#123;image#*/&#125;<br>          elif [ $url == $registryurl ]; then<br>              if [[ $ImageName != */* ]]; then<br>                 imageurl=$registryurl&quot;/library/&quot;$ImageName<br>              else<br>                 imageurl=$image<br>              fi<br>          elif [ &quot;$(echo $url | grep &#x27;:&#x27;)&quot; != &quot;&quot; ]; then<br>              imageurl=$registryurl&quot;/library/&quot;$image<br>          else<br>              imageurl=$registryurl&quot;/&quot;$image<br>          fi<br><br>          ## push image<br>          image=$(echo &quot;$&#123;image&#125;&quot; |tr -d &#x27;\r&#x27;)<br>          imageurl=$(echo &quot;$&#123;imageurl&#125;&quot; |tr -d &#x27;\r&#x27;)<br>          echo $imageurl<br>          docker tag $image $imageurl<br>          docker push $imageurl<br>       done<br>    fi<br>fi<br><br></code></pre></td></tr></table></figure><p>ä½¿ <code>.sh</code> æ–‡ä»¶å¯æ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chmod +x offline-installation-tool.sh<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹å¦‚ä½•ä½¿ç”¨è„šæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">./offline-installation-tool.sh -h<br></code></pre></td></tr></table></figure><h5 id="2-2-6-5-3-æ‹‰å–é•œåƒ"><a href="#2-2-6-5-3-æ‹‰å–é•œåƒ" class="headerlink" title="2.2.6.5.3 æ‹‰å–é•œåƒ"></a>2.2.6.5.3 æ‹‰å–é•œåƒ</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341# ./offline-installation-tool.sh -s -l images-list-aliyuncs.txt -d ./kubesphere-images<br></code></pre></td></tr></table></figure><h4 id="2-2-6-6-æ¨é€é•œåƒè‡³ç§æœ‰ä»“åº“"><a href="#2-2-6-6-æ¨é€é•œåƒè‡³ç§æœ‰ä»“åº“" class="headerlink" title="2.2.6.6 æ¨é€é•œåƒè‡³ç§æœ‰ä»“åº“"></a>2.2.6.6 æ¨é€é•œåƒè‡³ç§æœ‰ä»“åº“</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ¨é€åˆ°docker registryä¸­</span><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341# ./offline-installation-tool.sh -l images-list-aliyuncs.txt -d ./kubesphere-images -r easzlab.io.local<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœä½ å·²ç»æŒ‰ç…§å‰é¢çš„æ­¥éª¤å®‰è£…äº†Harborï¼ˆé»˜è®¤å·²ç»åˆ›å»ºä¸€ä¸ªlibraryé¡¹ç›®ï¼‰ï¼Œæ­¤å¤„è¿˜å¯ä»¥å°†é•œåƒæ¨é€åˆ°Harborä»“åº“ä¸­</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341# ./offline-installation-tool.sh -l images-list-aliyuncs.txt -d ./kubesphere-images -r harbor.yourdomain.com:8444</span><br></code></pre></td></tr></table></figure><h4 id="2-2-6-7-ä¿®æ”¹ks-installer-v3-4-1é•œåƒ"><a href="#2-2-6-7-ä¿®æ”¹ks-installer-v3-4-1é•œåƒ" class="headerlink" title="2.2.6.7 ä¿®æ”¹ks-installer:v3.4.1é•œåƒ"></a>2.2.6.7 ä¿®æ”¹ks-installer:v3.4.1é•œåƒ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸ä¿®æ”¹çš„è¯ï¼Œçš„ä¼šæç¤ºâ€œafter connection broken by â€˜SSLError(SSLCertVerificationError(1, â€™[SSL: CERTIFICATE_VERIFY_FAILED] certificaâ€æŠ¥é”™</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»ºDockerfileæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹</span><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341# cat Dockerfile <br>FROM registry.cn-beijing.aliyuncs.com/kubesphereio/ks-installer:v3.4.1<br>USER root<br>RUN sed -i &#x27;s/self.verify_ssl = True/self.verify_ssl = False/g&#x27; /usr/local/lib/python3.10/site-packages/kubernetes/client/configuration.py<br>USER kubesphere<br><br><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341# docker build -f Dockerfile ./ -t easzlab.io.local/registry.cn-beijing.aliyuncs.com/kubesphereio/ks-installer:v3.4.1<br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341# docker push easzlab.io.local/registry.cn-beijing.aliyuncs.com/kubesphereio/ks-installer:v3.4.1<br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341# docker tag easzlab.io.local/registry.cn-beijing.aliyuncs.com/kubesphereio/ks-installer:v3.4.1 easzlab.io.local/library/ks-installer:v3.4.1<br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341# docker push easzlab.io.local/library/ks-installer:v3.4.1<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿®æ”¹kubesphere-installer.yaml æ–‡ä»¶ä¸­ä½¿ç”¨çš„ks-installeré•œåƒ</span><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341# sed -i &#x27;s#image: kubesphere/ks-installer:v3.4.1#image: easzlab.io.local/library/ks-installer:v3.4.1#g&#x27; kubesphere-installer.yaml<br></code></pre></td></tr></table></figure><h4 id="2-2-6-8-ä¸Šä¼ é•œåƒåˆ°æŒ‡å®šregistryé¡¹ç›®ä¸‹"><a href="#2-2-6-8-ä¸Šä¼ é•œåƒåˆ°æŒ‡å®šregistryé¡¹ç›®ä¸‹" class="headerlink" title="2.2.6.8 ä¸Šä¼ é•œåƒåˆ°æŒ‡å®šregistryé¡¹ç›®ä¸‹"></a>2.2.6.8 ä¸Šä¼ é•œåƒåˆ°æŒ‡å®šregistryé¡¹ç›®ä¸‹</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»ºpush-image-to-easzlab.io.local.sh æ–‡ä»¶</span><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341# touch push-image-to-easzlab.io.local.sh <br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">push-image-to-easzlab.io.local.sh æ–‡ä»¶å†…å®¹å¦‚ä¸‹</span><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341# cat push-image-to-easzlab.io.local.sh <br><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br>images=`docker images | egrep &quot;^registry.cn-beijing.aliyuncs.com&quot;`<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸Šä¼ æ‰€æœ‰é•œåƒåˆ°libraryé¡¹ç›®ä¸‹</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä½¿ç”¨ <span class="hljs-keyword">while</span> å¾ªç¯éå†æ¯ä¸€è¡Œ</span><br>while IFS= read -r line; do<br>  echo &quot;$line&quot;<br>  image=`echo $line | awk &#x27;&#123;print $1&#125;&#x27;`<br>  tag=`echo $line | awk &#x27;&#123;print $2&#125;&#x27;`<br>  ImageName=$&#123;image##*/&#125;  #é•œåƒåï¼Œä¸åŒ…å«å‰é¢çš„æ‰€æœ‰repositoryååŠæ–œçº¿<br>  newImageTag=&quot;easzlab.io.local/library/$&#123;ImageName&#125;:$&#123;tag&#125;&quot;<br>  echo $&#123;newImageTag&#125;<br>  docker tag &quot;$&#123;image&#125;:$&#123;tag&#125;&quot; $&#123;newImageTag&#125;<br>  docker push $&#123;newImageTag&#125;<br>  echo &quot;---------------&quot;<br>done &lt;&lt;&lt; &quot;$images&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç»éªŒè¯ç»™éƒ¨ç½²kubesphere3.4.1è¿‡ç¨‹ä¸­éœ€è¦ç”¨åˆ°çš„é•œåƒé‡æ–°å‘½å</span><br>docker tag easzlab.io.local/library/snapshot-controller:v4.0.0 easzlab.io.local/csiplugin/snapshot-controller:v4.0.0<br>docker push easzlab.io.local/csiplugin/snapshot-controller:v4.0.0<br>docker tag easzlab.io.local/library/defaultbackend-amd64:1.4 easzlab.io.local/mirrorgooglecontainers/defaultbackend-amd64:1.4<br>docker push easzlab.io.local/mirrorgooglecontainers/defaultbackend-amd64:1.4<br>docker tag easzlab.io.local/library/ks-console:v3.4.1 easzlab.io.local/kubesphere/ks-console:v3.4.1<br>docker push easzlab.io.local/kubesphere/ks-console:v3.4.1<br>docker tag easzlab.io.local/library/kube-state-metrics:v2.6.0 easzlab.io.local/kubesphere/kube-state-metrics:v2.6.0<br>docker push easzlab.io.local/kubesphere/kube-state-metrics:v2.6.0<br>docker tag easzlab.io.local/library/kube-rbac-proxy:v0.11.0 easzlab.io.local/kubesphere/kube-rbac-proxy:v0.11.0<br>docker push easzlab.io.local/kubesphere/kube-rbac-proxy:v0.11.0<br>docker tag easzlab.io.local/library/node-exporter:v1.3.1 easzlab.io.local/prom/node-exporter:v1.3.1<br>docker push easzlab.io.local/prom/node-exporter:v1.3.1<br>docker tag easzlab.io.local/library/ks-apiserver:v3.4.1 easzlab.io.local/kubesphere/ks-apiserver:v3.4.1<br>docker push easzlab.io.local/kubesphere/ks-apiserver:v3.4.1<br>docker tag easzlab.io.local/library/ks-controller-manager:v3.4.1 easzlab.io.local/kubesphere/ks-controller-manager:v3.4.1<br>docker push easzlab.io.local/kubesphere/ks-controller-manager:v3.4.1<br>docker tag easzlab.io.local/library/prometheus-operator:v0.55.1 easzlab.io.local/kubesphere/prometheus-operator:v0.55.1<br>docker push easzlab.io.local/kubesphere/prometheus-operator:v0.55.1<br>docker tag easzlab.io.local/library/kubectl:v1.22.0 easzlab.io.local/kubesphere/kubectl:v1.22.0<br>docker push easzlab.io.local/kubesphere/kubectl:v1.22.0<br>docker tag easzlab.io.local/library/alertmanager:v0.23.0 easzlab.io.local/prom/alertmanager:v0.23.0<br>docker push easzlab.io.local/prom/alertmanager:v0.23.0<br>docker tag easzlab.io.local/library/prometheus-config-reloader:v0.55.1 easzlab.io.local/kubesphere/prometheus-config-reloader:v0.55.1<br>docker push easzlab.io.local/kubesphere/prometheus-config-reloader:v0.55.1<br>docker tag easzlab.io.local/library/prometheus:v2.39.1 easzlab.io.local/prom/prometheus:v2.39.1<br>docker push easzlab.io.local/prom/prometheus:v2.39.1<br>docker tag easzlab.io.local/library/notification-manager-operator:v2.3.0 easzlab.io.local/kubesphere/notification-manager-operator:v2.3.0<br>docker push easzlab.io.local/kubesphere/notification-manager-operator:v2.3.0<br>docker tag easzlab.io.local/library/notification-manager:v2.3.0 easzlab.io.local/kubesphere/notification-manager:v2.3.0<br>docker push easzlab.io.local/kubesphere/notification-manager:v2.3.0<br>docker tag easzlab.io.local/library/notification-tenant-sidecar:v3.2.0 easzlab.io.local/kubesphere/notification-tenant-sidecar:v3.2.0<br>docker push easzlab.io.local/kubesphere/notification-tenant-sidecar:v3.2.0<br><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰§è¡Œpush-image-to-easzlab.io.local.sh æ–‡ä»¶</span><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341# bash push-image-to-easzlab.io.local.sh<br></code></pre></td></tr></table></figure><h4 id="2-2-6-9-æ‰§è¡Œå®‰è£…kubesphere"><a href="#2-2-6-9-æ‰§è¡Œå®‰è£…kubesphere" class="headerlink" title="2.2.6.9 æ‰§è¡Œå®‰è£…kubesphere"></a>2.2.6.9 æ‰§è¡Œå®‰è£…kubesphere</h4><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤éƒ¨ç½² KubeSphereï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åº”ç”¨ä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶ï¼Œä»¥å®‰è£…kubesphere</span><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341# kubectl apply -f kubesphere-installer.yaml <br>customresourcedefinition.apiextensions.k8s.io/clusterconfigurations.installer.kubesphere.io created<br>namespace/kubesphere-system created<br>serviceaccount/ks-installer created<br>clusterrole.rbac.authorization.k8s.io/ks-installer created<br>clusterrolebinding.rbac.authorization.k8s.io/ks-installer created<br>deployment.apps/ks-installer created<br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341# kubectl apply -f cluster-configuration.yaml <br>clusterconfiguration.installer.kubesphere.io/ks-installer created<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹å®‰è£…è¿›åº¦ä¸æ—¥å¿—</span><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341# kubectl -n kubesphere-system logs ks-installer-64c97c9dc5-nbrlt -f<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç»™k8sé›†ç¾¤çš„æ§åˆ¶å¹³å°èŠ‚ç‚¹æ‰“æ ‡ç­¾</span><br>kubectl label node 10.13.15.61 node-role.kubernetes.io/control-plane=&quot;&quot;<br>kubectl label node 10.13.15.61 node-role.kubernetes.io/master=&quot;&quot;<br>kubectl label node 10.13.15.61 node.kubernetes.io/exclude-from-external-load-balancers=&quot;&quot;<br>kubectl label node 10.13.15.62 node-role.kubernetes.io/control-plane=&quot;&quot;<br>kubectl label node 10.13.15.62 node-role.kubernetes.io/master=&quot;&quot;<br>kubectl label node 10.13.15.62 node.kubernetes.io/exclude-from-external-load-balancers=&quot;&quot;<br>kubectl label node 10.13.15.63 node-role.kubernetes.io/control-plane=&quot;&quot;<br>kubectl label node 10.13.15.63 node-role.kubernetes.io/master=&quot;&quot;<br>kubectl label node 10.13.15.63 node.kubernetes.io/exclude-from-external-load-balancers=&quot;&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹k8sé›†ç¾¤çš„èŠ‚ç‚¹åˆ—è¡¨</span><br>root@k8s03-1:/opt/kubeasz-deployk8s/deploy-kubesphere341# kubectl get nodes<br>NAME          STATUS                     ROLES                  AGE     VERSION<br>10.13.15.61   Ready,SchedulingDisabled   control-plane,master   4d17h   v1.23.17<br>10.13.15.62   Ready,SchedulingDisabled   control-plane,master   4d17h   v1.23.17<br>10.13.15.63   Ready,SchedulingDisabled   control-plane,master   4d17h   v1.23.17<br>10.13.15.64   Ready                      node                   4d17h   v1.23.17<br>10.13.15.65   Ready                      node                   4d17h   v1.23.17<br>10.13.15.66   Ready                      node                   4d17h   v1.23.17<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨vip+30880ç«¯å£ï¼Œå¯ä»¥æ­£å¸¸è®¿é—®kubesphereçš„webç³»ç»Ÿï¼š</p><p><img src="https://s2.loli.net/2024/11/05/cjUZ7E3v8epDVdg.png" alt="image-20241105111401577"></p><h4 id="2-2-6-10-ä»k8sä¸­å¸è½½kubesphere"><a href="#2-2-6-10-ä»k8sä¸­å¸è½½kubesphere" class="headerlink" title="2.2.6.10 ä»k8sä¸­å¸è½½kubesphere"></a>2.2.6.10 ä»k8sä¸­å¸è½½kubesphere</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å‚è€ƒï¼šhttps://kubesphere.io/zh/docs/v3.4/installing-on-kubernetes/uninstall-kubesphere-from-k8s/</span><br><br>wget https://raw.githubusercontent.com/kubesphere/ks-installer/release-3.1/scripts/kubesphere-delete.sh<br>bash kubesphere-delete.sh<br></code></pre></td></tr></table></figure><h2 id="2-3-åˆ é™¤èŠ‚ç‚¹"><a href="#2-3-åˆ é™¤èŠ‚ç‚¹" class="headerlink" title="2.3 åˆ é™¤èŠ‚ç‚¹"></a>2.3 åˆ é™¤èŠ‚ç‚¹</h2><p>å‚è€ƒï¼š<a href="https://github.com/easzlab/kubeasz/blob/3.2.0/docs/op/op-node.md">https://github.com/easzlab/kubeasz/blob/3.2.0/docs/op/op-node.md</a></p><p>åˆ é™¤ node èŠ‚ç‚¹æµç¨‹ï¼š(å‚è€ƒezctl é‡Œé¢del-nodeå‡½æ•° å’Œ playbooks&#x2F;32.delnode.yml)</p><ul><li>æ£€æµ‹æ˜¯å¦å¯ä»¥åˆ é™¤</li><li>è¿ç§»èŠ‚ç‚¹ä¸Šçš„ pod</li><li>åˆ é™¤ node ç›¸å…³æœåŠ¡åŠæ–‡ä»¶</li><li>ä»é›†ç¾¤åˆ é™¤ node</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ é™¤èŠ‚ç‚¹å‰</span><br>k8s03-1:~# kubectl get nodes<br>NAME          STATUS                     ROLES    AGE     VERSION<br>10.13.15.61   Ready,SchedulingDisabled   master   3h23m   v1.23.17<br>10.13.15.62   Ready,SchedulingDisabled   master   3h23m   v1.23.17<br>10.13.15.63   Ready,SchedulingDisabled   master   3h23m   v1.23.17<br>10.13.15.64   Ready                      node     3h7m    v1.23.17<br>10.13.15.65   Ready                      node     3h7m    v1.23.17<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ é™¤èŠ‚ç‚¹ï¼ˆä¸€æ¬¡åªèƒ½åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ï¼Œå®ƒçš„IPæ˜¯10.13.15.65</span><br>k8s03-1:~# ezctl del-node k8s03 10.13.15.65    # å‡è®¾å¾…åˆ é™¤èŠ‚ç‚¹ä¸º 10.13.15.65<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ é™¤èŠ‚ç‚¹æˆåŠŸå</span><br>k8s03-1:~# kubectl get nodes               <br>NAME          STATUS                     ROLES    AGE     VERSION<br>10.13.15.61   Ready,SchedulingDisabled   master   3h25m   v1.23.17<br>10.13.15.62   Ready,SchedulingDisabled   master   3h25m   v1.23.17<br>10.13.15.63   Ready,SchedulingDisabled   master   3h25m   v1.23.17<br>10.13.15.64   Ready                      node     3h9m    v1.23.17<br></code></pre></td></tr></table></figure><h2 id="2-4-æ·»åŠ èŠ‚ç‚¹"><a href="#2-4-æ·»åŠ èŠ‚ç‚¹" class="headerlink" title="2.4 æ·»åŠ èŠ‚ç‚¹"></a>2.4 æ·»åŠ èŠ‚ç‚¹</h2><p>æ–°å¢<code>kube_node</code>èŠ‚ç‚¹å¤§è‡´æµç¨‹ä¸ºï¼š(å‚è€ƒezctl é‡Œé¢add-nodeå‡½æ•° å’Œ playbooks&#x2F;22.addnode.yml)</p><ul><li>[å¯é€‰]æ–°èŠ‚ç‚¹å®‰è£… chrony æ—¶é—´åŒæ­¥</li><li>æ–°èŠ‚ç‚¹é¢„å¤„ç† prepare</li><li>æ–°èŠ‚ç‚¹å®‰è£… docker æœåŠ¡</li><li>æ–°èŠ‚ç‚¹å®‰è£… kube_node æœåŠ¡</li><li>æ–°èŠ‚ç‚¹å®‰è£…ç½‘ç»œæ’ä»¶ç›¸å…³</li></ul><p><strong>æ“ä½œæ­¥éª¤</strong>ï¼š</p><p><em><strong>é¦–å…ˆé…ç½® ssh å…å¯†ç ç™»å½•æ–°å¢èŠ‚ç‚¹</strong></em>ï¼Œç„¶åæ‰§è¡Œ (å‡è®¾k8sé›†ç¾¤åä¸º k8s03ï¼Œå¾…å¢åŠ èŠ‚ç‚¹ä¸º 10.13.15.66ã€å®ƒçš„IPåŒæ—¶ä¹Ÿæ˜¯å…¶èŠ‚ç‚¹å)ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸€æ¬¡åªèƒ½æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆæ·»åŠ k8sèŠ‚ç‚¹å‰è®°å¾—é…ç½®sshå…å¯†ç™»å½•ï¼‰</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">ezctl add-node k8s03 10.13.15.66</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è¦æ·»åŠ å¤šä¸ªèŠ‚ç‚¹ï¼Œå°±æ‰§è¡Œæ·»åŠ èŠ‚ç‚¹å‘½ä»¤å¤šæ¬¡</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯èƒ½éœ€è¦åœ¨æ–°èŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼š<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;10.13.15.61    easzlab.io.local&quot;</span> &gt;&gt; /etc/hosts</span><br></code></pre></td></tr></table></figure><p><strong>éªŒè¯</strong>ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">éªŒè¯æ–°èŠ‚ç‚¹çŠ¶æ€</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">kubectl get node</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">éªŒè¯æ–°èŠ‚ç‚¹çš„ç½‘ç»œæ’ä»¶calico æˆ–flannel çš„Pod çŠ¶æ€</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">kubectl get pod -n kube-system -o wide</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">éªŒè¯æ–°å»ºpodèƒ½å¦è°ƒåº¦åˆ°æ–°èŠ‚ç‚¹ï¼Œç•¥</span><br></code></pre></td></tr></table></figure><h2 id="2-5-å¸è½½é›†ç¾¤"><a href="#2-5-å¸è½½é›†ç¾¤" class="headerlink" title="2.5 å¸è½½é›†ç¾¤"></a>2.5 å¸è½½é›†ç¾¤</h2><p>åœ¨å®¿ä¸»æœºä¸Šï¼ŒæŒ‰ç…§å¦‚ä¸‹æ­¥éª¤æ¸…ç†</p><ul><li>æ¸…ç†é›†ç¾¤ <code>docker exec -it kubeasz ezctl destroy &lt;é›†ç¾¤åç§°&gt;</code></li><li>é‡å¯èŠ‚ç‚¹ï¼Œä»¥ç¡®ä¿æ¸…ç†æ®‹ç•™çš„è™šæ‹Ÿç½‘å¡ã€è·¯ç”±ç­‰ä¿¡æ¯</li></ul><p><strong>æ“ä½œæ­¥éª¤ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">k8s03-1:/# ezctl destroy k8s03<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç„¶åé‡å¯æ‰€æœ‰k8sèŠ‚ç‚¹</span><br></code></pre></td></tr></table></figure><h2 id="2-6-æŠ¥é”™ä¸å¤„ç†"><a href="#2-6-æŠ¥é”™ä¸å¤„ç†" class="headerlink" title="2.6 æŠ¥é”™ä¸å¤„ç†"></a>2.6 æŠ¥é”™ä¸å¤„ç†</h2><h3 id="2-6-1-æ·»åŠ èŠ‚ç‚¹æ—¶â€œTASK-kube-node-è½®è¯¢ç­‰å¾…kubeletå¯åŠ¨-â€æ‰§è¡Œå¤±è´¥"><a href="#2-6-1-æ·»åŠ èŠ‚ç‚¹æ—¶â€œTASK-kube-node-è½®è¯¢ç­‰å¾…kubeletå¯åŠ¨-â€æ‰§è¡Œå¤±è´¥" class="headerlink" title="2.6.1 æ·»åŠ èŠ‚ç‚¹æ—¶â€œTASK [kube-node : è½®è¯¢ç­‰å¾…kubeletå¯åŠ¨]â€æ‰§è¡Œå¤±è´¥"></a>2.6.1 æ·»åŠ èŠ‚ç‚¹æ—¶â€œTASK [kube-node : è½®è¯¢ç­‰å¾…kubeletå¯åŠ¨]â€æ‰§è¡Œå¤±è´¥</h3><p><img src="https://s2.loli.net/2025/01/16/3HMXsCEwkSGOerm.png" alt="image-20250116143621421"></p><p><strong>é—®é¢˜å®šä½ï¼š</strong></p><p>t1-gpuèŠ‚ç‚¹çš„ipæ˜¯10.12.62.25ï¼ŒæŸ¥çœ‹å…¶ä¸ŠkubeletæœåŠ¡æœ‰å¦‚ä¸‹æŠ¥é”™ä¿¡æ¯ï¼š</p><p><img src="https://s2.loli.net/2025/01/16/sbqv1Z24eEdfKmn.png" alt="image-20250116143749619"></p><p>å¯çŸ¥ï¼Œä½¿ç”¨kubeaszéƒ¨ç½²k8sæ—¶ï¼Œå®‰è£…çš„kubeletä½¿ç”¨çš„ cgroup driveræ˜¯â€systemdâ€ï¼Œä½†t1-gpuä¸Šç°æœ‰docker cgroup driver ä½¿ç”¨cgroupfsï¼Œä¿®æ”¹t1-gpuä¸Šwget r docker cgroup driver ä¸ºsystemdå³å¯ã€‚</p><p><strong>å¤„ç†åŠæ³•ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨t1-gpuæœåŠ¡å™¨çš„/etc/docker/daemon.jsonæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹</span><br>root@t1-gpu:~# vi /etc/docker/daemon.json <br>&#123;<br>    &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],<br>    ...<br>&#125;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é‡å¯t1-gpuæœåŠ¡å™¨çš„dockeræœåŠ¡</span><br>root@t1-gpu:~# systemctl daemon-reload &amp;&amp; systemctl restart docker<br><br>root@t1-gpu:~# docker info | grep &quot;Cgroup Driver&quot;<br> Cgroup Driver: systemd<br><span class="hljs-meta prompt_"> </span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç„¶ååœ¨éƒ¨ç½²èŠ‚ç‚¹å†æ¬¡å°è¯•æ·»åŠ k8sèŠ‚ç‚¹</span><br></code></pre></td></tr></table></figure><h3 id="2-6-2-æ·»åŠ k8sèŠ‚ç‚¹æ—¶å¤±è´¥å†æ¬¡æ·»åŠ æ­¤èŠ‚ç‚¹æ—¶æç¤ºnodeå·²åœ¨hostsæ–‡ä»¶ä¸­"><a href="#2-6-2-æ·»åŠ k8sèŠ‚ç‚¹æ—¶å¤±è´¥å†æ¬¡æ·»åŠ æ­¤èŠ‚ç‚¹æ—¶æç¤ºnodeå·²åœ¨hostsæ–‡ä»¶ä¸­" class="headerlink" title="2.6.2 æ·»åŠ k8sèŠ‚ç‚¹æ—¶å¤±è´¥å†æ¬¡æ·»åŠ æ­¤èŠ‚ç‚¹æ—¶æç¤ºnodeå·²åœ¨hostsæ–‡ä»¶ä¸­"></a>2.6.2 æ·»åŠ k8sèŠ‚ç‚¹æ—¶å¤±è´¥å†æ¬¡æ·»åŠ æ­¤èŠ‚ç‚¹æ—¶æç¤ºnodeå·²åœ¨hostsæ–‡ä»¶ä¸­</h3><p><img src="https://s2.loli.net/2025/01/16/ilxqfoKnpQC6S32.png" alt="image-20250116144450943"></p><p>å¤„ç†åŠæ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨éƒ¨ç½²èŠ‚ç‚¹ä¿®æ”¹/etc/kubeasz/clusters/é›†ç¾¤å/hosts</span><br>root@controller01:/etc/kubeasz# vi /etc/kubeasz/clusters/cluster01/hosts<br>...<br><span class="hljs-meta prompt_"># </span><span class="language-bash">work node(s)</span><br>[kube_node]<br>10.12.62.25     #å°†æ­¤è¡Œå†…å®¹åˆ é™¤<br><span class="hljs-meta prompt_">#</span><span class="language-bash">192.168.1.3</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">192.168.1.4</span><br>172.20.0.21<br>...<br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨éƒ¨ç½²èŠ‚ç‚¹å†æ¬¡å°è¯•æ·»åŠ k8sèŠ‚ç‚¹</p>]]></content>
    
    
    <categories>
      
      <category>k8säº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kubeasz k8såœ¨çº¿éƒ¨ç½² äºŒè¿›åˆ¶ é«˜å¯ç”¨ kubesphere harbor k8sæ‰©å®¹ k8sç¼©å®¹ k8så¸è½½</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>k8såœ¨çº¿éƒ¨ç½²-ä½¿ç”¨kubeaszéƒ¨ç½²amd64å•æœºç‰ˆk8s1-26-0</title>
    <link href="/2024/11/28/k8s%E5%9C%A8%E7%BA%BF%E9%83%A8%E7%BD%B2-%E4%BD%BF%E7%94%A8kubeasz%E9%83%A8%E7%BD%B2amd64%E5%8D%95%E6%9C%BA%E7%89%88k8s1-26-0/"/>
    <url>/2024/11/28/k8s%E5%9C%A8%E7%BA%BF%E9%83%A8%E7%BD%B2-%E4%BD%BF%E7%94%A8kubeasz%E9%83%A8%E7%BD%B2amd64%E5%8D%95%E6%9C%BA%E7%89%88k8s1-26-0/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€å•æœºå¿«é€Ÿéƒ¨ç½²-AllinOneéƒ¨ç½²"><a href="#ä¸€ã€å•æœºå¿«é€Ÿéƒ¨ç½²-AllinOneéƒ¨ç½²" class="headerlink" title="ä¸€ã€å•æœºå¿«é€Ÿéƒ¨ç½²-AllinOneéƒ¨ç½²"></a>ä¸€ã€å•æœºå¿«é€Ÿéƒ¨ç½²-AllinOneéƒ¨ç½²</h1><p>â€‹kubeasz è‡´åŠ›äºæä¾›å¿«é€Ÿéƒ¨ç½²é«˜å¯ç”¨k8sé›†ç¾¤çš„å·¥å…·, åŒæ—¶ä¹ŸåŠªåŠ›æˆä¸ºk8så®è·µã€ä½¿ç”¨çš„å‚è€ƒä¹¦ï¼›åŸºäºäºŒè¿›åˆ¶æ–¹å¼éƒ¨ç½²å’Œåˆ©ç”¨ansible-playbookå®ç°è‡ªåŠ¨åŒ–ï¼›æ—¢æä¾›ä¸€é”®å®‰è£…è„šæœ¬, ä¹Ÿå¯ä»¥æ ¹æ®å®‰è£…æŒ‡å—åˆ†æ­¥æ‰§è¡Œå®‰è£…å„ä¸ªç»„ä»¶ã€‚kubeasz ä»æ¯ä¸€ä¸ªå•ç‹¬éƒ¨ä»¶ç»„è£…åˆ°å®Œæ•´çš„é›†ç¾¤ï¼Œæä¾›æœ€çµæ´»çš„é…ç½®èƒ½åŠ›ï¼Œå‡ ä¹å¯ä»¥è®¾ç½®ä»»ä½•ç»„ä»¶çš„ä»»ä½•å‚æ•°ï¼›åŒæ—¶åˆä¸ºé›†ç¾¤åˆ›å»ºé¢„ç½®ä¸€å¥—è¿è¡Œè‰¯å¥½çš„é»˜è®¤é…ç½®ï¼Œç”šè‡³è‡ªåŠ¨åŒ–åˆ›å»ºé€‚åˆå¤§è§„æ¨¡é›†ç¾¤çš„BGP Route Reflectorç½‘ç»œæ¨¡å¼ã€‚</p><p>â€‹kubeaszæ”¯æŒå¤šä¸ªä¸åŒçš„k8sç‰ˆæœ¬ï¼Œå¤§è‡´å¦‚ä¸‹ï¼Œå…·ä½“æ”¯æŒç»†èŠ‚è¯·æŸ¥çœ‹å®˜ç½‘ã€‚å¦‚æœä¸ä½¿ç”¨åŒ¹é…çš„kubeaszéƒ¨ç½²k8så¯èƒ½ä¼šæŠ¥é”™ï¼Œéœ€è¦è‡ªå·±è§£å†³ï¼Œæ‰€ä»¥å»ºè®®è¿˜æ˜¯æŒ‰ç…§å¦‚ä¸‹è¡¨æ ¼ä½¿ç”¨kubeaszã€‚</p><table><thead><tr><th>Kubernetes</th><th>1.22</th><th>1.23</th><th>1.24</th><th>1.25</th><th>1.26</th><th>1.27</th><th>1.28</th><th>1.29</th><th>1.30</th><th>1.31</th></tr></thead><tbody><tr><td>kubeasz</td><td>3.1.1</td><td>3.2.0</td><td>3.6.2</td><td>3.6.2</td><td>3.6.2</td><td>3.6.2</td><td>3.6.2</td><td>3.6.3</td><td>3.6.4</td><td>3.6.5</td></tr></tbody></table><p>â€‹kubeaszå®ƒæ”¯æŒamd64ä¸arm64ä¸¤ç§ä¸åŒçš„æœåŠ¡å™¨æ„æ¶å¹³å°ã€‚æ”¯æŒç”¨æ¥éƒ¨ç½²å¸¸ç”¨æ’ä»¶ï¼šDNS dashboard metrics-server prometheus efkï¼Œä¹Ÿæ”¯æŒç”¨æ¥å¸¸è§å‘¨è¾¹ç”Ÿæ€ï¼šharbor helm jenkins gitlab argocd ã€‚å¦‚æœå®˜ç½‘ç°æœ‰åŠŸèƒ½ä¸èƒ½æ»¡è¶³è‡ªå·±çš„éœ€æ±‚ï¼Œè¿˜å¯ä»¥è‡ªå·±ç»§ç»­ç¼–å†™playbookè¿›ä¸€æ­¥ä¸°å¯Œkubeaszã€‚</p><p>â€‹kubeaszä¸åƒé’äº‘çš„kubekeyå·¥å…·æ˜¯å¯¹kubeadmå·¥å…·çš„å°è£…ï¼Œkubeaszæ˜¯ä½¿ç”¨äºŒè¿›åˆ¶æ–¹å¼çš„éƒ¨ç½²å½¢å¼ï¼Œæ‰€ä»¥ç›¸å…³k8sæœåŠ¡éƒ½æ˜¯ä»¥æ“ä½œç³»ç»ŸæœåŠ¡çš„å½¢å¼éƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸Šï¼Œä½†éƒ¨ç½²æœåŠ¡å¦‚ç½‘ç»œè§£å†³æ–¹æ¡ˆã€dashboardç­‰æ˜¯ä»¥å®¹å™¨å½¢å¼éƒ¨ç½²çš„ã€‚</p><h2 id="1-1-å®‰è£…æ­¥éª¤"><a href="#1-1-å®‰è£…æ­¥éª¤" class="headerlink" title="1.1 å®‰è£…æ­¥éª¤"></a>1.1 å®‰è£…æ­¥éª¤</h2><h3 id="1-1-1-åŸºç¡€ç³»ç»Ÿé…ç½®"><a href="#1-1-1-åŸºç¡€ç³»ç»Ÿé…ç½®" class="headerlink" title="1.1.1 åŸºç¡€ç³»ç»Ÿé…ç½®"></a>1.1.1 åŸºç¡€ç³»ç»Ÿé…ç½®</h3><ul><li>å‡†å¤‡ä¸€å°è™šæœºé…ç½®å†…å­˜2G&#x2F;ç¡¬ç›˜30Gä»¥ä¸Š</li><li>æœ€å°åŒ–å®‰è£…<code>Ubuntu 16.04+ serveræˆ–è€…CentOS 7+ Minimal</code></li><li>é…ç½®åŸºç¡€ç½‘ç»œã€æ›´æ–°æºã€SSHç™»å½•ç­‰</li></ul><p><strong>æ³¨æ„:</strong> ç¡®ä¿åœ¨å¹²å‡€çš„ç³»ç»Ÿä¸Šå¼€å§‹å®‰è£…ï¼Œä¸èƒ½ä½¿ç”¨æ›¾ç»è£…è¿‡kubeadmæˆ–å…¶ä»–k8så‘è¡Œç‰ˆçš„ç¯å¢ƒ</p><table><thead><tr><th>ä¸»æœºå</th><th>IP</th><th>rootå¯†ç </th><th>è§„æ ¼</th><th>ç£ç›˜</th><th>æ“ä½œç³»ç»Ÿ</th></tr></thead><tbody><tr><td>k8s03-1</td><td>10.13.15.61</td><td>cloud@2020</td><td>8c16g</td><td>400G</td><td>Ubuntu20.04.3 LTS-amd64</td></tr></tbody></table><h3 id="1-1-2-ä¸‹è½½æ–‡ä»¶"><a href="#1-1-2-ä¸‹è½½æ–‡ä»¶" class="headerlink" title="1.1.2 ä¸‹è½½æ–‡ä»¶"></a>1.1.2 ä¸‹è½½æ–‡ä»¶</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å‚è€ƒæ–‡æ¡£ï¼šhttps://github.com/easzlab/kubeasz/blob/3.5.3/docs/setup/quickStart.md</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä»¥ä¸‹æ–‡æ¡£ç¤ºä¾‹ï¼Œä½¿ç”¨kubeasz3.5.0éƒ¨ç½²k8s1.26.0ï¼Œk8sç¯å¢ƒä½¿ç”¨çš„é»˜è®¤å®¹å™¨è¿è¡Œæ—¶æ˜¯containerd</span><br>root@k8s03-1:~# mkdir -p /opt/kubeasz-deployk8s<br>root@k8s03-1:~# cd /opt/kubeasz-deployk8s<br>root@k8s03-1:/opt/kubeasz-deployk8s# export release=3.5.0<br>root@k8s03-1:/opt/kubeasz-deployk8s# wget https://github.com/easzlab/kubeasz/releases/download/$&#123;release&#125;/ezdown<br>root@k8s03-1:/opt/kubeasz-deployk8s# chmod +x ./ezdown<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ezdownå…¶å®å°±æ˜¯ä¸€ä¸ªshellè„šæœ¬æ–‡ä»¶ï¼Œå¯ä»¥ä¿®æ”¹æ­¤æ–‡ä»¶å†…å®¹ï¼Œæ¯”å¦‚ä¿®æ”¹å…¶ä¸­å¯¹/etc/docker/daemon.jsonæ–‡ä»¶å†…å®¹çš„å®šåˆ¶</span><br>root@k8s03-1:/opt/kubeasz-deployk8s# vi ezdown<br>...<br><span class="hljs-meta prompt_">  # </span><span class="language-bash">configuration <span class="hljs-keyword">for</span> dockerd</span><br>  mkdir -p /etc/docker<br>  DOCKER_VER_MAIN=$(echo &quot;$DOCKER_VER&quot;|cut -d. -f1)<br>  CGROUP_DRIVER=&quot;cgroupfs&quot;<br><span class="hljs-meta prompt_">  ((DOCKER_VER_MAIN&gt;</span><span class="language-bash">=20)) &amp;&amp; CGROUP_DRIVER=<span class="hljs-string">&quot;systemd&quot;</span></span><br>  logger debug &quot;generate docker config: /etc/docker/daemon.json&quot;<br>  if [[ &quot;$REGISTRY_MIRROR&quot; == CN ]];then<br>    logger debug &quot;prepare register mirror for $REGISTRY_MIRROR&quot;<br>    cat &gt; /etc/docker/daemon.json &lt;&lt; EOF<br>&#123;<br>  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=$CGROUP_DRIVER&quot;],<br>  &quot;registry-mirrors&quot;: [<br>    &quot;https://docker.mirrors.ustc.edu.cn&quot;,<br>    &quot;http://hub-mirror.c.163.com&quot;<br>  ],<br>  &quot;max-concurrent-downloads&quot;: 10,<br>  &quot;log-driver&quot;: &quot;json-file&quot;,<br>  &quot;log-level&quot;: &quot;warn&quot;,<br>  &quot;log-opts&quot;: &#123;<br>    &quot;max-size&quot;: &quot;10m&quot;,<br>    &quot;max-file&quot;: &quot;3&quot;<br>    &#125;,<br>  &quot;data-root&quot;: &quot;/var/lib/docker&quot;<br>&#125;<br>EOF<br>...<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹è½½kubeaszä»£ç ã€äºŒè¿›åˆ¶ã€é»˜è®¤å®¹å™¨é•œåƒ</span><br>root@k8s03-1:/opt/kubeasz-deployk8s# ./ezdown -D -m &quot;CN&quot;<br>...<br>Digest: sha256:6ef53c7bd8b73841c5e10698d21f5616c3c2f329afeca7f342d7471cae6af310<br>Status: Image is up to date for easzlab/kubeasz:3.5.0<br>docker.io/easzlab/kubeasz:3.5.0<br>2024-10-10 16:45:35 INFO Action successed: download_all<br><br>root@k8s03-1:/opt/kubeasz-deployk8s# ./ezdown -S<br>2024-10-10 16:49:12 INFO Action begin: start_kubeasz_docker<br>2024-10-10 16:49:12 INFO try to run kubeasz in a container<br>2024-10-10 16:49:12 DEBUG get host IP: 10.13.15.61<br>2024-10-10 16:49:12 DEBUG generate ssh key pair<br><span class="hljs-meta prompt_"># </span><span class="language-bash">10.13.15.61:22 SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.11</span><br>2024-10-10 16:49:12 DEBUG create a soft link &#x27;/usr/bin/python&#x27;<br>a9db032e35a0a43f6d5bdf293feef657a4b6b92cb8d1e1786398ec5ea8f3505d<br>2024-10-10 16:49:13 INFO Action successed: start_kubeasz_docker<br></code></pre></td></tr></table></figure><h3 id="1-1-3-å®‰è£…é›†ç¾¤"><a href="#1-1-3-å®‰è£…é›†ç¾¤" class="headerlink" title="1.1.3 å®‰è£…é›†ç¾¤"></a>1.1.3 å®‰è£…é›†ç¾¤</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å®¹å™¨åŒ–è¿è¡Œ kubeasz</span><br>root@k8s03-1:/opt/kubeasz-deployk8s# ./ezdown -S<br>2024-10-10 16:49:12 INFO Action begin: start_kubeasz_docker<br>2024-10-10 16:49:12 INFO try to run kubeasz in a container<br>2024-10-10 16:49:12 DEBUG get host IP: 10.13.15.61<br>2024-10-10 16:49:12 DEBUG generate ssh key pair<br><span class="hljs-meta prompt_"># </span><span class="language-bash">10.13.15.61:22 SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.11</span><br>2024-10-10 16:49:12 DEBUG create a soft link &#x27;/usr/bin/python&#x27;<br>a9db032e35a0a43f6d5bdf293feef657a4b6b92cb8d1e1786398ec5ea8f3505d<br>2024-10-10 16:49:13 INFO Action successed: start_kubeasz_docker<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹å·²åˆ›å»ºå®¹å™¨</span><br>root@k8s03-1:/opt/kubeasz-deployk8s# docker ps -a<br>CONTAINER ID   IMAGE                   COMMAND                  CREATED          STATUS          PORTS     NAMES<br>a9db032e35a0   easzlab/kubeasz:3.5.0   &quot;sleep 36000&quot;            4 minutes ago    Up 4 minutes              kubeasz<br>7feaec7a91fc   registry:2              &quot;/entrypoint.sh /etcâ€¦&quot;   27 minutes ago   Up 27 minutes             local_registry<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨é»˜è®¤é…ç½®å®‰è£… aio é›†ç¾¤ï¼ˆéƒ¨ç½²å•èŠ‚ç‚¹k8sç¯å¢ƒï¼Œå¤§æ¦‚èŠ±è´¹5minï¼‰</span><br>root@k8s03-1:/opt/kubeasz-deployk8s# docker exec -it kubeasz ezctl start-aio<br>PLAY RECAP ********************************************************************************************************************<br>10.13.15.61                : ok=110  changed=101  unreachable=0    failed=0    skipped=188  rescued=0    ignored=0   <br>localhost                  : ok=43   changed=40   unreachable=0    failed=0    skipped=42   rescued=0    ignored=0   <br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¦‚æœå®‰è£…å¤±è´¥ï¼ŒæŸ¥çœ‹æ—¥å¿—æ’é™¤åï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤é‡æ–°å®‰è£…aioé›†ç¾¤</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">docker <span class="hljs-built_in">exec</span> -it kubeasz ezctl setup default all</span><br><br></code></pre></td></tr></table></figure><h3 id="1-1-4-éªŒè¯å®‰è£…"><a href="#1-1-4-éªŒè¯å®‰è£…" class="headerlink" title="1.1.4 éªŒè¯å®‰è£…"></a>1.1.4 éªŒè¯å®‰è£…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@k8s03-1:/opt/kubeasz-deployk8s# source ~/.bashrc<br>root@k8s03-1:/opt/kubeasz-deployk8s# kubectl version         # éªŒè¯é›†ç¾¤ç‰ˆæœ¬<br>root@k8s03-1:/opt/kubeasz-deployk8s# kubectl get node        # éªŒè¯èŠ‚ç‚¹å°±ç»ª (Ready) çŠ¶æ€<br>NAME          STATUS   ROLES    AGE     VERSION<br>10.13.15.61   Ready    master   2m38s   v1.26.0<br><br>root@k8s03-1:/opt/kubeasz-deployk8s# kubectl get pod -A      # éªŒè¯é›†ç¾¤podçŠ¶æ€ï¼Œé»˜è®¤å·²å®‰è£…ç½‘ç»œæ’ä»¶ã€corednsã€metrics-serverç­‰<br>NAMESPACE     NAME                                         READY   STATUS    RESTARTS   AGE<br>kube-system   calico-kube-controllers-89b744d6c-csmv5      1/1     Running   0          2m32s<br>kube-system   calico-node-52tdd                            1/1     Running   0          2m32s<br>kube-system   coredns-6665999d97-lcpdr                     1/1     Running   0          2m2s<br>kube-system   dashboard-metrics-scraper-57566685b4-5k8sl   1/1     Running   0          114s<br>kube-system   kubernetes-dashboard-57db9bfd5b-5pqs8        1/1     Running   0          114s<br>kube-system   metrics-server-6bd9f986fc-rqtq7              1/1     Running   0          118s<br>kube-system   node-local-dns-tbzqv                         1/1     Running   0          2m<br><br>root@k8s03-1:/opt/kubeasz-deployk8s# kubectl get svc -A      # éªŒè¯é›†ç¾¤æœåŠ¡çŠ¶æ€<br>NAMESPACE     NAME                        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                  AGE<br>default       kubernetes                  ClusterIP   10.68.0.1       &lt;none&gt;        443/TCP                  3m19s<br>kube-system   dashboard-metrics-scraper   ClusterIP   10.68.149.37    &lt;none&gt;        8000/TCP                 2m<br>kube-system   kube-dns                    ClusterIP   10.68.0.2       &lt;none&gt;        53/UDP,53/TCP,9153/TCP   2m8s<br>kube-system   kube-dns-upstream           ClusterIP   10.68.74.235    &lt;none&gt;        53/UDP,53/TCP            2m6s<br>kube-system   kubernetes-dashboard        NodePort    10.68.224.175   &lt;none&gt;        443:30033/TCP            2m1s<br>kube-system   metrics-server              ClusterIP   10.68.57.219    &lt;none&gt;        443/TCP                  2m5s<br>kube-system   node-local-dns              ClusterIP   None            &lt;none&gt;        9253/TCP                 2m6s<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹æ‰€æœ‰containerdå®¹å™¨</span><br>root@k8s03-1:/opt/kubeasz-deployk8s# crictl ps<br>CONTAINER           IMAGE               CREATED             STATE               NAME                        ATTEMPT             POD ID              POD<br>98f418ea2b5ae       115053965e86b       3 minutes ago       Running             dashboard-metrics-scraper   0                   ca4d7ade6cd66       dashboard-metrics-scraper-57566685b4-5k8sl<br>3f267e5ad38c8       07655ddf2eebe       3 minutes ago       Running             kubernetes-dashboard        0                   ddd9fca9b3fde       kubernetes-dashboard-57db9bfd5b-5pqs8<br>2f980e0974596       f965999d664b1       3 minutes ago       Running             metrics-server              0                   888d8720dc5a8       metrics-server-6bd9f986fc-rqtq7<br>182a39d21a858       7b3b529c5a5ac       3 minutes ago       Running             node-cache                  0                   a8b15ecf9ae75       node-local-dns-tbzqv<br>41f63fb1329d7       5185b96f0becf       3 minutes ago       Running             coredns                     0                   84336de34a8ac       coredns-6665999d97-lcpdr<br>66a0024a1c6e6       b6e6ee0788f20       4 minutes ago       Running             calico-node                 0                   867af30138653       calico-node-52tdd<br>df75b01d5a24b       ea5536b1fa4a8       4 minutes ago       Running             calico-kube-controllers     0                   5eddd6e6e960d       calico-kube-controllers-89b744d6c-csmv5<br></code></pre></td></tr></table></figure><ul><li>ç™»å½• <code>dashboard</code>å¯ä»¥æŸ¥çœ‹å’Œç®¡ç†é›†ç¾¤ï¼Œæ›´å¤šå†…å®¹è¯·æŸ¥é˜…<a href="https://github.com/easzlab/kubeasz/blob/3.5.3/docs/guide/dashboard.md">dashboardæ–‡æ¡£</a></li></ul><p>æ­¤k8sç¯å¢ƒä¸­ï¼Œdashboardçš„è®¿é—®åœ°å€æ˜¯ï¼š<a href="https://10.13.15.61:30033/#/login%EF%BC%8C%E5%85%B6%E4%B8%AD30033%E7%AB%AF%E5%8F%A3%E6%9D%A5%E8%87%AA%E4%B8%8A%E8%BF%B0svc%EF%BC%9Akube-system/kubernetes-dashboard">https://10.13.15.61:30033/#/loginï¼Œå…¶ä¸­30033ç«¯å£æ¥è‡ªä¸Šè¿°svcï¼škube-system/kubernetes-dashboard</a></p><h2 id="1-2-å¸è½½é›†ç¾¤"><a href="#1-2-å¸è½½é›†ç¾¤" class="headerlink" title="1.2 å¸è½½é›†ç¾¤"></a>1.2 å¸è½½é›†ç¾¤</h2><p>åœ¨å®¿ä¸»æœºä¸Šï¼ŒæŒ‰ç…§å¦‚ä¸‹æ­¥éª¤æ¸…ç†</p><ul><li>æ¸…ç†é›†ç¾¤ <code>docker exec -it kubeasz ezctl destroy default</code></li><li>é‡å¯èŠ‚ç‚¹ï¼Œä»¥ç¡®ä¿æ¸…ç†æ®‹ç•™çš„è™šæ‹Ÿç½‘å¡ã€è·¯ç”±ç­‰ä¿¡æ¯</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ¸…ç†é›†ç¾¤</span> <br>root@k8s03-1:/opt/kubeasz-deployk8s# docker exec -it kubeasz ezctl destroy default<br>ansible-playbook -i clusters/default/hosts -e @clusters/default/config.yml playbooks/99.clean.yml<br>2024-10-10 09:31:06 INFO cluster:default destroy begins in 5s, press any key to abort:<br>...<br>TASK [clean : é‡å¯æç¤º WARNNING] ********************************************************************************************************************************<br>ok: [10.13.15.61] =&gt; &#123;<br>    &quot;msg&quot;: &quot;[é‡è¦]: è¯·é‡å¯èŠ‚ç‚¹ä»¥ç¡®ä¿æ¸…é™¤ç³»ç»Ÿæ®‹ç•™çš„è™šæ‹Ÿç½‘å¡ã€è·¯ç”±ä¿¡æ¯ã€iptalbes|ipvsè§„åˆ™ç­‰ [IMPORTANT]: please reboot nodes, makesure to clean out net interfaces, routes and iptables/ipvs rules&quot;<br>&#125;<br><br>PLAY RECAP ********************************************************************************************************************************<br>10.13.15.61                : ok=14   changed=12   unreachable=0    failed=0    skipped=14   rescued=0    ignored=0  <br><br>root@k8s03-1:/opt/kubeasz-deployk8s# reboot<br></code></pre></td></tr></table></figure><h2 id="1-3-é—®é¢˜"><a href="#1-3-é—®é¢˜" class="headerlink" title="1.3 é—®é¢˜"></a>1.3 é—®é¢˜</h2><h3 id="1-3-1-æ‰§è¡Œâ€-ezdown-Dâ€ä¸‹è½½é•œåƒeaszlab-kubeasz-3-5-0å¤±è´¥"><a href="#1-3-1-æ‰§è¡Œâ€-ezdown-Dâ€ä¸‹è½½é•œåƒeaszlab-kubeasz-3-5-0å¤±è´¥" class="headerlink" title="1.3.1 æ‰§è¡Œâ€.&#x2F;ezdown -Dâ€ä¸‹è½½é•œåƒeaszlab&#x2F;kubeasz:3.5.0å¤±è´¥"></a>1.3.1 æ‰§è¡Œâ€.&#x2F;ezdown -Dâ€ä¸‹è½½é•œåƒeaszlab&#x2F;kubeasz:3.5.0å¤±è´¥</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŠ¥é”™å¤§è‡´å¦‚ä¸‹</span><br>Unable to find image &#x27;easzlab/kubeasz:3.5.0&#x27; locally<br>docker: Error response from daemon: Get &quot;https://registry-1.docker.io/v2/&quot;: dial tcp 199.16.158.12:443: i/o timeout.<br>See &#x27;docker run --help&#x27;.<br>2024-10-10 14:08:58 ERROR download failed.<br></code></pre></td></tr></table></figure><h4 id="è§£å†³åŠæ³•1ï¼ˆæ¨èï¼‰ï¼š"><a href="#è§£å†³åŠæ³•1ï¼ˆæ¨èï¼‰ï¼š" class="headerlink" title="è§£å†³åŠæ³•1ï¼ˆæ¨èï¼‰ï¼š"></a>è§£å†³åŠæ³•1ï¼ˆæ¨èï¼‰ï¼š</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ­¤æ–¹æ³•æ˜¯ä¸ºdockerè®¾ç½®å¤šä¸ªé•œåƒç½‘ç«™ï¼Œä»è€Œå¢åŠ æ‹‰å–é•œåƒçš„å¯èƒ½æ€§</span><br>root@k8s03-1:~# cat &gt; /etc/docker/daemon.json &lt;&lt; EOF<br>&#123;<br>  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],<br>  &quot;registry-mirrors&quot;: [<br>    &quot;https://kuamavit.mirror.aliyuncs.com&quot;,<br>    &quot;https://docker.chenby.cn&quot;,<br>    &quot;https://docker.registry.cyou&quot;,<br>    &quot;https://docker-cf.registry.cyou&quot;,<br>    &quot;https://dockercf.jsdelivr.fyi&quot;,<br>    &quot;https://docker.jsdelivr.fyi&quot;,<br>    &quot;https://dockertest.jsdelivr.fyi&quot;,<br>    &quot;https://mirror.aliyuncs.com&quot;,<br>    &quot;https://dockerproxy.com&quot;,<br>    &quot;https://mirror.baidubce.com&quot;,<br>    &quot;https://docker.m.daocloud.io&quot;,<br>    &quot;https://docker.nju.edu.cn&quot;,<br>    &quot;https://docker.mirrors.sjtug.sjtu.edu.cn&quot;,<br>    &quot;https://docker.mirrors.ustc.edu.cn&quot;,<br>    &quot;https://mirror.iscas.ac.cn&quot;,<br>    &quot;https://docker.rainbond.cc&quot;<br>  ],<br>  &quot;insecure-registries&quot;: [<br>    &quot;http://easzlab.io.local:5000&quot;<br>  ],<br>  &quot;max-concurrent-downloads&quot;: 10,<br>  &quot;log-driver&quot;: &quot;json-file&quot;,<br>  &quot;log-level&quot;: &quot;warn&quot;,<br>  &quot;log-opts&quot;: &#123;<br>    &quot;max-size&quot;: &quot;10m&quot;,<br>    &quot;max-file&quot;: &quot;3&quot;<br>    &#125;,<br>  &quot;data-root&quot;: &quot;/var/lib/docker&quot;<br>&#125;<br>EOF<br><br>root@k8s03-1:~# systemctl daemon-reload &amp;&amp; systemctl restart docker<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ­¤å‘½ä»¤è¿è¡Œè¿‡ç¨‹ä¸Šä¼šä¸‹è½½å¤šä¸ªé•œåƒ(kubeasz:3.5.0ï¼Œé»˜è®¤å®‰è£…k8s1.26.0ï¼Œæ­¤æ­¥éª¤å…±ä¸‹è½½13ä¸ªé•œåƒ)ï¼Œéœ€è¦çš„æ‰§è¡Œè¾ƒé•¿ï¼Œæˆ‘æ€»å…±å¤§æ¦‚èŠ±è´¹äº†20åˆ†é’Ÿ</span><br>root@k8s03-1:~# ./ezdown -D<br></code></pre></td></tr></table></figure><h4 id="è§£å†³åŠæ³•2ï¼š"><a href="#è§£å†³åŠæ³•2ï¼š" class="headerlink" title="è§£å†³åŠæ³•2ï¼š"></a>è§£å†³åŠæ³•2ï¼š</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å…ˆåœ¨å…¶ä»–èƒ½ä½¿ç”¨é­”æ³•çš„æœåŠ¡å™¨ä¸Šå°†æ­¤é•œåƒä¸‹è½½ä¸‹æ¥ï¼Œä¸Šä¼ åˆ°è‡ªå·±çš„harborä»“åº“ï¼šdocker push 10.10.10.1:8196/kubeasz/easzlab/kubeasz:3.5.0 ï¼ˆå‡è®¾<span class="hljs-string">&quot;10.10.10.1:8196&quot;</span>è‡ªå·±çš„harboré•œåƒä»“åº“åœ°å€ï¼‰</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç„¶ååœ¨éœ€è¦ä½¿ç”¨ä¸Šè¿°é•œåƒçš„æœåŠ¡å™¨ä¸Šä¸‹è½½è‡ªå·±harborä»“åº“ä¸­çš„é•œåƒï¼Œå†æ‰§è¡Œä¸Šè¿°å‘½ä»¤ä¸€èˆ¬å°±ä¼šæˆåŠŸäº†ã€‚ä»ä½¿ç”¨ç»éªŒæ¥çœ‹ï¼Œå·²æœ‰ç›¸åŒé•œåƒçš„è¯ï¼ˆå³ä½¿å·²ç»è¢«tagæˆä¸åŒçš„é•œåƒåä¸æ ‡ç­¾åï¼‰ï¼Œå†ç›´æ¥ä»docker hubå®˜ç½‘æ‹‰å–æ­¤é•œåƒå¤§æ¦‚ç‡èƒ½æˆåŠŸã€‚</span><br></code></pre></td></tr></table></figure><h4 id="è§£å†³åŠæ³•3ï¼š"><a href="#è§£å†³åŠæ³•3ï¼š" class="headerlink" title="è§£å†³åŠæ³•3ï¼š"></a>è§£å†³åŠæ³•3ï¼š</h4><p>å¦‚æœä¸Šè¿°æ–¹æ³•éƒ½ä¸å‡‘æ•ˆï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹â€œezdownâ€æ–‡ä»¶ï¼Œå®ƒå…¶å®å°±æ˜¯ä¸€ä¸ªshellè„šæœ¬æ–‡ä»¶ã€‚å¯ä»¥ç›´æ¥åœ¨æ­¤æ–‡ä»¶ä¸­ä¿®æ”¹ä¸ºç›´æ¥ä½¿ç”¨è‡ªå·±harboré•œåƒä»“åº“ä¸­çš„é•œåƒã€‚</p>]]></content>
    
    
    <categories>
      
      <category>k8säº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kubeasz åœ¨çº¿éƒ¨ç½² k8s äºŒè¿›åˆ¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ‰‹æœºç«¯ä¸PCç«¯å¾®ä¿¡èŠå¤©è®°å½•æœªåŒæ­¥+å‡è‚¥å¥èº«å…¥é—¨å»ºè®®</title>
    <link href="/2024/11/24/%E6%89%8B%E6%9C%BA%E7%AB%AF%E4%B8%8EPC%E7%AB%AF%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95%E6%9C%AA%E5%90%8C%E6%AD%A5-%E5%87%8F%E8%82%A5%E5%81%A5%E8%BA%AB%E5%85%A5%E9%97%A8%E5%BB%BA%E8%AE%AE/"/>
    <url>/2024/11/24/%E6%89%8B%E6%9C%BA%E7%AB%AF%E4%B8%8EPC%E7%AB%AF%E5%BE%AE%E4%BF%A1%E8%81%8A%E5%A4%A9%E8%AE%B0%E5%BD%95%E6%9C%AA%E5%90%8C%E6%AD%A5-%E5%87%8F%E8%82%A5%E5%81%A5%E8%BA%AB%E5%85%A5%E9%97%A8%E5%BB%BA%E8%AE%AE/</url>
    
    <content type="html"><![CDATA[<p>ç¬”è€…å¼€è®¾æ­¤æœ¬è®¢é˜…å·çš„åŠ¨æœºæ˜¯åˆ†äº«å­¦ä¹ ç¬”è®°ã€å¥èº«ã€æ‘„å½±ä¸ç”Ÿæ´»éšæƒ³ã€‚ä»Šå¤©ä¹Ÿè®°å½•ä¸‹æŠ€æœ¯ä¹‹å¤–çš„ä¸€äº›ä¸œè¥¿ï¼Œå¦‚å¾®ä¿¡ä½¿ç”¨ã€å¥èº«</p><h1 id="ä¸€ã€æ‰‹æœºç«¯ä¸PCç«¯å¾®ä¿¡èŠå¤©è®°å½•åŒæ­¥"><a href="#ä¸€ã€æ‰‹æœºç«¯ä¸PCç«¯å¾®ä¿¡èŠå¤©è®°å½•åŒæ­¥" class="headerlink" title="ä¸€ã€æ‰‹æœºç«¯ä¸PCç«¯å¾®ä¿¡èŠå¤©è®°å½•åŒæ­¥"></a>ä¸€ã€æ‰‹æœºç«¯ä¸PCç«¯å¾®ä¿¡èŠå¤©è®°å½•åŒæ­¥</h1><h2 id="1-1-èƒŒæ™¯"><a href="#1-1-èƒŒæ™¯" class="headerlink" title="1.1 èƒŒæ™¯"></a>1.1 èƒŒæ™¯</h2><p>æœ€è¿‘å‘ç°ï¼Œ2024å¹´11æœˆ22æ—¥ä¸‹åˆPCå…³æœºï¼Œç”µè„‘ç«¯å¾®ä¿¡ä¹Ÿéšä¹‹ä¸‹çº¿ã€‚ä¹‹å11æœˆ22æ—¥ä¸‹åˆåŠæ™šä¸Šã€23æ—¥ä¸Šåˆä½¿ç”¨æ‰‹æœºå¾®ä¿¡åœ¨æŸä¸ªå¾®ä¿¡ç¾¤èŠå¤©ï¼Œ2024å¹´11æœˆ24æ—¥æ‰“å¼€PCé‡æ–°ç™»å½•ç”µè„‘ç«¯å¾®ä¿¡ï¼Œå‘ç°é‚£ä¸ªå¾®ä¿¡ç¾¤çš„å¾®ä¿¡èŠå¤©è®°å½•å¹¶æ²¡æœ‰åœ¨PCç«¯å¾®ä¿¡ä¸ŠåŒæ­¥ã€‚   ä½†å…¶ä»–éƒ¨åˆ†å¾®ä¿¡ç¾¤ä¸ä¸ªäººèŠå¤©è®°å½•åˆåŒæ­¥åˆ°äº†PCç«¯å¾®ä¿¡ä¸Šã€‚  </p><p>ä¹Ÿå°±æ˜¯è¯´PCç«¯å¾®ä¿¡èŠå¤©è®°å½•ä¸æ‰‹æœºç«¯å¾®ä¿¡èŠå¤©è®°å½•åªåŒæ­¥äº†å¤§éƒ¨åˆ†ï¼Œä¸ªåˆ«ç¾¤èŠè®°å½•æ²¡åŒæ­¥ã€‚</p><h2 id="1-2-å¯è¡Œå¤„ç†åŠæ³•"><a href="#1-2-å¯è¡Œå¤„ç†åŠæ³•" class="headerlink" title="1.2 å¯è¡Œå¤„ç†åŠæ³•"></a>1.2 å¯è¡Œå¤„ç†åŠæ³•</h2><h3 id="1-2-1-æ–¹æ³•ä¸€ï¼šå¼ºåˆ¶åŒæ­¥"><a href="#1-2-1-æ–¹æ³•ä¸€ï¼šå¼ºåˆ¶åŒæ­¥" class="headerlink" title="1.2.1 æ–¹æ³•ä¸€ï¼šå¼ºåˆ¶åŒæ­¥"></a>1.2.1 æ–¹æ³•ä¸€ï¼šå¼ºåˆ¶åŒæ­¥</h3><p>ç›®å‰å‘ç°æ­¤æ–¹æ³•æœ€ç®€ä¾¿ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹ã€‚</p><h4 id="1-2-1-1-é€€å‡ºPCç«¯å¾®ä¿¡"><a href="#1-2-1-1-é€€å‡ºPCç«¯å¾®ä¿¡" class="headerlink" title="1.2.1.1 é€€å‡ºPCç«¯å¾®ä¿¡"></a>1.2.1.1 é€€å‡ºPCç«¯å¾®ä¿¡</h4><h4 id="1-2-1-2-åˆ‡æ¢è´¦å·"><a href="#1-2-1-2-åˆ‡æ¢è´¦å·" class="headerlink" title="1.2.1.2 åˆ‡æ¢è´¦å·"></a>1.2.1.2 åˆ‡æ¢è´¦å·</h4><p><img src="https://s2.loli.net/2024/11/24/9i8utQILEX6SwGg.png" alt="image-20241124111725372"></p><h4 id="1-2-1-3-ä½¿ç”¨æ‰‹æœºå¾®ä¿¡æ‰«æ"><a href="#1-2-1-3-ä½¿ç”¨æ‰‹æœºå¾®ä¿¡æ‰«æ" class="headerlink" title="1.2.1.3 ä½¿ç”¨æ‰‹æœºå¾®ä¿¡æ‰«æ"></a>1.2.1.3 ä½¿ç”¨æ‰‹æœºå¾®ä¿¡æ‰«æ</h4><p><img src="https://s2.loli.net/2024/11/24/IvQ3jcefPAidhwZ.png" alt="image-20241124111818073"></p><h4 id="1-2-1-4-é€‰æ‹©â€œåŒæ­¥æœ€è¿‘æ¶ˆæ¯â€"><a href="#1-2-1-4-é€‰æ‹©â€œåŒæ­¥æœ€è¿‘æ¶ˆæ¯â€" class="headerlink" title="1.2.1.4 é€‰æ‹©â€œåŒæ­¥æœ€è¿‘æ¶ˆæ¯â€"></a>1.2.1.4 é€‰æ‹©â€œåŒæ­¥æœ€è¿‘æ¶ˆæ¯â€</h4><p><img src="https://s2.loli.net/2024/11/24/hqsb2oQAXPR9f43.png" alt="image-20241124112017648"></p><h4 id="1-2-1-5-æŸ¥çœ‹PCç«¯çš„èŠå¤©è®°å½•"><a href="#1-2-1-5-æŸ¥çœ‹PCç«¯çš„èŠå¤©è®°å½•" class="headerlink" title="1.2.1.5 æŸ¥çœ‹PCç«¯çš„èŠå¤©è®°å½•"></a>1.2.1.5 æŸ¥çœ‹PCç«¯çš„èŠå¤©è®°å½•</h4><p>å› ä¸ºä¸Šä¸€æ­¥å·²ç»æŒ‡æ˜å°†æ‰‹æœºç«¯å¾®ä¿¡æœ€è¿‘çš„èŠå¤©è®°å½•åŒæ­¥åˆ°PCç«¯å¾®ä¿¡ï¼Œæ‰€ä»¥æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ­¤æ—¶PCç«¯ä¼šåŒæ­¥æ‰‹æœºç«¯å¾®ä¿¡çš„æœ€è¿‘ï¼ˆè¿™ä¸ªæœ€è¿‘å…·ä½“æ˜¯ä»€ä¹ˆæ—¶é—´èŒƒå›´ï¼Œè¿˜ä¸æ¸…æ¥šï¼‰æ‰€æœ‰èŠå¤©è®°å½•ã€‚ç¬”è€…çš„é—®é¢˜æ­¤æ—¶å°±å·²ç»è§£å†³äº†ã€‚</p><h3 id="1-2-2-å…¶ä»–æ–¹æ³•æš‚æ—¶æ²¡ç ”ç©¶"><a href="#1-2-2-å…¶ä»–æ–¹æ³•æš‚æ—¶æ²¡ç ”ç©¶" class="headerlink" title="1.2.2 å…¶ä»–æ–¹æ³•æš‚æ—¶æ²¡ç ”ç©¶"></a>1.2.2 å…¶ä»–æ–¹æ³•æš‚æ—¶æ²¡ç ”ç©¶</h3><p>^_^</p><h1 id="äºŒã€å‡è‚¥å¥èº«å…¥é—¨å»ºè®®"><a href="#äºŒã€å‡è‚¥å¥èº«å…¥é—¨å»ºè®®" class="headerlink" title="äºŒã€å‡è‚¥å¥èº«å…¥é—¨å»ºè®®"></a>äºŒã€å‡è‚¥å¥èº«å…¥é—¨å»ºè®®</h1><p>ä»¥ä¸‹ä¸»è¦æ˜¯ä»¥ç¬”è€…è‡ªå·±çš„å‡è‚¥ä¸å¥èº«ç»éªŒæ¥è¯´ï¼Œç¬”è€…ç›®å‰å¥èº«çš„ä¸»è¦ç›®çš„æ˜¯â€œä¿æŒå½¢ä½“ã€é‡Šæ”¾å‹åŠ›ä¸é”»ç‚¼èº«ä½“â€ï¼Œæ™®é€šçš„å‡è‚¥å¥èº«ã€æš‚æ—¶æ²¡æƒ³å»å‚ä¸å¥èº«å¥ç¾ç±»æ¯”èµ›çš„äººå¯ä»¥å‚è€ƒä¸‹ã€‚æ‰€ä»¥ä¸¥æ ¼ä¸Šæ¥è¯´ï¼Œå°±è°ˆä¸ä¸Šéå¸¸ä¸“ä¸š^_^ã€‚</p><h2 id="2-1-é¥®é£Ÿ"><a href="#2-1-é¥®é£Ÿ" class="headerlink" title="2.1 é¥®é£Ÿ"></a>2.1 é¥®é£Ÿ</h2><ul><li>å°‘åƒæ²¹ç‚¸ã€é«˜è„‚é£Ÿç‰©ï¼Œå¤šåƒé«˜è›‹ç™½ç±»é£Ÿç‰©å¦‚é±¼è‚‰ã€ç‰›è‚‰ã€é¸¡èƒ¸è‚‰ã€è±†ç±»é£Ÿç‰©ã€‚</li><li>æœ‰æ¡ä»¶ä¸æ¯…åŠ›çš„å¯ä»¥ä¸€å‘¨åƒå‡ æ¬¡å‡è„‚é¤ï¼ˆä¸ªäººè§‰å¾—ï¼šä¸€èˆ¬äººä¸€å‘¨å¶å°”åƒå‡ é¤è¾…åŠ©ä¸€ä¸‹ï¼Œé•¿æœŸåƒè¿™ä¸ªè®©äººè§‰å¾—è„±ç¦»äººé—´çƒŸç«ã€‚å¦‚æœä½ æœ‰å¿—å‚è€ƒå¥èº«å¥ç¾æ¯”èµ›ï¼Œé‚£å°±å¦è¯´äº†ï¼‰</li><li>æ—©ä¸Šå¯ä»¥å–ç‰›å¥¶ä¸è±†ç±»åˆ¶å“ä¸é¥®å“ï¼Œå¯ä»¥åƒç‚¹é¸¡è›‹ã€ç´«è–¯ã€åšæœã€å…¨éº¦é¢åŒ…ã€ç²—éº¦ç‰‡ã€‚ä¸­åˆæ­£å¸¸é¥®é£Ÿï¼Œå‡è‚¥å‰æœŸäº”åˆ†é¥±å³å¯ï¼Œç»´æŒæœŸé—´ä¸ƒå…«åˆ†é¥±æœ€å¥½ã€‚æ™šé¤å¯ä»¥åƒç‰ç±³ã€å°‘é‡ç¢³æ°´ç±»é£Ÿç‰©ï¼Œå‡è‚¥æœŸé—´å¯ä»¥åƒç‚¹æ°´æœå¦‚è‹¹æœã€é¦™è•‰ã€ç«é¾™æœæ¥ä»£æ›¿ï¼Œå°‘åƒå¤œå®µã€‚</li><li>æœ‰æ¡ä»¶è‡ªå·±åšé¥­çš„ï¼Œåšèœæ—¶å°‘ç›å°‘æ²¹ï¼Œç¨å¾®æ¸…æ·¡ç‚¹</li><li>å°‘é¥®é…’ï¼Œä¸è®ºæ˜¯å•¤é…’è¿˜æ˜¯ç™½é…’ã€‚çº¢é…’è‡ªå·±æ¥è§¦å¾—å°‘æ‰€ä»¥ä¸æ˜¯å¾ˆäº†è§£ï¼Œæ®è¯´é€‚é‡é¥®ç”¨æœ‰ç›Š</li></ul><h2 id="2-2-å·¥ä½œæœŸé—´çš„ä¹ æƒ¯"><a href="#2-2-å·¥ä½œæœŸé—´çš„ä¹ æƒ¯" class="headerlink" title="2.2 å·¥ä½œæœŸé—´çš„ä¹ æƒ¯"></a>2.2 å·¥ä½œæœŸé—´çš„ä¹ æƒ¯</h2><ul><li>é€‚å½“å¤šå–æ°´</li><li>å¯ä»¥æ¯éš”ä¸€æ®µæ—¶é—´ä»°å¤´ï¼Œæ‹‰ä¼¸é¢ˆéƒ¨ï¼ˆç¬”è€…æ›¾ç»é¢ˆæ¤å‡ºç°ç–¼ç—›ï¼Œæ— æ³•æ­£å¸¸å…¥ç¡ä¸å­¦ä¹ åŠå…¬ï¼Œæœ€ååªèƒ½å»åŒ»é™¢æ‹CTï¼ŒåŒ»ç”Ÿè¯´ç¬”è€…é¢ˆæ¤æ¯”æ­£å¸¸äººé¢ˆæ¤è¦è€10å¤šå¹´ï¼Œå°±æ˜¯æå‰æŸä¼¤äº†ï¼Œæ‰€ä»¥çœŸå¾—è¦æ³¨æ„ä¿æŠ¤é¢ˆæ¤ï¼Œæ²¡æœ‰å¥åº·å…¶ä»–çš„å¦‚è´¢å¯Œã€å®¶åº­ã€æ—…æ¸¸ç­‰éƒ½æ˜¯æµ®äº‘ï¼‰</li><li>é€‚æ—¶ç«™èµ·æ¥èµ°åŠ¨ä¸€ä¸¤åˆ†é’Ÿï¼Œæ‹‰ä¼¸è„Šæ¤</li><li>å¦‚æœå·¥ä½œä¸å¥åº·å†²çªäº†ï¼Œé‚£å°±æš‚åœä¸‹å·¥ä½œï¼Œå‘è‡ªå·±çš„å¥å¥åº·è®©æ­¥</li></ul><h2 id="2-3-å¥èº«"><a href="#2-3-å¥èº«" class="headerlink" title="2.3 å¥èº«"></a>2.3 å¥èº«</h2><ul><li>ç¬”è€…ä¸€èˆ¬æ˜¯æœ‰æ°§è¿åŠ¨ä¸è´Ÿé‡æ— æ°§è¿åŠ¨éƒ½åš</li><li>ä¸€å‘¨è·‘æ­¥ä¸€ä¸¤æ¬¡ï¼Œä¸€æ¬¡5å…¬é‡Œï¼Œä¸€èˆ¬è€—æ—¶30min~35min</li><li>æ¯å‘¨è´Ÿé‡é”»ç‚¼ä¸‰æ¬¡å·¦å³ï¼Œé”»ç‚¼å‰å…ˆæ…¢è·‘10minã€‚è´Ÿé‡é”»ç‚¼å®Œè®°å¾—æ‹‰ä¼¸å½“å¤©é”»ç‚¼çš„éƒ¨ä½</li><li>ç¬”è€…å°†è‡ªå·±çš„é‡é‡é”»ç‚¼åˆ†ä¸ºå‡ ä¸ªéƒ¨ä½ï¼Œè½®æµåå¤è¿›è¡Œï¼šèƒ¸éƒ¨ã€æ‰‹è‡‚ä¸è‚©è†€ã€èƒŒéƒ¨ã€è…¿éƒ¨</li><li>ç¬”è€…ä¸€èˆ¬æ˜¯æ™šä¸Šé”»ç‚¼ï¼Œé”»ç‚¼å‰ä¸€å®šè¦åƒæ™šé¤ä¸”æ™šé¤ä¸€å°æ—¶åå†é”»ç‚¼ã€‚å‘¨æœ«ä¸æ—¶ä¹Ÿä¼šåœ¨ä¸‹åˆè¿›è¡Œé”»ç‚¼ã€‚</li><li>é”»ç‚¼å‰å¯ä»¥å–ç‚¹è‚Œé…¸ã€æ°®æ³µï¼Œå¤§æ¦‚10~20åˆ†é’Ÿå†é”»ç‚¼</li><li>é”»ç‚¼åå›å®¶å°½å¿«å–è›‹ç™½ç²‰ã€‚å…¶ä»–çš„æ°¨åŸºé…¸ç­‰è¡¥ç»™ç¬”è€…æš‚æ—¶è¿˜æ²¡ç”¨è¿‡ï¼Œç­‰å¾…æ¢ç´¢ä¸­</li></ul><h2 id="2-4-å†™åœ¨æœ€å"><a href="#2-4-å†™åœ¨æœ€å" class="headerlink" title="2.4 å†™åœ¨æœ€å"></a>2.4 å†™åœ¨æœ€å</h2><p>ç¬”è€…å»å¹´åœ¨40å¤©å‡é‡20æ–¤ï¼Œè¾¾åˆ°ä¸‹å›¾çŠ¶æ€ï¼Œè®°å½•ä¸€ä¸‹è‡ªå·±å½“æ—¶çš„å¥èº«ç…§ã€‚æ¬¢è¿å¥èº«çˆ±å¥½è€…ä¸€èµ·å­¦ä¹ è®¨è®ºã€‚</p><p><img src="https://s2.loli.net/2024/11/24/lHVsbWzKTPpN2xQ.jpg" alt="ç¬”è€…å¥èº«ç…§"></p>]]></content>
    
    
    <categories>
      
      <category>è¿åŠ¨å¥èº«</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¾®ä¿¡èŠå¤©è®°å½• åŒæ­¥ å‡è‚¥ å¥èº«</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨kubeadmå°†k8sä»1.23.xå‡çº§åˆ°1.24.x</title>
    <link href="/2024/11/18/%E4%BD%BF%E7%94%A8kubeadm%E5%B0%86k8s%E4%BB%8E1-23-x%E5%8D%87%E7%BA%A7%E5%88%B01-24-x/"/>
    <url>/2024/11/18/%E4%BD%BF%E7%94%A8kubeadm%E5%B0%86k8s%E4%BB%8E1-23-x%E5%8D%87%E7%BA%A7%E5%88%B01-24-x/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€èƒŒæ™¯æè¿°"><a href="#ä¸€ã€èƒŒæ™¯æè¿°" class="headerlink" title="ä¸€ã€èƒŒæ™¯æè¿°"></a>ä¸€ã€èƒŒæ™¯æè¿°</h1><p>â€‹ç°æœ‰k8sç¯å¢ƒæ˜¯ä½¿ç”¨kubeadméƒ¨ç½²çš„k8s1.23.9ç¯å¢ƒï¼Œä½¿ç”¨çš„ç½‘ç»œè§£å†³æ–¹æ¡ˆæ˜¯flannelï¼Œk8sèŠ‚ç‚¹ä½¿ç”¨çš„Centos 7.9.2009-amd64 è™šæ‹Ÿæœºï¼Œk8sèŠ‚ç‚¹çš„å®¹å™¨è¿è¡Œæ—¶ä½¿ç”¨æ˜¯çš„Dockerã€‚k8s1.23.9é›†ç¾¤ä¸€å…±æœ‰3ä¸ªèŠ‚ç‚¹ï¼Œè¯¦æƒ…å¦‚ä¸‹ï¼ˆå‡çº§å‰é›†ç¾¤æ˜¯å¦æ­£å¸¸å¯ç”¨çš„ï¼Œå›¾æ˜¯åé¢ä¸´æ—¶æˆªå–çš„ï¼Œæ‰€ä»¥çŠ¶æ€å¯ä»¥å¿½ç•¥ï¼‰ï¼š</p><p><img src="https://s2.loli.net/2024/11/18/RfmFejCV1Y2DB37.png" alt="image-20241118190306646"></p><p>â€‹ç›®çš„æ˜¯åœ¨è”ç½‘çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨kubeadmå‡çº§åˆ°k8s1.24.2ã€‚ä½†Kubernetesä»1.20ç‰ˆæœ¬å¼€å§‹å·²ç»å¼ƒç”¨äº†DockerShimï¼Œå¹¶åœ¨1.24ç‰ˆæœ¬ç§»é™¤äº†DockerShimï¼Œåç»­å¦‚æœéœ€è¦ä½¿ç”¨Dockerä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ï¼ˆContainer Runtimeï¼‰ï¼Œéœ€è¦å®‰è£…cri-dockerï¼Œå³ä¸€ä¸ªCRIï¼ˆContainer Runtime Interfaceï¼‰çš„å®ç°ã€‚å› ä¸ºå¹¶ä¸èƒ½ç›´æ¥ä½¿ç”¨kubeadmå°†é›†ç¾¤å‡çº§åˆ°k8s1.24.2ï¼Œä½†åœ¨æ‰§è¡Œä¸€äº›é’ˆå¯¹å®¹å™¨è¿è¡Œæ—¶çš„å®‰è£…é…ç½®åå°±å¯ä»¥äº†ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ã€‚</p><p>â€‹åŒæ—¶è¿˜éœ€æ³¨æ„ï¼Œä½¿ç”¨kubeadmå‡çº§k8sé›†ç¾¤æ—¶ä¸æ”¯æŒè·¨å¤§ç‰ˆæœ¬å‡çº§ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼Œå¦‚æœè¦ä»k8s1.23.x å‡çº§åˆ°k8s1.25.xï¼Œå°±éœ€è¦å…ˆä»k8s1.23.x å‡çº§åˆ°k8s1.24.xï¼Œç„¶åå†ä»k8s1.24.x å‡çº§åˆ°k8s1.25.xã€‚å¦‚æœæƒ³åœ¨æ­¤æ–‡æ¡£çš„åŸºç¡€ä¸Šå°†k8så‡çº§åˆ°æ›´ç‰ˆæœ¬ï¼Œå°±éœ€è¦ä¸€çº§ä¸€çº§å¾€ä¸Šå‡ï¼Œä¸èƒ½è·³çº§ï¼ˆå¯èƒ½kubeadmä¸æ‰¿è®¤å¤©æ‰å§ï¼Œå“ˆå“ˆ^_^ï¼‰ï¼</p><p>â€‹å‚è€ƒï¼š<a href="https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/">https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/</a></p><h1 id="äºŒã€å‡çº§æ­¥éª¤"><a href="#äºŒã€å‡çº§æ­¥éª¤" class="headerlink" title="äºŒã€å‡çº§æ­¥éª¤"></a>äºŒã€å‡çº§æ­¥éª¤</h1><h2 id="2-1-å®‰è£…cri-dockerd-æ‰€æœ‰èŠ‚ç‚¹"><a href="#2-1-å®‰è£…cri-dockerd-æ‰€æœ‰èŠ‚ç‚¹" class="headerlink" title="2.1 å®‰è£…cri-dockerd(æ‰€æœ‰èŠ‚ç‚¹)"></a>2.1 å®‰è£…cri-dockerd(æ‰€æœ‰èŠ‚ç‚¹)</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">è®¿é—®ï¼šhttps://github.com/Mirantis/cri-dockerd/releases</span><br><br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# wget https://github.com/Mirantis/cri-dockerd/releases/download/v0.3.2/cri-dockerd-0.3.2.amd64.tgz<br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# gunzip cri-dockerd-0.3.2.amd64.tgz<br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# tar -xf cri-dockerd-0.3.2.amd64.tar<br><br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# cp cri-dockerd/cri-dockerd /usr/local/bin/<br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# chmod 755 /usr/local/bin/cri-dockerd<br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ é™¤å…ˆå‰å­˜åœ¨çš„æ–‡ä»¶</span><br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# rm -f /usr/lib/systemd/system/cri-docker*<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å°è£…cri-dockerd.service</span><br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# cat /usr/lib/systemd/system/cri-dockerd.service<br>[Unit]<br>Description=CRI Interface for Docker Application Container Engine<br>Documentation=https://docs.mirantis.com<br>After=network-online.target firewalld.service docker.service<br>Wants=network-online.target<br>Requires=cri-dockerd.socket<br><br>[Service]<br>Type=notify<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ExecStart=/usr/local/bin/cri-dockerd --network-plugin=cni --pod-infra-container-image=registry.aliyuncs.com/google_containers/pause:3.7</span><br>ExecStart=/usr/local/bin/cri-dockerd --network-plugin=cni --pod-infra-container-image=registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.9 --cni-conf-dir=/etc/cni/net.d --cni-bin-dir=/opt/cni/bin --container-runtime-endpoint=unix:///var/run/cri-dockerd.sock --cri-dockerd-root-directory=/var/ib/dockershim --docker-endpoint=unix:///var/run/docker.sock --cri-dockerd-root-directory=/var/1ib/docker<br><br>ExecReload=/bin/kill -s HUP $MAINPID<br>TimeoutSec=0<br>RestartSec=2<br>Restart=always<br><br>StartLimitBurst=3<br><br>StartLimitInterval=60s<br><br>LimitNOFILE=infinity<br>LimitNPROC=infinity<br>LimitCORE=infinity<br><br>TasksMax=infinity<br>Delegate=yes<br>KillMode=process<br><br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å°è£…cri-dockerd.socket</span><br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# cat /usr/lib/systemd/system/cri-dockerd.socket<br>[Unit]<br>Description=CRI Docker Socket for the API<br>PartOf=cri-dockerd.service<br><br>[Socket]<br>ListenStream=/var/run/cri-dockerd.sock<br>SocketMode=0660<br>SocketUser=root<br>SocketGroup=docker<br><br>[Install]<br>WantedBy=sockets.target<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">é…ç½®Kubernetesä½¿ç”¨cri-dockerï¼š</span><br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# vi /var/lib/kubelet/kubeadm-flags.env<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ·»åŠ å‚æ•°æˆ–ä¿®æ”¹å‚æ•°ä¸ºå¦‚ä¸‹</span><br>KUBELET_KUBEADM_ARGS=&quot;--cgroup-driver=system -pod-infra-container-image=registry.aliyuncs.com/google_containers/pause:3.7 --container-runtime=remote --container-runtime-endpoint=unix:///var/run/cri-dockerd.sock&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯åŠ¨cri-dockerdæœåŠ¡</span><br>systemctl daemon-reload<br>systemctl restart cri-dockerd.service cri-dockerd.socket<br>systemctl status cri-dockerd.service cri-dockerd.socket<br></code></pre></td></tr></table></figure><h2 id="2-2-Master-èŠ‚ç‚¹æ“ä½œ"><a href="#2-2-Master-èŠ‚ç‚¹æ“ä½œ" class="headerlink" title="2.2 Master èŠ‚ç‚¹æ“ä½œ"></a>2.2 Master èŠ‚ç‚¹æ“ä½œ</h2><h3 id="2-2-1-å‡çº§-kubeadm"><a href="#2-2-1-å‡çº§-kubeadm" class="headerlink" title="2.2.1 å‡çº§ kubeadm"></a>2.2.1 å‡çº§ kubeadm</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">kubeadmç‰ˆæœ¬ä¸ç›®çš„k8sç‰ˆæœ¬è¦ä¸€è‡´</span><br>[root@k8s-master01 ~]# yum install -y kubeadm-1.24.2-0 --disableexcludes=kubernetes<br>[root@k8s-master01 ~]# kubeadm version<br></code></pre></td></tr></table></figure><h3 id="2-2-2-æŸ¥çœ‹å‡çº§è®¡åˆ’"><a href="#2-2-2-æŸ¥çœ‹å‡çº§è®¡åˆ’" class="headerlink" title="2.2.2 æŸ¥çœ‹å‡çº§è®¡åˆ’"></a>2.2.2 æŸ¥çœ‹å‡çº§è®¡åˆ’</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">k8sä¸æ”¯æŒè·¨å¤§ç‰ˆæœ¬å‡çº§</span><br>[root@k8s-master01 ~]# kubeadm upgrade plan<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹å›¾è½¬å­˜è¿‡ä¸€æ¬¡ï¼Œæ‰€ä»¥æœ‰ç‚¹æ¨¡ç³Šã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¾“å‡ºå†…å®¹æç¤ºç°åœ¨çš„k8s.1.23.9æœ€é«˜åªèƒ½å‡çº§åˆ°k8s.1.24.17ï¼Œè€Œä¸”è¿˜éœ€è¦å‡çº§kubeadm</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/11/18/3N9O7BbQmyVpXU6.png" alt="image-20241118184701703"></p><h3 id="2-2-3-æ‰§è¡ŒMasterèŠ‚ç‚¹å‡çº§"><a href="#2-2-3-æ‰§è¡ŒMasterèŠ‚ç‚¹å‡çº§" class="headerlink" title="2.2.3 æ‰§è¡ŒMasterèŠ‚ç‚¹å‡çº§"></a>2.2.3 æ‰§è¡ŒMasterèŠ‚ç‚¹å‡çº§</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@k8s-master01 ~]# kubeadm upgrade apply v1.24.2<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœæ‰§è¡Œå¤±è´¥å¹¶æç¤ºï¼šError <span class="hljs-keyword">while</span> dialing dial unix /var/run/dockershim.sockï¼Œå‚è€ƒâ€œ2.4 é—®é¢˜å¤„ç†â€-&gt;â€œ2.4.1 xxxç« èŠ‚â€å†…å®¹è¿›è¡Œå¤„ç†</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœæœ‰å¤šä¸ªæ§åˆ¶èŠ‚ç‚¹ï¼Œåç»­æ§åˆ¶èŠ‚ç‚¹è¯·æ‰§è¡Œï¼škubeadm upgrade node</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å‚è€ƒï¼šhttps://kubernetes.io/zh-cn/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/11/18/jtbh3DgFzPZUr7I.png" alt="image-20241118185005730"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# kubectl get nodes --show-labels<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/11/18/kioEC92BZcArsJe.png" alt="image-20241118185157241"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†k8s-master01èŠ‚ç‚¹è®¾ç½®ä¸ºä¸å¯è°ƒåº¦ï¼Œç„¶åå°†å°†å…¶ä¸Šç°æœ‰podè¿ç§»åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šå»</span><br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# kubectl drain k8s-master01 --ignore-daemonsets<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å‡çº§clientç«¯çš„kubectlç‰ˆæœ¬</span><br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# yum install kubectl-1.24.2<br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# kubectl version --short<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/11/18/5KaFLOk63w4ySGV.png" alt="image-20241118185720354"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å‡çº§kubelet</span><br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# yum install kubelet-1.24.2<br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# kubelet â€“version<br><span class="hljs-meta prompt_">#</span><span class="language-bash">é‡å¯kubeletæœåŠ¡</span><br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# systemctl daemon-reload <br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# systemctl restart kubelet<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/11/18/iWgwrjpQ1sXq4ck.png" alt="image-20241118185814268"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# kubectl uncordon k8s-master01<br><span class="hljs-meta prompt_">#</span><span class="language-bash">uncordonæ­¤èŠ‚ç‚¹åï¼Œæ­¤èŠ‚ç‚¹ä¸ŠkubeletæœåŠ¡æ‰å˜æˆRunningçŠ¶æ€</span><br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# systemctl status kubelet<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/11/18/sPeXuLvaDnA2VpU.png" alt="image-20241118185943405"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹å„èŠ‚ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°å½“å‰æ˜¾ç¤ºé›†ç¾¤ç‰ˆæœ¬è¿˜æ˜¯1.23.9</span><br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# kubectl get nodes<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/11/18/TQ2Wz8cJeLxDs1f.png" alt="image-20241118190029580"></p><h3 id="2-2-4-åç»­é…ç½®"><a href="#2-2-4-åç»­é…ç½®" class="headerlink" title="2.2.4 åç»­é…ç½®"></a>2.2.4 åç»­é…ç½®</h3><p>â€‹k8s1.24 å¼ƒç”¨äº† node-role.kubernetes.io&#x2F;masterï¼Œ æ›¿æ¢æˆäº† node-role.kubernetes.io&#x2F;control-plane , æ‰€ä»¥éœ€è¦æ‰‹åŠ¨æ·»åŠ  master ç›¸å…³çš„ lable å’Œ taintï¼Œå¦åˆ™ä¹‹å‰ä½¿ç”¨äº†è¯¥ labelï¼Œtaint çš„åº”ç”¨ä¼šå‡ºé—®é¢˜ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# kubectl label nodes k8s-master01 node-role.kubernetes.io/master=<br><br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# kubectl taint nodes k8s-master01 node-role.kubernetes.io/control-plane-<br><br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# kubectl taint nodes k8s-master01 node-role.kubernetes.io/master:NoSchedule --overwrite<br></code></pre></td></tr></table></figure><h2 id="2-3-Worker-èŠ‚ç‚¹æ“ä½œ"><a href="#2-3-Worker-èŠ‚ç‚¹æ“ä½œ" class="headerlink" title="2.3 Worker èŠ‚ç‚¹æ“ä½œ"></a>2.3 Worker èŠ‚ç‚¹æ“ä½œ</h2><h3 id="2-3-1-å‡çº§-kubeadm"><a href="#2-3-1-å‡çº§-kubeadm" class="headerlink" title="2.3.1 å‡çº§ kubeadm"></a>2.3.1 å‡çº§ kubeadm</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@k8s-worker01 ~]# yum install -y kubeadm-1.24.2-0 --disableexcludes=Kubernetes<br>[root@k8s-worker01 ~]# kubeadm version<br></code></pre></td></tr></table></figure><h3 id="2-3-2-å‡çº§å·¥ä½œèŠ‚ç‚¹"><a href="#2-3-2-å‡çº§å·¥ä½œèŠ‚ç‚¹" class="headerlink" title="2.3.2 å‡çº§å·¥ä½œèŠ‚ç‚¹"></a>2.3.2 å‡çº§å·¥ä½œèŠ‚ç‚¹</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@k8s-worker01 ~]# kubeadm upgrade node<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/11/18/htp6UgM8y4ILYbc.png" alt="image-20241118190900487"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@k8s-worker01 ~]# yum install kubectl-1.24.2 kubelet-1.24.2 -y<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/11/18/r7vUfkptloyubjF.png" alt="image-20241118190925463"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@k8s-worker01 ~]# systemctl daemon-reload<br>[root@k8s-worker01 ~]# systemctl restart kubelet<br><span class="hljs-meta prompt_">#</span><span class="language-bash">uncordonæ­¤èŠ‚ç‚¹åï¼Œæ­¤èŠ‚ç‚¹ä¸ŠkubeletæœåŠ¡æ‰å˜æˆRunningçŠ¶æ€</span><br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# kubectl uncordon k8s-worker01<br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# kubectl get nodes<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/11/18/xlyCmRFfwueAa1K.png" alt="image-20241118191051445"></p><h3 id="2-3-3-å·¥ä½œèŠ‚ç‚¹ç”Ÿæˆconfigæ–‡ä»¶"><a href="#2-3-3-å·¥ä½œèŠ‚ç‚¹ç”Ÿæˆconfigæ–‡ä»¶" class="headerlink" title="2.3.3 å·¥ä½œèŠ‚ç‚¹ç”Ÿæˆconfigæ–‡ä»¶"></a>2.3.3 å·¥ä½œèŠ‚ç‚¹ç”Ÿæˆconfigæ–‡ä»¶</h3><p>â€‹ä¸Šè¿°æ“ä½œå®Œæˆåï¼Œåœ¨å·¥ä½œèŠ‚ç‚¹æ— æ³•æ‰§è¡Œkubectlå‘½ä»¤ï¼ŒæŠ¥é”™å¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@k8s-worker01 ~]# kubectl get nodes<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/11/18/B75ZOdthCPTfVpQ.png" alt="image-20241118191753051"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨æ‰€æœ‰å·¥ä½œèŠ‚ç‚¹ä¸Šåˆ›å»ºç›®å½•</span><br>[root@k8s-worker01 ~]# mkdir -p $HOME/.kube<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä»ä¸»èŠ‚ç‚¹å¤åˆ¶æ–‡ä»¶åˆ°å·¥ä½œèŠ‚ç‚¹æŒ‡å®šç›®å½•</span><br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# scp /etc/kubernetes/admin.conf root@k8s-worker01:/root/.kube/config<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¹‹ååœ¨æ­¤å·¥ä½œèŠ‚ç‚¹å°±å¯ä»¥æ­£å¸¸æ‰§è¡Œkubectlå‘½ä»¤</span><br></code></pre></td></tr></table></figure><h3 id="2-3-4-æ³¨æ„"><a href="#2-3-4-æ³¨æ„" class="headerlink" title="2.3.4 æ³¨æ„"></a>2.3.4 æ³¨æ„</h3><p>â€‹å…¶ä»–k8så·¥ä½œèŠ‚ç‚¹éƒ½è¦æ‰§è¡Œä¸Šè¿°æ“ä½œã€‚</p><p>â€‹æ‰€æœ‰å·¥ä½œæ‰§è¡Œå®Œä¸Šè¿°æ“ä½œåï¼Œæ­¤æ—¶æ‰€æœ‰k8sèŠ‚ç‚¹çš„çŠ¶æ€ä»æ˜¯å¤„äºNotReadyçŠ¶æ€ï¼Œæ‰€æœ‰èŠ‚ç‚¹keubeletæœåŠ¡activating (auto-restart)ï¼Œè¯·å‚è€ƒä»¥ä¸‹ç« èŠ‚â€œé—®é¢˜å¤„ç†â€è§£å†³ã€‚</p><p>â€‹å‡çº§æ‰€æœ‰æ“ä½œéƒ½å®Œæˆåï¼Œk8s1.24.2é›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¼šå¤„äºReadyçŠ¶æ€ï¼Œk8sé›†ç¾¤ç‰ˆæœ¬æ˜¾ç¤ºä¸ºv1.24.2ï¼š</p><p><img src="https://s2.loli.net/2024/11/18/wYLPAKD5JvCopcQ.png" alt="image-20241118224834915"></p><h2 id="2-4-é—®é¢˜å¤„ç†"><a href="#2-4-é—®é¢˜å¤„ç†" class="headerlink" title="2.4 é—®é¢˜å¤„ç†"></a>2.4 é—®é¢˜å¤„ç†</h2><h3 id="2-4-1-æ§åˆ¶èŠ‚ç‚¹å‡çº§æ—¶ï¼ŒæŠ¥â€œError-while-dialing-dial-unix-var-run-dockershim-sockâ€"><a href="#2-4-1-æ§åˆ¶èŠ‚ç‚¹å‡çº§æ—¶ï¼ŒæŠ¥â€œError-while-dialing-dial-unix-var-run-dockershim-sockâ€" class="headerlink" title="2.4.1  æ§åˆ¶èŠ‚ç‚¹å‡çº§æ—¶ï¼ŒæŠ¥â€œError while dialing dial unix &#x2F;var&#x2F;run&#x2F;dockershim.sockâ€"></a>2.4.1  æ§åˆ¶èŠ‚ç‚¹å‡çº§æ—¶ï¼ŒæŠ¥â€œError while dialing dial unix &#x2F;var&#x2F;run&#x2F;dockershim.sockâ€</h3><p><img src="https://s2.loli.net/2024/11/18/sG4WQDX1BoYva8U.png" alt="image-20241118223816806"></p><p>è§£å†³åŠæ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ç¼–è¾‘æ‰€æœ‰èŠ‚ç‚¹</span><br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# kubectl edit nodes k8s-master01 <br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# kubectl edit nodes k8s-worker01 <br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# kubectl edit nodes k8s-worker02<br><span class="hljs-meta prompt_">#</span><span class="language-bash">åšå¦‚ä¸‹ä¿®æ”¹ï¼š</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/11/18/A6HFoIDcMvk9WBP.png" alt="image-20241118224008028"></p><h3 id="2-4-2-å‡çº§æ“ä½œå®Œæˆåï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯NotReadyçŠ¶æ€ï¼Œæ‰€æœ‰èŠ‚ç‚¹keubeletæœåŠ¡activating-auto-restart"><a href="#2-4-2-å‡çº§æ“ä½œå®Œæˆåï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯NotReadyçŠ¶æ€ï¼Œæ‰€æœ‰èŠ‚ç‚¹keubeletæœåŠ¡activating-auto-restart" class="headerlink" title="2.4.2 å‡çº§æ“ä½œå®Œæˆåï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯NotReadyçŠ¶æ€ï¼Œæ‰€æœ‰èŠ‚ç‚¹keubeletæœåŠ¡activating (auto-restart)"></a>2.4.2 å‡çº§æ“ä½œå®Œæˆåï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯NotReadyçŠ¶æ€ï¼Œæ‰€æœ‰èŠ‚ç‚¹keubeletæœåŠ¡activating (auto-restart)</h3><p><img src="https://s2.loli.net/2024/11/18/qQFNxa6HjRPZ2Ay.png" alt="image-20241118224047709"></p><p><img src="https://s2.loli.net/2024/11/18/HxZkC9NJyXMuti1.png" alt="image-20241118224208751"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ†æå®šä½ï¼š</span><br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# journalctl -xeu kubelet &gt; kubelet.log<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹kubeletçš„ç›¸å…³æ—¥å¿—</span><br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# vi kubelet.log<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/11/18/ZphI32MCdzlei8t.png" alt="image-20241118224327843"></p><p>å‘ç°kubeletæ— æ³•è¯†åˆ«â€â€“network-pluginâ€è¿™ä¸ªå‚æ•°ï¼Œå› ä¸ºè¯¥é…ç½®å’Œâ€DockerShimâ€ä¸€èµ·åœ¨Kubernetesçš„1.24ç‰ˆæœ¬è¢«ç§»é™¤äº†ã€‚</p><p>è§£å†³åŠæ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æ‰¾åˆ° <span class="hljs-string">&quot;--network-plugin&quot;</span> åˆ é™¤å³å¯</span><br>[root@k8s-master01 upgrade-k8s1.23.9-to-1.24.2]# vi /var/lib/kubelet/kubeadm-flags.env<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/11/18/okGdNUQBxLE6KDs.png" alt="image-20241118224524590"></p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs livescript">[root@k8s-master01 upgrade-k8s1.<span class="hljs-number">23.9</span>-<span class="hljs-keyword">to</span>-<span class="hljs-number">1.24</span>.<span class="hljs-number">2</span>]<span class="hljs-comment"># source /var/lib/kubelet/kubeadm-flags.env                                                                                                                     </span><br>[root@k8s-master01 upgrade-k8s1.<span class="hljs-number">23.9</span>-<span class="hljs-keyword">to</span>-<span class="hljs-number">1.24</span>.<span class="hljs-number">2</span>]<span class="hljs-comment"># systemctl restart kubelet</span><br>[root@k8s-master01 upgrade-k8s1.<span class="hljs-number">23.9</span>-<span class="hljs-keyword">to</span>-<span class="hljs-number">1.24</span>.<span class="hljs-number">2</span>]<span class="hljs-comment"># systemctl status kubelet -l</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/11/18/NYnPLoQvpMSTUut.png" alt="image-20241118224556425"></p><p>å…¶ä»–èŠ‚ç‚¹ä¹Ÿæ˜¯è¿™æ ·ä¿®æ”¹ä¸æ“ä½œåï¼Œé‡å¯kubeletæœåŠ¡ï¼Œä¹‹åkubeletæœåŠ¡å¤„äºRunningçŠ¶æ€ã€‚</p><p>ä¹‹åK8sé›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯ReadyçŠ¶æ€ï¼š</p><p><img src="https://s2.loli.net/2024/11/18/891feAnlkdjO2hp.png" alt="image-20241118224702797"></p>]]></content>
    
    
    <categories>
      
      <category>k8säº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s kubeadm 1.23.x 1.24.x å‡çº§ docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>arm64æœåŠ¡å™¨ä¸‹çš„Harbor-v2.11.1ç¯å¢ƒæ­å»º</title>
    <link href="/2024/10/30/arm64%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8B%E7%9A%84Harbor-v2-11-1%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    <url>/2024/10/30/arm64%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8B%E7%9A%84Harbor-v2-11-1%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€æ­å»ºè¿‡ç¨‹"><a href="#ä¸€ã€æ­å»ºè¿‡ç¨‹" class="headerlink" title="ä¸€ã€æ­å»ºè¿‡ç¨‹"></a>ä¸€ã€æ­å»ºè¿‡ç¨‹</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@ubuntu20:~# mkdir -p /opt/installPkgs/installHarbor<br>root@ubuntu20:~# cd /opt/installPkgs/installHarbor<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹è½½ç¼–æ’æ–‡ä»¶docker-compose.yml</span><br>root@ubuntu20:/opt/installPkgs/installHarbor# curl -LO https://raw.githubusercontent.com/bitnami/containers/main/bitnami/harbor-portal/docker-compose.yml<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹è½½å®‰è£…æ–‡ä»¶ï¼Œè§£å‹ç„¶åç§»åŠ¨æ–‡ä»¶</span><br>root@ubuntu20:/opt/installPkgs/installHarbor# curl -L https://github.com/bitnami/containers/archive/main.tar.gz | tar xz --strip=2 containers-main/bitnami/harbor-portal &amp;&amp; cp -RL harbor-portal/2/debian-12/config ./ &amp;&amp; rm -rf harbor-portal<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ç¼–è¯‘dockeré…ç½®æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹é•œåƒä»£ç†ç½‘ç«™ï¼ˆä¸ä¸€å®šéå¸¸å¥½ç”¨ï¼Œä½†æ¯”æ²¡æœ‰æ—¶æ•ˆæœå¥½ï¼‰</span><br>root@ubuntu20:/opt/installPkgs/installHarbor# vi /etc/docker/daemon.json<br>...<br>  &quot;registry-mirrors&quot;: [<br>    &quot;https://docker.nju.edu.cn/&quot;,<br>    &quot;https://kuamavit.mirror.aliyuncs.com&quot;,<br>    &quot;https://docker.chenby.cn&quot;,<br>    &quot;https://docker.registry.cyou&quot;,<br>    &quot;https://docker-cf.registry.cyou&quot;,<br>    &quot;https://dockercf.jsdelivr.fyi&quot;,<br>    &quot;https://docker.jsdelivr.fyi&quot;,<br>    &quot;https://dockertest.jsdelivr.fyi&quot;,<br>    &quot;https://mirror.aliyuncs.com&quot;,<br>    &quot;https://dockerproxy.com&quot;,<br>    &quot;https://mirror.baidubce.com&quot;,<br>    &quot;https://docker.m.daocloud.io&quot;,<br>    &quot;https://docker.mirrors.sjtug.sjtu.edu.cn&quot;,<br>    &quot;https://docker.mirrors.ustc.edu.cn&quot;,<br>    &quot;https://mirror.iscas.ac.cn&quot;,<br>    &quot;https://docker.rainbond.cc&quot;<br>  ],<br>...<br><br>root@ubuntu20:/opt/installPkgs/installHarbor# systemctl daemon-reload &amp;&amp; systemctl restart docker<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å°è£…pull-images.sh</span> <br>root@ubuntu20:/opt/installPkgs/installHarbor# touch pull-images.sh <br>root@ubuntu20:/opt/installPkgs/installHarbor# cat pull-images.sh <br><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br>docker pull docker.io/bitnami/harbor-registry:2<br>docker pull docker.io/bitnami/harbor-registryctl:2<br>docker pull docker.io/bitnami/postgresql:13<br>docker pull docker.io/bitnami/harbor-core:2<br>docker pull docker.io/bitnami/harbor-portal:2<br>docker pull docker.io/bitnami/harbor-jobservice:2<br>docker pull docker.io/bitnami/redis:7.4<br>docker pull docker.io/bitnami/nginx:1.27<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‹‰å–æ­å»ºHarboræ—¶éœ€è¦ç”¨åˆ°çš„é•œåƒï¼ˆå¦‚æœä¸Šè¿°daemon.jsoné…ç½®è¿˜æ— æ•ˆï¼Œè¯·å…ˆæƒ³åŠæ³•å°†è¿™äº›é•œåƒä¸‹è½½åˆ°æ‰‹ï¼‰</span><br>root@ubuntu20:/opt/installPkgs/installHarbor# bash pull-images.sh <br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»ºHarborç›¸å…³å®¹å™¨</span><br>root@ubuntu20:/opt/installPkgs/installHarbor# docker-compose up -d<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹å®¹å™¨åˆ—è¡¨</span><br>root@ubuntu20:/opt/installPkgs/installHarbor# docker-compose ps<br>NAME                          IMAGE                                    COMMAND                  SERVICE        CREATED        STATUS        PORTS<br>harbor-core                   docker.io/bitnami/harbor-core:2          &quot;/opt/bitnami/scriptâ€¦&quot;   core           2 months ago   Up 2 months   8080/tcp<br>harbor-db                     docker.io/bitnami/postgresql:13          &quot;/opt/bitnami/scriptâ€¦&quot;   postgresql     2 months ago   Up 2 months   5432/tcp<br>harbor-jobservice             docker.io/bitnami/harbor-jobservice:2    &quot;/opt/bitnami/scriptâ€¦&quot;   jobservice     2 months ago   Up 2 months   8080/tcp, 8443/tcp<br>harbor-portal                 docker.io/bitnami/harbor-portal:2        &quot;/opt/bitnami/scriptâ€¦&quot;   portal         2 months ago   Up 2 months   8080/tcp, 8443/tcp<br>installharbor-redis-1         docker.io/bitnami/redis:7.4              &quot;/opt/bitnami/scriptâ€¦&quot;   redis          2 months ago   Up 2 months   6379/tcp<br>installharbor-registry-1      docker.io/bitnami/harbor-registry:2      &quot;/opt/bitnami/scriptâ€¦&quot;   registry       2 months ago   Up 2 months   5000/tcp<br>installharbor-registryctl-1   docker.io/bitnami/harbor-registryctl:2   &quot;/opt/bitnami/scriptâ€¦&quot;   registryctl    2 months ago   Up 2 months   8080/tcp, 8443/tcp<br>nginx                         docker.io/bitnami/nginx:1.27             &quot;/opt/bitnami/scriptâ€¦&quot;   harbor-nginx   2 months ago   Up 2 months   8443/tcp, 0.0.0.0:80-&gt;8080/tcp, :::80-&gt;8080/tcp<br></code></pre></td></tr></table></figure><h1 id="äºŒã€Harborä»“åº“webç•Œé¢"><a href="#äºŒã€Harborä»“åº“webç•Œé¢" class="headerlink" title="äºŒã€Harborä»“åº“webç•Œé¢"></a>äºŒã€Harborä»“åº“webç•Œé¢</h1><p>â€‹Harborä»“åº“çš„webç•Œé¢è®¿é—®åœ°å€æ˜¯ï¼šhttp:&#x2F;&#x2F;{æœåŠ¡å™¨IP}:80 ã€‚ é»˜è®¤è¶…çº§ç®¡ç†å‘˜ç”¨æˆ·ï¼šadminï¼Œå¯†ç ï¼šbitnami</p><p>â€‹ç›¸å…³ç”¨æ³•è·ŸAMD64æ„æ¶æœåŠ¡å™¨ä¸‹æ—¶Harborçš„ç”¨æ³•ä¸€æ ·ã€‚</p><p><img src="https://s2.loli.net/2024/12/03/TgnCRyWIEhXY1cj.png" alt="image-20241030224957136"></p><p>â€‹æŸ¥çœ‹Harborç‰ˆæœ¬ï¼š</p><p><img src="https://s2.loli.net/2024/12/03/8rHVqGBC1EfgkKn.png" alt="image-20241030225416541"></p><h1 id="ä¸‰ã€å…¶ä»–è¯´æ˜"><a href="#ä¸‰ã€å…¶ä»–è¯´æ˜" class="headerlink" title="ä¸‰ã€å…¶ä»–è¯´æ˜"></a>ä¸‰ã€å…¶ä»–è¯´æ˜</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ç›¸å…³ä¸»è¦é…ç½®æ¯”å¦‚ç™»å½•harboræœåŠ¡çš„webç•Œé¢æ—¶adminç”¨æˆ·çš„å¯†ç ï¼Œåœ¨docker-compose.yml è¿›è¡Œé…ç½®</span><br>root@ubuntu20:/opt/installPkgs/installHarbor# vi docker-compose.yml<br>...<br>HARBOR_ADMIN_PASSWORD=bitnami<br>...<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>k8säº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>arm64 Harbor-v2.11.1 é•œåƒä»“åº“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¼€æºç›‘æ§ç³»ç»Ÿå¤œèºV6-7-2ä»‹ç»-éƒ¨ç½²-ä½¿ç”¨å…¥é—¨</title>
    <link href="/2024/10/27/%E5%BC%80%E6%BA%90%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%E5%A4%9C%E8%8E%BAV6-7-2%E4%BB%8B%E7%BB%8D-%E9%83%A8%E7%BD%B2-%E4%BD%BF%E7%94%A8%E5%85%A5%E9%97%A8/"/>
    <url>/2024/10/27/%E5%BC%80%E6%BA%90%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%E5%A4%9C%E8%8E%BAV6-7-2%E4%BB%8B%E7%BB%8D-%E9%83%A8%E7%BD%B2-%E4%BD%BF%E7%94%A8%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€ä»‹ç»"><a href="#ä¸€ã€ä»‹ç»" class="headerlink" title="ä¸€ã€ä»‹ç»"></a>ä¸€ã€ä»‹ç»</h1><h2 id="1-1-ç®€ä»‹"><a href="#1-1-ç®€ä»‹" class="headerlink" title="1.1 ç®€ä»‹"></a>1.1 ç®€ä»‹</h2><p>â€‹å¤œèºç›‘æ§æ˜¯ä¸€æ¬¾å¼€æºäº‘åŸç”Ÿè§‚æµ‹åˆ†æå·¥å…·ï¼Œé‡‡ç”¨ All-in-One çš„è®¾è®¡ç†å¿µï¼Œé›†æ•°æ®é‡‡é›†ã€å¯è§†åŒ–ã€ç›‘æ§å‘Šè­¦ã€æ•°æ®åˆ†æäºä¸€ä½“ï¼Œä¸äº‘åŸç”Ÿç”Ÿæ€ç´§å¯†é›†æˆï¼Œæä¾›å¼€ç®±å³ç”¨çš„ä¼ä¸šçº§ç›‘æ§åˆ†æå’Œå‘Šè­¦èƒ½åŠ›ã€‚å¤œèºäº 2020 å¹´ 3 æœˆ 20 æ—¥ï¼Œåœ¨ github ä¸Šå‘å¸ƒ v1 ç‰ˆæœ¬ï¼Œå·²ç´¯è®¡è¿­ä»£ 100 å¤šä¸ªç‰ˆæœ¬ã€‚å®ƒæœ€åˆç”±æ»´æ»´å¼€å‘å’Œå¼€æºï¼Œå¹¶äº 2022 å¹´ 5 æœˆ 11 æ—¥ï¼Œæèµ äºˆä¸­å›½è®¡ç®—æœºå­¦ä¼šå¼€æºå‘å±•å§”å‘˜ä¼šï¼ˆCCF ODCï¼‰ï¼Œä¸º CCF ODC æˆç«‹åæ¥å—æèµ çš„ç¬¬ä¸€ä¸ªå¼€æºé¡¹ç›®ã€‚å¤œèºçš„æ ¸å¿ƒç ”å‘å›¢é˜Ÿï¼Œä¹Ÿæ˜¯ Open-Falcon é¡¹ç›®åŸæ ¸å¿ƒç ”å‘äººå‘˜ã€‚</p><p>â€‹å¤œèºçš„ä»£ç åº“åˆ†å‰ç«¯ä»£ç åº“ä¸åç«¯ä»£ç åº“ï¼Œå·²ç»æ‰˜ç®¡å€åœ¨githubå¹³å°ï¼Œåç«¯ä¸»è¦å®ç°è¯­è¨€æ˜¯Goï¼Œå‰ç«¯ä¸»è¦å®ç°è¯­è¨€æ˜¯TypeScriptã€‚</p><ul><li>åç«¯ï¼š<a href="https://github.com/ccfos/nightingale">ğŸ’¡ https://github.com/ccfos/nightingale</a></li><li>å‰ç«¯ï¼š<a href="https://github.com/n9e/fe">ğŸ’¡ https://github.com/n9e/fe</a></li></ul><h2 id="1-2-æ€è€ƒä¸åˆ†æ"><a href="#1-2-æ€è€ƒä¸åˆ†æ" class="headerlink" title="1.2 æ€è€ƒä¸åˆ†æ"></a>1.2 æ€è€ƒä¸åˆ†æ</h2><p>â€‹åœ¨å¤œèºç›‘æ§è¿™ä¸ªè½¯ä»¶ä¹‹å‰ï¼Œç›‘æ§å‘Šè­¦ã€å‘Šè­¦è‡ªæ„ˆä¸å›¾è¡¨å±•ç¤ºå·²ç»æœ‰äº†ä¸€å¥—å¯è¡Œçš„å¼€æºè§£å†³æ–¹æ¡ˆå³â€œPrometheus+Grafana+AlertManagerâ€ç»„åˆã€‚é‚£ä¸ºä»€ä¹ˆè¿˜éœ€è¦å†å¼€å‘ä¸€å¥—â€œé‡å¤çš„â€ã€æœ‰ç€ç›¸åŒåŠŸèƒ½çš„è½¯ä»¶è§£å†³æ–¹æ¡ˆå‘¢ï¼Ÿå…¶å®å®ƒä»¬ä¸»ä½“åŠŸèƒ½æ˜¯é‡å¤çš„ï¼Œä½†å®ƒä»¬çš„ä¼˜åŠ¿ä¸å¯ç»„åˆæ€§ä¸ä¸€æ ·ï¼Œè¿™æ ·ç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…éœ€æ±‚æ¥é€‰æ‹©é€‚åˆè‡ªå·±çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>â€‹ä¸ºäº†å™è¿°çš„ç®€æ´æ€§ï¼Œä»¥ä¸‹ä½¿ç”¨â€œPGAç»„åˆâ€ä»£æ›¿â€œPrometheus+Grafana+AlertManagerâ€ç»„åˆã€‚</p><table><thead><tr><th>åŠŸèƒ½ç‰¹å¾æˆ–å®é™…éœ€æ±‚</th><th>â€œPGAç»„åˆâ€</th><th>å¤œèº</th></tr></thead><tbody><tr><td>å…ˆå‰å·²ç»ä½¿ç”¨â€œPGAç»„åˆâ€æ­å»ºå¥½è‡ªå·±ç›‘æ§å‘Šè­¦ä¸å›¾è¡¨å±•ç¤ºï¼ŒåŠŸèƒ½å·²ç»åŸºæœ¬æ»¡è¶³éœ€æ±‚ä¸”æ²¡æœ‰ç—›ç‚¹</td><td>+1â€™</td><td></td></tr><tr><td>éœ€è¦ä½¿ç”¨Grafanaç¤¾åŒºä¸­åºå¤§è€Œç‚«é…·çš„å›¾è¡¨</td><td>+1â€™</td><td>ï¼ˆå¤œGrafanaä¸­ä¸€èˆ¬å¸¸è§çš„åŸºç¡€çš„å›¾è¡¨å›¾è¡¨åœ¨å¤œèºéƒ½æ˜¯æœ‰çš„æˆ–å¯é‡ç”¨çš„ï¼‰</td></tr><tr><td>éœ€è¦ä½¿ç”¨å¤šä¸ªTSDBå¦‚Prometheusã€VictoriaMetricsã€Thanosç­‰ï¼Œéœ€è¦ä¸€ä¸ªç»Ÿä¸€çš„å¹³å°æ¥ç®¡ç†å‘Šè­¦ã€çœ‹å›¾</td><td></td><td>+1â€™</td></tr><tr><td>è®©å¤šä¸ªå›¢é˜Ÿè‡ªè¡Œé‡‡ç”¨å›¾å½¢åŒ–æ–¹å¼çµæ´»æ–¹ä¾¿åœ°å®šåˆ¶è‡ªå·±çš„å‘Šè­¦è§„åˆ™ä¸å›¾è¡¨</td><td></td><td>+1â€™</td></tr><tr><td>è®©å¤šä¸ªå›¢é˜Ÿè‡ªè¡Œé‡‡ç”¨å›¾å½¢åŒ–æ–¹å¼çµæ´»æ–¹ä¾¿åœ°å®šåˆ¶è‡ªå·±çš„å‘Šè­¦ç­–ç•¥é…ç½®ï¼Œæ¯”å¦‚æ§åˆ¶ç”Ÿæ•ˆæ—¶é—´ã€ä¸€å¥—è§„åˆ™ç”Ÿæ•ˆå¤šä¸ªé›†ç¾¤</td><td></td><td>+1â€™</td></tr><tr><td>éœ€è¦å‘Šè­¦è‡ªæ„ˆèƒ½åŠ›ï¼Œå¦‚å‘Šè­¦ä¹‹åè‡ªåŠ¨æ‰§è¡Œä¸ªè„šæœ¬</td><td></td><td>+1â€™</td></tr><tr><td>ä»¥å›¾å½¢åŒ–æ–¹å¼å¼€ç®±å³ç”¨å†…ç½®å‘Šè­¦è§„åˆ™å’Œå†…ç½®ä»ªè¡¨ç›˜</td><td></td><td>+1â€™</td></tr></tbody></table><p>â€‹å¯ä»¥çœ‹åˆ°ï¼Œâ€œPGAç»„åˆâ€ç”±äºäº§ç”Ÿçš„æ—¶é—´æ›´æ—©ï¼Œå¯èƒ½å·²åœ¨ç›¸å½“ä¸€éƒ¨ä¼ä¸šæˆ–åœºæ™¯çš„ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œå¦‚å…¶åŠŸèƒ½å·²èƒ½åŸºæœ¬æ»¡è¶³éœ€æ±‚ã€ä½¿ç”¨ä¸­ç¡®å®æ²¡æœ‰ç—›ç‚¹ã€éœ€è¦Grafanaç¤¾åŒºä¸­åºå¤§è€Œç‚«é…·çš„å›¾è¡¨ï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨â€œPGAç»„åˆâ€ã€‚å¦åˆ™å°±å¯ä»¥å°è¯•å¤œèºè¿™ä¸€å¥—è§£å†³æ–¹æ¡ˆã€‚</p><h2 id="1-3-æ„æ¶ä»‹ç»"><a href="#1-3-æ„æ¶ä»‹ç»" class="headerlink" title="1.3 æ„æ¶ä»‹ç»"></a>1.3 æ„æ¶ä»‹ç»</h2><p><img src="https://s2.loli.net/2024/10/28/chCmQ8bKjwTZN4V.png" alt="20230531103435"></p><p>â€‹é¦–å…ˆä¸Šå›¾ä¸­é—´çš„é£é¸Ÿä»£è¡¨å¤œèºçš„æ ¸å¿ƒè¿›ç¨‹ n9e ï¼ˆä¸‹æ–‡ä»¥ n9e ä»£æ›¿ï¼‰ï¼Œå®ƒçš„é›†ç¾¤æ–¹å¼éå¸¸ç®€å•åªéœ€éƒ¨ç½²å¤šèŠ‚ç‚¹å³å¯å®ç°ã€‚</p><p>â€‹å¯¹äº n9e æ¥è¯´ï¼Œå®ƒæœ¬èº«ä¾èµ–çš„å­˜å‚¨æœ‰ä¸¤ä¸ª</p><ul><li>Mysql : å­˜æ”¾é…ç½®ç±»åˆ«ä¿¡æ¯ï¼Œå¦‚ç”¨æˆ·ï¼Œç›‘æ§å¤§ç›˜ï¼Œå‘Šè­¦è§„åˆ™ç­‰</li><li>Redis : å­˜æ”¾è®¿é—®ä»¤ç‰Œ(JWT Token)ï¼Œå¿ƒè·³ä¿¡æ¯ï¼Œå¦‚æœºå™¨åˆ—è¡¨ä¸­CPUã€å†…å­˜ã€æ—¶é—´åç§»ã€æ ¸æ•°ã€æ“ä½œç³»ç»Ÿã€CPUæ¶æ„ç­‰</li></ul><p>â€‹ä» v6 ç‰ˆæœ¬å¼€å§‹ï¼Œå¤œèºå°è¯•è½¬å‹ä¸ºç»Ÿä¸€å¯è§‚æµ‹æ€§å¹³å°ï¼Œn9e ä¸å†ä»…æ”¯æŒæ¥å…¥æ—¶åºæ•°æ®æº(Prometheusã€Victoriametricsã€M3DBã€Thanos)ï¼Œä¹Ÿå¯ä»¥æ¥å…¥æ—¥å¿—ç±»æ•°æ®æºï¼ˆElasticsearchï¼ŒLokiã€é¢„ã€‘ï¼‰ï¼Œé“¾è·¯è¿½è¸ªæ•°æ®æºï¼ˆJaegerï¼‰ã€‚</p><p>â€‹å·¦ä¾§å°±æ˜¯ n9e çš„æ•°æ®æ¥æºï¼Œn9e å¯ä»¥æ”¯æŒå¤šç§é‡‡é›†å™¨ agentï¼Œæ¯”å¦‚ Datadog-Agentï¼ŒTelegrafï¼ŒGrafana-Agentï¼ŒOpenTSDB agentï¼ŒNode-Exporterï¼Œvmagent éƒ½å¯ä»¥å¯¹æ¥ï¼Œä¸è¿‡æœ€æ¨èçš„è¿˜æ˜¯ Categrafã€‚æ¯”å¦‚åœ¨ n9e ä¸­æœºå™¨åˆ—è¡¨é¡µé¢çš„å¿ƒè·³ä¿¡æ¯éƒ½æ˜¯ Categraf æ‰ä¼šå»é‡‡é›†å¹¶ä¸ŠæŠ¥çš„ï¼Œæ‰€ä»¥ä¸ºäº†æ›´ä¸æ»‘ä½¿ç”¨æ›´æ¨èä½¿ç”¨ Categrafï¼Œå¹¶ä¸” Categraf é‡‡ç”¨ All-In-One çš„è®¾è®¡ï¼Œé‡‡é›†æ—¥å¿—ï¼ŒæŒ‡æ ‡ï¼Œé“¾è·¯è¿½è¸ªï¼Œæ‰€æœ‰çš„é‡‡é›†å·¥ä½œä½¿ç”¨ä¸€ä¸ª agent æ¥è§£å†³ã€‚</p><p>â€‹ä»‹ç»å®Œä¸­å¿ƒéƒ¨ç½²æ¶æ„ï¼Œæˆ‘ä»¬å†æ¥æè¿°ä¸€ä¸‹å®ƒçš„æ•°æ®æµï¼šå‡è®¾æ˜¯æ—¶åºæŒ‡æ ‡æ•°æ®çš„é‡‡é›†ï¼Œagent æŠŠé‡‡é›†åˆ°çš„æ•°æ®æ¨é€ç»™ n9e ï¼ˆç«¯å£:17000ï¼‰ï¼Œç„¶åç»ç”± n9e åŠ å·¥ï¼ˆè‡ªåŠ¨æ·»åŠ é™„åŠ æ ‡ç­¾ï¼‰è½¬å‘ç»™å¯¹åº”çš„æ—¶åºæ•°æ®åº“ä¿å­˜ã€‚å¦å¤–åœ¨ n9e æŠŠæ•°æ®çš„è½¬å‘ç»™æ—¶åºæ•°æ®åº“ä¹‹å‰ï¼Œä¼šå…ˆä»ç›‘æ§æ•°æ®ä¸­æå–å‡º ident æ ‡ç­¾å†™å…¥ mysql çš„ target è¡¨ï¼ˆæœºå™¨åˆ—è¡¨ï¼‰ä¸­ï¼ŒåŒæ—¶å¦‚æœ agent ç”¨çš„æ˜¯ Categraf å¹¶ä¸”é…ç½®äº†å¿ƒè·³(heartbeat&#x3D;true)ï¼Œåˆ™ä¼šæŠŠå¿ƒè·³ä¸ŠæŠ¥çš„ metadata å­˜å…¥ Redisï¼ˆå°±æ˜¯é‚£äº›æ ¸æ•°ã€æ“ä½œç³»ç»Ÿã€CPUæ¶æ„ç­‰ï¼‰ã€‚</p><p>â€‹æ›´å¤æ‚çš„éƒ¨ç½²æ–¹æ¡ˆè¯·æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://flashcat.cloud/docs/content/flashcat-monitor/nightingale-v6/arch/%E3%80%82">https://flashcat.cloud/docs/content/flashcat-monitor/nightingale-v6/arch/ã€‚</a></p><h1 id="äºŒã€éƒ¨ç½²"><a href="#äºŒã€éƒ¨ç½²" class="headerlink" title="äºŒã€éƒ¨ç½²"></a>äºŒã€éƒ¨ç½²</h1><h2 id="2-1-åŸºç¡€ç¯å¢ƒ"><a href="#2-1-åŸºç¡€ç¯å¢ƒ" class="headerlink" title="2.1    åŸºç¡€ç¯å¢ƒ"></a>2.1    åŸºç¡€ç¯å¢ƒ</h2><h3 id="2-1-1-ç¯å¢ƒä¿¡æ¯"><a href="#2-1-1-ç¯å¢ƒä¿¡æ¯" class="headerlink" title="2.1.1     ç¯å¢ƒä¿¡æ¯"></a>2.1.1     ç¯å¢ƒä¿¡æ¯</h3><table><thead><tr><th>ä¸»æœºå</th><th>IP</th><th>æ“ä½œç³»ç»Ÿ</th><th>è§„æ ¼</th><th>ç£ç›˜</th><th>rootç”¨æˆ·å¯†ç </th></tr></thead><tbody><tr><td>k8s03-1</td><td>10.13.15.61</td><td>Ubuntu 20.04.3 LTS-amd64</td><td>8c16g</td><td>400G</td><td>Changeme@123</td></tr></tbody></table><h3 id="2-1-2-å®‰è£…è¦æ±‚è¯´æ˜"><a href="#2-1-2-å®‰è£…è¦æ±‚è¯´æ˜" class="headerlink" title="2.1.2     å®‰è£…è¦æ±‚è¯´æ˜"></a>2.1.2     å®‰è£…è¦æ±‚è¯´æ˜</h3><p>ï¼ˆ1ï¼‰æœåŠ¡å™¨æ„æ¶ï¼šæ”¯æŒx84_64ï¼Œä¹Ÿæ”¯æŒ arm64æ„æ¶ã€‚amd64 æ˜¯ x84 çš„åŒ…ï¼Œä¸‹è½½ç«™ç‚¹ä¹Ÿæä¾› arm64 çš„åŒ…ã€‚å¦‚æœéœ€è¦å…¶ä»–å¹³å°çš„åŒ…åˆ™è¦è‡ªè¡Œç¼–è¯‘éªŒè¯ã€‚</p><p>ï¼ˆ2ï¼‰æ“ä½œç³»ç»Ÿï¼šç¬”è€…åœ¨centos7.9-amd64ä¸Ubuntu20.04.x LTS-amd64ä¸Šéƒ½éªŒè¯è¿‡ï¼Œå¯è¡Œã€‚å…¶ä»–åŸºäºLinuxå†…æ ¸çš„æ“ä½œç³»ç»Ÿç†è®ºä¸Šéƒ½æ”¯æŒï¼Œå…·ä½“è¦éªŒè¯ã€‚</p><p>ï¼ˆ3ï¼‰æ“ä½œç³»ç»Ÿè§„æ ¼ï¼šå¦‚æœå°±æ˜¯ç”¨æ¥æ£€éªŒä¸€ä¸‹ã€ä¸ä¸Šç”Ÿäº§ç¯å¢ƒï¼Œ2æ ¸CPU+4Gå†…å­˜+50Gç£ç›˜ç©ºé—´å³å¯ã€‚å¦‚æœä¸Šç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®8C16GåŠä»¥ä¸Š+300Gç£ç›˜ä»¥ä¸Šï¼Œä¸”æœ€å¥½æ­å»ºä¸€ä¸ªå¤œèºé«˜å¯ç”¨é›†ç¾¤ï¼Œæ­å»ºå¤œèºé«˜å¯ç”¨é›†ç¾¤æ–¹æ³•è§å…¶å®˜ç½‘ã€‚</p><p>ï¼ˆ4ï¼‰å¤œèºå®˜ç½‘å®‰è£…æ–‡æ¡£ï¼š<a href="https://flashcat.cloud/docs/content/flashcat-monitor/nightingale-v6/install/intro/">https://flashcat.cloud/docs/content/flashcat-monitor/nightingale-v6/install/intro/</a></p><h2 id="2-2-ä¸‹è½½å®‰è£…åŒ…"><a href="#2-2-ä¸‹è½½å®‰è£…åŒ…" class="headerlink" title="2.2    ä¸‹è½½å®‰è£…åŒ…"></a>2.2    ä¸‹è½½å®‰è£…åŒ…</h2><p>ä»¥ä¸‹å‡è®¾å®‰è£…æ–‡ä»¶ä¸å®‰è£…ç›®å½•åˆ†åˆ«åœ¨ï¼š&#x2F;data&#x2F;softsã€&#x2F;data&#x2F;server</p><h3 id="2-2-1-å¤œèºä¸‹è½½åœ°å€"><a href="#2-2-1-å¤œèºä¸‹è½½åœ°å€" class="headerlink" title="2.2.1     å¤œèºä¸‹è½½åœ°å€"></a>2.2.1     å¤œèºä¸‹è½½åœ°å€</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨n9e-v6.7.2</span><br>cd /data/softs<br>wget https://github.com/ccfos/nightingale/releases/download/v6.7.2/n9e-v6.7.2-linux-amd64.tar.gz<br></code></pre></td></tr></table></figure><h3 id="2-2-2-categrafä¸‹è½½åœ°å€"><a href="#2-2-2-categrafä¸‹è½½åœ°å€" class="headerlink" title="2.2.2     categrafä¸‹è½½åœ°å€"></a>2.2.2     categrafä¸‹è½½åœ°å€</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä»¥categraf-v0.3.61-linux-amd64ä¸ºä¾‹</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">Linuxä¸Šcategrafï¼šhttps://github.com/flashcatcloud/categraf/releases/download/v0.3.61/categraf-v0.3.61-linux-amd64.tar.gz</span><br>cd /data/softs<br>wget https://github.com/flashcatcloud/categraf/releases/download/v0.3.61/categraf-v0.3.61-linux-amd64.tar.gz<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">Windowsä¸Šcategrafï¼šhttps://github.com/flashcatcloud/categraf/releases/download/v0.3.61/categraf-v0.3.61-windows-amd64.zip</span><br></code></pre></td></tr></table></figure><h3 id="2-2-3-victoria-metricsä¸‹è½½åœ°å€"><a href="#2-2-3-victoria-metricsä¸‹è½½åœ°å€" class="headerlink" title="2.2.3     victoria-metricsä¸‹è½½åœ°å€"></a>2.2.3     victoria-metricsä¸‹è½½åœ°å€</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨å•æœºç‰ˆVM-v1.93.10</span><br>cd /data/softs<br>wget https://github.com/VictoriaMetrics/VictoriaMetrics/releases/download/v1.93.10/victoria-metrics-linux-amd64-v1.93.10.tar.gz<br></code></pre></td></tr></table></figure><h2 id="2-3-éƒ¨ç½²å¤œèºç›¸å…³å„æœåŠ¡"><a href="#2-3-éƒ¨ç½²å¤œèºç›¸å…³å„æœåŠ¡" class="headerlink" title="2.3    éƒ¨ç½²å¤œèºç›¸å…³å„æœåŠ¡"></a>2.3    éƒ¨ç½²å¤œèºç›¸å…³å„æœåŠ¡</h2><p>ä¾èµ– mysql å­˜å‚¨ç”¨æˆ·é…ç½®ç±»æ•°æ®ï¼Œä¾èµ– redis å­˜å‚¨ jwt token å’Œæœºå™¨å¿ƒè·³ä¸ŠæŠ¥çš„ metadataï¼Œæ‰€ä»¥ï¼Œå…ˆå‡†å¤‡ mysql å’Œ redisã€‚</p><h3 id="2-3-1-å®‰è£…victoriametrics"><a href="#2-3-1-å®‰è£…victoriametrics" class="headerlink" title="2.3.1     å®‰è£…victoriametrics"></a>2.3.1     å®‰è£…victoriametrics</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar -zxf victoria-metrics-linux-amd64-v1.93.10.tar.gz -C /data/server<br>chown root:root /data/server/victoria-metrics-prod<br>chmod 755 /data/server/victoria-metrics-prod<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»ºç”¨æˆ·å’Œç”¨æˆ·ç»„</span><br>useradd -u 1003 victoriametrics<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">éƒ¨ç½²äºŒè¿›åˆ¶æ–‡ä»¶</span><br>cd /data/server<br>install -o victoriametrics -g victoriametrics -m 0755 victoria-metrics-prod /usr/local/bin/victoriametrics<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»ºè¿›ç¨‹æ–‡ä»¶ä¸æ•°æ®å­˜å‚¨ç›®å½•</span><br>mkdir -p /run/victoriametrics &amp;&amp; chown victoriametrics:victoriametrics /run/victoriametrics<br>mkdir -p /data/server/victoriametrics/data/ &amp;&amp; chown -R victoriametrics:victoriametrics /data/server/victoriametrics/<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">é…ç½®systemdç®¡ç†æœåŠ¡</span><br>cat &gt; /etc/systemd/system/victoriametrics.service &lt;&lt;EOF<br>[Unit]<br>Description=VictoriaMetrics<br>After=network.target<br><br>[Service]<br>Type=simple<br>StartLimitBurst=5<br>StartLimitInterval=0<br>Restart=on-failure<br>RestartSec=1<br>PIDFile=/run/victoriametrics/victoriametrics.pid<br>ExecStart=/usr/local/bin/victoriametrics -storageDataPath /data/server/victoriametrics/data/ -retentionPeriod 1098 <br>ExecStop=/bin/kill -s SIGTERM $MAINPID<br>User=victoriametrics<br><br>[Install]<br>WantedBy=multi-user.target<br>EOF<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-built_in">ulimit</span></span> <br>mkdir -p /etc/systemd/system/victoriametrics.service.d<br><br>cat &gt; /etc/systemd/system/victoriametrics.service.d/ulimit.conf &lt;&lt; EOF<br>[Service]<br>LimitNOFILE=32000<br>LimitNPROC=32000<br>EOF<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl daemon-reload<br>systemctl start victoriametrics.service<br><br>systemctl enable victoriametrics.service<br>systemctl status victoriametrics.service<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/10/28/jDpqwNy35HKJ79V.png" alt="image-20241028111538618"></p><h3 id="2-3-2-å®‰è£…mysql"><a href="#2-3-2-å®‰è£…mysql" class="headerlink" title="2.3.2     å®‰è£…mysql"></a>2.3.2     å®‰è£…mysql</h3><p>å¯¹äºå¤œèºæ¥è¯´ï¼Œå®ƒæœ¬èº«ä¾èµ–çš„å­˜å‚¨æœ‰ä¸¤ä¸ª</p><ul><li>Mysql : å­˜æ”¾é…ç½®ç±»åˆ«ä¿¡æ¯ï¼Œå¦‚ç”¨æˆ·ï¼Œç›‘æ§å¤§ç›˜ï¼Œå‘Šè­¦è§„åˆ™ç­‰</li><li>Redis : å­˜æ”¾è®¿é—®ä»¤ç‰Œ(JWT Token)ï¼Œå¿ƒè·³ä¿¡æ¯ï¼Œå¦‚æœºå™¨åˆ—è¡¨ä¸­CPUã€å†…å­˜ã€æ—¶é—´åç§»ã€æ ¸æ•°ã€æ“ä½œç³»ç»Ÿã€CPUæ¶æ„ç­‰</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">apt -y install mariadb*<br>systemctl enable mariadb<br>systemctl status mariadb<br><br>mysql -e &quot;SET PASSWORD FOR &#x27;root&#x27;@&#x27;localhost&#x27; = PASSWORD(&#x27;1234&#x27;);&quot;<br>mysql -uroot -p1234<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/10/28/Udo7cpgYxGsNt18.png" alt="image-20241028111612351"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœè¿œç¨‹ç™»å½•mysqlæœåŠ¡ç«¯çš„è¯ï¼Œéœ€è¦ä¿®æ”¹50-server.cnfæ–‡ä»¶çš„bind-addressä¸º0.0.0.0(å¦åˆ™åªèƒ½ä»æœ¬æœºç™»å½•)</span><br>vi /etc/mysql/mariadb.conf.d/50-server.cnf<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/10/28/WFdu9zw3rAhpvKL.png" alt="image-20241028111915017"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿®æ”¹cracklib_password_check.cnfä»¥ä¿®æ”¹ mysqlå¯†ç æ ¡éªŒç­–ç•¥</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†cracklib_password_check æ’ä»¶æ³¨é‡Š</span><br>vi /etc/mysql/mariadb.conf.d/cracklib_password_check.cn<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/10/28/D4vRBUHp2mICWuQ.png" alt="image-20241028112132636"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">é‡å¯æ•°æ®åº“æœåŠ¡</span><br>systemctl restart mariadb.service<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸åŠ -hå‚æ•°ï¼Œé»˜è®¤ä»¥æœ¬æœºä¸ºå®¢æˆ·ç«¯ç™»å½•æ•°æ®åº“</span><br>mysql -uroot -p1234<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å…è®¸rootç”¨æˆ·å¯ä»¥ä»ä»»æ„æœºå™¨ä¸Šç™»å…¥mysqlçš„ä»»æ„æ•°æ®åº“ã€æ“ä½œä»»æ„æ•°æ®åº“çš„ä»»æ„è¡¨</span><br>GRANT ALL PRIVILEGES ON *.* TO &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED BY &quot;1234&quot;;<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">è¿œç¨‹ç™»å½•æ•°æ®åº“å†…ï¼Œä¿®æ”¹rootç”¨æˆ·çš„ç™»å½•å¯†ç </span><br>mysql -hxxx -uroot -p1234<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å…è®¸rootç”¨æˆ·å¯ä»¥ä»ä»»æ„æœºå™¨ä¸Šç™»å…¥mysqlçš„ä»»æ„æ•°æ®åº“ã€æ“ä½œä»»æ„æ•°æ®åº“çš„ä»»æ„è¡¨</span><br>GRANT ALL PRIVILEGES ON *.* TO &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED BY &quot;1234&quot;;<br></code></pre></td></tr></table></figure><h3 id="2-3-3-å®‰è£…redis"><a href="#2-3-3-å®‰è£…redis" class="headerlink" title="2.3.3     å®‰è£…redis"></a>2.3.3     å®‰è£…redis</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">apt install -y redis<br><br>systemctl enable redis<br>systemctl status redis<br></code></pre></td></tr></table></figure><h3 id="2-3-4-å®‰è£…n9e"><a href="#2-3-4-å®‰è£…n9e" class="headerlink" title="2.3.4     å®‰è£…n9e"></a>2.3.4     å®‰è£…n9e</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -p mkdir /data/server/n9e-v6.7.2<br>tar -zxf ztmonitor-v2.0.tar.gz -C /data/server/n9e-v6.7.2/<br><br>cd /data/server/n9e-v6.7.2/ <br><span class="hljs-meta prompt_"># </span><span class="language-bash">è§£å‹ç¼©ä¹‹åï¼Œå¯ä»¥çœ‹åˆ° n9e.sql æ˜¯å»ºè¡¨è¯­å¥ï¼Œå¯¼å…¥æ•°æ®åº“</span> <br>mysql -uroot -p1234 &lt; n9e.sql<br></code></pre></td></tr></table></figure><h4 id="2-3-4-1-å°è£…n9e-service"><a href="#2-3-4-1-å°è£…n9e-service" class="headerlink" title="2.3.4.1 å°è£…n9e.service"></a>2.3.4.1 å°è£…n9e.service</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat &gt;&gt; /usr/lib/systemd/system/n9e.service &lt;&lt;EOF<br>[Unit]<br>Description=&quot;n9e&quot;<br>After=network.target mariadb.service<br>[Service]<br>Type=simple<br>ExecStart=/data/server/n9e-v6.7.2/n9e<br>WorkingDirectory=/data/server/n9e-v6.7.2/<br>Restart=on-failure<br>SuccessExitStatus=0<br>LimitNOFILE=65536<br>StandardOutput=syslog<br>StandardError=syslog<br>SyslogIdentifier=n9e<br>[Install]<br>WantedBy=multi-user.target<br>EOF<br></code></pre></td></tr></table></figure><h4 id="2-3-4-2-ä¿®æ”¹n9eé…ç½®æ–‡ä»¶"><a href="#2-3-4-2-ä¿®æ”¹n9eé…ç½®æ–‡ä»¶" class="headerlink" title="2.3.4.2 ä¿®æ”¹n9eé…ç½®æ–‡ä»¶"></a>2.3.4.2 ä¿®æ”¹n9eé…ç½®æ–‡ä»¶</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿®æ”¹./etc/config.tomlæ–‡ä»¶</span><br>vi ./etc/config.toml<br>...<br>[[Pushgw.Writers]]<br>Url = &quot;http://10.13.15.61:8428/api/v1/write&quot;<br>...<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/10/28/eb235h9dNAgHlX1.png" alt="image-20241028140727607"></p><h4 id="2-3-4-3-å¯åŠ¨n9eæœåŠ¡"><a href="#2-3-4-3-å¯åŠ¨n9eæœåŠ¡" class="headerlink" title="2.3.4.3 å¯åŠ¨n9eæœåŠ¡"></a>2.3.4.3 å¯åŠ¨n9eæœåŠ¡</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl daemon-reload <br>systemctl restart n9e &amp;&amp; systemctl enable n9e<br>systemctl status n9e<br></code></pre></td></tr></table></figure><h4 id="2-3-4-4-è®¿é—®n9eçš„webç•Œé¢"><a href="#2-3-4-4-è®¿é—®n9eçš„webç•Œé¢" class="headerlink" title="2.3.4.4 è®¿é—®n9eçš„webç•Œé¢"></a>2.3.4.4 è®¿é—®n9eçš„webç•Œé¢</h4><p>é“¾æ¥æ˜¯ï¼š<a href="http://10.13.15.61:17000/login">http://10.13.15.61:17000/login</a></p><p><img src="https://s2.loli.net/2024/10/28/HTvd5pO21ZgGAi3.png" alt="image-20241028141145325"></p><h4 id="2-3-4-5-æ·»åŠ æ•°æ®æº"><a href="#2-3-4-5-æ·»åŠ æ•°æ®æº" class="headerlink" title="2.3.4.5 æ·»åŠ æ•°æ®æº"></a>2.3.4.5 æ·»åŠ æ•°æ®æº</h4><p><img src="https://s2.loli.net/2024/10/28/76VrEiwyYq1f5PX.png" alt="image-20241028141904842"></p><p><img src="https://s2.loli.net/2024/10/28/Bj6JRhFetmykoIl.png" alt="image-20241028141958225"></p><h1 id="ä¸‰ã€ä½¿ç”¨å…¥é—¨"><a href="#ä¸‰ã€ä½¿ç”¨å…¥é—¨" class="headerlink" title="ä¸‰ã€ä½¿ç”¨å…¥é—¨"></a>ä¸‰ã€ä½¿ç”¨å…¥é—¨</h1><h2 id="3-1-å¤œèºèƒ½ç›‘æ§ä»€ä¹ˆ"><a href="#3-1-å¤œèºèƒ½ç›‘æ§ä»€ä¹ˆ" class="headerlink" title="3.1 å¤œèºèƒ½ç›‘æ§ä»€ä¹ˆ"></a>3.1 å¤œèºèƒ½ç›‘æ§ä»€ä¹ˆ</h2><p>â€‹å¤œèºèƒ½å¤Ÿç›‘æ§çš„å¯¹è±¡æœ‰å¾ˆå¤šï¼Œä½†å®ƒæœ¬èº«å¹¶æ²¡æœ‰é‡‡é›†è¢«ç›‘æ§çš„æ•°æ®ã€‚å®ƒæ˜¯ä¸€ä¸ªæœåŠ¡ç«¯ç»„ä»¶ï¼Œç±»ä¼¼ Grafanaï¼Œå¯ä»¥æ¥å…¥ä¸åŒçš„æ•°æ®æºï¼Œæ¯”å¦‚ Prometheusã€VictoriaMetricsã€Thanos ç­‰ç­‰ï¼Œåªè¦æ•°æ®è¿›åˆ°è¿™äº›åº“é‡Œäº†ï¼Œå¤œèºå°±å¯ä»¥å¯¹æ•°æ®æºçš„æ•°æ®è¿›è¡Œåˆ†æã€å‘Šè­¦ã€å¯è§†åŒ–ï¼Œä»¥åŠåç»­çš„äº‹ä»¶å¤„ç†ã€å‘Šè­¦è‡ªæ„ˆã€‚</p><h2 id="3-2-å¤œèºå¦‚ä½•è·å–ç›‘æ§æ•°æ®"><a href="#3-2-å¤œèºå¦‚ä½•è·å–ç›‘æ§æ•°æ®" class="headerlink" title="3.2 å¤œèºå¦‚ä½•è·å–ç›‘æ§æ•°æ®"></a>3.2 å¤œèºå¦‚ä½•è·å–ç›‘æ§æ•°æ®</h2><p>â€‹å¤œèºæœ‰ç«¯å£æ¥æ”¶ç›‘æ§æ•°æ®ï¼Œåªè¦å„ç›‘æ§é‡‡é›†å™¨è·Ÿå¤œèºæ‰“é€šäº†å°±èƒ½å°†æ•°æ®æ¨é€ç»™å¤œèºï¼Œå¤œèºæ¥æ”¶åˆ°é‡‡é›†æ•°æ®åï¼Œå¯èƒ½ä¼šè¿›è¡Œå°‘é‡å¤„ç†å¦‚æ·»åŠ å°‘è®¸æ ‡ç­¾ï¼Œç„¶åä¼šä¿å­˜åˆ°n9eé…ç½®æ–‡ä»¶ä¸­é…ç½®çš„æ—¶åºæ•°æ®åº“ä¸­ï¼ˆå¦‚ä¸Šè¿°.&#x2F;etc&#x2F;config.tomlæ–‡ä»¶ä¸­[Pushgw.Writers]ç»„ä¸‹Urlé…ç½®çš„victoria-metricsï¼‰ã€‚ç„¶ååœ¨å¤œèºçš„webç•Œé¢ï¼Œå¯ä»¥åˆ›å»ºå¤œèºä¸­çš„æ•°æ®æºï¼Œæ•°æ®æºæ˜¯å„ä»ªè¡¨ç›˜å¯è§†åŒ–ä¸å‘Šè­¦åˆ†æçš„æ•°æ®æ¥æºã€‚</p><p>â€‹å¸¸ç”¨çš„å¼€æºé‡‡é›†å™¨å¦‚ Telegrafã€Categrafã€Grafana-agentã€Datadog-agentã€Prometheus ç”Ÿæ€çš„å„ç±» Exporter ç­‰ç­‰ï¼Œéƒ½æ˜¯å¯ä»¥è·Ÿå¤œèºç»“åˆä¸€èµ·ä½¿ç”¨çš„ã€‚è¿™äº› agent ï¼ˆä¹Ÿå°±æ˜¯é‡‡é›†å™¨ï¼‰é‡‡é›†äº†æ•°æ®æ¨ç»™å¤œèºï¼Œå¤œèºé€‚é…äº†è¿™äº› agent çš„æ•°æ®ä¼ è¾“åè®®ï¼Œæ‰€ä»¥å¯ä»¥æ¥æ”¶è¿™äº› agent ä¸ŠæŠ¥çš„ç›‘æ§æ•°æ®ï¼Œè½¬å­˜åˆ°åç«¯å¯¹æ¥çš„æ—¶åºæ•°æ®åº“ï¼Œä¹‹åå°±å¯ä»¥å¯¹è¿™äº›æ•°æ®åšå‘Šè­¦åˆ†æã€å¯è§†åŒ–ã€‚</p><p>â€‹Categraf æ˜¯ä¸€ä¸ªå¼€æºçš„ç›‘æ§é‡‡é›† Agentï¼Œç”±å¿«çŒ«æ˜Ÿäº‘æŠ€æœ¯å›¢é˜Ÿï¼ˆä¹Ÿå°±æ˜¯å¤œèºçš„å¼€å‘å›¢é˜Ÿï¼‰ç ”å‘å¹¶å¼€æºï¼Œæä¾›äº†å¯¹æ‰€æœ‰å¸¸è§ç›‘æ§å¯¹è±¡å¦‚Linux&#x2F;WindowsæœåŠ¡å™¨ã€MySQlæ•°æ®åº“ã€k8sã€å®¹å™¨ã€NVIDIA GPUç­‰ç­‰æä¾›é«˜è´¨é‡çš„ç›‘æ§æ•°æ®é‡‡é›†èƒ½åŠ›ï¼Œé‡‡ç”¨äº† All-in-one çš„è®¾è®¡ç†å¿µï¼Œå¯ä»¥åŒæ—¶æ”¯æŒæŒ‡æ ‡ã€æ—¥å¿—ã€é“¾è·¯è¿½è¸ªæ•°æ®çš„é‡‡é›†ã€‚ä»¥ä¸‹ä»¥ categraf é‡‡é›†å™¨ä¸ºä¾‹è¿›è¡Œè¯´æ˜ä¸æ“ä½œã€‚</p><p>â€‹ä¸€èˆ¬æ¥è¯´ï¼Œè¢«ç›‘æ§å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå¯¹åº” Categraf è¿›ç¨‹ã€‚æ¯”å¦‚è¯´è¦ç›‘æ§ 10.13.15.61 è¿™ä¸ªæœåŠ¡å™¨çš„NVIDIA GPUã€cpuã€å†…å­˜ã€ç£ç›˜ã€ä¸Šä¼ ä¸‹è½½ç½‘é€Ÿç­‰è¿™ç±»æœåŠ¡å™¨å›ºæœ‰ä¿¡æ¯ï¼Œæˆ–è¿™å…¶ä¸Šéƒ¨ç½²çš„è½¯ä»¶å¦‚MySQLã€k8s ç­‰ï¼Œå°±éœ€è¦åœ¨10.13.15.61 è¿™ä¸ªæœåŠ¡å™¨çš„æ“ä½œç³»ç»Ÿä¸Šå®‰è£…categrafï¼Œå¹¶è¿›è¡Œé…ç½®ã€‚Categrafç›®å‰æ”¯æŒçš„æ“ä½œç³»ç»ŸåŒ…æ‹¬Windowsã€LinuxåŠmacOSï¼Œå…·ä½“çš„ç‰ˆæœ¬ç»†èŠ‚è¯·æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚</p><h2 id="3-3-å®‰è£…ä¸é…ç½®-categraf"><a href="#3-3-å®‰è£…ä¸é…ç½®-categraf" class="headerlink" title="3.3 å®‰è£…ä¸é…ç½® categraf"></a>3.3 å®‰è£…ä¸é…ç½® categraf</h2><p>â€‹categraf å…¶å®æ˜¯ä¸€ä¸ªé‡‡é›†æ’ä»¶é›†åˆï¼Œå…¶ä¸­åŒ…å«äº†å¤šä¸ªé’ˆå¯¹å¸¸è§è¢«ç›‘æ§å¯¹è±¡çš„æ’ä»¶ï¼Œå¦‚input.cpuã€input.diskã€input.mysqlç­‰ç­‰ï¼Œè¿™äº›æ’ä»¶éƒ½æ”¾åœ¨categrafå®‰è£…ç›®å½•ä¸‹çš„ conf å­ç›®å½•ä¸‹ï¼Œæ¯ä¸ªä»¥ â€input.â€œ å¼€å¤´çš„å­ç›®å½•å°±æ˜¯categraf çš„ä¸€ä¸ªé‡‡é›†æ’ä»¶ã€‚</p><p>â€‹å¦‚æœè¦ç¦ç”¨æŸä¸ªæ’ä»¶ï¼ŒæŠŠ input.xx æ”¹ä¸ªå…¶ä»–å‰ç¼€(æˆ–è€…åˆ é™¤è¿™ä¸ªç›®å½•)ï¼Œæ¯”å¦‚ bak.input.xxï¼Œcategraf å°±ä¼šå¿½ç•¥è¿™ä¸ªé‡‡é›†å™¨ã€‚</p><p>â€‹categrafå®‰è£…å¥½åï¼Œå¦‚æœä¸å¯¹é»˜è®¤æ’ä»¶é…ç½®ç›®å½•åŠæ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œå®ƒé»˜è®¤ä¹Ÿä¼šå¯ç”¨å¸¸åŸºæœ¬çš„æ’ä»¶å¦‚input.cpuã€input.diskç­‰ï¼Œä»¥é‡‡é›†æœ€å¸¸è§çš„æœåŠ¡å™¨ä¸æ“ä½œç³»ç»Ÿæ•°æŒ‡æ ‡æ•°æ®å¦‚cpuã€å†…å­˜ã€ç£ç›˜å¤§å°ä¸ioã€ä¸Šä¼ ä¸‹è½½é€Ÿç‡ç­‰ã€‚é»˜è®¤æ²¡æœ‰é‡‡é›†çš„æŒ‡æ ‡æ•°æ®å°±éœ€è¦ä½¿ç”¨å…¶ä»– Categraf æ’ä»¶æ¥å®¢åˆ¶åŒ–é‡‡é›†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar -zxf /data/softs/categraf-v0.3.61-linux-amd64.tar.gz -C /data/server/<br>cd /data/server<br>cp categraf-v0.3.61-linux-amd64/conf/categraf.service /usr/lib/systemd/system/<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell">vi /usr/lib/systemd/system/categraf.service<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿®æ”¹åå†…å®¹å¦‚ä¸‹</span><br>[Unit]<br>Description=&quot;Categraf&quot;<br>After=network.target<br><br>[Service]<br>Type=simple<br><br>ExecStart=/data/server/categraf-v0.3.61-linux-amd64/categraf  #è¿™é‡Œ<br>WorkingDirectory=/data/server/categraf-v0.3.61-linux-amd64    #è¿™é‡Œ<br><br>Restart=on-failure<br>SuccessExitStatus=0<br>LimitNOFILE=65536<br>StandardOutput=syslog<br>StandardError=syslog<br>SyslogIdentifier=categraf<br><br><br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">vi categraf-v0.3.61-linux-amd64/conf/config.toml <br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä»¥ä¸‹ä¿®æ”¹åçš„å‡ ç‚¹</span><br>[global]<br>...<br>hostname = &quot;$ip&quot;   #å¤œèºä¸­ä»¥è‡ªåŠ¨è·å–åˆ°çš„æœåŠ¡å™¨ipæ ‡è¯†æœåŠ¡å™¨<br>...<br>[[writers]]<br>url = &quot;http://10.13.15.61:17000/prometheus/v1/write&quot;       #å¤œèºæ¥æ”¶ç›‘æ§æ•°æ®çš„url<br>...<br>[heartbeat]<br>...<br><span class="hljs-meta prompt_"># </span><span class="language-bash">report os version cpu.util mem.util metadata</span><br>url = &quot;http://10.13.15.61:17000/v1/n9e/heartbeat?gid=1&quot;    #å¤œèºä¸­æ¥æ”¶ç›‘æ§å¯¹è±¡å¿ƒè·³çš„urlã€‚æœ€ååŠ ä¸Š&quot;gid=1&quot;ä¼šè‡ªåŠ¨å°†è¢«ç›‘æ§æœåŠ¡å™¨å½’åˆ°é»˜è®¤ä¸šåŠ¡ç»„å†…<br>...<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯åŠ¨categrafæœåŠ¡</span><br>systemctl daemon-reload <br>systemctl start categraf.service &amp;&amp; systemctl enable categraf.service<br>systemctl status categraf.service<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/10/28/RiErvmyUs4oqbMA.png" alt="image-20241028145210919"></p><h2 id="3-4-ç›‘æ§"><a href="#3-4-ç›‘æ§" class="headerlink" title="3.4 ç›‘æ§"></a>3.4 ç›‘æ§</h2><h3 id="3-4-1-ç›‘æ§æœåŠ¡å™¨ä¿¡æ¯"><a href="#3-4-1-ç›‘æ§æœåŠ¡å™¨ä¿¡æ¯" class="headerlink" title="3.4.1 ç›‘æ§æœåŠ¡å™¨ä¿¡æ¯"></a>3.4.1 ç›‘æ§æœåŠ¡å™¨ä¿¡æ¯</h3><p>â€‹categrafå®‰è£…å¥½åï¼Œé»˜è®¤ä¼šå¯ç”¨å¸¸åŸºæœ¬çš„æ’ä»¶å¦‚input.cpuã€input.diskç­‰ï¼Œä»¥é‡‡é›†æœ€å¸¸è§çš„æœåŠ¡å™¨ä¸æ“ä½œç³»ç»Ÿæ•°æŒ‡æ ‡æ•°æ®å¦‚cpuã€å†…å­˜ã€ç£ç›˜å¤§å°ä¸ioã€ä¸Šä¼ ä¸‹è½½é€Ÿç‡ç­‰ã€‚</p><p><img src="https://s2.loli.net/2024/10/28/F8zGBrDYpkyLmqn.png" alt="image-20241028145414264"></p><p><img src="https://s2.loli.net/2024/10/28/mO6IC8TtDlE5B2b.png" alt="image-20241028145442200"></p><p>æŸ¥çœ‹åˆšåˆšå…‹éš†çš„ä»ªè¡¨ç›˜åŠå…¶ä¸­æ•°æ®ï¼š</p><p><img src="https://s2.loli.net/2024/10/28/NxRH1UczZeoiDMB.png" alt="image-20241028145535733"></p><p><img src="https://s2.loli.net/2024/10/29/eugmKTJybG53l8q.png" alt="image-20241029095051041"></p><h3 id="3-5-1-ç›‘æ§k8såŠå®¹å™¨"><a href="#3-5-1-ç›‘æ§k8såŠå®¹å™¨" class="headerlink" title="3.5.1 ç›‘æ§k8såŠå®¹å™¨"></a>3.5.1 ç›‘æ§k8såŠå®¹å™¨</h3><p>â€‹å‚è€ƒç¬”è€…ä»¥å‰å†™çš„æ–‡ç« ï¼š<a href="https://jiangsanyin.github.io/2024/05/26/%E5%A4%9C%E8%8E%BAnightingalev6-7-2%E9%80%9A%E8%BF%87kubelet%E9%87%87%E9%9B%86docker%E5%AE%B9%E5%99%A8%E7%9B%91%E6%8E%A7%E6%95%B0%E6%8D%AE/">https://jiangsanyin.github.io/2024/05/26/%E5%A4%9C%E8%8E%BAnightingalev6-7-2%E9%80%9A%E8%BF%87kubelet%E9%87%87%E9%9B%86docker%E5%AE%B9%E5%99%A8%E7%9B%91%E6%8E%A7%E6%95%B0%E6%8D%AE/</a></p><h3 id="3-6-1-é‡‡é›†ç›‘æ§å…¶ä»–å¯¹è±¡æ•°æ®"><a href="#3-6-1-é‡‡é›†ç›‘æ§å…¶ä»–å¯¹è±¡æ•°æ®" class="headerlink" title="3.6.1 é‡‡é›†ç›‘æ§å…¶ä»–å¯¹è±¡æ•°æ®"></a>3.6.1 é‡‡é›†ç›‘æ§å…¶ä»–å¯¹è±¡æ•°æ®</h3><p>â€‹å…³äºå…¶ä»–æ’ä»¶çš„ç”¨æ³•ï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://flashcat.cloud/docs/content/flashcat-monitor/categraf/plugin/introduction/">https://flashcat.cloud/docs/content/flashcat-monitor/categraf/plugin/introduction/</a></p><h2 id="3-5-åŸºç¡€è®¾æ–½-æœºå™¨åˆ—è¡¨"><a href="#3-5-åŸºç¡€è®¾æ–½-æœºå™¨åˆ—è¡¨" class="headerlink" title="3.5 åŸºç¡€è®¾æ–½-æœºå™¨åˆ—è¡¨"></a>3.5 åŸºç¡€è®¾æ–½-æœºå™¨åˆ—è¡¨</h2><p>â€‹n9e æŠŠæ•°æ®çš„è½¬å‘ç»™æ—¶åºæ•°æ®åº“ä¹‹å‰ï¼Œä¼šå…ˆä»ç›‘æ§æ•°æ®ä¸­æå–å‡º ident æ ‡ç­¾å†™å…¥ mysql çš„ target è¡¨ï¼ˆæœºå™¨åˆ—è¡¨ï¼‰ä¸­ï¼ŒåŒæ—¶ Categraf ä¼šæŠŠå¿ƒè·³ä¸ŠæŠ¥çš„ metadata å­˜å…¥ Redisï¼ˆå°±æ˜¯é‚£äº›æ ¸æ•°ã€æ“ä½œç³»ç»Ÿã€CPUæ¶æ„ç­‰ï¼‰ã€‚è¿™äº›æ•°æ®å°±æ˜¯å°±æ˜¯å±•ç¤ºåœ¨â€œåŸºç¡€è®¾æ–½-æœºå™¨åˆ—è¡¨â€é¡µé¢çš„æœåŠ¡å™¨ã€‚</p><p><img src="https://s2.loli.net/2024/10/28/rbKXLuyedAvsg1S.png" alt="image-20241028220233328"></p><h2 id="3-6-äººå‘˜ç»„ç»‡"><a href="#3-6-äººå‘˜ç»„ç»‡" class="headerlink" title="3.6 äººå‘˜ç»„ç»‡"></a>3.6 äººå‘˜ç»„ç»‡</h2><h3 id="3-6-1-ç”¨æˆ·ç®¡ç†"><a href="#3-6-1-ç”¨æˆ·ç®¡ç†" class="headerlink" title="3.6.1 ç”¨æˆ·ç®¡ç†"></a>3.6.1 ç”¨æˆ·ç®¡ç†</h3><p>â€‹æ­¤é¡µé¢çš„ç”¨æˆ·æ˜¯å¤œèºç³»ç»Ÿä¸­çš„ç”¨æˆ·ï¼Œæ›´ç›´è§‚åœ°è®²å°±æ˜¯å¯ä»¥ç™»å½•æ­¤webç³»ç»Ÿçš„ç”¨æˆ·ã€‚taå¯èƒ½æ˜¯æŸä¸ªä½¿ç”¨è€…çš„é€»è¾‘æ˜ å°„ï¼Œä¹Ÿå¯èƒ½æ˜¯æŸä¸ªæœºå™¨äººå¦‚é’‰é’‰æœºå™¨äººã€‚ä»…æœ‰ä¸€ä¸ªé»˜è®¤çš„rootç”¨æˆ·ä¹Ÿå¯ä»¥ç»§ç»­ä½¿ç”¨æ­¤ç³»ç»Ÿã€‚</p><p><img src="https://s2.loli.net/2024/10/28/UJmPW1NqKIgdCYw.png" alt="image-20241028224349420"></p><h3 id="3-6-2-å›¢é˜Ÿç®¡ç†"><a href="#3-6-2-å›¢é˜Ÿç®¡ç†" class="headerlink" title="3.6.2 å›¢é˜Ÿç®¡ç†"></a>3.6.2 å›¢é˜Ÿç®¡ç†</h3><p>â€‹å›¢é˜Ÿå°±æ˜¯å¤šä¸ªç”¨æˆ·çš„é›†åˆã€‚</p><p><img src="https://s2.loli.net/2024/10/29/Ttglb6deoSiRUNc.png" alt="image-20241029095403547"></p><h3 id="3-6-3-ä¸šåŠ¡ç»„ç®¡ç†"><a href="#3-6-3-ä¸šåŠ¡ç»„ç®¡ç†" class="headerlink" title="3.6.3 ä¸šåŠ¡ç»„ç®¡ç†"></a>3.6.3 ä¸šåŠ¡ç»„ç®¡ç†</h3><p>â€‹ä¸šåŠ¡ç»„ä¸‹é¢åŒ…å«å¤šä¸ªå›¢é˜Ÿï¼Œæ¯ä¸ªå›¢é˜Ÿåˆæœ‰å„è‡ªçš„æˆå‘˜ã€‚è¿™æ ·åˆ’åˆ†ç»“æ„ï¼Œåœ¨ä½¿ç”¨å‘Šè­¦è§„åˆ™éå¸¸æœ‰ç”¨ï¼Œå³æŸä¸ªä¸šåŠ¡ç»„ä¸‹çš„å¯èƒ½æœ‰å¤šä¸ªå‘Šè­¦è§„åˆ™ï¼Œè€Œè¿™äº›å‘Šè­¦åˆ™æ£€æŸ¥çš„å¯¹è±¡å¦‚æœåŠ¡å™¨å¯èƒ½æ˜¯ç”±ä¸åŒçš„å›¢é˜Ÿè´Ÿè´£çš„ï¼Œè¿™æ ·ä¸€æ¥ï¼Œç›¸åº”çš„æŠ¥è­¦å°±åº”è¯¥å‘é€ç»™å¯¹åº”å›¢é˜Ÿä¸‹é¢çš„ç”¨æˆ·ï¼Œæœ‰åˆ©äºé¿å…æ‰“æ‰°ä¸æƒè´£çš„ç•Œå®šã€‚</p><p><img src="https://s2.loli.net/2024/10/28/HWapfo31FODgvLy.png" alt="image-20241028225018637"></p><h2 id="3-7-å‘Šè­¦ç®¡ç†"><a href="#3-7-å‘Šè­¦ç®¡ç†" class="headerlink" title="3.7 å‘Šè­¦ç®¡ç†"></a>3.7 å‘Šè­¦ç®¡ç†</h2><h3 id="3-6-1-å†…ç½®è§„åˆ™"><a href="#3-6-1-å†…ç½®è§„åˆ™" class="headerlink" title="3.6.1 å†…ç½®è§„åˆ™"></a>3.6.1 å†…ç½®è§„åˆ™</h3><p>â€‹å†…ç½®è§„åˆ™æ˜¯å¤œèºé»˜è®¤å·²ç»å†…ç½®çš„ä¸€äº›å¸¸ç”¨æˆ–åŸºç¡€çš„å‘Šè­¦è§„åˆ™ï¼Œç”¨æˆ·å¼€ç®±å³ç”¨çš„ã€‚</p><p>â€‹å°†å…¶è¿›è¡Œå…‹éš†å³å¯å½¢æˆè‡ªå·±çš„å‘Šè­¦è§„åˆ™ï¼Œå¯ä»¥å¯¹å†…ç½®è§„åˆ™è¿›è¡Œå…‹éš†å†è¿›è¡Œä¿®æ”¹ï¼Œåˆ›å»ºæ»¡è¶³è‡ªå·±å®é™…éœ€æ±‚çš„å‘Šè­¦è§„åˆ™ã€‚å¦‚ä¸‹ä¸¤å¼ å›¾çš„æ“ä½œï¼Œä»å†…ç½®å‘Šè­¦ç»„å…‹éš†ä¸€ä¸ªå‘Šè­¦è§„åˆ™åˆ°é»˜è®¤ä¸šåŠ¡ç»„ä¸‹ï¼Œä½†å¹¶æ²¡æœ‰å¯ç”¨ã€‚å½“ç„¶ä¹Ÿå¯æŸ¥çœ‹â€œå†…ç½®è§„åˆ™â€çš„å†…å®¹ï¼Œä»è€Œç¡®å®šæ˜¯å¦æ˜¯è‡ªå·±æƒ³è¦çš„å‡†å‘Šè­¦è§„åˆ™ã€‚</p><p><img src="https://s2.loli.net/2024/10/28/LGI8snSCHqipePo.png" alt="image-20241028220625744"></p><p><img src="https://s2.loli.net/2024/10/28/9Z7xFYG46aWfw2s.png" alt="image-20241028221656103"></p><h3 id="3-6-2-å‘Šè­¦è§„åˆ™"><a href="#3-6-2-å‘Šè­¦è§„åˆ™" class="headerlink" title="3.6.2 å‘Šè­¦è§„åˆ™"></a>3.6.2 å‘Šè­¦è§„åˆ™</h3><p>â€‹å…‹éš†å¾—åˆ°çš„å‘Šè­¦è§„åˆ™åœ¨å¦‚ä¸‹çš„â€œå‘Šè­¦è§„åˆ™â€é¡µé¢ï¼Œç‚¹å‡»è§„åˆ™åç§°å¯ä»¥å†æ¬¡å¯¹å…¶è¿›è¡Œç¼–è¾‘ã€‚ç¼–è¾‘å¥½çš„å‘Šè­¦è§„åˆ™ä¸€å®šç¡®è®¤å·²ç»å¯ç”¨ï¼Œå¦åˆ™ç›¸å½“äºè¢«ç¦ç”¨äº†ã€‚</p><p><img src="https://s2.loli.net/2024/10/28/bGmkQZgFqBRnTUX.png" alt="image-20241028221953883"></p><p><img src="https://s2.loli.net/2024/10/28/tCNmaKYVIfuUZFP.png" alt="image-20241028222701515"></p><p><img src="https://s2.loli.net/2024/10/28/2gaTSyFUW1LwvPp.png" alt="image-20241028224050927"></p>]]></content>
    
    
    <categories>
      
      <category>ç›‘æ§</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼€æº ç›‘æ§ç³»ç»Ÿ å¤œèºV6.7.2</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¼‚æ„ç®—åŠ›è™šæ‹ŸåŒ–ä¸­é—´ä»¶HAMiä»‹ç»ä¸ç®€å•ä½¿ç”¨</title>
    <link href="/2024/10/22/%E5%BC%82%E6%9E%84%E7%AE%97%E5%8A%9B%E8%99%9A%E6%8B%9F%E5%8C%96%E4%B8%AD%E9%97%B4%E4%BB%B6HAMi%E4%BB%8B%E7%BB%8D%E4%B8%8E%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"/>
    <url>/2024/10/22/%E5%BC%82%E6%9E%84%E7%AE%97%E5%8A%9B%E8%99%9A%E6%8B%9F%E5%8C%96%E4%B8%AD%E9%97%B4%E4%BB%B6HAMi%E4%BB%8B%E7%BB%8D%E4%B8%8E%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€ä»‹ç»"><a href="#ä¸€ã€ä»‹ç»" class="headerlink" title="ä¸€ã€ä»‹ç»"></a>ä¸€ã€ä»‹ç»</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>â€‹HAMiï¼Œè‹±æ–‡å…¨ç§°æ˜¯â€œHeterogeneous AI Computing Virtualization Middlewareâ€ï¼Œæ˜¯ä¸€ä¸ªGPUä¸åŠ é€Ÿå¡ï¼ˆæ”¯æŒçš„GPUä¸å›½äº§åŠ é€Ÿå¡å‹å·ä¸å…·ä½“ç‰¹æ€§è¯·æŸ¥çœ‹æ­¤é¡¹ç›®å®˜ç½‘ï¼š <a href="https://github.com/Project-HAMi/HAMi/">https://github.com/Project-HAMi/HAMi/</a> ï¼‰è™šæ‹ŸåŒ–å›½äº§å¼€æºé¡¹ç›®ï¼Œå®ç°äº†ä»¥kubernetesä¸ºåŸºç¡€çš„å®¹å™¨åœºæ™¯ä¸‹GPUæˆ–åŠ é€Ÿå¡è™šæ‹ŸåŒ–ã€‚æ­¤é¡¹ç›®æœ€åˆç”±ç¬¬å››èŒƒå¼å…¬å¸å¼€æºï¼ŒåŸåâ€œk8s-vGPU-schedulerâ€ï¼Œåæ”¹åä¸ºHAMiï¼ˆä¸­æ–‡åä¸ºå“ˆèœœï¼‰ï¼Œç»è¿‡ä¸¤ä¸‰å¹´çš„å‘å±•ï¼Œç°å·²åœ¨å›½å†…ä¸å›½é™…ä¸Šæ„ˆåŠ æµè¡Œï¼Œæˆä¸ºå°å‹æˆ–ç§‘ç ”æœºæ„æä¾›å®¹å™¨åœºæ™¯ä¸‹GPUæˆ–åŠ é€Ÿå¡è®¾å¤‡è™šæ‹ŸåŒ–çš„è§£å†³æ–¹æ¡ˆé›å½¢æˆ–åŸºç¡€ã€‚å®ƒæä¾›äº†ç®¡ç†å¤šç§ä¸åŒç±»å‹çš„å¼‚æ„è®¾å¤‡ï¼ˆç›®å‰æ”¯æŒNVIDIA GPUã€å¯’æ­¦çºªMLUã€å¤©æ•°æ™ºèŠ¯GPUã€ä¸­ç§‘ç½²å…‰DCUã€åä¸ºæ˜‡è…¾NPUã€æ‘©å°”çº¿ç¨‹GPUï¼‰çš„èƒ½åŠ›ï¼Œèƒ½å¤Ÿåœ¨Podä¹‹é—´å…±äº«å¼‚æ„è®¾å¤‡ï¼Œæ ¹æ®è®¾å¤‡çš„æ‹“æ‰‘ä¿¡æ¯å’Œè°ƒåº¦ç­–ç•¥åšå‡ºæ›´å¥½çš„è°ƒåº¦å†³ç­–ã€‚</p><p>â€‹       è€ƒè™‘åˆ°å½“å‰å›½å†…äººå·¥æ™ºèƒ½ã€é«˜æ€§èƒ½è®¡ç®—ã€æœºå™¨å­¦ä¹ ç­‰éœ€è¦å¤§é‡è®¡ç®—ä»»åŠ¡çš„å·¥ä½œè´Ÿè½½å¯¹NVIDIA GPUåŠå…¶ä»–å›½äº§åŠ é€Ÿå¡å¦‚æµ·å…‰DCUã€æ˜‡è…¾NPUã€å¯’æ­¦çºªMLUç­‰çš„ä½¿ç”¨ç‰¹ç‚¹ã€‚ç¬¬ä¸€ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¾è‘—çš„ç‰¹ç‚¹å°±æ˜¯ä¸€ä¸ªåŠ é€Ÿå¡æœ€å¤šåªèƒ½åˆ†é…ç»™ä¸€ä¸ªä»»åŠ¡ï¼Œè¿™ä¸ªåŠ é€Ÿå¡çš„èµ„æºå¦‚è®¡ç®—æ ¸å¿ƒä¸æ˜¾å­˜å¹¶æœªè¢«å……åˆ†å¤ç”¨ï¼Œå…¶ä¸­å¾ˆå¤§ä¸€éƒ¨åˆ†å†…å­˜å¯èƒ½è¢«æµªè´¹æ‰äº†ï¼ŒHAMiè¿™ä¸€å¼€æºé¡¹ç›®èƒ½å¤Ÿè§£å†³è¿™ä¸€é—®é¢˜ã€‚ç¬¬äºŒï¼ŒHAMiä½¿å¾—èƒ½å¤Ÿåœ¨åŒä¸€ä¸ªk8sç¯å¢ƒä¸­åŒæ—¶æ”¯æŒå¯¹å¤šä¸ªä¸åŒå“ç‰Œçš„åŠ é€Ÿè®¾å¤‡ï¼ˆå¼‚æ„åŠ é€Ÿè®¾å¤‡ï¼‰çš„è™šæ‹Ÿå…±äº«ï¼Œè¿™å°±æ˜¯HAMiåç§°ä¸­å¼‚æ„çš„æ¥æºã€‚ï¼ˆç¬”è€…ç›®å‰çš„ç†è§£ï¼Œå…¶ä»–åŠŸèƒ½å¦‚â€œåŠ¨æ€MIGåˆ‡ç‰‡â€è¿˜æœ‰å¾…è¿›ä¸€èµ·æ·±å…¥ç ”ç©¶å­¦ä¹ ä¸­ï¼‰ã€‚</p><h2 id="èƒ½åŠ›ä¸ç‰¹æ€§"><a href="#èƒ½åŠ›ä¸ç‰¹æ€§" class="headerlink" title="èƒ½åŠ›ä¸ç‰¹æ€§"></a>èƒ½åŠ›ä¸ç‰¹æ€§</h2><p>â€‹HAMi æä¾›äº†é’ˆå¯¹åŒ…æ‹¬NVIDIA GPUåœ¨å†…çš„ç­‰å¼‚æ„è®¾å¤‡çš„è™šæ‹ŸåŒ–èƒ½åŠ›ï¼Œèƒ½åŠ›ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªæ–¹é¢å³è®¾å¤‡å¤ç”¨ä¸èµ„æºéš”ç¦»ã€‚</p><ul><li><p>è®¾å¤‡å¤ç”¨:</p><ul><li>å…è®¸é€šè¿‡æŒ‡å®šæ˜¾å­˜æ¥ç”³è¯·è™šæ‹Ÿç®—åŠ›è®¾å¤‡</li><li>å…è®¸é€šè¿‡æŒ‡å®šç®—åŠ›ä½¿ç”¨æ¯”ä¾‹æ¥ç”³è¯·è™šæ‹Ÿç®—åŠ›è®¾å¤‡</li></ul></li><li><p>èµ„æºéš”ç¦»:</p><ul><li>ç®—åŠ›èµ„æºçš„ç¡¬éš”ç¦»</li></ul></li></ul><p>â€‹HAMi è°ƒåº¦å™¨æä¾›äº†ç®¡ç†GPUé›†ç¾¤çš„èƒ½åŠ›ï¼Œå…·ä½“åŒ…æ‹¬å¦‚ä¸‹åŠŸèƒ½ç‰¹æ€§ï¼ˆä¸åŒGPUæˆ–åŠ é€Ÿå¡æ”¯æŒçš„åŠŸèƒ½ç‰¹æ€§å¯èƒ½ä¼šç¨æœ‰å·®åˆ«ï¼Œæˆ‘åªç”¨è¿‡å°‘æ•°å‡ ç§ï¼Œæ­¤å¤„æœªèƒ½å®Œæ•´å½’çº³æ€»ç»“ã€‚ä»¥å‰å®˜ç½‘æä¾›äº†åŠŸèƒ½ç‰¹æ€§æ”¯æŒçŸ©é˜µï¼Œæœ€è¿‘åˆ é™¤äº†ï¼‰ï¼š</p><ul><li><em><strong>GPU å…±äº«</strong></em>: æ¯ä¸ªä»»åŠ¡å¯ä»¥åªå ç”¨ä¸€éƒ¨åˆ†æ˜¾å¡ï¼Œå¤šä¸ªä»»åŠ¡å¯ä»¥å…±äº«ä¸€å¼ æ˜¾å¡</li><li><em><strong>å¯é™åˆ¶åˆ†é…çš„æ˜¾å­˜å¤§å°</strong></em>: å¯ä»¥ç”¨æ˜¾å­˜å€¼ï¼ˆä¾‹å¦‚3000Mï¼‰æˆ–è€…æ˜¾å­˜æ¯”ä¾‹ï¼ˆä¾‹å¦‚50%ï¼‰æ¥åˆ†é…GPUï¼ŒvGPUè°ƒåº¦å™¨ä¼šç¡®ä¿ä»»åŠ¡ä½¿ç”¨çš„æ˜¾å­˜ä¸ä¼šè¶…è¿‡åˆ†é…æ•°å€¼</li><li><em><strong>å¯é™åˆ¶åˆ†é…çš„è®¡ç®—æ ¸å¿ƒæ•°</strong></em>: å¯ä»¥ç”¨è®¡ç®—æ ¸å¿ƒæ¯”ä¾‹ï¼ˆä¾‹å¦‚30%ï¼‰æ¥åˆ†é…GPU</li><li><em><strong>è™šæ‹Ÿæ˜¾å­˜</strong></em>: ä½ å¯ä»¥è¶…é¢ä½¿ç”¨æ˜¾å­˜ï¼Œå¹¶å°†å†…å­˜å½“ä½œæ˜¾å­˜çš„äº¤æ¢åŒºä½¿ç”¨</li><li><em><strong>æŒ‡å®šGPUå‹å·</strong></em>ï¼šå½“å‰ä»»åŠ¡å¯ä»¥é€šè¿‡è®¾ç½®annotationçš„æ–¹å¼ï¼Œæ¥é€‰æ‹©ä½¿ç”¨æˆ–è€…ä¸ä½¿ç”¨æŸäº›å…·ä½“å‹å·çš„GPU</li><li><em><strong>æ— ä¾µå…¥</strong></em>: vGPUè°ƒåº¦å™¨å…¼å®¹nvidiaå®˜æ–¹æ’ä»¶çš„æ˜¾å¡åˆ†é…æ–¹å¼ï¼Œæ‰€ä»¥å®‰è£…å®Œæ¯•åï¼Œä½ ä¸éœ€è¦ä¿®æ”¹åŸæœ‰çš„ä»»åŠ¡æ–‡ä»¶å°±å¯ä»¥ä½¿ç”¨vGPUçš„åŠŸèƒ½ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå®šä¹‰çš„èµ„æºåç§°</li></ul><h2 id="æ„æ¶è®¾è®¡"><a href="#æ„æ¶è®¾è®¡" class="headerlink" title="æ„æ¶è®¾è®¡"></a>æ„æ¶è®¾è®¡</h2><p>â€‹HAMié¡¹ç›®å®˜ç½‘æ˜¯ï¼š<a href="https://github.com/Project-HAMi/HAMi/tree/master">https://github.com/Project-HAMi/HAMi/tree/master</a> ï¼Œç›®å‰ï¼ˆ2025å¹´1æœˆåˆï¼‰ç¨³å®šç‰ˆæœ¬æ˜¯v2.4.1 ã€‚</p><p>â€‹HAMi åŒ…å«ä»¥ä¸‹å‡ ä¸ªç»„ä»¶ï¼Œä¸€ä¸ªç»Ÿä¸€çš„mutatingwebhookï¼Œä¸€ä¸ªç»Ÿä¸€çš„è°ƒåº¦å™¨ï¼Œä»¥åŠé’ˆå¯¹å„ç§ä¸åŒçš„å¼‚æ„ç®—åŠ›è®¾å¤‡å¯¹åº”çš„è®¾å¤‡æ’ä»¶å’Œå®¹å™¨å†…çš„æ§åˆ¶ç»„ä»¶ï¼Œæ•´ä½“çš„æ¶æ„ç‰¹æ€§å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://s2.loli.net/2024/10/23/tv3nYlgoJLxkRc2.png" alt="hami-arch.png"></p><h1 id="äºŒã€éƒ¨ç½²å‡çº§ä¸å¸è½½"><a href="#äºŒã€éƒ¨ç½²å‡çº§ä¸å¸è½½" class="headerlink" title="äºŒã€éƒ¨ç½²å‡çº§ä¸å¸è½½"></a>äºŒã€éƒ¨ç½²å‡çº§ä¸å¸è½½</h1><h2 id="å®‰è£…è¦æ±‚"><a href="#å®‰è£…è¦æ±‚" class="headerlink" title="å®‰è£…è¦æ±‚"></a>å®‰è£…è¦æ±‚</h2><ul><li>NVIDIA drivers &gt;&#x3D; 440</li><li>nvidia-docker version &gt; 2.0</li><li>docker&#x2F;containerd&#x2F;cri-oï¼Œå·²é…ç½®nvidiaä½œä¸ºé»˜è®¤runtime</li><li>Kubernetes version &gt;&#x3D; 1.16</li><li>glibc &gt;&#x3D; 2.17 &amp; glibc &lt; 2.3.0</li><li>kernel version &gt;&#x3D; 3.10</li><li>helm &gt; 3.0</li></ul><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>â€‹      ä»¥ä¸‹ä»¥å®‰è£…ä¸ä½¿ç”¨HAMi2.4.0ä¸ºä¾‹è¿›è¡Œè¯´æ˜ã€‚</p><h3 id="æ‰§è¡Œå®‰è£…"><a href="#æ‰§è¡Œå®‰è£…" class="headerlink" title="æ‰§è¡Œå®‰è£…"></a>æ‰§è¡Œå®‰è£…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹k8sç‰ˆæœ¬</span><br>root@controller01:~# kubectl version --short<br>Client Version: v1.23.10<br>Server Version: v1.23.10<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é¦–å…ˆéœ€è¦å°†æ‰€æœ‰è¦ä½¿ç”¨åˆ°çš„GPUèŠ‚ç‚¹æ‰“ä¸Šgpu=onæ ‡ç­¾ï¼Œæ²¡æœ‰æ­¤æ ‡ç­¾çš„k8sèŠ‚ç‚¹ä¼šè¢«HAMiå¿½ç•¥</span>Â <br>root@controller01:~# kubectl label node &#123;nodename&#125; gpu=on<br><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨ helm ä¸­æ·»åŠ hami chartä»“åº“</span><br>root@controller01:~# helm repo add hami-charts https://project-hami.github.io/HAMi/<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œéƒ¨ç½²#å¹¶å®¢åˆ¶åŒ–å‚æ•°,resourceNameæ˜¯ç”³è¯·vgpuä¸ªæ•°çš„èµ„æºåï¼Œé»˜è®¤å€¼æ˜¯<span class="hljs-string">&quot;nvidia.com/gpu&quot;</span>ï¼Œå®ƒè·ŸNVIDIA device pulginå®‰è£…åç”Ÿæˆçš„èµ„æºåä¸€æ ·ï¼Œä¸ºäº†åŒºåˆ«äºŒè€…ï¼Œæ­¤å¤„å°†å…¶å®¢åˆ¶åŒ–ä¸º<span class="hljs-string">&quot;nvidia.com/vgpu&quot;</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å‚æ•°â€œ--version 2.4.0â€œæ˜¯æŒ‡å®šæ­¤æ¬¡å®‰è£…çš„ HAMi ç‰ˆæœ¬ï¼Œå¦‚æœä¸æŒ‡å®šçš„è¯ï¼Œé»˜è®¤å®‰è£…æœ€æ–°ç‰ˆæœ¬2.4.1</span><br>root@controller01:~# helm install hami hami-charts/hami --set resourceName=nvidia.com/vgpu -n kube-system --version 2.4.0<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…è€—æ—¶å¯èƒ½è¦å‡ åˆ†é’Ÿï¼Œå®‰è£…å®Œæˆæ—¶è¾“å‡ºå¦‚ä¸‹</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/04/R97Z1IEfsA82gop.png" alt="image-20250104180859741"></p><p>â€‹      ä¸Šè¿°â€œhelm installâ€å‘½ä»¤å¯ä»¥å®¢åˆ¶åŒ–çš„å‚æ•°è¾ƒå¤šï¼Œæ¯”å¦‚ï¼š</p><ul><li><p>devicePlugin.deviceSplitCount: </p><p>æ•´æ•°ç±»å‹ï¼Œé¢„è®¾å€¼æ˜¯10ã€‚GPUçš„åˆ†å‰²æ•°ï¼Œæ¯ä¸€å¼ GPUéƒ½ä¸èƒ½åˆ†é…è¶…è¿‡å…¶é…ç½®æ•°ç›®çš„ä»»åŠ¡ã€‚è‹¥å…¶é…ç½®ä¸ºNçš„è¯ï¼Œæ¯ä¸ªGPUä¸Šæœ€å¤šå¯ä»¥åŒæ—¶å­˜åœ¨Nä¸ªä»»åŠ¡</p></li><li><p>resourceMemPercentage: </p><p>å­—ç¬¦ä¸²ç±»å‹ï¼Œç”³è¯·vgpuæ˜¾å­˜æ¯”ä¾‹èµ„æºåï¼Œé»˜è®¤: â€œnvidia.com&#x2F;gpumem-percentageâ€</p></li><li><p>å…¶ä»–å¯å®¢åˆ¶åŒ–å‚æ•°</p><p>å¯ä»¥ç›´æ¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://github.com/Project-HAMi/HAMi/blob/v2.4.0/docs/config_cn.md">https://github.com/Project-HAMi/HAMi/blob/v2.4.0/docs/config_cn.md</a></p></li></ul><h3 id="ç¡®è®¤å®‰è£…æƒ…å†µ"><a href="#ç¡®è®¤å®‰è£…æƒ…å†µ" class="headerlink" title="ç¡®è®¤å®‰è£…æƒ…å†µ"></a>ç¡®è®¤å®‰è£…æƒ…å†µ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">1.æŸ¥çœ‹å·²å‘å¸ƒç‰ˆæœ¬</span><br>root@controller01:~# helm -n kube-system list<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/04/ctSBKe8RwQLW2Go.png" alt="image-20250104180953889"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">2.æŸ¥çœ‹k8sé›†ç¾¤å†…èµ„æºå¯¹è±¡ï¼Œæ­£å¸¸æƒ…å†µç±»ä¼¼å¦‚ä¸‹</span><br>root@controller01:~# kubectl -n kube-system get all -l app.kubernetes.io/component<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ¯ä¸ªè¢«æ‰“äº†æ ‡ç­¾â€œgpu=onâ€çš„k8sèŠ‚ç‚¹ä¸Šéƒ½ä¼šæœ‰ä¸€ä¸ªåä¸ºhami-device-plugin-xxxçš„podï¼›</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åŒæ—¶ä¼šæœ‰ä¸€ä¸ªåä¸ºhami-scheduler-xxx çš„pod</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¼šæœ‰hami-device-plugin-monitorã€hami-schedulerä¸¤ä¸ªservice</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¼šæœ‰ä¸€ä¸ªåä¸ºhami-device-pluginçš„daemonset</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¼šæœ‰ä¸€ä¸ªåä¸ºhami-schedulerçš„deployment</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¼šæœ‰ä¸€ä¸ªåä¸ºhami-scheduler-yyyçš„replicaset</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/04/CjbYI6nHcsidKX2.png" alt="image-20250104181215738"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">3.æŸ¥çœ‹k8sèŠ‚ç‚¹æ‹¥æœ‰çš„å±æ€§</span><br>root@controller01:~# kubectl describe node controller01 | more<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/04/PSahwdCeDMj4TOX.png" alt="image-20250104181300572"></p><h2 id="å‡çº§"><a href="#å‡çº§" class="headerlink" title="å‡çº§"></a>å‡çº§</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ¯”å¦‚å…ˆå‰å®‰è£…äº†HAMi2.4.0ç‰ˆæœ¬ï¼Œç°åœ¨æƒ³å‡çº§åˆ°HAMi2.4.1ç‰ˆæœ¬</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰§è¡Œå‡çº§HAMiç‰ˆæœ¬</span><br>root@controller01:~# helm upgrade hami hami-charts/hami Â -n kube-system --version 2.4.1<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/04/MP7qVZ3nfDpQC2s.png" alt="image-20250104181337643"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹å‡çº§åçš„HAMiç‰ˆæœ¬</span><br>root@controller01:~# helm -n kube-system list<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/04/oAMYhT835d4jFqm.png" alt="image-20250104181359099"></p><h2 id="å¸è½½"><a href="#å¸è½½" class="headerlink" title="å¸è½½"></a>å¸è½½</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨ä»»æ„ç›®å½•ç›´æ¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯</span><br>root@controller01:~# helm uninstall hami -n kube-system<br></code></pre></td></tr></table></figure><h1 id="ä¸‰ã€ç®€å•ä½¿ç”¨"><a href="#ä¸‰ã€ç®€å•ä½¿ç”¨" class="headerlink" title="ä¸‰ã€ç®€å•ä½¿ç”¨"></a>ä¸‰ã€ç®€å•ä½¿ç”¨</h1><h2 id="ç®€å•ç”¨æ³•è®²è§£"><a href="#ç®€å•ç”¨æ³•è®²è§£" class="headerlink" title="ç®€å•ç”¨æ³•è®²è§£"></a>ç®€å•ç”¨æ³•è®²è§£</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:~# vi gpu-test3.yaml<br>apiVersion: v1<br>kind: Pod<br>metadata:<br>  name: gpu-test3-01<br>spec:<br>  restartPolicy: OnFailure<br>  nodeSelector:<br>    gpu: &quot;on&quot;<br>  containers:<br>    - name: gpu-test<br>      imagePullPolicy: IfNotPresent<br>      #æ­¤é•œåƒä¸­å°è£…çš„æ˜¯ä¸€ä¸ªåŸºäºpytorch2.2.2çš„å›¾åƒè¯†åˆ«æ¨¡å‹è®­ç»ƒç¨‹åº<br>      image: monkjiang/ubuntu2004:pytorch2.2.2-classification-example<br>      command:<br>        - python3<br>        - /opt/classification/train.py<br>      resources:<br>        limits:<br>          nvidia.com/vgpu: 2 # è¯·æ±‚2ä¸ªvGPUs<br>          #nvidia.com/gpumem: 3000 # æ¯ä¸ªvGPUç”³è¯·çš„æ˜¾å­˜å¤§å°ï¼ˆåªèƒ½æ˜¯æ•´æ•°å€¼ï¼Œå•ä½æ˜¯MBï¼‰<br>          nvidia.com/gpumem-percentage: 50 # æ¯ä¸ªvGPUç”³è¯·çš„æ˜¾å­˜æ˜¯æ‰€åœ¨ç‰©ç†GPUçš„50%ï¼ˆä¸èƒ½è·Ÿnvidia.com/gpumemä¸€èµ·ç”¨ï¼‰<br>          nvidia.com/gpucores: 30 # æ¯ä¸ªvGPUçš„åˆ©ç”¨ç‡ä¸Šé™ä¸ºç‰©ç†GPUçš„30%<br>          #nvidia.com/priority: 0 # åªæœ‰ä¸¤ç§ä¼˜å…ˆçº§ï¼š0è¡¨ç¤ºé«˜ä¼˜å…ˆçº§ï¼Œ1è¡¨ç¤ºä½ä¼˜å…ˆçº§ï¼Œé»˜è®¤æ˜¯1<br>          #é™¤éä¸å…¶ä»–é«˜ä¼˜å…ˆçº§taskå…±äº«åŒä¸€ä¸ªGPUèŠ‚ç‚¹ï¼Œå¦åˆ™é«˜ä¼˜å…ˆçº§taskçš„resourceCoresæ²¡æœ‰è½¯ä¸Šé™ï¼ˆThe utilization of high priority task won&#x27;t be limited to resourceCores unless sharing GPU node with other high priority tasks.ï¼‰<br>          #å¦‚æœæ²¡æœ‰å…¶ä»–taskå…±äº«åŒä¸€ä¸ªç‰©ç†GPUï¼Œä½ä¼˜å…ˆçº§taskçš„resourceCoresæ²¡æœ‰è½¯ä¸Šé™ï¼ˆThe utilization of low priority task won&#x27;t be limited to resourceCores if no other tasks sharing its GPU.ï¼‰<br><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯ä»¥åœ¨ä¸Šè¿°yamlæ–‡ä»¶çš„ metadata ä¸­æ·»åŠ annotationsï¼Œå®ç°å¯¹å¼‚æ„èµ„æºçš„è‡ªå®šä¹‰ä½¿ç”¨   annotations:</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">metadata:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"> annotations:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   nvidia.com/nouse-gputype: <span class="hljs-string">&quot;A40&quot;</span> <span class="hljs-comment">#æŒ‡å®šGPUå‹å·é»‘åå•</span></span>     <br><span class="hljs-meta prompt_"># </span><span class="language-bash">   nvidia.com/use-gputype: <span class="hljs-string">&quot;A40&quot;</span> <span class="hljs-comment">#æŒ‡å®šGPUå‹å·ç™½åå•</span></span>     <br><span class="hljs-meta prompt_"># </span><span class="language-bash">   nvidia.com/nouse-gpuuuid: <span class="hljs-string">&quot;GPU-cfca7d85-be74-7c22-4385-6fd15d698cb4&quot;</span> <span class="hljs-comment">#æŒ‡å®šGPU uuidä½¿ç”¨é»‘åå•</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   nvidia.com/use-gpuuuid: <span class="hljs-string">&quot;GPU-2e240d3e-69be-8cec-3ffc-d9da5cc7b8c3&quot;</span>   <span class="hljs-comment">#æŒ‡å®šGPU uuidä½¿ç”¨ç™½åå•</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   hami.io/node-scheduler-policy: <span class="hljs-string">&quot;spread&quot;</span> <span class="hljs-comment">#é¢„è®¾å€¼ä¸º&quot;binpack&quot;, è¡¨ç¤ºGPUèŠ‚ç‚¹è°ƒåº¦ç­–ç•¥ï¼Œ&quot;binpack&quot;è¡¨ç¤ºå°½é‡å°†ä»»åŠ¡åˆ†é…åˆ°åŒä¸€ä¸ªGPUèŠ‚ç‚¹ä¸Šï¼Œ&quot;spread&quot;è¡¨ç¤ºå°½é‡å°†ä»»åŠ¡åˆ†é…åˆ°ä¸åŒGPUèŠ‚ç‚¹ä¸Š</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   hami.io/gpu-scheduler-policy: <span class="hljs-string">&quot;binpack&quot;</span> <span class="hljs-comment">#é¢„è®¾å€¼ä¸º&quot;spread&quot;,è¡¨ç¤ºGPUè°ƒåº¦ç­–ç•¥ï¼Œ&quot;binpack&quot;è¡¨ç¤ºå°½é‡å°†ä»»åŠ¡åˆ†é…åˆ°åŒä¸€ä¸ªGPUä¸Šï¼Œ&quot;spread&quot;è¡¨ç¤ºå°½é‡å°†ä»»åŠ¡åˆ†é…åˆ°ä¸åŒGPUä¸Š</span></span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åº”ç”¨ä¸Šè¿°æ–‡ä»¶</span><br>root@controller01:~# kubectl apply -f gpu-test3.yaml <br>pod/gpu-test3-01 created<br><br>root@controller01:~# kubectl get pods -o wide<br>NAME                  READY   STATUS    RESTARTS        AGE   IP              NODE           NOMINATED NODE   READINESS GATES<br>gpu-test3-01          1/1     Running   0               11s   10.233.81.115   controller01   &lt;none&gt;           &lt;none&gt;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯ä»¥çœ‹åˆ°pod/gpu-test3-01çš„å®¿ä¸»æœºæ˜¯controller01ï¼Œä¸Šé¢æœ‰ä¸€ä¸ªGPUè¿›ç¨‹</span><br>root@controller01:~# nvidia-smi <br>Wed Oct 23 15:35:58 2024       <br>+-----------------------------------------------------------------------------------------+<br>| NVIDIA-SMI 550.54.15              Driver Version: 550.54.15      CUDA Version: 12.4     |<br>|-----------------------------------------+------------------------+----------------------+<br>| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |<br>| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |<br>|                                         |                        |               MIG M. |<br>|=========================================+========================+======================|<br>|   0  NVIDIA XXX                     Off |   00000000:41:00.0 Off |                    0 |<br>|  0%   45C    P0            111W /  300W |     682MiB /  46068MiB |     16%      Default |<br>|                                         |                        |                  N/A |<br>+-----------------------------------------+------------------------+----------------------+<br>|   1  NVIDIA XXX                     Off |   00000000:C1:00.0 Off |                    0 |<br>|  0%   35C    P8             29W /  300W |       3MiB /  46068MiB |      0%      Default |<br>|                                         |                        |                  N/A |<br>+-----------------------------------------+------------------------+----------------------+<br>                                                                                         <br>+-----------------------------------------------------------------------------------------+<br>| Processes:                                                                              |<br>|  GPU   GI   CI        PID   Type   Process name                              GPU Memory |<br>|        ID   ID                                                               Usage      |<br>|=========================================================================================|<br>|    0   N/A  N/A     28054      C   python3                                       674MiB |<br>+-----------------------------------------------------------------------------------------+<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">è¿›å…¥podçš„å®¹å™¨å†…éƒ¨æŸ¥çœ‹ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªvGPUï¼Œå®ƒä»¬çš„æ˜¾å­˜éƒ½åªæœ‰23034MiBã€‚è™½ç„¶ç”³è¯·äº†ä¸¤ä¸ªvGPUï¼Œä½†å…¶å®åªæœ‰0å·vGPUè¢«ä½¿ç”¨äº†ï¼Œå®ƒçš„GPUä½¿ç”¨ç‡æ˜¯15%ï¼Œä¸´æ—¶åŠŸç‡æ˜¯113W</span><br>root@controller01:/opt/installPkgs/k8s-vgpu-basedon-HAMi# kubectl exec -it gpu-test3-01 -- bash<br>root@gpu-test3-01:/opt/classification# nvidia-smi <br>[HAMI-core Msg(281:140275770877760:libvgpu.c:836)]: Initializing.....<br>Wed Oct 23 07:36:22 2024       <br>+-----------------------------------------------------------------------------------------+<br>| NVIDIA-SMI 550.54.15              Driver Version: 550.54.15      CUDA Version: 12.4     |<br>|-----------------------------------------+------------------------+----------------------+<br>| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |<br>| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |<br>|                                         |                        |               MIG M. |<br>|=========================================+========================+======================|<br>|   0  NVIDIA XXX                     Off |   00000000:41:00.0 Off |                    0 |<br>|  0%   49C    P0            113W /  300W |     612MiB /  23034MiB |     15%      Default |<br>|                                         |                        |                  N/A |<br>+-----------------------------------------+------------------------+----------------------+<br>|   1  NVIDIA XXX                     Off |   00000000:C1:00.0 Off |                    0 |<br>|  0%   35C    P8             29W /  300W |       0MiB /  23034MiB |      0%      Default |<br>|                                         |                        |                  N/A |<br>+-----------------------------------------+------------------------+----------------------+<br>                                                                                         <br>+-----------------------------------------------------------------------------------------+<br>| Processes:                                                                              |<br>|  GPU   GI   CI        PID   Type   Process name                              GPU Memory |<br>|        ID   ID                                                               Usage      |<br>|=========================================================================================|<br>+-----------------------------------------------------------------------------------------+<br>[HAMI-core Msg(281:140275770877760:multiprocess_memory_limit.c:468)]: Calling exit handler 281<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹podæ—¥å¿—</span><br>root@controller01:~# kubectl logs gpu-test3-01 | more<br>[HAMI-core Msg(1:140168594040448:libvgpu.c:836)]: Initializing.....<br>2024-10-23 07:35:46.333 | INFO     | __main__:&lt;module&gt;:97 - Namespace(batch_size=32, epochs=10, lr=0.01, save_dir=&#x27;./output&#x27;, train_data_dir=&#x27;./data/cifar10/train&#x27;, val_data<br>_dir=&#x27;./data/cifar10/val&#x27;, weights=None)<br>[HAMI-core Warn(1:140168594040448:utils.c:183)]: get default cuda from (null)<br>[HAMI-core Msg(1:140168594040448:libvgpu.c:855)]: Initialized<br>2024-10-23 07:35:46.643 | INFO     | __main__:main:21 - Using device: cuda<br>2024-10-23 07:35:47.103 | INFO     | __main__:main:50 - Epoch: 1/10<br>2024-10-23 07:35:47.104 | INFO     | __main__:main:52 - Training<br>[HAMI-core Msg(1:140168594040448:memory.c:511)]: orig free=47283240960 total=47608692736 limit=24152899584 usage=310526720<br>[HAMI-core Msg(1:140168594040448:memory.c:511)]: orig free=47216132096 total=47608692736 limit=24152899584 usage=331498240<br>[HAMI-core Msg(1:140168594040448:memory.c:511)]: orig free=47195160576 total=47608692736 limit=24152899584 usage=352469760<br>[HAMI-core Msg(1:140168594040448:memory.c:511)]: orig free=47060942848 total=47608692736 limit=24152899584 usage=486687488<br>[HAMI-core Msg(1:140168594040448:memory.c:511)]: orig free=46924627968 total=47608692736 limit=24152899584 usage=623002368<br>[HAMI-core Msg(1:140168594040448:memory.c:511)]: orig free=47056748544 total=47608692736 limit=24152899584 usage=488784640<br>[HAMI-core Msg(1:140168594040448:memory.c:511)]: orig free=47054651392 total=47608692736 limit=24152899584 usage=490881792<br>[HAMI-core Msg(1:140168594040448:memory.c:511)]: orig free=46916239360 total=47608692736 limit=24152899584 usage=629293824<br>[HAMI-core Msg(1:140168594040448:memory.c:511)]: orig free=47031582720 total=47608692736 limit=24152899584 usage=513950464<br>[HAMI-core Msg(1:140168594040448:memory.c:511)]: orig free=47029485568 total=47608692736 limit=24152899584 usage=516047616<br>2024-10-23 07:35:47.801 | INFO     | __main__:main:60 - Step: 1 Loss: 2.342037<br>[HAMI-core Msg(1:140164068443904:memory.c:511)]: orig free=46995931136 total=47608692736 limit=24152899584 usage=543723008<br>[HAMI-core Msg(1:140164068443904:memory.c:511)]: orig free=46998028288 total=47608692736 limit=24152899584 usage=541625856<br>[HAMI-core Msg(1:140164068443904:memory.c:511)]: orig free=46995931136 total=47608692736 limit=24152899584 usage=541625856<br>[HAMI-core Msg(1:140164068443904:memory.c:511)]: orig free=46863810560 total=47608692736 limit=24152899584 usage=673746432<br>[HAMI-core Msg(1:140164068443904:memory.c:511)]: orig free=46995931136 total=47608692736 limit=24152899584 usage=541625856<br>[HAMI-core Msg(1:140164068443904:memory.c:511)]: orig free=46998028288 total=47608692736 limit=24152899584 usage=539528704<br>[HAMI-core Msg(1:140164068443904:memory.c:511)]: orig free=46998028288 total=47608692736 limit=24152899584 usage=539528704<br>[HAMI-core Msg(1:140164068443904:memory.c:511)]: orig free=47012708352 total=47608692736 limit=24152899584 usage=524848640<br>[HAMI-core Msg(1:140164068443904:memory.c:511)]: orig free=47012708352 total=47608692736 limit=24152899584 usage=524848640<br>[HAMI-core Msg(1:140164068443904:memory.c:511)]: orig free=47014805504 total=47608692736 limit=24152899584 usage=522751488<br>[HAMI-core Msg(1:140164068443904:memory.c:511)]: orig free=47014805504 total=47608692736 limit=24152899584 usage=522751488<br>[HAMI-core Msg(1:140164068443904:memory.c:511)]: orig free=47014805504 total=47608692736 limit=24152899584 usage=522751488<br>[HAMI-core Msg(1:140164068443904:memory.c:511)]: orig free=47014805504 total=47608692736 limit=24152899584 usage=522751488<br>[HAMI-core Msg(1:140164068443904:memory.c:511)]: orig free=46880587776 total=47608692736 limit=24152899584 usage=656969216<br>[HAMI-core Msg(1:140164068443904:memory.c:511)]: orig free=47014805504 total=47608692736 limit=24152899584 usage=522751488<br>[HAMI-core Msg(1:140164068443904:memory.c:511)]: orig free=47014805504 total=47608692736 limit=24152899584 usage=522751488<br>[HAMI-core Msg(1:140164068443904:memory.c:511)]: orig free=47014805504 total=47608692736 limit=24152899584 usage=522751488<br>[HAMI-core Msg(1:140164068443904:memory.c:511)]: orig free=47033679872 total=47608692736 limit=24152899584 usage=501779968<br>[HAMI-core Msg(1:140164068443904:memory.c:511)]: orig free=47033679872 total=47608692736 limit=24152899584 usage=501779968<br>2024-10-23 07:35:48.273 | INFO     | __main__:main:60 - Step: 2 Loss: 2.255279<br>2024-10-23 07:35:48.308 | INFO     | __main__:main:60 - Step: 3 Loss: 2.317460<br>2024-10-23 07:35:48.329 | INFO     | __main__:main:60 - Step: 4 Loss: 2.280499<br>...<br></code></pre></td></tr></table></figure><h2 id="æ›´å¤šå®˜æ–¹ç¤ºä¾‹"><a href="#æ›´å¤šå®˜æ–¹ç¤ºä¾‹" class="headerlink" title="æ›´å¤šå®˜æ–¹ç¤ºä¾‹"></a>æ›´å¤šå®˜æ–¹ç¤ºä¾‹</h2><p>â€‹      å‚è€ƒï¼š<a href="https://github.com/Project-HAMi/HAMi/tree/v2.4.0/examples">https://github.com/Project-HAMi/HAMi/tree/v2.4.0/examples</a></p><h1 id="å››ã€é—®é¢˜æˆ–faq"><a href="#å››ã€é—®é¢˜æˆ–faq" class="headerlink" title="å››ã€é—®é¢˜æˆ–faq"></a>å››ã€é—®é¢˜æˆ–faq</h1><p>å‚è€ƒå®˜ç½‘issuesï¼š<a href="https://github.com/Project-HAMi/HAMi/issues">https://github.com/Project-HAMi/HAMi/issues</a></p><h1 id="äº”ã€èµ„æºç›‘æ§"><a href="#äº”ã€èµ„æºç›‘æ§" class="headerlink" title="äº”ã€èµ„æºç›‘æ§"></a>äº”ã€èµ„æºç›‘æ§</h1><p>å¯ä»¥å‚è€ƒç¬”è€…å½’çº³æ€»ç»“çš„è¿™ç¯‡æ–‡ç« ï¼š <a href="https://jiangsanyin.github.io/2024/10/07/GPU%E8%99%9A%E6%8B%9F%E5%8C%96%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AEHAMi%E4%B8%AD%E4%BD%BF%E7%94%A8prometheus%E4%B8%8Egrafana%E5%81%9A%E7%9B%91%E6%8E%A7/">https://jiangsanyin.github.io/2024/10/07/GPU%E8%99%9A%E6%8B%9F%E5%8C%96%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AEHAMi%E4%B8%AD%E4%BD%BF%E7%94%A8prometheus%E4%B8%8Egrafana%E5%81%9A%E7%9B%91%E6%8E%A7/</a> ï¼Œ å»ºè®®ç›´æ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚æ­¤ç›‘æ§ç›¸å…³æ–‡æ¡£ç”±ç¬”è€…è‡ªå·±ç¼–å†™ï¼Œå·²ç»æäº¤ç»™HAMiå®˜æ–¹é¡¹ç›®ä»“åº“ã€å½“å‰è¢«HAMiå®˜æ–¹é¡¹ç›®ä»“åº“æ¥å—å¹¶åˆå…¥ä¸»çº¿åˆ†æ”¯ä¸­ã€‚</p><h1 id="å…­ã€æ›´æ–°ä¸å‚è€ƒ"><a href="#å…­ã€æ›´æ–°ä¸å‚è€ƒ" class="headerlink" title="å…­ã€æ›´æ–°ä¸å‚è€ƒ"></a>å…­ã€æ›´æ–°ä¸å‚è€ƒ</h1><p>   åç»­å¦‚æœ‰ä¿®æ­£æˆ–å®Œå–„ï¼Œå°†ç»§ç»­æ›´æ–°ã€‚å¯èƒ½åç»­ä¼šå‘è¡¨HAMiç³»åˆ—å­¦ä¹ è®°å½•ã€‚</p><h1 id="ä¸ƒã€å‚è€ƒèµ„æº"><a href="#ä¸ƒã€å‚è€ƒèµ„æº" class="headerlink" title="ä¸ƒã€å‚è€ƒèµ„æº"></a>ä¸ƒã€å‚è€ƒèµ„æº</h1><ul><li>HAMiä»£ç ä»“åº“ï¼š<a href="https://github.com/Project-HAMi/HAMi">https://github.com/Project-HAMi/HAMi</a></li><li>é¡¹ç›®å®˜ç½‘ï¼š<a href="https://project-hami.io/">https://project-hami.io/</a></li><li>å®˜æ–¹å…¬ä¼—å·ï¼šâ€œHAMi Projectâ€</li><li>KubeSphere Bç«™å®˜æ–¹è´¦å·å‘è¡¨çš„ä¸€ä¸ªä»¥HAMiä¸ºä¸»é¢˜çš„æ¨è®²è§†é¢‘ï¼Œåœ¨2024-12-31 ä¸‹åˆå‘å¸ƒ</li></ul>]]></content>
    
    
    <categories>
      
      <category>ç®—åŠ›è™šæ‹ŸåŒ–ä¸­é—´ä»¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>HAMi GPU åŠ é€Ÿå¡ è™šæ‹ŸåŒ– å¼‚æ„ç®—åŠ›è™šæ‹ŸåŒ–ä¸­é—´ä»¶ kubernetes k8s</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åœ¨PCä¸Šä¸‹è½½åº”ç”¨å®‰å“ç‰ˆå®‰è£…åŒ…</title>
    <link href="/2024/10/21/%E5%9C%A8PC%E4%B8%8A%E4%B8%8B%E8%BD%BD%E5%BA%94%E7%94%A8%E5%AE%89%E5%8D%93%E7%89%88%E5%AE%89%E8%A3%85%E5%8C%85/"/>
    <url>/2024/10/21/%E5%9C%A8PC%E4%B8%8A%E4%B8%8B%E8%BD%BD%E5%BA%94%E7%94%A8%E5%AE%89%E5%8D%93%E7%89%88%E5%AE%89%E8%A3%85%E5%8C%85/</url>
    
    <content type="html"><![CDATA[<h1 id="æ–¹æ³•ä¸€ã€ä½¿ç”¨ç½‘ç«™cn-aptoide-com"><a href="#æ–¹æ³•ä¸€ã€ä½¿ç”¨ç½‘ç«™cn-aptoide-com" class="headerlink" title="æ–¹æ³•ä¸€ã€ä½¿ç”¨ç½‘ç«™cn.aptoide.com"></a>æ–¹æ³•ä¸€ã€ä½¿ç”¨ç½‘ç«™cn.aptoide.com</h1><p>è®¿é—®<a href="https://cn.aptoide.com/%EF%BC%8C%E8%BE%93%E5%85%A5%E8%87%AA%E5%B7%B1%E6%83%B3%E8%A6%81%E5%AE%89%E8%A3%85%E7%9A%84%E5%AE%89%E5%8D%93%E5%BA%94%E7%94%A8%E5%90%8D%E7%A7%B0%E8%BF%9B%E8%A1%8C%E6%90%9C%E7%B4%A2%EF%BC%8C%E7%84%B6%E5%90%8E%E4%B8%8B%E8%BD%BD">https://cn.aptoide.com/ï¼Œè¾“å…¥è‡ªå·±æƒ³è¦å®‰è£…çš„å®‰å“åº”ç”¨åç§°è¿›è¡Œæœç´¢ï¼Œç„¶åä¸‹è½½</a></p><h1 id="æ–¹æ³•äºŒã€ä½¿ç”¨ç½‘ç«™apk-support"><a href="#æ–¹æ³•äºŒã€ä½¿ç”¨ç½‘ç«™apk-support" class="headerlink" title="æ–¹æ³•äºŒã€ä½¿ç”¨ç½‘ç«™apk.support"></a>æ–¹æ³•äºŒã€ä½¿ç”¨ç½‘ç«™apk.support</h1><p> 1ã€å½“å°è¯•å»è°·æ­Œåº”ç”¨å•†åº—ï¼ˆç½‘å€ï¼š<a href="https://play.google.com/store/apps%EF%BC%89%E4%B8%8B%E8%BD%BD%E6%9F%90%E8%BD%AF%E4%BB%B6%E7%9A%84android%E7%89%88%E6%9C%AC%E5%B0%B1%E4%BC%9A%E6%8F%90%E7%A4%BA%E5%A6%82%E4%B8%8B%E4%BF%A1%E6%81%AF%EF%BC%9A">https://play.google.com/store/appsï¼‰ä¸‹è½½æŸè½¯ä»¶çš„androidç‰ˆæœ¬å°±ä¼šæç¤ºå¦‚ä¸‹ä¿¡æ¯ï¼š</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ¯”å¦‚<span class="hljs-string">&quot;Google Chrome æµè§ˆå™¨&quot;</span>åœ¨è°·æ­Œåº”ç”¨å•†åº—çš„ä¸‹è½½é¡µé¢æ˜¯å¦‚ä¸‹</span><br>https://play.google.com/store/apps/details?id=com.android.chrome<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½†å½“å°è¯•ä¸‹è½½å®‰è£…æ—¶ï¼Œå°±ä¼šæç¤ºå¦‚ä¸‹ä¿¡æ¯</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/10/22/IwLMgGJoq15clOX.png" alt="image-20241022154431990"></p><p>2ã€æ‰“å¼€å¦‚ä¸‹ç½‘é¡µï¼Œå°†ä¸Šè¿°urlå¤åˆ¶åˆ°å¦‚ä¸‹è¾“å…¥æ¡†ä¸­ï¼Œå›è½¦è§£æ</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-meta">#PC googleæµè§ˆå™¨ä¸­æ‰“å¼€å¦‚ä¸‹ç½‘ç«™</span><br><span class="hljs-symbol">https:</span>//apk.support/apk-downloader?screen=welcome&amp;utm_source=chrome-extension<span class="hljs-meta">#google_vignette</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/10/22/wIG5sYDPpWb4KZu.png" alt="image-20241022154811789"></p><p>3ã€å•å‡»ä¸Šå›¾ä¸­çš„â€œgoogle-chrome.apkâ€å³å¯ä¸‹è½½è½¯ä»¶çš„apkå®‰è£…åŒ…ï¼Œæ­¤å®‰è£…åŒ…å³å¯åœ¨androidæ‰‹æœºä¸Šå®‰è£…ã€‚</p><p>4ã€ä½†ä¹Ÿé‡åˆ°è¿‡æœ‰æ—¶ä¸‹è½½çš„apkæ— æ³•æˆåŠŸåœ¨androidæ‰‹æœºä¸Šå®‰è£…æˆåŠŸï¼Œå¯å°è¯•å»æ‰¾å…¶ä»–ç‰ˆæœ¬çš„apkå®‰è£…åŒ…ï¼Œå…·ä½“æ–¹æ³•æš‚æ—¶æœªçŸ¥ï¼š</p>]]></content>
    
    
    <categories>
      
      <category>æ‚è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PC ä¸‹è½½andoridå®‰è£…åŒ…</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GPUè™šæ‹ŸåŒ–å¼€æºé¡¹ç›®HAMiä¸­ä½¿ç”¨prometheusä¸grafanaåšç›‘æ§</title>
    <link href="/2024/10/07/GPU%E8%99%9A%E6%8B%9F%E5%8C%96%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AEHAMi%E4%B8%AD%E4%BD%BF%E7%94%A8prometheus%E4%B8%8Egrafana%E5%81%9A%E7%9B%91%E6%8E%A7/"/>
    <url>/2024/10/07/GPU%E8%99%9A%E6%8B%9F%E5%8C%96%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AEHAMi%E4%B8%AD%E4%BD%BF%E7%94%A8prometheus%E4%B8%8Egrafana%E5%81%9A%E7%9B%91%E6%8E%A7/</url>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯ä¸è¯´æ˜"><a href="#èƒŒæ™¯ä¸è¯´æ˜" class="headerlink" title="èƒŒæ™¯ä¸è¯´æ˜"></a>èƒŒæ™¯ä¸è¯´æ˜</h1><p>â€‹HAMiï¼Œæ˜¯ä¸€ä¸ªå›½äº§çš„GPUä¸å›½äº§åŠ é€Ÿå¡ï¼ˆæ”¯æŒçš„GPUä¸å›½äº§åŠ é€Ÿå¡å‹å·ä¸å…·ä½“ç‰¹æ€§è¯·æŸ¥çœ‹æ­¤é¡¹ç›®å®˜ç½‘ï¼š <a href="https://github.com/Project-HAMi/HAMi/">https://github.com/Project-HAMi/HAMi/</a> ï¼‰è™šæ‹ŸåŒ–å¼€æºé¡¹ç›®ï¼Œå®ç°ä»¥kubernetesä¸ºåŸºç¡€çš„å®¹å™¨åœºæ™¯ä¸‹GPUæˆ–åŠ é€Ÿå¡è™šæ‹ŸåŒ–ã€‚HAMiåŸåâ€œk8s-vGPU-schedulerâ€ï¼Œæœ€åˆç”±ç¬¬å››èŒƒå¼å…¬å¸å¼€æºï¼Œç°å·²åœ¨å›½å†…ä¸å›½é™…ä¸Šæ„ˆåŠ æµè¡Œï¼Œæ˜¯ç®¡ç†Kubernetesä¸­å¼‚æ„è®¾å¤‡çš„ä¸­é—´ä»¶ã€‚å®ƒå¯ä»¥ç®¡ç†ä¸åŒç±»å‹çš„å¼‚æ„è®¾å¤‡ï¼ˆå¦‚GPUã€NPUç­‰ï¼‰ï¼Œåœ¨Podä¹‹é—´å…±äº«å¼‚æ„è®¾å¤‡ï¼Œæ ¹æ®è®¾å¤‡çš„æ‹“æ‰‘ä¿¡æ¯å’Œè°ƒåº¦ç­–ç•¥åšå‡ºæ›´å¥½çš„è°ƒåº¦å†³ç­–ã€‚</p><p>â€‹ä¸ºäº†é˜è¿°çš„ç®€æ˜æ€§ï¼Œæœ¬æ–‡åªæä¾›ä¸€ç§å¯è¡Œçš„åŠæ³•ï¼Œæœ€ç»ˆå®ç°ä½¿ç”¨prometheusæŠ“å–ç›‘æ§æŒ‡æ ‡å¹¶ä½œä¸ºæ•°æ®æºã€ä½¿ç”¨grafanaæ¥å±•ç¤ºç›‘æ§ä¿¡æ¯çš„ç›®çš„ã€‚</p><p>â€‹        æœ¬æ–‡å‡å®šå·²ç»éƒ¨ç½²å¥½Kubernetesé›†ç¾¤ã€HAMiã€‚ä»¥ä¸‹æ¶‰åŠåˆ°çš„ç›¸å…³ç»„ä»¶éƒ½æ˜¯åœ¨kubernetesé›†ç¾¤å†…å®‰è£…çš„ï¼Œç›¸å…³ç»„ä»¶æˆ–è½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯å¦‚ä¸‹ï¼š</p><table><thead><tr><th>ç»„ä»¶æˆ–è½¯ä»¶åç§°</th><th>ç‰ˆæœ¬</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>kubernetesé›†ç¾¤</td><td>v1.23.10</td><td>AMD64æ„æ¶æœåŠ¡å™¨ç¯å¢ƒä¸‹</td></tr><tr><td>HAMi</td><td>æ ¹æ®å‘å¼€æºä½œè€…æé—®ï¼Œå½“å‰HAMiç‰ˆæœ¬å‘è¡Œæœºåˆ¶è¿˜ä¸å¤Ÿæˆç†Ÿï¼Œæš‚ä»¥å®‰è£…HAMiçš„scheduler.kubeScheduler.imageTag å‚æ•°å€¼ä¸ºå…¶ç‰ˆæœ¬ï¼Œæ­¤å€¼è¦è·Ÿkubernetesç‰ˆæœ¬çœ‹é½</td><td>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/Project-HAMi/HAMi/">https://github.com/Project-HAMi/HAMi/</a></td></tr><tr><td>kube-prometheus stack</td><td>åˆ†æ”¯ release-0.11</td><td></td></tr><tr><td>dcgm-exporter</td><td>tag 3.2.5-3.1.7</td><td></td></tr></tbody></table><h1 id="éƒ¨ç½²ä¸é…ç½®kube-prometheus-stack"><a href="#éƒ¨ç½²ä¸é…ç½®kube-prometheus-stack" class="headerlink" title="éƒ¨ç½²ä¸é…ç½®kube-prometheus stack"></a>éƒ¨ç½²ä¸é…ç½®kube-prometheus stack</h1><h2 id="éƒ¨ç½²kube-prometheus-stack"><a href="#éƒ¨ç½²kube-prometheus-stack" class="headerlink" title="éƒ¨ç½²kube-prometheus stack"></a>éƒ¨ç½²kube-prometheus stack</h2><p>**æ³¨ï¼š**kubernetesä¸kube-prometheus stackçš„ç‰ˆæœ¬å…¼å®¹çŸ©é˜µè¯·æŸ¥çœ‹ <a href="https://github.com/prometheus-operator/kube-prometheus?tab=readme-ov-file#compatibility">https://github.com/prometheus-operator/kube-prometheus?tab=readme-ov-file#compatibility</a> ï¼Œè¯·æ ¹æ®è‡ªå·±çš„kubernetesç‰ˆæœ¬é€‰æ‹©åˆé€‚ç‰ˆæœ¬çš„kube-prometheus stack</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹è½½kube-prometheusä»£ç ä»“åº“ï¼ˆæ­¤å¤„ä½¿ç”¨åˆ†æ”¯ release-0.11ï¼‰</span><br>git clone -b release-0.11 https://github.com/prometheus-operator/kube-prometheus.git<br>cd kube-prometheus<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿®æ”¹ä¸‹grafanaçš„serviceç±»å‹ä¸ºNodePortã€‚å³åœ¨specä¸‹æ·»åŠ <span class="hljs-built_in">type</span>é…ç½®é¡¹</span><br>vi manifests/grafana-service.yaml<br>...<br>spec:<br>  type: NodePort<br>...<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç±»ä¼¼çš„æ–¹æ³•ä¿®æ”¹prometheusä¸alertmanager serviceç±»å‹ä¸ºNodePortï¼Œå®ƒä»¬çš„é…ç½®æ–‡ä»¶åˆ†åˆ«æ˜¯manifestsç›®å½•ä¸‹çš„prometheus-service.yamlä¸alertmanager-service.yaml</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰§è¡Œéƒ¨ç½²</span><br>kubectl create -f manifests/setup/<br>kubectl create -f manifests/.<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»ºçš„æ‰€æœ‰èµ„æºå¯¹è±¡éƒ½åœ¨monitorinå‘½åç©ºé—´ä¸‹ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹èµ„æºå¯¹è±¡çš„è¿è¡ŒçŠ¶æ€</span><br>kubectl -n monitoring get all<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ç­‰monitorinå‘½åç©ºé—´ä¸‹æ‰€æœ‰èµ„æºå¯¹è±¡å¤„äºæ­£å¸¸è¿è¡ŒçŠ¶æ€åï¼Œä½¿ç”¨å¦‚ä¸‹æ–¹å¼è·å–grafanaã€prometheusä¸alertmanagerçš„svcä¿¡æ¯</span><br>root@controller01:~/kube-prometheus# kubectl -n monitoring get svc | egrep &quot;NAME|grafana|prometheus-k8s|alertmanager-main&quot;<br>NAME                    TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                         AGE<br>alertmanager-main       NodePort    10.233.5.65     &lt;none&gt;        9093:30093/TCP,8080:30401/TCP   19h<br>grafana                 NodePort    10.233.56.112   &lt;none&gt;        3000:30300/TCP                  19h<br>prometheus-k8s          NodePort    10.233.38.113   &lt;none&gt;        9090:30090/TCP,8080:31273/TCP   19h<br></code></pre></td></tr></table></figure><p>â€‹æ­¤æ—¶ï¼Œå‡å¦‚æ§åˆ¶èŠ‚ç‚¹çš„ipæ˜¯10.0.0.21ï¼Œåˆ™å¯ä»¥åˆ†åˆ«ä½¿ç”¨å¦‚ä¸‹urlè®¿é—®grafanaã€prometheusä¸alertmanagerï¼š<a href="http://10.0.0.21:30300/">http://10.0.0.21:30300</a> ã€<a href="http://10.0.0.21:30090/">http://10.0.0.21:30090</a> ã€<a href="http://10.0.0.21:30093/">http://10.0.0.21:30093</a> ï¼Œå…¶ä¸­è®¿é—®grafanaçš„é»˜è®¤ç”¨æˆ·åä¸å¯†ç éƒ½æ˜¯admin</p><p>â€‹        ç¬”è€…åæ¥åœ¨éƒ¨ç½²å¥½ä¸Šè¿° kube-prometheus stackåï¼Œå‘ç° è‡ªå·±ç¬”è®°æœ¬ç”µè„‘è®¿é—®prometheusçš„nodeport-service+portæ—¶ æç¤ºè¿æ¥è¶…æ—¶ï¼Œä½†åœ¨k8sé›†ç¾¤å†…éƒ¨è®¿é—®æ§åˆ¶èŠ‚ç‚¹+service&#x2F;prometheus-k8såŠ portã€service&#x2F;prometheus-k8sçš„cluster-ipåŠ portã€pod&#x2F;prometheus-k8s-xxxåŠ 3000ç«¯å£éƒ½æ²¡æœ‰é—®é¢˜ã€‚æ­¤æ—¶å¯ä»¥æ£€æŸ¥ ä¸‹networkpoliciesï¼Œå¦‚æœä½ çŸ¥é“ä¿®æ”¹networkpoliciesè§„åˆ™è¯·ç›´æ¥ä¿®æ”¹ï¼Œå¦åˆ™å¯ä»¥ç›´æ¥åˆ é™¤ç›¸å…³networkpoliciesï¼Œä¹‹ååœ¨è‡ªå·±ç¬”è®°æœ¬ç”µè„‘ä¸Šè®¿é—®grafanaã€prometheusä¸alertmanagerç›¸å…³ç•Œé¢å°±æ­£å¸¸äº†ã€‚</p><p><img src="https://s2.loli.net/2025/01/10/MQaK3mRcvFzUxfC.png" alt="image-20250110161557368"></p><h2 id="é…ç½®grafana"><a href="#é…ç½®grafana" class="headerlink" title="é…ç½®grafana"></a>é…ç½®grafana</h2><h3 id="åˆ›å»ºæ•°æ®æºALL"><a href="#åˆ›å»ºæ•°æ®æºALL" class="headerlink" title="åˆ›å»ºæ•°æ®æºALL"></a>åˆ›å»ºæ•°æ®æºALL</h3><p>â€‹è®¿é—®â€Configurationâ€œ-&gt;â€œData soutcesâ€é¡µé¢ï¼Œåˆ›å»ºä¸€ä¸ªåä¸ºâ€ALLâ€çš„æ•°æ®æºï¼Œå…¶ä¸­HTTP.URLçš„å€¼ä¿æŒè·Ÿé»˜è®¤åˆ›å»ºçš„æ•°æ®æºâ€œprometheusâ€ä¸­çš„ä¸€æ ·å³å¯ä¸º â€œ<a href="http://prometheus-k8s.monitoring.svc:9090â€">http://prometheus-k8s.monitoring.svc:9090â€</a> ï¼Œç„¶åä¿å­˜ä¸Šè¿°æ•°æ®æºâ€œALLâ€</p><h3 id="å¯¼å…¥HAMié»˜è®¤çš„dashboard"><a href="#å¯¼å…¥HAMié»˜è®¤çš„dashboard" class="headerlink" title="å¯¼å…¥HAMié»˜è®¤çš„dashboard"></a>å¯¼å…¥HAMié»˜è®¤çš„dashboard</h3><p>â€‹è®¿é—®â€œDashboardsâ€-&gt;â€œBrowseâ€é¡µé¢ï¼Œå¯¼å…¥æ­¤dashboardï¼š <a href="https://grafana.com/grafana/dashboards/22043-hami-vgpu-metrics-dashboard/">https://grafana.com/grafana/dashboards/22043-hami-vgpu-metrics-dashboard/</a> ï¼Œgrafanaä¸­å°†åˆ›å»ºä¸€ä¸ªåä¸ºâ€œhami-vgpu-metrics-dashboardâ€çš„dashboardï¼Œæ­¤æ—¶æ­¤é¡µé¢ä¸­æœ‰ä¸€äº›Panelå¦‚vGPUCorePercentageè¿˜æ²¡æœ‰æ•°æ®ï¼Œè¯·ç»§ç»­çœ‹å®Œæ­¤æ–‡æ¡£ï¼Œæ‰§è¡Œå®Œâ€éƒ¨ç½²dcgm-exporterâ€ä¸â€œåˆ›å»ºServiceMonitorâ€ä¸­çš„æ­¥éª¤ä¹‹åPanelæ•°æ®å°†æ­£å¸¸æ˜¾ç¤ºã€‚</p><h1 id="éƒ¨ç½²dcgm-exporter"><a href="#éƒ¨ç½²dcgm-exporter" class="headerlink" title="éƒ¨ç½²dcgm-exporter"></a>éƒ¨ç½²dcgm-exporter</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸‹è½½dcgm-exporterä»£ç ä»“åº“ï¼ˆæœªçœ‹åˆ°ä¸kubernetesçš„å…¼å®¹çŸ©é˜µè¯´æ˜ï¼Œæ­¤å¤„ä½¿ç”¨tag 3.2.5-3.1.7ï¼‰</span><br>git clone -b 3.2.5-3.1.7 https://github.com/NVIDIA/dcgm-exporter.git<br>cd dcgm-exporter<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿®æ”¹ deployment/values.yaml æ–‡ä»¶ï¼Œä¸ºå…¶ä¸­çš„serviceMonitoræ·»åŠ relabelingsé…ç½®ï¼Œè¿™æ ·dcgm-exporterçš„ç›‘æ§æŒ‡æ ‡æ‰æœ‰node_nameä¸ipå±æ€§</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åªæœ‰è¿™ä¸€å¤„serviceMonitorï¼Œrelabelingså†…çš„å†…å®¹éƒ½æ˜¯æ·»åŠ çš„ï¼Œæ·»åŠ åå†…å®¹å¦‚ä¸‹</span><br>root@controller01:~/dcgm-exporter# vi deployment/values.yaml<br>...<br>serviceMonitor:<br>  enabled: true<br>  interval: 15s<br>  honorLabels: false<br>  additionalLabels: &#123;&#125;<br>    #monitoring: prometheus<br>  relabelings:<br>  - sourceLabels: [__meta_kubernetes_endpoints_name]<br>    regex: dcgm-exporter<br>    replacement: $1<br>    action: keep<br>  - sourceLabels: [__meta_kubernetes_pod_node_name]<br>    regex: (.*)<br>    targetLabel: node_name<br>    replacement: $&#123;1&#125;<br>    action: replace<br>  - sourceLabels: [__meta_kubernetes_pod_host_ip]<br>    regex: (.*)<br>    targetLabel: ip<br>    replacement: $1<br>    action: replace<br>...<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨helmå·¥å…·åœ¨monitoringç©ºé—´ä¸‹å®‰è£…dcgm-exporter</span><br>root@controller01:~/dcgm-exporter# helm install dcgm-exporter deployment/ -n monitoring<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹helm installç»“æœ</span><br>root@controller01:~/dcgm-exporter# helm list -n monitoring<br>NAME            NAMESPACE       REVISION        UPDATED                                 STATUS          CHART                   APP VERSION<br>dcgm-exporter   monitoring      1               2024-10-02 16:32:35.691073696 +0800 CST deployed        dcgm-exporter-3.1.7     3.1.7<br><span class="hljs-meta prompt_">#</span><span class="language-bash">è¿˜éœ€ç¡®è®¤dcgm-exporter ç›¸å…³çš„podå·²ç»å¤„äºrunningçŠ¶æ€</span><br>root@controller01:~/dcgm-exporter# kubectl -n monitoring get pods | egrep &quot;NAME|dcgm-exporter&quot;<br>NAME                                  READY   STATUS             RESTARTS         AGE<br>dcgm-exporter-p4fdp                   1/1     Running            0                4h14m<br></code></pre></td></tr></table></figure><h1 id="åˆ›å»ºServiceMonitor"><a href="#åˆ›å»ºServiceMonitor" class="headerlink" title="åˆ›å»ºServiceMonitor"></a>åˆ›å»ºServiceMonitor</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»ºæ–‡ä»¶hami-device-plugin-svc-monitor.yaml</span><br>root@controller01:~# touch hami-device-plugin-svc-monitor.yaml<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ–‡ä»¶hami-device-plugin-svc-monitor.yamlå†…å®¹å¦‚ä¸‹</span><br>root@controller01:~# cat hami-device-plugin-svc-monitor.yaml<br>apiVersion: monitoring.coreos.com/v1<br>kind: ServiceMonitor<br>metadata:<br>  name: hami-device-plugin-svc-monitor<br>  namespace: kube-system<br>spec:<br>  selector:<br>    matchLabels:<br>      app.kubernetes.io/component: hami-device-plugin<br>  namespaceSelector:<br>    matchNames:<br>      - &quot;kube-system&quot;<br>  endpoints:<br>  - path: /metrics<br>    port: monitorport<br>    interval: &quot;15s&quot;<br>    honorLabels: false<br>    relabelings:<br>    - sourceLabels: [__meta_kubernetes_endpoints_name]<br>      regex: hami-.*<br>      replacement: $1<br>      action: keep<br>    - sourceLabels: [__meta_kubernetes_pod_node_name]<br>      regex: (.*)<br>      targetLabel: node_name<br>      replacement: $&#123;1&#125;<br>      action: replace<br>    - sourceLabels: [__meta_kubernetes_pod_host_ip]<br>      regex: (.*)<br>      targetLabel: ip<br>      replacement: $1<br>      action: replace<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åº”ç”¨æ­¤æ–‡ä»¶</span><br>root@controller01:~# kubectl apply -f hami-device-plugin-svc-monitor.yaml<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»ºæ–‡ä»¶hami-scheduler-svc-monitor.yaml</span><br>root@controller01:~# touch hami-scheduler-svc-monitor.yaml<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ–‡ä»¶hami-scheduler-svc-monitor.yamlå†…å®¹å¦‚ä¸‹</span><br>root@controller01:~# cat hami-scheduler-svc-monitor.yaml<br>apiVersion: monitoring.coreos.com/v1<br>kind: ServiceMonitor<br>metadata:<br>  name: hami-scheduler-svc-monitor<br>  namespace: kube-system<br>spec:<br>  selector:<br>    matchLabels:<br>      app.kubernetes.io/component: hami-scheduler<br>  namespaceSelector:<br>    matchNames:<br>      - &quot;kube-system&quot;<br>  endpoints:<br>  - path: /metrics<br>    port: monitor<br>    interval: &quot;15s&quot;<br>    honorLabels: false<br>    relabelings:<br>    - sourceLabels: [__meta_kubernetes_endpoints_name]<br>      regex: hami-.*<br>      replacement: $1<br>      action: keep<br>    - sourceLabels: [__meta_kubernetes_pod_node_name]<br>      regex: (.*)<br>      targetLabel: node_name<br>      replacement: $&#123;1&#125;<br>      action: replace<br>    - sourceLabels: [__meta_kubernetes_pod_host_ip]<br>      regex: (.*)<br>      targetLabel: ip<br>      replacement: $1<br>      action: replace<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åº”ç”¨æ­¤æ–‡ä»¶</span><br>root@controller01:~# kubectl apply -f hami-scheduler-svc-monitor.yaml<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ç¡®è®¤åˆ›å»ºçš„ServiceMonitor</span><br>root@controller01:~# kubectl -n kube-system get servicemonitor<br>NAME                             AGE<br>hami-device-plugin-svc-monitor   28h<br>hami-scheduler-svc-monitor       28h<br></code></pre></td></tr></table></figure><h1 id="ç¡®è®¤æœ€ç»ˆç›‘æ§æ•ˆæœ"><a href="#ç¡®è®¤æœ€ç»ˆç›‘æ§æ•ˆæœ" class="headerlink" title="ç¡®è®¤æœ€ç»ˆç›‘æ§æ•ˆæœ"></a>ç¡®è®¤æœ€ç»ˆç›‘æ§æ•ˆæœ</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»ºæ–‡ä»¶gpu-pod.yamlï¼Œå°è¯•ä½¿ç”¨HAMiè™šæ‹Ÿå‡ºæ¥çš„NVIDIA vGPU</span><br>root@controller01:~# touch gpu-pod.yaml<br>root@controller01:~# cat gpu-pod.yaml<br>apiVersion: v1<br>kind: Pod<br>metadata:<br>  name: gpu-pod-01<br>spec:<br>  restartPolicy: Never<br>  containers:<br>  - name: cuda-container<br>    image: nvcr.io/nvidia/k8s/cuda-sample:vectoradd-cuda10.2<br>    resources:<br>      limits:<br>        nvidia.com/vgpu: 2 # è¯·æ±‚2ä¸ªvGPUs<br>        nvidia.com/gpumem: 3000 # æ¯ä¸ªvGPUç”³è¯·3000mæ˜¾å­˜ ï¼ˆå¯é€‰ï¼Œæ•´æ•°ç±»å‹ï¼‰<br>        nvidia.com/gpucores: 10 # æ¯ä¸ªvGPUçš„ç®—åŠ›ä¸º10%å®é™…æ˜¾å¡çš„ç®—åŠ› ï¼ˆå¯é€‰ï¼Œæ•´æ•°ç±»å‹ï¼‰<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åº”ç”¨æ­¤æ–‡ä»¶</span><br>root@controller01:~# kubectl apply -f gpu-pod.yaml<br>root@controller01:~# kubectl get pods -o wide<br>NAME           READY   STATUS        RESTARTS   AGE   IP               NODE           NOMINATED NODE   READINESS GATES<br>gpu-pod-01     0/1     Completed     0          52s   10.233.81.70     controller01   &lt;none&gt;           &lt;none&gt;<br></code></pre></td></tr></table></figure><p>â€‹æ­¤æ—¶ï¼Œåº”è¯¥å¯ä»¥dashboardä¸­çœ‹åˆ°ç›‘æ§è¯¦æƒ…ã€‚</p><p>â€‹å¯¼å…¥dashboardæ—¶å°‘è®¸panelå¦‚â€œGPU Totalâ€çš„å†…å®¹å¯èƒ½æœªè¢«æ­£ç¡®è§£æï¼Œå°†é€ æˆå…¶å†…å®¹ä¸èƒ½æ­£å¸¸æ˜¾ç¤ºï¼Œæ­¤æ—¶è¯·å°†dashboardæ–‡ä»¶ä¸‹è½½ä¸‹æ¥ï¼Œæ‰‹åŠ¨ç¼–è¾‘å¯¹åº”å†…å®¹ï¼Œå°†æ•°æ®æºâ€œData sourceâ€ä¿®æ”¹ä¸ºâ€ALLâ€ï¼ŒåŒæ—¶å°†â€œMetrics browserâ€ä¿®æ”¹æ­£ç¡®çš„promQLè¯­å¥ï¼ˆå¯ä»¥ä»ä¸‹è½½ä¸‹æ¥çš„dashboardä¸­æŸ¥æ‰¾ï¼‰ï¼Œå…¶ä»–é»˜è®¤å³å¯ã€‚<strong>å¦‚æœä¸ä¼šä¿®æ”¹ï¼Œè¿™é‡Œä¹Ÿæä¾›ä¸€ä»½åœ¨grafana8.5.5ä¸­å¯ç”¨çš„dashboardï¼Œé˜¿é‡Œäº‘ç›˜åˆ†äº«é“¾æ¥<a href="https://www.alipan.com/s/1X8fTqisx6y">https://www.alipan.com/s/1X8fTqisx6y</a> æå–ç : r48s</strong> </p><p>â€‹æ­£å¸¸æ—¶ï¼Œå†…å®¹å¤§æ¦‚å¦‚ä¸‹</p><p><img src="https://s2.loli.net/2024/10/03/RFJuthzAGYw5UHk.png" alt="image-20241003215400685"></p>]]></content>
    
    
    
    <tags>
      
      <tag>HAMi prometheus grafana ç›‘æ§</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>k8sç¦»çº¿éƒ¨ç½²-ä½¿ç”¨kubekeyéƒ¨ç½²amd64é«˜å¯ç”¨ç‰ˆk8s1.23.17-ksp3.4.1</title>
    <link href="/2024/09/27/k8s%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B2-%E4%BD%BF%E7%94%A8kubekey%E9%83%A8%E7%BD%B2amd64%E9%AB%98%E5%8F%AF%E7%94%A8%E7%89%88k8s1-23-17-ksp3-4-1/"/>
    <url>/2024/09/27/k8s%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B2-%E4%BD%BF%E7%94%A8kubekey%E9%83%A8%E7%BD%B2amd64%E9%AB%98%E5%8F%AF%E7%94%A8%E7%89%88k8s1-23-17-ksp3-4-1/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€ç¯å¢ƒä¿¡æ¯ä»‹ç»"><a href="#ä¸€ã€ç¯å¢ƒä¿¡æ¯ä»‹ç»" class="headerlink" title="ä¸€ã€ç¯å¢ƒä¿¡æ¯ä»‹ç»"></a>ä¸€ã€ç¯å¢ƒä¿¡æ¯ä»‹ç»</h1><p>ï¼ˆ1ï¼‰   ç›¸å…³æœåŠ¡å™¨ä¿¡æ¯ï¼š</p><table><thead><tr><th><strong>ä¸»æœºå</strong></th><th><strong>IP</strong></th><th><strong>rootå¯†ç </strong></th><th><strong>è§„æ ¼</strong></th><th><strong>ç£ç›˜</strong></th><th><strong>æ“ä½œç³»ç»Ÿ</strong></th><th><strong>å¤‡æ³¨</strong></th></tr></thead><tbody><tr><td>prepare</td><td>10.13.15.6</td><td>cloud@2020</td><td>8c16g</td><td>400G</td><td>Ubuntu 20.04.3 LTS -amd64</td><td>è”ç½‘ï¼Œç”Ÿæˆartifactç­‰</td></tr><tr><td>k8s01-1</td><td>10.13.15.16</td><td>cloud@2020</td><td>8c16g</td><td>400G+960G</td><td>Ubuntu 20.04.3 LTS -amd64</td><td>K8sèŠ‚ç‚¹ï¼Œæœªè”ç½‘</td></tr><tr><td>k8s01-2</td><td>10.13.15.17</td><td>cloud@2020</td><td>8c16g</td><td>400G+960G</td><td>Ubuntu 20.04.3 LTS -amd64</td><td>K8sèŠ‚ç‚¹ï¼Œæœªè”ç½‘</td></tr><tr><td>k8s01-3</td><td>10.13.15.161</td><td>cloud@2020</td><td>8c16g</td><td>400G+960G</td><td>Ubuntu 20.04.3 LTS -amd64</td><td>K8sèŠ‚ç‚¹ï¼Œæœªè”ç½‘</td></tr><tr><td>k8s01-4</td><td>10.13.15.99</td><td>cloud@2020</td><td>8c16g</td><td>400G+960G</td><td>Ubuntu 20.04.3 LTS -amd64</td><td>K8sèŠ‚ç‚¹ï¼Œæœªè”ç½‘</td></tr><tr><td>registry</td><td>10.13.15.71</td><td>cloud@2020</td><td>4c8g</td><td>400G</td><td>Ubuntu 20.04.3 LTS -amd64</td><td>Harborä»“åº“ï¼Œæœªè”ç½‘</td></tr></tbody></table><p>æ ¹æ®å®˜æ–¹æ–‡æ¡£å»ºè®®ï¼šä»“åº“ä¸é›†ç¾¤åˆ†ç¦»éƒ¨ç½²ï¼Œå‡å°‘ç›¸äº’å½±å“ï¼Œæ‰€ä»¥å¤šäº†ä¸€ä¸ª registry æœåŠ¡å™¨ã€‚</p><p>æœåŠ¡å™¨IPæœ¬æ¥æƒ³è§„åˆ’æˆè¿ç»­ç€çš„ï¼Œåæ¥å› ä¸ºä¸æ˜¯ä¸€æ¬¡åˆ›å»ºçš„ä¸”æ­¤æ–‡ä»¶ä¸æ˜¯ä¸€æ¬¡æ€§å®Œæˆï¼Œé‚æ²¡æœ‰å…³æ³¨äº†ã€‚</p><p>å¦‚æœæ˜¯è‡ªå·±æ­å»ºç€å­¦ä¹ æˆ–å®éªŒï¼ŒæœåŠ¡å™¨è§„æ ¼å‡åŠä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p><p>ï¼ˆ2ï¼‰   ç¯å¢ƒæ¶‰åŠè½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯ï¼š</p><ul><li>æ“ä½œç³»ç»Ÿï¼š<strong>Ubuntu 20.04.3 LTS -amd64</strong></li><li>KubeSphereï¼š<strong>v3.4.1</strong></li><li>K8sï¼š<strong>v1.23.17</strong></li><li>Dockerï¼š<strong>24.0.6</strong></li><li>KubeKey: <strong>v3.0.13</strong></li><li>Harborï¼š<strong>2.5.3</strong></li></ul><h1 id="äºŒã€ç¦»çº¿å®‰è£…ä»‹ç»"><a href="#äºŒã€ç¦»çº¿å®‰è£…ä»‹ç»" class="headerlink" title="äºŒã€ç¦»çº¿å®‰è£…ä»‹ç»"></a>äºŒã€ç¦»çº¿å®‰è£…ä»‹ç»</h1><p>KubeKey æ˜¯ä¸€ä¸ªç”¨äºéƒ¨ç½² Kubernetes é›†ç¾¤çš„å¼€æºè½»é‡çº§å·¥å…·ã€‚å®ƒæä¾›äº†ä¸€ç§çµæ´»ã€å¿«é€Ÿã€ä¾¿æ·çš„æ–¹å¼æ¥ä»…å®‰è£… Kubernetes&#x2F;K3sï¼Œæˆ–åŒæ—¶å®‰è£… Kubernetes&#x2F;K3s å’Œ KubeSphereï¼Œä»¥åŠå…¶ä»–äº‘åŸç”Ÿæ’ä»¶ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒä¹Ÿæ˜¯æ‰©å±•å’Œå‡çº§é›†ç¾¤çš„æœ‰æ•ˆå·¥å…·ã€‚</p><p>KubeKey v2.1.0 ç‰ˆæœ¬æ–°å¢äº†æ¸…å•ï¼ˆmanifestï¼‰å’Œåˆ¶å“ï¼ˆartifactï¼‰çš„æ¦‚å¿µï¼Œä¸ºç”¨æˆ·ç¦»çº¿éƒ¨ç½² Kubernetes é›†ç¾¤æä¾›äº†ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚manifest æ˜¯ä¸€ä¸ªæè¿°å½“å‰ Kubernetes é›†ç¾¤ä¿¡æ¯å’Œå®šä¹‰ artifact åˆ¶å“ä¸­éœ€è¦åŒ…å«å“ªäº›å†…å®¹çš„æ–‡æœ¬æ–‡ä»¶ã€‚</p><p>ä½¿ç”¨ KubeKeyï¼Œç”¨æˆ·åªéœ€ä½¿ç”¨æ¸…å• manifest æ–‡ä»¶æ¥å®šä¹‰å°†è¦ç¦»çº¿éƒ¨ç½²çš„é›†ç¾¤ç¯å¢ƒéœ€è¦çš„å†…å®¹ï¼Œå†é€šè¿‡è¯¥ manifest æ¥å¯¼å‡ºåˆ¶å“ artifact æ–‡ä»¶å³å¯å®Œæˆå‡†å¤‡å·¥ä½œã€‚ç¦»çº¿éƒ¨ç½²æ—¶åªéœ€è¦ KubeKey å’Œ artifact å°±å¯å¿«é€Ÿã€ç®€å•çš„åœ¨ç¯å¢ƒä¸­éƒ¨ç½²é•œåƒä»“åº“å’Œ Kubernetes é›†ç¾¤ã€‚</p><p>æ ¹æ® <a href="https://www.kubesphere.io/zh/docs/v3.4/installing-on-linux/introduction/air-gapped-installation/">é’äº‘å®˜ç½‘çš„ç¦»çº¿éƒ¨ç½²æ–‡æ¡£</a>ï¼Œä½¿ç”¨ç”Ÿæˆ manifest æ–‡ä»¶æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œåœ¨ç¤ºä¾‹çš„åŸºç¡€ç¨ä½œä¿®æ”¹ï¼ˆæ–‡æ¡£ä¸­æœ‰ä¿®æ”¹è¯´æ˜ï¼‰ç”Ÿæˆæ»¡è¶³è‡ªå·±éœ€æ±‚çš„ manifest æ–‡ä»¶ã€‚</li><li>åœ¨å·²æœ‰é›†ç¾¤ä¸­æ‰§è¡Œ KubeKey å‘½ä»¤ç”Ÿæˆ manifest æ–‡ä»¶ï¼Œå¦‚æœ‰éœ€è¦å¯å†å‚è€ƒå®˜ç½‘æ–‡æ¡£è¿›è¡Œä¿®æ”¹å®šåˆ¶ï¼ˆä¸ä¿®æ”¹çš„è¯ï¼Œå¯æƒ³è€ŒçŸ¥ç”Ÿæˆçš„åˆ¶å“åŠæœ€åæ­å»ºçš„ç¯å¢ƒç›¸å…³è½¯ä»¶ç‰ˆæœ¬åŠé•œåƒè·Ÿå½“å‰é›†ç¾¤ä¸€æ ·ï¼‰ã€‚</li></ul><p>æœ¬æ–‡ä¸­ä½¿ç”¨ç¬¬1ç§æ–¹å¼ç”Ÿæˆ manifest æ–‡ä»¶ä»¥åŠåˆ›å»ºåç»­éœ€è¦ä½¿ç”¨åˆ°çš„åˆ¶å“ï¼ˆartifactï¼‰ã€‚</p><p><strong>æ•´ä¸ªç¦»çº¿éƒ¨ç½²K8S+KSPçš„è¿‡ç¨‹çš„ä¸»çº¿å°±æ˜¯åˆ¶ä½œåˆ¶å“ã€ä½¿ç”¨åˆ¶å“ï¼Œå…¶ä»–æ“ä½œåŸºæœ¬ä¸Šéƒ½æ˜¯å›´ç»•å®ƒå±•å¼€çš„ã€‚</strong></p><h1 id="ä¸‰ã€æœåŠ¡å™¨çš„å‰ç½®æ“ä½œ"><a href="#ä¸‰ã€æœåŠ¡å™¨çš„å‰ç½®æ“ä½œ" class="headerlink" title="ä¸‰ã€æœåŠ¡å™¨çš„å‰ç½®æ“ä½œ"></a>ä¸‰ã€æœåŠ¡å™¨çš„å‰ç½®æ“ä½œ</h1><p>å»ºè®®æ‰€æœ‰æœåŠ¡å™¨éƒ½è¦æ‰§è¡Œã€‚</p><h2 id="3-1-è®¾ç½®å„æœåŠ¡å™¨æ—¶åŒº"><a href="#3-1-è®¾ç½®å„æœåŠ¡å™¨æ—¶åŒº" class="headerlink" title="3.1 è®¾ç½®å„æœåŠ¡å™¨æ—¶åŒº"></a>3.1 è®¾ç½®å„æœåŠ¡å™¨æ—¶åŒº</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰€æœ‰æœåŠ¡å™¨è®¾ç½®æ—¶åŒº</span><br>timedatectl set-timezone Asia/Shanghai<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰€æœ‰æœªè”ç½‘æœåŠ¡å™¨å…³é—­ç½‘ç»œæ—¶é—´åŒæ­¥</span><br>timedatectl set-ntp false<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰€æœ‰æœåŠ¡å™¨è®¾ç½®åŒ—äº¬æ—¶é—´ï¼Œå°½é‡ç›¸åŒæˆ–é è¿‘</span><br>timedatectl set-time &quot;11:08:30&quot;<br></code></pre></td></tr></table></figure><h2 id="3-2-è®¾ç½®å„æœåŠ¡å™¨ä¸»æœºå"><a href="#3-2-è®¾ç½®å„æœåŠ¡å™¨ä¸»æœºå" class="headerlink" title="3.2 è®¾ç½®å„æœåŠ¡å™¨ä¸»æœºå"></a>3.2 è®¾ç½®å„æœåŠ¡å™¨ä¸»æœºå</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">hostnamectl set-hostname xxx<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç„¶åé€€å‡ºç»ˆç«¯å¹¶é‡æ–°åˆ›å»ºä¸€ä¸ªç»ˆç«¯ä¼šè¯</span><br></code></pre></td></tr></table></figure><h2 id="3-4-å®‰è£…é…ç½®æ—¶é—´åŒæ­¥æœåŠ¡"><a href="#3-4-å®‰è£…é…ç½®æ—¶é—´åŒæ­¥æœåŠ¡" class="headerlink" title="3.4 å®‰è£…é…ç½®æ—¶é—´åŒæ­¥æœåŠ¡"></a>3.4 å®‰è£…é…ç½®æ—¶é—´åŒæ­¥æœåŠ¡</h2><p>å¼ºçƒˆå»ºè®®æå‰åšå¥½å¦‚ä¸‹å‡†å¤‡ï¼ˆå¦åˆ™ï¼Œå®‰è£…é…ç½®æ—¶é—´åŒæ­¥æœåŠ¡æ— æ³•é‡‡ç”¨å¦‚ä¸‹æ–¹æ³•å®Œæˆï¼‰ï¼š</p><ul><li>æ­å»ºæ“ä½œç³»ç»Ÿç»„ä»¶å®‰è£…æºä»“åº“</li><li>éƒ¨ç½²äº†è‡ªå·±çš„æœ¬åœ°NTPæœåŠ¡å™¨</li></ul><p>ä¸€èˆ¬åœ¨æ­å»ºè½¯ä»¶è§£å†³æ–¹æ¡ˆå‰å°±åšå¥½æ‰€æœ‰æœåŠ¡å™¨çš„æ—¶é—´åŒæ­¥ã€‚å¦‚æœæ²¡æœ‰æ­å»ºæ“ä½œç³»ç»Ÿç»„ä»¶å®‰è£…æºä»“åº“ï¼Œåé¢ä½¿ç”¨kkæ­£å¼éƒ¨ç½²k8s+kspæ—¶ï¼Œä¹Ÿä¼šåœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šéƒ¨ç½²chronyæœåŠ¡ï¼Œä½†ä¸ä¼šéƒ¨ç½²æœ¬åœ° NTPæœåŠ¡å™¨ã€‚æ‰€ä»¥è¿˜æ˜¯éœ€è¦è‡ªå·±æå‰éƒ¨ç½²æœ¬åœ° NTPæœåŠ¡å™¨ï¼Œè‡ªå·±æƒ³åŠæ³•</p><h3 id="å®‰è£…æ—¶é—´åŒæ­¥æœåŠ¡"><a href="#å®‰è£…æ—¶é—´åŒæ­¥æœåŠ¡" class="headerlink" title="å®‰è£…æ—¶é—´åŒæ­¥æœåŠ¡"></a>å®‰è£…æ—¶é—´åŒæ­¥æœåŠ¡</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">1.å®‰è£… chrony ä½œä¸ºæ—¶é—´åŒæ­¥è½¯ä»¶</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ­£å¸¸æƒ…å†µä¸‹å†…ç½‘ç¯å¢ƒä¸‹æ­å»ºè½¯ä»¶è§£å†³æ–¹æ¡ˆï¼Œåº”è¯¥ä¼šå…ˆè‡ªè¡Œæ­å»ºæ“ä½œç³»ç»Ÿç»„ä»¶å®‰è£…æºä»“åº“ï¼›</span><br>apt-get install chrony -qy<br></code></pre></td></tr></table></figure><h3 id="é…ç½®æ—¶é—´åŒæ­¥æœåŠ¡"><a href="#é…ç½®æ—¶é—´åŒæ­¥æœåŠ¡" class="headerlink" title="é…ç½®æ—¶é—´åŒæ­¥æœåŠ¡"></a>é…ç½®æ—¶é—´åŒæ­¥æœåŠ¡</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">2.ä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/chrony/chrony.confï¼Œä¿®æ”¹ ntp æœåŠ¡é…ç½®</span><br>vi /etc/chrony/chrony.conf<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å°†å¦‚ä¸‹è®¤çš„ pool é…ç½®åˆ é™¤ï¼ˆç¦»çº¿ç¯å¢ƒä¸­ä¹Ÿç”¨ä¸ä¸Šï¼‰</span><br>pool ntp.ubuntu.com        iburst maxsources 4<br>pool 0.ubuntu.pool.ntp.org iburst maxsources 1<br>pool 1.ubuntu.pool.ntp.org iburst maxsources 1<br>pool 2.ubuntu.pool.ntp.org iburst maxsources 2<br><span class="hljs-meta prompt_"># </span><span class="language-bash">ç„¶åé…ç½®è‡ªå·±æœ¬åœ°çš„NTPæœåŠ¡å™¨ï¼ˆæœ€å¥½æ˜¯ä¸€å°å¯ä»¥è®¿é—®å¤–ç½‘çš„æœåŠ¡å™¨ï¼‰ï¼ŒNTPæœåŠ¡å™¨æ­¥éª¤æ­¤æ–‡æœªæ¶‰åŠ</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å‡å¦‚10.13.15.20æ˜¯æœ¬åœ°NTPæœåŠ¡å™¨ï¼Œåˆ™æ·»åŠ å¦‚ä¸‹é…ç½®</span><br>server 10.13.15.20 iburst<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">3.é‡å¯ chrony æœåŠ¡ï¼š</span><br>systemctl restart chrony<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">4.éªŒè¯ chrony åŒæ­¥çŠ¶æ€ï¼š</span><br>chronyc sourcestats -v<br></code></pre></td></tr></table></figure><h2 id="3-5-æ•°æ®ç›˜é…ç½®ï¼ˆå¯é€‰ï¼‰"><a href="#3-5-æ•°æ®ç›˜é…ç½®ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="3.5 æ•°æ®ç›˜é…ç½®ï¼ˆå¯é€‰ï¼‰"></a>3.5 æ•°æ®ç›˜é…ç½®ï¼ˆå¯é€‰ï¼‰</h2><p>æ­¤æ¬¡ç”¨æ¥æ­å»ºk8sç¯å¢ƒçš„ä¸‰ä¸ªæœåŠ¡å™¨éƒ½é…ç½®äº†ä¸€ä¸ª400Gå¤§å°çš„ç³»ç»Ÿç›˜ã€ä¸€ä¸ª960Gçš„æ•°æ®ç›˜ã€‚</p><p><img src="https://s2.loli.net/2024/09/27/O2KsM3ZyeQWf5wB.png" alt="image-20240927113654261"></p><p>æœ¬æ–‡æ¼”ç¤ºæ¯å°æœåŠ¡å™¨æ–°å¢ä¸€å—æ•°æ®ç›˜ <strong>&#x2F;dev&#x2F;vdb</strong>ï¼ˆå°±æ˜¯è¯´ä¸‹é¢çš„æ“ä½œè¦åœ¨æ¯ä¸ªks8èŠ‚ç‚¹æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼‰</p><h3 id="3-5-1-æ–¹æ³•1-è£¸ç›˜"><a href="#3-5-1-æ–¹æ³•1-è£¸ç›˜" class="headerlink" title="3.5.1 æ–¹æ³•1-è£¸ç›˜"></a>3.5.1 æ–¹æ³•1-è£¸ç›˜</h3><p>å°†æ•°æ®ç›˜æ ¼å¼åŒ–åæŒ‚è½½åˆ°æœåŠ¡å™¨æŒ‡å®šç›®å½•ä¸Šï¼ˆæ˜æ˜¾ï¼Œæ­¤ç§æ–¹å¼ä¸æ”¯å†æ¬¡æ‰©å®¹ï¼‰ï¼Œä½œä¸º <strong>docker</strong> å’Œ <strong>Kubernetes Pod</strong> çš„ä¸“ç”¨å­˜å‚¨ç›˜ï¼ˆæ­¤å¤„åº”è¯¥æŒ‡æ˜çš„æ˜¯ç¬”è€…å¾—æ¥è§¦åˆ°çš„ç¯å¢ƒä¸­ï¼Œä¸šåŠ¡æ•°æ®å­˜å‚¨ä¸€èˆ¬æ˜¯å¯¹æ¥cephç­‰ç‹¬ç«‹çš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿï¼Œæ‰€ä»¥åªæœ‰æ—¥å¿—æ–‡ä»¶ä¼šå­˜å‚¨åœ¨æœ¬åœ°ï¼‰ã€‚</p><p>ä¸‹é¢æ˜¯åœ¨k8s01-1æœåŠ¡å™¨ä¸Šæ“ä½œä¸ºä¾‹è¿›è¡Œé˜è¿°ï¼Œå…¶ä»–èŠ‚ç‚¹ä¹Ÿéœ€è¦è¿›è¡Œæ­¤æ“ä½œã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">mklabel å®šä¹‰åˆ†åŒºè¡¨æ ¼å¼ï¼ˆå¸¸ç”¨çš„æœ‰msdoså’Œgptåˆ†åŒºè¡¨æ ¼å¼ï¼Œmsdosä¸æ”¯æŒ2TBä»¥ä¸Šå®¹é‡çš„ç£ç›˜ï¼Œæ‰€ä»¥å¤§äº2TBçš„ç£ç›˜é€‰gptåˆ†åŒºè¡¨æ ¼å¼ï¼‰</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">mkpart åˆ›å»ºä¸€ä¸ªåˆ†åŒºï¼Œåç§°ä¸ºdata_k8sï¼Œæ­¤å¤„ä¸æ”¯æŒå£°æ˜ext4åˆ†åŒºæ ¼å¼ï¼ˆæ‰€ä»¥ä¸‹è¡Œéœ€è¦ç”¨mkfs.ext4ï¼‰ï¼Œ1è¡¨ç¤ºåˆ†åŒºèµ·å§‹ä½ç½®æ˜¯è·ç¦»ç£ç›˜èµ·å§‹ç‚¹1 MBï¼Œ-1è¡¨ç¤ºåˆ†åŒºç»“æŸä½ç½®æ˜¯ç£ç›˜ç»“æŸä½ç½®</span><br>root@k8s01-1:~# parted /dev/vdb -s -- mklabel gpt mkpart data_k8s 1 -1<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†åˆ†åŒºæ ¼å¼åŒ–ä¸ºext4æ ¼å¼</span><br>root@k8s01-1:~# mkfs.ext4 /dev/vdb1<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰‹åŠ¨æŒ‚è½½ç£ç›˜åˆ†åŒº</span><br>root@k8s01-1:/# mkdir /data/<br>root@k8s01-1:/# mount /dev/vdb1 /data/<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é…ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½æ–¹æ³•1</span><br>root@k8s01-1:/# tail -1 /etc/mtab<br>root@k8s01-1:/# tail -1 /etc/mtab &gt;&gt; /etc/fstab<br><span class="hljs-meta prompt_">#</span><span class="language-bash">é…ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½çš„ç¬¬2ç§æ–¹æ³•ï¼šå¯ä»¥æ‰‹åŠ¨ç¼–è¾‘/etc/fstabï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹</span><br>root@k8s01-1:/# vi /etc/fstab<br>/dev/vdb1 /data ext4 rw,relatime 0 0<br></code></pre></td></tr></table></figure><h3 id="3-5-2-æ–¹æ³•2-LVM"><a href="#3-5-2-æ–¹æ³•2-LVM" class="headerlink" title="3.5.2 æ–¹æ³•2-LVM"></a>3.5.2 æ–¹æ³•2-LVM</h3><p>ä»¥LVMï¼ˆé€»è¾‘å·ç®¡ç†ï¼‰çš„æ–¹å¼æ‰©å®¹æŒ‚è½½åˆ°æœåŠ¡å™¨æŒ‡å®šç›®å½•ä¸Šï¼Œä½œä¸º <strong>docker</strong> å’Œ <strong>Kubernetes Pod</strong> çš„ä¸“ç”¨å­˜å‚¨ç›˜ï¼ˆæ­¤å¤„åº”è¯¥æŒ‡æ˜çš„æ˜¯ç¬”è€…å¾—æ¥è§¦åˆ°çš„ç¯å¢ƒä¸­ï¼Œä¸šåŠ¡æ•°æ®å­˜å‚¨ä¸€èˆ¬æ˜¯å¯¹æ¥cephç­‰ç‹¬ç«‹çš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿï¼Œæ‰€ä»¥åªæœ‰æ—¥å¿—æ–‡ä»¶ä¼šå­˜å‚¨åœ¨æœ¬åœ°ï¼‰ã€‚</p><p>ä¸‹é¢æ˜¯åœ¨k8s01-1æœåŠ¡å™¨ä¸Šæ“ä½œä¸ºä¾‹è¿›è¡Œé˜è¿°ï¼Œå…¶ä»–èŠ‚ç‚¹ä¹Ÿéœ€è¦è¿›è¡Œæ­¤æ“ä½œã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»º PV ç‰©ç†å·</span><br>root@k8s01-1:~# pvcreate /dev/vdb<br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»º VG å·ç»„vgk8sï¼Œå°†ç‰©ç†å· /dev/vdb æ·»åŠ åˆ°æ­¤å·ç»„ä¸­ã€‚å·ç»„æ˜¯ä¸€ç§é€»è¾‘å­˜å‚¨å•å…ƒï¼Œå®ƒå¯ä»¥ç”±ä¸€ä¸ªæˆ–å¤šä¸ªç‰©ç†å·ç»„æˆã€‚</span><br>root@k8s01-1:~# vgcreate vgk8s /dev/vdb<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹æ‰€æœ‰çš„å·ç»„</span><br>root@k8s01-1:~# vgdisplay<br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»º LV é€»è¾‘å·(ä½¿ç”¨å·ç»„vgk8sçš„100%æ‰€æœ‰ç©ºé—´ï¼Œvgk8s æ˜¯VG åå­—ï¼Œlvk8s æ˜¯LV åå­—)ï¼Œæ­¤å¤„ä¸€ä¸ªé€»è¾‘å·å¯¹åº”ä¸€ä¸ªå·ç»„ï¼ˆç†è®ºä¸Šæ¥è¯´ï¼Œä¸€ä¸ªå·ç»„å¯ä»¥è¢«åˆ’åˆ†ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªé€»è¾‘å·ï¼‰</span><br>root@k8s01-1:~# lvcreate -l 100%VG vgk8s -n lvk8s<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹é€»è¾‘å·çš„æŒ‚è½½ç›®å½•</span><br>root@k8s01-1:~# lvdisplay<br>...<br>  LV Path                /dev/vgk8s/lvk8s<br>...<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹å¹¶æ ¼å¼åŒ–é€»è¾‘å·</span><br>root@k8s01-1:~# ll /dev/vgk8s/lvk8s<br>root@k8s01-1:~# mkfs.ext4 /dev/vgk8s/lvk8s<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨LVMçš„å¥½å¤„å°±æ˜¯åç»­å¯ä»¥æ ¹æ®éœ€è¦å†å‘æ­¤é€»è¾‘å·ä¸­å¢åŠ ç©ºé—´ï¼Œæ¯”å¦‚ç°æœ‰éœ€è¦å†å¢åŠ ç©ºé—´ä¸”æœ‰ä¸€ä¸ªæ–°çš„ç£ç›˜/dev/vdc</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½†æ­¤æƒ…å†µä¸€èˆ¬ä¸ä¼šå‡ºç°ï¼Œæ­£å¦‚å‰é¢æ‰€è¿°ï¼Œä¸šåŠ¡æ•°æ®å­˜å‚¨ä¸€èˆ¬æ˜¯å¯¹æ¥cephç­‰ç‹¬ç«‹çš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿï¼Œæ‰€ä»¥åªæœ‰æ—¥å¿—æ–‡ä»¶ä¼šå­˜å‚¨åœ¨æœ¬åœ°ï¼Œä¸€èˆ¬ä¸ä¼šéœ€è¦å¦‚æ­¤å¤§ç©ºé—´ã€å­˜å‚¨è¿™ä¹ˆä¹…çš„æ—¥å¿—ä¿¡æ¯ï¼ˆè‡³å°‘ç¬”è€…æœªé‡åˆ°ï¼‰</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é¦–å…ˆåˆ›å»ºç‰©ç†å·</span><br>root@k8s01-1:~# pvcreate /dev/vdc<br>root@k8s01-1:~# vgextend vgk8s /dev/vdc<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å°†é€»è¾‘å· /dev/vgk8s/lvk8s æ‰€åœ¨å·ç»„ï¼ˆå³vgk8sï¼‰ä¸­æ‰€æœ‰(100%)å‰©ä½™å¯ç”¨å®¹é‡(FREE)æ‰©å®¹ç»™é€»è¾‘å·/dev/vgk8s/lvk8s</span><br>root@k8s01-1:~# lvextend -l +100%FREE /dev/vgk8s/lvk8s<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹é€»è¾‘å·</span><br>root@k8s01-1:~# lvscan<br>  ACTIVE            &#x27;/dev/vgk8s/lvk8s&#x27; [1.87 TiB] inherit<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æˆ–è€…ï¼Œä½¿ç”¨ lvdisplay å¯ä»¥çœ‹åˆ°å…¶æ›´è¯¦ç»†çš„ä¿¡æ¯</span><br>root@k8s01-1:~# lvdisplay<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰‹åŠ¨æŒ‚è½½é€»è¾‘å·</span><br>root@k8s01-1:/# mkdir /data/<br>root@k8s01-1:/# mount /dev/vgk8s/lvk8s /data/<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é…ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½æ–¹æ³•1</span><br>root@k8s01-1:/# tail -1 /etc/mtab<br>root@k8s01-1:/# tail -1 /etc/mtab &gt;&gt; /etc/fstab<br><span class="hljs-meta prompt_">#</span><span class="language-bash">é…ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½çš„ç¬¬2ç§æ–¹æ³•ï¼šå¯ä»¥æ‰‹åŠ¨ç¼–è¾‘/etc/fstabï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹</span><br>root@k8s01-1:/# vi /etc/fstab<br>/dev/vgk8s/lvk8s /data ext4 rw,relatime 0 0<br></code></pre></td></tr></table></figure><h1 id="å››ã€ç¦»çº¿éƒ¨ç½²èµ„æºæ–‡ä»¶åˆ¶ä½œ"><a href="#å››ã€ç¦»çº¿éƒ¨ç½²èµ„æºæ–‡ä»¶åˆ¶ä½œ" class="headerlink" title="å››ã€ç¦»çº¿éƒ¨ç½²èµ„æºæ–‡ä»¶åˆ¶ä½œ"></a>å››ã€ç¦»çº¿éƒ¨ç½²èµ„æºæ–‡ä»¶åˆ¶ä½œ</h1><p>åˆ¶ä½œç¦»çº¿éƒ¨ç½²èµ„æºæ–‡ä»¶éœ€è¦æœ‰ä¸€ä¸ªèƒ½è¿æ¥å¤–ç½‘çš„æœåŠ¡å™¨ï¼ˆæœ¬æ–‡ä¸­æ˜¯prepareï¼‰ï¼Œæœ¬æ–‡ä¸­æ˜¯æœåŠ¡å™¨ <strong>prepare</strong> ã€‚</p><p>åœ¨è¯¥æœåŠ¡å™¨ä¸Šä¸‹è½½ KubeKey v3.0.13 æ–‡ä»¶ã€‚</p><h2 id="4-1-å‡†å¤‡-KubeKey-æ–‡ä»¶"><a href="#4-1-å‡†å¤‡-KubeKey-æ–‡ä»¶" class="headerlink" title="4.1 å‡†å¤‡ KubeKey æ–‡ä»¶"></a>4.1 å‡†å¤‡ KubeKey æ–‡ä»¶</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@prepare:~# mkdir /opt/prepare<br>root@prepare:~# cd /opt/prepare<br><span class="hljs-meta prompt_"># </span><span class="language-bash">é€‰æ‹©ä¸­æ–‡åŒºä¸‹è½½(è®¿é—® GitHub å—é™æ—¶ä½¿ç”¨)</span><br>root@prepare:/opt/prepare# export KKZONE=cn<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ‰§è¡Œä¸‹è½½å‘½ä»¤ï¼Œè·å–æŒ‡å®šç‰ˆæœ¬çš„ kkï¼ˆå—é™äºç½‘ç»œï¼Œæœ‰æ—¶éœ€è¦æ‰§è¡Œå¤šæ¬¡ï¼‰</span><br>root@prepare:/opt/prepare# curl -sfL https://get-kk.kubesphere.io | VERSION=v3.0.13 sh -<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@prepare:/opt/prepare# chown root:root kk<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹kubekey3.0.13ç‰ˆæœ¬</span><br>root@prepare:/opt/prepare# ./kk version<br>kk version: &amp;version.Info&#123;Major:&quot;3&quot;, Minor:&quot;0&quot;, GitVersion:&quot;v3.0.13&quot;, GitCommit:&quot;ac75d3ef3c22e6a9d999dcea201234d6651b3e72&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2023-11-07T08:42:04Z&quot;, GoVersion:&quot;go1.19.2&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;&#125;<br></code></pre></td></tr></table></figure><h2 id="4-2-å‡†å¤‡-ubuntu-20-04-debs-amd64-iso"><a href="#4-2-å‡†å¤‡-ubuntu-20-04-debs-amd64-iso" class="headerlink" title="4.2 å‡†å¤‡ ubuntu-20.04-debs-amd64.iso"></a>4.2 å‡†å¤‡ ubuntu-20.04-debs-amd64.iso</h2><p>æœ¬å®éªŒç¯å¢ƒä½¿ç”¨çš„æ“ä½œç³»ç»Ÿæ˜¯ x86_64 çš„ Ubuntu 20.04.3 LTSï¼Œæ‰€ä»¥åªä¸‹è½½ Ubuntu 20.04.3 LTSçš„æ“ä½œç³»ç»Ÿä¾èµ–ç»„ä»¶åŒ…ï¼Œå…¶ä»–æ“ä½œç³»ç»Ÿåœ¨ <a href="https://link.zhihu.com/?target=https://github.com/kubesphere/kubekey/releases">KubeKey releases é¡µé¢</a>ä¸‹è½½ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œåœ¨èƒ½è”ç½‘çš„éƒ¨ç½²æœåŠ¡å™¨ä¸Šæ‰§è¡Œä¸‹è½½ã€‚ç½‘ç»œè®¿é—®å—é™æ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼ï¼Œå°†è¯¥ ISO ä¸‹è½½åæ”¾åˆ°åˆ¶ä½œç¦»çº¿é•œåƒçš„æœåŠ¡å™¨çš„ /opt/prepare ç›®å½•ä¸‹ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">KubeKey v3.0.13 çš„ release ä¸­æ²¡åŒ…ï¼Œåªèƒ½åœ¨ v3.0.12 çš„ releases ä¸­ä¸‹è½½ã€‚</span><br>root@prepare:/opt/prepare# wget https://github.com/kubesphere/kubekey/releases/download/v3.0.12/ubuntu-20.04-debs-amd64.iso<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">éªŒè¯ <span class="hljs-built_in">sha256sum</span>ï¼Œç¡®ä¿ ISO åœ¨ä¸‹è½½è¿‡ç¨‹ä¸­æ²¡å‡ºé—®é¢˜ï¼ˆå®˜æ–¹æä¾›çš„ <span class="hljs-built_in">sha256sum</span> ä¿¡æ¯åœ¨ https://github.com/kubesphere/kubekey/releases/download/v3.0.12/ubuntu-20.04-debs.iso.sha256sum.txtï¼‰</span><br>root@prepare:/opt/prepare# sha256sum ubuntu-20.04-debs-amd64.iso<br>9c35697e4192c57a9195a8d216beda71058a420444c89b895147f27339c369b9  ubuntu-20.04-debs-amd64.iso<br>root@ksp-deploy:/opt/prepare# cat ubuntu-20.04-debs.iso.sha256sum.txt <br>9c35697e4192c57a9195a8d216beda71058a420444c89b895147f27339c369b9  ubuntu-20.04-debs-amd64.iso<br>99152a2675d334cf4d17a32bd99ca1fa21616b5bfe45bb5c93f5175ebca472a0  ubuntu-20.04-debs-arm64.iso<br></code></pre></td></tr></table></figure><h2 id="4-3-å‡†å¤‡-manifest-æ–‡ä»¶"><a href="#4-3-å‡†å¤‡-manifest-æ–‡ä»¶" class="headerlink" title="4.3 å‡†å¤‡ manifest æ–‡ä»¶"></a>4.3 å‡†å¤‡ manifest æ–‡ä»¶</h2><p>å‰æ–‡å·²ç»è¯´è¿‡ï¼Œæœ¬æ–‡æ˜¯åœ¨å®˜æ–¹ç¤ºä¾‹çš„åŸºç¡€ä¸Šç»è¿‡ä¿®æ”¹ç”Ÿæˆ manifest æ–‡ä»¶ã€‚å®˜æ–¹ç¤ºä¾‹çš„è¯ï¼Œç¬”è€…çŸ¥é“æœ‰ä¸¤ä¸ªé¡µé¢å¯ä»¥çœ‹åˆ°ï¼šé’äº‘å®˜ç½‘çš„ç¦»çº¿éƒ¨ç½²æ–‡æ¡£ ä¸ <a href="https://github.com/kubesphere/kubekey/blob/master/docs/manifest-example.md">manifest-example</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">ksp v3.4.1 å¯¹åº”çš„å®Œæ•´é•œåƒåˆ—è¡¨å¯ä»¥é€šè¿‡å¦‚ä¸‹è¿æ¥ä¸‹è½½å¾—åˆ°</span><br>root@prepare:/opt/prepare# wget https://github.com/kubesphere/ks-installer/releases/download/v3.4.1/images-list.txt<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½†å…¶ä¸­åŒ…å«çš„æ˜¯ docker.io ä¸Šçš„é•œåƒï¼Œå¯ä»¥åœ¨ä¸Šè¿°â€œé’äº‘å®˜ç½‘çš„ç¦»çº¿éƒ¨ç½²æ–‡æ¡£https://www.kubesphere.io/zh/docs/v3.4/installing-on-linux/introduction/air-gapped-installation/â€ä¸­çœ‹åˆ°å…¶ä¸­ç¤ºä¾‹ä½¿ç”¨çš„æ˜¯aliyuncsé•œåƒä»“åº“ä¸­çš„å¯¹åº”é•œåƒï¼Œé€šè¿‡å‚è€ƒä¸¤å¤„çš„é•œåƒåˆ—è¡¨å¹¶è¿›è¡Œä¿®æ”¹ï¼ŒåŒæ—¶ä¿®æ”¹äº†é•œåƒåˆ—è¡¨ä¹‹å¤–çš„å…¶ä»–é…ç½®ï¼Œæœ€ç»ˆå¾—åˆ°å¦‚ä¸‹k8sV12317-kspV341-manifest.yaml</span><br><br>root@prepare:/opt/prepare# vi k8sV12317-kspV341-manifest.yaml<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿®æ”¹åçš„æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</span><br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">kubekey.kubesphere.io/v1alpha2</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Manifest</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">sample</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">arches:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">amd64</span><br>  <span class="hljs-attr">operatingSystems:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">arch:</span> <span class="hljs-string">amd64</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">linux</span><br>    <span class="hljs-attr">id:</span> <span class="hljs-string">ubuntu</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-string">&quot;20.04&quot;</span><br>    <span class="hljs-attr">osImage:</span> <span class="hljs-string">Ubuntu</span> <span class="hljs-number">20.04</span><span class="hljs-number">.3</span> <span class="hljs-string">LTS</span><br>    <span class="hljs-attr">repository:</span><br>      <span class="hljs-attr">iso:</span><br>        <span class="hljs-attr">localPath:</span> <span class="hljs-string">/opt/prepare/ubuntu-20.04-debs-amd64.iso</span><br>        <span class="hljs-attr">url:</span> <br>  <span class="hljs-attr">kubernetesDistributions:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">kubernetes</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-string">v1.23.17</span><br>  <span class="hljs-attr">components:</span><br>    <span class="hljs-attr">helm:</span><br>      <span class="hljs-attr">version:</span> <span class="hljs-string">v3.9.0</span><br>    <span class="hljs-attr">cni:</span><br>      <span class="hljs-attr">version:</span> <span class="hljs-string">v1.2.0</span><br>    <span class="hljs-attr">etcd:</span><br>      <span class="hljs-attr">version:</span> <span class="hljs-string">v3.4.13</span><br>    <span class="hljs-attr">calicoctl:</span><br>      <span class="hljs-attr">version:</span> <span class="hljs-string">v3.26.1</span><br>   <span class="hljs-comment">## For now, if your cluster container runtime is containerd, KubeKey will add a docker 20.10.8 container runtime in the below list.</span><br>   <span class="hljs-comment">## The reason is KubeKey creates a cluster with containerd by installing a docker first and making kubelet connect the socket file of containerd which docker contained.</span><br>    <span class="hljs-attr">containerRuntimes:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">docker</span><br>      <span class="hljs-attr">version:</span> <span class="hljs-number">24.0</span><span class="hljs-number">.6</span><br>    <span class="hljs-attr">crictl:</span><br>      <span class="hljs-attr">version:</span> <span class="hljs-string">v1.24.0</span><br>    <span class="hljs-attr">docker-registry:</span><br>      <span class="hljs-attr">version:</span> <span class="hljs-string">&quot;2&quot;</span><br>    <span class="hljs-attr">harbor:</span><br>      <span class="hljs-attr">version:</span> <span class="hljs-string">v2.5.3</span><br>    <span class="hljs-attr">docker-compose:</span><br>      <span class="hljs-attr">version:</span> <span class="hljs-string">v2.2.2</span><br>  <span class="hljs-attr">images:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/kube-apiserver:v1.23.17</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/kube-controller-manager:v1.23.17</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/kube-proxy:v1.23.17</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/kube-scheduler:v1.23.17</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/pause:3.6</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/coredns:1.8.6</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/cni:v3.26.1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/kube-controllers:v3.26.1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/node:v3.26.1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/pod2daemon-flexvol:v3.26.1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/typha:v3.23.2</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/flannel:v0.12.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/provisioner-localpv:3.3.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/linux-utils:3.3.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/haproxy:2.3</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/nfs-subdir-external-provisioner:v4.0.2</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/k8s-dns-node-cache:1.15.12</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/ks-installer:v3.4.1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/ks-apiserver:v3.4.1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/ks-console:v3.4.1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/ks-controller-manager:v3.4.1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/kubectl:v1.22.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/kubectl:v1.21.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/kubectl:v1.20.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/kubefed:v0.8.1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/tower:v0.2.1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/minio:RELEASE.2019-08-07T01-59-21Z</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/mc:RELEASE.2019-08-07T23-14-43Z</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/snapshot-controller:v4.0.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/nginx-ingress-controller:v1.3.1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/defaultbackend-amd64:1.4</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/metrics-server:v0.4.2</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/redis:5.0.14-alpine</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/haproxy:2.0.25-alpine</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/alpine:3.14</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/openldap:1.3.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/netshoot:v1.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/cloudcore:v1.13.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/iptables-manager:v1.13.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/edgeservice:v0.3.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/gatekeeper:v3.5.2</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/openpitrix-jobs:v3.3.2</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/devops-apiserver:ks-v3.4.1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/devops-controller:ks-v3.4.1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/devops-tools:ks-v3.4.1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/ks-jenkins:v3.4.0-2.319.3-1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/inbound-agent:4.10-2</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/builder-base:v3.2.2</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/builder-nodejs:v3.2.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/builder-maven:v3.2.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/builder-maven:v3.2.1-jdk11</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/builder-python:v3.2.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/builder-go:v3.2.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/builder-go:v3.2.2-1.16</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/builder-go:v3.2.2-1.17</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/builder-go:v3.2.2-1.18</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/builder-base:v3.2.2-podman</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/builder-nodejs:v3.2.0-podman</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/builder-maven:v3.2.0-podman</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/builder-maven:v3.2.1-jdk11-podman</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/builder-python:v3.2.0-podman</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/builder-go:v3.2.0-podman</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/builder-go:v3.2.2-1.16-podman</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/builder-go:v3.2.2-1.17-podman</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/builder-go:v3.2.2-1.18-podman</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/s2ioperator:v3.2.1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/s2irun:v3.2.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/s2i-binary:v3.2.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/tomcat85-java11-centos7:v3.2.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/tomcat85-java11-runtime:v3.2.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/tomcat85-java8-centos7:v3.2.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/tomcat85-java8-runtime:v3.2.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/java-11-centos7:v3.2.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/java-8-centos7:v3.2.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/java-8-runtime:v3.2.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/java-11-runtime:v3.2.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/nodejs-8-centos7:v3.2.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/nodejs-6-centos7:v3.2.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/nodejs-4-centos7:v3.2.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/python-36-centos7:v3.2.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/python-35-centos7:v3.2.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/python-34-centos7:v3.2.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/python-27-centos7:v3.2.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/argocd:v2.3.3</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/argocd-applicationset:v0.4.1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/dex:v2.30.2</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/redis:6.2.6-alpine</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/configmap-reload:v0.7.1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/prometheus:v2.39.1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/prometheus-config-reloader:v0.55.1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/prometheus-operator:v0.55.1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/kube-rbac-proxy:v0.11.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/kube-state-metrics:v2.6.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/node-exporter:v1.3.1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/alertmanager:v0.23.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/thanos:v0.31.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/grafana:8.3.3</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/kube-rbac-proxy:v0.11.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/notification-manager-operator:v2.3.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/notification-manager:v2.3.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/notification-tenant-sidecar:v3.2.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/elasticsearch-curator:v5.7.6</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/elasticsearch-oss:6.8.22</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/opensearch:2.6.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/opensearch-dashboards:2.6.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/opensearch-curator:v0.0.5</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/fluentbit-operator:v0.14.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/docker:19.03</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/fluent-bit:v1.9.4</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/log-sidecar-injector:v1.2.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/filebeat:6.7.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/kube-events-operator:v0.6.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/kube-events-exporter:v0.6.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/kube-events-ruler:v0.6.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/kube-auditing-operator:v0.2.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/kube-auditing-webhook:v0.2.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/pilot:1.14.6</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/proxyv2:1.14.6</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/jaeger-operator:1.29</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/jaeger-agent:1.29</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/jaeger-collector:1.29</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/jaeger-query:1.29</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/jaeger-es-index-cleaner:1.29</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/kiali-operator:v1.50.1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/kiali:v1.50</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/busybox:1.31.1</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/nginx:1.14-alpine</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/wget:1.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/hello:plain-text</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/wordpress:4.8-apache</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/hpa-example:latest</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/fluentd:v1.4.2-2.0</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/perl:latest</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/examples-bookinfo-productpage-v1:1.16.2</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/examples-bookinfo-reviews-v1:1.16.2</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/examples-bookinfo-reviews-v2:1.16.2</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/examples-bookinfo-details-v1:1.16.2</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/examples-bookinfo-ratings-v1:1.16.3</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">registry.cn-beijing.aliyuncs.com/kubesphereio/scope:1.13.0</span><br>  <span class="hljs-attr">kubectl:</span> <span class="hljs-string">v1.22.0</span><br>  <span class="hljs-attr">registry:</span><br>    <span class="hljs-attr">auths:</span> &#123;&#125;<br></code></pre></td></tr></table></figure><h2 id="4-4-ç”Ÿæˆåˆ¶å“æ–‡ä»¶"><a href="#4-4-ç”Ÿæˆåˆ¶å“æ–‡ä»¶" class="headerlink" title="4.4 ç”Ÿæˆåˆ¶å“æ–‡ä»¶"></a>4.4 ç”Ÿæˆåˆ¶å“æ–‡ä»¶</h2><p>åˆ¶å“ï¼ˆartifactï¼‰æ˜¯ä¸€ä¸ªæ ¹æ®æŒ‡å®šçš„ manifest æ–‡ä»¶å†…å®¹å¯¼å‡ºçš„åŒ…å«é•œåƒ tar åŒ…å’Œç›¸å…³äºŒè¿›åˆ¶æ–‡ä»¶çš„ tgz åŒ…ã€‚  åœ¨ KubeKey åˆå§‹åŒ–é•œåƒä»“åº“ã€åˆ›å»ºé›†ç¾¤ã€æ·»åŠ èŠ‚ç‚¹å’Œå‡çº§é›†ç¾¤çš„å‘½ä»¤ä¸­å‡å¯æŒ‡å®šä¸€ä¸ª artifactï¼ŒKubeKey å°†è‡ªåŠ¨è§£åŒ…è¯¥ artifact å¹¶åœ¨æ‰§è¡Œå‘½ä»¤æ—¶ç›´æ¥ä½¿ç”¨è§£åŒ…å‡ºæ¥çš„æ–‡ä»¶ã€‚</p><p><strong>æ³¨æ„</strong></p><ul><li>å¯¼å‡ºæ—¶è¯·ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸ï¼ˆå¦‚æœä¸­æ–­å°±éœ€è¦å…¨éƒ¨é‡æ–°æ¥è¿‡ï¼‰ã€‚</li><li>KubeKey ä¼šè§£æé•œåƒåˆ—è¡¨ä¸­çš„é•œåƒåï¼Œè‹¥é•œåƒåä¸­çš„é•œåƒä»“åº“éœ€è¦é‰´æƒä¿¡æ¯ï¼Œå¯åœ¨ manifest æ–‡ä»¶ä¸­çš„ <strong>.registry.auths</strong> å­—æ®µä¸­è¿›è¡Œé…ç½®ï¼ˆå› ä¸ºæ­¤å¤„ä½¿ç”¨çš„æ˜¯aliyuncsçš„å…¬å…±å®¹å™¨é•œåƒï¼Œæ‰€ä»¥æ— éœ€é‰´æƒï¼‰ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å›½å†…ä¸€èˆ¬æœåŠ¡å™¨è®¿é—® GitHub/Googleapis å—é™ï¼Œå¼ºçƒˆå»ºè®®æ‰§è¡Œä½¿ç”¨æ­¤ç¯å¢ƒå˜é‡</span><br>root@prepare:/opt/prepare# export KKZONE=cn<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ ¹æ®ä¸Šè¿°åˆ¶ä½œçš„çš„ manifestï¼Œåœ¨prepareæœåŠ¡å™¨ä¸Šæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤åˆ¶ä½œåˆ¶å“ï¼ˆartifactï¼‰</span><br>root@prepare:/opt/prepare# ./kk artifact export -m k8sV12317-kspV341-manifest.yaml -o k8sV12317-kspV341-artifact.tar.gz<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¸Šè¿°å‘½åæ‰§è¡Œæ—¶ï¼Œä¼šåœ¨å½“å‰ç›®å½•åˆ›å»ºä¸€ä¸ª kubekey å­ç›®å½•</span><br></code></pre></td></tr></table></figure><p>æ­¤å‘½ä»¤éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œæ‰§è¡Œå®Œæˆæ—¶å¦‚ä¸‹å›¾ã€‚</p><p><img src="https://s2.loli.net/2025/01/12/h9FTtslICbfSEJa.png" alt="image-20250112124715488"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ¶ä½œè¿‡ç¨‹ä¸­ï¼Œåˆ›å»º kubekey/artifactç›®å½•å…¶ä¸­å­˜æ”¾ä¸´æ—¶ä¸‹è½½çš„æ–‡ä»¶ä¸é•œåƒï¼Œåˆ¶å“åˆ¶ä½œå®Œæˆå kubekey/artifact ç›®å½•ä¼šè¢«æ¸…ç†</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ¶ä½œå®Œæˆåï¼Œä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆä¸€ä¸ª k8sV12317-kspV341-artifact.tar.gz æ–‡ä»¶</span><br>root@prepare:/opt/prepare# ls -alh k8sV12317-kspV341-artifact.tar.gz<br>-rw-r--r-- 1 root root 13G Jan 12 12:41 k8sV12317-kspV341-artifact.tar.gz<br></code></pre></td></tr></table></figure><h2 id="4-5-ç¦»çº¿éƒ¨ç½²èµ„æºæ–‡ä»¶æ±‡æ€»"><a href="#4-5-ç¦»çº¿éƒ¨ç½²èµ„æºæ–‡ä»¶æ±‡æ€»" class="headerlink" title="4.5 ç¦»çº¿éƒ¨ç½²èµ„æºæ–‡ä»¶æ±‡æ€»"></a>4.5 ç¦»çº¿éƒ¨ç½²èµ„æºæ–‡ä»¶æ±‡æ€»</h2><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å‡†å¤‡äº†å¦‚ä¸‹ä¸¤ä¸ªç¦»çº¿éƒ¨ç½²æ–‡ä»¶ï¼š</p><ul><li>KubeKeyï¼š<strong>kubekey-v3.0.13-linux-amd64.tar.gzï¼ˆ35Mï¼‰</strong></li><li>åˆ¶å“artifactï¼š<strong>k8sV12317-kspV341-artifact.tar.gzï¼ˆ13Gï¼‰</strong></li></ul><h1 id="äº”ã€ç¦»çº¿éƒ¨ç½²æ‰§è¡Œå‰å‡†å¤‡"><a href="#äº”ã€ç¦»çº¿éƒ¨ç½²æ‰§è¡Œå‰å‡†å¤‡" class="headerlink" title="äº”ã€ç¦»çº¿éƒ¨ç½²æ‰§è¡Œå‰å‡†å¤‡"></a>äº”ã€ç¦»çº¿éƒ¨ç½²æ‰§è¡Œå‰å‡†å¤‡</h1><h2 id="5-1-ä¸Šä¼ ç¦»çº¿éƒ¨ç½²èµ„æºæ–‡ä»¶"><a href="#5-1-ä¸Šä¼ ç¦»çº¿éƒ¨ç½²èµ„æºæ–‡ä»¶" class="headerlink" title="5.1 ä¸Šä¼ ç¦»çº¿éƒ¨ç½²èµ„æºæ–‡ä»¶"></a>5.1 ä¸Šä¼ ç¦»çº¿éƒ¨ç½²èµ„æºæ–‡ä»¶</h2><p>å°† KubeKey å’Œåˆ¶å“ artifact ï¼Œä¸Šä¼ è‡³ç¦»çº¿ç¯å¢ƒéƒ¨ç½²èŠ‚ç‚¹ (æ­¤å¤„æ˜¯ <strong>k8s01-1</strong> èŠ‚ç‚¹ï¼Œæ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯å‚è€ƒæ–‡æ¡£æœ€å¼€å§‹å¤„çš„æè¿°) çš„ &#x2F;opt&#x2F; ç›®å½•ã€‚</p><ul><li>KubeKeyï¼š<strong>kubekey-v3.0.13-linux-amd64.tar.gzï¼ˆ35Mï¼‰</strong></li><li>åˆ¶å“artifactï¼š<strong>k8sV12317-kspV341-artifact.tar.gzï¼ˆ13Gï¼‰</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ›å»ºç¦»çº¿èµ„æºå­˜æ”¾çš„æ•°æ®ç›®å½•</span><br>root@k8s01-1:/# mkdir /opt/offline-deployk8sksp<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè§£å‹ KubeKeyï¼š</span><br>root@k8s01-1:/# mv /opt/k8sV12317-kspV341-artifact.tar.gz /opt/offline-deployk8sksp<br>root@k8s01-1:/# tar -zxf /opt/kubekey-v3.0.13-linux-amd64.tar.gz -C /opt/offline-deployk8sksp<br>root@k8s01-1:/# cd /opt/offline-deployk8sksp<br></code></pre></td></tr></table></figure><h2 id="5-2-åˆ›å»ºç¦»çº¿é›†ç¾¤é…ç½®æ–‡ä»¶"><a href="#5-2-åˆ›å»ºç¦»çº¿é›†ç¾¤é…ç½®æ–‡ä»¶" class="headerlink" title="5.2 åˆ›å»ºç¦»çº¿é›†ç¾¤é…ç½®æ–‡ä»¶"></a>5.2 åˆ›å»ºç¦»çº¿é›†ç¾¤é…ç½®æ–‡ä»¶</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºç¦»çº¿é›†ç¾¤é…ç½®æ–‡ä»¶</span><br>root@k8s01-1:/opt/offline-deployk8sksp# ./kk create config --with-kubesphere v3.4.1 --with-kubernetes v1.23.17 -f k8sV12317-kspV341-offlineconfig.yaml<br></code></pre></td></tr></table></figure><p>å‘½ä»¤æ‰§è¡ŒæˆåŠŸåï¼Œåœ¨åŒç›®å½•ä¼šç”Ÿæˆä¸€ä¸ª k8sV12317-kspV341-offlineconfig.yaml æ–‡ä»¶ã€‚</p><h2 id="5-3-ä¿®æ”¹-K8S-éƒ¨ç½²ç›¸å…³é…ç½®"><a href="#5-3-ä¿®æ”¹-K8S-éƒ¨ç½²ç›¸å…³é…ç½®" class="headerlink" title="5.3 ä¿®æ”¹ K8S éƒ¨ç½²ç›¸å…³é…ç½®"></a>5.3 ä¿®æ”¹ K8S éƒ¨ç½²ç›¸å…³é…ç½®</h2><p>k8sV12317-kspV341-offlineconfig.yaml æ–‡ä»¶ä¸­ <strong>â€œkind: Clusterâ€</strong> éƒ¨åˆ†æ˜¯éƒ¨ç½² k8s é›†ç¾¤çš„ç›¸å…³é…ç½®ï¼Œåªéœ€è¦ä¿®æ”¹ spec å†…çš„å†…å®¹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@k8s01-1:/opt/offline-deployk8sksp# vi k8sV12317-kspV341-offlineconfig.yaml<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿®æ”¹ç¦»çº¿é›†ç¾¤é…ç½®æ–‡ä»¶ k8sV12317-kspV341-offlineconfig.yamlï¼Œä¿®æ”¹è¯´æ˜åŠä¿®æ”¹åçš„æˆªå›¾å¦‚ä¸‹</span><br></code></pre></td></tr></table></figure><p>spec å†…éœ€è¦ä¿®æ”¹å¤„è¯´æ˜å¦‚ä¸‹ï¼ˆå…¶ä½™æœªè¯´æ˜å¤„ä¿æŒé»˜è®¤ï¼‰ï¼š</p><ul><li>hostséƒ¨åˆ†ï¼šæŒ‡å®šæ‰€æœ‰k8sèŠ‚ç‚¹çš„ä¸»æœºä¸»æœºåã€ IPã€ç”¨æˆ·ã€å¯†ç æ­¤å¤–è¿˜æ–°å¢ä¸€ä¸ª registry èŠ‚ç‚¹çš„é…ç½®</li><li>roleGroupséƒ¨åˆ†ï¼šæŒ‡å®š 3 ä¸ªèŠ‚ç‚¹åŒæ—¶ä½œä¸º etcdã€control-plane å’Œ worker èŠ‚ç‚¹ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªæœåŠ¡å™¨k8s01-4åªåšå·¥ä½œèŠ‚ç‚¹ã€‚å¦å¤– <code>registry</code> éƒ¨åˆ†æŒ‡å®šé•œåƒä»“åº“çš„æœåŠ¡å™¨ä¸»æœºåï¼Œç”¨äº KubeKey éƒ¨ç½²è‡ªå»º Harbor ä»“åº“</li><li>controlPlaneEndpointéƒ¨åˆ†ï¼š å¯ç”¨å¹¶è®¾ç½®å†…ç½®çš„è´Ÿè½½å‡è¡¡å™¨ï¼ˆinternalLoadbalancerï¼‰ä¸º HAProxy</li><li>æ–°å¢äº†storage.openebs.basePath éƒ¨åˆ†ï¼šæŒ‡å®š openebs é»˜è®¤å­˜å‚¨è·¯å¾„ï¼ˆå°±æ˜¯é»˜è®¤åˆ›å»ºçš„sc&#x2F;localçš„å­˜å‚¨è·¯å¾„ï¼‰ä¸º <strong>&#x2F;data&#x2F;openebs&#x2F;local</strong></li><li>registryï¼šæ·»åŠ  type ç±»å‹ä¸º harborï¼Œå¦åˆ™åé¢æ‰§è¡Œâ€œinit registryâ€æ—¶ä¼šå®‰è£… docker registry ä½œä¸ºé•œåƒä»“åº“ï¼Œè¿˜æœ‰<code>auths</code>éƒ¨åˆ†ä¸<code>privateRegistry</code>ä¸<code>namespaceOverride</code>å‚æ•°ï¼ˆauthséƒ¨åˆ†æœ‰å‚è€ƒï¼š <a href="https://github.com/kubesphere/kubekey/blob/master/docs/config-example.md">kubesphereå…³äºéƒ¨ç½²é…ç½®æ–‡ä»¶çš„æè¿°</a>ï¼‰</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs shell">apiVersion: kubekey.kubesphere.io/v1alpha2<br>kind: Cluster<br>metadata:<br>  name: sample<br>spec:<br>  hosts:<br>  - &#123;name: k8s01-1, address: 10.13.15.16, internalAddress: 10.13.15.16, user: root, password: &quot;cloud@2020&quot;&#125;<br>  - &#123;name: k8s01-2, address: 10.13.15.17, internalAddress: 10.13.15.17, user: root, password: &quot;cloud@2020&quot;&#125;<br>  - &#123;name: k8s01-3, address: 10.13.15.161, internalAddress: 10.13.15.161, user: root, password: &quot;cloud@2020&quot;&#125;<br>  - &#123;name: k8s01-4, address: 10.13.15.99, internalAddress: 10.13.15.99, user: root, password: &quot;cloud@2020&quot;&#125;<br>  - &#123;name: registry, address: 10.13.15.71, internalAddress: 10.13.15.71, user: root, password: &quot;cloud@2020&quot;&#125;<br>  roleGroups:<br>    etcd:<br>    - k8s01-1<br>    - k8s01-2<br>    - k8s01-3<br>    control-plane:<br>    - k8s01-1<br>    - k8s01-2<br>    - k8s01-3<br>    worker:<br>    - k8s01-1<br>    - k8s01-2<br>    - k8s01-3<br>    - k8s01-4<br>    registry:    # å¦‚éœ€ä½¿ç”¨ kk è‡ªåŠ¨éƒ¨ç½²é•œåƒä»“åº“ï¼Œè¯·è®¾ç½®è¯¥ä¸»æœºç»„ ï¼ˆå»ºè®®ä»“åº“ä¸é›†ç¾¤åˆ†ç¦»éƒ¨ç½²ï¼Œå‡å°‘ç›¸äº’å½±å“ï¼‰<br>    - registry<br>  controlPlaneEndpoint:<br>    ## Internal loadbalancer for apiservers <br>    internalLoadbalancer: haproxy<br><br>    domain: lb.kubesphere.local<br>    address: &quot;&quot;<br>    port: 6443<br>  kubernetes:<br>    version: v1.23.17<br>    clusterName: cluster.local<br>    autoRenewCerts: true<br>    containerManager: docker<br>  etcd:<br>    type: kubekey<br>  network:<br>    plugin: calico<br>    kubePodsCIDR: 10.233.64.0/18<br>    kubeServiceCIDR: 10.233.0.0/18<br>    ## multus support. https://github.com/k8snetworkplumbingwg/multus-cni<br>    multusCNI:<br>      enabled: false<br>  storage:<br>    openebs:<br>      basePath: /data/openebs/local # é»˜è®¤æ²¡æœ‰çš„æ–°å¢é…ç½®ï¼Œbase path of the local PV provisioner<br>  registry:<br>    # å¦‚éœ€ä½¿ç”¨ kk éƒ¨ç½² harbor, å¯å°†è¯¥å‚æ•°è®¾ç½®ä¸º harborï¼Œä¸è®¾ç½®è¯¥å‚æ•°ä¸”éœ€ä½¿ç”¨ kk åˆ›å»ºå®¹å™¨é•œåƒä»“åº“ï¼Œå°†é»˜è®¤ä½¿ç”¨docker registryã€‚<br>    type: harbor<br>    # å¦‚ä½¿ç”¨ kk éƒ¨ç½²çš„ harbor æˆ–å…¶ä»–éœ€è¦ç™»å½•çš„ä»“åº“ï¼Œå¯è®¾ç½®å¯¹åº”ä»“åº“çš„authsï¼Œå¦‚ä½¿ç”¨ kk åˆ›å»ºçš„ docker registry ä»“åº“ï¼Œåˆ™æ— éœ€é…ç½®è¯¥å‚æ•°ã€‚<br>    # æ³¨æ„ï¼šå¦‚ä½¿ç”¨ kk éƒ¨ç½² harborï¼Œè¯¥å‚æ•°è¯·äº harbor å¯åŠ¨åè®¾ç½®ã€‚<br>    #auths:<br>    #  &quot;registry.syjiang.com&quot;:<br>    #    username: admin<br>    #    password: Harbor12345<br>    #    certsPath: &quot;/etc/docker/certs.d/registry.syjiang.com&quot;<br>    #    skipTLSVerify: false # å³ä½¿ TLSæ ¡éªŒå¤±è´¥äº†ï¼Œä»å…è®¸é€šè¿‡HTTPSåè®®è¿æ¥registry<br>    #    plainHTTP: false # å…è®¸é€šè¿‡HTTPåè®®è¿æ¥registry<br>    # è®¾ç½®é›†ç¾¤éƒ¨ç½²æ—¶ä½¿ç”¨çš„ç§æœ‰ä»“åº“<br>    privateRegistry: &quot;registry.syjiang.com&quot;<br>    namespaceOverride: &quot;kubesphereio&quot;<br>    registryMirrors: []<br>    insecureRegistries: []<br>  addons: []<br></code></pre></td></tr></table></figure><h2 id="5-4-ä¿®æ”¹-KSP-éƒ¨ç½²ç›¸å…³é…ç½®"><a href="#5-4-ä¿®æ”¹-KSP-éƒ¨ç½²ç›¸å…³é…ç½®" class="headerlink" title="5.4 ä¿®æ”¹ KSP éƒ¨ç½²ç›¸å…³é…ç½®"></a>5.4 ä¿®æ”¹ KSP éƒ¨ç½²ç›¸å…³é…ç½®</h2><p>k8sV12317-kspV341-offlineconfig.yaml æ–‡ä»¶ä¸­ <strong>kind: ClusterConfiguration</strong> éƒ¨åˆ†æ˜¯å…³äºéƒ¨ç½² KubeSphere åŠç›¸å…³æ’ä»¶çš„é…ç½®ã€‚</p><h3 id="5-4-1-å¿…é¡»è¦æ–°å¢çš„å‚æ•°"><a href="#5-4-1-å¿…é¡»è¦æ–°å¢çš„å‚æ•°" class="headerlink" title="5.4.1 å¿…é¡»è¦æ–°å¢çš„å‚æ•°"></a>5.4.1 å¿…é¡»è¦æ–°å¢çš„å‚æ•°</h3><ul><li>æ·»åŠ ClusterConfiguration.spec.namespace_overrideå‚æ•°</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">82 spec:<br>83   namespace_override: &quot;kubesphereio&quot;<br></code></pre></td></tr></table></figure><p>æ­¤å‚æ•°çš„æ„ä¹‰è·ŸK8Séƒ¨ç½²é…ç½®ä¸­çš„<code>spec.registry.namespaceOverride</code>ç±»ä¼¼ï¼Œè¦ç¡®è®¤æ˜¯é…ç½®æˆ <strong><code>kubesphereio</code></strong>ï¼Œä¸”è¦åŠ åŒå¼•å·ï¼ˆç¬”è€…å…ˆå‰æ²¡åŠ åŒå¼•å·æ—¶æ²¡ç”Ÿæ•ˆï¼Œä½†kubesphereå®˜æ–¹cnblogsåšå®¢æ–‡ç« ä¸­æ˜¯æ²¡æœ‰åŠ åŒå¼•å·çš„ï¼‰ã€‚å®ƒçš„ä½œç”¨å°±æ˜¯<code>Kubesphere</code>æœ¬èº«ä½¿ç”¨åˆ°çš„é•œåƒåªåˆ°**<code>registry.syjiang.com/kubesphereio</code><strong>ä¸‹é¢å»æ‹‰å–ï¼Œå¦‚æœä¸é…ç½®çš„è¯æœ‰äº›é•œåƒæ˜¯ä¼šåˆ°å¦å¤–çš„é¡¹ç›®ä¸‹æ‹‰å–çš„æ¯”å¦‚<code>kubesphere-system</code>ç©ºé—´ä¸­<code>pod/ks-apiserver-xxx</code>ç”¨åˆ°çš„é•œåƒå°±æ˜¯</strong><code>registry.syjiang.com/kubesphere/ks-apiserver:v3.4.1</code>**ã€‚</p><p>æ®Kubeshpereçš„å®˜æ–¹åšæ–‡ä»‹ç»ï¼Œ2.x ç‰ˆæœ¬çš„ KubeKey æ²¡è¿™ä¸ªé—®é¢˜ï¼Œ3.x çš„åˆ° v3.1.1 ä¸ºæ­¢ï¼Œéƒ½å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚</p><h3 id="5-4-2-å¯ä¿®æ”¹çš„å‚æ•°ï¼ˆå¯é€‰ï¼‰"><a href="#5-4-2-å¯ä¿®æ”¹çš„å‚æ•°ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="5.4.2 å¯ä¿®æ”¹çš„å‚æ•°ï¼ˆå¯é€‰ï¼‰"></a>5.4.2 å¯ä¿®æ”¹çš„å‚æ•°ï¼ˆå¯é€‰ï¼‰</h3><p>å‰é¢å‡†å¤‡çš„åˆ¶å“æ–‡ä»¶éå¸¸ä¹‹å¤§æœ‰10å¤šGï¼Œå°±æ˜¯å› ä¸ºå…¶ä¸­åŒ…å«ç›¸å…³å¯é€‰ç»„ä»¶çš„å…¨é‡é•œåƒã€‚å¦‚æœä¸æƒ³å¯ç”¨å¯é€‰æ’ä»¶ï¼Œè¿™éƒ¨åˆ†ç›´æ¥ä¿æŒé»˜è®¤é…ç½®ä¹Ÿå¯ã€‚</p><p>å¦‚æœæœ‰éœ€è¦æˆ–æƒ³å­¦ä¹ ä¸€ä¸‹ï¼Œå¯ä»¥å¯ç”¨ç›¸å…³æ’ä»¶é…ç½®ã€‚ä»¥ä¸‹æ˜¯å¯ç”¨äº†é™¤ Kubeedge ã€gatekeeper ä»¥å¤–çš„æ‰€æœ‰æ’ä»¶åçš„é…ç½®ï¼ˆå¾ˆå¤šå†…å®¹ç¬”è€…å¹¶æ²¡æœ‰ç”¨è¿‡ï¼Œåªæ˜¯å‚è€ƒäº†kubesphereåœ¨cnblogsä¸Šçš„åšæ–‡ <a href="https://www.cnblogs.com/kubesphere/p/18208852">ä¸€æ–‡æå®š KubeKey 3.1.1 ç¦»çº¿éƒ¨ç½² KubeSphere 3.4.1 å’Œ Kubernetes v1.28</a>ï¼‰ã€‚</p><ul><li>å¯ç”¨ etcd ç›‘æ§</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">90   etcd:<br>91     monitoring: true #å°†falseæ”¹ä¸ºtrue<br>92     endpointIps: localhost<br>93     port: 2379<br>94     tlsEnable: true<br></code></pre></td></tr></table></figure><ul><li>å¯ç”¨ KubeSphere å‘Šè­¦ç³»ç»Ÿ</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">162   alerting:<br>163     enabled: true #å°†falseæ”¹ä¸ºtrue<br>164     # thanosruler:<br>165     #   replicas: 1<br>166     #   resources: &#123;&#125;<br></code></pre></td></tr></table></figure><ul><li>å¯ç”¨ KubeSphere å®¡è®¡æ—¥å¿—</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">167   auditing:<br>168     enabled: true #å°†falseæ”¹ä¸ºtrue<br>169     # operator:<br>170     #   resources: &#123;&#125;<br>171     # webhook:<br>172     #   resources: &#123;&#125;<br></code></pre></td></tr></table></figure><ul><li>å¯ç”¨ KubeSphere DevOps ç³»ç»Ÿ</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">173   devops:<br>174     enabled: true #å°†falseæ”¹ä¸ºtrue<br>175     jenkinsCpuReq: 0.5<br>176     jenkinsCpuLim: 1<br>177     jenkinsMemoryReq: 4Gi<br>178     jenkinsMemoryLim: 4Gi<br>179     jenkinsVolumeSize: 16Gi<br></code></pre></td></tr></table></figure><ul><li>å¯ç”¨ KubeSphere äº‹ä»¶ç³»ç»Ÿ</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">180   events:<br>181     enabled: true #å°†falseæ”¹ä¸ºtrue<br>182     # operator:<br>183     #   resources: &#123;&#125;<br>184     # exporter:<br>185     #   resources: &#123;&#125;<br>186     ruler:<br>187       enabled: true<br>188       replicas: 2<br>189     #   resources: &#123;&#125;<br></code></pre></td></tr></table></figure><ul><li>å¯ç”¨ KubeSphere æ—¥å¿—ç³»ç»Ÿï¼ˆv3.4.0 å¼€å§‹é»˜è®¤å¯ç”¨ opensearchï¼‰</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">190   logging:<br>191     enabled: true #å°†falseæ”¹ä¸ºtrue<br>192     logsidecar:<br>193       enabled: true<br>194       replicas: 2<br>195       # resources: &#123;&#125;<br></code></pre></td></tr></table></figure><ul><li>å¯ç”¨ Metrics Server</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">196   metrics_server:<br>197     enabled: true #å°†falseæ”¹ä¸ºtrue<br></code></pre></td></tr></table></figure><p>**è¯´æ˜ï¼š*<em>KubeSphere æ”¯æŒç”¨äº</em>deployments*çš„å®¹å™¨ç»„ï¼ˆPodï¼‰å¼¹æ€§ä¼¸ç¼©ç¨‹åº (HPA)ã€‚åœ¨ KubeSphere ä¸­ï¼ŒMetrics Server æ§åˆ¶ç€ HPA æ˜¯å¦å¯ç”¨ã€‚</p><ul><li>å¯ç”¨ç½‘ç»œç­–ç•¥ã€å®¹å™¨ç»„ IP æ± ï¼ŒæœåŠ¡æ‹“æ‰‘å›¾</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">228   network:<br>229     networkpolicy:<br>230       enabled: true #å°†falseæ”¹ä¸ºtrue<br>231     ippool:<br>232       type: calico #å°†noneæ”¹ä¸º calico<br>233     topology:<br>234       type: weave-scope #å°†none æ”¹ä¸º weave-scope<br></code></pre></td></tr></table></figure><ul><li>å¯ç”¨åº”ç”¨å•†åº—</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">235   openpitrix:<br>236     store:<br>237       enabled: true #å°†falseæ”¹ä¸ºtrue<br></code></pre></td></tr></table></figure><ul><li>å¯ç”¨ KubeSphere æœåŠ¡ç½‘æ ¼ï¼ˆIstioï¼‰</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">238   servicemesh:<br>239     enabled: true #å°†falseæ”¹ä¸ºtrue<br>240     istio:<br>241       components:<br>242         ingressGateways:<br>243         - name: istio-ingressgateway<br>244           enabled: false<br>245         cni:<br>246           enabled: false<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œä¿®æ”¹åçš„ k8sV12317-kspV341-offlineconfig.yaml æ–‡ä»¶å®Œæ•´å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">kubekey.kubesphere.io/v1alpha2</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Cluster</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">sample</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">hosts:</span><br>  <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">name:</span> <span class="hljs-string">k8s01-1</span>, <span class="hljs-attr">address:</span> <span class="hljs-number">10.13</span><span class="hljs-number">.15</span><span class="hljs-number">.16</span>, <span class="hljs-attr">internalAddress:</span> <span class="hljs-number">10.13</span><span class="hljs-number">.15</span><span class="hljs-number">.16</span>, <span class="hljs-attr">user:</span> <span class="hljs-string">root</span>, <span class="hljs-attr">password:</span> <span class="hljs-string">&quot;cloud@2020&quot;</span>&#125;<br>  <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">name:</span> <span class="hljs-string">k8s01-2</span>, <span class="hljs-attr">address:</span> <span class="hljs-number">10.13</span><span class="hljs-number">.15</span><span class="hljs-number">.17</span>, <span class="hljs-attr">internalAddress:</span> <span class="hljs-number">10.13</span><span class="hljs-number">.15</span><span class="hljs-number">.17</span>, <span class="hljs-attr">user:</span> <span class="hljs-string">root</span>, <span class="hljs-attr">password:</span> <span class="hljs-string">&quot;cloud@2020&quot;</span>&#125;<br>  <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">name:</span> <span class="hljs-string">k8s01-3</span>, <span class="hljs-attr">address:</span> <span class="hljs-number">10.13</span><span class="hljs-number">.15</span><span class="hljs-number">.161</span>, <span class="hljs-attr">internalAddress:</span> <span class="hljs-number">10.13</span><span class="hljs-number">.15</span><span class="hljs-number">.161</span>, <span class="hljs-attr">user:</span> <span class="hljs-string">root</span>, <span class="hljs-attr">password:</span> <span class="hljs-string">&quot;cloud@2020&quot;</span>&#125;<br>  <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">name:</span> <span class="hljs-string">k8s01-4</span>, <span class="hljs-attr">address:</span> <span class="hljs-number">10.13</span><span class="hljs-number">.15</span><span class="hljs-number">.99</span>, <span class="hljs-attr">internalAddress:</span> <span class="hljs-number">10.13</span><span class="hljs-number">.15</span><span class="hljs-number">.99</span>, <span class="hljs-attr">user:</span> <span class="hljs-string">root</span>, <span class="hljs-attr">password:</span> <span class="hljs-string">&quot;cloud@2020&quot;</span>&#125;<br>  <span class="hljs-bullet">-</span> &#123;<span class="hljs-attr">name:</span> <span class="hljs-string">registry</span>, <span class="hljs-attr">address:</span> <span class="hljs-number">10.13</span><span class="hljs-number">.15</span><span class="hljs-number">.71</span>, <span class="hljs-attr">internalAddress:</span> <span class="hljs-number">10.13</span><span class="hljs-number">.15</span><span class="hljs-number">.71</span>, <span class="hljs-attr">user:</span> <span class="hljs-string">root</span>, <span class="hljs-attr">password:</span> <span class="hljs-string">&quot;cloud@2020&quot;</span>&#125;<br>  <span class="hljs-attr">roleGroups:</span><br>    <span class="hljs-attr">etcd:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">k8s01-1</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">k8s01-2</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">k8s01-3</span><br>    <span class="hljs-attr">control-plane:</span> <br>    <span class="hljs-bullet">-</span> <span class="hljs-string">k8s01-1</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">k8s01-2</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">k8s01-3</span><br>    <span class="hljs-attr">worker:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">k8s01-1</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">k8s01-2</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">k8s01-3</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">k8s01-4</span><br>    <span class="hljs-attr">registry:</span>    <span class="hljs-comment"># å¦‚éœ€ä½¿ç”¨ kk è‡ªåŠ¨éƒ¨ç½²é•œåƒä»“åº“ï¼Œè¯·è®¾ç½®è¯¥ä¸»æœºç»„ ï¼ˆå»ºè®®ä»“åº“ä¸é›†ç¾¤åˆ†ç¦»éƒ¨ç½²ï¼Œå‡å°‘ç›¸äº’å½±å“ï¼‰</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">registry</span><br>  <span class="hljs-attr">controlPlaneEndpoint:</span><br>    <span class="hljs-comment">## Internal loadbalancer for apiservers </span><br>    <span class="hljs-attr">internalLoadbalancer:</span> <span class="hljs-string">haproxy</span><br><br>    <span class="hljs-attr">domain:</span> <span class="hljs-string">lb.kubesphere.local</span><br>    <span class="hljs-attr">address:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6443</span><br>  <span class="hljs-attr">kubernetes:</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-string">v1.23.17</span><br>    <span class="hljs-attr">clusterName:</span> <span class="hljs-string">cluster.local</span><br>    <span class="hljs-attr">autoRenewCerts:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">containerManager:</span> <span class="hljs-string">docker</span><br>  <span class="hljs-attr">etcd:</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">kubekey</span><br>  <span class="hljs-attr">network:</span><br>    <span class="hljs-attr">plugin:</span> <span class="hljs-string">calico</span><br>    <span class="hljs-attr">kubePodsCIDR:</span> <span class="hljs-number">10.233</span><span class="hljs-number">.64</span><span class="hljs-number">.0</span><span class="hljs-string">/18</span><br>    <span class="hljs-attr">kubeServiceCIDR:</span> <span class="hljs-number">10.233</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-string">/18</span><br>    <span class="hljs-comment">## multus support. https://github.com/k8snetworkplumbingwg/multus-cni</span><br>    <span class="hljs-attr">multusCNI:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">storage:</span><br>    <span class="hljs-attr">openebs:</span><br>      <span class="hljs-attr">basePath:</span> <span class="hljs-string">/data/openebs/local</span> <span class="hljs-comment"># é»˜è®¤æ²¡æœ‰çš„æ–°å¢é…ç½®ï¼Œbase path of the local PV provisioner</span><br>  <span class="hljs-attr">registry:</span><br>    <span class="hljs-comment"># å¦‚éœ€ä½¿ç”¨ kk éƒ¨ç½² harbor, å¯å°†è¯¥å‚æ•°è®¾ç½®ä¸º harborï¼Œä¸è®¾ç½®è¯¥å‚æ•°ä¸”éœ€ä½¿ç”¨ kk åˆ›å»ºå®¹å™¨é•œåƒä»“åº“ï¼Œå°†é»˜è®¤ä½¿ç”¨docker registryã€‚</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">harbor</span><br>    <span class="hljs-comment"># å¦‚ä½¿ç”¨ kk éƒ¨ç½²çš„ harbor æˆ–å…¶ä»–éœ€è¦ç™»å½•çš„ä»“åº“ï¼Œå¯è®¾ç½®å¯¹åº”ä»“åº“çš„authsï¼Œå¦‚ä½¿ç”¨ kk åˆ›å»ºçš„ docker registry ä»“åº“ï¼Œåˆ™æ— éœ€é…ç½®è¯¥å‚æ•°ã€‚</span><br>    <span class="hljs-comment"># æ³¨æ„ï¼šå¦‚ä½¿ç”¨ kk éƒ¨ç½² harborï¼Œè¯¥å‚æ•°è¯·äº harbor å¯åŠ¨åè®¾ç½®ã€‚</span><br>    <span class="hljs-comment">#auths:</span><br>    <span class="hljs-comment">#  &quot;registry.syjiang.com&quot;:</span><br>    <span class="hljs-comment">#    username: admin</span><br>    <span class="hljs-comment">#    password: Harbor12345</span><br>    <span class="hljs-comment">#    certsPath: &quot;/etc/docker/certs.d/registry.syjiang.com&quot;</span><br>    <span class="hljs-comment">#    skipTLSVerify: false # å³ä½¿ TLSæ ¡éªŒå¤±è´¥äº†ï¼Œä»å…è®¸é€šè¿‡HTTPSåè®®è¿æ¥registry</span><br>    <span class="hljs-comment">#    plainHTTP: false # å…è®¸é€šè¿‡HTTPåè®®è¿æ¥registry</span><br>    <span class="hljs-comment"># è®¾ç½®é›†ç¾¤éƒ¨ç½²æ—¶ä½¿ç”¨çš„ç§æœ‰ä»“åº“</span><br>    <span class="hljs-attr">privateRegistry:</span> <span class="hljs-string">&quot;registry.syjiang.com&quot;</span><br>    <span class="hljs-attr">namespaceOverride:</span> <span class="hljs-string">&quot;kubesphereio&quot;</span><br>    <span class="hljs-attr">registryMirrors:</span> []<br>    <span class="hljs-attr">insecureRegistries:</span> []<br>  <span class="hljs-attr">addons:</span> []<br><br><br><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">installer.kubesphere.io/v1alpha1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterConfiguration</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">ks-installer</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">kubesphere-system</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">version:</span> <span class="hljs-string">v3.4.1</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">namespace_override:</span> <span class="hljs-string">&quot;kubesphereio&quot;</span><br>  <span class="hljs-attr">persistence:</span><br>    <span class="hljs-attr">storageClass:</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">authentication:</span><br>    <span class="hljs-attr">jwtSecret:</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">local_registry:</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-comment"># dev_tag: &quot;&quot;</span><br>  <span class="hljs-attr">etcd:</span><br>    <span class="hljs-attr">monitoring:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#å°†falseæ”¹ä¸ºtrue</span><br>    <span class="hljs-attr">endpointIps:</span> <span class="hljs-string">localhost</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">2379</span><br>    <span class="hljs-attr">tlsEnable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">common:</span><br>    <span class="hljs-attr">core:</span><br>      <span class="hljs-attr">console:</span><br>        <span class="hljs-attr">enableMultiLogin:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-attr">port:</span> <span class="hljs-number">30880</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">NodePort</span><br>    <span class="hljs-comment"># apiserver:</span><br>    <span class="hljs-comment">#  resources: &#123;&#125;</span><br>    <span class="hljs-comment"># controllerManager:</span><br>    <span class="hljs-comment">#  resources: &#123;&#125;</span><br>    <span class="hljs-attr">redis:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">enableHA:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">volumeSize:</span> <span class="hljs-string">2Gi</span><br>    <span class="hljs-attr">openldap:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">volumeSize:</span> <span class="hljs-string">2Gi</span><br>    <span class="hljs-attr">minio:</span><br>      <span class="hljs-attr">volumeSize:</span> <span class="hljs-string">20Gi</span><br>    <span class="hljs-attr">monitoring:</span><br>      <span class="hljs-comment"># type: external</span><br>      <span class="hljs-attr">endpoint:</span> <span class="hljs-string">http://prometheus-operated.kubesphere-monitoring-system.svc:9090</span><br>      <span class="hljs-attr">GPUMonitoring:</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">gpu:</span><br>      <span class="hljs-attr">kinds:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">resourceName:</span> <span class="hljs-string">&quot;nvidia.com/gpu&quot;</span><br>        <span class="hljs-attr">resourceType:</span> <span class="hljs-string">&quot;GPU&quot;</span><br>        <span class="hljs-attr">default:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">es:</span><br>      <span class="hljs-comment"># master:</span><br>      <span class="hljs-comment">#   volumeSize: 4Gi</span><br>      <span class="hljs-comment">#   replicas: 1</span><br>      <span class="hljs-comment">#   resources: &#123;&#125;</span><br>      <span class="hljs-comment"># data:</span><br>      <span class="hljs-comment">#   volumeSize: 20Gi</span><br>      <span class="hljs-comment">#   replicas: 1</span><br>      <span class="hljs-comment">#   resources: &#123;&#125;</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">logMaxAge:</span> <span class="hljs-number">7</span><br>      <span class="hljs-attr">elkPrefix:</span> <span class="hljs-string">logstash</span><br>      <span class="hljs-attr">basicAuth:</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>        <span class="hljs-attr">username:</span> <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">password:</span> <span class="hljs-string">&quot;&quot;</span><br>      <span class="hljs-attr">externalElasticsearchHost:</span> <span class="hljs-string">&quot;&quot;</span><br>      <span class="hljs-attr">externalElasticsearchPort:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">opensearch:</span><br>      <span class="hljs-comment"># master:</span><br>      <span class="hljs-comment">#   volumeSize: 4Gi</span><br>      <span class="hljs-comment">#   replicas: 1</span><br>      <span class="hljs-comment">#   resources: &#123;&#125;</span><br>      <span class="hljs-comment"># data:</span><br>      <span class="hljs-comment">#   volumeSize: 20Gi</span><br>      <span class="hljs-comment">#   replicas: 1</span><br>      <span class="hljs-comment">#   resources: &#123;&#125;</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">logMaxAge:</span> <span class="hljs-number">7</span><br>      <span class="hljs-attr">opensearchPrefix:</span> <span class="hljs-string">whizard</span><br>      <span class="hljs-attr">basicAuth:</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-attr">username:</span> <span class="hljs-string">&quot;admin&quot;</span><br>        <span class="hljs-attr">password:</span> <span class="hljs-string">&quot;admin&quot;</span><br>      <span class="hljs-attr">externalOpensearchHost:</span> <span class="hljs-string">&quot;&quot;</span><br>      <span class="hljs-attr">externalOpensearchPort:</span> <span class="hljs-string">&quot;&quot;</span><br>      <span class="hljs-attr">dashboard:</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">alerting:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#å°†falseæ”¹ä¸ºtrue</span><br>    <span class="hljs-comment"># thanosruler:</span><br>    <span class="hljs-comment">#   replicas: 1</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>  <span class="hljs-attr">auditing:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#å°†falseæ”¹ä¸ºtrue</span><br>    <span class="hljs-comment"># operator:</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>    <span class="hljs-comment"># webhook:</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>  <span class="hljs-attr">devops:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#å°†falseæ”¹ä¸ºtrue</span><br>    <span class="hljs-attr">jenkinsCpuReq:</span> <span class="hljs-number">0.5</span><br>    <span class="hljs-attr">jenkinsCpuLim:</span> <span class="hljs-number">1</span><br>    <span class="hljs-attr">jenkinsMemoryReq:</span> <span class="hljs-string">4Gi</span><br>    <span class="hljs-attr">jenkinsMemoryLim:</span> <span class="hljs-string">4Gi</span><br>    <span class="hljs-attr">jenkinsVolumeSize:</span> <span class="hljs-string">16Gi</span><br>  <span class="hljs-attr">events:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#å°†falseæ”¹ä¸ºtrue</span><br>    <span class="hljs-comment"># operator:</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>    <span class="hljs-comment"># exporter:</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>    <span class="hljs-attr">ruler:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>  <span class="hljs-attr">logging:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#å°†falseæ”¹ä¸ºtrue</span><br>    <span class="hljs-attr">logsidecar:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span><br>      <span class="hljs-comment"># resources: &#123;&#125;</span><br>  <span class="hljs-attr">metrics_server:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#å°†falseæ”¹ä¸ºtrue</span><br>  <span class="hljs-attr">monitoring:</span><br>    <span class="hljs-attr">storageClass:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">node_exporter:</span><br>      <span class="hljs-attr">port:</span> <span class="hljs-number">9100</span><br>      <span class="hljs-comment"># resources: &#123;&#125;</span><br>    <span class="hljs-comment"># kube_rbac_proxy:</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>    <span class="hljs-comment"># kube_state_metrics:</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>    <span class="hljs-comment"># prometheus:</span><br>    <span class="hljs-comment">#   replicas: 1</span><br>    <span class="hljs-comment">#   volumeSize: 20Gi</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>    <span class="hljs-comment">#   operator:</span><br>    <span class="hljs-comment">#     resources: &#123;&#125;</span><br>    <span class="hljs-comment"># alertmanager:</span><br>    <span class="hljs-comment">#   replicas: 1</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>    <span class="hljs-comment"># notification_manager:</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>    <span class="hljs-comment">#   operator:</span><br>    <span class="hljs-comment">#     resources: &#123;&#125;</span><br>    <span class="hljs-comment">#   proxy:</span><br>    <span class="hljs-comment">#     resources: &#123;&#125;</span><br>    <span class="hljs-attr">gpu:</span><br>      <span class="hljs-attr">nvidia_dcgm_exporter:</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>        <span class="hljs-comment"># resources: &#123;&#125;</span><br>  <span class="hljs-attr">multicluster:</span><br>    <span class="hljs-attr">clusterRole:</span> <span class="hljs-string">none</span><br>  <span class="hljs-attr">network:</span><br>    <span class="hljs-attr">networkpolicy:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#å°†falseæ”¹ä¸ºtrue</span><br>    <span class="hljs-attr">ippool:</span><br>      <span class="hljs-attr">type:</span> <span class="hljs-string">calico</span> <span class="hljs-comment">#å°†noneæ”¹ä¸º calico</span><br>    <span class="hljs-attr">topology:</span><br>      <span class="hljs-attr">type:</span> <span class="hljs-string">weave-scope</span> <span class="hljs-comment">#å°†none æ”¹ä¸º weave-scope</span><br>  <span class="hljs-attr">openpitrix:</span><br>    <span class="hljs-attr">store:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#å°†falseæ”¹ä¸ºtrue</span><br>  <span class="hljs-attr">servicemesh:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#å°†falseæ”¹ä¸ºtrue</span><br>    <span class="hljs-attr">istio:</span><br>      <span class="hljs-attr">components:</span><br>        <span class="hljs-attr">ingressGateways:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">istio-ingressgateway</span><br>          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>        <span class="hljs-attr">cni:</span><br>          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">edgeruntime:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">kubeedge:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">cloudCore:</span><br>        <span class="hljs-attr">cloudHub:</span><br>          <span class="hljs-attr">advertiseAddress:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-attr">service:</span><br>          <span class="hljs-attr">cloudhubNodePort:</span> <span class="hljs-string">&quot;30000&quot;</span><br>          <span class="hljs-attr">cloudhubQuicNodePort:</span> <span class="hljs-string">&quot;30001&quot;</span><br>          <span class="hljs-attr">cloudhubHttpsNodePort:</span> <span class="hljs-string">&quot;30002&quot;</span><br>          <span class="hljs-attr">cloudstreamNodePort:</span> <span class="hljs-string">&quot;30003&quot;</span><br>          <span class="hljs-attr">tunnelNodePort:</span> <span class="hljs-string">&quot;30004&quot;</span><br>        <span class="hljs-comment"># resources: &#123;&#125;</span><br>        <span class="hljs-comment"># hostNetWork: false</span><br>      <span class="hljs-attr">iptables-manager:</span><br>        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-attr">mode:</span> <span class="hljs-string">&quot;external&quot;</span><br>        <span class="hljs-comment"># resources: &#123;&#125;</span><br>      <span class="hljs-comment"># edgeService:</span><br>      <span class="hljs-comment">#   resources: &#123;&#125;</span><br>  <span class="hljs-attr">gatekeeper:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-comment"># controller_manager:</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>    <span class="hljs-comment"># audit:</span><br>    <span class="hljs-comment">#   resources: &#123;&#125;</span><br>  <span class="hljs-attr">terminal:</span><br>    <span class="hljs-attr">timeout:</span> <span class="hljs-number">600</span><br></code></pre></td></tr></table></figure><h2 id="5-5-åˆ›å»ºé…ç½®æ•°æ®ç›®å½•"><a href="#5-5-åˆ›å»ºé…ç½®æ•°æ®ç›®å½•" class="headerlink" title="5.5 åˆ›å»ºé…ç½®æ•°æ®ç›®å½•"></a>5.5 åˆ›å»ºé…ç½®æ•°æ®ç›®å½•</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹éƒ½æ“ä½œ</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»º openebs æœ¬åœ°æ•°æ®æ ¹ç›®å½•</span><br>root@k8s01-1:/# mkdir -p /data/openebs/local<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»º docker æ•°æ®ç›®å½•</span><br>root@k8s01-1:/# mkdir -p /data/docker<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ›å»º dockeræ•°æ®ç›®å½•è½¯è¿æ¥</span><br>root@k8s01-1:/# ln -s /data/docker /var/lib/docker<br></code></pre></td></tr></table></figure><h2 id="5-6-å®‰è£…ä¾èµ–ç»„ä»¶"><a href="#5-6-å®‰è£…ä¾èµ–ç»„ä»¶" class="headerlink" title="5.6 å®‰è£…ä¾èµ–ç»„ä»¶"></a>5.6 å®‰è£…ä¾èµ–ç»„ä»¶</h2><p>ä½¿ç”¨Kubekeyåœ¨çº¿æ–¹å¼éƒ¨ç½²k8s+kspæ—¶ï¼Œéœ€è¦ä½¿ç”¨æ‰§è¡Œâ€.&#x2F;kk cluster xxxâ€ä¹‹å‰å®‰è£…æ“ä½œç³»ç»Ÿä¾èµ–ç»„ä»¶ï¼Œéƒ¨ç½²è¿‡ç¨‹ä¸­æ ¡éªŒå…¶æœªå®‰è£…å°±æŠ¥é”™è€Œä¸­æ–­éƒ¨ç½²ã€‚ä½†ç¦»çº¿éƒ¨ç½²æ—¶ï¼Œé€šè¿‡ç»™kk ä¼ é€’â€œ-a k8sV12317-kspV341-artifact.tar.gzâ€å‚æ•°å¯ä»¥è‡ªåŠ¨å®Œæˆè¿™äº›ä¾èµ–ç»„ä»¶çš„å®‰è£…ã€‚</p><p>æ‰€ä»¥æ­¤å¤„æ— éœ€æ‰‹åŠ¨æ“ä½œã€‚</p><h2 id="5-7ã€å®‰è£…é…ç½®-Harbor"><a href="#5-7ã€å®‰è£…é…ç½®-Harbor" class="headerlink" title="5.7ã€å®‰è£…é…ç½® Harbor"></a>5.7ã€å®‰è£…é…ç½® Harbor</h2><p>é‡‡ç”¨ KubeKey å·¥å…·åœ¨ registry æœåŠ¡å™¨ä¸Šéƒ¨ç½² Harborã€åˆ›å»ºé¡¹ç›®ã€å‘å…¶ä¸­æ¨é€é•œåƒã€‚</p><p>è¯·æ³¨æ„ï¼Œä»¥ä¸‹æ“ä½œæ¶‰åŠåˆ°ä¸¤ä¸ªæœåŠ¡å™¨ï¼ˆ<code>k8s01-1</code>æ˜¯éƒ¨ç½²èŠ‚ç‚¹ï¼Œ<code>registry</code>æ˜¯HarboræœåŠ¡æ‰€åœ¨æœåŠ¡å™¨ï¼‰ä¸”å¯èƒ½ä¼šæ¥å›åˆ‡æ¢ï¼Œè¯·æ ¹æ®å‘½ä»¤å‰çš„ä¸»æœºåè¿›è¡ŒåŒºåˆ†å…·ä½“æ˜¯åœ¨å“ªä¸ªæœåŠ¡å™¨ä¸Šæ‰§è¡Œç›¸å…³å‘½ä»¤ã€‚ä¸Šæ‰§è¡Œã€‚</p><h3 id="5-7-1-å®‰è£…-Harbor"><a href="#5-7-1-å®‰è£…-Harbor" class="headerlink" title="5.7.1 å®‰è£… Harbor"></a>5.7.1 å®‰è£… Harbor</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨éƒ¨ç½²èŠ‚ç‚¹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå®‰è£…é•œåƒä»“åº“ï¼ˆæœ¬æ–‡ä¸­æ˜¯ Harborï¼‰</span><br>root@k8s01-1:/opt/offline-deployk8sksp# ./kk init registry -f k8sV12317-kspV341-offlineconfig.yaml -a k8sV12317-kspV341-artifact.tar.gz<br></code></pre></td></tr></table></figure><p>æ­¤å¤„ä¸€å®šä¸è¦å°†k8s01-1èŠ‚ç‚¹ï¼ˆå…¶ä»–k8sèŠ‚ç‚¹ç¬”è€…æ²¡æœ‰å°è¯•ï¼Œä¸çŸ¥æ˜¯å¦ä¼šæŠ¥ç±»ä¼¼é”™è¯¯ï¼Œå¯èƒ½éœ€è¦æŸ¥çœ‹kkæºç æ‰çŸ¥é“å…·ä½“çš„é€»è¾‘ï¼‰åŒæ—¶ä½œä¸ºHarbor æœåŠ¡æ‰€åœ¨æœåŠ¡å™¨ï¼Œå¦åˆ™å°†æç¤ºæ‰¾ä¸åˆ°â€œ&#x2F;tmp&#x2F;kubekey&#x2F;etc&#x2F;docker&#x2F;certs.d&#x2F;registry.syjiang.com&#x2F;ca.crtâ€è€Œä¸­æ–­æ‰§è¡Œï¼š</p><p><img src="https://s2.loli.net/2025/01/12/9DOjugW2Gxcdsvy.png" alt="image-20250112161653908"></p><p>å¯ä»¥çœ‹åˆ°åœ¨å®‰è£…harborè¿‡ç¨‹ä¸­ä¼šåšå¦‚ä¸‹äº‹æƒ…ï¼š</p><ul><li>ä¸ºæ‰€æœ‰èŠ‚ç‚¹é…ç½®ntpæœåŠ¡å™¨ï¼ˆè¿™ä¸ªntpæœåŠ¡å™¨åœ¨å“ªé‡Œï¼Œè¿˜ä¸ç¡®å®šï¼‰</li><li>æ¨é€ç§æœ‰è¯ä¹¦åˆ°registryæœåŠ¡å™¨</li><li>åœ¨registryæœåŠ¡å™¨ä¸Šå®‰è£…dockerã€å®‰è£…docker-composeã€å¯åŠ¨harbor</li></ul><p><img src="https://s2.loli.net/2025/01/12/jLsZ9bpvfydHUGq.png" alt="image-20250112162718819"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨registryæœåŠ¡å™¨æŸ¥çœ‹ï¼ˆharborçš„å®‰è£…æ–‡ä»¶ä¸é…ç½®æ–‡ä»¶é»˜è®¤è¢«æ”¾ç½®åœ¨ /opt/harbor ç›®å½•ï¼‰</span><br>root@registry:~# ls -lh /opt/harbor/<br>total 633M<br>-rw-r--r-- 1 root root  12K Jul  7  2022 LICENSE<br>drwxr-xr-x 3 root root 4.0K Jan 12 16:26 common<br>-rw-r--r-- 1 root root 3.3K Jul  7  2022 common.sh<br>-rw-r--r-- 1 root root 9.3K Jan 12 16:26 docker-compose.yml<br>-rw-r--r-- 1 root root 633M Jul  7  2022 harbor.v2.5.3.tar.gz<br>-rw-r--r-- 1 root root 3.4K Jan 12 16:25 harbor.yml<br>-rw-r--r-- 1 root root 9.7K Jul  7  2022 harbor.yml.tmpl<br>-rwxr-xr-x 1 root root 2.5K Jul  7  2022 install.sh<br>-rwxr-xr-x 1 root root 1.9K Jul  7  2022 prepare<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹å®¹å™¨åˆ—è¡¨</span><br>root@registry:~# cd /opt/harbor/<br>root@registry:/opt/harbor# docker-compose ps -a<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/12/ZPpxCvWJHVTFGNo.png" alt="image-20250112163452340"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹ /opt/harbor/harbor.yml é…ç½®çš„åŸŸå</span><br>root@registry:/opt/harbor# cat /opt/harbor/harbor.yml | grep hostname:<br>hostname: registry.syjiang.com<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹ Docker æ˜¯å¦é…ç½®äº†ç§æœ‰è¯ä¹¦</span><br>root@registry:/opt/harbor# ll /etc/docker/certs.d<br>total 12<br>drwxr-xr-x 3 root root 4096 Jan 12 16:24 ./<br>drwxr-xr-x 3 root root 4096 Jan 12 16:24 ../<br>drwxrwxr-x 2 root root 4096 Jan 12 16:24 registry.syjiang.com/<br>root@registry:/opt/harbor# ll /etc/docker/certs.d/registry.syjiang.com/<br>total 20<br>drwxrwxr-x 2 root root 4096 Jan 12 16:24 ./<br>drwxr-xr-x 3 root root 4096 Jan 12 16:24 ../<br>-rw-r--r-- 1 root root 1103 Jan 12 16:24 ca.crt<br>-rw-r--r-- 1 root root 1249 Jan 12 16:24 registry.syjiang.com.cert<br>-rw------- 1 root root 1675 Jan 12 16:24 registry.syjiang.com.key<br><span class="hljs-meta prompt_">#</span><span class="language-bash">KubeKey éƒ¨ç½² Harbor æ—¶ï¼Œåœ¨registryæœåŠ¡å™¨ä¸Šå®‰è£…dockerã€docker-composeã€åŒæ­¥ç§æœ‰è¯ä¹¦</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">k8sé›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹æ­¤æ—¶è¿˜ä¸ä¼šå®‰è£…dockerï¼Œä½†ä¼šåˆ›å»º /etc/docker/certs.d ç›®å½•å¹¶åŒæ­¥ç§æœ‰è¯ä¹¦</span><br>root@k8s01-1:/opt/offline-deployk8sksp# ll /etc/docker/certs.d<br>total 12<br>drwxr-xr-x 3 root root 4096 Jan 12 16:24 ./<br>drwxr-xr-x 3 root root 4096 Jan 12 16:24 ../<br>drwxrwxr-x 2 root root 4096 Jan 12 16:24 registry.syjiang.com/<br>root@k8s01-1:/opt/offline-deployk8sksp# ll /etc/docker/certs.d/registry.syjiang.com/<br>total 20<br>drwxrwxr-x 2 root root 4096 Jan 12 16:24 ./<br>drwxr-xr-x 3 root root 4096 Jan 12 16:24 ../<br>-rw-r--r-- 1 root root 1103 Jan 12 16:24 ca.crt<br>-rw-r--r-- 1 root root 1249 Jan 12 16:24 registry.syjiang.com.cert<br>-rw------- 1 root root 1675 Jan 12 16:24 registry.syjiang.com.key<br></code></pre></td></tr></table></figure><h3 id="5-7-2-åœ¨-Harbor-ä¸­åˆ›å»ºé¡¹ç›®"><a href="#5-7-2-åœ¨-Harbor-ä¸­åˆ›å»ºé¡¹ç›®" class="headerlink" title="5.7.2 åœ¨ Harbor ä¸­åˆ›å»ºé¡¹ç›®"></a>5.7.2 åœ¨ Harbor ä¸­åˆ›å»ºé¡¹ç›®</h3><p>ç”±äº <code>Harbor</code>é¡¹ç›®å­˜åœ¨è®¿é—®æ§åˆ¶ï¼ˆ<code>RBAC</code>ï¼‰çš„é™åˆ¶ï¼Œå³åªæœ‰æŒ‡å®šè§’è‰²çš„ç”¨æˆ·æ‰èƒ½æ‰§è¡ŒæŸäº›æ“ä½œã€‚å¦‚æœæœªåˆ›å»ºé¡¹ç›®ï¼Œåˆ™é•œåƒä¸èƒ½è¢«æ¨é€åˆ° Harborã€‚</p><p><code>Harbor </code>ä¸­æœ‰ä¸¤ç§ç±»å‹çš„é¡¹ç›®ï¼š</p><ul><li>å…¬å…±é¡¹ç›®ï¼ˆPublicï¼‰ï¼šä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥ä»è¿™ä¸ªé¡¹ç›®ä¸­æ‹‰å–é•œåƒã€‚</li><li>ç§æœ‰é¡¹ç›®ï¼ˆPrivateï¼‰ï¼šåªæœ‰ä½œä¸ºé¡¹ç›®æˆå‘˜çš„ç”¨æˆ·å¯ä»¥æ‹‰å–é•œåƒã€‚</li></ul><p>ä½¿ç”¨ KubeKey ä½œä¸ºå·¥å…·æ¥éƒ¨ç½²çš„ Harbor é•œåƒä»“åº“çš„ä¸€äº›é»˜è®¤ä¿¡æ¯å¦‚ä¸‹ï¼š</p><ul><li><code>Harbor</code> ç®¡ç†å‘˜è´¦å·ï¼š<strong>admin</strong>ï¼Œå¯†ç ï¼š<strong>Harbor12345</strong>ã€‚</li><li><code>Harbor</code> å®‰è£…ä¸é…ç½®æ–‡ä»¶åœ¨registryæœåŠ¡å™¨çš„ <strong>&#x2F;opt&#x2F;harbor</strong> ç›®å½•,  å¦‚éœ€è¿ç»´ Harborï¼Œå¯è‡³è¯¥ç›®å½•ä¸‹ã€‚</li></ul><p>ç›®å‰æˆ‘ä»¬åªæ˜¯åœ¨<code>registry</code>æœåŠ¡å™¨ä¸Šéƒ¨ç½²äº†<code>Harbor</code>é•œåƒä»“åº“ï¼Œæ­¤æ—¶åªæœ‰ä¸€ä¸ªé»˜è®¤çš„<code>library</code>é¡¹ç›®ï¼Œå…¶ä½™å†…å®¹æ˜¯ç©ºçš„ã€‚è¿˜éœ€è¦è¿›ä¸€æ­¥è¿›è¡Œé…ç½®ä»¥ä½œä¸ºç¦»çº¿éƒ¨ç½²k8s+kspç¯å¢ƒæ—¶ä½¿ç”¨çš„é•œåƒä»“åº“ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä¸‹è½½æŒ‡å®šè„šæœ¬ï¼Œåé¢ç”¨æ¥åˆå§‹åŒ– Harbor ä»“åº“ï¼ˆä½†ä½¿ç”¨æ—¶å‘ç°å…¶ä¸­å°‘äº†ä¸€ä¸ªé¡¹ç›® kubesphereio ï¼‰</span><br>root@registry:/opt/harbor# wget https://raw.githubusercontent.com/kubesphere/ks-installer/master/scripts/create_project_harbor.sh<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">äºæ˜¯ç»“åˆ https://www.kubesphere.io/zh/docs/v3.4/installing-on-linux/introduction/air-gapped-installation/#%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4 æ­¤æ–‡æ¡£ä¸­ç»™å‡ºçš„create_project_harbor.sh ç¤ºä¾‹ï¼Œå°†ä¸¤è€…è¿›è¡Œåˆå¹¶ï¼Œä¿®æ”¹å¾—åˆ°å¦‚ä¸‹ create_project_harbor.sh æ–‡ä»¶</span><br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ç‚¹åŒ…å«å¦‚ä¸‹ï¼š</p><ul><li>ä¿®æ”¹ <strong>url</strong> çš„å€¼ä¸º <strong><a href="https://registry.syjiang.com/">https://registry.syjiang.com</a></strong>ã€‚</li><li>éœ€è¦æŒ‡å®šä»“åº“é¡¹ç›®åç§°åˆ—è¡¨ï¼ŒåŒ…å«é•œåƒåˆ—è¡¨ï¼ˆmanifestæ–‡ä»¶çš„é•œåƒåˆ—è¡¨ï¼‰ä¸­çš„é¡¹ç›®åç§°ã€‚</li><li>è„šæœ¬æœ«å°¾ <code>curl</code> å‘½ä»¤æœ«å°¾åŠ ä¸Š <code>-k</code>ï¼Œè¡¨ç¤ºå…è®¸ä¸ä½¿ç”¨è¯ä¹¦åˆ°SSLç«™ç‚¹ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆå¹¶ä¸ä¿®æ”¹åï¼Œæœ€ç»ˆå¾—åˆ°çš„ create_project_harbor.sh æ–‡ä»¶å†…å®¹å¦‚ä¸‹</span><br>root@registry:/opt/harbor# cat create_project_harbor.sh<br><span class="hljs-meta prompt_">#</span><span class="language-bash">!/usr/bin/env bash</span><br><br>url=&quot;https://registry.syjiang.com&quot;<br>user=&quot;admin&quot;<br>passwd=&quot;Harbor12345&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ­¤å¤„å…¶å®æœ‰ç‚¹å¥‡æ€ªï¼Œåé¢å…¶å®å°†æ‰€æœ‰é•œåƒåªæ¨é€åˆ° kubesphereio è¿™ä¸€ä¸ªé¡¹ç›®ä¸‹ã€‚ä½†æ­¤å¤„åˆåˆ—è¡¨äº†26ä¸ªé¡¹ç›®ï¼Œä¸çŸ¥é“é’äº‘çš„kkå·¥å…·æ˜¯ä¸æ˜¯æœ‰å…¶ä»–è®¾è®¡è¿˜æ²¡æœ‰å®ç°</span><br>harbor_projects=(<br>    library<br>    kubesphereio<br>    kubesphere<br>    argoproj<br>    calico<br>    coredns<br>    openebs<br>    csiplugin<br>    minio<br>    mirrorgooglecontainers<br>    osixia<br>    prom<br>    thanosio<br>    jimmidyson<br>    grafana<br>    elastic<br>    istio<br>    jaegertracing<br>    jenkins<br>    weaveworks<br>    openpitrix<br>    joosthofman<br>    nginxdemos<br>    fluent<br>    kubeedge<br>    openpolicyagent<br>)<br><br>for project in &quot;$&#123;harbor_projects[@]&#125;&quot;; do<br>    echo &quot;creating $project&quot;<br>    curl -u &quot;$&#123;user&#125;:$&#123;passwd&#125;&quot; -X POST -H &quot;Content-Type: application/json&quot; &quot;$&#123;url&#125;/api/v2.0/projects&quot; -d &quot;&#123; \&quot;project_name\&quot;: \&quot;$&#123;project&#125;\&quot;, \&quot;public\&quot;: true&#125;&quot; -k<br>done<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰§è¡Œcreate_project_harbor.shåˆ›å»ºé¡¹ç›®</span><br>root@registry:/opt/harbor# bash create_project_harbor.sh<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æç¤ºâ€œThe project named library already existsâ€å¯ä»¥å¿½ç•¥ï¼Œå› ä¸ºä½¿ç”¨kkéƒ¨ç½²çš„Harborä¸­ä¼šåˆ›å»ºä¸€ä¸ªé»˜è®¤çš„é¡¹ç›®library</span><br></code></pre></td></tr></table></figure><h3 id="5-7-3-å†æ¬¡ä¿®æ”¹é›†ç¾¤é…ç½®æ–‡ä»¶"><a href="#5-7-3-å†æ¬¡ä¿®æ”¹é›†ç¾¤é…ç½®æ–‡ä»¶" class="headerlink" title="5.7.3 å†æ¬¡ä¿®æ”¹é›†ç¾¤é…ç½®æ–‡ä»¶"></a>5.7.3 å†æ¬¡ä¿®æ”¹é›†ç¾¤é…ç½®æ–‡ä»¶</h3><p>æ­£å¦‚å®˜æ–¹ç¦»çº¿éƒ¨ç½²æ–‡æ¡£ä¸­æ‰€è¿°ï¼Œä½¿ç”¨kkéƒ¨ç½²harborå‰éœ€è¦å‰å°†<code>auths</code>éƒ¨åˆ†æ³¨é‡Šæ‰ï¼Œéƒ¨ç½²åå¯ç”¨å¹¶é…ç½®å¥½æ­£ç¡®çš„å€¼ã€‚å…¶ä½™å†…å®¹ä¸å˜ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿®æ”¹k8sV12317-kspV341-offlineconfig.yaml æ–‡ä»¶</span><br>root@k8s01-1:/opt/offline-deployk8sksp# vi k8sV12317-kspV341-offlineconfig.yaml<br>...<br>  registry:<br>    # å¦‚éœ€ä½¿ç”¨ kk éƒ¨ç½² harbor, å¯å°†è¯¥å‚æ•°è®¾ç½®ä¸º harborï¼Œä¸è®¾ç½®è¯¥å‚æ•°ä¸”éœ€ä½¿ç”¨ kk åˆ›å»ºå®¹å™¨é•œåƒä»“åº“ï¼Œå°†é»˜è®¤ä½¿ç”¨docker registryã€‚<br>    type: harbor<br>    # å¦‚ä½¿ç”¨ kk éƒ¨ç½²çš„ harbor æˆ–å…¶ä»–éœ€è¦ç™»å½•çš„ä»“åº“ï¼Œå¯è®¾ç½®å¯¹åº”ä»“åº“çš„authsï¼Œå¦‚ä½¿ç”¨ kk åˆ›å»ºçš„ docker registry ä»“åº“ï¼Œåˆ™æ— éœ€é…ç½®è¯¥å‚æ•°ã€‚<br>    # æ³¨æ„ï¼šå¦‚ä½¿ç”¨ kk éƒ¨ç½² harborï¼Œè¯¥å‚æ•°è¯·äº harbor å¯åŠ¨åè®¾ç½®ã€‚<br>    auths:<br>      &quot;registry.syjiang.com&quot;:<br>        username: admin<br>        password: Harbor12345<br>        certsPath: &quot;/etc/docker/certs.d/registry.syjiang.com&quot;<br>        skipTLSVerify: false # å³ä½¿ TLSæ ¡éªŒå¤±è´¥äº†ï¼Œä»å…è®¸é€šè¿‡HTTPSåè®®è¿æ¥registry<br>        plainHTTP: false # å…è®¸é€šè¿‡HTTPåè®®è¿æ¥registry<br>    # è®¾ç½®é›†ç¾¤éƒ¨ç½²æ—¶ä½¿ç”¨çš„ç§æœ‰ä»“åº“<br>    privateRegistry: &quot;registry.syjiang.com&quot;<br>    namespaceOverride: &quot;kubesphereio&quot;<br>    registryMirrors: []<br>    insecureRegistries: []<br>...<br></code></pre></td></tr></table></figure><p>ç›¸å…³å‚æ•°çš„è§£é‡Šå¦‚ä¸‹ï¼š</p><ul><li>æ–°å¢ <strong>auths</strong> é…ç½®å¢åŠ  <strong>registry.syjiang.com</strong> å’Œè´¦å·å¯†ç ã€‚</li><li><strong>certsPath</strong> é…ç½®dockerè¿æ¥ harbor æ—¶ç§æœ‰è¯ä¹¦çš„å­˜æ”¾ç›®å½•ã€‚</li><li>**skipTLSVerify **é…ç½®æˆfalseï¼Œå³ä½¿ TLS æ ¡éªŒå¤±è´¥äº†ï¼Œä»å…è®¸é€šè¿‡HTTPSåè®®è¿æ¥registryã€‚</li><li>**plainHTTP **é…ç½®æˆfalseï¼Œå…è®¸é€šè¿‡HTTPåè®®è¿æ¥registryã€‚</li><li><strong>privateRegistry</strong> ç¡®è®¤æ˜¯é…ç½®æˆ <strong>registry.syjiang.com</strong>ã€‚</li><li><strong>namespaceOverride</strong> ç¡®è®¤æ˜¯é…ç½®æˆ <strong><code>kubesphereio</code></strong>ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯K8Sæœ¬èº«ä½¿ç”¨åˆ°çš„é•œåƒåªåˆ°**<code>registry.syjiang.com/kubesphereio</code><strong>ä¸‹é¢å»æ‹‰å–ï¼Œå¦‚æœä¸é…ç½®çš„è¯æœ‰äº›é•œåƒæ˜¯ä¼šåˆ°å¦å¤–çš„é¡¹ç›®ä¸‹æ‹‰å–çš„æ¯”å¦‚<code>kube-system</code>ç©ºé—´ä¸­<code>pod/snapshot-controller-0</code>ç”¨åˆ°çš„é•œåƒå°±æ˜¯</strong><code>registry.syjiang.com/csiplugin/snapshot-controller:v4.0.0</code>**ã€‚</li></ul><h3 id="5-7-4-æå‰æ¨é€é•œåƒåˆ°-Harbor-ä»“åº“"><a href="#5-7-4-æå‰æ¨é€é•œåƒåˆ°-Harbor-ä»“åº“" class="headerlink" title="5.7.4 æå‰æ¨é€é•œåƒåˆ° Harbor ä»“åº“"></a>5.7.4 æå‰æ¨é€é•œåƒåˆ° Harbor ä»“åº“</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ¨é€é•œåƒåˆ° Harbor ä»“åº“ï¼ˆå…¨éƒ¨ä¼šæ¨é€åˆ°kubesphereio é¡¹ç›®ä¸‹ï¼‰</span><br>root@k8s01-1:/opt/offline-deployk8sksp# ./kk artifact image push -f k8sV12317-kspV341-offlineconfig.yaml -a k8sV12317-kspV341-artifact.tar.gz<br></code></pre></td></tr></table></figure><h3 id="5-7-5-æŸ¥çœ‹Harboré•œåƒä»“åº“"><a href="#5-7-5-æŸ¥çœ‹Harboré•œåƒä»“åº“" class="headerlink" title="5.7.5 æŸ¥çœ‹Harboré•œåƒä»“åº“"></a>5.7.5 æŸ¥çœ‹Harboré•œåƒä»“åº“</h3><p>è®¿é—®harboré•œåƒä»“åº“çš„webç®¡ç†ç•Œé¢ï¼Œ<code>url</code>æ˜¯<a href="https://10.13.15.71ï¼Œé»˜è®¤çš„ç”¨æˆ·åä¸å¯†ç åˆ†åˆ«æ˜¯ï¼šadminã€">https://10.13.15.71ï¼Œé»˜è®¤çš„ç”¨æˆ·åä¸å¯†ç åˆ†åˆ«æ˜¯ï¼šadminã€</a> Harbor12345</p><p>å¯ä»¥çœ‹åˆ°å¦‚ä¸‹26ä¸ªé¡¹ç›®ï¼Œæ‰€æœ‰é•œåƒéƒ½åœ¨ kubesphereio é¡¹ç›®ä¸‹ï¼Œä¸€å…±æœ‰121ä¸ªä¸åŒåç§°é•œåƒï¼ˆæ ‡ç­¾ä¸åŒå¦ç®—ï¼‰ </p><p><img src="https://s2.loli.net/2025/01/12/FYCbxXzr1iyqW2P.png" alt="image-20250112203033095"></p><h1 id="å…­ã€å®‰è£…-KubeSphere-å’Œ-K8s-é›†ç¾¤"><a href="#å…­ã€å®‰è£…-KubeSphere-å’Œ-K8s-é›†ç¾¤" class="headerlink" title="å…­ã€å®‰è£… KubeSphere å’Œ K8s é›†ç¾¤"></a>å…­ã€å®‰è£… KubeSphere å’Œ K8s é›†ç¾¤</h1><h2 id="6-1-å®‰è£…-K8S-ä¸-KSP"><a href="#6-1-å®‰è£…-K8S-ä¸-KSP" class="headerlink" title="6.1 å®‰è£… K8S ä¸ KSP"></a>6.1 å®‰è£… K8S ä¸ KSP</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœé‡å¤éƒ¨ç½²ï¼Œ/data/openebs/local ç›®å½•éç©ºï¼Œè¯·å°†æ­¤ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶æ¸…ç©ºï¼Œå¦åˆ™å®‰è£…å¯èƒ½å¤±è´¥ã€æç¤ºå¦‚ä¸‹</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">TASK [common : debug] **********************************************************</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ok: [localhost] =&gt; &#123;</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   <span class="hljs-string">&quot;msg&quot;</span>: [</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">       <span class="hljs-string">&quot;1. check the storage configuration and storage server&quot;</span>,</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">       <span class="hljs-string">&quot;2. make sure the DNS address in /etc/resolv.conf is available&quot;</span>,</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">       <span class="hljs-string">&quot;3. execute &#x27;kubectl logs -n kubesphere-system -l job-name=minio-make-bucket-job&#x27; to watch logs&quot;</span>,</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">       <span class="hljs-string">&quot;4. execute &#x27;helm -n kubesphere-system uninstall ks-minio &amp;&amp; kubectl -n kubesphere-system delete job minio-make-bucket-job&#x27;&quot;</span>,</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">       <span class="hljs-string">&quot;5. Restart the installer pod in kubesphere-system namespace&quot;</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">   ]</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">&#125;</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå®‰è£… KubeSphere å’Œ K8s é›†ç¾¤</span><br>root@k8s01-1:/opt/offline-deployk8sksp# ./kk create cluster -f k8sV12317-kspV341-offlineconfig.yaml -a k8sV12317-kspV341-artifact.tar.gz --with-packages --skip-push-images<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦å¤–æ‰“å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹é›†ç¾¤éƒ¨ç½²çŠ¶æ€ï¼š</span><br>root@k8s01-1:~# kubectl logs -n kubesphere-system $(kubectl get pod -n kubesphere-system -l &#x27;app in (ks-install, ks-installer)&#x27; -o jsonpath=&#x27;&#123;.items[0].metadata.name&#125;&#x27;) -f<br></code></pre></td></tr></table></figure><p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p><ul><li><strong>k8sV12317-kspV341-offlineconfig.yaml</strong>ï¼šç¦»çº¿ç¯å¢ƒé›†ç¾¤çš„é…ç½®æ–‡ä»¶</li><li><strong>k8sV12317-kspV341-artifact.tar.gz</strong>ï¼šæºé›†ç¾¤æ‰“åŒ…å‡ºæ¥çš„ tar åŒ…é•œåƒ</li><li><strong>â€“with-packages</strong>ï¼šè¡¨ç¤ºå®‰è£…å®‰è£…æ“ä½œç³»ç»Ÿä¾èµ–ç»„ä»¶</li><li><strong>â€“skip-push-imagesï¼š</strong> è¡¨ç¤ºè·³è¿‡æ¨é€é•œåƒçš„æ“ä½œï¼ˆå› ä¸ºå‰æ–‡å·²ç»æ“ä½œè¿‡äº†ï¼‰</li></ul><p>å®‰è£…æˆåŠŸå®Œæˆåï¼Œä¼šè¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼š</p><p><img src="https://s2.loli.net/2025/01/13/TWuogpE9vHMLIhD.png" alt="image-20250113095155884"></p><h2 id="6-2-é…ç½®æ—¶é—´åŒæ­¥æœåŠ¡"><a href="#6-2-é…ç½®æ—¶é—´åŒæ­¥æœåŠ¡" class="headerlink" title="6.2 é…ç½®æ—¶é—´åŒæ­¥æœåŠ¡"></a>6.2 é…ç½®æ—¶é—´åŒæ­¥æœåŠ¡</h2><p>é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹éƒ½è¦æ“ä½œã€‚åœ¨æ­£å¼éƒ¨ç½²k8s+kspé›†ç¾¤è¿‡ç¨‹ä¸­ï¼Œä¼šåœ¨é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹ä¸Šå®‰è£…chronyæœåŠ¡å¹¶å¯åŠ¨ä¸å¼€æœºè‡ªå¯åŠ¨ï¼Œä½†ä½¿ç”¨çš„é»˜è®¤æ—¶é—´åŒæ­¥æœåŠ¡å™¨éœ€è¦è”ç½‘æ‰èƒ½è®¿é—®ï¼Œç¦»çº¿ç¯å¢ƒè‚¯å®šè®¿é—®ä¸äº†è¿™äº›æ—¶é—´åŒæ­¥æœåŠ¡å™¨ã€‚æ•…éœ€è¦ä½¿ç”¨è‡ªå·±æœ¬åœ°çš„æ—¶é—´åŒæ­¥æœåŠ¡å™¨ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">1.æŸ¥çœ‹èŠ‚ç‚¹chronyæœåŠ¡çŠ¶æ€</span><br>root@k8s01-1:~# systemctl status chrony<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶å¿…é¡»è¦æœ‰è‡ªå·±çš„æœ¬åœ°éƒ¨ç½²çš„ NTPæ—¶é—´åŒæ­¥æœåŠ¡å™¨ï¼Œè‡ªå·±æƒ³åŠæ³•æ­å»ºï¼ˆå¯ä»¥æ˜¯k8sé›†ç¾¤ä¸­ä»»æ„èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–æœåŠ¡å™¨ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">2.ä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/chrony/chrony.confï¼Œä¿®æ”¹ ntp æœåŠ¡é…ç½®</span><br>vi /etc/chrony/chrony.conf<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å°†å¦‚ä¸‹è®¤çš„ pool é…ç½®åˆ é™¤ï¼ˆç¦»çº¿ç¯å¢ƒä¸­ä¹Ÿç”¨ä¸ä¸Šï¼‰</span><br>pool ntp.ubuntu.com        iburst maxsources 4<br>pool 0.ubuntu.pool.ntp.org iburst maxsources 1<br>pool 1.ubuntu.pool.ntp.org iburst maxsources 1<br>pool 2.ubuntu.pool.ntp.org iburst maxsources 2<br><span class="hljs-meta prompt_"># </span><span class="language-bash">ç„¶åé…ç½®è‡ªå·±æœ¬åœ°çš„NTPæœåŠ¡å™¨ï¼ˆæœ€å¥½æ˜¯ä¸€å°å¯ä»¥è®¿é—®å¤–ç½‘çš„æœåŠ¡å™¨ï¼Œè¿™æ ·å®ƒå¯ä»¥è·Ÿä¸–ç•ŒèŒƒå›´å†…çš„NTPæœåŠ¡å™¨åŒæ­¥æ—¶é—´ï¼‰ï¼ŒNTPæœåŠ¡å™¨æ­¥éª¤æ­¤æ–‡æœªæ¶‰åŠ</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å‡å¦‚10.13.15.20æ˜¯æœ¬åœ°NTPæœåŠ¡å™¨ï¼Œåˆ™æ·»åŠ å¦‚ä¸‹é…ç½®ï¼ˆå¦‚æœæ²¡æœ‰è‡ªå·±æœ¬åœ°çš„æ—¶é—´åŒæ­¥æœåŠ¡å™¨ï¼Œæœ€åæ‰€æœ‰èŠ‚ç‚¹æ˜¯æ²¡æœ‰åšä¸¥æ ¼æ—¶é—´åŒæ­¥çš„ï¼‰</span><br>server 10.13.15.20 iburst<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">3.é‡å¯ chrony æœåŠ¡ï¼š</span><br>systemctl restart chrony<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">4.éªŒè¯ chrony åŒæ­¥çŠ¶æ€ï¼š</span><br>chronyc sourcestats -v<br></code></pre></td></tr></table></figure><h2 id="6-3-é—®é¢˜"><a href="#6-3-é—®é¢˜" class="headerlink" title="6.3   é—®é¢˜"></a>6.3   é—®é¢˜</h2><h3 id="6-3-1-Task-â€˜monitoringâ€™-æ‰§è¡Œå¤±è´¥"><a href="#6-3-1-Task-â€˜monitoringâ€™-æ‰§è¡Œå¤±è´¥" class="headerlink" title="6.3.1 Task â€˜monitoringâ€™ æ‰§è¡Œå¤±è´¥"></a>6.3.1 Task â€˜monitoringâ€™ æ‰§è¡Œå¤±è´¥</h3><p>éƒ¨ç½²è¿‡ç¨‹ä¸­æ­¤ä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œä½†ä¸å½±å“éƒ¨ç½²ä¸»çº¿è¿‡ç¨‹æˆåŠŸå®Œæˆï¼Œæ‰€ä»¥ä»æç¤ºéƒ¨ç½²æˆåŠŸå®Œæˆã€‚åªéœ€è¦åœ¨éƒ¨ç½²å®Œæˆåå†å¤„ç†ä¸‹æ­¤ä»»åŠ¡ç›¸å…³èµ„æºå¯¹è±¡å³å¯</p><p><img src="https://s2.loli.net/2025/01/13/N5K6mEL3iOxDCJT.png" alt="image-20250113095337670"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å…·ä½“æŠ¥é”™æ–‡å­—å½¢å¼æè¿°å¦‚ä¸‹</span>  <br>  &quot;stdout&quot;: &quot;fatal: [localhost]: FAILED! =&gt; &#123;\&quot;attempts\&quot;: 3, \&quot;changed\&quot;: true, \&quot;cmd\&quot;: \&quot;/usr/local/bin/helm upgrade --install notification-manager /kubesphere/kubesphere/notification-manager -f /kubesphere/kubesphere/notification-manager/custom-values-notification.yaml -n kubesphere-monitoring-system --force\\n\&quot;, \&quot;delta\&quot;: \&quot;0:05:06.023787\&quot;, \&quot;end\&quot;: \&quot;2025-01-12 23:08:54.785785\&quot;, \&quot;msg\&quot;: \&quot;non-zero return code\&quot;, \&quot;rc\&quot;: 1, \&quot;start\&quot;: \&quot;2025-01-12 23:03:48.761998\&quot;, \&quot;stderr\&quot;: \&quot;Error: UPGRADE FAILED: post-upgrade hooks failed: timed out waiting for the condition\&quot;, \&quot;stderr_lines\&quot;: [\&quot;Error: UPGRADE FAILED: post-upgrade hooks failed: timed out waiting for the condition\&quot;], \&quot;stdout\&quot;: \&quot;\&quot;, \&quot;stdout_lines\&quot;: []&#125;&quot;,<br>  &quot;uuid&quot;: &quot;4af3661f-0690-49dd-befe-2b1bdf6d1974&quot;<br></code></pre></td></tr></table></figure><p><strong>è§£å†³åŠæ³•ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å½“å‰ç°çŠ¶</span><br>root@k8s01-1:~# kubectl -n kubesphere-logging-system get pods<br>...<br>opensearch-cluster-data-0                                      0/1     Init:ImagePullBackOff   0          11h<br>opensearch-cluster-data-1                                      0/1     Init:ImagePullBackOff   0          11h<br>opensearch-cluster-master-0                                    0/1     Init:ImagePullBackOff   0          11h<br>opensearch-logging-curator-opensearch-curator-28945020-725qp   0/1     Error                   0          8h<br>opensearch-logging-curator-opensearch-curator-28945020-9rprk   0/1     Error                   0          8h<br>opensearch-logging-curator-opensearch-curator-28945020-h2rpk   0/1     Error                   0          8h<br>opensearch-logging-curator-opensearch-curator-28945020-kpm45   0/1     Error                   0          8h<br>opensearch-logging-curator-opensearch-curator-28945020-p2dl9   0/1     Error                   0          8h<br>opensearch-logging-curator-opensearch-curator-28945020-q82qn   0/1     Error                   0          8h<br>opensearch-logging-curator-opensearch-curator-28945020-xkczm   0/1     Error                   0          8h<br><br>root@k8s01-1:~# kubectl -n kubesphere-logging-system describe pod opensearch-cluster-master-0<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å‘ç°æ­¤podä¸­å°è¯•æ‹‰å–ä¸ä½¿ç”¨é•œåƒ busybox:latest ï¼Œç«Ÿç„¶æ˜¯å°è¯•å»docker.io ä¸­æ‹‰å–é•œåƒ</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿®æ”¹æ­¤pod/opensearch-cluster-master-0ä¸­ä½¿ç”¨çš„é•œåƒä¸º registry.syjiang.com/kubesphereio/busybox:1.31.1</span><br>root@k8s01-1:~# kubectl -n kubesphere-logging-system edit pod opensearch-cluster-master-0<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç„¶åä½¿ç”¨åŒæ ·çš„æ–¹æ³•ä¿®æ”¹ pod/opensearch-cluster-data-x ä¸­ä½¿ç”¨çš„busybox:latesté•œåƒä¸º registry.syjiang.com/kubesphereio/busybox:1.31.1</span><br>root@k8s01-1:~# kubectl -n kubesphere-logging-system edit pod opensearch-cluster-data-xxx<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç„¶åå¯ä»¥çœ‹åˆ°pod/opensearch-cluster-masterä¸pod/opensearch-cluster-data éƒ½å˜æˆæ­£å¸¸è¿è¡ŒçŠ¶æ€</span><br>root@k8s01-1:~# kubectl -n kubesphere-logging-system get pods<br>NAME                                                           READY   STATUS    RESTARTS   AGE<br>...<br>opensearch-cluster-data-0                                      1/1     Running   0          11h<br>opensearch-cluster-data-1                                      1/1     Running   0          11h<br>opensearch-cluster-master-0                                    1/1     Running   0          11h<br>opensearch-logging-curator-opensearch-curator-28945020-725qp   0/1     Error     0          8h<br>opensearch-logging-curator-opensearch-curator-28945020-9rprk   0/1     Error     0          8h<br>opensearch-logging-curator-opensearch-curator-28945020-h2rpk   0/1     Error     0          9h<br>opensearch-logging-curator-opensearch-curator-28945020-kpm45   0/1     Error     0          9h<br>opensearch-logging-curator-opensearch-curator-28945020-p2dl9   0/1     Error     0          9h<br>opensearch-logging-curator-opensearch-curator-28945020-q82qn   0/1     Error     0          8h<br>opensearch-logging-curator-opensearch-curator-28945020-xkczm   0/1     Error     0          9h<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#####################################################################</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#é™„å¸¦é—®é¢˜1ï¼špod/opensearch-logging-curator-opensearch-curator ä»ç„¶æ˜¯ Error çŠ¶æ€</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#####################################################################</span></span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/13/dJ8rIeTRNDsG5ph.png" alt="image-20250113100910415"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹å…¶ä¸­ä¸€ä¸ªpod/opensearch-logging-curator-opensearch-curator-28945020-725qp</span><br>root@k8s01-1:~# kubectl -n kubesphere-logging-system describe pod opensearch-logging-curator-opensearch-curator-28945020-725qp<br>...<br>Controlled By:  Job/opensearch-logging-curator-opensearch-curator-28945020<br>...<br><span class="hljs-meta prompt_">#</span><span class="language-bash">è¿‡å»äº†8ä¸ªå°æ—¶ï¼Œæ­¤æ—¶äº‹ä»¶å·²ç»ä¸ºNone</span><br>...<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å‘ç°ä¸Šè¿°pod/opensearch-logging-curator-opensearch-curator-28945020-725qpç”±Job/opensearch-logging-curator-opensearch-curator-28945020 æ§åˆ¶</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">äºæ˜¯æŸ¥çœ‹ Job/opensearch-logging-curator-opensearch-curator-28945020</span><br>root@k8s01-1:~# kubectl -n kubesphere-logging-system describe job opensearch-logging-curator-opensearch-curator-28945020<br>Name:             opensearch-logging-curator-opensearch-curator-28945020<br>Namespace:        kubesphere-logging-system<br>Selector:         controller-uid=d759cadd-c7d9-46aa-9e1a-a2dada8a8597<br>Labels:           app=opensearch-curator<br>                  release=opensearch-logging-curator<br>Annotations:      revisions:<br>                    &#123;&quot;1&quot;:&#123;&quot;status&quot;:&quot;failed&quot;,&quot;reasons&quot;:[&quot;BackoffLimitExceeded&quot;],&quot;messages&quot;:[&quot;Job has reached the specified backoff limit&quot;],&quot;desire&quot;:1,&quot;failed&quot;:...<br>Controlled By:    CronJob/opensearch-logging-curator-opensearch-curator<br>...<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹CronJob/opensearch-logging-curator-opensearch-curator</span><br>root@k8s01-1:~# kubectl -n kubesphere-logging-system describe cronjobs.batch opensearch-logging-curator-opensearch-curator <br>Name:                          opensearch-logging-curator-opensearch-curator<br>Namespace:                     kubesphere-logging-system<br>Labels:                        app=opensearch-curator<br>                               app.kubernetes.io/managed-by=Helm<br>                               chart=opensearch-curator-0.0.5<br>                               heritage=Helm<br>                               release=opensearch-logging-curator<br>Annotations:                   meta.helm.sh/release-name: opensearch-logging-curator<br>                               meta.helm.sh/release-namespace: kubesphere-logging-system<br>Schedule:                      0 1 * * *<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç”±ä¸Šå¯çŸ¥ï¼Œä¸Šè¿°å¤±è´¥7ä¸ªpodç”±Job/opensearch-logging-curator-opensearch-curator-28945020 æ§åˆ¶ï¼Œè€ŒJob/opensearch-logging-curator-opensearch-curator-28945020 ç”± CronJob/opensearch-logging-curator-opensearch-curator æ§åˆ¶ã€‚å®ƒæ¯1ä¸ªå°æ—¶æ‰§è¡Œä¸€æ¬¡</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰€ä»¥æš‚æ—¶å¯ä»¥ä¸ç”¨ç†ä¼šä¸Šè¿°æŠ¥é”™çš„7ä¸ªpodï¼Œå¦‚æœæƒ³è¿…é€Ÿçœ‹åˆ°æˆåŠŸçš„è®°å½•ï¼Œå¯ä»¥å» kubesphereçš„webç®¡ç†ç•Œé¢é‡æ–°æ‰§è¡Œä¸Šè¿°job</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2025/01/13/tbTjiM39XGsBowg.png" alt="image-20250113104345346"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å¯ä»¥çœ‹åˆ°æ–°åˆ›å»ºçš„ pod/opensearch-logging-curator-opensearch-curator-28945020-7r6ql æ˜¯CompletedçŠ¶æ€ï¼Œè¡¨ç¤ºæ­£å¸¸å®Œæˆ</span><br>root@k8s01-1:~# kubectl -n kubesphere-logging-system get pods<br>NAME                                                           READY   STATUS      RESTARTS   AGE<br>...<br>opensearch-logging-curator-opensearch-curator-28945020-725qp   0/1     Error       0          9h<br>opensearch-logging-curator-opensearch-curator-28945020-7r6ql   0/1     Completed   0          24s<br>opensearch-logging-curator-opensearch-curator-28945020-9rprk   0/1     Error       0          9h<br>opensearch-logging-curator-opensearch-curator-28945020-h2rpk   0/1     Error       0          9h<br>opensearch-logging-curator-opensearch-curator-28945020-kpm45   0/1     Error       0          9h<br>opensearch-logging-curator-opensearch-curator-28945020-p2dl9   0/1     Error       0          9h<br>opensearch-logging-curator-opensearch-curator-28945020-q82qn   0/1     Error       0          9h<br>opensearch-logging-curator-opensearch-curator-28945020-xkczm   0/1     Error       0          9h<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹å…¶æ—¥å¿—</span><br>root@k8s01-1:~# kubectl -n kubesphere-logging-system logs opensearch-logging-curator-opensearch-curator-28945020-7r6ql<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å…¶ä»–7ä¸ªå¤„äºError çŠ¶æ€çš„pod/opensearch-logging-curator-opensearch-curator-28945020-xxx æ˜¯ç”±jobä¸æ–­åˆ›å»ºæ–°podç›´åˆ°è¾¾åˆ°å°è¯•ä¸Šé™7è€Œç”Ÿæˆï¼ˆspec.backoffLimité»˜è®¤ä¸º6ï¼Œå³é‡è¯•6æ¬¡ï¼Œå…±7ä¸ªpodï¼‰podéƒ½å¤±è´¥åï¼Œè®¤ä¸ºjobå¤±è´¥</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ­¤æ—¶å¯ä»¥åˆ é™¤ä¸Šè¿°å¤„äºError çŠ¶æ€çš„pod/opensearch-logging-curator-opensearch-curator-28945020-xxxï¼Œä¹Ÿå¯ä»¥ä¸ç†ä¼š</span><br>root@k8s01-1:~# kubectl -n kubesphere-logging-system get pod | grep opensearch-logging-curator-opensearch-curator-28945020 | grep -v &quot;opensearch-logging-curator-opensearch-curator-28945020-7r6ql&quot; | awk &#x27;&#123;print $1&#125;&#x27; | xargs kubectl -n kubesphere-logging-system delete pod<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#####################################################################</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#é™„å¸¦é—®é¢˜2ï¼šistio-systemç©ºé—´ä¸­pod/jaeger-es-index-cleaner-xxx ä»ç„¶æ˜¯ Error çŠ¶æ€</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#####################################################################</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash">root@k8s01-1:~# kubectl -n istio-system get pods</span><br>NAME                                     READY   STATUS    RESTARTS        AGE<br>istiod-1-14-6-775dfd88cd-jhc69           1/1     Running   0               12h<br>jaeger-collector-b4555bcd4-s9b9w         1/1     Running   139 (60m ago)   12h<br>jaeger-es-index-cleaner-28944955-52ggg   0/1     Error     0               11h<br>jaeger-es-index-cleaner-28944955-5fdln   0/1     Error     0               11h<br>jaeger-es-index-cleaner-28944955-6crz4   0/1     Error     0               10h<br>jaeger-es-index-cleaner-28944955-7hkwt   0/1     Error     0               11h<br>jaeger-es-index-cleaner-28944955-brdhh   0/1     Error     0               10h<br>jaeger-es-index-cleaner-28944955-dmrtx   0/1     Error     0               10h<br>jaeger-es-index-cleaner-28944955-mzx44   0/1     Error     0               11h<br>...<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">é€šè¿‡æŸ¥çœ‹pod/jaeger-es-index-cleaner-28944955-52ggg æ—¥å¿—ï¼Œå‘ç°å…¶ä¹Ÿæ˜¯å› ä¸ºä¸èƒ½æ­£å¸¸ä½¿ç”¨ ns/kubesphere-logging-system ä¸‹opensearch-cluster-data ç›¸å…³svcä¸podæä¾›çš„æœåŠ¡è€Œé€ æˆç›¸å…³jobæ‰§è¡Œå¤±è´¥</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ‰€ä»¥åŒæ ·ä¹Ÿå¯ä»¥å»kubesphereçš„webç•Œé¢é‡æ–°æ‰§è¡Œ job/jaeger-es-index-cleaner-28944955 å³å¯</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç„¶åå°†åˆ›å»ºä¸€ä¸ªæ–°çš„pod/jaeger-es-index-cleaner-28944955-tznkj å¹¶æ˜¯å¤„äºCompleted çŠ¶æ€</span><br>root@k8s01-1:~# kubectl -n istio-system get pods<br>NAME                                     READY   STATUS      RESTARTS        AGE<br>istiod-1-14-6-775dfd88cd-jhc69           1/1     Running     0               12h<br>jaeger-collector-b4555bcd4-s9b9w         1/1     Running     139 (62m ago)   12h<br>jaeger-es-index-cleaner-28944955-52ggg   0/1     Error       0               11h<br>jaeger-es-index-cleaner-28944955-5fdln   0/1     Error       0               11h<br>jaeger-es-index-cleaner-28944955-6crz4   0/1     Error       0               11h<br>jaeger-es-index-cleaner-28944955-7hkwt   0/1     Error       0               11h<br>jaeger-es-index-cleaner-28944955-brdhh   0/1     Error       0               10h<br>jaeger-es-index-cleaner-28944955-dmrtx   0/1     Error       0               10h<br>jaeger-es-index-cleaner-28944955-mzx44   0/1     Error       0               11h<br>jaeger-es-index-cleaner-28944955-tznkj   0/1     Completed   0               9s<br>jaeger-operator-846bc67879-hwc7r         1/1     Running     0               12h<br>jaeger-query-579b5c5f7c-hhwk8            2/2     Running     137 (59m ago)   12h<br>kiali-6cd665f559-2g8mx                   1/1     Running     0               12h<br>kiali-operator-745866d585-xvfwh          1/1     Running     0               12h<br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ é™¤å…ˆå‰é—ç•™ä¸‹æ¥çš„åƒåœ¾pod(å¯é€‰)</span><br>root@k8s01-1:~# kubectl -n istio-system get pods  | grep Error | awk &#x27;&#123;print $1&#125;&#x27; | xargs kubectl -n istio-system delete pod<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ°ç›®å‰ä¸ºæ­¢ ï¼Œé›†ç¾¤ä¸­æ‰€æœ‰podéƒ½æ˜¯æ­£å¸¸è¿è¡ŒçŠ¶æ€æˆ–æ­£å¸¸ç»“æŸçŠ¶æ€</span><br></code></pre></td></tr></table></figure><h2 id="6-4-éƒ¨ç½²ç»“æœéªŒè¯"><a href="#6-4-éƒ¨ç½²ç»“æœéªŒè¯" class="headerlink" title="6.4  éƒ¨ç½²ç»“æœéªŒè¯"></a>6.4  éƒ¨ç½²ç»“æœéªŒè¯</h2><h3 id="6-4-1-å‘½ä»¤è¡ŒæŸ¥çœ‹"><a href="#6-4-1-å‘½ä»¤è¡ŒæŸ¥çœ‹" class="headerlink" title="6.4.1 å‘½ä»¤è¡ŒæŸ¥çœ‹"></a>6.4.1 å‘½ä»¤è¡ŒæŸ¥çœ‹</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹k8sé›†ç¾¤èŠ‚ç‚¹åˆ—è¡¨</span><br>root@k8s01-1:~# kubectl get node<br>NAME      STATUS   ROLES                         AGE   VERSION<br>k8s01-1   Ready    control-plane,master,worker   12h   v1.23.17<br>k8s01-2   Ready    control-plane,master,worker   12h   v1.23.17<br>k8s01-3   Ready    control-plane,master,worker   12h   v1.23.17<br>k8s01-4   Ready    worker                        12h   v1.23.17<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹k8sé›†ç¾¤ç»„ä»¶çŠ¶æ€</span><br>root@k8s01-1:~# kubectl get cs<br>Warning: v1 ComponentStatus is deprecated in v1.19+<br>NAME                 STATUS    MESSAGE             ERROR<br>controller-manager   Healthy   ok                  <br>scheduler            Healthy   ok                  <br>etcd-1               Healthy   &#123;&quot;health&quot;:&quot;true&quot;&#125;   <br>etcd-2               Healthy   &#123;&quot;health&quot;:&quot;true&quot;&#125;   <br>etcd-0               Healthy   &#123;&quot;health&quot;:&quot;true&quot;&#125; <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹calico èŠ‚ç‚¹</span><br>root@k8s01-1:~# calicoctl node status<br>Calico process is running.<br><br>IPv4 BGP status<br>+--------------+-------------------+-------+----------+-------------+<br>| PEER ADDRESS |     PEER TYPE     | STATE |  SINCE   |    INFO     |<br>+--------------+-------------------+-------+----------+-------------+<br>| 10.13.15.17  | node-to-node mesh | up    | 14:43:14 | Established |<br>| 10.13.15.161 | node-to-node mesh | up    | 14:43:15 | Established |<br>| 10.13.15.99  | node-to-node mesh | up    | 14:43:13 | Established |<br>+--------------+-------------------+-------+----------+-------------+<br>...<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹æ‰€æœ‰pod(é›†ç¾¤ä¸­æ‰€æœ‰podéƒ½æ˜¯æ­£å¸¸è¿è¡ŒçŠ¶æ€æˆ–æ­£å¸¸ç»“æŸçŠ¶æ€)</span><br>root@k8s01-1:~# kubectl get pods -A -o wide<br></code></pre></td></tr></table></figure><h3 id="6-4-2-æŸ¥çœ‹ksp3-4-1çš„webç®¡ç†ç•Œé¢"><a href="#6-4-2-æŸ¥çœ‹ksp3-4-1çš„webç®¡ç†ç•Œé¢" class="headerlink" title="6.4.2 æŸ¥çœ‹ksp3.4.1çš„webç®¡ç†ç•Œé¢"></a>6.4.2 æŸ¥çœ‹ksp3.4.1çš„webç®¡ç†ç•Œé¢</h3><p>è®¿é—®kubesphere3.4.1çš„webç®¡ç†ç•Œé¢ï¼š<a href="http://10.13.15.16:30880/login">http://10.13.15.16:30880/login</a> ï¼Œé»˜è®¤ç”¨æˆ·åï¼šadminï¼Œå…¶é»˜è®¤å¯†ç ï¼šP@88w0rd</p><p><img src="https://s2.loli.net/2025/01/13/uAV8QrZEKHyX35t.png" alt="image-20250113145359197"></p><h2 id="6-5-æ§åˆ¶èŠ‚ç‚¹é…ç½®keepalived"><a href="#6-5-æ§åˆ¶èŠ‚ç‚¹é…ç½®keepalived" class="headerlink" title="6.5 æ§åˆ¶èŠ‚ç‚¹é…ç½®keepalived"></a>6.5 æ§åˆ¶èŠ‚ç‚¹é…ç½®keepalived</h2><p>å‚è€ƒ <a href="https://jiangsanyin.github.io/2024/08/10/%E6%90%AD%E5%BB%BA%E4%BA%92%E4%B8%BA%E4%B8%BB%E5%A4%87MySQL5-7%E9%9B%86%E7%BE%A4%E5%B9%B6%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E5%88%87%E6%8D%A2/#2-3-%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AEkeepalived">https://jiangsanyin.github.io/2024/08/10/%E6%90%AD%E5%BB%BA%E4%BA%92%E4%B8%BA%E4%B8%BB%E5%A4%87MySQL5-7%E9%9B%86%E7%BE%A4%E5%B9%B6%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E5%88%87%E6%8D%A2/#2-3-%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AEkeepalived</a></p><h1 id="ä¸ƒã€å‚è€ƒæ–‡ç« "><a href="#ä¸ƒã€å‚è€ƒæ–‡ç« " class="headerlink" title="ä¸ƒã€å‚è€ƒæ–‡ç« "></a>ä¸ƒã€å‚è€ƒæ–‡ç« </h1><ul><li><p>kubesphereå®˜ç½‘ç¦»çº¿éƒ¨ç½²æ–‡æ¡£ï¼š<a href="https://www.kubesphere.io/zh/docs/v3.4/installing-on-linux/introduction/air-gapped-installation">https://www.kubesphere.io/zh/docs/v3.4/installing-on-linux/introduction/air-gapped-installation</a></p></li><li><p>kubesphereå…³äºéƒ¨ç½²é…ç½®æ–‡ä»¶çš„æè¿°ï¼š<a href="https://github.com/kubesphere/kubekey/blob/master/docs/config-example.md">https://github.com/kubesphere/kubekey/blob/master/docs/config-example.md</a></p></li><li><p>kubesphereåœ¨cnblogsä¸Šçš„åšæ–‡ï¼š<a href="https://www.cnblogs.com/kubesphere/p/18208852">https://www.cnblogs.com/kubesphere/p/18208852</a></p></li><li><p>è¿ç»´åšä¸»è¿ç»´æœ‰æœ¯æ–‡ç« ï¼š<a href="https://zhuanlan.zhihu.com/p/672059287">https://zhuanlan.zhihu.com/p/672059287</a></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>k8säº‘åŸç”Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>amd64æ„æ¶ k8s1.23.17 kubesphere3.4.1 ç¦»çº¿éƒ¨ç½²</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>M3èŠ¯ç‰‡MacOS14.6.1ç³»ç»Ÿå®‰è£…é…ç½®ç ´è§£ç‰ˆSecureCRTä¸SecureFX</title>
    <link href="/2024/09/07/M3%E8%8A%AF%E7%89%87MacOS14-6-1%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E7%A0%B4%E8%A7%A3%E7%89%88SecureCRT%E4%B8%8ESecureFX/"/>
    <url>/2024/09/07/M3%E8%8A%AF%E7%89%87MacOS14-6-1%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E7%A0%B4%E8%A7%A3%E7%89%88SecureCRT%E4%B8%8ESecureFX/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€èƒŒæ™¯"><a href="#ä¸€ã€èƒŒæ™¯" class="headerlink" title="ä¸€ã€èƒŒæ™¯"></a>ä¸€ã€èƒŒæ™¯</h1><p>â€‹ç¬”è€…å¹³æ—¶å·¥ä½œã€å­¦ä¹ ã€ç”Ÿæ´»ä»¥å‰ä½¿ç”¨å›¾å½¢åŒ–çš„Windows7&#x2F;8&#x2F;10&#x2F;11æ“ä½œç³»ç»Ÿå±…å¤šï¼Œæ‰€ä»¥å¹³æ—¶å¯¹Windowsä¸Šçš„è½¯ä»¶ä½¿ç”¨æ¯”è¾ƒç†Ÿæ‚‰ã€ä¹ æƒ¯äº†ã€‚æ¯”å¦‚å¹³æ—¶éœ€è¦è®¿é—®ä¸ä½¿ç”¨LinuxæœåŠ¡å™¨æ—¶ï¼Œå°±æ˜¯åœ¨Windowsç³»ç»Ÿä¸Šä½¿ç”¨ç»ˆç«¯è¿æ¥å·¥å…·SecureCRTä¸æ–‡ä»¶ä¼ è¾“å·¥å…·SecureFXï¼Œæœ€è¿‘æœ‰äº†ä½¿ç”¨M3èŠ¯ç‰‡çš„Macç”µè„‘çš„éœ€æ±‚ï¼Œè¿˜æ˜¯æƒ³å°†åœ¨Macç”µè„‘ä¸Šå®‰è£…è¿™ä¸¤ä¸ªè½¯ä»¶çš„Macç‰ˆã€‚</p><p>ç›¸å…³è½¯ç¡¬ä»¶ç‰ˆæœ¬ï¼š</p><table><thead><tr><th></th><th>è½¯ç¡¬ä»¶åç§°</th><th>ç‰ˆæœ¬</th></tr></thead><tbody><tr><td>ç¡¬ä»¶</td><td>ç”µè„‘</td><td>MacBook Pro</td></tr><tr><td></td><td>èŠ¯ç‰‡</td><td>M3</td></tr><tr><td>è½¯ä»¶</td><td>ç”µè„‘æ“ä½œç³»ç»Ÿ</td><td>macOS Sonoma ç‰ˆæœ¬14.6.1</td></tr><tr><td></td><td>SecureCRT</td><td>9.1.1</td></tr><tr><td></td><td>SecureFX</td><td>9.1.1</td></tr></tbody></table><h1 id="äºŒã€å®æ–½æ­¥éª¤"><a href="#äºŒã€å®æ–½æ­¥éª¤" class="headerlink" title="äºŒã€å®æ–½æ­¥éª¤"></a>äºŒã€å®æ–½æ­¥éª¤</h1><h2 id="2-1-ä¸‹è½½å®‰è£…æ–‡ä»¶"><a href="#2-1-ä¸‹è½½å®‰è£…æ–‡ä»¶" class="headerlink" title="2.1 ä¸‹è½½å®‰è£…æ–‡ä»¶"></a>2.1 ä¸‹è½½å®‰è£…æ–‡ä»¶</h2><p>ä¸‹è½½éœ€è¦ç”¨åˆ°çš„SecureCRT9.1.1ä¸SecureFX9.1.1å®‰è£…æ–‡ä»¶ï¼Œç¬”è€…å·²ç»ä¿å­˜åœ¨ç™¾åº¦ç½‘ç›˜ï¼Œåˆ†ç¦»é“¾æ¥å¦‚ä¸‹ï¼š</p><p>é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/17XFbILxW63Jg7j43CLXlmw?pwd=zs41">https://pan.baidu.com/s/17XFbILxW63Jg7j43CLXlmw?pwd=zs41</a><br>æå–ç ï¼šzs41</p><p>æ¯”å¦‚ï¼Œæˆ‘å°†ä¸‹è½½å¾—åˆ°çš„ä¸¤ä¸ªæ–‡ä»¶ä¿å­˜åœ¨å®¶ç›®å½•ä¸‹çš„â€œDownloadsâ€å³â€œä¸‹è½½â€ç›®å½•ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2024/09/07/1h2ISsATrbz68dn.png" alt="image-20240907215529191"></p><h2 id="2-2-å®‰è£…ä¸é…ç½®SecureCRT9-1-1"><a href="#2-2-å®‰è£…ä¸é…ç½®SecureCRT9-1-1" class="headerlink" title="2.2 å®‰è£…ä¸é…ç½®SecureCRT9.1.1"></a>2.2 å®‰è£…ä¸é…ç½®SecureCRT9.1.1</h2><h3 id="2-2-1-å®‰è£…SecureCRT9-1-1"><a href="#2-2-1-å®‰è£…SecureCRT9-1-1" class="headerlink" title="2.2.1 å®‰è£…SecureCRT9.1.1"></a>2.2.1 å®‰è£…SecureCRT9.1.1</h3><p>åŒå‡»â€œSecureCRT_9.1.1_macyy.cn.dmgâ€ï¼Œé€‰æ‹©åŒæ„åï¼Œå°†çœ‹åˆ°å¦‚ä¸‹çª—å£ã€‚æŒ‰ç…§ä¸‹å›¾ä¸­æç¤ºæ“ä½œã€‚</p><p><img src="https://s2.loli.net/2024/09/07/hoqDXFWcIMSjzH3.png" alt="image-20240907220524436"></p><p>ç„¶åè¿›å…¥MacBook Proçš„â€åº”ç”¨ç¨‹åºâ€œçª—å£ï¼ŒåŒå‡»å°è¯•æ‰“å¼€SecureCRTï¼Œä½†æ­¤æ—¶SecureCRTä¼šæç¤ºå¯¼å…¥licenseæ–‡ä»¶æˆ–ç›´æ¥è¾“å…¥licenseï¼Œæˆ‘ä»¬ç°åœ¨ç›´æ¥é€‰æ‹©â€œcloseâ€å…³é—­æ­¤è½¯ä»¶ã€‚</p><h3 id="2-2-2-ç ´è§£SecureCRT9-1-1"><a href="#2-2-2-ç ´è§£SecureCRT9-1-1" class="headerlink" title="2.2.2 ç ´è§£SecureCRT9.1.1"></a>2.2.2 ç ´è§£SecureCRT9.1.1</h3><p>æ‰“å¼€ä¸Šå›¾ä¸­â€œæ¿€æ´»æ­¥éª¤â€ï¼ŒæŒ‰ç…§å…¶ä¸­è¯´æ˜æ“ä½œã€‚åœ¨ Macç”µè„‘ä¸­ä½¿ç”¨â€command + shift +gâ€ç»„åˆé”®ï¼Œæ‰“å¼€â€œå‰å¾€â€çª—å£ï¼Œè¾“å…¥â€œ~&#x2F;Library&#x2F;Application Support&#x2F;VanDyke&#x2F;â€</p><p><img src="https://s2.loli.net/2024/09/07/i498nLujyp5gZKd.png" alt="image-20240907220839326"></p><p>åœ¨æ‰“å¼€çš„æ–‡ä»¶å¤¹çª—å£ï¼ŒåŒå‡»â€œSecureCRTâ€æ–‡ä»¶å¤¹ï¼Œå°†å‰é¢æåˆ°çš„â€SecureCRT_SecureFX.licâ€æ–‡ä»¶æ‹·è´åˆ°æ­¤æ–‡ä»¶å¤¹ä¸‹ã€‚æ‹·è´å®Œæˆåå¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2024/09/07/VaAG7L1lPxNzbu3.png" alt="image-20240907221349322"></p><p>æ­¤æ—¶å†æ‰“å¼€SecureCRTè½¯ä»¶ï¼Œå°±ä¸ä¼šå†æç¤ºä½ è¾“å…¥licenseäº†ï¼Œè€Œæ˜¯ç›´æ¥è¿›å…¥SecureCRTä½¿ç”¨ç•Œé¢äº†ï¼Œå¤§è‡´å¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2024/09/07/TUbpjIGAf2ODLaV.png" alt="image-20240907221856712"></p><p>è‡³æ­¤ï¼ŒSecureCRT9.1.1ç ´è§£ç‰ˆå·²ç»å®‰è£…å¥½ï¼ŒåŠŸèƒ½ä¸Šå·²ç»èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨ã€‚</p><h3 id="2-2-3-é…ç½®SecureCRT9-1-1"><a href="#2-2-3-é…ç½®SecureCRT9-1-1" class="headerlink" title="2.2.3 é…ç½®SecureCRT9.1.1"></a>2.2.3 é…ç½®SecureCRT9.1.1</h3><p>Macç‰ˆçš„SecureCRTçš„é…ç½®èœå•æ˜¯ä¸æ˜¾ç¤ºå‡ºæ¥çš„ï¼Œåœ¨SecureCRTä½¿ç”¨ç•Œé¢è¾¹ç¼˜ç©ºç™½å¤„â€œé¼ æ ‡å³é”®â€æˆ–è€…â€œMacè§¦æ‘¸å±ä¸Šé£ŸæŒ‡+ä¸­æŒ‡è½»å‡»â€ï¼Œå°†å¼¹å‡ºå¦‚ä¸‹å°å¼¹çª—ï¼Œå•å‡»å®ƒã€‚</p><p><img src="https://s2.loli.net/2024/09/07/NuOnDLTmbJjr5yI.png" alt="image-20240907222206709"></p><p>å•å‡»åï¼Œå°†å¼¹å‡ºå¦‚ä¸‹çª—å£ã€‚å°†å…¶ä¸­å¸¸ç”¨çš„å·¥å…·æ‹–æ”¾åˆ°â€œSecureCRTä½¿ç”¨ç•Œé¢è¾¹ç¼˜ç©ºç™½å¤„â€</p><p><img src="https://s2.loli.net/2024/09/07/CuVwyfv3zSig2Gn.png" alt="image-20240907222429909"></p><p>ä¹‹åå°†åœ¨â€œSecureCRTä½¿ç”¨ç•Œé¢è¾¹ç¼˜ç©ºç™½å¤„â€çœ‹åˆ°å¦‚ä¸‹ä¸€ä¸ªâ€œæ‰³æ‰‹+èµ·å­çš„å›¾æ ‡â€ï¼Œè¿™å°±æ˜¯é…ç½®çª—å£çš„å…¥å£å¤„</p><p><img src="https://s2.loli.net/2024/09/07/Ikr49BJTb6fjtNv.png" alt="image-20240907223244480"></p><h4 id="2-2-3-1-é…ç½®ç»ˆç«¯çª—å£èƒŒæ™¯è‰²ä¸ºè±†æ²™ç»¿"><a href="#2-2-3-1-é…ç½®ç»ˆç«¯çª—å£èƒŒæ™¯è‰²ä¸ºè±†æ²™ç»¿" class="headerlink" title="2.2.3.1 é…ç½®ç»ˆç«¯çª—å£èƒŒæ™¯è‰²ä¸ºè±†æ²™ç»¿"></a>2.2.3.1 é…ç½®ç»ˆç«¯çª—å£èƒŒæ™¯è‰²ä¸ºè±†æ²™ç»¿</h4><p><img src="https://s2.loli.net/2024/09/07/bTe9JHUcwkf2umy.png" alt="image-20240907223117166"></p><p><img src="https://s2.loli.net/2024/09/07/W7XimBIjPlL2uKU.png" alt="image-20240907222959748"></p><p>è¿™æ ·ï¼Œåˆ›å»ºSessionåï¼Œæ‰“å¼€çš„ä¼šè¯ä¸­èƒŒæ™¯è‰²å°±æ˜¯è±†æ²™ç»¿çš„ï¼ˆå¬è¯´è¿™æ ·æœ‰åŠ©äºä¿æŠ¤çœ¼ç›ï¼Œä¸è®ºçœŸå‡åæ­£ç¬”è€…å·²ç»ç”¨ä¹ æƒ¯è¿™ç§èƒŒæ™¯è‰²ï¼‰</p><h4 id="2-2-3-2-é…ç½®ç»ˆç«¯çª—å£å­—ç¬¦æ ·å¼å¦‚å¤§å°"><a href="#2-2-3-2-é…ç½®ç»ˆç«¯çª—å£å­—ç¬¦æ ·å¼å¦‚å¤§å°" class="headerlink" title="2.2.3.2 é…ç½®ç»ˆç«¯çª—å£å­—ç¬¦æ ·å¼å¦‚å¤§å°"></a>2.2.3.2 é…ç½®ç»ˆç«¯çª—å£å­—ç¬¦æ ·å¼å¦‚å¤§å°</h4><p><img src="https://s2.loli.net/2024/09/07/GdmUC78haWKYnib.png" alt="image-20240907223619566"></p><p>è®¾ç½®å­—ç¬¦çš„å­—ä½“ä¸å¤§å°ã€‚ç¬”è€…ä¸‹å›¾å­—ä½“ä¿æŒé»˜è®¤ï¼Œåªè®¾ç½®äº†å­—ç¬¦å¤§å°ï¼š</p><p><img src="https://s2.loli.net/2024/09/07/jsNRgXFtOwPMqWy.png" alt="image-20240907223930227"></p><p>ä¹‹åæ–°åˆ›å»ºçš„ç»ˆç«¯çª—å£å°±æ˜¯å¦‚ä¸‹æ ·å¼ï¼š</p><p><img src="https://s2.loli.net/2024/09/07/qbTCntJPDBskXem.png" alt="image-20240907224136221"></p><h4 id="2-2-3-3-è®¾ç½®ä¼šè¯æ–‡ä»¶ä¼ è¾“åè®®ä¸ºsftp"><a href="#2-2-3-3-è®¾ç½®ä¼šè¯æ–‡ä»¶ä¼ è¾“åè®®ä¸ºsftp" class="headerlink" title="2.2.3.3 è®¾ç½®ä¼šè¯æ–‡ä»¶ä¼ è¾“åè®®ä¸ºsftp"></a>2.2.3.3 è®¾ç½®ä¼šè¯æ–‡ä»¶ä¼ è¾“åè®®ä¸ºsftp</h4><p><img src="https://s2.loli.net/2024/09/07/YHCVmNgUFo6t2pS.png" alt="image-20240907225419343"></p><h2 id="2-3-å®‰è£…ä¸é…ç½®SecureFX9-1-1"><a href="#2-3-å®‰è£…ä¸é…ç½®SecureFX9-1-1" class="headerlink" title="2.3 å®‰è£…ä¸é…ç½®SecureFX9.1.1"></a>2.3 å®‰è£…ä¸é…ç½®SecureFX9.1.1</h2><h3 id="2-3-1-å®‰è£…ä¸ç ´è§£SecureFX9-1-1"><a href="#2-3-1-å®‰è£…ä¸ç ´è§£SecureFX9-1-1" class="headerlink" title="2.3.1 å®‰è£…ä¸ç ´è§£SecureFX9.1.1"></a>2.3.1 å®‰è£…ä¸ç ´è§£SecureFX9.1.1</h3><p>åŒå‡»â€œSecureFX_9.1.1_macyy.cn.dmgâ€ï¼Œé€‰æ‹©åŒæ„åï¼Œå°†çœ‹åˆ°å¦‚ä¸‹çª—å£ã€‚æŒ‰ç…§ä¸‹å›¾ä¸­æç¤ºæ“ä½œã€‚</p><p>å…¶å®ï¼Œå¦‚æœä½ å…ˆå‰æŒ‰ç…§å‰è¿°æ­¥éª¤å®‰è£…ã€ç ´è§£äº†SecureCRT9.1.1çš„è¯ï¼Œåªéœ€è¦æ‰§è¡Œä¸‹å›¾ä¸­çš„æ­¥éª¤1å³å¯ï¼Œå› ä¸ºSecureCRT9.1.1ä¸SecureFX_9.1.1çš„ç ´è§£æ–‡ä»¶æ–‡ä»¶ä¸å†…å®¹æ˜¯ä¸€æ ·çš„ï¼Œä¸”æ”¾åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹</p><p><img src="https://s2.loli.net/2024/09/07/IeXNm7OARfpzQno.png" alt="image-20240907224319446"></p><p>æ­¤æ—¶å°±å¯ä»¥æ­£å¸¸æ‰“å¼€SecureFXè½¯ä»¶æ¥ä¼ è¾“æ–‡ä»¶äº†ã€‚</p><h3 id="2-3-2-ä»SecureCRT9-1-1ä¼šè¯ä¸­ç›´æ¥æ‰“å¼€SecureFX9-1-1ä¼šè¯"><a href="#2-3-2-ä»SecureCRT9-1-1ä¼šè¯ä¸­ç›´æ¥æ‰“å¼€SecureFX9-1-1ä¼šè¯" class="headerlink" title="2.3.2 ä»SecureCRT9.1.1ä¼šè¯ä¸­ç›´æ¥æ‰“å¼€SecureFX9.1.1ä¼šè¯"></a>2.3.2 ä»SecureCRT9.1.1ä¼šè¯ä¸­ç›´æ¥æ‰“å¼€SecureFX9.1.1ä¼šè¯</h3><p>æ­¤æ—¶ï¼Œä½ åˆ›å»ºäº†ä¸€ä¸ªSecureCRTä¼šè¯åï¼Œåœ¨ä¼šè¯tabæ ‡é¢˜ä¸Šå³é”®ï¼Œå¯ä»¥çœ‹åˆ°â€Open SecureFXâ€œé€‰é¡¹ï¼Œä½†å¦‚æœç°åœ¨ç›´æ¥ç‚¹å‡»å¹¶ä¸èƒ½è¿æ¥å¯¹åº”çš„æœåŠ¡å™¨æˆåŠŸï¼Œæ˜¾ç¤ºå¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2024/09/07/Fr3PMTKUDZjfuGd.png" alt="image-20240907225301379"></p><p>è§£å†³æ–¹æ³•æ˜¯ä¿®æ”¹SecureCRTä¸­çš„é…ç½®ï¼Œå…·ä½“è§SecureCRTâ€è®¾ç½®ä¼šè¯æ–‡ä»¶ä¼ è¾“åè®®ä¸ºsftpâ€œç« èŠ‚å†…å®¹ã€‚ç„¶åé‡æ–°åˆ›å»ºSecureCRTä¼šè¯ï¼Œå†æ“ä½œå°±æˆåŠŸã€‚</p><p><img src="https://s2.loli.net/2024/09/07/6TRDgvJMCXdiblL.png" alt="image-20240907225837472"></p>]]></content>
    
    
    <categories>
      
      <category>è½¯ä»¶ç ´è§£</category>
      
    </categories>
    
    
    <tags>
      
      <tag>M3èŠ¯ç‰‡ MacOS14.6.1 ç ´è§£ SecureCRT SecureFX</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ­å»ºäº’ä¸ºä¸»å¤‡MySQL5.7é›†ç¾¤å¹¶å®ç°è‡ªåŠ¨åˆ‡æ¢</title>
    <link href="/2024/08/10/%E6%90%AD%E5%BB%BA%E4%BA%92%E4%B8%BA%E4%B8%BB%E5%A4%87MySQL5-7%E9%9B%86%E7%BE%A4%E5%B9%B6%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E5%88%87%E6%8D%A2/"/>
    <url>/2024/08/10/%E6%90%AD%E5%BB%BA%E4%BA%92%E4%B8%BA%E4%B8%BB%E5%A4%87MySQL5-7%E9%9B%86%E7%BE%A4%E5%B9%B6%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E5%88%87%E6%8D%A2/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€èƒŒæ™¯"><a href="#ä¸€ã€èƒŒæ™¯" class="headerlink" title="ä¸€ã€èƒŒæ™¯"></a>ä¸€ã€èƒŒæ™¯</h1><p>æœåŠ¡å™¨ï¼šä¸¤ä¸ªx86æœåŠ¡å™¨ï¼ˆæœ¬æ–‡ä½¿ç”¨çš„æ˜¯ä¸¤ä¸ªOpenStackè™šæ‹Ÿæœºï¼‰</p><p>MySQLç‰ˆæœ¬ä¿¡æ¯ï¼šmysql-5.7.36-linux-glibc2.12-x86_64</p><p>å…¶ä¸­ï¼Œä¸¤ä¸ªæœåŠ¡å™¨åŠæ“ä½œç³»ç»Ÿçš„ä¿¡æ¯å¦‚ä¸‹ï¼š</p><table><thead><tr><th>ä¸»æœºå</th><th>IP</th><th>ç”¨é€”</th><th>è§„æ ¼</th><th>ç£ç›˜ç©ºé—´</th><th>æ“ä½œç³»ç»Ÿ</th></tr></thead><tbody><tr><td>ztmonitor01</td><td>172.20.180.44</td><td>äº’ä¸ºä¸»ä»æ•°æ®åº“ä¸­çš„èŠ‚ç‚¹1</td><td>4c16g</td><td>500G</td><td>Centos7.9-amd64</td></tr><tr><td>ztmonitor02</td><td>172.20.180.165</td><td>äº’ä¸ºä¸»ä»æ•°æ®åº“ä¸­çš„èŠ‚ç‚¹2</td><td>4c16g</td><td>500G</td><td>Centos7.9-amd64</td></tr><tr><td>~</td><td>172.20.180.43</td><td>Keepalivedçš„è™šæ‹ŸIP</td><td>~</td><td>~</td><td>~</td></tr></tbody></table><p>å¦‚æ— ç‰¹æ®Šè¯´æ˜ï¼Œæ‰€æœ‰ç»ˆç«¯å‘½ä»¤æ“ä½œéƒ½æ˜¯ä»¥rootç”¨æˆ·æ‰§è¡Œçš„ã€‚</p><p>æŒ‰ç…§æ­¤æ–‡æ¡£æœ€ç»ˆå®ç°çš„æ•ˆæœï¼šä¸¤ä¸ªMySQLæ•°æ®åº“å®ä¾‹ç»„æˆä¸€ä¸ªäº’ä¸ºä¸»å¤‡MySQLé›†ç¾¤ï¼ŒåŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªæ•°æ®åº“ä¼šå¯¹æä¾›æœåŠ¡ã€‚ä¸¤ä¸ªæ•°æ®åº“å®ä¾‹åˆ†åˆ«åœ¨ä¸åŒçš„èŠ‚ç‚¹1ä¸èŠ‚ç‚¹2ä¸Šï¼Œåœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šéƒ¨ç½²äº†keepalivedæœåŠ¡ï¼ˆä¸¤ä¸ªèŠ‚ç‚¹çš„ä¼˜å…ˆçº§ç›¸åŒï¼Œå…ˆè¿è¡Œçš„å³ä¸ºkeepalivedé›†ç¾¤masterèŠ‚ç‚¹ï¼Œåé¢åªæœ‰å½“è§’è‰²ä¸ºmasterçš„èŠ‚ç‚¹ä¸Šçš„keepalivedåœæ‰æ‰ä¼šå‡ºç°keepalivedè§’è‰²åˆ‡æ¢ï¼‰ï¼Œé€šè¿‡é’ˆå¯¹keepalivedçš„notify_masterã€notify_backupã€notify_stopä¸vrrp_scriptç¼–å†™è‡ªå®šä¹‰è„šæœ¬ç¨‹åºå®ç°ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šçš„æ•°æ®åº“å®ä¾‹ä¸­æ•°æ®çš„åŒæ­¥ã€‚</p><h1 id="äºŒã€æ­å»ºé…ç½®æ­¥éª¤"><a href="#äºŒã€æ­å»ºé…ç½®æ­¥éª¤" class="headerlink" title="äºŒã€æ­å»ºé…ç½®æ­¥éª¤"></a>äºŒã€æ­å»ºé…ç½®æ­¥éª¤</h1><h2 id="2-1-å®‰è£…-MySQL-å®ä¾‹"><a href="#2-1-å®‰è£…-MySQL-å®ä¾‹" class="headerlink" title="2.1 å®‰è£… MySQL å®ä¾‹"></a>2.1 å®‰è£… MySQL å®ä¾‹</h2><p>MySQL5.7å®‰è£…æ–‡ä»¶ä¸‹è½½åœ°å€ï¼š<a href="https://mirrors.aliyun.com/mysql/MySQL-5.7/mysql-5.7.36-linux-glibc2.12-x86_64.tar.gz">https://mirrors.aliyun.com/mysql/MySQL-5.7/mysql-5.7.36-linux-glibc2.12-x86_64.tar.gz</a></p><h3 id="2-1-1-èŠ‚ç‚¹1ä¸Šå®‰è£…æ•°æ®åº“å®ä¾‹"><a href="#2-1-1-èŠ‚ç‚¹1ä¸Šå®‰è£…æ•°æ®åº“å®ä¾‹" class="headerlink" title="2.1.1 èŠ‚ç‚¹1ä¸Šå®‰è£…æ•°æ®åº“å®ä¾‹"></a>2.1.1 èŠ‚ç‚¹1ä¸Šå®‰è£…æ•°æ®åº“å®ä¾‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#1è§£å‹MySQL5.7.36</span><br>[root@ztmonitor01 ~]# <span class="hljs-built_in">cd</span> /data/softs<br>[root@ztmonitor01 softs]# wget https://mirrors.aliyun.com/mysql/MySQL-5.7/mysql-5.7.36-linux-glibc2.12-x86_64.tar.gz<br>[root@ztmonitor01 softs]# tar xf mysql-5.7.36-linux-glibc2.12-x86_64.tar.gz -C /usr/local/<br>[root@ztmonitor01 softs]# <span class="hljs-built_in">mv</span> /usr/local/mysql-5.7.36-linux-glibc2.12-x86_64 /usr/local/mysql<br><br><span class="hljs-comment">#2è®¾ç½®MySQLçš„ç¯å¢ƒå˜é‡</span><br>[root@ztmonitor01 softs]# vi /etc/profile<br><span class="hljs-built_in">export</span> MYSQL_HOME=/usr/local/mysql<br>PATH=<span class="hljs-variable">$MYSQL_HOME</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=:<span class="hljs-variable">$MYSQL_HOME</span>/lib<br><br><span class="hljs-comment">#3åˆ›å»ºmysqlç”¨æˆ·ç»„ä¸ç”¨æˆ·</span><br>[root@ztmonitor01 softs]# groupadd -r mysql<br>[root@ztmonitor01 softs]# useradd -M -r -s /sbin/nologin -g mysql mysql<br><br><span class="hljs-comment">#4å‡†å¤‡æ•°æ®ç›®å½•ã€è®¾ç½®å±ä¸»ä¸å±ç»„ä¸ºmysql:mysql</span><br>[root@ztmonitor01 softs]# <span class="hljs-built_in">mkdir</span> /data/mysql<br>[root@ztmonitor01 softs]# <span class="hljs-built_in">chown</span> -R mysql. /data/mysql<br><br><span class="hljs-comment">#5åˆå§‹åŒ–æ•°æ®åº“</span><br>[root@ztmonitor01 softs]# <span class="hljs-built_in">source</span> /etc/profile<br>[root@ztmonitor01 softs]# mysqld --initialize-insecure --user=mysql --basedir=/usr/local/mysql --datadir=/data/mysql<br><br><span class="hljs-comment">#6å‡†å¤‡mysqlé…ç½®æ–‡ä»¶ï¼ˆ#æ¯ä¸ªMySQLæ•°æ®åº“çš„server_idéƒ½è®¾ç½®æˆä¸åŒçš„ï¼‰</span><br>[root@ztmonitor01 softs]# vi /etc/my.cnf                                                                                         <br>[mysqld]<br>user=mysql<br>port=3306<br>server_id=1   <span class="hljs-comment">#å„ä¸ªMySQLæ•°æ®åº“æœåŠ¡ç«¯éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€id</span><br>basedir=/usr/local/mysql<br>datadir=/data/mysql<br>log_bin=mysql-bin        <span class="hljs-comment">#å¼€å¯binlogï¼Œbinlogæ—¥å¿—æ–‡ä»¶åªå¯¹å¢åˆ æ”¹æœ‰è®°å½•ï¼ŒæŸ¥è¯¢æ“ä½œæ˜¯æ²¡æœ‰è®°å½•çš„</span><br>gtid-mode=on<br>enforce-gtid-consistency=<span class="hljs-literal">true</span><br>socket=/data/mysql.sock<br>log_error=/data/mysql/mysql_err.log<br>character-set-server=utf8<br>symbolic-links=0<br>expire_logs_days=10<br>default_password_lifetime=0     <span class="hljs-comment">#è®¾ç½®å¯†ç ä¸è¿‡æœŸ</span><br>[mysql]<br>socket=/data/mysql.sock<br><br><span class="hljs-comment">#7ä½¿ç”¨systemdæ‰˜ç®¡mysqlæœåŠ¡</span><br>[root@ztmonitor01 softs]# <span class="hljs-built_in">cat</span> /usr/lib/systemd/system/mysqld.service<br>[Unit]<br>Description=MySQL Server<br>Documentation=man:mysqld(8)<br>Documentation=http://dev.mysql.com/doc/refman/en/using-systemd.html<br>After=network.target<br>After=syslog.target<br>[Install]<br>WantedBy=multi-user.target<br>[Service]<br>User=mysql<br>Group=mysql<br>ExecStart=/usr/local/mysql/bin/mysqld --defaults-file=/etc/my.cnf<br>LimitNOFILE=5000<br><br><span class="hljs-comment">#8å¯åŠ¨æ•°æ®åº“</span><br>[root@ztmonitor01 softs]# systemctl daemon-reload <br>[root@ztmonitor01 softs]# systemctl start mysqld<br>[root@ztmonitor01 softs]# systemctl <span class="hljs-built_in">enable</span> mysqld<br>[root@ztmonitor01 softs]# systemctl status mysqld<br><br><span class="hljs-comment">#9è®¾ç½®rootå¯†ç (æ­¤å¤„è®¾ç½®ä¸º123456)</span><br>[root@ztmonitor01 softs]# mysqladmin -u root -P 3306 password <span class="hljs-string">&#x27;123456&#x27;</span><br><br><span class="hljs-comment">#10ç™»å½•æ•°æ®åº“</span><br>[root@ztmonitor01 softs]# mysql -uroot -p123456<br><span class="hljs-comment">#ä¸‹é¢çš„%è¡¨ç¤ºå…è®¸ä»»ä½•ipè®¿é—®æ­¤mysqlæ•°æ®åº“</span><br>mysql&gt; GRANT ALL PRIVILEGES ON *.* TO <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;123456&#x27;</span> WITH GRANT OPTION;<br>mysql&gt; flush privileges;<br>mysql&gt; <span class="hljs-built_in">exit</span>;<br><br></code></pre></td></tr></table></figure><h3 id="2-1-2-èŠ‚ç‚¹2ä¸Šå®‰è£…æ•°æ®åº“å®ä¾‹"><a href="#2-1-2-èŠ‚ç‚¹2ä¸Šå®‰è£…æ•°æ®åº“å®ä¾‹" class="headerlink" title="2.1.2 èŠ‚ç‚¹2ä¸Šå®‰è£…æ•°æ®åº“å®ä¾‹"></a>2.1.2 èŠ‚ç‚¹2ä¸Šå®‰è£…æ•°æ®åº“å®ä¾‹</h3><p>æ³¨æ„ï¼Œztmonitor02ä¸Šçš„æ“ä½œä¸ztmonitor01ä¸Šçš„å‡ ä¹ä¸€æ ·ï¼Œä½†&#x2F;etc&#x2F;my.cnfæ–‡ä»¶ä¸­[mysqld]ä¸‹é¢çš„server_idé…ç½®é¡¹çš„å€¼ä¸€å®šè¦ä¸åŒã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#1è§£å‹MySQL5.7.36</span><br>[root@ztmonitor02 ~]# tar xf /data/softs/mysql-5.7.36-linux-glibc2.12-x86_64.tar.gz -C /usr/local/<br>[root@ztmonitor02 ~]# <span class="hljs-built_in">mv</span> /usr/local/mysql-5.7.36-linux-glibc2.12-x86_64 /usr/local/mysql<br><br><span class="hljs-comment">#2è®¾ç½®MySQLçš„ç¯å¢ƒå˜é‡</span><br>[root@ztmonitor02 ~]# vi /etc/profile<br><span class="hljs-built_in">export</span> MYSQL_HOME=/usr/local/mysql<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$MYSQL_HOME</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=:/usr/local/mysql/lib<br><br><span class="hljs-comment">#3åˆ›å»ºmysqlç”¨æˆ·ç»„ä¸ç”¨æˆ·</span><br>[root@ztmonitor02 ~]# groupadd -r mysql<br>[root@ztmonitor02 ~]# useradd -M -r -s /sbin/nologin -g mysql mysql<br><br><span class="hljs-comment">#4å‡†å¤‡æ•°æ®ç›®å½•</span><br>[root@ztmonitor02 ~]# <span class="hljs-built_in">mkdir</span> /data/mysql<br>[root@ztmonitor02 ~]# <span class="hljs-built_in">chown</span> -R mysql.mysql /data/mysql<br><br><span class="hljs-comment">#5å‡†å¤‡mysqlé…ç½®æ–‡ä»¶</span><br>[root@ztmonitor02 ~]# vi /etc/my.cnf<br>[mysqld]<br>user=mysql<br>port=3306<br>server_id=2   <span class="hljs-comment">#å„ä¸ªMySQLæ•°æ®åº“æœåŠ¡ç«¯éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€id</span><br>basedir=/usr/local/mysql<br>datadir=/data/mysql<br>log_bin=mysql-bin        <span class="hljs-comment">#å¼€å¯binlogï¼Œbinlogæ—¥å¿—æ–‡ä»¶åªå¯¹å¢åˆ æ”¹æœ‰è®°å½•ï¼ŒæŸ¥è¯¢æ“ä½œæ˜¯æ²¡æœ‰è®°å½•çš„</span><br>gtid-mode=on<br>enforce-gtid-consistency=<span class="hljs-literal">true</span><br>socket=/data/mysql.sock<br>log_error=/data/mysql/mysql_err.log<br>character-set-server=utf8<br>symbolic-links=0<br>expire_logs_days=10<br>default_password_lifetime=0     <span class="hljs-comment">#è®¾ç½®å¯†ç ä¸è¿‡æœŸ</span><br>[mysql]<br>socket=/data/mysql.sock<br><br><span class="hljs-comment">#6åˆå§‹åŒ–æ•°æ®åº“</span><br>[root@ztmonitor02 ~]# <span class="hljs-built_in">source</span> /etc/profile<br>[root@ztmonitor02 ~]# mysqld --initialize-insecure --user=mysql --basedir=/usr/local/mysql --datadir=/data/mysql<br><br><span class="hljs-comment">#7ä½¿ç”¨systemdæ‰˜ç®¡mysqlæœåŠ¡</span><br>[root@ztmonitor02 ~]# vi /usr/lib/systemd/system/mysqld.service<br>[Unit]<br>Description=MySQL Server<br>Documentation=man:mysqld(8)<br>Documentation=http://dev.mysql.com/doc/refman/en/using-systemd.html<br>After=network.target<br>After=syslog.target<br>[Install]<br>WantedBy=multi-user.target<br>[Service]<br>User=mysql<br>Group=mysql<br>ExecStart=/usr/local/mysql/bin/mysqld --defaults-file=/etc/my.cnf<br>LimitNOFILE = 5000<br><br><span class="hljs-comment">#8å¯åŠ¨æ•°æ®åº“</span><br>[root@ztmonitor02 ~]# systemctl daemon-reload <br>[root@ztmonitor02 ~]# systemctl start mysqld<br>[root@ztmonitor02 ~]# systemctl <span class="hljs-built_in">enable</span> mysqld<br>[root@ztmonitor02 ~]# systemctl status mysqld<br><br><span class="hljs-comment">#9è®¾ç½®rootå¯†ç </span><br>[root@ztmonitor02 ~]# mysqladmin -u root password <span class="hljs-string">&#x27;123456&#x27;</span><br><br><span class="hljs-comment">#10ç™»å½•æ•°æ®åº“</span><br>[root@ztmonitor02 ~]# mysql -uroot -p123456<br><br><span class="hljs-comment">#ä¸‹é¢çš„%è¡¨ç¤ºå…è®¸ä»»ä½•ipè®¿é—®æ­¤mysqlæ•°æ®åº“</span><br>mysql&gt; GRANT ALL PRIVILEGES ON *.* TO <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="hljs-string">&#x27;123456&#x27;</span> WITH GRANT OPTION;<br>mysql&gt; flush privileges;<br>mysql&gt; <span class="hljs-built_in">exit</span>;<br></code></pre></td></tr></table></figure><h3 id="2-1-3-ç¡®è®¤ä¸¤æ•°æ®åº“å®ä¾‹id"><a href="#2-1-3-ç¡®è®¤ä¸¤æ•°æ®åº“å®ä¾‹id" class="headerlink" title="2.1.3 ç¡®è®¤ä¸¤æ•°æ®åº“å®ä¾‹id"></a>2.1.3 ç¡®è®¤ä¸¤æ•°æ®åº“å®ä¾‹id</h3><p>å¦‚ä¸‹å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªæ•°æ®åº“å®ä¾‹çš„idæ˜¯ä¸åŒçš„ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#èŠ‚ç‚¹1</span><br>[root@ztmonitor01 ~]# mysql -uroot -p123456 -e <span class="hljs-string">&quot;select @@server_id&quot;</span><br>mysql: [Warning] Using a password on the <span class="hljs-built_in">command</span> line interface can be insecure.<br>+-------------+<br>| @@server_id |<br>+-------------+<br>|           1 |<br>+-------------+<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#èŠ‚ç‚¹2</span><br>[root@ztmonitor02 ~]# mysql -uroot -p123456 -e <span class="hljs-string">&quot;select @@server_id&quot;</span><br>mysql: [Warning] Using a password on the <span class="hljs-built_in">command</span> line interface can be insecure.<br>+-------------+<br>| @@server_id |<br>+-------------+<br>|           2 |<br>+-------------+<br></code></pre></td></tr></table></figure><h2 id="2-2-é…ç½®äº’ä¸ºä¸»å¤‡MySQLé›†ç¾¤"><a href="#2-2-é…ç½®äº’ä¸ºä¸»å¤‡MySQLé›†ç¾¤" class="headerlink" title="2.2 é…ç½®äº’ä¸ºä¸»å¤‡MySQLé›†ç¾¤"></a>2.2 é…ç½®äº’ä¸ºä¸»å¤‡MySQLé›†ç¾¤</h2><p>ä¸Šé¢ï¼ŒMySQL æ•°æ®åº“é›†ç¾¤çš„ä¸¤ä¸ªå®ä¾‹èŠ‚ç‚¹å·²ç»æ­å»ºå®Œæˆäº†ï¼Œä¸‹é¢å°†è¿™äº›æ­å»ºçš„æ•°æ®åº“å®ä¾‹é…ç½®æˆäº’ä¸ºä¸»å¤‡å¤åˆ¶é›†ç¾¤ã€‚</p><p>é…ç½® MySQL ä¸»å¤‡å¤åˆ¶é›†ç¾¤çš„å¤§è‡´æ­¥éª¤ï¼š</p><ul><li>ä¸»åº“å¼€å¯ Binlog æ—¥å¿—ï¼Œä»åº“å¤åˆ¶ä¸»åº“æ•°æ®è¦é€šè¿‡ Binlog è¿›è¡Œå¤åˆ¶ã€‚</li><li>ä¸»åº“åˆ›å»ºä¸“é—¨ç”¨ä½œä¸»ä»å¤åˆ¶çš„ç”¨æˆ·ã€‚</li><li>å°†ä¸»åº“æ•°æ®è¿›è¡Œå¤‡ä»½ï¼Œå†ä»åº“ä¸­æ¢å¤ï¼ˆå¦‚æœä¸»åº“ä¸ä»åº“éƒ½æ˜¯æ–°æ­å»ºçš„ï¼Œæ— å†…å®¹éœ€è¦æ¢å¤ï¼Œæ­¤æ­¥éª¤å¯è·³è¿‡ï¼‰ã€‚</li><li>é…ç½®ä»åº“è¿æ¥ä¸»åº“çš„å¤åˆ¶ä¿¡æ¯ã€‚</li><li>å¯åŠ¨ä¸»ä»å¤åˆ¶é›†ç¾¤ã€‚</li></ul><h3 id="2-2-1-ç¡®è®¤æ•°æ®åº“èŠ‚ç‚¹å·²å¼€å¯-Binlog"><a href="#2-2-1-ç¡®è®¤æ•°æ®åº“èŠ‚ç‚¹å·²å¼€å¯-Binlog" class="headerlink" title="2.2.1 ç¡®è®¤æ•°æ®åº“èŠ‚ç‚¹å·²å¼€å¯ Binlog"></a>2.2.1 ç¡®è®¤æ•°æ®åº“èŠ‚ç‚¹å·²å¼€å¯ Binlog</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ztmonitor01 ~]# mysql -uroot -p123456 -e <span class="hljs-string">&quot;show variables like &#x27;%log_bin%&#x27;;&quot;</span><br>mysql: [Warning] Using a password on the <span class="hljs-built_in">command</span> line interface can be insecure.<br>+---------------------------------+-----------------------------+<br>| Variable_name                   | Value                       |<br>+---------------------------------+-----------------------------+<br>| log_bin                         | ON                          |<br>| log_bin_basename                | /data/mysql/mysql-bin       |<br>| log_bin_index                   | /data/mysql/mysql-bin.index |<br>| log_bin_trust_function_creators | OFF                         |<br>| log_bin_use_v1_row_events       | OFF                         |<br>| sql_log_bin                     | ON                          |<br>+---------------------------------+-----------------------------+<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ztmonitor02 ~]# mysql -uroot -p123456 -e <span class="hljs-string">&quot;show variables like &#x27;%log_bin%&#x27;;&quot;</span><br>mysql: [Warning] Using a password on the <span class="hljs-built_in">command</span> line interface can be insecure.<br>+---------------------------------+-----------------------------+<br>| Variable_name                   | Value                       |<br>+---------------------------------+-----------------------------+<br>| log_bin                         | ON                          |<br>| log_bin_basename                | /data/mysql/mysql-bin       |<br>| log_bin_index                   | /data/mysql/mysql-bin.index |<br>| log_bin_trust_function_creators | OFF                         |<br>| log_bin_use_v1_row_events       | OFF                         |<br>| sql_log_bin                     | ON                          |<br>+---------------------------------+-----------------------------+<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¸ªæ•°æ®åº“å®ä¾‹çš„log_binéƒ½æ˜¯å¼€å¯çš„ã€‚ä»åº“å¤åˆ¶ä¸»åº“ï¼ˆä¸»åº“ä¸ä»åº“æ˜¯å¯ä»¥åˆ‡æ¢çš„ï¼Œæ¯”å¦‚èŠ‚ç‚¹1åœ¨æŸæƒ…å†µä¸‹æ˜¯ä¸»åº“ï¼Œä½†åœ¨æŸæƒ…å†µåˆä¼šåˆ‡æ¢æˆå¤‡åº“ï¼‰æ•°æ®ä¸æ¢å¤æ•°æ®ï¼Œéƒ½æ˜¯é€šè¿‡ Binlog è¿›è¡Œçš„ã€‚</p><h3 id="2-2-2-åˆ›å»ºä¸»ä»å¤åˆ¶çš„ç”¨æˆ·"><a href="#2-2-2-åˆ›å»ºä¸»ä»å¤åˆ¶çš„ç”¨æˆ·" class="headerlink" title="2.2.2 åˆ›å»ºä¸»ä»å¤åˆ¶çš„ç”¨æˆ·"></a>2.2.2 åˆ›å»ºä¸»ä»å¤åˆ¶çš„ç”¨æˆ·</h3><p>ä¸¤ä¸ªæ•°æ®åº“å®ä¾‹ä¸Šéƒ½è¦æ‰§è¡Œï¼Œæ‰§è¡Œçš„å¦‚ä¸‹ç›¸åŒçš„å‘½ä»¤å³å¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#åˆ›å»ºç”¨æˆ·replicationï¼Œå¯†ç æ˜¯replicationï¼Œæ­¤ç”¨æˆ·èƒ½ä»ä»»ä½•ipç™»å½•è¿›ä¸»åº“ï¼Œå¯¹æ‰€æœ‰æ•°æ®åº“çš„æ‰€æœ‰æˆå‘˜æ‹¥æœ‰replication slaveæƒé™<br>mysql&gt; GRANT REPLICATION SLAVE,REPLICATION CLIENT ON *.* TO replication@&#x27;%&#x27; IDENTIFIED BY &#x27;replication&#x27;;<br>mysql&gt; flush  privileges;<br>mysql&gt; exit;<br></code></pre></td></tr></table></figure><h3 id="2-2-3-åœ¨èŠ‚ç‚¹1ä¸Šæ‰§è¡ŒåŒæ­¥æ“ä½œ"><a href="#2-2-3-åœ¨èŠ‚ç‚¹1ä¸Šæ‰§è¡ŒåŒæ­¥æ“ä½œ" class="headerlink" title="2.2.3 åœ¨èŠ‚ç‚¹1ä¸Šæ‰§è¡ŒåŒæ­¥æ“ä½œ"></a>2.2.3 åœ¨èŠ‚ç‚¹1ä¸Šæ‰§è¡ŒåŒæ­¥æ“ä½œ</h3><p>é¦–å…ˆåœ¨èŠ‚ç‚¹2ä¸ŠæŸ¥è¯¢å…¶ä¸Šçš„æ•°æ®åº“å®ä¾‹çŠ¶æ€ä¿¡æ¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show master status;<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/08/10/Gc35WMoYOBq1VdN.png" alt="image-20240810231040169"></p><p>è®°ä½æ­¤Fileåˆ—ä¸Positionåˆ—çš„å€¼mysql-bin.000002ã€1327</p><p>ä»¥ä¸‹å‘½ä»¤åœ¨èŠ‚ç‚¹1ä¸Šæ‰§è¡Œï¼ˆèŠ‚ç‚¹1æ•°æ®åº“å®ä¾‹çš„ä¸»åº“æ˜¯èŠ‚ç‚¹2ä¸Šçš„æ•°æ®åº“å®ä¾‹ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; change master to master_host=&#x27;172.20.180.165&#x27;,master_port=3306,master_user=&#x27;replication&#x27;,master_password=&#x27;replication&#x27;,master_log_file=&#x27;mysql-bin.000002&#x27;,master_log_pos=1327;<br>mysql&gt; start slave;<br>mysql&gt; show slave status\G<br>mysql&gt; exit;<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/08/10/xhAfS13TQPMV8CX.png" alt="image-20240810231319922"></p><p><img src="https://s2.loli.net/2024/08/10/wtzhCG8RNcvbOYQ.png" alt="image-20240810231352704"></p><h3 id="2-2-4-åœ¨èŠ‚ç‚¹2ä¸Šæ‰§è¡ŒåŒæ­¥æ“ä½œ"><a href="#2-2-4-åœ¨èŠ‚ç‚¹2ä¸Šæ‰§è¡ŒåŒæ­¥æ“ä½œ" class="headerlink" title="2.2.4 åœ¨èŠ‚ç‚¹2ä¸Šæ‰§è¡ŒåŒæ­¥æ“ä½œ"></a>2.2.4 åœ¨èŠ‚ç‚¹2ä¸Šæ‰§è¡ŒåŒæ­¥æ“ä½œ</h3><p>é¦–å…ˆåœ¨èŠ‚ç‚¹1ä¸ŠæŸ¥è¯¢å…¶ä¸Šçš„æ•°æ®åº“å®ä¾‹çŠ¶æ€ä¿¡æ¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show master status;<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/08/10/UpgA36Oad1PWfqi.png" alt="image-20240810231523835"></p><p>è®°ä½æ­¤Fileåˆ—ä¸Positionåˆ—çš„å€¼mysql-bin.000002ã€1327</p><p>ä»¥ä¸‹å‘½ä»¤åœ¨èŠ‚ç‚¹2ä¸Šæ‰§è¡Œï¼ˆèŠ‚ç‚¹2æ•°æ®åº“å®ä¾‹çš„ä¸»åº“æ˜¯èŠ‚ç‚¹1ä¸Šçš„æ•°æ®åº“å®ä¾‹ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; change master to master_host=&#x27;172.20.180.44&#x27;,master_port=3306,master_user=&#x27;replication&#x27;,master_password=&#x27;replication&#x27;,master_log_file=&#x27;mysql-bin.000002&#x27;,master_log_pos=1327;<br>mysql&gt; start slave;<br>mysql&gt; show slave status\G<br>mysql&gt; exit;<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/08/10/3QTtGlup4D9gXAw.png" alt="image-20240810231640870"></p><h3 id="2-2-5-éªŒè¯äº’ä¸ºä¸»ä»æ•°æ®åº“ç”Ÿæ•ˆ"><a href="#2-2-5-éªŒè¯äº’ä¸ºä¸»ä»æ•°æ®åº“ç”Ÿæ•ˆ" class="headerlink" title="2.2.5 éªŒè¯äº’ä¸ºä¸»ä»æ•°æ®åº“ç”Ÿæ•ˆ"></a>2.2.5 éªŒè¯äº’ä¸ºä¸»ä»æ•°æ®åº“ç”Ÿæ•ˆ</h3><p>åœ¨èŠ‚ç‚¹1ä¸Šçš„MySQLæ•°æ®åº“å®ä¾‹ä¸­åˆ›å»ºæ•°æ®åº“db01ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ztmonitor01 ~]# mysql -uroot -p123456 -e <span class="hljs-string">&quot;create database db01;&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/08/10/mWdKCJLaDy13Rol.png" alt="image-20240810231810961"></p><p>åœ¨èŠ‚ç‚¹2ä¸Šçš„MySQLæ•°æ®åº“å®ä¾‹ä¸­åˆ›å»ºæ•°æ®åº“db02ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ztmonitor02 ~]# mysql -uroot -p123456 -e <span class="hljs-string">&quot;create database db02;&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/08/10/safScmyirpjn3XT.png" alt="image-20240810231906754"></p><p>#åœ¨èŠ‚ç‚¹1æˆ–èŠ‚ç‚¹2ä¸Šçš„MySQLæ•°æ®åº“å®ä¾‹ä¸ŠæŸ¥çœ‹ç°æœ‰çš„æ‰€æœ‰æ•°æ®åº“åç§°ï¼ˆæ­£å¸¸æƒ…å†µä¸‹ï¼Œåœ¨ä»»ä½•ä¸€æ–¹å¯¹æ‰€æœ‰æ•°æ®åº“çš„æ‰€æœ‰æ“ä½œéƒ½ä¼šåŒæ­¥ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; show databases;<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/08/11/T4HmEsuwS8i3A9J.png" alt="image-20240810232108875"></p><h3 id="2-2-6-åˆ›å»ºåˆ‡æ¢è„šæœ¬"><a href="#2-2-6-åˆ›å»ºåˆ‡æ¢è„šæœ¬" class="headerlink" title="2.2.6 åˆ›å»ºåˆ‡æ¢è„šæœ¬"></a>2.2.6 åˆ›å»ºåˆ‡æ¢è„šæœ¬</h3><p>è¿™äº›è„šæœ¬åªå­˜åœ¨äºMySQLé›†ç¾¤çš„èŠ‚ç‚¹1ä¸èŠ‚ç‚¹2ä¸Šã€‚</p><p>åˆ‡æ¢è„šæœ¬è§„åˆ’ï¼Œå°†æ‰€æœ‰åˆ‡æ¢è„šæœ¬æ”¾åœ¨&#x2F;data&#x2F;server&#x2F;mysqlç›®å½•ä¸‹ï¼Œç›¸å…³è„šæœ¬è¯´æ˜å¦‚ä¸‹ï¼š</p><p>åˆ›å»ºå¹¶è¿›å…¥&#x2F;data&#x2F;server&#x2F;mysqlç›®å½•ï¼Œå¦‚ä¸‹æ–‡ä»¶ï¼š</p><ul><li>Logs  ã€€    &#x2F;&#x2F;å­˜å‚¨æ—¥å¿—çš„æ–‡ä»¶ç›®å½•</li><li>mybackup.sh  &#x2F;&#x2F;æ¸…ç©ºslaveé…ç½®ï¼Œé‡æ–°è·å–è¿œç¨‹æ—¥å¿—æ–‡ä»¶åŠPos,å¹¶å¼€å¯åŒæ­¥</li><li>mycheck.sh   &#x2F;&#x2F;æ£€æŸ¥mysqlè¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœè¿è¡Œæ­£å¸¸ï¼Œé€€å‡ºã€‚å¦‚æœè¿è¡Œä¸æ­£å¸¸è°ƒç”¨pkill keepalived</li><li>mymaster.sh  &#x2F;&#x2F;å…ˆåˆ¤æ–­åŒæ­¥å¤åˆ¶æ˜¯å¦æ‰§è¡Œå®Œæˆï¼Œå¦‚æœæœªæ‰§è¡Œå®Œæˆç­‰å¾…1åˆ†é’Ÿåï¼Œåœæ­¢åŒæ­¥ï¼ˆstop slave;ï¼‰ï¼Œå¹¶ä¸”è®°å½•åˆ‡æ¢åçš„æ—¥å¿—å’Œpos</li><li>.mysqlenv    &#x2F;&#x2F;è„šæœ¬è¿è¡Œç¯å¢ƒæ–‡ä»¶</li><li>mystop.sh    &#x2F;&#x2F;è®¾ç½®å‚æ•°ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œæœ€åæ£€æŸ¥çœ‹æ˜¯å¦è¿˜æœ‰å†™æ“ä½œï¼Œæœ€å1åˆ†é’Ÿé€€å‡º</li><li>syncposfile   &#x2F;&#x2F;æ¯æ¬¡åˆ‡æ¢åï¼ŒMasteræœ€åä¸€æ¬¡Fileå€¼å’ŒPositionå€¼ã€‚</li></ul><p><strong>æ³¨</strong>ï¼šè¿™äº›è„šæœ¬å‚è€ƒè‡ªæ­¤æ–‡ç« <a href="https://www.cnblogs.com/saneri/p/11423059.html%EF%BC%88%E6%84%9F%E8%B0%A2%EF%BC%89%EF%BC%8C%E4%BD%86%E8%87%AA%E5%B7%B1%E5%81%9A%E4%BA%86%E5%B0%91%E8%AE%B8%E6%94%B9%E5%8A%A8%E4%B8%8E%E9%AA%8C%E8%AF%81">https://www.cnblogs.com/saneri/p/11423059.htmlï¼ˆæ„Ÿè°¢ï¼‰ï¼Œä½†è‡ªå·±åšäº†å°‘è®¸æ”¹åŠ¨ä¸éªŒè¯</a></p><h3 id="2-2-7-ç¯å¢ƒå˜é‡æ–‡ä»¶"><a href="#2-2-7-ç¯å¢ƒå˜é‡æ–‡ä»¶" class="headerlink" title="2.2.7 ç¯å¢ƒå˜é‡æ–‡ä»¶"></a>2.2.7 ç¯å¢ƒå˜é‡æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šéƒ½æ‰§è¡Œå¦‚ä¸‹æ“ä½œ</span><br><span class="hljs-built_in">mkdir</span> /data/server/mysql<br><span class="hljs-built_in">cd</span> /data/server/mysql<br></code></pre></td></tr></table></figure><h4 id="2-2-7-1-èŠ‚ç‚¹1ä¸Šçš„ç¯å¢ƒæ–‡ä»¶"><a href="#2-2-7-1-èŠ‚ç‚¹1ä¸Šçš„ç¯å¢ƒæ–‡ä»¶" class="headerlink" title="2.2.7.1 èŠ‚ç‚¹1ä¸Šçš„ç¯å¢ƒæ–‡ä»¶"></a>2.2.7.1 èŠ‚ç‚¹1ä¸Šçš„ç¯å¢ƒæ–‡ä»¶</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#èŠ‚ç‚¹1çš„ipæ˜¯172.20.180.44ï¼Œä¸‹é¢REMOTE_IPåº”è¯¥é…ç½®æˆèŠ‚ç‚¹2çš„ipï¼ˆ172.20.180.165ï¼‰</span><br>[root@ztmonitor01 mysql]# vi .mysqlenv<br>MYSQL=/usr/local/mysql/bin/mysql<br>MYSQL_CMD=<span class="hljs-string">&quot;-uroot -p123456&quot;</span><br><span class="hljs-comment">#è¿œç«¯ä¸»æœºçš„IPåœ°å€</span><br>REMOTE_IP=172.20.180.165<br><span class="hljs-built_in">export</span> mysql=<span class="hljs-string">&quot;<span class="hljs-variable">$MYSQL</span> <span class="hljs-variable">$MYSQL_CMD</span> &quot;</span><br></code></pre></td></tr></table></figure><h4 id="2-2-7-2-èŠ‚ç‚¹2ä¸Šçš„ç¯å¢ƒæ–‡ä»¶"><a href="#2-2-7-2-èŠ‚ç‚¹2ä¸Šçš„ç¯å¢ƒæ–‡ä»¶" class="headerlink" title="2.2.7.2 èŠ‚ç‚¹2ä¸Šçš„ç¯å¢ƒæ–‡ä»¶"></a>2.2.7.2 èŠ‚ç‚¹2ä¸Šçš„ç¯å¢ƒæ–‡ä»¶</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#èŠ‚ç‚¹2çš„ipæ˜¯172.20.180.165ï¼Œä¸‹é¢REMOTE_IPåº”è¯¥é…ç½®æˆèŠ‚ç‚¹1çš„ipï¼ˆ172.20.180.44ï¼‰</span><br>[root@ztmonitor02 mysql]# vi .mysqlenv<br>MYSQL=/usr/local/mysql/bin/mysql<br>MYSQL_CMD=<span class="hljs-string">&quot;-uroot -p123456&quot;</span><br><span class="hljs-comment">#è¿œç«¯ä¸»æœºçš„IPåœ°å€</span><br>REMOTE_IP=172.20.180.44<br><span class="hljs-built_in">export</span> mysql=<span class="hljs-string">&quot;<span class="hljs-variable">$MYSQL</span> <span class="hljs-variable">$MYSQL_CMD</span> &quot;</span><br></code></pre></td></tr></table></figure><h3 id="2-2-8-æœåŠ¡æ£€æŸ¥è„šæœ¬"><a href="#2-2-8-æœåŠ¡æ£€æŸ¥è„šæœ¬" class="headerlink" title="2.2.8 æœåŠ¡æ£€æŸ¥è„šæœ¬"></a>2.2.8 æœåŠ¡æ£€æŸ¥è„šæœ¬</h3><p>åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šï¼Œä»¥ä¸‹4ä¸ªè„šæœ¬æ–‡ä»¶çš„å†…å®¹æ˜¯ä¸€æ ·çš„ã€‚</p><h4 id="2-2-8-1-æ£€æŸ¥è„šæœ¬mycheck-sh"><a href="#2-2-8-1-æ£€æŸ¥è„šæœ¬mycheck-sh" class="headerlink" title="2.2.8.1 æ£€æŸ¥è„šæœ¬mycheck.sh"></a>2.2.8.1 æ£€æŸ¥è„šæœ¬mycheck.sh</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ztmonitor01 ~]# <span class="hljs-built_in">cat</span> mycheck.sh<br><span class="hljs-comment">#!/bin/bash</span><br><br><span class="hljs-comment">##################################################</span><br><span class="hljs-comment">#File Name  : mycheck.sh</span><br><span class="hljs-comment">#Description: mysql is working MYSQL_OK is 1</span><br><span class="hljs-comment">#             mysql is down MYSQL_OK is 0</span><br><span class="hljs-comment">##################################################</span><br><br>BASEPATH=/data/server/mysql<br>LOGSPATH=<span class="hljs-variable">$BASEPATH</span>/logs<br><span class="hljs-built_in">source</span> <span class="hljs-variable">$BASEPATH</span>/.mysqlenv<br><span class="hljs-keyword">if</span> [ ! -d <span class="hljs-variable">$LOGSPATH</span> ];<span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$LOGSPATH</span><br><span class="hljs-keyword">fi</span><br><br>CHECK_TIME=3<br>MYSQL_OK=1<br><span class="hljs-comment">##################################################################</span><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">check_mysql_helth</span></span> ()&#123;<br>  <span class="hljs-variable">$mysql</span> -e <span class="hljs-string">&quot;show status;&quot;</span> &gt;/dev/null 2&gt;&amp;1<br>  <span class="hljs-keyword">if</span> [ $? == 0 ]<br>  <span class="hljs-keyword">then</span> <br>    MYSQL_OK=1<br>  <span class="hljs-keyword">else</span><br>    MYSQL_OK=0<br>    <span class="hljs-comment">#systemctl status keepalived</span><br>  <span class="hljs-keyword">fi</span><br>  <span class="hljs-built_in">return</span> <span class="hljs-variable">$MYSQL_OK</span><br>&#125;<br><br><span class="hljs-comment">#check_mysql_helth</span><br><span class="hljs-keyword">while</span> [ <span class="hljs-variable">$CHECK_TIME</span> -ne 0 ] <span class="hljs-comment">#ä¸ç­‰äº</span><br><span class="hljs-keyword">do</span><br>  <span class="hljs-built_in">let</span> <span class="hljs-string">&quot;CHECK_TIME -= 1&quot;</span><br>  check_mysql_helth<br>  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$MYSQL_OK</span> = 1 ];<span class="hljs-keyword">then</span><br>    CHECK_TIME=0<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">$(date <span class="hljs-string">&quot;+%Y-%m-%d %H:%M:%S&quot;</span>)</span> The scripts mycheck.sh is running ...&quot;</span> &gt;&gt; <span class="hljs-variable">$LOGSPATH</span>/mysql_switch.log<br>    <span class="hljs-built_in">exit</span> 0<br>  <span class="hljs-keyword">fi</span><br>  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$MYSQL_OK</span> -eq 0 ] &amp;&amp; [ <span class="hljs-variable">$CHECK_TIME</span> -eq 0 ]<br>  <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">$(date <span class="hljs-string">&quot;+%Y-%m-%d %H:%M:%S&quot;</span>)</span> The mycheck.sh, mysql is down, after switch...&quot;</span> &gt;&gt; <span class="hljs-variable">$LOGSPATH</span>/mysql_switch.log<br>    systemctl stop keepalived<br>    <span class="hljs-built_in">exit</span> 1<br>  <span class="hljs-keyword">fi</span><br>  <span class="hljs-built_in">sleep</span> 1<br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><h4 id="2-2-8-2-åˆ‡æ¢è„šæœ¬mymaster-sh"><a href="#2-2-8-2-åˆ‡æ¢è„šæœ¬mymaster-sh" class="headerlink" title="2.2.8.2 åˆ‡æ¢è„šæœ¬mymaster.sh"></a>2.2.8.2 åˆ‡æ¢è„šæœ¬mymaster.sh</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ztmonitor01 ~]# vi mymaster.sh<br><span class="hljs-comment">#!/bin/bash</span><br><br><span class="hljs-comment">##################################################</span><br><span class="hljs-comment">#File Name  : mymaster.sh</span><br><span class="hljs-comment">#Description: First determine whether synchronous</span><br><span class="hljs-comment">#             replication is performed, and if no</span><br><span class="hljs-comment">#             execution is completed, wait for 1</span><br><span class="hljs-comment">#             minutes. Log logs and POS after</span><br><span class="hljs-comment">#             switching, and record files synchronously.</span><br><span class="hljs-comment">##################################################</span><br><br>BASEPATH=/data/server/mysql<br>LOGSPATH=<span class="hljs-variable">$BASEPATH</span>/logs<br><span class="hljs-built_in">source</span> <span class="hljs-variable">$BASEPATH</span>/.mysqlenv<br><span class="hljs-keyword">if</span> [ ! -d <span class="hljs-variable">$LOGSPATH</span> ];<span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">mkdir</span> <span class="hljs-variable">$LOGSPATH</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-variable">$mysql</span> -e <span class="hljs-string">&quot;show slave status\G&quot;</span> &gt; <span class="hljs-variable">$LOGSPATH</span>/mysqlslave.states<br>Master_Log_File=`<span class="hljs-built_in">cat</span> <span class="hljs-variable">$LOGSPATH</span>/mysqlslave.states | grep -w Master_Log_File | awk -F<span class="hljs-string">&quot;: &quot;</span> <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>`<br>Relay_Master_Log_File=`<span class="hljs-built_in">cat</span> <span class="hljs-variable">$LOGSPATH</span>/mysqlslave.states | grep -w Relay_Master_Log_File | awk -F<span class="hljs-string">&quot;: &quot;</span> <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>`<br>Read_Master_Log_Pos=`<span class="hljs-built_in">cat</span> <span class="hljs-variable">$LOGSPATH</span>/mysqlslave.states | grep -w Read_Master_Log_Pos | awk -F<span class="hljs-string">&quot;: &quot;</span> <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>`<br>Exec_Master_Log_Pos=`<span class="hljs-built_in">cat</span> <span class="hljs-variable">$LOGSPATH</span>/mysqlslave.states | grep -w Exec_Master_Log_Pos | awk -F<span class="hljs-string">&quot;: &quot;</span> <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>`<br>i=1<br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">true</span><br><span class="hljs-keyword">do</span><br>  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$Master_Log_File</span> = <span class="hljs-variable">$Relay_Master_Log_File</span> ] &amp;&amp; [ <span class="hljs-variable">$Read_Master_Log_Pos</span> -eq <span class="hljs-variable">$Exec_Master_Log_Pos</span> ];<span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">$(date <span class="hljs-string">&quot;+%Y-%m-%d %H:%M:%S&quot;</span>)</span> The mymaster.sh, slave sync ok... &quot;</span> &gt;&gt; <span class="hljs-variable">$LOGSPATH</span>/mysql_switch.log<br>    <span class="hljs-built_in">break</span><br>  <span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">sleep</span> 1<br>    <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$i</span> -gt 60 ];<span class="hljs-keyword">then</span><br>      <span class="hljs-built_in">break</span><br>    <span class="hljs-keyword">fi</span><br>    <span class="hljs-built_in">continue</span><br>    <span class="hljs-built_in">let</span> i++<br>  <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">done</span><br><br><span class="hljs-comment">#$mysql -e &quot;stop slave;&quot;</span><br><span class="hljs-variable">$mysql</span> -e <span class="hljs-string">&quot;set global innodb_support_xa=0;&quot;</span><br><span class="hljs-variable">$mysql</span> -e <span class="hljs-string">&quot;set global sync_binlog=0;&quot;</span><br><span class="hljs-variable">$mysql</span> -e <span class="hljs-string">&quot;set global innodb_flush_log_at_trx_commit=0;&quot;</span><br><span class="hljs-variable">$mysql</span> -e <span class="hljs-string">&quot;flush logs;GRANT ALL PRIVILEGES ON *.* TO &#x27;replication&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;replication&#x27;;flush privileges;&quot;</span><br>timestr=`<span class="hljs-built_in">date</span> <span class="hljs-string">&quot;+%y%m%d-%H%M&quot;</span>`<br><span class="hljs-variable">$mysql</span> -e <span class="hljs-string">&quot;show master status;&quot;</span> &gt; <span class="hljs-variable">$LOGSPATH</span>/master_status_<span class="hljs-variable">$&#123;timestr&#125;</span>.txt<br><br><span class="hljs-comment"># sync pos file</span><br>ssh -t root@<span class="hljs-variable">$REMOTE_IP</span> <span class="hljs-string">&quot;if [ ! -d <span class="hljs-variable">$BASEPATH</span>/syncposfile ];then mkdir -p <span class="hljs-variable">$BASEPATH</span>/syncposfile; fi&quot;</span> &gt;&gt; /dev/null<br>/usr/bin/scp <span class="hljs-variable">$LOGSPATH</span>/master_status_<span class="hljs-variable">$&#123;timestr&#125;</span>.txt root@<span class="hljs-variable">$REMOTE_IP</span>:<span class="hljs-variable">$BASEPATH</span>/syncposfile/backup_master.status<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">$(date <span class="hljs-string">&quot;+%Y-%m-%d %H:%M:%S&quot;</span>)</span> The mymaster.sh, Sync pos file sucess.&quot;</span> &gt;&gt; <span class="hljs-variable">$LOGSPATH</span>/mysql_switch.log<br></code></pre></td></tr></table></figure><h4 id="2-2-8-3-å›åˆ‡è„šæœ¬mybackup-sh"><a href="#2-2-8-3-å›åˆ‡è„šæœ¬mybackup-sh" class="headerlink" title="2.2.8.3 å›åˆ‡è„šæœ¬mybackup.sh"></a>2.2.8.3 å›åˆ‡è„šæœ¬mybackup.sh</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ztmonitor01 ~]# vi mybackup.sh<br><span class="hljs-comment">#!/bin/bash</span><br><br><span class="hljs-comment">##################################################</span><br><span class="hljs-comment">#File Name  : mybackup.sh</span><br><span class="hljs-comment">#Description: Empty the slave configuration, retrieve</span><br><span class="hljs-comment">#             the remote log file and Pos, and open</span><br><span class="hljs-comment">#             the synchronization</span><br><span class="hljs-comment">##################################################</span><br><br>BASEPATH=/data/server/mysql<br>LOGSPATH=<span class="hljs-variable">$BASEPATH</span>/logs<br><span class="hljs-built_in">source</span> <span class="hljs-variable">$BASEPATH</span>/.mysqlenv<br><span class="hljs-keyword">if</span> [ ! -d <span class="hljs-variable">$LOGSPATH</span> ];<span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">mkdir</span> <span class="hljs-variable">$LOGSPATH</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-variable">$mysql</span> -e <span class="hljs-string">&quot;GRANT ALL PRIVILEGES ON *.* TO &#x27;replication&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;replication&#x27;;flush privileges;&quot;</span><br><span class="hljs-variable">$mysql</span> -e <span class="hljs-string">&quot;set global innodb_support_xa=0;&quot;</span><br><span class="hljs-variable">$mysql</span> -e <span class="hljs-string">&quot;set global sync_binlog=0;&quot;</span><br><span class="hljs-variable">$mysql</span> -e <span class="hljs-string">&quot;set global innodb_flush_log_at_trx_commit=0;&quot;</span><br><span class="hljs-variable">$mysql</span> -e <span class="hljs-string">&quot;flush logs;&quot;</span><br><span class="hljs-variable">$mysql</span> -e <span class="hljs-string">&quot;reset slave all;&quot;</span><br><br><span class="hljs-keyword">if</span> [ -f <span class="hljs-variable">$BASEPATH</span>/syncposfile/backup_master.status ];<span class="hljs-keyword">then</span><br>  New_ReM_File=`<span class="hljs-built_in">cat</span> <span class="hljs-variable">$BASEPATH</span>/syncposfile/backup_master.status | grep -v File |awk <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span>`<br>  New_ReM_Position=`<span class="hljs-built_in">cat</span> <span class="hljs-variable">$BASEPATH</span>/syncposfile/backup_master.status | grep -v File |awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>`<br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">$(date <span class="hljs-string">&quot;+%Y-%m-%d %H:%M:%S&quot;</span>)</span> This mybackup.sh, New_ReM_File:<span class="hljs-variable">$New_ReM_File</span>,New_ReM_Position:<span class="hljs-variable">$New_ReM_Position</span>&quot;</span> &gt;&gt; <span class="hljs-variable">$LOGSPATH</span>/mysql_switch.log<br>  <span class="hljs-variable">$mysql</span> -e <span class="hljs-string">&quot;change master to master_host=&#x27;<span class="hljs-variable">$REMOTE_IP</span>&#x27;,master_port=3306,master_user=&#x27;replication&#x27;,master_password=&#x27;replication&#x27;,master_log_file=&#x27;<span class="hljs-variable">$New_ReM_File</span>&#x27;,master_log_pos=<span class="hljs-variable">$New_ReM_Position</span>;&quot;</span><br>  <span class="hljs-variable">$mysql</span> -e <span class="hljs-string">&quot;start slave;&quot;</span><br>  timestr=`<span class="hljs-built_in">date</span> <span class="hljs-string">&quot;+%y%m%d-%H%M&quot;</span>`<br>  <span class="hljs-variable">$mysql</span> -e <span class="hljs-string">&quot;show slave status\G;&quot;</span> &gt; <span class="hljs-variable">$LOGSPATH</span>/slave_status_<span class="hljs-variable">$&#123;timestr&#125;</span>.txt<br>  <span class="hljs-built_in">cat</span> <span class="hljs-variable">$LOGSPATH</span>/slave_status_<span class="hljs-variable">$&#123;timestr&#125;</span>.txt &gt;&gt; <span class="hljs-variable">$LOGSPATH</span>/mysql_switch.log<br>  <span class="hljs-built_in">rm</span> -f <span class="hljs-variable">$BASEPATH</span>/syncposfile/backup_master.status<br><br>  timestr=`<span class="hljs-built_in">date</span> <span class="hljs-string">&quot;+%y%m%d-%H%M&quot;</span>`<br>  <span class="hljs-variable">$mysql</span> -e <span class="hljs-string">&quot;show master status;&quot;</span> &gt; <span class="hljs-variable">$LOGSPATH</span>/master_status_<span class="hljs-variable">$&#123;timestr&#125;</span>.txt<br>  <span class="hljs-comment"># sync pos file to master node</span><br>  ssh -t root@<span class="hljs-variable">$REMOTE_IP</span> <span class="hljs-string">&quot;if [ ! -d <span class="hljs-variable">$BASEPATH</span>/syncposfile ];then mkdir -p <span class="hljs-variable">$BASEPATH</span>/syncposfile; fi&quot;</span> &gt;&gt; /dev/null<br>  /usr/bin/scp <span class="hljs-variable">$LOGSPATH</span>/master_status_<span class="hljs-variable">$&#123;timestr&#125;</span>.txt root@<span class="hljs-variable">$REMOTE_IP</span>:<span class="hljs-variable">$BASEPATH</span>/syncposfile/backup_master.status<br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">$(date <span class="hljs-string">&quot;+%Y-%m-%d %H:%M:%S&quot;</span>)</span> The scripts mybackup.sh running error...&quot;</span> &gt;&gt; <span class="hljs-variable">$LOGSPATH</span>/mysql_switch.log<br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><h4 id="2-2-8-4-åœæ­¢è„šæœ¬mystop-sh"><a href="#2-2-8-4-åœæ­¢è„šæœ¬mystop-sh" class="headerlink" title="2.2.8.4 åœæ­¢è„šæœ¬mystop.sh"></a>2.2.8.4 åœæ­¢è„šæœ¬mystop.sh</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ztmonitor01 ~]# vi mystop.sh<br><span class="hljs-comment">#!/bin/bash</span><br><br><span class="hljs-comment">##################################################</span><br><span class="hljs-comment">#File Name  : mystop.sh</span><br><span class="hljs-comment">#Description: Set parameters to ensure that the data</span><br><span class="hljs-comment">#             is not lost, and finally check to see</span><br><span class="hljs-comment">#             if there are still write operations,</span><br><span class="hljs-comment">#             the last 1 minutes to exit</span><br><br><span class="hljs-comment">##################################################</span><br><br>BASEPATH=/data/server/mysql<br>LOGSPATH=<span class="hljs-variable">$BASEPATH</span>/logs<br><span class="hljs-built_in">source</span> <span class="hljs-variable">$BASEPATH</span>/.mysqlenv<br><span class="hljs-keyword">if</span> [ ! -d <span class="hljs-variable">$LOGSPATH</span> ];<span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">mkdir</span> <span class="hljs-variable">$LOGSPATH</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-variable">$mysql</span> -e <span class="hljs-string">&quot;GRANT ALL PRIVILEGES ON *.* TO &#x27;replication&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;replication&#x27;;flush privileges;&quot;</span><br><span class="hljs-variable">$mysql</span> -e <span class="hljs-string">&quot;set global innodb_support_xa=1;&quot;</span><br><span class="hljs-variable">$mysql</span> -e <span class="hljs-string">&quot;set global sync_binlog=1;&quot;</span><br><span class="hljs-variable">$mysql</span> -e <span class="hljs-string">&quot;set global innodb_flush_log_at_trx_commit=1;&quot;</span><br><span class="hljs-variable">$mysql</span> -e <span class="hljs-string">&quot;show master status\G&quot;</span> &gt; <span class="hljs-variable">$LOGSPATH</span>/mysqlmaster0.states<br>M_File1=`<span class="hljs-built_in">cat</span> <span class="hljs-variable">$LOGSPATH</span>/mysqlmaster0.states | awk -F<span class="hljs-string">&#x27;: &#x27;</span> <span class="hljs-string">&#x27;/File/&#123;print $2&#125;&#x27;</span>`<br>M_Position1=`<span class="hljs-built_in">cat</span> <span class="hljs-variable">$LOGSPATH</span>/mysqlmaster0.states | awk -F<span class="hljs-string">&#x27;: &#x27;</span> <span class="hljs-string">&#x27;/Position/&#123;print $2&#125;&#x27;</span>`<br><span class="hljs-built_in">sleep</span> 2<br><span class="hljs-variable">$mysql</span> -e <span class="hljs-string">&quot;show master status\G&quot;</span> &gt; <span class="hljs-variable">$LOGSPATH</span>/mysqlmaster1.states<br>M_File2=`<span class="hljs-built_in">cat</span> <span class="hljs-variable">$LOGSPATH</span>/mysqlmaster1.states | awk -F<span class="hljs-string">&#x27;: &#x27;</span> <span class="hljs-string">&#x27;/File/&#123;print $2&#125;&#x27;</span>`<br>M_Position2=`<span class="hljs-built_in">cat</span> <span class="hljs-variable">$LOGSPATH</span>/mysqlmaster1.states | awk -F<span class="hljs-string">&#x27;: &#x27;</span> <span class="hljs-string">&#x27;/Position/&#123;print $2&#125;&#x27;</span>`<br><br>i=1<br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">true</span><br><span class="hljs-keyword">do</span><br>  <span class="hljs-keyword">if</span> [ <span class="hljs-variable">$M_File1</span> = <span class="hljs-variable">$M_File2</span> ] &amp;&amp; [ <span class="hljs-variable">$M_Position1</span> -eq <span class="hljs-variable">$M_Position2</span> ];<span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">$(date <span class="hljs-string">&quot;+%Y-%m-%d %H:%M:%S&quot;</span>)</span> The mystop.sh, master sync ok..&quot;</span> &gt;&gt; <span class="hljs-variable">$LOGSPATH</span>/mysql_switch.log<br>    <span class="hljs-built_in">exit</span> 0<br>  <span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">sleep</span> 1<br>    <span class="hljs-keyword">if</span> [<span class="hljs-variable">$i</span> -gt 60 ];<span class="hljs-keyword">then</span><br>      <span class="hljs-built_in">break</span><br>    <span class="hljs-keyword">fi</span><br>    <span class="hljs-built_in">continue</span><br>    <span class="hljs-built_in">let</span> i++<br>  <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">done</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">$(date <span class="hljs-string">&quot;+%Y-%m-%d %H:%M:%S&quot;</span>)</span> The mystop.sh, master sync exceed one minutes...&quot;</span> &gt;&gt; <span class="hljs-variable">$LOGSPATH</span>/mysql_switch.log<br></code></pre></td></tr></table></figure><h3 id="2-2-9-ç»™æœåŠ¡æ£€æŸ¥è„šæœ¬èµ‹äºˆæ‰§è¡Œæƒé™"><a href="#2-2-9-ç»™æœåŠ¡æ£€æŸ¥è„šæœ¬èµ‹äºˆæ‰§è¡Œæƒé™" class="headerlink" title="2.2.9 ç»™æœåŠ¡æ£€æŸ¥è„šæœ¬èµ‹äºˆæ‰§è¡Œæƒé™"></a>2.2.9 ç»™æœåŠ¡æ£€æŸ¥è„šæœ¬èµ‹äºˆæ‰§è¡Œæƒé™</h3><p>åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šéƒ½è¦æ‰§è¡Œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /data/server/mysql <br><span class="hljs-built_in">chmod</span> a+x my*.sh<br><span class="hljs-built_in">chmod</span> a+x .mysqlenv<br></code></pre></td></tr></table></figure><h2 id="2-3-å®‰è£…ä¸é…ç½®keepalived"><a href="#2-3-å®‰è£…ä¸é…ç½®keepalived" class="headerlink" title="2.3 å®‰è£…ä¸é…ç½®keepalived"></a>2.3 å®‰è£…ä¸é…ç½®keepalived</h2><h3 id="2-3-1-å®‰è£…keepalived"><a href="#2-3-1-å®‰è£…keepalived" class="headerlink" title="2.3.1 å®‰è£…keepalived"></a>2.3.1 å®‰è£…keepalived</h3><p>ä»¥ä¸‹æ“ä½œåœ¨ä¸¤ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦æ‰§è¡Œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#å®‰è£…gccã€OpenSSL</span><br>yum install -y gcc-c++ openssl openssl-devel<br><br><span class="hljs-comment">#äºŒè¿›åˆ¶å®‰è£…æ–‡ä»¶å®‰è£…keepalived</span><br><span class="hljs-built_in">cd</span> /data/softs/<br>wget http://www.keepalived.org/software/keepalived-2.0.7.tar.gz<br>tar -zxf keepalived-2.0.7.tar.gz<br><span class="hljs-built_in">cd</span> keepalived-2.0.7<br>./configure --bindir=/usr/bin --sbindir=/usr/sbin --sysconfdir=/etc --mandir=/usr/share<br>make &amp;&amp; make install<br></code></pre></td></tr></table></figure><h3 id="2-3-2-OpenStackä¸­å…³äºvipçš„é…ç½®"><a href="#2-3-2-OpenStackä¸­å…³äºvipçš„é…ç½®" class="headerlink" title="2.3.2 OpenStackä¸­å…³äºvipçš„é…ç½®"></a>2.3.2 OpenStackä¸­å…³äºvipçš„é…ç½®</h3><h4 id="2-3-2-1-åˆ›å»ºè™šæ‹ŸIP"><a href="#2-3-2-1-åˆ›å»ºè™šæ‹ŸIP" class="headerlink" title="2.3.2.1 åˆ›å»ºè™šæ‹ŸIP"></a>2.3.2.1 åˆ›å»ºè™šæ‹ŸIP<img src="https://s2.loli.net/2024/08/11/xDYUWpLQ4N8cwAH.png" alt="image-20240811114458647"></h4><h4 id="2-3-2-2-è™šæ‹Ÿæœºå¯ç”¨VIP"><a href="#2-3-2-2-è™šæ‹Ÿæœºå¯ç”¨VIP" class="headerlink" title="2.3.2.2 è™šæ‹Ÿæœºå¯ç”¨VIP"></a>2.3.2.2 è™šæ‹Ÿæœºå¯ç”¨VIP</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#åœ¨OpenStackä¸­æ‰§è¡Œ</span><br>root@control01:~# openstack port list | egrep <span class="hljs-string">&quot;172.20.180.44|172.20.180.165&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/08/11/AV7Js98Zu5Wg3qz.png" alt="image-20240811114754762"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@control01:~# neutron port-update 90b6b1c7-4c4d-42fc-a1f9-3fd814711551 --allowed_address_pairs list=<span class="hljs-literal">true</span> <span class="hljs-built_in">type</span>=dict ip_address=172.20.180.43<br>root@control01:~# neutron port-update 926ca68d-ef07-4243-bc02-f2600c3a68ff --allowed_address_pairs list=<span class="hljs-literal">true</span> <span class="hljs-built_in">type</span>=dict ip_address=172.20.180.43<br></code></pre></td></tr></table></figure><h4 id="2-3-2-3-å®‰å…¨ç»„å…è®¸VRRPåè®®"><a href="#2-3-2-3-å®‰å…¨ç»„å…è®¸VRRPåè®®" class="headerlink" title="2.3.2.3 å®‰å…¨ç»„å…è®¸VRRPåè®®"></a>2.3.2.3 å®‰å…¨ç»„å…è®¸VRRPåè®®</h4><p>ç›´æ¥åœ¨OpenStackçš„horizonç»„ä»¶çš„dashboradç•Œé¢ä¸­æ“ä½œï¼šé¡¹ç›®-&gt;ç½‘ç»œ-&gt;å®‰å…¨ç»„ï¼Œç¡®å®šä¸Šè¿°ä¸¤ä¸ªèŠ‚ç‚¹å¯¹åº”è™šæ‹Ÿæœºæ‰€ä½¿ç”¨çš„å®‰å…¨ç»„ï¼Œç„¶åç‚¹å‡»åé¢çš„â€ç®¡ç†è§„åˆ™â€œæŒ‰é’®è¿›å…¥è§„åˆ™åˆ—è¡¨ï¼›ç‚¹å‡»â€æ·»åŠ è§„åˆ™â€œæŒ‰é’®ï¼Œå¼¹å‡ºçª—å£ä¸­ï¼Œåœ¨è§„åˆ™çš„ä¸‹æ‹‰é€‰é‡Œé€‰æ‹©â€å…¶ä»–åè®®â€œï¼Œç„¶ååœ¨ â€œIPåè®®â€ æ–‡æœ¬æ¡†è¾“å…¥â€112â€œï¼Œæœ€åç‚¹å‡»æ·»åŠ æŒ‰é’®å³å¯ï¼ˆå…¶ä½™æœªè¯´æ˜çš„ä¿æŒé»˜è®¤è®¾ç½®ï¼›VRRPåè®®çš„ç¼–å·æ˜¯112ï¼‰</p><p><img src="https://s2.loli.net/2024/08/11/3PZ6ASdhBVtivwJ.png" alt="image-20240811115636444"></p><h3 id="2-3-3-é…ç½®keepalived"><a href="#2-3-3-é…ç½®keepalived" class="headerlink" title="2.3.3 é…ç½®keepalived"></a>2.3.3 é…ç½®keepalived</h3><p>Keepalivedå¯å®ç°å°†è™šæ‹ŸIPåœ°å€åœ¨å®ä½“ç‰©ç†æœºä¸Šæ¥å›æ¼‚ç§»ã€‚Keepalivedåœ¨è½¬æ¢çŠ¶æ€æ—¶ä¼šä¾ç…§çŠ¶æ€æ¥å‘¼å«é…ç½®æ–‡ä»¶ä¸­å†…ç½®çš„å®šä¹‰ã€‚</p><ul><li>å½“è¿›å…¥MasterçŠ¶æ€æ—¶ä¼šå‘¼å«notify_masterå®šä¹‰çš„è„šæœ¬ã€‚</li><li>å½“è¿›å…¥BackupçŠ¶æ€æ—¶ä¼šå‘¼å«notify_backupå®šä¹‰çš„è„šæœ¬ã€‚</li><li>å½“keepalivedç¨‹åºç»ˆæ­¢æ—¶å‘¼å«notify_stopå®šä¹‰çš„è„šæœ¬ã€‚</li><li>å½“å‘ç°å¼‚å¸¸æƒ…å†µæ—¶è¿›å…¥FaultçŠ¶æ€å‘¼å«notify_faultå®šä¹‰çš„è„šæœ¬ã€‚</li></ul><p>åˆ‡æ¢çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>åœ¨Masterä¸»æœºä¸Škeepalivedè¿è¡Œæ—¶æ‰§è¡Œmycheck.shè„šæœ¬ä¸åœçš„æ£€æŸ¥mysqlçš„è¿è¡ŒçŠ¶æ€ï¼Œå½“å‘ç°mysqlåœæ­¢åå°†keepalivedè¿›ç¨‹æ€æ‰ã€‚</li><li>æ­¤æ—¶Slaveä¸»æœºä¸Šä¼šæ¥ç®¡è™šæ‹ŸIPåœ°å€ï¼Œå¹¶è°ƒç”¨notify_masterå®šä¹‰çš„è„šæœ¬</li><li>å½“åŸMasterä¸»æœºä¸Šçš„mysqlå’Œkeepalivedè¿›ç¨‹æ¢å¤æ­£å¸¸åï¼Œä¼šè°ƒç”¨notify_backupå®šä¹‰çš„è„šæœ¬ï¼Œæ­¤æ—¶æ•°æ®åº“çš„ä¸»ç«¯è¿˜åœ¨Savleä¸»æœºä¸Šã€‚</li><li>å›åˆ‡ï¼Œå…³é—­Slaveç«¯çš„keepavliedè¿›ç¨‹ï¼Œä¼šè°ƒç”¨notify_stopè„šæœ¬ï¼ŒåŒæ—¶Masterä¸»æœºä¸Šä¼šè°ƒç”¨notify_masterå®šä¹‰çš„è„šæœ¬ã€‚æ­¤æ—¶æ•°æ®åº“çš„ä¸»ç«¯åœ¨Masterä¸»æœºä¸Š</li><li>å¯åŠ¨Slaveç«¯çš„keepavliedè¿›ç¨‹ï¼Œä¼šè°ƒç”¨notify_backupè„šæœ¬ï¼Œæ­¤æ—¶å®Œæˆæ•°æ®åŒæ­¥ã€‚</li></ol><p><strong>å¦‚æœæŒ‰ç…§å¦‚ä¸‹æœåŠ¡å™¨é¡ºåºå¯åŠ¨keepalivedæœåŠ¡ï¼Œåˆ™èŠ‚ç‚¹1ä¸Šçš„æ•°æ®åº“å®ä¾‹æ˜¯MySQLé›†ç¾¤ä¸­çš„ä¸»åº“ï¼ŒèŠ‚ç‚¹2çš„åˆ™æ˜¯å¤‡åº“ï¼Œï¼š</strong></p><p><strong>ztmonitor01-&gt;ztmonitor02</strong></p><h4 id="2-3-3-1-èŠ‚ç‚¹1ä¸Šçš„keepalivedé…ç½®"><a href="#2-3-3-1-èŠ‚ç‚¹1ä¸Šçš„keepalivedé…ç½®" class="headerlink" title="2.3.3.1 èŠ‚ç‚¹1ä¸Šçš„keepalivedé…ç½®"></a>2.3.3.1 èŠ‚ç‚¹1ä¸Šçš„keepalivedé…ç½®</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ztmonitor01 ~]# vi /etc/keepalived/keepalived.conf<br>[root@ztmonitor01 ~]# <span class="hljs-built_in">cat</span> /etc/keepalived/keepalived.conf<br>! Configuration File <span class="hljs-keyword">for</span> keepalived, 172.20.180.44 - keepalived.conf - master default<br>global_defs &#123;<br>  router_id LVS_DEVEL<br>  vrrp_skip_check_adv_addr<br>  script_user root<br>  enable_script_security<br>&#125;<br><br>vrrp_script check_mysql &#123;<br>  script <span class="hljs-string">&quot;/data/server/mysql/mycheck.sh&quot;</span><br>  interval 10<br>  weight 2<br>&#125;<br><br>vrrp_script chk_state_down &#123;<br>  script <span class="hljs-string">&quot;/etc/keepalived/scripts/chk_state_down.sh&quot;</span><br>  interval 2<br>  weight 3<br>&#125;<br><br>vrrp_instance VI_1 &#123;<br>  state BACKUP         <span class="hljs-comment">#éƒ½è®¾ç½®ä¸ºBACKUPï¼Œé¦–å…ˆå¯åŠ¨çš„ä½œä¸ºMaster</span><br>  nopreempt            <span class="hljs-comment"># éæŠ¢å æ¨¡å¼</span><br>  interface eth0 <br>  virtual_router_id 123   <span class="hljs-comment">#æ‰€æœ‰èŠ‚ç‚¹çš„æ­¤å€¼æ˜¯ä¸€æ ·çš„ï¼Œè¡¨ç¤ºæ˜¯åŒä¸€keepalivedé›†ç¾¤</span><br>  priority 120          <span class="hljs-comment">#ä¸¤ä¸ªæœåŠ¡å™¨çš„ä¼˜å…ˆçº§ä¸€æ ·é«˜ï¼Œéƒ½æ˜¯120</span><br>  advert_int 1<br><br>  track_interface &#123;<br>    eth0 <br>  &#125;<br><br>  unicast_src_ip 172.20.180.44<br><br>  unicast_peer&#123;<br>    172.20.180.165<br>  &#125;<br><br>  authentication &#123;<br>    auth_type PASS<br>    auth_pass 1111<br>  &#125;<br>  track_script &#123;<br>    check_mysql<br>    chk_state_down<br>  &#125;<br>  notify_master /data/server/mysql/mymaster.sh<br>  notify_backup /data/server/mysql/mybackup.sh<br>  notify_stop /data/server/mysql/mystop.sh<br><br>  virtual_ipaddress &#123;<br>    172.20.180.43/24<br>  &#125;<br>&#125;<br><br>[root@ztmonitor01 ~]# <span class="hljs-built_in">mkdir</span> -p /etc/keepalived/scripts/<br>[root@ztmonitor01 ~]# <span class="hljs-built_in">cat</span> /etc/keepalived/scripts/chk_state_down.sh<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-keyword">if</span> [ -f /etc/keepalived/down ];<span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">exit</span> 1<br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br>[root@ztmonitor01 ~]# <span class="hljs-built_in">chmod</span> a+x /etc/keepalived/scripts/chk_state_down.sh<br><br><span class="hljs-comment">#åœ¨å¦‚ä¸‹æ–‡ä»¶ä¸­å¦‚ä¸‹ä½ç½®æ·»åŠ â€œ--log-file=/tmp/keepalived.logâ€ï¼Œè®¾ç½®å…¶æ—¥å¿—è¾“å‡ºä½ç½®</span><br>[root@ztmonitor01 ~]# vi /usr/lib/systemd/system/keepalived.service<br>[Unit]<br>Description=LVS and VRRP High Availability Monitor<br>After= network-online.target syslog.target<br>Wants=network-online.target<br><br>[Service]<br>Type=forking<br>PIDFile=/var/run/keepalived.pid<br>KillMode=process<br>EnvironmentFile=-/etc/sysconfig/keepalived<br>ExecStart=/usr/sbin/keepalived --log-file=/tmp/keepalived.log <span class="hljs-variable">$KEEPALIVED_OPTIONS</span><br>ExecReload=/bin/kill -HUP <span class="hljs-variable">$MAINPID</span><br><br>[Install]<br>WantedBy=multi-user.target<br><br><br><span class="hljs-comment">#å¯åŠ¨keepalivedæœåŠ¡å¹¶è®¾ç½®ä¸ºå¼€æœºè‡ªåŠ¨å¯åŠ¨</span><br>[root@ztmonitor01 ~]# systemctl daemon-reload<br>[root@ztmonitor01 ~]# systemctl start keepalived<br>[root@ztmonitor01 ~]# systemctl <span class="hljs-built_in">enable</span> keepalived<br>[root@ztmonitor01 ~]# systemctl status keepalived<br></code></pre></td></tr></table></figure><h4 id="2-3-3-2-èŠ‚ç‚¹2ä¸Šçš„keepalivedé…ç½®"><a href="#2-3-3-2-èŠ‚ç‚¹2ä¸Šçš„keepalivedé…ç½®" class="headerlink" title="2.3.3.2 èŠ‚ç‚¹2ä¸Šçš„keepalivedé…ç½®"></a>2.3.3.2 èŠ‚ç‚¹2ä¸Šçš„keepalivedé…ç½®</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ztmonitor02 ~]# vi /etc/keepalived/keepalived.conf<br>[root@ztmonitor02 ~]# <span class="hljs-built_in">cat</span> /etc/keepalived/keepalived.conf<br>! Configuration File <span class="hljs-keyword">for</span> keepalived, 172.20.180.165 - keepalived.conf - master default<br>global_defs &#123;<br>  router_id LVS_DEVEL<br>  vrrp_skip_check_adv_addr<br>  script_user root<br>  enable_script_security<br>&#125;<br><br>vrrp_script check_mysql &#123;<br>  script <span class="hljs-string">&quot;/data/server/mysql/mycheck.sh&quot;</span><br>  interval 10<br>  weight 2<br>&#125;<br><br>vrrp_script chk_state_down &#123;<br>  script <span class="hljs-string">&quot;/etc/keepalived/scripts/chk_state_down.sh&quot;</span><br>  interval 2<br>  weight 3<br>&#125;<br><br>vrrp_instance VI_1 &#123;<br>  state BACKUP         <span class="hljs-comment">#éƒ½è®¾ç½®ä¸ºBACKUPï¼Œé¦–å…ˆå¯åŠ¨çš„ä½œä¸ºMaster</span><br>  nopreempt            <span class="hljs-comment"># éæŠ¢å æ¨¡å¼</span><br>  interface eth0 <br>  virtual_router_id 123<br>  priority 120<br>  advert_int 1<br><br>  track_interface &#123;<br>    eth0 <br>  &#125;<br><br>  unicast_src_ip 172.20.180.165<br><br>  unicast_peer&#123;<br>    172.20.180.44<br>  &#125;<br><br>  authentication &#123;<br>    auth_type PASS<br>    auth_pass 1111<br>  &#125;<br>  track_script &#123;<br>    check_mysql<br>    chk_state_down<br>  &#125;<br>  notify_master /data/server/mysql/mymaster.sh<br>  notify_backup /data/server/mysql/mybackup.sh<br>  notify_stop /data/server/mysql/mystop.sh<br><br>  virtual_ipaddress &#123;<br>    172.20.180.43/24<br>  &#125;<br>&#125;<br><br>[root@ztmonitor02 ~]# <span class="hljs-built_in">mkdir</span> -p /etc/keepalived/scripts/<br>[root@ztmonitor01 ~]# <span class="hljs-built_in">cat</span> /etc/keepalived/scripts/chk_state_down.sh<br><span class="hljs-comment">#!/bin/bash</span><br><br><span class="hljs-keyword">if</span> [ -f /etc/keepalived/down ];<span class="hljs-keyword">then</span><br>  <span class="hljs-built_in">exit</span> 1 <br><span class="hljs-keyword">else</span><br>  <span class="hljs-built_in">exit</span> 0<br><span class="hljs-keyword">fi</span><br>[root@ztmonitor01 ~]# <span class="hljs-built_in">chmod</span> a+x /etc/keepalived/scripts/chk_state_down.sh<br><br><span class="hljs-comment">#åœ¨å¦‚ä¸‹æ–‡ä»¶ä¸­å¦‚ä¸‹ä½ç½®æ·»åŠ â€œ--log-file=/tmp/keepalived.logâ€</span><br>[root@ztmonitor02 ~]# vi /usr/lib/systemd/system/keepalived.service<br>[Unit]<br>Description=LVS and VRRP High Availability Monitor<br>After= network-online.target syslog.target<br>Wants=network-online.target<br><br>[Service]<br>Type=forking<br>PIDFile=/var/run/keepalived.pid<br>KillMode=process<br>EnvironmentFile=-/etc/sysconfig/keepalived<br>ExecStart=/usr/sbin/keepalived --log-file=/tmp/keepalived.log <span class="hljs-variable">$KEEPALIVED_OPTIONS</span><br>ExecReload=/bin/kill -HUP <span class="hljs-variable">$MAINPID</span><br><br>[Install]<br>WantedBy=multi-user.target<br><br><br><span class="hljs-comment">#å¯åŠ¨keepalivedæœåŠ¡å¹¶è®¾ç½®ä¸ºå¼€æœºè‡ªåŠ¨å¯åŠ¨</span><br>[root@ztmonitor02 ~]# systemctl daemon-reload<br>[root@ztmonitor02 ~]# systemctl start keepalived<br>[root@ztmonitor02 ~]# systemctl <span class="hljs-built_in">enable</span> keepalived<br>[root@ztmonitor02 ~]# systemctl status keepalived<br></code></pre></td></tr></table></figure><h3 id="2-3-4-éªŒè¯keepalivedé…ç½®æ˜¯å¦ç”Ÿæ•ˆ"><a href="#2-3-4-éªŒè¯keepalivedé…ç½®æ˜¯å¦ç”Ÿæ•ˆ" class="headerlink" title="2.3.4 éªŒè¯keepalivedé…ç½®æ˜¯å¦ç”Ÿæ•ˆ"></a>2.3.4 éªŒè¯keepalivedé…ç½®æ˜¯å¦ç”Ÿæ•ˆ</h3><h4 id="2-3-4-1-æŸ¥çœ‹keepalivedé›†ç¾¤çš„masterèŠ‚ç‚¹"><a href="#2-3-4-1-æŸ¥çœ‹keepalivedé›†ç¾¤çš„masterèŠ‚ç‚¹" class="headerlink" title="2.3.4.1 æŸ¥çœ‹keepalivedé›†ç¾¤çš„masterèŠ‚ç‚¹"></a>2.3.4.1 æŸ¥çœ‹keepalivedé›†ç¾¤çš„masterèŠ‚ç‚¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#åœ¨èŠ‚ç‚¹1ä¸Šï¼ŒkeepalivedæœåŠ¡å¤„äºæ­£å¸¸è¿è¡ŒçŠ¶æ€ã€ä¸”eth0ç½‘å£ä¸Šé™¤äº†é…ç½®äº†172.20.180.44å¤–è¿˜ç»‘å®šäº†keepalivedçš„vip</span><br>[root@ztmonitor01 ~]# systemctl status keepalived<br>[root@ztmonitor01 ~]# ip a | more<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/08/11/aOj3xUAGiDgdbYB.png" alt="image-20240811155008229"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#åœ¨èŠ‚ç‚¹2ä¸Šï¼ŒkeepalivedæœåŠ¡ä¹Ÿå¤„äºæ­£å¸¸è¿è¡ŒçŠ¶æ€ï¼Œä½†eth0ç½‘å£ä¸Šåªé…ç½®äº†172.20.180.164è¿™ä¸ªip</span><br>[root@ztmonitor02 ~]# systemctl status keepalived<br>[root@ztmonitor02 ~]# ip a | more<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/08/11/6JCaH2nQF5rEVXO.png" alt="image-20240811155432743"></p><h4 id="2-3-4-2-é€šè¿‡keepalivedçš„vipè¿æ¥MySQL"><a href="#2-3-4-2-é€šè¿‡keepalivedçš„vipè¿æ¥MySQL" class="headerlink" title="2.3.4.2 é€šè¿‡keepalivedçš„vipè¿æ¥MySQL"></a>2.3.4.2 é€šè¿‡keepalivedçš„vipè¿æ¥MySQL</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#é€šè¿‡èŠ‚ç‚¹1ã€èŠ‚ç‚¹2å¤–çš„å¦å¤–ä¸€ä¸ªæœåŠ¡å™¨ï¼ˆæ“ä½œç³»ç»Ÿipï¼š172.24.0.31ï¼‰ç»ç”±keepalivedçš„vipè¿æ¥MySQLé›†ç¾¤</span><br>root@controller01:~# ifconfig bond0.2048<br>root@controller01:~# mysql -h172.20.180.43 -uroot -p123456<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/08/11/d1eRjcLsXNpaEtH.png" alt="image-20240811160425430"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#ç„¶ååœ¨èŠ‚ç‚¹1ä¸Šçš„æ•°æ®åº“å®ä¾‹ä¸­ï¼ŒæŸ¥çœ‹æ­¤æ•°æ®åº“å®ä¾‹ä¸­ç°æœ‰çš„æ‰€æœ‰è¿›ç¨‹ï¼ˆä¸‹å›¾å°†ä¸€äº›å…¶ä»–è·Ÿæ­¤éªŒè¯æ— å…³çš„è¿›ç¨‹é©¬èµ›å…‹å¤„ç†äº†ï¼‰ã€‚å…¶ä¸­å‘ç°å­˜åœ¨ä¸€ä¸ªæ¥è‡ª172.24.0.31çš„è¿æ¥è¿›ç¨‹</span><br>[root@ztmonitor01 ~]# mysql -uroot -p123456 -e <span class="hljs-string">&quot;show processlist;&quot;</span><br><br><span class="hljs-comment">#å¯¹æ¯”ä¸‹ï¼ŒèŠ‚ç‚¹2ä¸Šçš„æ•°æ®åº“å®ä¾‹ï¼Œé™¤äº†ç³»ç»Ÿè‡ªå·±åˆ›å»ºçš„è¿æ¥æˆ–ä¸»ä»å¤åˆ¶åˆ›å»ºçš„è¿æ¥å¤–ï¼Œæ²¡æœ‰æ¥è‡ªå¤–éƒ¨çš„è¿æ¥</span><br>[root@ztmonitor02 ~]# mysql -uroot -p123456 -e <span class="hljs-string">&quot;show processlist;&quot;</span><br><br><span class="hljs-comment">#ç”±æ­¤ä¹Ÿå¯ç¡®å®šï¼ŒèŠ‚ç‚¹1ä¸Šæ•°æ®åº“å®ä¾‹å½“å‰æ˜¯MySQLæ•°æ®åº“é›†ç¾¤çš„ä¸»åº“</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/08/11/glbY1Tk5AsKomFf.png" alt="image-20240811160008455"></p><p><img src="https://s2.loli.net/2024/08/11/ne2o8bkjZsKWqtf.png" alt="image-20240811160854661"></p><h2 id="2-4-æœ€åçš„éªŒè¯"><a href="#2-4-æœ€åçš„éªŒè¯" class="headerlink" title="2.4 æœ€åçš„éªŒè¯"></a>2.4 æœ€åçš„éªŒè¯</h2><p>æŒ‰ç…§å‰é¢çš„é…ç½®ä¸å¯åŠ¨é¡ºåºï¼Œå½“å‰ï¼ŒèŠ‚ç‚¹1ã€èŠ‚ç‚¹2åˆ†åˆ«æ˜¯keepalivedé›†ç¾¤çš„masterèŠ‚ç‚¹ï¼›èŠ‚ç‚¹1ä¸Šçš„æ•°æ®åº“å®ä¾‹æ‰æ˜¯MySQLé›†ç¾¤çš„çœŸæ­£æœå½¹æ•°æ®åº“å®ä¾‹ã€‚</p><h3 id="2-4-1-æ¨¡æ‹Ÿä¸»å¤‡è‡ªåŠ¨åˆ‡æ¢"><a href="#2-4-1-æ¨¡æ‹Ÿä¸»å¤‡è‡ªåŠ¨åˆ‡æ¢" class="headerlink" title="2.4.1 æ¨¡æ‹Ÿä¸»å¤‡è‡ªåŠ¨åˆ‡æ¢"></a>2.4.1 æ¨¡æ‹Ÿä¸»å¤‡è‡ªåŠ¨åˆ‡æ¢</h3><p>å› ä¸ºå‰é¢æ‰€è¿°çš„é’ˆå¯¹keepalivedé…ç½®çš„å¯æ‰§è¡Œè„šæœ¬ç¨‹åºï¼Œå½“èŠ‚ç‚¹1ä¸Šçš„æ•°æ®åº“å®ä¾‹downæ‰å³mysqlæœåŠ¡åœæ­¢åï¼Œkeepalivedä¼šè‡ªåŠ¨æ£€æµ‹åˆ°ï¼ˆé€šè¿‡ä¸æ–­æ‰§è¡Œ&#x2F;data&#x2F;server&#x2F;mysql&#x2F;mycheck.shï¼‰ï¼Œç„¶ååœ¨mycheck.shä¸­å°†èŠ‚ç‚¹1ä¸Šçš„keepalivedæœåŠ¡åœæ­¢ï¼ŒkeepalivedæœåŠ¡åœ¨å®Œå…¨åœæ­¢å‰ä¼šå…ˆæ‰§è¡Œâ€notify_stop &#x2F;data&#x2F;server&#x2F;mysql&#x2F;mystop.shâ€œä¸­é…ç½®çš„mystop.shè„šæœ¬ã€‚    </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ztmonitor01 mysql]# systemctl stop mysqld<br>[root@ztmonitor01 mysql]# systemctl status keepalived<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/08/11/bGoh6pgxeTDLVUX.png" alt="image-20240811164432033"></p><p>èŠ‚ç‚¹2åœ¨keepalivedé›†ç¾¤ä¸­çš„è§’è‰²ç”±slaveå˜æˆmasterï¼Œvipæ¼‚ç§»åˆ°èŠ‚ç‚¹2ä¸Šã€‚åŒæ—¶ç”±äºâ€notify_master &#x2F;data&#x2F;server&#x2F;mysql&#x2F;mymaster.shâ€œè¿™ä¸ªé…ç½®ï¼Œkeepalivedå°†ä¼šè§¦å‘mymaster.shçš„æ‰§è¡Œï¼Œå°†èŠ‚ç‚¹2ä¸Šçš„æ•°æ®åº“å®ä¾‹çŠ¶æ€ä¿å­˜å¹¶ä¼ è¾“åˆ°èŠ‚ç‚¹1ä¸Šçš„â€&#x2F;data&#x2F;server&#x2F;mysql&#x2F;syncposfile&#x2F;backup_master.statusâ€œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ztmonitor02 ~]# systemctl status keepalived<br>[root@ztmonitor02 ~]# ip a<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/08/11/PUs6bBYTSrfM3ZI.png" alt="image-20240811165006678"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#èŠ‚ç‚¹2ä¸Šçš„æ•°æ®åº“å®ä¾‹çŠ¶æ€å·²ç»è¢«ä¿å­˜ä¸‹æ¥ä¼ è¾“åˆ°èŠ‚ç‚¹1ä¸Šçš„/data/server/mysql/syncposfile/backup_master.status</span><br>[root@ztmonitor01 ~]# <span class="hljs-built_in">cd</span> /data/server/mysql/<br>[root@ztmonitor01 mysql]# ll syncposfile/<br>[root@ztmonitor01 mysql]# <span class="hljs-built_in">cat</span> syncposfile/backup_master.status <br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/08/11/OykQveuNJpEPURq.png" alt="image-20240811165127852"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#è¿æ¥åˆ°æ­¤MySQLé›†ç¾¤ä¸­ï¼Œåœ¨db01æ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªå¼ æ•°æ®è¡¨t1<br>[root@ztmonitor02 ~]# mysql -h172.20.180.43 -uroot -p123456<br>mysql: [Warning] Using a password on the command line interface can be insecure.<br>Welcome to the MySQL monitor.  Commands end with ; or \g.<br>Your MySQL connection id is 467246<br>Server version: 5.7.36-log MySQL Community Server (GPL)<br><br>Copyright (c) 2000, 2021, Oracle and/or its affiliates.<br><br>Oracle is a registered trademark of Oracle Corporation and/or its<br>affiliates. Other names may be trademarks of their respective<br>owners.<br><br>Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.<br><br>mysql&gt; use db02;<br>Database changed<br>mysql&gt; create table t1(<br>    -&gt;     id int primary key auto_increment,<br>    -&gt;     name varchar(20) not null<br>    -&gt; )charset utf8;<br>Query OK, 0 rows affected (0.08 sec)<br>mysql&gt; exit<br></code></pre></td></tr></table></figure><p>åé¢å¦‚æœèŠ‚ç‚¹1ä¸Šçš„MySQLæ•°æ®åº“å®ä¾‹è¢«æ­£å¸¸æ‹‰èµ·æ¥äº†ï¼Œéœ€è¦æ‰‹åŠ¨å°†èŠ‚ç‚¹1ä¸Šçš„keepalivedæ‹‰èµ·ï¼ˆå› ä¸ºåœ¨keepalivedé›†ç¾¤ä¸­ï¼ŒèŠ‚ç‚¹1ä¸èŠ‚ç‚¹2çš„priorityæ˜¯ä¸€æ ·ï¼Œæ‰€ä»¥æ­¤æ—¶èŠ‚ç‚¹2ä»ç„¶æ˜¯keepalivedé›†ç¾¤çš„masterèŠ‚ç‚¹ï¼Œå³æŸä¸ªèŠ‚ç‚¹çš„keepalivedæœåŠ¡downäº†æ‰ä¼šå‘ç”Ÿkeepalivedçš„master&#x2F;slaveè½¬ç§»ï¼‰ï¼Œæ­¤æ—¶èŠ‚ç‚¹1ä¸Šçš„keepalivedå°†ä¼šå»æ‰§è¡Œâ€notify_backup &#x2F;data&#x2F;server&#x2F;mysql&#x2F;mybackup.shâ€ä¸­çš„mybackup.shï¼Œå°†èŠ‚ç‚¹2ä¸Šæ•°æ®åº“å®ä¾‹åœ¨â€èŠ‚ç‚¹1ä¸Šæ•°æ®åº“å®ä¾‹åœæ­¢åˆ°å½“å‰æ—¶åˆ»â€œè¿™æ®µæ—¶é—´å†…æ‰€æ‰§è¡Œçš„æ“ä½œåŒæ­¥åˆ°èŠ‚ç‚¹1ä¸Šçš„æ•°æ®åº“å®ä¾‹ä¸­ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@ztmonitor01 mysql]# systemctl start mysqld<br>[root@ztmonitor01 mysql]# systemctl status keepalived <br>[root@ztmonitor01 mysql]# systemctl start keepalived<br><br>[root@ztmonitor01 mysql]# systemctl status keepalived <br>[root@ztmonitor01 mysql]# ip a<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/08/11/Qou5IsL6WfhVKRi.png" alt="image-20240811170138305"></p><p><img src="https://s2.loli.net/2024/08/11/R4UwLlTpeJ3KOvI.png" alt="image-20240811165823320"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#å¯ä»¥çœ‹åˆ°åœ¨èŠ‚ç‚¹1ä¸Šæ•°æ®åº“å®ä¾‹downæ‰æœŸé—´ï¼Œåœ¨èŠ‚ç‚¹2ä¸Šæ•°æ®åº“å®ä¾‹ä¸Šæ‰§è¡Œçš„æ“ä½œè¢«æˆåŠŸåŒæ­¥åˆ°èŠ‚ç‚¹1ä¸Š<br>[root@ztmonitor01 mysql]# mysql -uroot -p123456<br>mysql: [Warning] Using a password on the command line interface can be insecure.<br>Welcome to the MySQL monitor.  Commands end with ; or \g.<br>Your MySQL connection id is 41<br>Server version: 5.7.36-log MySQL Community Server (GPL)<br><br>Copyright (c) 2000, 2021, Oracle and/or its affiliates.<br><br>Oracle is a registered trademark of Oracle Corporation and/or its<br>affiliates. Other names may be trademarks of their respective<br>owners.<br><br>Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.<br><br>mysql&gt; use db02;<br>Reading table information for completion of table and column names<br>You can turn off this feature to get a quicker startup with -A<br><br>Database changed<br>mysql&gt; show tables;<br>+----------------+<br>| Tables_in_db02 |<br>+----------------+<br>| t1             |<br>+----------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/08/11/jDPvOp9gf8uot4e.png" alt="image-20240811170554893"></p><p>è‡³æ­¤ï¼ŒèŠ‚ç‚¹1ä¸èŠ‚ç‚¹2ä¸Šçš„æ•°æ®åº“å®ä¾‹ä¸­çš„æ•°æ®è¿˜æ˜¯åŒæ­¥ä¸”ç›¸åŒçš„ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux MySQL5.7 ä¸»å¤‡é›†ç¾¤ äºŒè¿›åˆ¶å¼å®‰è£… keepalive ä¸»å¤‡è‡ªåŠ¨åˆ‡æ¢</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¤œèºnightingalev6.7.2ä¸­ç›‘æ§kubeletä¸å®¹å™¨</title>
    <link href="/2024/05/26/%E5%A4%9C%E8%8E%BAnightingalev6-7-2%E9%80%9A%E8%BF%87kubelet%E9%87%87%E9%9B%86docker%E5%AE%B9%E5%99%A8%E7%9B%91%E6%8E%A7%E6%95%B0%E6%8D%AE/"/>
    <url>/2024/05/26/%E5%A4%9C%E8%8E%BAnightingalev6-7-2%E9%80%9A%E8%BF%87kubelet%E9%87%87%E9%9B%86docker%E5%AE%B9%E5%99%A8%E7%9B%91%E6%8E%A7%E6%95%B0%E6%8D%AE/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€èƒŒæ™¯"><a href="#ä¸€ã€èƒŒæ™¯" class="headerlink" title="ä¸€ã€èƒŒæ™¯"></a>ä¸€ã€èƒŒæ™¯</h1><p>æœ¬äººæ˜¯åŸºäºnightingaleV6.7.2ä¸k8s-amd64-v1.23.10è¿›è¡Œäº†æ­¤æ–‡ç« ä¸­çš„æ“ä½œã€‚</p><p>ä½¿ç”¨categraf-v0.3.45-linux-amd64åšæ•°æ®é‡‡é›†å·¥å…·ï¼Œå®¹å™¨ç›‘æ§æ•°æ®é‡‡é›†ä½¿ç”¨çš„cadvisoræ’ä»¶ã€‚å…³äºcategrafä¸­ä½¿ç”¨caadvisoræ’ä»¶çš„æ–‡æ¡£ï¼š<a href="https://flashcat.cloud/docs/content/flashcat-monitor/categraf/plugin/cadvisor/%E3%80%82">https://flashcat.cloud/docs/content/flashcat-monitor/categraf/plugin/cadvisor/ã€‚</a> ä½†æ˜¯æˆ‘å½“æ—¶çœ‹äº†æ­¤æ–‡æ¡£åï¼Œè¿˜æ˜¯æœ‰ä¸€ä¸ªé…ç½®é¡¹bearer_token_stringæˆ–bearer_token_fileä¸çŸ¥å¦‚ä½•é…ç½®ï¼ˆç›¸å…³çš„é…ç½®æ–‡æ¡£å…¶å®å®˜ç½‘å·²ç»ç»™å‡ºï¼Œåªæ˜¯æˆ‘å…ˆå‰ä¹Ÿæ²¡æœ‰æ‰¾åˆ°ï¼‰ï¼Œæ­¤æ–¹æ³•ä¸å¤ªæ–¹ä¾¿æš‚ä¸é˜è¿°ï¼Œç›´æ¥ä½¿ç”¨å¦‚ä¸‹æ›´ç®€ä¾¿çš„æ–¹æ³•åšé…ç½®è¾¾åˆ°ç›‘æ§kubeletä¸å®¹å™¨çš„ç›®çš„ã€‚</p><h1 id="äºŒã€é…ç½®æ­¥éª¤"><a href="#äºŒã€é…ç½®æ­¥éª¤" class="headerlink" title="äºŒã€é…ç½®æ­¥éª¤"></a>äºŒã€é…ç½®æ­¥éª¤</h1><p>å‚è€ƒflashcatå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://flashcat.cloud/blog/kubernetes-monitoring-05-kubelet/%EF%BC%8C%E8%BD%AC%E6%8D%A2%E6%88%90%E8%87%AA%E5%B7%B1%E7%9A%84%E6%8F%8F%E8%BF%B0%E3%80%81%E5%86%85%E5%AE%B9%E6%9B%B4%E5%8A%A0%E7%AE%80%E6%B4%81%EF%BC%8C%E4%B9%9F%E6%98%AF%E4%B8%80%E4%B8%AA%E5%AF%B9flashcat%E5%8F%8A%E5%A4%9C%E8%8E%BA%E7%9A%84%E4%B8%80%E4%B8%AA%E5%AE%A3%E4%BC%A0%E5%90%A7%E3%80%82">https://flashcat.cloud/blog/kubernetes-monitoring-05-kubelet/ï¼Œè½¬æ¢æˆè‡ªå·±çš„æè¿°ã€å†…å®¹æ›´åŠ ç®€æ´ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¯¹flashcatåŠå¤œèºçš„ä¸€ä¸ªå®£ä¼ å§ã€‚</a></p><h2 id="2-1-åˆ›å»ºè®¤è¯ä¿¡æ¯"><a href="#2-1-åˆ›å»ºè®¤è¯ä¿¡æ¯" class="headerlink" title="2.1 åˆ›å»ºè®¤è¯ä¿¡æ¯"></a>2.1 åˆ›å»ºè®¤è¯ä¿¡æ¯</h2><p>è®¿é—®â€<a href="https://localhost:10250/metrics%E2%80%9C%E6%97%B6%E9%9C%80%E8%A6%81%E9%89%B4%E6%9D%83%EF%BC%8C%E6%8C%89%E7%85%A7%E5%A6%82%E4%B8%8B%E6%96%B9%E5%BC%8F%E5%88%9B%E5%BB%BAk8s%E4%B8%AD%E7%9A%84%E7%9B%B8%E5%85%B3%E8%B4%A6%E5%8F%B7%E4%B8%8E%E8%A7%92%E8%89%B2%E3%80%82">https://localhost:10250/metricsâ€œæ—¶éœ€è¦é‰´æƒï¼ŒæŒ‰ç…§å¦‚ä¸‹æ–¹å¼åˆ›å»ºk8sä¸­çš„ç›¸å…³è´¦å·ä¸è§’è‰²ã€‚</a></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#å°†ä¸‹è¿°å†…å®¹ä¿å­˜ä¸ºauth.yamlå¹¶åº”ç”¨åˆ°k8sé›†ç¾¤ä¸­</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Namespace</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">flashcat</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRole</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">categraf-daemonset</span><br><span class="hljs-attr">rules:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">apiGroups:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-attr">resources:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">nodes/metrics</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">nodes/stats</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">nodes/proxy</span><br>  <span class="hljs-attr">verbs:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">get</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">categraf-daemonset</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">flashcat</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">rbac.authorization.k8s.io/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRoleBinding</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">categraf-daemonset</span><br><span class="hljs-attr">roleRef:</span><br>  <span class="hljs-attr">apiGroup:</span> <span class="hljs-string">rbac.authorization.k8s.io</span><br>  <span class="hljs-attr">kind:</span> <span class="hljs-string">ClusterRole</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">categraf-daemonset</span><br><span class="hljs-attr">subjects:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">kind:</span> <span class="hljs-string">ServiceAccount</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">categraf-daemonset</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">flashcat</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åº”ç”¨ä¸æŸ¥çœ‹</span><br>kubectl apply -f auth.yaml<br>kubectl get ClusterRole | grep categraf-daemon<br>kubectl get sa -n flashcat<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/05/26/4KhLuVCSbj5HgF2.png" alt="image-20240526231854765"></p><h2 id="2-2-æµ‹è¯•ä¸Šè¿°åˆ›å»ºçš„æƒé™"><a href="#2-2-æµ‹è¯•ä¸Šè¿°åˆ›å»ºçš„æƒé™" class="headerlink" title="2.2 æµ‹è¯•ä¸Šè¿°åˆ›å»ºçš„æƒé™"></a>2.2 æµ‹è¯•ä¸Šè¿°åˆ›å»ºçš„æƒé™</h2><p>å·²ç»æˆåŠŸåˆ›å»ºäº† ServiceAccountï¼ŒæŠŠServiceAccountçš„å†…å®¹æ‰“å°å‡ºæ¥çœ‹ä¸€ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get sa categraf-daemonset -n flashcat -o yaml<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªServiceAccountå®é™…æ˜¯å…³è”äº†ä¸€ä¸ªSecretï¼Œå†çœ‹çœ‹è¿™ä¸ªSecretçš„å†…å®¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">kubectl get sa categraf-daemonset -n flashcat -o yaml<br>apiVersion: v1<br>kind: ServiceAccount<br>metadata:<br>  annotations:<br>    kubectl.kubernetes.io/last-applied-configuration: |<br>      &#123;&quot;apiVersion&quot;:&quot;v1&quot;,&quot;kind&quot;:&quot;ServiceAccount&quot;,&quot;metadata&quot;:&#123;&quot;annotations&quot;:&#123;&#125;,&quot;name&quot;:&quot;categraf-daemonset&quot;,&quot;namespace&quot;:&quot;flashcat&quot;&#125;&#125;<br>  creationTimestamp: &quot;2024-05-26T15:17:43Z&quot;<br>  name: categraf-daemonset<br>  namespace: flashcat<br>  resourceVersion: &quot;1265&quot;<br>  uid: 9fdf7004-22f6-410f-9696-40485e38db50<br>secrets:<br>- name: categraf-daemonset-token-h4p94<br></code></pre></td></tr></table></figure><p>æŠŠè¿™ä¸ªtokenå­—æ®µæ‹¿åˆ°ï¼Œç„¶åbase64è½¬ç ä¸€ä¸‹ï¼Œä½œä¸ºBearer Tokenæ¥è¯·æ±‚æµ‹è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">token=`kubectl -n flashcat get secret categraf-daemonset-token-h4p94 -o jsonpath=&#123;.data.token&#125; | base64 -d`<br><br>curl -s -k -H &quot;Authorization: Bearer $token&quot; https://localhost:10250/metrics &gt; aaaa<br>head -n 10 aaaa<br><span class="hljs-meta prompt_">#</span><span class="language-bash">è¾“å‡ºå¦‚ä¸‹å†…å®¹è¡¨ç¤ºå·²ç»æ­£å¸¸è®¿é—®https://localhost:10250/metrics</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP apiserver_audit_event_total [ALPHA] Counter of audit events generated and sent to the audit backend.</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE apiserver_audit_event_total counter</span><br>apiserver_audit_event_total 0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP apiserver_audit_requests_rejected_total [ALPHA] Counter of apiserver requests rejected due to an error <span class="hljs-keyword">in</span> audit logging backend.</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE apiserver_audit_requests_rejected_total counter</span><br>apiserver_audit_requests_rejected_total 0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">HELP apiserver_client_certificate_expiration_seconds [ALPHA] Distribution of the remaining lifetime on the certificate used to authenticate a request.</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">TYPE apiserver_client_certificate_expiration_seconds histogram</span><br>apiserver_client_certificate_expiration_seconds_bucket&#123;le=&quot;0&quot;&#125; 0<br>apiserver_client_certificate_expiration_seconds_bucket&#123;le=&quot;1800&quot;&#125; 0<br></code></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸè·å–åˆ°â€<a href="https://localhost:10250/metrics%E2%80%9C%E7%9A%84token%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%B0%86%E5%85%B6%E9%85%8D%E7%BD%AE%E5%88%B0categraf%E7%9A%84conf/input.cadvisor/cadvisor.toml">https://localhost:10250/metricsâ€œçš„tokenï¼Œå¯ä»¥å°†å…¶é…ç½®åˆ°categrafçš„conf/input.cadvisor/cadvisor.toml</a> æ–‡ä»¶ä¸­çš„bearer_token_stringé…ç½®é¡¹ã€‚ä½†å¦‚æœè¦æ­£å¸¸è·å–k8sé›†ç¾¤ä¸­æ‰€æœ‰å®¹å™¨æ•°æ®ï¼Œéœ€è¦ä¸ºk8sé›†ç¾¤æ¯ä¸ªèŠ‚ç‚¹éƒ½å®‰è£…categrafå¹¶å¦‚æ­¤é…ç½®ã€‚å¦‚æœåç»­k8sé›†ç¾¤æ–°å¢èŠ‚ç‚¹äº†ï¼Œæ–°å¢åŠ çš„èŠ‚ç‚¹ä¹Ÿéœ€è¦é‡å¤æ­¤é…ç½®ï¼Œè€ƒè™‘åˆ°æ­¤ï¼Œå¼•å‡ºä¸‹æ–‡ä¸­çš„åˆ›å»ºdaemonsetã€‚</p><p>å¦‚æœä½¿ç”¨äº†å¦‚ä¸‹daemonsetï¼Œç†åº”å°†categrafä¸­çš„cadvisoræ’ä»¶å…³é—­ï¼Œå¦åˆ™äºŒè€…é‡å¤äº†ã€‚</p><h2 id="2-3-åˆ›å»ºConfigMap"><a href="#2-3-åˆ›å»ºConfigMap" class="headerlink" title="2.3 åˆ›å»ºConfigMap"></a>2.3 åˆ›å»ºConfigMap</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#å°†ä¸‹è¿°å†…å®¹ä¿å­˜ä¸º categraf-configmap-v2.yaml æ–‡ä»¶ã€‚</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">categraf-config</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-attr">config.toml:</span> <span class="hljs-string">|</span><br><span class="hljs-string">    [global]</span><br><span class="hljs-string">    hostname = &quot;$HOSTNAME&quot;</span><br><span class="hljs-string">    interval = 15</span><br><span class="hljs-string">    providers = [&quot;local&quot;]</span><br><span class="hljs-string">    [writer_opt]</span><br><span class="hljs-string">    batch = 2000</span><br><span class="hljs-string">    chan_size = 10000</span><br><span class="hljs-string">    [[writers]]</span><br><span class="hljs-string">    url = &quot;http://172.20.180.50:17000/prometheus/v1/write&quot;</span><br><span class="hljs-string">    timeout = 5000</span><br><span class="hljs-string">    dial_timeout = 2500</span><br><span class="hljs-string">    max_idle_conns_per_host = 100</span><br><span class="hljs-string"></span><span class="hljs-meta">---</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">categraf-input-prometheus</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-attr">prometheus.toml:</span> <span class="hljs-string">|</span><br><span class="hljs-string">    [[instances]]</span><br><span class="hljs-string">    urls = [&quot;http://127.0.0.1:10249/metrics&quot;]</span><br><span class="hljs-string">    labels = &#123; job=&quot;kube-proxy&quot; &#125;</span><br><span class="hljs-string">    [[instances]]</span><br><span class="hljs-string">    urls = [&quot;https://127.0.0.1:10250/metrics&quot;]</span><br><span class="hljs-string">    bearer_token_file = &quot;/var/run/secrets/kubernetes.io/serviceaccount/token&quot;</span><br><span class="hljs-string">    use_tls = true</span><br><span class="hljs-string">    insecure_skip_verify = true</span><br><span class="hljs-string">    labels = &#123; job=&quot;kubelet&quot; &#125;</span><br><span class="hljs-string">    [[instances]]</span><br><span class="hljs-string">    urls = [&quot;https://127.0.0.1:10250/metrics/cadvisor&quot;]</span><br><span class="hljs-string">    bearer_token_file = &quot;/var/run/secrets/kubernetes.io/serviceaccount/token&quot;</span><br><span class="hljs-string">    use_tls = true</span><br><span class="hljs-string">    insecure_skip_verify = true</span><br><span class="hljs-string">    labels = &#123; job=&quot;cadvisor&quot; &#125;</span><br></code></pre></td></tr></table></figure><p>å¦‚ä¸Šå†…å®¹ä¸­ï¼Œâ€172.20.180.50:17000â€œæ˜¯å¤œèºæœåŠ¡æ‰€åœ¨çš„ipä¸ç«¯å£ï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ã€‚</p><p><code>hostname = &quot;$HOSTNAME&quot;</code> è¿™ä¸ªé…ç½®ç”¨äº† <code>$</code> ç¬¦å·ï¼Œåé¢åˆ›å»º Daemonset çš„æ—¶å€™ä¼šæŠŠ HOSTNAME è¿™ä¸ªç¯å¢ƒå˜é‡æ³¨å…¥ï¼Œè®© Categraf è‡ªåŠ¨æ‹¿åˆ°ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åº”ç”¨æ­¤æ–‡ä»¶</span><br>kubectl apply -f categraf-configmap-v2.yaml -n flashcat<br>configmap/categraf-config created<br>configmap/categraf-input-prometheus created<br></code></pre></td></tr></table></figure><h2 id="2-4-åˆ›å»ºdaemonset"><a href="#2-4-åˆ›å»ºdaemonset" class="headerlink" title="2.4 åˆ›å»ºdaemonset"></a>2.4 åˆ›å»ºdaemonset</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#å°†ä¸‹è¿°å†…å®¹ä¿å­˜ä¸º categraf-daemonset-v2.yaml æ–‡ä»¶ã€‚</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">DaemonSet</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">categraf-daemonset</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">categraf-daemonset</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">categraf-daemonset</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">categraf-daemonset</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">env:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">TZ</span><br>          <span class="hljs-attr">value:</span> <span class="hljs-string">Asia/Shanghai</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">HOSTNAME</span><br>          <span class="hljs-attr">valueFrom:</span><br>            <span class="hljs-attr">fieldRef:</span><br>              <span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br>              <span class="hljs-attr">fieldPath:</span> <span class="hljs-string">status.hostIP</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">HOSTIP</span><br>          <span class="hljs-attr">valueFrom:</span><br>            <span class="hljs-attr">fieldRef:</span><br>              <span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br>              <span class="hljs-attr">fieldPath:</span> <span class="hljs-string">status.hostIP</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">flashcatcloud/categraf:v0.2.18</span><br>        <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">categraf</span><br>        <span class="hljs-attr">volumeMounts:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/etc/categraf/conf</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">categraf-config</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/etc/categraf/conf/input.prometheus</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">categraf-input-prometheus</span><br>      <span class="hljs-attr">hostNetwork:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">serviceAccountName:</span> <span class="hljs-string">categraf-daemonset</span><br>      <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">Always</span><br>      <span class="hljs-attr">tolerations:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">effect:</span> <span class="hljs-string">NoSchedule</span><br>        <span class="hljs-attr">operator:</span> <span class="hljs-string">Exists</span><br>      <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">configMap:</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">categraf-config</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">categraf-config</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">configMap:</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">categraf-input-prometheus</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">categraf-input-prometheus</span><br></code></pre></td></tr></table></figure><p>æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œåˆ›å»º Daemonsetï¼Œä¼šæŠŠ HOSTNAME ç¯å¢ƒå˜é‡æ³¨å…¥è¿›å»ã€‚å®˜æ–¹æ–‡æ¡£é»˜è®¤ä½¿ç”¨çš„æ˜¯spec.nodeNameï¼Œæˆ‘æ”¹æˆä½¿ç”¨status.hostIPï¼Œè¿™æ ·åç»­é‡‡é›†åˆ°çš„æŒ‡æ ‡æ•°æ®ä¸­ï¼Œidentå±æ€§çš„å€¼å°±ä¸å†æ˜¯å®¹å™¨å®¿ä¸»æœºåï¼Œè€Œæ˜¯å®¹å™¨å®¿ä¸»æœºipäº†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åº”ç”¨æ­¤æ–‡ä»¶</span><br>kubectl apply -f categraf-daemonset-v2.yaml -n flashcat<br>daemonset.apps/categraf-daemonset created<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç¨ç­‰ä¸€ä¼šå„¿ï¼Œç­‰podæ­£å¸¸è¿è¡Œ</span><br>kubectl get pods -n flashcat -o wide<br>NAME                       READY   STATUS    RESTARTS   AGE   IP              NODE       NOMINATED NODE   READINESS GATES<br>categraf-daemonset-jpgxs   1/1     Running   0          24s   172.20.180.25   worker02   &lt;none&gt;           &lt;none&gt;<br>categraf-daemonset-rdlbk   1/1     Running   0          25s   172.20.180.21   master01   &lt;none&gt;           &lt;none&gt;<br>categraf-daemonset-xnqdj   1/1     Running   0          24s   172.20.180.24   worker01   &lt;none&gt;           &lt;none&gt;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">daemonsetè¿è¡Œæ­£å¸¸</span><br>kubectl get daemonset -n flashcat<br>NAME                 DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE<br>categraf-daemonset   3         3         3       3            3           &lt;none&gt;          31s<br></code></pre></td></tr></table></figure><h2 id="2-5-ç¡®è®¤é‡‡é›†åˆ°çš„æ•°æ®"><a href="#2-5-ç¡®è®¤é‡‡é›†åˆ°çš„æ•°æ®" class="headerlink" title="2.5 ç¡®è®¤é‡‡é›†åˆ°çš„æ•°æ®"></a>2.5 ç¡®è®¤é‡‡é›†åˆ°çš„æ•°æ®</h2><p>æŸ¥çœ‹kubeletæœ¬èº«çš„æŒ‡æ ‡ï¼Œå®ƒæ˜¯ä» Kubelet çš„ <code>/metrics</code> æ¥å£é‡‡é›†çš„ï¼ˆå¯ä»¥çœ‹åˆ°é‡‡é›†åˆ°çš„æŒ‡æ ‡æ•°æ®ä¸­æœ‰ä¸€ä¸ªå±æ€§identå±æ€§ï¼Œå®ƒçš„å€¼æ˜¯è¢«ç›‘æ§æœåŠ¡å™¨çš„ipï¼Œå¦‚ä¸‹æ˜¯172.20.180.21ï¼‰ï¼š</p><p><img src="https://s2.loli.net/2024/05/26/q5BRhDNsGo13nk4.png" alt="image-20240526232912388"></p><p> å†ç¡®è®¤cAdvisor é‡‡é›†çš„æŒ‡æ ‡åŠå…¶æ•°æ®ï¼Œå®ƒæ˜¯ä» <code>/metrics/cadvisor</code> æ¥å£é‡‡é›†çš„ï¼š</p><p><img src="https://s2.loli.net/2024/05/26/8QzN3Tg2weJx7YP.png" alt="image-20240526233510353"></p><h2 id="2-6-ç›‘æ§ä»ªè¡¨ç›˜"><a href="#2-6-ç›‘æ§ä»ªè¡¨ç›˜" class="headerlink" title="2.6 ç›‘æ§ä»ªè¡¨ç›˜"></a>2.6 ç›‘æ§ä»ªè¡¨ç›˜</h2><p>ä½¿ç”¨å†…ç½®ä»ªè¡¨ç›˜ â€œKubernetes &#x2F; Containerâ€ï¼Œå…‹éš†ä¸€ä¸ªè‡ªå·±ä½¿ç”¨çš„ä»ªè¡¨ç›˜ã€‚å¾—åˆ°çš„å¤§ä½“æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://s2.loli.net/2024/10/19/8Lz1A7dXTrZH9iK.png" alt="image-20241019222209824"></p>]]></content>
    
    
    <categories>
      
      <category>ç›‘æ§</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s ç›‘æ§ å¤œèº nightingale</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
