

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="sanyinjiang">
  <meta name="keywords" content="">
  
    <meta name="description" content="一、背景与服务器 服务器信息     主机名 用途 IP root用户密码 规格 系统盘 OS 备注     controller01 master + worker 113.57.37.106 XXX 192c1T 1124G Ubuntu 22.04.5 LTS-aarch64 联网     服务器有8个昇腾910B3 加速卡。 还">
<meta property="og:type" content="article">
<meta property="og:title" content="sanyinjiang">
<meta property="og:url" content="https://jiangsanyin.github.io/2025/07/02/ARM64%E6%9C%8D%E5%8A%A1%E5%99%A8910B%E9%83%A8%E7%BD%B2%E4%B8%8E%E4%BD%BF%E7%94%A8volcano/index.html">
<meta property="og:site_name" content="sanyinjiang">
<meta property="og:description" content="一、背景与服务器 服务器信息     主机名 用途 IP root用户密码 规格 系统盘 OS 备注     controller01 master + worker 113.57.37.106 XXX 192c1T 1124G Ubuntu 22.04.5 LTS-aarch64 联网     服务器有8个昇腾910B3 加速卡。 还">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2025/07/06/vJ7OS68LomR9uEF.png">
<meta property="og:image" content="https://s2.loli.net/2025/07/02/leXtuAwBHJj26ic.png">
<meta property="og:image" content="https://s2.loli.net/2025/07/02/JIEUf2mHe3FXWZv.png">
<meta property="og:image" content="https://s2.loli.net/2025/07/08/Ui8NxMR9IJ7zqfo.png">
<meta property="article:published_time" content="2025-07-02T07:52:35.000Z">
<meta property="article:modified_time" content="2025-07-11T01:26:44.000Z">
<meta property="article:author" content="sanyinjiang">
<meta property="article:tag" content="算力及调度">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://s2.loli.net/2025/07/06/vJ7OS68LomR9uEF.png">
  
  
  
  <title>sanyinjiang</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"jiangsanyin.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":["home"]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":"lhgjNNoNy5Syl0F4Bw8i5P5K-gzGzoHsz","app_key":"0d6M8Wx7ZmYewOQqA20Nbqen","server_url":"https://lhgjnnon.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>sanyinjiang</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-07-02 15:52" pubdate>
          2025年7月2日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          16k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          137 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header"></h1>
            
            
              <div class="markdown-body">
                
                <h1 id="一背景与服务器">一、背景与服务器</h1>
<h2 id="服务器信息">服务器信息</h2>
<table style="width:100%;">

<thead>
<tr>
<th>主机名</th>
<th>用途</th>
<th>IP</th>
<th>root用户密码</th>
<th>规格</th>
<th>系统盘</th>
<th>OS</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>controller01</td>
<td>master + worker</td>
<td>113.57.37.106</td>
<td>XXX</td>
<td>192c1T</td>
<td>1124G</td>
<td>Ubuntu 22.04.5 LTS-aarch64</td>
<td>联网</td>
</tr>
</tbody>
</table>
<ul>
<li>服务器有8个昇腾910B3 加速卡。</li>
<li>还有一个3T的nvme盘空闲。</li>
<li>此处为了方便，我为部署节点到其他节点（其实只有一个服务器）做了ssh免密登录</li>
</ul>
<p>参考基础文档：<a
target="_blank" rel="noopener" href="https://www.hiascend.com/doc_center/source/zh/mindcluster/70rc1/clustersched/dlug/MindCluster%207.0.RC1%20%E9%9B%86%E7%BE%A4%E8%B0%83%E5%BA%A6%E7%94%A8%E6%88%B7%E6%8C%87%E5%8D%97.pdf">MindCluster
7.0.RC1 集群调度用户指南</a></p>
<h1 id="二安装npu驱动和固件">二、安装NPU驱动和固件</h1>
<p>此章节内容我未执行完，发现可以通过Ascend
Deployer工具批量安装集群调度组件，其中可以安装驱动与固件。</p>
<p>参考文档：</p>
<p><a
target="_blank" rel="noopener" href="https://docs.daocloud.io/kpanda/user-guide/gpu/gpu_matrix#ascendnpu">支持ascend
NPU的操作系统</a>、</p>
<p><a
target="_blank" rel="noopener" href="https://www.hiascend.com/document/detail/zh/canncommercial/81RC1/softwareinst/instg/instg_0005.html?Mode=PmIns&amp;InstallType=local&amp;OS=Ubuntu&amp;Software=cannToolKit">昇腾官方文档-安装NPU驱动和固件</a></p>
<p><a
target="_blank" rel="noopener" href="https://support.huawei.com/enterprise/zh/doc/EDOC1100332515/b6fab88e?idPath=23710424%7C251366513%7C22892968%7C252309113%7C250702818">创建运行用户(我没有创建，即使用root)</a></p>
<h2 id="配置python环境变量">配置Python环境变量</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">准备python与python3</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# ll /usr/bin/python*<br>-rwxr-xr-x 1 root root 5659768 May 28 01:12 /usr/bin/python3.10*<br>lrwxrwxrwx 1 root root      35 May 28 01:12 /usr/bin/python3.10-config -&gt; aarch64-linux-gnu-python3.10-config*<br>-rwxr-xr-x 1 root root 5103952 Jun  4 16:55 /usr/bin/python3.9*<br>lrwxrwxrwx 1 root root      17 Aug  8  2024 /usr/bin/python3-config -&gt; python3.10-config*<br><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# ln -n /usr/bin/python3.10 /usr/bin/python3<br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# which python3<br>/usr/bin/python3<br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# ln -n /usr/bin/python3.10 /usr/bin/python<br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# python -V<br>Python 3.10.12<br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# python3 -V<br>Python 3.10.12<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">准备pip3</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# apt install python3-pip -y<br><span class="hljs-meta prompt_">#</span><span class="language-bash">设置pip源为阿里云的</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# mkdir /root/.pip<br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# cat &gt; /root/.pip/pip.conf &lt;&lt;EOF<br>[global]<br>trusted-host = mirrors.aliyun.com<br>index-url = https://mirrors.aliyun.com/pypi/simple<br>EOF<br><span class="hljs-meta prompt_">#</span><span class="language-bash">升级pip3到最新版</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# pip install pip --upgrade<br><span class="hljs-meta prompt_">#</span><span class="language-bash">查看pip版本</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# pip -V<br>pip 25.1.1 from /usr/local/lib/python3.10/dist-packages/pip (python 3.10)<br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# pip3 -V<br>pip 25.1.1 from /usr/local/lib/python3.10/dist-packages/pip (python 3.10)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">安装Python 3.10开发包</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@controller01:/opt/jiang/deploy_by_ascend_deployer# apt-get update</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@controller01:/opt/jiang/deploy_by_ascend_deployer# apt install libpython3.10-dev</span><br></code></pre></td></tr></table></figure>
<h2 id="下载驱动安装文件">下载驱动安装文件</h2>
<p>注：我先尝试使用<code>Ascend-hdk-910-npu-driver_23.0.rc3_linux-aarch64.run</code>、<code>Ascend-hdk-910-npu-firmware_7.0.0.5.242.run</code>，但一直没成功。转而使用<code>Ascend-hdk-910b-npu-driver_24.1.rc3_linux-aarch64.deb</code>、<code>Ascend-hdk-910b-npu-firmware_7.5.0.1.129.deb</code>，成功了。</p>
<p>驱动安装文件与固件安装文件下载地址：<a
target="_blank" rel="noopener" href="https://www.hiascend.com/hardware/firmware-drivers/community?product=2&amp;model=19&amp;cann=7.0.RC1.beta1&amp;driver=1.0.21.alpha">社区版-固件与驱动</a></p>
<figure>
<img src="https://s2.loli.net/2025/07/06/vJ7OS68LomR9uEF.png" srcset="/img/loading.gif" lazyload
alt="image-20250706103738644" />
<figcaption aria-hidden="true">image-20250706103738644</figcaption>
</figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">下载后保存在此处</span><br>root@controller01:/opt/jiang/npu-releated# ls -alh<br>total 325M<br>drwxr-xr-x 2 root root 4.0K Jul  5 22:25 .<br>drwxr-xr-x 6 root root 4.0K Jul  5 19:22 ..<br>-rwxr-xr-x 1 root root 102M Jul  5 22:20 Ascend-hdk-910b-npu-driver_24.1.rc3_linux-aarch64.deb<br>-rwxr-xr-x 1 root root 208K Jul  5 22:20 Ascend-hdk-910b-npu-firmware_7.5.0.1.129.deb<br>-rwxr-xr-x 1 root root 126M Jul  2 16:41 Ascend-hdk-910-npu-driver_23.0.rc3_linux-aarch64.run<br>-rwxr-xr-x 1 root root 881K Jul  2 16:39 Ascend-hdk-910-npu-firmware_7.0.0.5.242.run<br></code></pre></td></tr></table></figure>
<h2 id="安装驱动所需依赖">安装驱动所需依赖</h2>
<p>可以参考： <a
target="_blank" rel="noopener" href="https://mirrors.huaweicloud.com/mirrorDetail/5ea14ecab05943f36fb75ee7?mirrorName=ubuntu&amp;catalog=os">华为开源-操作系统组件源</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:/opt/jiang/npu-releated# apt-get update<br>root@controller01:/opt/jiang/npu-releated# apt-get install -y dkms gcc linux-headers-$(uname -r)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">如果安装组件过程中，提示现有内核版本5.15.0-xxx不是最新的，重启以升级到使用5.15.0-yyy</span><br></code></pre></td></tr></table></figure>
<h2
id="安装包加权限和校验一致性和完整性">安装包加权限和校验一致性和完整性</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">.run文件需要校验其一致性与完整性，但文档对于.deb包没说需要</span><br>chmod +x Ascend-hdk-910-npu-driver_23.0.rc3_linux-aarch64.run<br>chmod +x Ascend-hdk-910-npu-firmware_7.0.0.5.242.run<br>./Ascend-hdk-910-npu-driver_23.0.rc3_linux-aarch64.run --check<br>./Ascend-hdk-910-npu-firmware_7.0.0.5.242.run --check<br></code></pre></td></tr></table></figure>
<h2 id="安装驱动和固件">安装驱动和固件</h2>
<p>参考文档：<a
target="_blank" rel="noopener" href="https://www.hiascend.com/document/detail/zh/Atlas%20200I%20A2/24.1.RC3/ep/installationguide/Install_10.html">安装驱动</a></p>
<h3 id="执行安装驱动与固件">执行安装驱动与固件</h3>
<ul>
<li>首次安装请按照“<strong>驱动-&gt;固件</strong>”的顺序；覆盖安装或升级请按照“<strong>固件-&gt;驱动</strong>”的顺序，分别安装软件包。</li>
<li>首次安装过程中如果使用了--install-for-all参数，覆盖安装中也需要保留--install-for-all参数（使用.deb安装包时没用到）。</li>
<li>软件包默认安装路径为“/usr/local/Ascend”。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">创建用户HwHiAiUser和用户组HwHiAiUser</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">如果创建的用户和用户组是HwHiAiUser，安装软件包时无需指定运行用户，默认即为HwHiAiUser</span><br>root@controller01:/opt/jiang/npu-releated# groupadd -g 1001 HwHiAiUser<br>root@controller01:/opt/jiang/npu-releated# useradd -g HwHiAiUser -u 1001 -d /home/HwHiAiUser -m HwHiAiUser -s /bin/bash<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">安装 驱动安装过程中需要用到的组件（安装驱动时需要用到由net-tools组件提供的ifconfig命令）</span><br>root@controller01:/opt/jiang/npu-releated# apt install net-tools -y<br><span class="hljs-meta prompt_">#</span><span class="language-bash">配套使用Ascend-hdk-910b-npu-driver_24.1.rc3_linux-aarch64.deb、Ascend-hdk-910b-npu-firmware_7.5.0.1.129.deb</span><br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">###########1.安装驱动############</span></span><br>root@controller01:/opt/jiang/npu-releated# chmod +x Ascend-hdk-910b-npu-driver_24.1.rc3_linux-aarch64.deb<br>root@controller01:/opt/jiang/npu-releated# dpkg -i Ascend-hdk-910b-npu-driver_24.1.rc3_linux-aarch64.deb<br>(Reading database ... 88288 files and directories currently installed.)<br>Preparing to unpack Ascend-hdk-910b-npu-driver_24.1.rc3_linux-aarch64.deb ...<br>[Driver] [2025-07-05 22:33:35] [INFO]Start time: 2025-07-05 22:33:35<br>[Driver] [2025-07-05 22:33:35] [INFO]LogFile: /var/log/ascend_seclog/ascend_install.log<br>[Driver] [2025-07-05 22:33:35] [INFO]OperationLogFile: /var/log/ascend_seclog/operation.log<br>[Driver] [2025-07-05 22:33:36] [WARNING]Do not power off or restart the system during the installation/upgrade<br>[Driver] [2025-07-05 22:33:36] [INFO]set username and usergroup, HwHiAiUser:HwHiAiUser<br>Unpacking ascend910b-driver (24.1.rc3) ...<br>Setting up ascend910b-driver (24.1.rc3) ...<br>[Driver] [2025-07-05 22:33:42] [INFO]driver install type: DKMS<br>[Driver] [2025-07-05 22:33:42] [INFO]upgradePercentage:10%<br>[Driver] [2025-07-05 22:33:44] [INFO]upgradePercentage:30%<br>[Driver] [2025-07-05 22:33:44] [INFO]upgradePercentage:40%<br>[Driver] [2025-07-05 22:34:01] [INFO]upgradePercentage:90%<br>[Driver] [2025-07-05 22:34:01] [INFO]Waiting for device startup...<br>[Driver] [2025-07-05 22:34:03] [INFO]Device startup success<br>[Driver] [2025-07-05 22:34:15] [INFO]upgradePercentage:100%<br>[Driver] [2025-07-05 22:34:26] [INFO]Driver package installed successfully! The new version takes effect immediately. <br>[Driver] [2025-07-05 22:34:26] [INFO]End time: 2025-07-05 22:34:26<br>Processing triggers for libc-bin (2.35-0ubuntu3.6) ...<br><span class="hljs-meta prompt_">#</span><span class="language-bash">安装驱动成功</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">根据系统提示信息决定是否重启系统（我这里没有重启）</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">查看npu信息</span><br>root@controller01:/opt/jiang/npu-releated# npu-smi info<br>+------------------------------------------------------------------------------------------------+<br>| npu-smi 24.1.rc3                 Version: 24.1.rc3                                             |<br>+---------------------------+---------------+----------------------------------------------------+<br>| NPU   Name                | Health        | Power(W)    Temp(C)           Hugepages-Usage(page)|<br>| Chip                      | Bus-Id        | AICore(%)   Memory-Usage(MB)  HBM-Usage(MB)        |<br>+===========================+===============+====================================================+<br>| 0     910B3               | OK            | 97.4        36                0    / 0             |<br>| 0                         | 0000:C1:00.0  | 0           0    / 0          3191 / 65536         |<br>+===========================+===============+====================================================+<br>| 1     910B3               | OK            | 92.8        37                0    / 0             |<br>| 0                         | 0000:C2:00.0  | 0           0    / 0          3192 / 65536         |<br>+===========================+===============+====================================================+<br>| 2     910B3               | OK            | 95.7        35                0    / 0             |<br>| 0                         | 0000:81:00.0  | 0           0    / 0          3192 / 65536         |<br>+===========================+===============+====================================================+<br>| 3     910B3               | OK            | 90.7        36                0    / 0             |<br>| 0                         | 0000:82:00.0  | 0           0    / 0          3192 / 65536         |<br>+===========================+===============+====================================================+<br>| 4     910B3               | OK            | 88.8        40                0    / 0             |<br>| 0                         | 0000:01:00.0  | 0           0    / 0          3191 / 65536         |<br>+===========================+===============+====================================================+<br>| 5     910B3               | OK            | 97.3        41                0    / 0             |<br>| 0                         | 0000:02:00.0  | 0           0    / 0          3192 / 65536         |<br>+===========================+===============+====================================================+<br>| 6     910B3               | OK            | 91.0        40                0    / 0             |<br>| 0                         | 0000:41:00.0  | 0           0    / 0          3191 / 65536         |<br>+===========================+===============+====================================================+<br>| 7     910B3               | OK            | 93.8        39                0    / 0             |<br>| 0                         | 0000:42:00.0  | 0           0    / 0          3191 / 65536         |<br>+===========================+===============+====================================================+<br>+---------------------------+---------------+----------------------------------------------------+<br>| NPU     Chip              | Process id    | Process name             | Process memory(MB)      |<br>+===========================+===============+====================================================+<br>| No running processes found in NPU 0                                                            |<br>+===========================+===============+====================================================+<br>| No running processes found in NPU 1                                                            |<br>+===========================+===============+====================================================+<br>| No running processes found in NPU 2                                                            |<br>+===========================+===============+====================================================+<br>| No running processes found in NPU 3                                                            |<br>+===========================+===============+====================================================+<br>| No running processes found in NPU 4                                                            |<br>+===========================+===============+====================================================+<br>| No running processes found in NPU 5                                                            |<br>+===========================+===============+====================================================+<br>| No running processes found in NPU 6                                                            |<br>+===========================+===============+====================================================+<br>| No running processes found in NPU 7                                                            |<br>+===========================+===============+====================================================+<br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">###########2.安装固件############</span></span><br>root@controller01:/opt/jiang/npu-releated# dpkg -i Ascend-hdk-910b-npu-firmware_7.5.0.1.129.deb<br>Selecting previously unselected package ascend910b-firmware.<br>(Reading database ... 91240 files and directories currently installed.)<br>Preparing to unpack Ascend-hdk-910b-npu-firmware_7.5.0.1.129.deb ...<br>[Firmware] [2025-07-05 22:37:18] [INFO]Start time: 2025-07-05 22:37:18<br>[Firmware] [2025-07-05 22:37:18] [INFO]LogFile: /var/log/ascend_seclog/ascend_install.log<br>[Firmware] [2025-07-05 22:37:18] [INFO]OperationLogFile: /var/log/ascend_seclog/operation.log<br>[Firmware] [2025-07-05 22:37:18] [WARNING]Do not power off or restart the system during the installation/upgrade<br>Unpacking ascend910b-firmware (7.5.0.1.129) ...<br>Setting up ascend910b-firmware (7.5.0.1.129) ...<br>[Firmware] [2025-07-05 22:37:23] [INFO]upgradePercentage: 0%<br>[Firmware] [2025-07-05 22:37:33] [INFO]upgradePercentage: 0%<br>[Firmware] [2025-07-05 22:37:42] [INFO]upgradePercentage: 0%<br>[Firmware] [2025-07-05 22:37:49] [INFO]upgradePercentage: 100%<br>[Firmware] [2025-07-05 22:37:50] [INFO]Firmware package installed successfully! Reboot now or after driver installation for the installation/upgrade to take effect.<br>[Firmware] [2025-07-05 22:37:50] [INFO]End time: 2025-07-05 22:37:50<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">执行如下命令，查看芯片固件版本号</span><br>root@controller01:/opt/jiang/npu-releated# /usr/local/Ascend/driver/tools/upgrade-tool --device_index -1 --component -1 --version<br>&#123;<br>Get component version(7.5.0.1.129) succeed for deviceId(0), componentType(11).<br>        &#123;&quot;device_id&quot;:0, &quot;component&quot;:hboot1a, &quot;version&quot;:7.5.0.1.129&#125;<br>Get component version(7.5.0.1.129) succeed for deviceId(0), componentType(12).<br>        &#123;&quot;device_id&quot;:0, &quot;component&quot;:hboot1b, &quot;version&quot;:7.5.0.1.129&#125;<br>Get component version(7.5.0.1.129) succeed for deviceId(0), componentType(18).<br>        &#123;&quot;device_id&quot;:0, &quot;component&quot;:hlink, &quot;version&quot;:7.5.0.1.129&#125;<br>Get component version(7.5.0.1.129) succeed for deviceId(0), componentType(27).<br>        &#123;&quot;device_id&quot;:0, &quot;component&quot;:hlink2, &quot;version&quot;:7.5.0.1.129&#125;<br>...<br>&#125;<br><span class="hljs-meta prompt_">#</span><span class="language-bash">若与固件软件包版本号一致，则说明安装成功</span><br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">###########3.重启服务器############</span></span><br>root@controller01:/opt/jiang/npu-releated# shutdown -r now<br></code></pre></td></tr></table></figure>
<h3 id="卸载驱动和固件如果有需要">卸载驱动和固件(如果有需要)</h3>
<p>驱动和固件的卸载没有先后顺序要求。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">可以执行<span class="hljs-built_in">cat</span> /etc/ascend_install.info命令查询驱动与固件安装信息</span><br>root@controller01:/opt/jiang/npu-releated# cat /etc/ascend_install.info<br>UserName=HwHiAiUser<br>UserGroup=HwHiAiUser<br>Driver_Install_Type=full<br>Driver_Install_Path_Param=/usr/local/Ascend<br>Driver_Install_For_All=no<br>Driver_Install_Mode=normal<br>Driver_Install_Status=complete<br>Firmware_Install_Type=full<br>Firmware_Install_Path_Param=/usr/local/Ascend<br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">卸载驱动（在任意路径执行如下命令卸载驱动）</span><br>root@controller01:/opt/jiang/npu-releated# ll /usr/local/Ascend/driver/script/uninstall.sh<br>-r-xr-xr-x 1 root root 9042 Jul  5 15:01 /usr/local/Ascend/driver/script/uninstall.sh*<br>root@controller01:/opt/jiang/npu-releated# <br>root@controller01:/opt/jiang/npu-releated# /usr/local/Ascend/driver/script/uninstall.sh<br>/usr/local/Ascend/driver/tools/upgrade-tool: error while loading shared libraries: libdrvdsmi_host.so: cannot open shared object file: No such file or directory<br>[Driver] [2025-07-05 15:09:36] [INFO]Driver package uninstalled successfully! Reboot needed for uninstallation to take effect!<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">根据系统提示信息决定是否重启服务器</span><br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">卸载固件（在任意路径执行如下命令卸载固件）</span><br>root@controller01:/opt/jiang/npu-releated# /usr/local/Ascend/firmware/script/uninstall.sh<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">根据系统提示信息决定是否重启服务器</span><br></code></pre></td></tr></table></figure>
<h3 id="报错与异常处理">报错与异常处理</h3>
<h4
id="安装驱动时失败并提示driver_ko_install-failed">安装驱动时失败并提示Driver_ko_install
failed</h4>
<p>我先前尝试使用<code>Ascend-hdk-910-npu-driver_23.0.rc3_linux-aarch64.run</code>、<code>Ascend-hdk-910-npu-firmware_7.0.0.5.242.run</code>，但一直没成功。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">安装包加权限和校验一致性和完整性</span><br>chmod +x Ascend-hdk-910-npu-driver_23.0.rc3_linux-aarch64.run<br>chmod +x Ascend-hdk-910-npu-firmware_7.0.0.5.242.run<br>./Ascend-hdk-910-npu-driver_23.0.rc3_linux-aarch64.run --check<br>./Ascend-hdk-910-npu-firmware_7.0.0.5.242.run --check<br><br>oot@controller01:/opt/jiang/npu-releated# ./Ascend-hdk-910-npu-driver_23.0.rc3_linux-aarch64.run --full --install-for-all<br>Verifying archive integrity...  100%   SHA256 checksums are OK. All good.<br>Uncompressing ASCEND DRIVER RUN PACKAGE  100%  <br>[Driver] [2025-07-05 15:01:18] [INFO]Start time: 2025-07-05 15:01:18<br>[Driver] [2025-07-05 15:01:18] [INFO]LogFile: /var/log/ascend_seclog/ascend_install.log<br>[Driver] [2025-07-05 15:01:18] [INFO]OperationLogFile: /var/log/ascend_seclog/operation.log<br>[Driver] [2025-07-05 15:01:18] [WARNING]Do not power off or restart the system during the installation/upgrade<br>[Driver] [2025-07-05 15:01:19] [INFO]set username and usergroup, HwHiAiUser:HwHiAiUser<br>[Driver] [2025-07-05 15:01:20] [INFO]driver install type: DKMS<br>[Driver] [2025-07-05 15:01:20] [INFO]upgradePercentage:10%<br>[Driver] [2025-07-05 15:01:24] [INFO]upgradePercentage:30%<br>[Driver] [2025-07-05 15:01:24] [INFO]upgradePercentage:40%<br>[Driver] [2025-07-05 15:01:47] [ERROR]Dkms install failed, details in : /var/log/ascend_seclog/ascend_install.log <br>[Driver] [2025-07-05 15:01:47] [ERROR]Driver_ko_install failed, details in : /var/log/ascend_seclog/ascend_install.log <br>[Driver] [2025-07-05 15:01:47] [INFO]Failed to install driver package, please retry after uninstall and reboot!<br>[Driver] [2025-07-05 15:01:47] [INFO]End time: 2025-07-05 15:01:47<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">如下是/var/log/ascend_seclog/ascend_install.log  最末端的日志信息</span><br>root@controller01:/opt/jiang/npu-releated# vi /var/log/ascend_seclog/ascend_install.log <br>Building module:<br>cleaning build area...<br>&#x27;make&#x27; all KERNEL_UNAME=5.15.0-94-generic DAVINCI_HIAI_DKMS=y TARGET_PRODUCT=cloud TARGET_CHIP_ID=hi1980 Driver_Install_Mode=normal......(bad exit status: 2)<br>ERROR (dkms apport): binary package for davinci_ascend: 1.0 not found<br>Error! Bad return status for module build on kernel: 5.15.0-94-generic (aarch64)<br>Consult /var/lib/dkms/davinci_ascend/1.0/build/make.log for more information.<br>[Driver] [2025-07-05 15:01:47] [uid=0(root)] [INFO]driver dkms log &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;<br>[Driver] [2025-07-05 15:01:47] [uid=0(root)] [ERROR]There has no /ascend_dms_dtm.ko, dkms install failed<br>[Driver] [2025-07-05 15:01:47] [uid=0(root)] [ERROR]dkms install files check failed<br>[Driver] [2025-07-05 15:01:47] [uid=0(root)] [ERROR]dkms install failed<br>[Driver] [2025-07-05 15:01:47] [uid=0(root)] [INFO]some files in /etc/ change success<br>[Driver] [2025-07-05 15:01:47] [INFO]End time: 2025-07-05 15:01:47<br></code></pre></td></tr></table></figure>
<p>以上日志显示“DKMS 在构建驱动模块时失败，导致 <code>.ko</code>
内核模块未生成”。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">我的解决办法：</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">（1）卸载原有的未安装成功的驱动</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">（2）转而使用Ascend-hdk-910b-npu-driver_24.1.rc3_linux-aarch64.deb、Ascend-hdk-910b-npu-firmware_7.5.0.1.129.deb安装驱动与固件</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">（3）添加执行权限</span><br>chmod +x Ascend-hdk-910b-npu-driver_24.1.rc3_linux-aarch64.deb<br>chmod +x Ascend-hdk-910b-npu-firmware_7.5.0.1.129.deb<br><span class="hljs-meta prompt_">#</span><span class="language-bash">（4）执行安装驱动</span><br>dpkg -i Ascend-hdk-910b-npu-driver_24.1.rc3_linux-aarch64.deb<br><span class="hljs-meta prompt_">#</span><span class="language-bash">（5）执行安装固件</span><br>dpkg -i Ascend-hdk-910b-npu-firmware_7.5.0.1.129.deb<br></code></pre></td></tr></table></figure>
<h1 id="三安装集群调度组件">三、安装集群调度组件</h1>
<h2 id="前置知识">前置知识</h2>
<p>如下截图来自以下文档： <a
target="_blank" rel="noopener" href="https://www.hiascend.com/doc_center/source/zh/mindcluster/70rc1/clustersched/dlug/MindCluster%207.0.RC1%20%E9%9B%86%E7%BE%A4%E8%B0%83%E5%BA%A6%E7%94%A8%E6%88%B7%E6%8C%87%E5%8D%97.pdf">MindCluster
7.0.RC1 集群调度用户指南</a> 的“3.5.2”章节</p>
<figure>
<img src="https://s2.loli.net/2025/07/02/leXtuAwBHJj26ic.png" srcset="/img/loading.gif" lazyload
alt="image-20250702172432315" />
<figcaption aria-hidden="true">image-20250702172432315</figcaption>
</figure>
<p>支持的产品和OS清单 ： <a
target="_blank" rel="noopener" href="https://www.hiascend.com/document/detail/zh/mindcluster/70rc1/deployer/deployerug/deployer_0002.html">支持的产品和OS清单</a>
，其中910B加速卡属于Atlas 900系列训练卡，与训练服务器（如800T
A2）的定位一致，适合集群调度组件的部署。</p>
<figure>
<img src="https://s2.loli.net/2025/07/02/JIEUf2mHe3FXWZv.png" srcset="/img/loading.gif" lazyload
alt="image-20250702172707185" />
<figcaption aria-hidden="true">image-20250702172707185</figcaption>
</figure>
<h2 id="获取ascend-deployer-安装部署工具">获取Ascend Deployer
安装部署工具</h2>
<p>参考文档： <a
target="_blank" rel="noopener" href="https://www.hiascend.com/document/detail/zh/mindcluster/70rc1/deployer/deployerug/deployer_0003.html">离线获取Ascend
Deployer 安装部署工具</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:/opt/jiang# mkdir deploy_by_ascend_deployer <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">需要在gitee上登录后下载，下载后保存到/opt/jiang/deploy_by_ascend_deployer</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# ls -alh<br>total 864K<br>drwxr-xr-x 2 root root 4.0K Jul  2 21:58 .<br>drwxr-xr-x 4 root root 4.0K Jul  2 21:55 ..<br>-rw-r--r-- 1 root root 853K Jul  2 21:56 ascend-deployer-7.0.RC1.zip<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">解压</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# apt install unzip -y<br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# unzip ascend-deployer-7.0.RC1.zip<br></code></pre></td></tr></table></figure>
<h2 id="软件包的下载">软件包的下载</h2>
<p>参考文档：<a
target="_blank" rel="noopener" href="https://www.hiascend.com/document/detail/zh/mindcluster/70rc1/deployer/deployerug/deployer_0011.html">在Linux系统上下载</a>
。官方给出了两种方式，此处使用方式二。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">进入MindCluster Ascend Deployer解压后的目录</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# cd ascend-deployer-7.0.RC1/ascend_deployer/<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">执行如下命令</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# bash start_download.sh --os-list=&lt;OS&gt; --download=&lt;PK1&gt;,&lt;PK2&gt;==&lt;Version&gt;</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">我的操作系统是Ubuntu 22.04.5 LTS，所以--os-list=Ubuntu_22.04.4_aarch64</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">--download=CANN,NPU,DL==7.0.RC1,FaultDiag==7.0.RC1</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# bash start_download.sh --os-list=Ubuntu_22.04.4_aarch64 --download=CANN,NPU=,DL==7.0.RC1,FaultDiag==7.0.RC1,TensorFlow==2.6.5<br>version of NPU not selected, use NPU_25.0.RC1 as default<br>version of CANN not selected, use CANN_8.1.RC1 as default<br>...<br>download and check --os-list=Ubuntu_22.04.4_aarch64 --download=NPU,CANN,FaultDiag==7.0.RC1,DL==7.0.RC1...:Success<br>Time Cost: 573.28s<br><span class="hljs-meta prompt_">#</span><span class="language-bash">下载完成后，有如上输出内容</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">下载完成后，文件存放在当前目录的resources目录下</span><br></code></pre></td></tr></table></figure>
<h2 id="远程连接服务器">远程连接服务器</h2>
<p>参考文档： <a
target="_blank" rel="noopener" href="https://www.hiascend.com/document/detail/zh/mindcluster/70rc1/deployer/deployerug/deployer_0012.html">远程连接服务器</a>
。</p>
<p>此处为了方便，我为部署节点到其他节点（其实只有一个服务器）做了ssh免密登录。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:/opt/jiang/deploy_by_ascend_deployer# ssh-keygen -t rsa -b 3072<br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# ssh-copy-id root@controller01<br></code></pre></td></tr></table></figure>
<h2 id="配置服务器安装部署参数">配置服务器安装部署参数</h2>
<h3 id="配置批量待安装场景">配置批量待安装场景</h3>
<p>参考文档：<a
target="_blank" rel="noopener" href="https://www.hiascend.com/document/detail/zh/mindcluster/70rc1/deployer/deployerug/deployer_0013.html">配置批量待安装场景</a>
。单机安装可跳过。</p>
<h3 id="配置参数面网络">配置参数面网络</h3>
<h4 id="功能介绍">功能介绍</h4>
<p>参考文档：<a
target="_blank" rel="noopener" href="https://www.hiascend.com/document/detail/zh/mindcluster/70rc1/deployer/deployerug/deployer_0024.html">功能介绍</a>
。</p>
<p>当进行分布式训练时，需要通过配置device的网卡IP，用于多个device间通信以实现网络模型参数的同步更新。此文档中阐述了3种配置方法，我使用了第1种：通过<a
target="_blank" rel="noopener" href="https://www.hiascend.com/document/detail/zh/mindcluster/70rc1/deployer/deployerug/deployer_0025.html">修改MindCluster
Ascend
Deployer工具提供的inventory_file</a>，并执行脚本配置device的网卡IP。</p>
<h4 id="使用mindcluster-ascend-deployer配置">使用MindCluster Ascend
Deployer配置</h4>
<p>参考文档：<a
target="_blank" rel="noopener" href="https://www.hiascend.com/document/detail/zh/mindcluster/70rc1/deployer/deployerug/deployer_0025.html">使用MindCluster
Ascend Deployer配置</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">备份inventory_file</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# cp inventory_file&#123;,.bak&#125;<br><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# vi inventory_file<br>[hccn]<br>113.57.37.106 ansible_ssh_user=&quot;root&quot; deviceip=10.20.0.2,10.20.0.3,10.20.0.4,10.20.0.5,10.20.0.6,10.20.0.7,10.20.0.8,10.20.0.9 detectip=10.20.0.1,10.20.0.1,10.20.0.1,10.20.0.1,10.20.0.1,10.20.0.1,10.20.0.1,10.20.0.1<br><span class="hljs-meta prompt_">#</span><span class="language-bash">192.168.10.3 ansible_ssh_user=<span class="hljs-string">&quot;root&quot;</span> deviceip=10.20.0.10,10.20.0.11,10.20.0.12,10.20.0.13,10.20.0.14,10.20.0.15,10.20.0.16,10.20.0.17 detectip=10.20.0.1,10.20.0.1,10.20.0.1,10.20.0.1,10.20.0.1,10.20.0.1,10.20.0.1,10.20.0.1</span><br><br>[hccn:vars]<br>gateways=&quot;10.20.0.1&quot;<br>netmask=&quot;255.255.255.0&quot;<br>roce_port=4791<br>bitmap=&quot;&quot;<br>dscp_tc=&quot;&quot;<br>common_network=&quot;&quot;<br>...<br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# bash install.sh --hccn --check<br><br>PLAY [localhost] ********************************************************************************************************<br><br>TASK [check user] *******************************************************************************************************<br>changed: [localhost]<br><br>PLAY [hccn] *************************************************************************************************************<br><br>TASK [check hccn config] ************************************************************************************************<br>changed: [113.57.37.106]<br><br>TASK [check npu] ********************************************************************************************************<br>changed: [113.57.37.106]<br><br>TASK [handle npu check error] *******************************************************************************************<br>skipping: [113.57.37.106]<br><br>PLAY RECAP **************************************************************************************************************<br>113.57.37.106              : ok=2    changed=2    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   <br>localhost                  : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   <br><br>run cmd: --hccn --check successfully<br></code></pre></td></tr></table></figure>
<h4
id="安装mindcluster集群调度前配置">安装MindCluster集群调度前配置</h4>
<p>参考文档：<a
target="_blank" rel="noopener" href="https://www.hiascend.com/document/detail/zh/mindcluster/70rc1/deployer/deployerug/deployer_0014.html">安装MindCluster集群调度前配置</a></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment">#修改后文件内容如下：</span><br><span class="hljs-section">[hccn]</span><br>113.57.37.106 <span class="hljs-attr">ansible_ssh_user</span>=<span class="hljs-string">&quot;root&quot;</span> deviceip=<span class="hljs-number">10.20</span>.<span class="hljs-number">0.2</span>,<span class="hljs-number">10.20</span>.<span class="hljs-number">0.3</span>,<span class="hljs-number">10.20</span>.<span class="hljs-number">0.4</span>,<span class="hljs-number">10.20</span>.<span class="hljs-number">0.5</span>,<span class="hljs-number">10.20</span>.<span class="hljs-number">0.6</span>,<span class="hljs-number">10.20</span>.<span class="hljs-number">0.7</span>,<span class="hljs-number">10.20</span>.<span class="hljs-number">0.8</span>,<span class="hljs-number">10.20</span>.<span class="hljs-number">0.9</span> detectip=<span class="hljs-number">10.20</span>.<span class="hljs-number">0.1</span>,<span class="hljs-number">10.20</span>.<span class="hljs-number">0.1</span>,<span class="hljs-number">10.20</span>.<span class="hljs-number">0.1</span>,<span class="hljs-number">10.20</span>.<span class="hljs-number">0.1</span>,<span class="hljs-number">10.20</span>.<span class="hljs-number">0.1</span>,<span class="hljs-number">10.20</span>.<span class="hljs-number">0.1</span>,<span class="hljs-number">10.20</span>.<span class="hljs-number">0.1</span>,<span class="hljs-number">10.20</span>.<span class="hljs-number">0.1</span><br><span class="hljs-comment">#192.168.10.3 ansible_ssh_user=&quot;root&quot; deviceip=10.20.0.10,10.20.0.11,10.20.0.12,10.20.0.13,10.20.0.14,10.20.0.15,10.20.0.16,10.20.0.17 detectip=10.20.0.1,10.20.0.1,10.20.0.1,10.20.0.1,10.20.0.1,10.20.0.1,10.20.0.1,10.20.0.1</span><br><br><span class="hljs-section">[hccn:vars]</span><br><span class="hljs-attr">gateways</span>=<span class="hljs-string">&quot;10.20.0.1&quot;</span><br><span class="hljs-attr">netmask</span>=<span class="hljs-string">&quot;255.255.255.0&quot;</span><br><span class="hljs-attr">roce_port</span>=<span class="hljs-number">4791</span><br><span class="hljs-attr">bitmap</span>=<span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attr">dscp_tc</span>=<span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attr">common_network</span>=<span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-section">[master]</span><br><span class="hljs-comment">## 10.10.10.1-10.10.10.9 ansible_ssh_user=&quot;root&quot; ansible_ssh_pass=&quot;test1234&quot; step_len=3</span><br>113.57.37.106 <span class="hljs-attr">ansible_ssh_user</span>=<span class="hljs-string">&quot;root&quot;</span> set_hostname=<span class="hljs-string">&quot;controller01&quot;</span> npu_num=<span class="hljs-number">8</span><br><br><span class="hljs-section">[worker]</span><br>localhost <span class="hljs-attr">ansible_connection</span>=<span class="hljs-string">&#x27;local&#x27;</span> ansible_ssh_user=<span class="hljs-string">&#x27;root&#x27;</span> set_hostname=<span class="hljs-string">&quot;controller01&quot;</span><br><span class="hljs-comment"># 10.10.10.1-10.10.10.9 ansible_ssh_user=&quot;root&quot; ansible_ssh_pass=&quot;test1234&quot; step_len=3</span><br><br><span class="hljs-section">[npu_node]</span><br><span class="hljs-comment"># 10.10.10.1-10.10.10.9 ansible_ssh_user=&quot;root&quot; ansible_ssh_pass=&quot;test1234&quot; step_len=3</span><br>113.57.37.106 <span class="hljs-attr">ansible_ssh_user</span>=<span class="hljs-string">&quot;root&quot;</span> set_hostname=<span class="hljs-string">&quot;controller01&quot;</span> npu_num=<span class="hljs-number">8</span><br><br><span class="hljs-section">[other_build_image]</span><br><br><span class="hljs-section">[all:vars]</span><br><span class="hljs-attr">SCALE</span>=<span class="hljs-string">&quot;false&quot;</span><br><span class="hljs-attr">RUNNER_IP</span>=<span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attr">WEIGHTS_PATH</span>=<span class="hljs-string">&quot;&quot;</span><br></code></pre></td></tr></table></figure>
<h2 id="执行安装命令">执行安装命令</h2>
<p>请按照“<strong>python&gt;npu&gt;CANN、MindIE、MindCluster</strong>（性能测试，故障诊断，集群调度）”的顺序进行安装，安装时resources目录下的CANN包版本需和npu配套。</p>
<h3 id="执行命令">执行命令</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">1.系统环境初始化（安装python）</span><br>export USE_K8S_VERSION=&quot;1.23.17&quot;<br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# bash install.sh --install=python<br>...<br>PLAY RECAP **************************************************************************************************************<br>113.57.37.106              : ok=9    changed=8    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   <br>localhost                  : ok=6    changed=5    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   <br><br>run cmd: --install=python successfully<br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">2.系统环境初始化（安装sys_pkg）</span><br>export USE_K8S_VERSION=&quot;1.23.17&quot;<br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# bash install.sh --install=sys_pkg<br>...<br>TASK [process report] ***************************************************************************************************<br>changed: [113.57.37.106 -&gt; localhost]<br><br>PLAY RECAP **************************************************************************************************************<br>113.57.37.106              : ok=9    changed=8    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   <br>localhost                  : ok=9    changed=7    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0   <br><br>run cmd: --install=sys_pkg successfully<br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">3.NPU固件与驱动（因为自己已经安装了驱动24.1.rc3、固件7.5.0.1.129，所以跳过此操作）。以下是执行时要执行的命令</span><br>export USE_K8S_VERSION=&quot;1.23.17&quot;<br>bash install.sh --install=npu<br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">4.CANN软件（训练&amp;推理&amp;开发调试场景）</span><br>export USE_K8S_VERSION=&quot;1.23.17&quot;<br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# bash install.sh --install=kernels,toolkit<br>...<br>PLAY RECAP **************************************************************************************************************<br>113.57.37.106              : ok=9    changed=8    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   <br>localhost                  : ok=9    changed=6    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   <br><br>run cmd: --install=kernels,toolkit successfully<br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">5.MindCluster集群调度（未安装“Resilience Controller组件 resilience-controller，提示不支持）</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##bash install.sh --install=resilience-controller</span></span><br>export USE_K8S_VERSION=&quot;1.23.17&quot;<br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# bash install.sh --install=ascend-device-plugin,ascend-docker-runtime,hccl-controller,noded,npu-exporter,volcano,ascend-operator,clusterd<br>...<br>PLAY RECAP **************************************************************************************************************<br>113.57.37.106              : ok=58   changed=50   unreachable=0    failed=0    skipped=6    rescued=0    ignored=0   <br>localhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   <br><br>run cmd: --install=ascend-device-plugin,ascend-docker-runtime,hccl-controller,noded,npu-exporter,volcano,ascend-operator,clusterd successfully<br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">6.MindCluster集群调度（MindIO）,安装失败，暂不理会</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# bash install.sh --install=mindio<br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">7.MindCluster性能测试</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# bash install.sh --install=toolbox<br>...<br>PLAY RECAP **************************************************************************************************************<br>113.57.37.106              : ok=13   changed=11   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   <br>localhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   <br><br>run cmd: --install=toolbox successfully<br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">8.MindCluster故障诊断</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# bash install.sh --install=fault-diag<br>...<br>PLAY RECAP **************************************************************************************************************<br>113.57.37.106              : ok=13   changed=11   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   <br>localhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   <br><br>run cmd: --install=fault-diag successfully<br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">9.CANN软件（边缘推理场景）</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# bash install.sh --install=nnrt,kernels<br>...<br>PLAY RECAP **************************************************************************************************************<br>113.57.37.106              : ok=15   changed=12   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   <br>localhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   <br><br><br>run cmd: --install=nnrt,kernels successfully<br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">10.CANN软件（训练&amp;推理场景）</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# bash install.sh --install=nnae,kernels<br>...<br>PLAY RECAP **************************************************************************************************************<br>113.57.37.106              : ok=15   changed=12   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   <br>localhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   <br><br>run cmd: --install=nnae,kernels successfully<br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">11.本来还想安装tensorflow（但不支持：Check os failed: [ASCEND] tensorflow has no support <span class="hljs-keyword">for</span> Ubuntu_22.04.4_aarch64 on this device）</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# bash install.sh --install=tensorflow<br>...<br></code></pre></td></tr></table></figure>
<p>查看安装报告report.csv和report.json文件（当前路径下生成report目录）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# ll report/<br>total 20<br>drwxr-xr-x  3 root root 4096 Jul  7 14:49 ./<br>drwxr-xr-x 16 root root 4096 Jul  7 13:00 ../<br>drwxr-xr-x  3 root root 4096 Jul  7 14:49 cache/<br>-rw-r--r--  1 root root  773 Jul  7 14:49 report.csv<br>-rw-r--r--  1 root root 1531 Jul  7 14:49 report.json<br><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# cat report/report.json | jq<br>&#123;<br>  &quot;113.57.37.106&quot;: &#123;<br>    &quot;node name&quot;: &quot;controller01&quot;,<br>    &quot;node type&quot;: &quot;master,worker&quot;,<br>    &quot;status&quot;: &quot;Ready&quot;,<br>    &quot;ready pods&quot;: [<br>      &quot;kube-flannel-ds-shsdv&quot;,<br>      &quot;ascend-device-plugin-daemonset-r5ct4&quot;,<br>      &quot;coredns-6d8c4cb4d-fmjkw&quot;,<br>      &quot;coredns-6d8c4cb4d-nzn5v&quot;,<br>      &quot;etcd-controller01&quot;,<br>      &quot;kube-apiserver-controller01&quot;,<br>      &quot;kube-controller-manager-controller01&quot;,<br>      &quot;kube-proxy-7cccn&quot;,<br>      &quot;kube-scheduler-controller01&quot;,<br>      &quot;ascend-operator-manager-65557b4b45-npwcx&quot;,<br>      &quot;clusterd-65d6d749dd-qjcgg&quot;,<br>      &quot;noded-bbpwh&quot;,<br>      &quot;npu-exporter-bgxn4&quot;,<br>      &quot;volcano-controllers-7d7b54c6bb-q5hbw&quot;,<br>      &quot;volcano-scheduler-67cf6bdccf-tzt2r&quot;<br>    ],<br>    &quot;missing pods&quot;: [<br>      &quot;calico-node&quot;,<br>      &quot;calico-kube-controllers&quot;,<br>      &quot;hccl-controller&quot;<br>    ],<br>    &quot;dl result&quot;: &quot;failed&quot;,<br>    &quot;packages&quot;: [<br>      &#123;<br>        &quot;name&quot;: &quot;firmware&quot;,<br>        &quot;install_arch&quot;: &quot;aarch64&quot;,<br>        &quot;install_path&quot;: &quot;/usr/local/Ascend&quot;,<br>        &quot;version&quot;: &quot;7.5.0.1.129&quot;<br>      &#125;,<br>      &#123;<br>        &quot;name&quot;: &quot;driver&quot;,<br>        &quot;install_arch&quot;: &quot;aarch64&quot;,<br>        &quot;install_path&quot;: &quot;/usr/local/Ascend&quot;,<br>        &quot;version&quot;: &quot;24.1.rc3&quot;<br>      &#125;,<br>      &#123;<br>        &quot;name&quot;: &quot;nnrt&quot;,<br>        &quot;install_path&quot;: &quot;/usr/local/Ascend/nnrt/8.1.RC1/aarch64-linux&quot;,<br>        &quot;install_arch&quot;: &quot;aarch64&quot;,<br>        &quot;version&quot;: &quot;8.1.RC1&quot;<br>      &#125;,<br>      &#123;<br>        &quot;name&quot;: &quot;toolkit&quot;,<br>        &quot;install_path&quot;: &quot;/usr/local/Ascend/ascend-toolkit/8.1.RC1/aarch64-linux&quot;,<br>        &quot;install_arch&quot;: &quot;aarch64&quot;,<br>        &quot;version&quot;: &quot;8.1.RC1&quot;<br>      &#125;,<br>      &#123;<br>        &quot;name&quot;: &quot;nnae&quot;,<br>        &quot;install_path&quot;: &quot;/usr/local/Ascend/nnae/8.1.RC1&quot;,<br>        &quot;install_arch&quot;: &quot;aarch64&quot;,<br>        &quot;version&quot;: &quot;8.1.RC1&quot;<br>      &#125;,<br>      &#123;<br>        &quot;name&quot;: &quot;tfplugin&quot;,<br>        &quot;install_path&quot;: &quot;/usr/local/Ascend/tfplugin/7.0.RC1&quot;,<br>        &quot;install_arch&quot;: &quot;aarch64&quot;,<br>        &quot;version&quot;: &quot;7.0.RC1&quot;<br>      &#125;,<br>      &#123;<br>        &quot;name&quot;: &quot;toolbox&quot;,<br>        &quot;install_path&quot;: &quot;/usr/local/Ascend/toolbox/7.0.RC1&quot;,<br>        &quot;install_arch&quot;: &quot;aarch64&quot;,<br>        &quot;version&quot;: &quot;7.0.RC1&quot;<br>      &#125;<br>    ],<br>    &quot;npu&quot;: &quot;910B3:8&quot;,<br>    &quot;mcu&quot;: &quot;npu_id_0:23.2.4,npu_id_1:23.2.4,npu_id_2:23.2.4,npu_id_3:23.2.4,npu_id_4:23.2.4,npu_id_5:23.2.4,npu_id_6:23.2.4,npu_id_7:23.2.4&quot;,<br>    &quot;hccn&quot;: [<br>      &quot;net health status: Init&quot;,<br>      &quot;net health status: Init&quot;,<br>      &quot;net health status: Init&quot;,<br>      &quot;net health status: Init&quot;,<br>      &quot;net health status: Init&quot;,<br>      &quot;net health status: Init&quot;,<br>      &quot;net health status: Init&quot;,<br>      &quot;net health status: Init&quot;<br>    ]<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>查看安装进度信息文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# ll ~/.ascend_deployer/deploy_info<br>total 20<br>drwxr-xr-x 2 root root 4096 Jul  7 12:30 ./<br>drwxr-xr-x 4 root root 4096 Jul  7 13:01 ../<br>-rw-r--r-- 1 root root 3719 Jul  7 14:46 check_res_output.json<br>-rw-r--r-- 1 root root 5306 Jul  7 14:49 deployer_progress_output.json<br></code></pre></td></tr></table></figure>
<h3 id="报错与异常处理-1">报错与异常处理</h3>
<h4
id="安装sys_pkg时执行task-install-system-packages失败">安装sys_pkg时执行“TASK
[install system packages]”失败</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">系统环境初始化（安装sys_pkg）</span><br>export USE_K8S_VERSION=&quot;1.23.17&quot;<br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# bash install.sh --install=sys_pkg <br>...<br>TASK [check nexus status] ***********************************************************************************************<br>changed: [localhost]<br><br>TASK [copy file to host] ************************************************************************************************<br>changed: [localhost] =&gt; (item=&#123;&#x27;src&#x27;: &#x27;/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer/scripts/nexus_config.json&#x27;, &#x27;dest&#x27;: &#x27;~/nexus/&#x27;&#125;)<br>changed: [localhost] =&gt; (item=&#123;&#x27;src&#x27;: &#x27;/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer/downloader/config/Ubuntu_22.04.4_aarch64/pkg_info.json&#x27;, &#x27;dest&#x27;: &#x27;~/nexus/&#x27;&#125;)<br>changed: [localhost] =&gt; (item=&#123;&#x27;src&#x27;: &#x27;/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer/resources/nexus/nexus_pub.asc&#x27;, &#x27;dest&#x27;: &#x27;/etc/apt/trusted.gpg.d/&#x27;&#125;)<br><br>TASK [install system packages] ******************************************************************************************<br>task path: /opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer/playbooks/install/install_sys_pkg.yml:26<br>fatal: [localhost]: FAILED! =&gt; &#123;&quot;changed&quot;: true, &quot;failed_when_result&quot;: true, &quot;msg&quot;: &quot;\nWARNING: apt does not have a stable CLI interface. Use with caution in scripts.\n\nE: Unable to correct problems, you have held broken packages.\n&quot;, &quot;rc&quot;: 1&#125;<br><br>PLAY RECAP **************************************************************************************************************<br>113.57.37.106              : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   <br>localhost                  : ok=5    changed=4    unreachable=0    failed=1    skipped=1    rescued=0    ignored=0   <br><br>run cmd: --install=sys_pkg failed, reason: returned non-zero exit status 2<br></code></pre></td></tr></table></figure>
<p>最终通过定位，发现是在宿主机上执行如下命令报错<code>\nWARNING: apt does not have a stable CLI interface. Use with caution in scripts.\n\nE: Unable to correct problems, you have held broken packages.\n</code>·</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">apt</span> install -y --no-install-recommends libxcb-dri2-<span class="hljs-number">0</span> libcc1-<span class="hljs-number">0</span> libsepol-dev libglx0 libasan6 tk dctrl-tools g++ emacsen-common libpthread-stubs0-dev cmake-data dpkg-dev libsqlite3-dev libxft2 bzip2 libxft-dev libblkid-dev libdeflate0 libexpat1 libxcb-xfixes0 libbz2-dev xtrans-dev dconf-service libdrm-radeon1 libselinux1-dev libjbig0 libx11-xcb1 g++-<span class="hljs-number">11</span> sshpass libxcb-present0 libfakeroot libbrotli-dev x11proto-core-dev libglib2.<span class="hljs-number">0</span>-bin libalgorithm-diff-perl libglib2.<span class="hljs-number">0</span>-dev-bin x11-utils net-tools libgdbm-dev dkms libxcb-dri3-<span class="hljs-number">0</span> fonts-dejavu-core fakeroot cpp libice6 libmount1 bzip2-doc libxcb-shm0 libxinerama1 libgomp1 gir1.<span class="hljs-number">2</span>-gdm-<span class="hljs-number">1</span>.<span class="hljs-number">0</span> libpcre32-<span class="hljs-number">3</span> libfontconfig1-dev libreadline-dev libssl3 libpcre2-<span class="hljs-number">16</span>-<span class="hljs-number">0</span> tcl8.<span class="hljs-number">6</span>-dev gcc-<span class="hljs-number">11</span>-base libatomic1 libllvm15 cmake gcc libsensors5 make libxcb-glx0 libtk8.<span class="hljs-number">6</span> libmount-dev libglib2.<span class="hljs-number">0</span>-dev cpp-<span class="hljs-number">12</span> libnsl-dev libxdmcp-dev libblkid1 liblzma-dev libgdm1 libhavege2 libalgorithm-merge-perl libpng-dev libxt6 unzip libgl1-amber-dri libfontconfig1 libffi-dev libpcre2-posix3 libcrypt-dev libc6-dev libxau-dev build-essential tk8.<span class="hljs-number">6</span>-dev libubsan1 libasan8 libuuid1 libstdc++-<span class="hljs-number">11</span>-dev libglvnd0 libxcb-shape0 xterm uuid-dev libx11-dev cpp-<span class="hljs-number">11</span> linux-libc-dev libxi6 libxss-dev libxmu6 libisl23 libxcomposite1 libtiff5 zlib1g-dev libglapi-mesa libncurses-dev libxext-dev libncursesw5-dev libgd3 libxcb-randr0 librhash0 liblsan0 libxrender1 rpcsvc-proto libmpc3 libc6 libxaw7 libwebp7 libglib2.<span class="hljs-number">0</span>-<span class="hljs-number">0</span> libsm6 libdpkg-perl gcc-<span class="hljs-number">11</span> libexpat1-dev libjsoncpp25 x11proto-dev libjpeg8 libjpeg-turbo8 tk-dev libxpm4 libgl1 libxkbfile1 libfontenc1 libxfixes3 libc-dev-bin libxv1 libpcre3-dev fontconfig-config libxshmfence1 libglx-mesa0 manpages-dev libxss1 libpcrecpp0v5 libdrm-nouveau2 x11-common haveged libpcre16-<span class="hljs-number">3</span> libtsan0 libxxf86dga1 libdb5.<span class="hljs-number">3</span>-dev libgcc-<span class="hljs-number">12</span>-dev xbitmaps libdb-dev libsensors-config lto-disabled-list libfreetype-dev xorg-sgml-doctools libpng-tools libfile-fcntllock-perl libxtst6 libgcc-<span class="hljs-number">11</span>-dev libalgorithm-diff-xs-perl libxcb-sync1 pkg-config libfreetype6-dev libdconf1 libxrender-dev libxcb1-dev tk8.<span class="hljs-number">6</span> libxxf86vm1 tcl-dev libfontconfig-dev libncurses5-dev libpcre2-dev libgdm-dev libitm1 libhwasan0 libxrandr2 libgl1-mesa-dri dh-elpa-helper libc-devtools libssl-dev libpcre2-<span class="hljs-number">32</span>-<span class="hljs-number">0</span> libdrm-amdgpu1 libtirpc-dev gcc-<span class="hljs-number">12</span> dconf-gsettings-backend libtsan2 -o Acquire::Check-Date=false -o Dir::Etc::sourcelist=/root/nexus/sources.list<br></code></pre></td></tr></table></figure>
<p>具体报错内容如下：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs vim">...<br>The following information may <span class="hljs-keyword">help</span> <span class="hljs-keyword">to</span> <span class="hljs-built_in">resolve</span> the situation:<br><br>The following packages have unmet dependencies:<br> libfreetype-dev : Depends: libfreetype6 (= <span class="hljs-number">2.11</span>.<span class="hljs-number">1</span>+dfsg-<span class="hljs-number">1</span>build1) but <span class="hljs-number">2.11</span>.<span class="hljs-number">1</span>+dfsg-<span class="hljs-number">1</span>ubuntu0.<span class="hljs-number">3</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">be</span> installed<br>E: Unable <span class="hljs-keyword">to</span> correct problems, you have held broken packages.<br></code></pre></td></tr></table></figure>
<p>解决办法如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:~# apt-get update<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">过程上遇到弹窗提示，使用默认值并直接回车。</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">提示要重启以启用新版本内核，暂不重启，如下：</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">Newer kernel available</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">The currently running kernel version is 5.15.0-94-generic <span class="hljs-built_in">which</span> is not the expected kernel version 5.15.0-143-generic.</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">Restarting the system to load the new kernel will not be handled automatically, so you should consider rebooting.</span><br>root@controller01:~# apt install libfreetype6=2.11.1+dfsg-1build1<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">查看安装的libfreetype6组件版本</span><br>root@controller01:~# dpkg -l | grep libfreetype                     <br>ii  libfreetype6:arm64       2.11.1+dfsg-1build1       arm64        FreeType 2 font engine, shared library files<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">系统环境初始化（安装sys_pkg），成功！</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# export USE_K8S_VERSION=&quot;1.23.17&quot;<br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# bash install.sh --install=sys_pkg<br>...<br>        &quot;cmake-data is already the newest version (3.22.1-1ubuntu1.22.04.2).&quot;,<br>        &quot;x11-common is already the newest version (1:7.7+23ubuntu2).&quot;,<br>        &quot;x11proto-core-dev is already the newest version (2021.5-1).&quot;,<br>        &quot;dh-elpa-helper is already the newest version (2.0.9ubuntu1).&quot;,<br>        &quot;fonts-dejavu-core is already the newest version (2.37-2build1).&quot;,<br>        &quot;net-tools is already the newest version (1.60+git20181103.0eebece-1ubuntu5.4).&quot;,<br>        &quot;0 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.&quot;,<br>        &quot;&quot;,<br>        &quot;sys_pkg installed successfully&quot;<br>    ]<br>&#125;<br><br>TASK [install gcc for centos] *******************************************************************************************<br>skipping: [localhost]<br><br>PLAY [collect package and system info] **********************************************************************************<br><br>TASK [clean caches] *****************************************************************************************************<br>changed: [113.57.37.106 -&gt; localhost]<br><br>TASK [collect package and system info] **********************************************************************************<br>changed: [localhost]<br>changed: [113.57.37.106]<br><br>PLAY [collect k8s info] *************************************************************************************************<br><br>TASK [check if k8s cluster exist] ***************************************************************************************<br>changed: [113.57.37.106]<br><br>TASK [collect k8s info] *************************************************************************************************<br>changed: [113.57.37.106]<br><br>TASK [fetch k8s reports] ************************************************************************************************<br>changed: [113.57.37.106]<br><br>PLAY [fetch reports] ****************************************************************************************************<br><br>TASK [fetch system reports] *********************************************************************************************<br>changed: [localhost]<br>changed: [113.57.37.106]<br><br>TASK [process report] ***************************************************************************************************<br>changed: [113.57.37.106 -&gt; localhost]<br><br>PLAY RECAP **************************************************************************************************************<br>113.57.37.106              : ok=9    changed=8    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   <br>localhost                  : ok=9    changed=7    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0   <br><br>jsy2,handler result: []<br>run cmd: --install=sys_pkg successfully<br></code></pre></td></tr></table></figure>
<h4
id="安装mindcluster集群调度时报错">安装MindCluster集群调度时报错</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">首先要保证kubectl、kubeadm、kubelet三者的版本一致</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# kubectl version<br>Client Version: version.Info&#123;Major:&quot;1&quot;, Minor:&quot;23&quot;, GitVersion:&quot;v1.23.10&quot;, GitCommit:&quot;7e54d50d3012cf3389e43b096ba35300f36e0817&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2022-08-17T18:32:54Z&quot;, GoVersion:&quot;go1.17.13&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/arm64&quot;&#125;<br>Server Version: version.Info&#123;Major:&quot;1&quot;, Minor:&quot;23&quot;, GitVersion:&quot;v1.23.17&quot;, GitCommit:&quot;953be8927218ec8067e1af2641e540238ffd7576&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2023-02-22T13:27:46Z&quot;, GoVersion:&quot;go1.19.6&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/arm64&quot;&#125;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">下载kubectl client v1.23.17</span><br>root@controller01:~# curl -LO &quot;https://dl.k8s.io/release/v1.23.17/bin/linux/arm64/kubectl&quot; --output-dir /opt/jiang/install-k8s1.23.17-kubeadm/<br>root@controller01:~# which kubectl<br>/usr/local/bin/kubectl<br>root@controller01:~# chmod a+x /opt/jiang/install-k8s1.23.17-kubeadm/kubectl<br>root@controller01:~# cp /opt/jiang/install-k8s1.23.17-kubeadm/kubectl /usr/local/bin/<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">再次查看kubectl client、kubectl server版本</span><br>root@controller01:~# kubectl version<br>Client Version: version.Info&#123;Major:&quot;1&quot;, Minor:&quot;23&quot;, GitVersion:&quot;v1.23.17&quot;, GitCommit:&quot;953be8927218ec8067e1af2641e540238ffd7576&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2023-02-22T13:34:27Z&quot;, GoVersion:&quot;go1.19.6&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/arm64&quot;&#125;<br>Server Version: version.Info&#123;Major:&quot;1&quot;, Minor:&quot;23&quot;, GitVersion:&quot;v1.23.17&quot;, GitCommit:&quot;953be8927218ec8067e1af2641e540238ffd7576&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2023-02-22T13:27:46Z&quot;, GoVersion:&quot;go1.19.6&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/arm64&quot;&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">5.MindCluster集群调度</span><br>export USE_K8S_VERSION=&quot;1.23.17&quot;<br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# bash install.sh --install=ascend-device-plugin,ascend-docker-runtime,hccl-controller,noded,npu-exporter,volcano,ascend-operator,clusterd<br>PLAY RECAP **************************************************************************************************************<br>113.57.37.106              : ok=58   changed=50   unreachable=0    failed=0    skipped=6    rescued=0    ignored=0   <br>localhost                  : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   <br><br>run cmd: --install=ascend-device-plugin,ascend-docker-runtime,hccl-controller,noded,npu-exporter,volcano,ascend-operator,clusterd successfully<br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">但若想执行如下命令，则报错失败：</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">具体来自“/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer/module_utils/check_library_utils/dl_checks.py”的check_resilience_controller_support方法，机制暂不明，先不理会</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">以下是对“Resilience Controller组件”的介绍：</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#组件应用场景</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">	<span class="hljs-comment">#训练任务遇到故障，且无充足的健康资源替换故障资源时，可使用动态缩容的方式保证训练任务继续进行，待资源充足后，再通过动态扩容的方式恢复训练任务。集群调度提供了Resilience Controller组件，用于训练任务过程中的动态扩缩容。</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#组件功能</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">	<span class="hljs-comment">#提供弹性缩容训练服务。在训练任务使用的硬件发生故障时，剔除该硬件并继续训练。</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#组件上下游依赖</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">	<span class="hljs-comment">#无。</span></span><br>bash install.sh --install=ascend-device-plugin,ascend-docker-runtime,hccl-controller,noded,npu-exporter,volcano,ascend-operator,clusterd,resilience-controller<br>...<br>TASK [show check message] ***********************************************************************************************<br>ok: [localhost] =&gt; &#123;<br>    &quot;check_result.stdout_lines&quot;: []<br>&#125;<br>ok: [113.57.37.106] =&gt; &#123;<br>    &quot;check_result.stdout_lines&quot;: [<br>        &quot;Check os failed: [ASCEND] resilience-controller has no support for Ubuntu_22.04.4_aarch64 on this device&quot;,<br>        &quot;[ASCEND][ERROR] Your device does not support resilience-controller.&quot;,<br>        &quot;For check details, please see ~/.ascend_deployer/deploy_info/check_res_output.json.&quot;<br>    ]<br>&#125;<br><br>PLAY [localhost] ********************************************************************************************************<br><br>TASK [Collect the check results of all hosts.] **************************************************************************<br>ok: [localhost]<br><br>TASK [output json] ******************************************************************************************************<br>changed: [localhost]<br><br>PLAY [localhost,master,worker] ******************************************************************************************<br><br>TASK [Fail if check_result is not correct] ******************************************************************************<br>skipping: [localhost]<br>task path: /opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer/playbooks/process/process_check.yml:142<br>fatal: [113.57.37.106]: FAILED! =&gt; &#123;&quot;changed&quot;: false, &quot;msg&quot;: &quot;The pre-check task failed, please check the show check message above or check the ~/.ascend_deployer/deploy_info/check_res_output.json file!&quot;&#125;<br><br>PLAY RECAP **************************************************************************************************************<br>113.57.37.106              : ok=10   changed=4    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0   <br>localhost                  : ok=10   changed=4    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0   <br><br>run cmd: --install=ascend-device-plugin,ascend-docker-runtime,hccl-controller,noded,npu-exporter,volcano,ascend-operator,clusterd,resilience-controller failed, reason: returned non-zero exit status 2<br></code></pre></td></tr></table></figure>
<h4
id="安装mindcluster集群调度后部署组件安装未成功">安装MindCluster集群调度后，部署组件安装未成功</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">5.MindCluster集群调度（未安装“Resilience Controller组件 resilience-controller，提示不支持）</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">##bash install.sh --install=resilience-controller</span></span><br>export USE_K8S_VERSION=&quot;1.23.17&quot;<br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# bash install.sh --install=ascend-device-plugin,ascend-docker-runtime,hccl-controller,noded,npu-exporter,volcano,ascend-operator,clusterd<br></code></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs json">root@controller01<span class="hljs-punctuation">:</span>/opt/jiang/deploy_by_ascend_deployer/ascend-deployer<span class="hljs-number">-7.0</span>.RC1/ascend_deployer/report# cat report.json | jq<br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;113.57.37.106&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;node name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;controller01&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;node type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;master,worker&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Ready&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;ready pods&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-string">&quot;kube-flannel-ds-shsdv&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;coredns-6d8c4cb4d-fmjkw&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;coredns-6d8c4cb4d-nzn5v&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;etcd-controller01&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;kube-apiserver-controller01&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;kube-controller-manager-controller01&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;kube-proxy-7cccn&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;kube-scheduler-controller01&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;ascend-operator-manager-65557b4b45-npwcx&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;clusterd-65d6d749dd-qjcgg&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;noded-bbpwh&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;npu-exporter-bgxn4&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;volcano-admission-784b85dc8b-vfdz5&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;volcano-controllers-7d7b54c6bb-q5hbw&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;volcano-scheduler-777cc9fdbc-tlsmg&quot;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;failed pods&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-string">&quot;volcano-admission-init-6mdrg&quot;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;missing pods&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-string">&quot;calico-node&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;ascend-device-plugin&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;calico-kube-controllers&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;hccl-controller&quot;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;dl result&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;failed&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;packages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;firmware&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;install_arch&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;aarch64&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;install_path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/usr/local/Ascend&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;7.5.0.1.129&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;driver&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;install_arch&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;aarch64&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;install_path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/usr/local/Ascend&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;24.1.rc3&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;nnrt&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;install_path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/usr/local/Ascend/nnrt/8.1.RC1/aarch64-linux&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;install_arch&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;aarch64&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;8.1.RC1&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;toolkit&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;install_path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/usr/local/Ascend/ascend-toolkit/8.1.RC1/aarch64-linux&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;install_arch&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;aarch64&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;8.1.RC1&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;nnae&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;install_path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/usr/local/Ascend/nnae/8.1.RC1&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;install_arch&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;aarch64&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;8.1.RC1&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;tfplugin&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;install_path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/usr/local/Ascend/tfplugin/7.0.RC1&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;install_arch&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;aarch64&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;7.0.RC1&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;toolbox&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;install_path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/usr/local/Ascend/toolbox/7.0.RC1&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;install_arch&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;aarch64&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;7.0.RC1&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;npu&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;910B3:8&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;mcu&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;npu_id_0:23.2.4,npu_id_1:23.2.4,npu_id_2:23.2.4,npu_id_3:23.2.4,npu_id_4:23.2.4,npu_id_5:23.2.4,npu_id_6:23.2.4,npu_id_7:23.2.4&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;hccn&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-string">&quot;net health status: Init&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;net health status: Init&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;net health status: Init&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;net health status: Init&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;net health status: Init&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;net health status: Init&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;net health status: Init&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;net health status: Init&quot;</span><br>        <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#其中volcano-admission-init-6mdrg部署失败，我已经通过手动覆盖部署volcano1.9.0安装部署成功</span></span><br>		&quot;failed pods&quot;: [<br>           &quot;volcano-admission-init-6mdrg&quot;<br>       ],<br><br></code></pre></td></tr></table></figure>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">bash <span class="hljs-keyword">install</span>.sh --<span class="hljs-keyword">install</span>=hccl-controller<br></code></pre></td></tr></table></figure>
<h2 id="检查安装结果">检查安装结果</h2>
<ul>
<li>全量测试</li>
</ul>
<p>参考文档： <a
target="_blank" rel="noopener" href="https://www.hiascend.com/document/detail/zh/mindcluster/70rc1/deployer/deployerug/deployer_0018.html">检查安装结果</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">检查已安装的全量组件及版本信息</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# bash install.sh --test=all<br>task info:Generate the test report                                                        <br>[===================================================]<br><br>&#123;&#x27;113.57.37.106&#x27;: &#123;&#x27;driver&#x27;: [&#x27;OK&#x27;, &#x27;24.1.RC3&#x27;], &#x27;firmware&#x27;: [&#x27;OK&#x27;, &#x27;7.5.0.1.129&#x27;], &#x27;mcu&#x27;: &#123;&#x27;npu_id_0&#x27;: &#x27;23.2.4&#x27;, &#x27;npu_id_1&#x27;: &#x27;23.2.4&#x27;, &#x27;npu_id_2&#x27;: &#x27;23.2.4&#x27;, &#x27;npu_id_3&#x27;: &#x27;23.2.4&#x27;, &#x27;npu_id_4&#x27;: &#x27;23.2.4&#x27;, &#x27;npu_id_5&#x27;: &#x27;23.2.4&#x27;, &#x27;npu_id_6&#x27;: &#x27;23.2.4&#x27;, &#x27;npu_id_7&#x27;: &#x27;23.2.4&#x27;&#125;, &#x27;toolbox&#x27;: [&#x27;OK&#x27;, &#x27;7.0.RC1&#x27;], &#x27;mindspore&#x27;: [&#x27;not installed&#x27;, &#x27;&#x27;], &#x27;pytorch&#x27;: [&#x27;not installed&#x27;, &#x27;&#x27;], &#x27;tensorflow&#x27;: [&#x27;not installed&#x27;, &#x27;&#x27;], &#x27;tfplugin&#x27;: [&#x27;not installed&#x27;, &#x27;&#x27;], &#x27;nnae&#x27;: [&#x27;not installed&#x27;, &#x27;&#x27;], &#x27;nnrt&#x27;: [&#x27;not installed&#x27;, &#x27;&#x27;], &#x27;toolkit&#x27;: [&#x27;OK&#x27;, &#x27;8.1.RC1&#x27;], &#x27;fault-diag&#x27;: [&#x27;OK&#x27;, &#x27;7.0.RC1&#x27;], &#x27;mindie_image&#x27;: [&#x27;not installed&#x27;, &#x27;&#x27;]&#125;&#125;<br><br>controller01: &#123;&#x27;ascend-operator&#x27;: [&#x27;OK&#x27;, &#x27;v7.0.RC1&#x27;], &#x27;clusterd&#x27;: [&#x27;OK&#x27;, &#x27;v7.0.RC1&#x27;], &#x27;resilience-controller&#x27;: [&#x27;not installed&#x27;, &#x27;&#x27;], &#x27;hccl-controller&#x27;: [&#x27;not installed&#x27;, &#x27;&#x27;], &#x27;volcano&#x27;: [&#x27;OK&#x27;, &#x27;v1.9.0&#x27;], &#x27;ascend-device-plugin&#x27;: [&#x27;not installed&#x27;, &#x27;&#x27;], &#x27;noded&#x27;: [&#x27;OK&#x27;, &#x27;v7.0.RC1&#x27;], &#x27;npu-exporter&#x27;: [&#x27;OK&#x27;, &#x27;v7.0.RC1&#x27;], &#x27;ascend-docker-runtime&#x27;: [&#x27;OK&#x27;, &#x27;v7.0.RC1&#x27;]&#125;<br><br><br>npu-clusters<br>--------------+--------------+----------------<br>npu           | driver       | firmware       <br>--------------+--------------+----------------<br>113.57.37.106 | OK, 24.1.RC3 | OK, 7.5.0.1.129<br>--------------+--------------+----------------<br><br>mcu-version<br>--------------+----------+----------+----------+----------+----------+----------+----------+---------<br>ip            | npu_id_0 | npu_id_1 | npu_id_2 | npu_id_3 | npu_id_4 | npu_id_5 | npu_id_6 | npu_id_7<br>--------------+----------+----------+----------+----------+----------+----------+----------+---------<br>113.57.37.106 | 23.2.4   | 23.2.4   | 23.2.4   | 23.2.4   | 23.2.4   | 23.2.4   | 23.2.4   | 23.2.4  <br>--------------+----------+----------+----------+----------+----------+----------+----------+---------<br><br>cann-clusters<br>--------------+-------------+---------------+---------------+---------------+-------------+--------------<br>cann          | toolbox     | tfplugin      | nnae          | nnrt          | toolkit     | mindie_image <br>--------------+-------------+---------------+---------------+---------------+-------------+--------------<br>113.57.37.106 | OK, 7.0.RC1 | OK, 7.0.RC1   | OK, 8.1.RC1   | OK, 8.1.RC1   | OK, 8.1.RC1 | not installed<br>--------------+-------------+---------------+---------------+---------------+-------------+--------------<br><br>pypkg-clusters<br>--------------+---------------+---------------+---------------+------------<br>pypkg         | mindspore     | tensorflow    | pytorch       | fault-diag <br>--------------+---------------+---------------+---------------+------------<br>113.57.37.106 | not installed | not installed | not installed | OK, 7.0.RC1<br>--------------+---------------+---------------+---------------+------------<br><br><br>dl-clusters(master-node)<br>-------------+-----------------+--------------+-----------------+------------+----------------------<br>master-node  | ascend-operator | clusterd     | hccl-controller | volcano    | resilience-controller<br>-------------+-----------------+--------------+-----------------+------------+----------------------<br>controller01 | OK, v7.0.RC1    | OK, v7.0.RC1 | not installed   | OK, v1.9.0 | not installed        <br>-------------+-----------------+--------------+-----------------+------------+----------------------<br><br>dl-clusters(worker-node)<br>-------------+----------------------+-----------------------+--------------+-------------<br>worker-node  | ascend-device-plugin | ascend-docker-runtime | noded        | npu-exporter<br>-------------+----------------------+-----------------------+--------------+-------------<br>controller01 | not installed        | OK, v7.0.RC1          | OK, v7.0.RC1 | OK, v7.0.RC1<br>-------------+----------------------+-----------------------+--------------+-------------<br> =&gt; localhost <br>ascend deployer processed success<br>run cmd: --test=all successfully<br></code></pre></td></tr></table></figure>
<p>（1）不知道为啥
？ascend-device-plugin显示未安装，在k8s中也确实也没有看到，采用如下方法处理：</p>
<p><code>CANN 8.0.0及之后的版本中不再支持tfplugin</code>：https://www.hiascend.com/document/detail/zh/mindcluster/70rc1/deployer/deployerug/deployer_0068.html#ZH-CN_TOPIC_0000002290138177__section788019346518</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">github仓库： https://gitee.com/ascend/mind-cluster</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# wget https://gitee.com/ascend/mind-cluster/releases/download/v7.0.RC1/Ascend-mindxdl-device-plugin_7.0.RC1_linux-aarch64.zip<br><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# mkdir Ascend-mindxdl-device-plugin_7.0.RC1_linux-aarch64<br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# unzip Ascend-mindxdl-device-plugin_7.0.RC1_linux-aarch64.zip -d ./Ascend-mindxdl-device-plugin_7.0.RC1_linux-aarch64<br><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# ls -alh Ascend-mindxdl-device-plugin_7.0.RC1_linux-aarch64<br>total 44M<br>drwxr-xr-x 2 root root 4.0K Jul  7 15:31 .<br>drwxr-xr-x 5 root root 4.0K Jul  7 15:30 ..<br>-r-x------ 1 root root  44M Apr 17 16:43 device-plugin<br>-r-------- 1 root root 5.3K Apr 17 16:43 device-plugin-310P-1usoc-v7.0.RC1.yaml<br>-r-------- 1 root root 5.3K Apr 17 16:43 device-plugin-310P-1usoc-volcano-v7.0.RC1.yaml<br>-r-------- 1 root root 4.7K Apr 17 16:43 device-plugin-310P-v7.0.RC1.yaml<br>-r-------- 1 root root 4.9K Apr 17 16:43 device-plugin-310P-volcano-v7.0.RC1.yaml<br>-r-------- 1 root root 4.4K Apr 17 16:43 device-plugin-310-v7.0.RC1.yaml<br>-r-------- 1 root root 4.4K Apr 17 16:43 device-plugin-310-volcano-v7.0.RC1.yaml<br>-r-------- 1 root root 4.8K Apr 17 16:43 device-plugin-910-v7.0.RC1.yaml<br>-r-------- 1 root root 5.4K Apr 17 16:43 device-plugin-volcano-v7.0.RC1.yaml<br>-r-------- 1 root root  767 Apr 17 16:43 Dockerfile<br>-r-------- 1 root root 1.1K Apr 17 16:43 Dockerfile-310P-1usoc<br>-r-------- 1 root root 4.1K Apr 17 16:43 faultCode.json<br>-r-------- 1 root root 1.2K Apr 17 16:43 faultCustomization.json<br>-r-------- 1 root root 2.3K Apr 17 16:43 run_for_310P_1usoc.sh<br>-r-------- 1 root root 1001 Apr 17 16:43 SwitchFaultCode.json<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">安装ascend-device-plugin（但其实Ascend Device Plugin独立工作，不配合Volcano使用）</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">建议使用 device-plugin-volcano-v7.0.RC1.yaml</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/Ascend-mindxdl-device-plugin_7.0.RC1_linux-aarch64# kubectl create -f device-plugin-910-v7.0.RC1.yaml <br>serviceaccount/ascend-device-plugin-sa-910 created<br>clusterrole.rbac.authorization.k8s.io/pods-node-ascend-device-plugin-role-910 created<br>clusterrolebinding.rbac.authorization.k8s.io/pods-node-ascend-device-plugin-rolebinding-910 created<br>Warning: spec.template.metadata.annotations[scheduler.alpha.kubernetes.io/critical-pod]: non-functional in v1.16+; use the &quot;priorityClassName&quot; field instead<br>Warning: spec.template.metadata.annotations[seccomp.security.alpha.kubernetes.io/pod]: deprecated since v1.19, non-functional in v1.25+; use the &quot;seccompProfile&quot; field instead<br>daemonset.apps/ascend-device-plugin-daemonset created<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">查看所有pod</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/Ascend-mindxdl-device-plugin_7.0.RC1_linux-aarch64# kubectl get pods -A<br>NAMESPACE        NAME                                       READY   STATUS    RESTARTS        AGE<br>kube-flannel     kube-flannel-ds-shsdv                      1/1     Running   28 (152m ago)   43h<br>kube-system      ascend-device-plugin-daemonset-r5ct4       1/1     Running   0               6s<br>kube-system      coredns-6d8c4cb4d-fmjkw                    1/1     Running   23 (152m ago)   43h<br>kube-system      coredns-6d8c4cb4d-nzn5v                    1/1     Running   21 (152m ago)   43h<br>kube-system      etcd-controller01                          1/1     Running   21 (152m ago)   43h<br>kube-system      kube-apiserver-controller01                1/1     Running   21 (152m ago)   43h<br>kube-system      kube-controller-manager-controller01       1/1     Running   18 (152m ago)   43h<br>kube-system      kube-proxy-7cccn                           1/1     Running   20 (152m ago)   43h<br>kube-system      kube-scheduler-controller01                1/1     Running   18 (152m ago)   43h<br>mindx-dl         ascend-operator-manager-65557b4b45-npwcx   1/1     Running   0               151m<br>mindx-dl         clusterd-65d6d749dd-qjcgg                  1/1     Running   0               151m<br>mindx-dl         noded-bbpwh                                1/1     Running   0               151m<br>npu-exporter     npu-exporter-bgxn4                         1/1     Running   0               150m<br>volcano-system   volcano-controllers-7d7b54c6bb-q5hbw       1/1     Running   0               151m<br>volcano-system   volcano-scheduler-67cf6bdccf-tzt2r         1/1     Running   0               151m<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">2025年7月9日20:12:55左右</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">我卸载了ascend-deviceplugin，转而部署ascend-k8sdeviceplugin:v7.0.RC1.SPC1</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# wget https://gitee.com/ascend/mind-cluster/releases/download/v7.0.RC1.SPC1/Ascend-mindxdl-device-plugin_7.0.RC1.SPC1_linux-aarch64.zip<br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# mkdir Ascend-mindxdl-device-plugin_7.0.RC1.SPC1_linux-aarch64/<br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# unzip Ascend-mindxdl-device-plugin_7.0.RC1.SPC1_linux-aarch64.zip -d Ascend-mindxdl-device-plugin_7.0.RC1.SPC1_linux-aarch64/<br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# cd Ascend-mindxdl-device-plugin_7.0.RC1.SPC1_linux-aarch64/<br><span class="hljs-meta prompt_">#</span><span class="language-bash">官方未提供ascend-k8sdeviceplugin:v7.0.RC1.SPC1，自己编译</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/Ascend-mindxdl-device-plugin_7.0.RC1.SPC1_linux-aarch64# docker build ./ -t ascend-k8sdeviceplugin:v7.0.RC1.SPC1<br><span class="hljs-meta prompt_">#</span><span class="language-bash">将imagePullPolicy由Never改为IfNotPresent</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/Ascend-mindxdl-device-plugin_7.0.RC1.SPC1_linux-aarch64# vi device-plugin-volcano-v7.0.RC1.SPC1.yaml <br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/Ascend-mindxdl-device-plugin_7.0.RC1.SPC1_linux-aarch64# kubectl create -f device-plugin-volcano-v7.0.RC1.SPC1.yaml <br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/Ascend-mindxdl-device-plugin_7.0.RC1.SPC1_linux-aarch64# kubectl get pods -A<br>NAMESPACE        NAME                                       READY   STATUS      RESTARTS        AGE<br>kube-flannel     kube-flannel-ds-shsdv                      1/1     Running     29 (2d2h ago)   3d23h<br>kube-system      ascend-device-plugin-daemonset-910-gdrk9   1/1     Running     0               13m<br>kube-system      coredns-6d8c4cb4d-fmjkw                    1/1     Running     24 (2d2h ago)   4d<br>kube-system      coredns-6d8c4cb4d-nzn5v                    1/1     Running     22 (2d2h ago)   4d<br>kube-system      etcd-controller01                          1/1     Running     22 (2d2h ago)   4d<br>kube-system      kube-apiserver-controller01                1/1     Running     22 (2d2h ago)   4d<br>kube-system      kube-controller-manager-controller01       1/1     Running     19 (2d2h ago)   4d<br>kube-system      kube-proxy-7cccn                           1/1     Running     21 (2d2h ago)   4d<br>kube-system      kube-scheduler-controller01                1/1     Running     19 (2d2h ago)   4d<br>mindx-dl         ascend-operator-manager-65557b4b45-npwcx   1/1     Running     3 (5h16m ago)   2d7h<br>mindx-dl         clusterd-65d6d749dd-qjcgg                  1/1     Running     3 (5h16m ago)   2d7h<br>mindx-dl         noded-bbpwh                                1/1     Running     3 (5h16m ago)   2d7h<br>npu-exporter     npu-exporter-bgxn4                         1/1     Running     3 (5h16m ago)   2d7h<br>volcano-system   volcano-admission-784b85dc8b-vfdz5         1/1     Running     0               7h30m<br>volcano-system   volcano-admission-init-6mdrg               0/1     Completed   0               7h30m<br>volcano-system   volcano-controllers-7d7b54c6bb-dqfn8       1/1     Running     0               8m<br>volcano-system   volcano-scheduler-777cc9fdbc-dzgvj         1/1     Running     0               8m<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">再次进行全量测试</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# bash install.sh --test=all<br>Using /opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer/ansible.cfg as config file<br>                                                  <br>task info:Generate the test report                                                        <br>[===================================================]<br><br>&#123;&#x27;113.57.37.106&#x27;: &#123;&#x27;driver&#x27;: [&#x27;OK&#x27;, &#x27;24.1.RC3&#x27;], &#x27;firmware&#x27;: [&#x27;OK&#x27;, &#x27;7.5.0.1.129&#x27;], &#x27;mcu&#x27;: &#123;&#x27;npu_id_0&#x27;: &#x27;23.2.4&#x27;, &#x27;npu_id_1&#x27;: &#x27;23.2.4&#x27;, &#x27;npu_id_2&#x27;: &#x27;23.2.4&#x27;, &#x27;npu_id_3&#x27;: &#x27;23.2.4&#x27;, &#x27;npu_id_4&#x27;: &#x27;23.2.4&#x27;, &#x27;npu_id_5&#x27;: &#x27;23.2.4&#x27;, &#x27;npu_id_6&#x27;: &#x27;23.2.4&#x27;, &#x27;npu_id_7&#x27;: &#x27;23.2.4&#x27;&#125;, &#x27;toolbox&#x27;: [&#x27;OK&#x27;, &#x27;7.0.RC1&#x27;], &#x27;mindspore&#x27;: [&#x27;not installed&#x27;, &#x27;&#x27;], &#x27;pytorch&#x27;: [&#x27;not installed&#x27;, &#x27;&#x27;], &#x27;tensorflow&#x27;: [&#x27;not installed&#x27;, &#x27;&#x27;], &#x27;tfplugin&#x27;: [&#x27;not installed&#x27;, &#x27;&#x27;], &#x27;nnae&#x27;: [&#x27;not installed&#x27;, &#x27;&#x27;], &#x27;nnrt&#x27;: [&#x27;not installed&#x27;, &#x27;&#x27;], &#x27;toolkit&#x27;: [&#x27;OK&#x27;, &#x27;8.1.RC1&#x27;], &#x27;fault-diag&#x27;: [&#x27;OK&#x27;, &#x27;7.0.RC1&#x27;], &#x27;mindie_image&#x27;: [&#x27;not installed&#x27;, &#x27;&#x27;]&#125;&#125;<br><br>controller01: &#123;&#x27;ascend-operator&#x27;: [&#x27;OK&#x27;, &#x27;v7.0.RC1&#x27;], &#x27;clusterd&#x27;: [&#x27;OK&#x27;, &#x27;v7.0.RC1&#x27;], &#x27;resilience-controller&#x27;: [&#x27;not installed&#x27;, &#x27;&#x27;], &#x27;hccl-controller&#x27;: [&#x27;not installed&#x27;, &#x27;&#x27;], &#x27;volcano&#x27;: [&#x27;OK&#x27;, &#x27;v1.9.0&#x27;], &#x27;ascend-device-plugin&#x27;: [&#x27;OK&#x27;, &#x27;v7.0.RC1&#x27;], &#x27;noded&#x27;: [&#x27;OK&#x27;, &#x27;v7.0.RC1&#x27;], &#x27;npu-exporter&#x27;: [&#x27;OK&#x27;, &#x27;v7.0.RC1&#x27;], &#x27;ascend-docker-runtime&#x27;: [&#x27;OK&#x27;, &#x27;v7.0.RC1&#x27;]&#125;<br><br><br>npu-clusters<br>--------------+--------------+----------------<br>npu           | driver       | firmware       <br>--------------+--------------+----------------<br>113.57.37.106 | OK, 24.1.RC3 | OK, 7.5.0.1.129<br>--------------+--------------+----------------<br><br>mcu-version<br>--------------+----------+----------+----------+----------+----------+----------+----------+---------<br>ip            | npu_id_0 | npu_id_1 | npu_id_2 | npu_id_3 | npu_id_4 | npu_id_5 | npu_id_6 | npu_id_7<br>--------------+----------+----------+----------+----------+----------+----------+----------+---------<br>113.57.37.106 | 23.2.4   | 23.2.4   | 23.2.4   | 23.2.4   | 23.2.4   | 23.2.4   | 23.2.4   | 23.2.4  <br>--------------+----------+----------+----------+----------+----------+----------+----------+---------<br><br>cann-clusters<br>--------------+-------------+---------------+---------------+---------------+-------------+--------------<br>cann          | toolbox     | tfplugin      | nnae          | nnrt          | toolkit     | mindie_image <br>--------------+-------------+---------------+---------------+---------------+-------------+--------------<br>113.57.37.106 | OK, 7.0.RC1 | OK, 7.0.RC1   | OK, 8.1.RC1   | OK, 8.1.RC1   | OK, 8.1.RC1 | not installed<br>--------------+-------------+---------------+---------------+---------------+-------------+--------------<br><br>pypkg-clusters<br>--------------+---------------+---------------+---------------+------------<br>pypkg         | mindspore     | tensorflow    | pytorch       | fault-diag <br>--------------+---------------+---------------+---------------+------------<br>113.57.37.106 | not installed | not installed | not installed | OK, 7.0.RC1<br>--------------+---------------+---------------+---------------+------------<br><br><br>dl-clusters(master-node)<br>-------------+-----------------+--------------+-----------------+------------+----------------------<br>master-node  | ascend-operator | clusterd     | hccl-controller | volcano    | resilience-controller<br>-------------+-----------------+--------------+-----------------+------------+----------------------<br>controller01 | OK, v7.0.RC1    | OK, v7.0.RC1 | not installed   | OK, v1.9.0 | not installed        <br>-------------+-----------------+--------------+-----------------+------------+----------------------<br><br>dl-clusters(worker-node)<br>-------------+----------------------+-----------------------+--------------+-------------<br>worker-node  | ascend-device-plugin | ascend-docker-runtime | noded        | npu-exporter<br>-------------+----------------------+-----------------------+--------------+-------------<br>controller01 | OK, v7.0.RC1         | OK, v7.0.RC1          | OK, v7.0.RC1 | OK, v7.0.RC1<br>-------------+----------------------+-----------------------+--------------+-------------<br> =&gt; localhost <br>ascend deployer processed success<br>run cmd: --test=all successfully<br></code></pre></td></tr></table></figure>
<p>（2）不知道为啥 ？tfplugin显示未安装，采用如下方法处理：</p>
<p>Ascend-cann-toolkit_7.0.RC1_linux-aarch64.run下载地址：
https://www.hiascend.com/doc_center/source/zh/quick-installation/23.0.RC3/quickinstg_train/800_9000/quickinstg_800_9000_005.html</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">安装文档：https://www.hiascend.com/doc_center/source/zh/quick-installation/23.0.RC3/quickinstg_train/800_9000/quickinstg_800_9000_0021.html</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">增加对软件包的可执行权限。</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# chmod +x Ascend-cann-tfplugin_7.0.RC1_linux-aarch64.run<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">执行以下命令安装软件</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer# ./Ascend-cann-tfplugin_7.0.RC1_linux-aarch64.run --install --install-for-all<br>...<br>Do you accept the EULA to install CANN?[Y/N]y<br>[TFPlugin] [20250707-17:09:09] [INFO] install start<br>[TFPlugin] [20250707-17:09:09] [INFO] The installation path is /usr/local/Ascend.<br>[TFPlugin] [20250707-17:09:10] [INFO] install package CANN-fwkplugin-7.0.0.5.242-linux.aarch64.run start<br>WARNING: Running pip as the &#x27;root&#x27; user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv<br>WARNING: Running pip as the &#x27;root&#x27; user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv<br>[TFPlugin] [20250707-17:09:17] [INFO] CANN-fwkplugin-7.0.0.5.242-linux.aarch64.run --run --pylocal --quiet --nox11 --install-for-all install success<br><br><br>===========<br>= Summary =<br>===========<br><br>Driver:    Installed in /usr/local/Ascend/driver.<br>TFPlugin:  Ascend-cann-tfplugin_7.0.RC1_linux-aarch64 install success, installed in /usr/local/Ascend.<br><br>Please make sure that the environment variables have been configured.<br>-  To take effect for all users, you can add &quot;source /usr/local/Ascend/tfplugin/set_env.sh&quot; to /etc/profile.<br>-  To take effect for current user, you can exec command below: source /usr/local/Ascend/tfplugin/set_env.sh or add &quot;source /usr/local/Ascend/tfplugin/set_env.sh&quot; to ~/.bashrc.<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#使能ubuntu22.04.4 LTS上python3.9与python3.10可切换使用</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@controller01:/opt# apt-get update</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@controller01:/opt# apt install software-properties-common</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@controller01:/opt# add-apt-repository ppa:deadsnakes/ppa</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@controller01:/opt# apt-get update      //这个步骤一定要执行，否则不能安装python3.9</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@controller01:apt install python3.9</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@controller01:python3.9 -</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@controller01:update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.9 1</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@controller01:update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.10 2</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@controller01:update-alternatives --config python3  <span class="hljs-comment">#选择python3.9</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# python3 -V</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">Python 3.9.23</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@controller01:# <span class="hljs-built_in">rm</span> /usr/bin/python</span>  <br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@controller01:# <span class="hljs-built_in">ln</span> -s /usr/bin/python3 /usr/bin/python</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@controller01:# python -V</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">Python 3.9.23</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">全量测试</span><br>root@controller01:/opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer# bash install.sh --test=all<br>Using /opt/jiang/deploy_by_ascend_deployer/ascend-deployer-7.0.RC1/ascend_deployer/ansible.cfg as config file<br>                                                  <br>task info:Generate the test report                                                        <br>[===================================================]<br><br>&#123;&#x27;113.57.37.106&#x27;: &#123;&#x27;driver&#x27;: [&#x27;OK&#x27;, &#x27;24.1.RC3&#x27;], &#x27;firmware&#x27;: [&#x27;OK&#x27;, &#x27;7.5.0.1.129&#x27;], &#x27;mcu&#x27;: &#123;&#x27;npu_id_0&#x27;: &#x27;23.2.4&#x27;, &#x27;npu_id_1&#x27;: &#x27;23.2.4&#x27;, &#x27;npu_id_2&#x27;: &#x27;23.2.4&#x27;, &#x27;npu_id_3&#x27;: &#x27;23.2.4&#x27;, &#x27;npu_id_4&#x27;: &#x27;23.2.4&#x27;, &#x27;npu_id_5&#x27;: &#x27;23.2.4&#x27;, &#x27;npu_id_6&#x27;: &#x27;23.2.4&#x27;, &#x27;npu_id_7&#x27;: &#x27;23.2.4&#x27;&#125;, &#x27;toolbox&#x27;: [&#x27;OK&#x27;, &#x27;7.0.RC1&#x27;], &#x27;mindspore&#x27;: [&#x27;not installed&#x27;, &#x27;&#x27;], &#x27;pytorch&#x27;: [&#x27;not installed&#x27;, &#x27;&#x27;], &#x27;tensorflow&#x27;: [&#x27;not installed&#x27;, &#x27;&#x27;], &#x27;tfplugin&#x27;: [&#x27;OK&#x27;, &#x27;7.0.RC1&#x27;], &#x27;nnae&#x27;: [&#x27;OK&#x27;, &#x27;8.1.RC1&#x27;], &#x27;nnrt&#x27;: [&#x27;OK&#x27;, &#x27;8.1.RC1&#x27;], &#x27;toolkit&#x27;: [&#x27;OK&#x27;, &#x27;8.1.RC1&#x27;], &#x27;fault-diag&#x27;: [&#x27;OK&#x27;, &#x27;7.0.RC1&#x27;], &#x27;mindie_image&#x27;: [&#x27;not installed&#x27;, &#x27;&#x27;]&#125;&#125;<br><br>controller01: &#123;&#x27;ascend-operator&#x27;: [&#x27;OK&#x27;, &#x27;v7.0.RC1&#x27;], &#x27;clusterd&#x27;: [&#x27;OK&#x27;, &#x27;v7.0.RC1&#x27;], &#x27;resilience-controller&#x27;: [&#x27;not installed&#x27;, &#x27;&#x27;], &#x27;hccl-controller&#x27;: [&#x27;not installed&#x27;, &#x27;&#x27;], &#x27;volcano&#x27;: [&#x27;OK&#x27;, &#x27;v1.9.0&#x27;], &#x27;ascend-device-plugin&#x27;: [&#x27;OK&#x27;, &#x27;v7.0.RC1&#x27;], &#x27;noded&#x27;: [&#x27;OK&#x27;, &#x27;v7.0.RC1&#x27;], &#x27;npu-exporter&#x27;: [&#x27;OK&#x27;, &#x27;v7.0.RC1&#x27;], &#x27;ascend-docker-runtime&#x27;: [&#x27;OK&#x27;, &#x27;v7.0.RC1&#x27;]&#125;<br><br><br>npu-clusters<br>--------------+--------------+----------------<br>npu           | driver       | firmware       <br>--------------+--------------+----------------<br>113.57.37.106 | OK, 24.1.RC3 | OK, 7.5.0.1.129<br>--------------+--------------+----------------<br><br>mcu-version<br>--------------+----------+----------+----------+----------+----------+----------+----------+---------<br>ip            | npu_id_0 | npu_id_1 | npu_id_2 | npu_id_3 | npu_id_4 | npu_id_5 | npu_id_6 | npu_id_7<br>--------------+----------+----------+----------+----------+----------+----------+----------+---------<br>113.57.37.106 | 23.2.4   | 23.2.4   | 23.2.4   | 23.2.4   | 23.2.4   | 23.2.4   | 23.2.4   | 23.2.4  <br>--------------+----------+----------+----------+----------+----------+----------+----------+---------<br><br>cann-clusters<br>--------------+-------------+-------------+-------------+-------------+-------------+--------------<br>cann          | toolbox     | tfplugin    | nnae        | nnrt        | toolkit     | mindie_image <br>--------------+-------------+-------------+-------------+-------------+-------------+--------------<br>113.57.37.106 | OK, 7.0.RC1 | OK, 7.0.RC1 | OK, 8.1.RC1 | OK, 8.1.RC1 | OK, 8.1.RC1 | not installed<br>--------------+-------------+-------------+-------------+-------------+-------------+--------------<br><br>pypkg-clusters<br>--------------+---------------+---------------+---------------+------------<br>pypkg         | mindspore     | tensorflow    | pytorch       | fault-diag <br>--------------+---------------+---------------+---------------+------------<br>113.57.37.106 | not installed | not installed | not installed | OK, 7.0.RC1<br>--------------+---------------+---------------+---------------+------------<br><br><br>dl-clusters(master-node)<br>-------------+-----------------+--------------+-----------------+------------+----------------------<br>master-node  | ascend-operator | clusterd     | hccl-controller | volcano    | resilience-controller<br>-------------+-----------------+--------------+-----------------+------------+----------------------<br>controller01 | OK, v7.0.RC1    | OK, v7.0.RC1 | not installed   | OK, v1.9.0 | not installed        <br>-------------+-----------------+--------------+-----------------+------------+----------------------<br><br>dl-clusters(worker-node)<br>-------------+----------------------+-----------------------+--------------+-------------<br>worker-node  | ascend-device-plugin | ascend-docker-runtime | noded        | npu-exporter<br>-------------+----------------------+-----------------------+--------------+-------------<br>controller01 | OK, v7.0.RC1         | OK, v7.0.RC1          | OK, v7.0.RC1 | OK, v7.0.RC1<br>-------------+----------------------+-----------------------+--------------+-------------<br> =&gt; localhost <br>ascend deployer processed success<br>run cmd: --test=all successfully<br></code></pre></td></tr></table></figure>
<h2 id="配置环境变量">配置环境变量</h2>
<h3 id="配置昇腾软件的环境变量">配置昇腾软件的环境变量</h3>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@controller01</span><span class="hljs-symbol">:/opt/jiang/deploy_by_ascend_deployer</span><span class="hljs-comment"># vi /root/.bashrc</span><br><span class="hljs-comment"># 安装toolkit包时配置</span><br>. /usr/local/<span class="hljs-title class_">Ascend</span>/ascend-toolkit/set_env.sh    <br><br><span class="hljs-comment"># 安装tfplugin包时配置</span><br>. /usr/local/<span class="hljs-title class_">Ascend</span>/tfplugin/set_env.sh<br><br><span class="hljs-comment"># 安装nnrt包时配置</span><br>. /usr/local/<span class="hljs-title class_">Ascend</span>/nnrt/set_env.sh<br>    <br><span class="hljs-comment"># 安装nnae包时配置</span><br>. /usr/local/<span class="hljs-title class_">Ascend</span>/nnae/set_env.sh<br><br><span class="hljs-comment"># 安装toolbox包时配置</span><br>. /usr/local/<span class="hljs-title class_">Ascend</span>/toolbox/set_env.sh<br><br><br><br>root<span class="hljs-variable">@controller01</span><span class="hljs-symbol">:/opt/jiang/deploy_by_ascend_deployer</span><span class="hljs-comment"># source /root/.bashrc </span><br></code></pre></td></tr></table></figure>
<h1 id="四组件状态确认">四、组件状态确认</h1>
<p>参考文档
https://www.hiascend.com/doc_center/source/zh/mindcluster/70rc1/clustersched/dlug/MindCluster%207.0.RC1%20%E9%9B%86%E7%BE%A4%E8%B0%83%E5%BA%A6%E7%94%A8%E6%88%B7%E6%8C%87%E5%8D%97.pdf
章节3.6</p>
<h1 id="五使用">五、使用</h1>
<h2 id="容器化支持特性指南实操">5.1 容器化支持特性指南实操</h2>
<p>见 《MindCluster 7.0.RC1 集群调度用户指南》章节4.1</p>
<h2 id="资源监测特性指南实操">5.2 资源监测特性指南实操</h2>
<h2 id="基础调度特性指南实操">5.3 基础调度特性指南实操</h2>
<h3 id="下载基础训练镜像">下载基础训练镜像</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">下载基础训练镜像</span><br>root@controller01:~# docker pull --platform=arm64 swr.cn-south-1.myhuaweicloud.com/ascendhub/ascend-tensorflow:24.0.RC2-A2-ubuntu20.04<br>root@controller01:~# docker pull --platform=arm64 swr.cn-south-1.myhuaweicloud.com/ascendhub/ascend-pytorch:24.0.0-A2-2.1.0-ubuntu20.04<br></code></pre></td></tr></table></figure>
<h3 id="下载训练代码">下载训练代码</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">下载训练代码</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">下载TensorFlow代码仓中master分支中的“ResNet50_ID0360_for_TensorFlow2.X”作为训练代码</span><br>root@controller01:~# mkdir /opt/code_repos<br>root@controller01:~# cd /opt/code_repos/<br>root@controller01:/opt/code_repos# git clone https://gitee.com/ascend/ModelZoo-TensorFlow.git<br>root@controller01:/opt/code_repos# cd ModelZoo-TensorFlow/TensorFlow2/built-in/cv/image_classification/ResNet50_ID0360_for_TensorFlow2.X/<br>root@controller01:/opt/code_repos/ModelZoo-TensorFlow/TensorFlow2/built-in/cv/image_classification/ResNet50_ID0360_for_TensorFlow2.X# ll<br>total 64<br>drwxr-xr-x  5 root root  4096 Jul  7 21:30 ./<br>drwxr-xr-x 19 root root  4096 Jul  7 21:30 ../<br>-rw-r--r--  1 root root  1036 Jul  7 21:30 benchmark.sh<br>drwxr-xr-x  2 root root  4096 Jul  7 21:30 configs/<br>-rw-r--r--  1 root root 15502 Jul  7 21:30 LICENSE<br>-rw-r--r--  1 root root    46 Jul  7 21:30 modelzoo_level.txt<br>-rw-r--r--  1 root root 12883 Jul  7 21:30 README.md<br>-rw-r--r--  1 root root    66 Jul  7 21:30 requirements.txt<br>drwxr-xr-x  3 root root  4096 Jul  7 21:30 tensorflow/<br>drwxr-xr-x  2 root root  4096 Jul  7 21:30 test/<br></code></pre></td></tr></table></figure>
<h3 id="下载imagenet2012数据集">下载ImageNet2012数据集</h3>
<hr />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">下载ImageNet2012数据集，访问“https://image-net.org/”，注册并填写企业或高校邮箱，提交数据集下载申请并等待审批</span><br>root@controller01:/opt# mkdir -p /data/dataset/imagenet2012/<br>root@controller01:/opt# cd /data/dataset/imagenet2012/<br><span class="hljs-meta prompt_">#</span><span class="language-bash">（1）参考https://hyper.ai/cn/datasets/4889 下载磁力链接，即下载这些数据集的种子</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">（2）安装与使用此工具：https://transmissionbt.com/download。</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">种子文件如下</span><br>root@controller01:/data/dataset/imagenet2012/# ls -al ImageNet.torrent <br>-rw-r--r-- 1 root root 8817647 Jul  8 09:07 ImageNet.torrent<br><span class="hljs-meta prompt_">#</span><span class="language-bash">安装transmission</span><br>root@controller01:/data/dataset/imagenet2012/# apt install transmission<br><span class="hljs-meta prompt_">#</span><span class="language-bash">在MobaXterm 软件中执行如下命令。然后如弹出如下程序窗口，按自己的需要选择与下载(虽然自己只下载ImageNet2012数据集，但它下载完成后仍继续下载其他年份的数据集，不清楚原因，我直接先暂停了)</span><br>root@controller01:/data/dataset/imagenet2012/# transmission-gtk ImageNet.torrent<br></code></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2025/07/08/Ui8NxMR9IJ7zqfo.png" srcset="/img/loading.gif" lazyload alt="image-20250708094915523" style="zoom:67%;" /></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">数据集下载完成后，如下：</span><br>root@controller01:/data/dataset/imagenet2012# ls -alh<br>total 158G<br>drwxr-xr-x 2 root root 4.0K Jul  8 14:30 .<br>drwxr-xr-x 3 root root 4.0K Jul  8 14:27 ..<br>-rw-r--r-- 1 root root  33M Jul  8 09:33 ILSVRC2012_bbox_test_dogs.zip<br>-rw-r--r-- 1 root root 710K Jul  8 09:28 ILSVRC2012_bbox_train_dogs.tar.gz<br>-rw-r--r-- 1 root root  20M Jul  8 09:33 ILSVRC2012_bbox_train_v2.tar.gz<br>-rw-r--r-- 1 root root 2.2M Jul  8 09:27 ILSVRC2012_bbox_val_v3.tgz<br>-rw-r--r-- 1 root root 2.5M Jul  8 09:27 ILSVRC2012_devkit_t12.tar.gz<br>-rw-r--r-- 1 root root  22M Jul  8 14:04 ILSVRC2012_devkit_t3.tar.gz<br>-rw-r--r-- 1 root root  13G Jul  8 14:04 ILSVRC2012_img_test.tar<br>-rw-r--r-- 1 root root 728M Jul  8 13:52 ILSVRC2012_img_train_t3.tar<br>-rw-r--r-- 1 root root 138G Jul  8 14:04 ILSVRC2012_img_train.tar<br>-rw-r--r-- 1 root root 6.3G Jul  8 13:04 ILSVRC2012_img_val.tar<br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">对数据集进行解压与确认</span><br>root@controller01:/data/dataset/imagenet2012# cat &gt; prepare_dataset.sh &lt;&lt; EOF<br><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br>mkdir -p train val bbox imagenet_tf<br>tar -xvf ILSVRC2012_img_train.tar -C train/<br>tar -xvf ILSVRC2012_img_val.tar -C val/<br>tar -xvf ILSVRC2012_bbox_train_v2.tar.gz -C bbox/<br>EOF<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">执行上述文件，以创建4个文件夹、解压3个压缩文件对对应的目录</span><br>root@controller01:/data/dataset/imagenet2012# bash prepare_dataset.sh<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">可以看到解压后的“val”目录、“bbox”目录下已经是文件夹或文件了，暂时无需再操作</span><br>root@controller01:/data/dataset/imagenet2012# ls val/ | head -n 3<br>ILSVRC2012_val_00000001.JPEG<br>ILSVRC2012_val_00000002.JPEG<br>ILSVRC2012_val_00000003.JPEG<br>root@controller01:/data/dataset/imagenet2012# ls bbox/ | head -n 3<br>n01440764<br>n01443537<br>n01484850<br><span class="hljs-meta prompt_">#</span><span class="language-bash">但解压后的“train”目录下还是.tar文件，在“train”目录下执行以下命令解压（<span class="hljs-variable">$&#123;LINE%.tar&#125;</span>：从 LINE 变量中移除 .tar 后缀（字符串截取操作））</span><br>root@controller01:/data/dataset/imagenet2012/train# find . -name &quot;*.tar&quot; | while read LINE ; do mkdir -p &quot;$&#123;LINE%.tar&#125;&quot;; tar -xvf &quot;$&#123;LINE&#125;&quot; -C &quot;$&#123;LINE%.tar&#125;&quot;; rm -f &quot;$&#123;LINE&#125;&quot;; done<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">检查数据集目录（其中以下文件暂时没用到：ILSVRC2012_bbox_train_dogs.tar.gz  ILSVRC2012_bbox_val_v3.tgz    ILSVRC2012_devkit_t3.tar.gz  ILSVRC2012_img_train_t3.tar   ILSVRC2012_bbox_test_dogs.zip   ILSVRC2012_devkit_t12.tar.gz    ILSVRC2012_img_test.tar）</span><br>root@controller01:/data/dataset# apt install tree<br>root@controller01:/data/dataset# tree -L 2 <br>.<br>└── imagenet2012<br>    ├── bbox<br>    ├── ILSVRC2012_bbox_test_dogs.zip<br>    ├── ILSVRC2012_bbox_train_dogs.tar.gz<br>    ├── ILSVRC2012_bbox_train_v2.tar.gz<br>    ├── ILSVRC2012_bbox_val_v3.tgz<br>    ├── ILSVRC2012_devkit_t12.tar.gz<br>    ├── ILSVRC2012_devkit_t3.tar.gz<br>    ├── ILSVRC2012_img_test.tar<br>    ├── ILSVRC2012_img_train_t3.tar<br>    ├── ILSVRC2012_img_train.tar<br>    ├── ILSVRC2012_img_val.tar<br>    ├── imagenet_tf<br>    ├── prepare_dataset.sh<br>    ├── test001<br>    ├── train<br>    └── val<br><br>6 directories, 11 files<br></code></pre></td></tr></table></figure>
<hr />
<h3 id="转换数据集为tfrecord格式">转换数据集为TFRecord格式</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">数据集下载好后，需要对其进行数据集预处理，转换数据集为TFRecord格式</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">详情参考：https://www.hiascend.com/document/detail/zh/TensorFlowCommercial/800/migration/tfmigr1/tfmigr1_000101.html 或 https://www.hiascend.com/document/detail/zh/TensorFlowCommercial/81RC1/migration/tfmigr1/tfmigr1_000101.html</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">转换数据集为TFRecord格式</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">a.下载源码</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@controller01:/opt/code_repos# git <span class="hljs-built_in">clone</span> -b r2.1.0 https://github.com/tensorflow/models.git</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#或</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@controller01:/opt/code_repos# git <span class="hljs-built_in">clone</span> -b r2.1.0 https://gitee.com/sy-jiang/tensorflow-models.git</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@controller01:/opt/code_repos# <span class="hljs-built_in">cd</span> tensorflow-models/</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@controller01:/opt/code_repos/tensorflow-models# git fetch origin</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@controller01:/opt/code_repos/tensorflow-models# git branch -r</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">root@controller01:/opt/code_repos/tensorflow-models# git checkout -b master origin/master</span><br>root@controller01:/opt/code_repos# git clone https://github.com/tensorflow/models.git<br><span class="hljs-meta prompt_">#</span><span class="language-bash">或</span><br>root@controller01:/opt/code_repos# git clone https://gitee.com/sy-jiang/tensorflow-models.git<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">b.执行如下命令进入源代码的“datasets”目录，并预处理验证数据</span><br>root@controller01:/opt/code_repos# cd tensorflow-models/research/slim/datasets/<br><span class="hljs-meta prompt_"># </span><span class="language-bash">预处理验证数据（正常情况下，此命令执行时无任何输出）</span><br>root@controller01:/opt/code_repos/tensorflow-models/research/slim/datasets# python preprocess_imagenet_validation_data.py /data/dataset/imagenet2012/val/ imagenet_2012_validation_synset_labels.txt <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">c.将标注的XML文件转换为单个CSV文件</span><br>root@controller01:/opt/code_repos/tensorflow-models/research/slim/datasets# python process_bounding_boxes.py /data/dataset/imagenet2012/bbox/ imagenet_lsvrc_2015_synsets.txt | sort &gt; imagenet_2012_bounding_boxes.csv<br>...<br><span class="hljs-meta prompt_">--&gt; </span><span class="language-bash">processed 540001 of 544546 XML files.</span><br><span class="hljs-meta prompt_">--&gt; </span><span class="language-bash">skipped 0 boxes and 0 XML files.</span><br>Finished processing 544546 XML files.<br>Skipped 0 XML files not in ImageNet Challenge.<br>Skipped 0 bounding boxes not in ImageNet Challenge.<br>Wrote 615299 bounding boxes from 544546 annotated images.<br>Finished.<br><span class="hljs-meta prompt_">#</span><span class="language-bash">命令执行完成后，将在当前目录下生成一个文件：imagenet_2012_bounding_boxes.csv，大小为29M左右</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">使用python3.10、pip25.1.1，安装相关python库</span><br>root@controller01:/opt/code_repos/tensorflow-models/research/slim/datasets# pip -V<br>pip 25.1.1 from /usr/local/lib/python3.10/dist-packages/pip (python 3.10)<br>root@controller01:/opt/code_repos/tensorflow-models/research/slim/datasets# pip install -r /opt/code_repos/tensorflow-models/official/requirements.txt<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">执行build_imagenet_data.py过程中发现其不断报错，经过不断修改此源码文件，最终能够正常执行。修改后的build_imagenet_data.py文件见：#https://gitee.com/sy-jiang/tensorflow-models_1/blob/master/research/slim/datasets/build_imagenet_data.py</span><br>root@controller01:/opt/code_repos/tensorflow-models/research/slim/datasets# python build_imagenet_data.py --output_directory=/data/dataset/imagenet2012/imagenet_tf --train_directory=/data/dataset/imagenet2012/train --validation_directory=/data/dataset/imagenet2012/val<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">d.	转换ImageNet数据集为TFRecord格式</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">执行完成后，在/data/dataset/imagenet2012/imagenet_tf 目录下生成1152个文件中。</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">其中train-xxx-of-01024 共1024个，每个文件大小是140M 左右</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">  validation-xxx-of-00128 共128个，每个文件大小是50M 左右</span><br>root@controller01:/opt/code_repos/tensorflow-models_1/research/slim/datasets# ls -alh /data/dataset/imagenet2012/imagenet_tf | egrep &quot;train|validation&quot; | wc -l<br>1152<br><span class="hljs-meta prompt_"># </span><span class="language-bash">这1152 个文件的总大小是144G 左右</span><br>root@controller01:/opt/code_repos/tensorflow-models_1/research/slim/datasets# du -sh /data/dataset/imagenet2012/imagenet_tf<br>144G    /data/dataset/imagenet2012/imagenet_tf<br>root@controller01:/opt/code_repos/tensorflow-models_1/research/slim/datasets# ls -alh /data/dataset/imagenet2012/imagenet_tf/train-00001-of-01024 <br>-rw-r--r-- 1 root root 142M Jul  8 15:59 /data/dataset/imagenet2012/imagenet_tf/train-00001-of-01024<br>root@controller01:/opt/code_repos/tensorflow-models_1/research/slim/datasets# ls -alh /data/dataset/imagenet2012/imagenet_tf/validation-00001-of-00128 <br>-rw-r--r-- 1 root root 50M Jul  8 15:56 /data/dataset/imagenet2012/imagenet_tf/validation-00001-of-00128<br></code></pre></td></tr></table></figure>
<h3 id="通过文件配置资源信息场景">通过文件配置资源信息场景</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">创建/data/atlas_dls/public 目录</span><br>root@controller01:~# mkdir -p /data/atlas_dls/public<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">将数据集上传到“/data/atlas_dls/public/dataset/resnet50/imagenet_TF”</span><br>root@controller01:~# mkdir -p /data/atlas_dls/public/dataset/resnet50/imagenet_TF<br>root@controller01:~# cd /data/atlas_dls/public/dataset/resnet50/imagenet_TF      <br>root@controller01:/data/atlas_dls/public/dataset/resnet50/imagenet_TF# pwd<br>/data/atlas_dls/public/dataset/resnet50/imagenet_TF<br>root@controller01:/data/atlas_dls/public/dataset/resnet50/imagenet_TF# cp -rp /data/dataset/imagenet2012/imagenet_tf/* /data/atlas_dls/public/dataset/resnet50/imagenet_TF<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">创建“/data/atlas_dls/public/code/”目录</span><br>root@controller01:/data/atlas_dls/public/dataset/resnet50/imagenet_TF# mkdir -p /data/atlas_dls/public/code/<br><span class="hljs-meta prompt_">#</span><span class="language-bash">将前面下载的训练代码中“ResNet50_ID0360_for_TensorFlow2.X”整个目录复制到“/data/atlas_dls/public/code/”下，并重命名为“ResNet50_for_TensorFlow_2.6_code”</span><br>root@controller01:/data/atlas_dls/public/dataset/resnet50/imagenet_TF# cp -rp /opt/code_repos/ModelZoo-TensorFlow/TensorFlow2/built-in/cv/image_classification/ResNet50_ID0360_for_TensorFlow2.X /data/atlas_dls/public/code/ResNet50_for_TensorFlow_2.6_code<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">下载“https://gitee.com/ascend/mindxdl-deploy.git”代码仓的“branch_v7.0.0-RC1”分支代码（我安装的Mind Cluster版本就是7.0.RC1）</span><br>root@controller01:/data/atlas_dls/public# cd /opt/code_repos/<br>root@controller01:/opt/code_repos# git clone -b branch_v7.0.0-RC1 https://gitee.com/ascend/mindxdl-deploy.git<br>root@controller01:/opt/code_repos# cd mindxdl-deploy/<br>root@controller01:/opt/code_repos/mindxdl-deploy# git status<br>On branch branch_v7.0.0-RC1<br>Your branch is up to date with &#x27;origin/branch_v7.0.0-RC1&#x27;.<br><span class="hljs-meta prompt_">#</span><span class="language-bash">获取“samples/train/basic-training/without-ranktable/tensorflow”目录中的“train_start.sh”文件，并将其复制到“/data/atlas_dls/public/code/ResNet50_for_TensorFlow_2.6_code/scripts”目录下</span><br>root@controller01:/opt/code_repos/mindxdl-deploy# mkdir -p /data/atlas_dls/public/code/ResNet50_for_TensorFlow_2.6_code/scripts<br>root@controller01:/opt/code_repos/mindxdl-deploy# cp samples/train/basic-training/without-ranktable/tensorflow/train_start.sh /data/atlas_dls/public/code/ResNet50_for_TensorFlow_2.6_code/scripts/train_start-without-ranktable.sh<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">获取“samples/train/basic-training/ranktable”目录中的“train_start.sh”、“rank_table.sh”和“utils.sh”文件，复制到“/data/atlas_dls/public/code/ResNet50_for_TensorFlow_2.6_code/scripts”目录下</span><br>root@controller01:/opt/code_repos/mindxdl-deploy# ll samples/train/basic-training/ranktable/*.sh<br>-rw-r--r-- 1 root root 1721 Jul  9 10:06 samples/train/basic-training/ranktable/rank_table.sh<br>-rw-r--r-- 1 root root 8624 Jul  9 10:06 samples/train/basic-training/ranktable/train_start.sh<br>-rw-r--r-- 1 root root  870 Jul  9 10:06 samples/train/basic-training/ranktable/utils.sh<br>root@controller01:/opt/code_repos/mindxdl-deploy# cp samples/train/basic-training/ranktable/*.sh /data/atlas_dls/public/code/ResNet50_for_TensorFlow_2.6_code/scripts/<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">此时“/data/atlas_dls/public/code/ResNet50_for_TensorFlow_2.6_code”目录下代码结构如下：</span><br>root@controller01:/opt/code_repos/mindxdl-deploy# tree -L 2 /data/atlas_dls/public/code/ResNet50_for_TensorFlow_2.6_code         <br>├── benchmark.sh<br>├── configs<br>│   ├── rank_table_16p.json<br>│   └── rank_table_8p.json<br>├── LICENSE<br>├── modelzoo_level.txt<br>├── README.md<br>├── requirements.txt<br>├── scripts<br>│   ├── rank_table.sh<br>│   ├── train_start.sh<br>│   ├── train_start-without-ranktable.sh<br>│   └── utils.sh<br>├── tensorflow<br>│   ├── common.py<br>│   ├── fusion_result.json<br>│   ├── imagenet_preprocessing.py<br>│   ├── lars_optimizer_npu.py<br>│   ├── lars_optimizer.py<br>│   ├── lars_util.py<br>│   ├── metrics_int32.py<br>│   ├── resnet_ctl_imagenet_main_profiling.py<br>│   ├── resnet_ctl_imagenet_main.py<br>│   ├── resnet_model.py<br>│   ├── resnet_runnable.py<br>│   ├── sgd_optimizer.py<br>│   └── tf2_common<br>└── test<br>    ├── env.sh<br>    ├── launch.sh<br>    ├── set_conda.sh<br>    ├── set_ranktable.py<br>    ├── train_full_16P_256bs_LARS_0.sh<br>    ├── train_full_16P_256bs_LARS_1.sh<br>    ├── train_full_16P_256bs_SGD_0.sh<br>    ├── train_full_16P_256bs_SGD_1.sh<br>    ├── train_full_16P_256bs_SGD.sh<br>    ├── train_full_1p.sh<br>    ├── train_full_8p_256bs_SGD.sh<br>    ├── train_full_8p_312bs_LARS.sh<br>    ├── train_performance_16np_256bs_SGD.sh<br>    ├── train_performance_16P_256bs_SGD.sh<br>    ├── train_performance_1p_dump.sh<br>    ├── train_performance_1p_overflow.sh<br>    ├── train_performance_1p_profiling1.sh<br>    ├── train_performance_1p_profiling2.sh<br>    ├── train_performance_1p.sh<br>    ├── train_performance_8p_256bs_SGD.sh<br>    ├── train_performance_8p_312bs_LARS.sh<br>    └── train_performance_distribute.sh<br><br>5 directories, 45 files<br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">创建目录、修改权限</span><br>root@controller01:/opt/jiang/test-npu-tasks# mkdir /data/atlas_dls/output/<br>root@controller01:/opt/jiang/test-npu-tasks# chmod -R a+rwx /data/atlas_dls<br>root@controller01:/opt/jiang/test-npu-tasks# mkdir -p /var/log/npu<br></code></pre></td></tr></table></figure>
<h3 id="执行任务">执行任务</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">根据昇腾社区的提示，找到一个文档</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">“https://www.hiascend.com/document/detail/zh/mindcluster/70rc1/clustersched/dlug/dlug_installation_013.html”</span> <br><span class="hljs-meta prompt_">#</span><span class="language-bash">参照此文档，需要在此节点打上标签：</span><br>root@controller01:/opt/jiang/test-npu-tasks# kubectl label node controller01 accelerator-type=module --overwrite<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">执行yaml文件`/opt/jiang/test-npu-tasks/a800_tensorflow_vcjob-hostpath.yaml`</span><br>root@controller01:/# kubectl create -f /opt/jiang/test-npu-tasks/a800_tensorflow_vcjob-hostpath.yaml<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">容器启动后，在容器内外执行以下命令检查相应设备和驱动是否挂载成功，命令示例如下：</span><br>ls /dev | grep davinci* &amp;&amp; ls /dev | grep devmm_svm &amp;&amp; ls /dev | grep hisi_hdc &amp;&amp; ls /usr/local/Ascend/driver &amp;&amp; ls /usr/local/ |grep dcmi &amp;&amp; ls /usr/local/bin<br><br><br><br><br></code></pre></td></tr></table></figure>
<h3 id="错误与异常处理">错误与异常处理</h3>
<h4
id="vcjob与pod一直处于pending状态">（1）vcjob与pod一直处于pending状态</h4>
<h5 id="执行任务前">执行任务前</h5>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">当前所有pod</span><br>oot@controller01:/opt/jiang/test-npu-tasks# kubectl get pods -A<br>NAMESPACE        NAME                                       READY   STATUS      RESTARTS        AGE<br>kube-flannel     kube-flannel-ds-shsdv                      1/1     Running     29 (2d2h ago)   3d23h<br>kube-system      ascend-device-plugin-daemonset-910-gdrk9   1/1     Running     0               13m<br>kube-system      coredns-6d8c4cb4d-fmjkw                    1/1     Running     24 (2d2h ago)   4d<br>kube-system      coredns-6d8c4cb4d-nzn5v                    1/1     Running     22 (2d2h ago)   4d<br>kube-system      etcd-controller01                          1/1     Running     22 (2d2h ago)   4d<br>kube-system      kube-apiserver-controller01                1/1     Running     22 (2d2h ago)   4d<br>kube-system      kube-controller-manager-controller01       1/1     Running     19 (2d2h ago)   4d<br>kube-system      kube-proxy-7cccn                           1/1     Running     21 (2d2h ago)   4d<br>kube-system      kube-scheduler-controller01                1/1     Running     19 (2d2h ago)   4d<br>mindx-dl         ascend-operator-manager-65557b4b45-npwcx   1/1     Running     3 (5h16m ago)   2d7h<br>mindx-dl         clusterd-65d6d749dd-qjcgg                  1/1     Running     3 (5h16m ago)   2d7h<br>mindx-dl         noded-bbpwh                                1/1     Running     3 (5h16m ago)   2d7h<br>npu-exporter     npu-exporter-bgxn4                         1/1     Running     3 (5h16m ago)   2d7h<br>volcano-system   volcano-admission-784b85dc8b-vfdz5         1/1     Running     0               7h30m<br>volcano-system   volcano-admission-init-6mdrg               0/1     Completed   0               7h30m<br>volcano-system   volcano-controllers-7d7b54c6bb-dqfn8       1/1     Running     0               8m<br>volcano-system   volcano-scheduler-777cc9fdbc-dzgvj         1/1     Running     0               8m<br></code></pre></td></tr></table></figure>
<h5 id="任务yaml">任务yaml</h5>
<p>然后我尝试执行yaml文件<code>/opt/jiang/test-npu-tasks/a800_tensorflow_vcjob-hostpath.yaml</code>，其具体内容如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">rings-config-mindx-dls-test</span>     <span class="hljs-comment"># The value of JobName must be the same as the name attribute of the following job. The prefix rings-config- cannot be modified.</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">vcjob</span>                      <span class="hljs-comment"># Select a proper namespace based on the site requirements. (The namespaces of ConfigMap and Job must be the same. In addition, if the tjm component of MindX-add exists, the vcjob namespace cannot be used.)</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">ring-controller.atlas:</span> <span class="hljs-string">ascend-910</span>   <span class="hljs-comment"># The value cannot be modified. Service operations will be performed based on this label.</span><br><span class="hljs-attr">data:</span><br>  <span class="hljs-attr">hccl.json:</span> <span class="hljs-string">|</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">        &quot;status&quot;:&quot;initializing&quot;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string"></span><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">batch.volcano.sh/v1alpha1</span>   <span class="hljs-comment"># The value cannot be changed. The volcano API must be used.</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Job</span>                               <span class="hljs-comment"># Only the job type is supported at present.</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">mindx-dls-test</span>                  <span class="hljs-comment"># The value must be consistent with the name of ConfigMap.</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">vcjob</span>                      <span class="hljs-comment"># Select a proper namespace based on the site requirements. (The namespaces of ConfigMap and Job must be the same. In addition, if the tjm component of MindX-add exists, the vcjob namespace cannot be used.)</span><br>  <span class="hljs-attr">labels:</span><br>    <span class="hljs-attr">ring-controller.atlas:</span> <span class="hljs-string">ascend-910</span>   <span class="hljs-comment"># The value must be the same as the label in ConfigMap and cannot be changed.</span><br>    <span class="hljs-attr">fault-scheduling:</span> <span class="hljs-string">&quot;force&quot;</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">minAvailable:</span> <span class="hljs-number">1</span>                       <span class="hljs-comment"># The value of minAvailable is 1 in a single-node scenario and N in an N-node distributed scenario.</span><br>  <span class="hljs-attr">schedulerName:</span> <span class="hljs-string">volcano</span>                <span class="hljs-comment"># Use the Volcano scheduler to schedule jobs.</span><br>  <span class="hljs-attr">policies:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">event:</span> <span class="hljs-string">PodEvicted</span><br>      <span class="hljs-attr">action:</span> <span class="hljs-string">RestartJob</span><br>  <span class="hljs-attr">plugins:</span><br>    <span class="hljs-attr">ssh:</span> []<br>    <span class="hljs-attr">env:</span> []<br>    <span class="hljs-attr">svc:</span> []<br>  <span class="hljs-attr">maxRetry:</span> <span class="hljs-number">3</span><br>  <span class="hljs-attr">queue:</span> <span class="hljs-string">default</span><br>  <span class="hljs-attr">tasks:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;default-test&quot;</span><br>    <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span>                              <span class="hljs-comment"># The value of replicas is 1 in a single-node scenario and N in an N-node scenario. The number of NPUs in the requests field is 8 in an N-node scenario.</span><br>    <span class="hljs-attr">template:</span><br>      <span class="hljs-attr">metadata:</span><br>        <span class="hljs-attr">labels:</span><br>          <span class="hljs-attr">app:</span> <span class="hljs-string">tf</span><br>          <span class="hljs-attr">ring-controller.atlas:</span> <span class="hljs-string">ascend-910</span>  <span class="hljs-comment"># The value must be the same as the label in ConfigMap and cannot be changed.</span><br>      <span class="hljs-attr">spec:</span><br>        <span class="hljs-attr">affinity:</span><br>          <span class="hljs-attr">podAntiAffinity:</span><br>            <span class="hljs-attr">requiredDuringSchedulingIgnoredDuringExecution:</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-attr">labelSelector:</span><br>                  <span class="hljs-attr">matchExpressions:</span><br>                    <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">volcano.sh/job-name</span><br>                      <span class="hljs-attr">operator:</span> <span class="hljs-string">In</span><br>                      <span class="hljs-attr">values:</span><br>                        <span class="hljs-bullet">-</span> <span class="hljs-string">mindx-dls-test</span><br>                <span class="hljs-attr">topologyKey:</span> <span class="hljs-string">kubernetes.io/hostname</span><br>        <span class="hljs-attr">containers:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">image:</span> <span class="hljs-string">swr.cn-south-1.myhuaweicloud.com/ascendhub/ascend-tensorflow:24.0.RC2-A2-ubuntu20.04</span><br>        <span class="hljs-comment">#- image: tf_arm64:b030               # Training framework image, which can be modified.</span><br>          <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>          <span class="hljs-attr">name:</span> <span class="hljs-string">tf</span><br>          <span class="hljs-attr">env:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">mindx-dls-test</span>                               <span class="hljs-comment"># The value must be the same as that of Jobname.</span><br>            <span class="hljs-attr">valueFrom:</span><br>              <span class="hljs-attr">fieldRef:</span><br>                <span class="hljs-attr">fieldPath:</span> <span class="hljs-string">metadata.name</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">XDL_IP</span>                                       <span class="hljs-comment"># IP address of the physical node, which is used to identify the node where the pod is running</span><br>            <span class="hljs-attr">valueFrom:</span><br>              <span class="hljs-attr">fieldRef:</span><br>                <span class="hljs-attr">fieldPath:</span> <span class="hljs-string">status.hostIP</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">framework</span><br>            <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;Tensorflow&quot;</span><br>          <span class="hljs-comment"># ASCEND_VISIBLE_DEVICES env variable is used by ascend-docker-runtime when in the whole card scheduling scene with volcano scheduler. </span><br>          <span class="hljs-comment"># Please delete it when in the static vNPU scheduling, dynamic vNPU scheduling, volcano without Ascend-volcano-plugin, without volcano scenes.</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">ASCEND_VISIBLE_DEVICES</span><br>            <span class="hljs-attr">valueFrom:</span><br>              <span class="hljs-attr">fieldRef:</span><br>                <span class="hljs-attr">fieldPath:</span> <span class="hljs-string">metadata.annotations[&#x27;huawei.com/Ascend910&#x27;]</span>               <span class="hljs-comment"># The value must be the same as resources.requests</span><br>          <span class="hljs-attr">command:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;/bin/bash&quot;</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;-c&quot;</span><br>          <span class="hljs-comment"># Commands for running the training script. Ensure that the involved commands and paths exist on Docker.</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;cd /job/code/scripts;chmod +x train_start.sh;bash train_start.sh /job/code/ /job/output/ tensorflow/resnet_ctl_imagenet_main.py --data_dir=/job/data/imagenet_TF --distribution_strategy=one_device --use_tf_while_loop=true --epochs_between_evals=1 --skip_eval --enable_checkpoint_and_export;&quot;</span><br>          <span class="hljs-comment">#args: [ &quot;while true; do sleep 30000; done;&quot;  ]     # Comment out the preceding line and enable this line. You can manually run the training script in the container to facilitate debugging.</span><br>                                                              <span class="hljs-comment"># The command is &#x27;kubectl exec -it -n &#123;namespace&#125; &#123;podname&#125; bash&#x27;</span><br>          <span class="hljs-attr">resources:</span><br>            <span class="hljs-attr">requests:</span><br>              <span class="hljs-attr">huawei.com/Ascend910:</span> <span class="hljs-number">1</span>                 <span class="hljs-comment"># Number of required NPUs. The maximum value is 8. You can add lines below to configure resources such as memory and CPU.</span><br>            <span class="hljs-attr">limits:</span><br>              <span class="hljs-attr">huawei.com/Ascend910:</span> <span class="hljs-number">1</span>                 <span class="hljs-comment"># The value must be consistent with that in requests.</span><br>          <span class="hljs-attr">volumeMounts:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">ascend-910-config</span><br>            <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/user/serverid/devindex/config</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">code</span><br>            <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/job/code</span>                     <span class="hljs-comment"># Path of the training script in the container.</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">data</span><br>            <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/job/data</span>                      <span class="hljs-comment"># Path of the training dataset in the container.</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">output</span><br>            <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/job/output</span>                    <span class="hljs-comment"># Training output path in the container.</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">slog</span><br>            <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/var/log/npu</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">ascend-driver</span><br>            <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/usr/local/Ascend/driver</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">localtime</span><br>            <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/etc/localtime</span><br>        <span class="hljs-attr">nodeSelector:</span><br>          <span class="hljs-attr">host-arch:</span> <span class="hljs-string">huawei-arm</span>                       <span class="hljs-comment"># Configure the label based on the actual job.</span><br>        <span class="hljs-attr">volumes:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">ascend-910-config</span><br>          <span class="hljs-attr">configMap:</span><br>            <span class="hljs-attr">name:</span> <span class="hljs-string">rings-config-mindx-dls-test</span>         <span class="hljs-comment"># Correspond to the ConfigMap name above.</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">code</span><br>          <span class="hljs-attr">hostPath:</span><br>            <span class="hljs-comment">#server: 127.0.0.1                         # IP address of the NFS server. In this example, the shared path is /data/atlas_dls/.</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">&quot;/data/atlas_dls/public/code/ResNet50_for_TensorFlow_2.6_code/&quot;</span>             <span class="hljs-comment"># Configure the training script path.</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">Directory</span>  <span class="hljs-comment"># 确保路径是目录</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">data</span><br>          <span class="hljs-attr">hostPath:</span><br>            <span class="hljs-comment">#server: 127.0.0.1</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">&quot;/data/atlas_dls/public/dataset/&quot;</span>    <span class="hljs-comment"># Configure the path of the training set.</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">Directory</span>  <span class="hljs-comment"># 确保路径是目录</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">output</span><br>          <span class="hljs-attr">hostPath:</span><br>            <span class="hljs-comment">#server: 127.0.0.1</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">&quot;/data/atlas_dls/output/&quot;</span>           <span class="hljs-comment"># Configure the path for saving the configuration model, which is related to the script.</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">Directory</span>  <span class="hljs-comment"># 确保路径是目录</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">slog</span><br>          <span class="hljs-attr">hostPath:</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">/var/log/npu</span>                        <span class="hljs-comment"># Configure the NPU log path and mount it to the local host.</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">ascend-driver</span><br>          <span class="hljs-attr">hostPath:</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">/usr/local/Ascend/driver</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">localtime</span><br>          <span class="hljs-attr">hostPath:</span><br>            <span class="hljs-attr">path:</span> <span class="hljs-string">/etc/localtime</span>                      <span class="hljs-comment"># Configure the Docker time.</span><br>        <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">OnFailure</span><br><br></code></pre></td></tr></table></figure>
<h5
id="vcjob与pod一直处于pending状态-1">vcjob与pod一直处于pending状态</h5>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#但vcjob与pod一直处于pending状态</span><br><span class="hljs-string">root@controller01:/opt/jiang/test-npu-tasks#</span> <span class="hljs-string">kubectl</span> <span class="hljs-string">-n</span> <span class="hljs-string">vcjob</span> <span class="hljs-string">get</span> <span class="hljs-string">vcjob</span>  <br><span class="hljs-string">NAME</span>             <span class="hljs-string">STATUS</span>    <span class="hljs-string">MINAVAILABLE</span>   <span class="hljs-string">RUNNINGS</span>   <span class="hljs-string">AGE</span><br><span class="hljs-string">mindx-dls-test</span>   <span class="hljs-string">Pending</span>   <span class="hljs-number">1</span>                         <span class="hljs-string">11m</span><br><span class="hljs-string">root@controller01:/opt/jiang/test-npu-tasks#</span> <span class="hljs-string">kubectl</span> <span class="hljs-string">-n</span> <span class="hljs-string">vcjob</span> <span class="hljs-string">get</span> <span class="hljs-string">pods</span><br><span class="hljs-string">NAME</span>                            <span class="hljs-string">READY</span>   <span class="hljs-string">STATUS</span>    <span class="hljs-string">RESTARTS</span>   <span class="hljs-string">AGE</span><br><span class="hljs-string">mindx-dls-test-default-test-0</span>   <span class="hljs-number">0</span><span class="hljs-string">/1</span>     <span class="hljs-string">Pending</span>   <span class="hljs-number">0</span>          <span class="hljs-string">11m</span><br><br><span class="hljs-comment">#describe此pod，看到如下内容”</span><br><span class="hljs-string">root@controller01:/opt/jiang/test-npu-tasks#</span> <span class="hljs-string">kubectl</span> <span class="hljs-string">-n</span> <span class="hljs-string">vcjob</span> <span class="hljs-string">describe</span> <span class="hljs-string">pod</span> <span class="hljs-string">mindx-dls-test-default-test-0</span>      <br><span class="hljs-attr">Name:</span>           <span class="hljs-string">mindx-dls-test-default-test-0</span><br><span class="hljs-attr">Namespace:</span>      <span class="hljs-string">vcjob</span><br><span class="hljs-attr">Priority:</span>       <span class="hljs-number">0</span><br><span class="hljs-attr">Node:</span>           <span class="hljs-string">&lt;none&gt;</span><br><span class="hljs-attr">Labels:</span>         <span class="hljs-string">app=tf</span><br>                <span class="hljs-string">ring-controller.atlas=ascend-910</span><br>                <span class="hljs-string">volcano.sh/job-name=mindx-dls-test</span><br>                <span class="hljs-string">volcano.sh/job-namespace=vcjob</span><br>                <span class="hljs-string">volcano.sh/queue-name=default</span><br>                <span class="hljs-string">volcano.sh/task-index=0</span><br>                <span class="hljs-string">volcano.sh/task-spec=default-test</span><br><span class="hljs-attr">Annotations:    hccl/rankIndex:</span> <span class="hljs-number">0</span><br>                <span class="hljs-attr">scheduling.k8s.io/group-name:</span> <span class="hljs-string">mindx-dls-test-0348211b-8cb7-42b5-8948-11fa09ba4580</span><br>                <span class="hljs-attr">volcano.sh/job-name:</span> <span class="hljs-string">mindx-dls-test</span><br>                <span class="hljs-attr">volcano.sh/job-version:</span> <span class="hljs-number">0</span><br>                <span class="hljs-attr">volcano.sh/queue-name:</span> <span class="hljs-string">default</span><br>                <span class="hljs-attr">volcano.sh/task-index:</span> <span class="hljs-number">0</span><br>                <span class="hljs-attr">volcano.sh/task-spec:</span> <span class="hljs-string">default-test</span><br>                <span class="hljs-attr">volcano.sh/template-uid:</span> <span class="hljs-string">mindx-dls-test-default-test</span><br><span class="hljs-attr">Status:</span>         <span class="hljs-string">Pending</span><br><span class="hljs-attr">IP:</span>             <br><span class="hljs-attr">IPs:</span>            <span class="hljs-string">&lt;none&gt;</span><br><span class="hljs-attr">Controlled By:</span>  <span class="hljs-string">Job/mindx-dls-test</span><br><span class="hljs-attr">Containers:</span><br>  <span class="hljs-attr">tf:</span><br>    <span class="hljs-attr">Image:</span>      <span class="hljs-string">swr.cn-south-1.myhuaweicloud.com/ascendhub/ascend-tensorflow:24.0.RC2-A2-ubuntu20.04</span><br>    <span class="hljs-attr">Port:</span>       <span class="hljs-string">&lt;none&gt;</span><br>    <span class="hljs-attr">Host Port:</span>  <span class="hljs-string">&lt;none&gt;</span><br>    <span class="hljs-attr">Command:</span><br>      <span class="hljs-string">/bin/bash</span><br>      <span class="hljs-string">-c</span><br>      <span class="hljs-string">cd</span> <span class="hljs-string">/job/code/scripts;chmod</span> <span class="hljs-string">+x</span> <span class="hljs-string">train_start.sh;bash</span> <span class="hljs-string">train_start.sh</span> <span class="hljs-string">/job/code/</span> <span class="hljs-string">/job/output/</span> <span class="hljs-string">tensorflow/resnet_ctl_imagenet_main.py</span> <span class="hljs-string">--data_dir=/job/data/imagenet_TF</span> <span class="hljs-string">--distribution_strategy=one_device</span> <span class="hljs-string">--use_tf_while_loop=true</span> <span class="hljs-string">--epochs_between_evals=1</span> <span class="hljs-string">--skip_eval</span> <span class="hljs-string">--enable_checkpoint_and_export;</span><br>    <span class="hljs-attr">Limits:</span><br>      <span class="hljs-attr">huawei.com/Ascend910:</span>  <span class="hljs-number">1</span><br>    <span class="hljs-attr">Requests:</span><br>      <span class="hljs-attr">huawei.com/Ascend910:</span>  <span class="hljs-number">1</span><br>    <span class="hljs-attr">Environment:</span><br>      <span class="hljs-attr">mindx-dls-test:</span>          <span class="hljs-string">mindx-dls-test-default-test-0</span> <span class="hljs-string">(v1:metadata.name)</span><br>      <span class="hljs-attr">XDL_IP:</span>                   <span class="hljs-string">(v1:status.hostIP)</span><br>      <span class="hljs-attr">framework:</span>               <span class="hljs-string">Tensorflow</span><br>      <span class="hljs-attr">ASCEND_VISIBLE_DEVICES:</span>   <span class="hljs-string">(v1:metadata.annotations[&#x27;huawei.com/Ascend910&#x27;])</span><br>      <span class="hljs-attr">VK_TASK_INDEX:</span>           <span class="hljs-number">0</span><br>      <span class="hljs-attr">VC_TASK_INDEX:</span>           <span class="hljs-number">0</span><br>      <span class="hljs-attr">VC_DEFAULT_TEST_HOSTS:</span>   <span class="hljs-string">&lt;set</span> <span class="hljs-string">to</span> <span class="hljs-string">the</span> <span class="hljs-string">key</span> <span class="hljs-string">&#x27;VC_DEFAULT_TEST_HOSTS&#x27;</span> <span class="hljs-string">of</span> <span class="hljs-string">config</span> <span class="hljs-string">map</span> <span class="hljs-string">&#x27;mindx-dls-test-svc&#x27;</span><span class="hljs-string">&gt;</span>  <span class="hljs-attr">Optional:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">VC_DEFAULT_TEST_NUM:</span>     <span class="hljs-string">&lt;set</span> <span class="hljs-string">to</span> <span class="hljs-string">the</span> <span class="hljs-string">key</span> <span class="hljs-string">&#x27;VC_DEFAULT_TEST_NUM&#x27;</span> <span class="hljs-string">of</span> <span class="hljs-string">config</span> <span class="hljs-string">map</span> <span class="hljs-string">&#x27;mindx-dls-test-svc&#x27;</span><span class="hljs-string">&gt;</span>    <span class="hljs-attr">Optional:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">Mounts:</span><br>      <span class="hljs-string">/etc/localtime</span> <span class="hljs-string">from</span> <span class="hljs-string">localtime</span> <span class="hljs-string">(rw)</span><br>      <span class="hljs-string">/etc/volcano</span> <span class="hljs-string">from</span> <span class="hljs-string">mindx-dls-test-svc</span> <span class="hljs-string">(rw)</span><br>      <span class="hljs-string">/job/code</span> <span class="hljs-string">from</span> <span class="hljs-string">code</span> <span class="hljs-string">(rw)</span><br>      <span class="hljs-string">/job/data</span> <span class="hljs-string">from</span> <span class="hljs-string">data</span> <span class="hljs-string">(rw)</span><br>      <span class="hljs-string">/job/output</span> <span class="hljs-string">from</span> <span class="hljs-string">output</span> <span class="hljs-string">(rw)</span><br>      <span class="hljs-string">/root/.ssh</span> <span class="hljs-string">from</span> <span class="hljs-string">mindx-dls-test-ssh</span> <span class="hljs-string">(rw,path=&quot;.ssh&quot;)</span><br>      <span class="hljs-string">/user/serverid/devindex/config</span> <span class="hljs-string">from</span> <span class="hljs-string">ascend-910-config</span> <span class="hljs-string">(rw)</span><br>      <span class="hljs-string">/usr/local/Ascend/driver</span> <span class="hljs-string">from</span> <span class="hljs-string">ascend-driver</span> <span class="hljs-string">(rw)</span><br>      <span class="hljs-string">/var/log/npu</span> <span class="hljs-string">from</span> <span class="hljs-string">slog</span> <span class="hljs-string">(rw)</span><br>      <span class="hljs-string">/var/run/secrets/kubernetes.io/serviceaccount</span> <span class="hljs-string">from</span> <span class="hljs-string">kube-api-access-htplf</span> <span class="hljs-string">(ro)</span><br><span class="hljs-attr">Conditions:</span><br>  <span class="hljs-string">Type</span>           <span class="hljs-string">Status</span><br>  <span class="hljs-string">PodScheduled</span>   <span class="hljs-literal">False</span> <br>  <span class="hljs-string">PodScheduled</span>   <span class="hljs-literal">False</span> <br><span class="hljs-attr">Volumes:</span><br>  <span class="hljs-attr">ascend-910-config:</span><br>    <span class="hljs-attr">Type:</span>      <span class="hljs-string">ConfigMap</span> <span class="hljs-string">(a</span> <span class="hljs-string">volume</span> <span class="hljs-string">populated</span> <span class="hljs-string">by</span> <span class="hljs-string">a</span> <span class="hljs-string">ConfigMap)</span><br>    <span class="hljs-attr">Name:</span>      <span class="hljs-string">rings-config-mindx-dls-test</span><br>    <span class="hljs-attr">Optional:</span>  <span class="hljs-literal">false</span><br>  <span class="hljs-attr">code:</span><br>    <span class="hljs-attr">Type:</span>          <span class="hljs-string">HostPath</span> <span class="hljs-string">(bare</span> <span class="hljs-string">host</span> <span class="hljs-string">directory</span> <span class="hljs-string">volume)</span><br>    <span class="hljs-attr">Path:</span>          <span class="hljs-string">/data/atlas_dls/public/code/ResNet50_for_TensorFlow_2.6_code/</span><br>    <span class="hljs-attr">HostPathType:</span>  <span class="hljs-string">Directory</span><br>  <span class="hljs-attr">data:</span><br>    <span class="hljs-attr">Type:</span>          <span class="hljs-string">HostPath</span> <span class="hljs-string">(bare</span> <span class="hljs-string">host</span> <span class="hljs-string">directory</span> <span class="hljs-string">volume)</span><br>    <span class="hljs-attr">Path:</span>          <span class="hljs-string">/data/atlas_dls/public/dataset/</span><br>    <span class="hljs-attr">HostPathType:</span>  <span class="hljs-string">Directory</span><br>  <span class="hljs-attr">output:</span><br>    <span class="hljs-attr">Type:</span>          <span class="hljs-string">HostPath</span> <span class="hljs-string">(bare</span> <span class="hljs-string">host</span> <span class="hljs-string">directory</span> <span class="hljs-string">volume)</span><br>    <span class="hljs-attr">Path:</span>          <span class="hljs-string">/data/atlas_dls/output/</span><br>    <span class="hljs-attr">HostPathType:</span>  <span class="hljs-string">Directory</span><br>  <span class="hljs-attr">slog:</span><br>    <span class="hljs-attr">Type:</span>          <span class="hljs-string">HostPath</span> <span class="hljs-string">(bare</span> <span class="hljs-string">host</span> <span class="hljs-string">directory</span> <span class="hljs-string">volume)</span><br>    <span class="hljs-attr">Path:</span>          <span class="hljs-string">/var/log/npu</span><br>    <span class="hljs-attr">HostPathType:</span>  <br>  <span class="hljs-attr">ascend-driver:</span><br>    <span class="hljs-attr">Type:</span>          <span class="hljs-string">HostPath</span> <span class="hljs-string">(bare</span> <span class="hljs-string">host</span> <span class="hljs-string">directory</span> <span class="hljs-string">volume)</span><br>    <span class="hljs-attr">Path:</span>          <span class="hljs-string">/usr/local/Ascend/driver</span><br>    <span class="hljs-attr">HostPathType:</span>  <br>  <span class="hljs-attr">localtime:</span><br>    <span class="hljs-attr">Type:</span>          <span class="hljs-string">HostPath</span> <span class="hljs-string">(bare</span> <span class="hljs-string">host</span> <span class="hljs-string">directory</span> <span class="hljs-string">volume)</span><br>    <span class="hljs-attr">Path:</span>          <span class="hljs-string">/etc/localtime</span><br>    <span class="hljs-attr">HostPathType:</span>  <br>  <span class="hljs-attr">mindx-dls-test-ssh:</span><br>    <span class="hljs-attr">Type:</span>        <span class="hljs-string">Secret</span> <span class="hljs-string">(a</span> <span class="hljs-string">volume</span> <span class="hljs-string">populated</span> <span class="hljs-string">by</span> <span class="hljs-string">a</span> <span class="hljs-string">Secret)</span><br>    <span class="hljs-attr">SecretName:</span>  <span class="hljs-string">mindx-dls-test-ssh</span><br>    <span class="hljs-attr">Optional:</span>    <span class="hljs-literal">false</span><br>  <span class="hljs-attr">mindx-dls-test-svc:</span><br>    <span class="hljs-attr">Type:</span>      <span class="hljs-string">ConfigMap</span> <span class="hljs-string">(a</span> <span class="hljs-string">volume</span> <span class="hljs-string">populated</span> <span class="hljs-string">by</span> <span class="hljs-string">a</span> <span class="hljs-string">ConfigMap)</span><br>    <span class="hljs-attr">Name:</span>      <span class="hljs-string">mindx-dls-test-svc</span><br>    <span class="hljs-attr">Optional:</span>  <span class="hljs-literal">false</span><br>  <span class="hljs-attr">kube-api-access-htplf:</span><br>    <span class="hljs-attr">Type:</span>                    <span class="hljs-string">Projected</span> <span class="hljs-string">(a</span> <span class="hljs-string">volume</span> <span class="hljs-string">that</span> <span class="hljs-string">contains</span> <span class="hljs-string">injected</span> <span class="hljs-string">data</span> <span class="hljs-string">from</span> <span class="hljs-string">multiple</span> <span class="hljs-string">sources)</span><br>    <span class="hljs-attr">TokenExpirationSeconds:</span>  <span class="hljs-number">3607</span><br>    <span class="hljs-attr">ConfigMapName:</span>           <span class="hljs-string">kube-root-ca.crt</span><br>    <span class="hljs-attr">ConfigMapOptional:</span>       <span class="hljs-string">&lt;nil&gt;</span><br>    <span class="hljs-attr">DownwardAPI:</span>             <span class="hljs-literal">true</span><br><span class="hljs-attr">QoS Class:</span>                   <span class="hljs-string">BestEffort</span><br><span class="hljs-attr">Node-Selectors:</span>              <span class="hljs-string">host-arch=huawei-arm</span><br><span class="hljs-attr">Tolerations:</span>                 <span class="hljs-string">node.kubernetes.io/not-ready:NoExecute</span> <span class="hljs-string">op=Exists</span> <span class="hljs-string">for</span> <span class="hljs-string">300s</span><br>                             <span class="hljs-string">node.kubernetes.io/unreachable:NoExecute</span> <span class="hljs-string">op=Exists</span> <span class="hljs-string">for</span> <span class="hljs-string">300s</span><br><span class="hljs-attr">Events:</span><br>  <span class="hljs-string">Type</span>     <span class="hljs-string">Reason</span>            <span class="hljs-string">Age</span>    <span class="hljs-string">From</span>     <span class="hljs-string">Message</span><br>  <span class="hljs-string">----</span>     <span class="hljs-string">------</span>            <span class="hljs-string">----</span>   <span class="hljs-string">----</span>     <span class="hljs-string">-------</span><br>  <span class="hljs-attr">Warning  FailedScheduling  9m37s  volcano  1/1 tasks in gang unschedulable:</span> <span class="hljs-string">pod</span> <span class="hljs-string">group</span> <span class="hljs-string">is</span> <span class="hljs-string">not</span> <span class="hljs-string">ready,</span> <span class="hljs-number">1</span> <span class="hljs-string">Pending,</span> <span class="hljs-number">1</span> <span class="hljs-string">minAvailable;</span> <span class="hljs-attr">Pending:</span> <span class="hljs-number">1</span> <span class="hljs-string">Unschedulable</span><br>  <span class="hljs-attr">Warning  FailedScheduling  9m36s  volcano  0/1 nodes are unavailable:</span> <span class="hljs-number">1</span> <span class="hljs-string">node</span> <span class="hljs-string">check</span> <span class="hljs-string">failed.</span> <span class="hljs-string">for</span> <span class="hljs-string">details,log</span> <span class="hljs-string">by</span> <span class="hljs-string">search</span> <span class="hljs-string">keywords</span> <span class="hljs-string">&lt;checkNodeNPUByTask</span> <span class="hljs-string">:</span> <span class="hljs-string">check</span> <span class="hljs-string">Node</span> <span class="hljs-string">controller01</span> <span class="hljs-string">label</span> [<span class="hljs-string">accelerator-type</span>] <span class="hljs-string">Failed,</span> <span class="hljs-string">value</span> <span class="hljs-string">is</span> <span class="hljs-string">module-910b-8&gt;</span> <span class="hljs-string">in</span> <span class="hljs-string">volcano&#x27;s</span> <span class="hljs-string">log.</span><br><br></code></pre></td></tr></table></figure>
<h5
id="podascend-device-plugin-daemonset-910-gdrk9-信息">pod/ascend-device-plugin-daemonset-910-gdrk9
信息</h5>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">查看kube-system命名空间下的pod/ascend-device-plugin-daemonset-910-gdrk9</span>  <br>root@controller01:/opt/jiang/test-npu-tasks# kubectl -n kube-system describe pod ascend-device-plugin-daemonset-910-gdrk9  <br>Name:                 ascend-device-plugin-daemonset-910-gdrk9<br>Namespace:            kube-system<br>Priority:             2000001000<br>Priority Class Name:  system-node-critical<br>Node:                 controller01/113.57.37.106<br>Start Time:           Wed, 09 Jul 2025 20:05:30 +0800<br>Labels:               controller-revision-hash=898fbf69b<br>                      name=ascend-device-plugin-ds<br>                      pod-template-generation=1<br>Annotations:          scheduler.alpha.kubernetes.io/critical-pod: <br>                      seccomp.security.alpha.kubernetes.io/pod: runtime/default<br>Status:               Running<br>IP:                   10.250.0.82<br>IPs:<br>  IP:           10.250.0.82<br>Controlled By:  DaemonSet/ascend-device-plugin-daemonset-910<br>Containers:<br>  device-plugin-01:<br>    Container ID:  docker://71dae1fa2f2ca854d35f93b01cd28ba0291fa23bc3259d3ee37fa43ab3830e1c<br>    Image:         ascend-k8sdeviceplugin:v7.0.RC1.SPC1<br>    Image ID:      docker://sha256:c60a40268d462ecebbd692463043071bdb911528c121a922b75328379e94b8c8<br>    Port:          &lt;none&gt;<br>    Host Port:     &lt;none&gt;<br>    Command:<br>      /bin/bash<br>      -c<br>      --<br>    Args:<br>      device-plugin  -useAscendDocker=true -volcanoType=true -presetVirtualDevice=true -logFile=/var/log/mindx-dl/devicePlugin/devicePlugin.log -logLevel=0<br>    State:          Running<br>      Started:      Wed, 09 Jul 2025 20:05:31 +0800<br>    Ready:          True<br>    Restart Count:  0<br>    Limits:<br>      cpu:     500m<br>      memory:  500Mi<br>    Requests:<br>      cpu:     500m<br>      memory:  500Mi<br>    Environment:<br>      NODE_NAME:   (v1:spec.nodeName)<br>      HOST_IP:     (v1:status.hostIP)<br>    Mounts:<br>      /etc/localtime from localtime (ro)<br>      /etc/vnpu.cfg from vnpucfg (rw)<br>      /run/containerd from containerd (ro)<br>      /run/vnpu_cfg_lock from vnpu-cut (rw)<br>      /tmp from tmp (rw)<br>      /user/cluster-info/datatrace-config from data-trace-file-dir (rw)<br>      /user/restore/reset from reset-config-dir (rw)<br>      /usr/local/Ascend/driver from hiai-driver (ro)<br>      /var/lib/kubelet/device-plugins from device-plugin (rw)<br>      /var/lib/kubelet/pod-resources from pod-resource (rw)<br>      /var/log/lingqu from lingqu-log (rw)<br>      /var/log/mindx-dl/devicePlugin from log-path (rw)<br>      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-fcprq (ro)<br>Conditions:<br>  Type              Status<br>  Initialized       True <br>  Ready             True <br>  ContainersReady   True <br>  PodScheduled      True <br>Volumes:<br>  device-plugin:<br>    Type:          HostPath (bare host directory volume)<br>    Path:          /var/lib/kubelet/device-plugins<br>    HostPathType:  <br>  pod-resource:<br>    Type:          HostPath (bare host directory volume)<br>    Path:          /var/lib/kubelet/pod-resources<br>    HostPathType:  <br>  hiai-driver:<br>    Type:          HostPath (bare host directory volume)<br>    Path:          /usr/local/Ascend/driver<br>    HostPathType:  <br>  log-path:<br>    Type:          HostPath (bare host directory volume)<br>    Path:          /var/log/mindx-dl/devicePlugin<br>    HostPathType:  Directory<br>  reset-config-dir:<br>    Type:          HostPath (bare host directory volume)<br>    Path:          /user/restore/reset<br>    HostPathType:  DirectoryOrCreate<br>  data-trace-file-dir:<br>    Type:          HostPath (bare host directory volume)<br>    Path:          /user/cluster-info/datatrace-config<br>    HostPathType:  DirectoryOrCreate<br>  vnpu-cut:<br>    Type:          HostPath (bare host directory volume)<br>    Path:          /run/vnpu_cfg_lock<br>    HostPathType:  DirectoryOrCreate<br>  tmp:<br>    Type:          HostPath (bare host directory volume)<br>    Path:          /tmp<br>    HostPathType:  <br>  vnpucfg:<br>    Type:          HostPath (bare host directory volume)<br>    Path:          /etc/vnpu.cfg<br>    HostPathType:  File<br>  lingqu-log:<br>    Type:          HostPath (bare host directory volume)<br>    Path:          /var/log/lingqu<br>    HostPathType:  DirectoryOrCreate<br>  containerd:<br>    Type:          HostPath (bare host directory volume)<br>    Path:          /run/containerd<br>    HostPathType:  <br>  localtime:<br>    Type:          HostPath (bare host directory volume)<br>    Path:          /etc/localtime<br>    HostPathType:  <br>  kube-api-access-fcprq:<br>    Type:                    Projected (a volume that contains injected data from multiple sources)<br>    TokenExpirationSeconds:  3607<br>    ConfigMapName:           kube-root-ca.crt<br>    ConfigMapOptional:       &lt;nil&gt;<br>    DownwardAPI:             true<br>QoS Class:                   Guaranteed<br>Node-Selectors:              accelerator=huawei-Ascend910<br>Tolerations:                 CriticalAddonsOnly op=Exists<br>                             device-plugin=v2:NoSchedule<br>                             huawei.com/Ascend910:NoSchedule op=Exists<br>                             node.kubernetes.io/disk-pressure:NoSchedule op=Exists<br>                             node.kubernetes.io/memory-pressure:NoSchedule op=Exists<br>                             node.kubernetes.io/not-ready:NoExecute op=Exists<br>                             node.kubernetes.io/pid-pressure:NoSchedule op=Exists<br>                             node.kubernetes.io/unreachable:NoExecute op=Exists<br>                             node.kubernetes.io/unschedulable:NoSchedule op=Exists<br>Events:<br>  Type    Reason     Age   From               Message<br>  ----    ------     ----  ----               -------<br>  Normal  Scheduled  15m   default-scheduler  Successfully assigned kube-system/ascend-device-plugin-daemonset-910-gdrk9 to controller01<br>  Normal  Pulled     15m   kubelet            Container image &quot;ascend-k8sdeviceplugin:v7.0.RC1.SPC1&quot; already present on machine<br>  Normal  Created    15m   kubelet            Created container device-plugin-01<br>  Normal  Started    15m   kubelet            Started container device-plugin-01<br></code></pre></td></tr></table></figure>
<h5
id="podascend-device-plugin-daemonset-910-gdrk9日志">pod/ascend-device-plugin-daemonset-910-gdrk9日志</h5>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">查看kube-system命名空间下的pod/ascend-device-plugin-daemonset-910-sj4n9 的日志</span><br>root@controller01:/opt/jiang/test-npu-tasks# kubectl -n kube-system logs ascend-device-plugin-daemonset-910-gdrk9 <br>[INFO]     2025/07/09 20:05:31.842816 1       hwlog/api.go:108    devicePlugin.log&#x27;s logger init success<br>[INFO]     2025/07/09 20:05:31.843017 1       main.go:193    ascend device plugin starting and the version is v7.0.RC1.SPC1_linux-aarch64<br>[INFO]     2025/07/09 20:05:31.843063 1       main.go:194    ascend device plugin starting scene is center<br>[INFO]     2025/07/09 20:05:32.160752 1       devmanager/devmanager.go:123    the dcmi version is 24.1.rc3<br>[INFO]     2025/07/09 20:05:32.167223 1       devmanager/devmanager.go:188    chipInfoName: 910B3, devType:Ascend910B<br>[WARN]     2025/07/09 20:05:32.173139 1       devmanager/devmanager.go:662    only AMP mode is available on Ascend910B<br>W0709 20:05:32.181474       1 client_config.go:617] Neither --kubeconfig nor --master was specified.  Using the inClusterConfig.  This might not work.<br>[WARN]     2025/07/09 20:05:42.195394 1       device/ascendcommon.go:657    get device ip failed, err: get device IP address failed, cardID(0), deviceID(0), error code: -8023, will retry<br>[WARN]     2025/07/09 20:05:52.201049 1       device/ascendcommon.go:657    get device ip failed, err: get device IP address failed, cardID(0), deviceID(0), error code: -8023, will retry<br>[WARN]     2025/07/09 20:06:02.206108 1       device/ascendcommon.go:657    get device ip failed, err: get device IP address failed, cardID(0), deviceID(0), error code: -8023, will retry<br>[WARN]     2025/07/09 20:06:12.210492 1       device/ascendcommon.go:657    get device ip failed, err: get device IP address failed, cardID(0), deviceID(0), error code: -8023, will retry<br>[WARN]     2025/07/09 20:06:22.216375 1       device/ascendcommon.go:657    get device ip failed, err: get device IP address failed, cardID(0), deviceID(0), error code: -8023, will retry<br>[WARN]     2025/07/09 20:06:32.220602 1       device/ascendcommon.go:657    get device ip failed, err: get device IP address failed, cardID(0), deviceID(0), error code: -8023, will retry<br>[WARN]     2025/07/09 20:06:42.224596 1       device/ascendcommon.go:657    get device ip failed, err: get device IP address failed, cardID(0), deviceID(0), error code: -8023, will retry<br>[WARN]     2025/07/09 20:06:52.232006 1       device/ascendcommon.go:657    get device ip failed, err: get device IP address failed, cardID(0), deviceID(0), error code: -8023, will retry<br>[WARN]     2025/07/09 20:07:02.236429 1       device/ascendcommon.go:657    get device ip failed, err: get device IP address failed, cardID(0), deviceID(0), error code: -8023, will retry<br>[WARN]     2025/07/09 20:07:12.240537 1       device/ascendcommon.go:657    get device ip failed, err: get device IP address failed, cardID(0), deviceID(0), error code: -8023, will retry<br>[WARN]     2025/07/09 20:07:22.244850 1       device/ascendcommon.go:657    get device ip failed, err: get device IP address failed, cardID(0), deviceID(0), error code: -8023, will retry<br>[WARN]     2025/07/09 20:07:32.250446 1       device/ascendcommon.go:657    get device ip failed, err: get device IP address failed, cardID(0), deviceID(0), error code: -8023, will retry<br>[WARN]     2025/07/09 20:07:42.255726 1       device/ascendcommon.go:657    get device ip failed, err: get device IP address failed, cardID(0), deviceID(0), error code: -8023, will retry<br>[WARN]     2025/07/09 20:07:52.259978 1       device/ascendcommon.go:657    get device ip failed, err: get device IP address failed, cardID(0), deviceID(0), error code: -8023, will retry<br>[WARN]     2025/07/09 20:08:02.264234 1       device/ascendcommon.go:657    get device ip failed, err: get device IP address failed, cardID(0), deviceID(0), error code: -8023, will retry<br>[WARN]     2025/07/09 20:08:12.269171 1       device/ascendcommon.go:657    get device ip failed, err: get device IP address failed, cardID(0), deviceID(0), error code: -8023, will retry<br>[WARN]     2025/07/09 20:08:22.274372 1       device/ascendcommon.go:657    get device ip failed, err: get device IP address failed, cardID(0), deviceID(0), error code: -8023, will retry<br>[WARN]     2025/07/09 20:08:32.279614 1       device/ascendcommon.go:657    get device ip failed, err: get device IP address failed, cardID(0), deviceID(0), error code: -8023, will retry<br>[WARN]     2025/07/09 20:08:32.279864 1       device/ascendcommon.go:661    get device ip failed, err: get device IP address failed, cardID(0), deviceID(0), error code: -8023<br>[WARN]     2025/07/09 20:08:32.292145 1       device/ascendcommon.go:661    get device ip failed, err: get device IP address failed, cardID(1), deviceID(0), error code: -8023<br>[WARN]     2025/07/09 20:08:32.308213 1       device/ascendcommon.go:661    get device ip failed, err: get device IP address failed, cardID(2), deviceID(0), error code: -8023<br>[WARN]     2025/07/09 20:08:32.320574 1       device/ascendcommon.go:661    get device ip failed, err: get device IP address failed, cardID(3), deviceID(0), error code: -8023<br>[WARN]     2025/07/09 20:08:32.332609 1       device/ascendcommon.go:661    get device ip failed, err: get device IP address failed, cardID(4), deviceID(0), error code: -8023<br>[WARN]     2025/07/09 20:08:32.344220 1       device/ascendcommon.go:661    get device ip failed, err: get device IP address failed, cardID(5), deviceID(0), error code: -8023<br>[WARN]     2025/07/09 20:08:32.356155 1       device/ascendcommon.go:661    get device ip failed, err: get device IP address failed, cardID(6), deviceID(0), error code: -8023<br>[WARN]     2025/07/09 20:08:32.367854 1       device/ascendcommon.go:661    get device ip failed, err: get device IP address failed, cardID(7), deviceID(0), error code: -8023<br>[INFO]     2025/07/09 20:08:32.439766 1       server/manager.go:288    get super pod info: &#123;4290772992 384 4294967295 1023 [0 0 0 0 0 0 0 0]&#125;<br>[INFO]     2025/07/09 20:08:32.440048 1       server/manager.go:288    get super pod info: &#123;4291035137 384 4294967295 1023 [0 0 0 0 0 0 0 0]&#125;<br>[INFO]     2025/07/09 20:08:32.440202 1       server/manager.go:288    get super pod info: &#123;4291297282 384 4294967295 1023 [0 0 0 0 0 0 0 0]&#125;<br>[INFO]     2025/07/09 20:08:32.440338 1       server/manager.go:288    get super pod info: &#123;4291559427 384 4294967295 1023 [0 0 0 0 0 0 0 0]&#125;<br>[INFO]     2025/07/09 20:08:32.440467 1       server/manager.go:288    get super pod info: &#123;4291821572 384 4294967295 1023 [0 0 0 0 0 0 0 0]&#125;<br>[INFO]     2025/07/09 20:08:32.440593 1       server/manager.go:288    get super pod info: &#123;4292083717 384 4294967295 1023 [0 0 0 0 0 0 0 0]&#125;<br>[INFO]     2025/07/09 20:08:32.440753 1       server/manager.go:288    get super pod info: &#123;4292345862 384 4294967295 1023 [0 0 0 0 0 0 0 0]&#125;<br>[INFO]     2025/07/09 20:08:32.440881 1       server/manager.go:288    get super pod info: &#123;4292608007 384 4294967295 1023 [0 0 0 0 0 0 0 0]&#125;<br>[INFO]     2025/07/09 20:08:32.440975 1       server/manager.go:309    get super pod id: -1, server index: 1023<br>[INFO]     2025/07/09 20:08:32.441329 1       server/manager.go:143    init kube client success<br>[INFO]     2025/07/09 20:08:32.523055 1       server/manager.go:288    get super pod info: &#123;4290772992 384 4294967295 1023 [0 0 0 0 0 0 0 0]&#125;<br>[INFO]     2025/07/09 20:08:32.523197 1       server/manager.go:288    get super pod info: &#123;4291035137 384 4294967295 1023 [0 0 0 0 0 0 0 0]&#125;<br>[INFO]     2025/07/09 20:08:32.523254 1       server/manager.go:288    get super pod info: &#123;4291297282 384 4294967295 1023 [0 0 0 0 0 0 0 0]&#125;<br>[INFO]     2025/07/09 20:08:32.523309 1       server/manager.go:288    get super pod info: &#123;4291559427 384 4294967295 1023 [0 0 0 0 0 0 0 0]&#125;<br>[INFO]     2025/07/09 20:08:32.523365 1       server/manager.go:288    get super pod info: &#123;4291821572 384 4294967295 1023 [0 0 0 0 0 0 0 0]&#125;<br>[INFO]     2025/07/09 20:08:32.523420 1       server/manager.go:288    get super pod info: &#123;4292083717 384 4294967295 1023 [0 0 0 0 0 0 0 0]&#125;<br>[INFO]     2025/07/09 20:08:32.523471 1       server/manager.go:288    get super pod info: &#123;4292345862 384 4294967295 1023 [0 0 0 0 0 0 0 0]&#125;<br>[INFO]     2025/07/09 20:08:32.523528 1       server/manager.go:288    get super pod info: &#123;4292608007 384 4294967295 1023 [0 0 0 0 0 0 0 0]&#125;<br>[INFO]     2025/07/09 20:08:32.526036 259     kubeclient/kube_cache.go:117    pod(kube-flannel/kube-flannel-ds-shsdv) is add to cache<br>[INFO]     2025/07/09 20:08:32.526142 259     kubeclient/kube_cache.go:117    pod(kube-system/coredns-6d8c4cb4d-fmjkw) is add to cache<br>[INFO]     2025/07/09 20:08:32.526204 259     kubeclient/kube_cache.go:117    pod(volcano-system/volcano-admission-init-6mdrg) is add to cache<br>[INFO]     2025/07/09 20:08:32.526258 259     kubeclient/kube_cache.go:117    pod(npu-exporter/npu-exporter-bgxn4) is add to cache<br>[INFO]     2025/07/09 20:08:32.526306 259     kubeclient/kube_cache.go:117    pod(kube-system/kube-scheduler-controller01) is add to cache<br>[INFO]     2025/07/09 20:08:32.526361 259     kubeclient/kube_cache.go:117    pod(mindx-dl/noded-bbpwh) is add to cache<br>[INFO]     2025/07/09 20:08:32.526412 259     kubeclient/kube_cache.go:117    pod(mindx-dl/ascend-operator-manager-65557b4b45-npwcx) is add to cache<br>[INFO]     2025/07/09 20:08:32.526461 259     kubeclient/kube_cache.go:117    pod(mindx-dl/clusterd-65d6d749dd-qjcgg) is add to cache<br>[INFO]     2025/07/09 20:08:32.526506 259     kubeclient/kube_cache.go:117    pod(volcano-system/volcano-admission-784b85dc8b-vfdz5) is add to cache<br>[INFO]     2025/07/09 20:08:32.526554 259     kubeclient/kube_cache.go:117    pod(volcano-system/volcano-controllers-7d7b54c6bb-q5hbw) is add to cache<br>[INFO]     2025/07/09 20:08:32.526602 259     kubeclient/kube_cache.go:117    pod(kube-system/etcd-controller01) is add to cache<br>[INFO]     2025/07/09 20:08:32.526651 259     kubeclient/kube_cache.go:117    pod(kube-system/kube-proxy-7cccn) is add to cache<br>[INFO]     2025/07/09 20:08:32.526699 259     kubeclient/kube_cache.go:117    pod(volcano-system/volcano-scheduler-777cc9fdbc-czjwt) is add to cache<br>[INFO]     2025/07/09 20:08:32.526779 259     kubeclient/kube_cache.go:117    pod(kube-system/ascend-device-plugin-daemonset-910-gdrk9) is add to cache<br>[INFO]     2025/07/09 20:08:32.526826 259     kubeclient/kube_cache.go:117    pod(kube-system/kube-apiserver-controller01) is add to cache<br>[INFO]     2025/07/09 20:08:32.526873 259     kubeclient/kube_cache.go:117    pod(kube-system/coredns-6d8c4cb4d-nzn5v) is add to cache<br>[INFO]     2025/07/09 20:08:32.526920 259     kubeclient/kube_cache.go:117    pod(kube-system/kube-controller-manager-controller01) is add to cache<br>[INFO]     2025/07/09 20:08:32.542155 1       server/manager.go:175    update node label success<br>[INFO]     2025/07/09 20:08:32.542370 1       main.go:217    init device manager success<br>[INFO]     2025/07/09 20:08:32.542417 1       main.go:270    device-plugin set ascend docker as: true<br>[INFO]     2025/07/09 20:08:32.542607 265     server/manager.go:404    starting the listen device<br>[INFO]     2025/07/09 20:08:32.572307 269     server/manager.go:785    Serve start<br>[INFO]     2025/07/09 20:08:32.572355 270     kubeclient/kube_cache.go:62    after 464 second, pod informer inspector will start<br>[INFO]     2025/07/09 20:08:32.572540 269     server/server.go:40    prepare start plugin server, restartTime=0<br>[INFO]     2025/07/09 20:08:32.573556 269     server/server.go:113    device plugin (Ascend910) start serving.<br>[INFO]     2025/07/09 20:08:32.625129 269     server/server.go:57    register Ascend910 to kubelet success.<br>[INFO]     2025/07/09 20:08:32.625923 308     server/plugin.go:295    receive ListAndWatch from kubelet, deviceType=Ascend910, server restartTimes=0<br>[INFO]     2025/07/09 20:08:32.626171 308     server/plugin.go:201    ListAndWatch resp devices: inner device: Ascend910-0 Healthy, real device: Ascend910-0 Healthy, NotPodUsed: false<br>[INFO]     2025/07/09 20:08:32.626314 308     server/plugin.go:201    ListAndWatch resp devices: inner device: Ascend910-1 Healthy, real device: Ascend910-1 Healthy, NotPodUsed: false<br>[INFO]     2025/07/09 20:08:32.626441 308     server/plugin.go:201    ListAndWatch resp devices: inner device: Ascend910-2 Healthy, real device: Ascend910-2 Healthy, NotPodUsed: false<br>[INFO]     2025/07/09 20:08:32.626562 308     server/plugin.go:201    ListAndWatch resp devices: inner device: Ascend910-3 Healthy, real device: Ascend910-3 Healthy, NotPodUsed: false<br>[INFO]     2025/07/09 20:08:32.626684 308     server/plugin.go:201    ListAndWatch resp devices: inner device: Ascend910-4 Healthy, real device: Ascend910-4 Healthy, NotPodUsed: false<br>[INFO]     2025/07/09 20:08:32.626845 308     server/plugin.go:201    ListAndWatch resp devices: inner device: Ascend910-5 Healthy, real device: Ascend910-5 Healthy, NotPodUsed: false<br>[INFO]     2025/07/09 20:08:32.626985 308     server/plugin.go:201    ListAndWatch resp devices: inner device: Ascend910-6 Healthy, real device: Ascend910-6 Healthy, NotPodUsed: false<br>[INFO]     2025/07/09 20:08:32.627106 308     server/plugin.go:201    ListAndWatch resp devices: inner device: Ascend910-7 Healthy, real device: Ascend910-7 Healthy, NotPodUsed: false<br>[INFO]     2025/07/09 20:08:32.627423 308     server/plugin.go:264    send device-info to kubelet success, deviceType=Ascend910<br>[INFO]     2025/07/09 20:08:37.743740 265     kubeclient/kube_connect.go:105    init kubeConfig success<br>[INFO]     2025/07/09 20:08:37.890015 312     device/ascendtolerance.go:165    starting handle reset-cm event<br>[INFO]     2025/07/09 20:08:37.947513 265     kubeclient/client_server.go:338    reset annotation success<br>[INFO]     2025/07/09 20:08:37.965517 265     device/ascendcommon.go:294    write deviceInfo into configMap cache success, time is 2025-07-09T20:08:37+08:00<br>[INFO]     2025/07/09 20:10:36.824006 259     kubeclient/kube_cache.go:117    pod(volcano-system/volcano-scheduler-777cc9fdbc-czjwt) is update to cache<br>[INFO]     2025/07/09 20:10:36.825752 259     kubeclient/kube_cache.go:117    pod(volcano-system/volcano-controllers-7d7b54c6bb-q5hbw) is update to cache<br>[INFO]     2025/07/09 20:10:36.858450 259     kubeclient/kube_cache.go:117    pod(volcano-system/volcano-controllers-7d7b54c6bb-dqfn8) is add to cache<br>[INFO]     2025/07/09 20:10:36.859761 259     kubeclient/kube_cache.go:117    pod(volcano-system/volcano-scheduler-777cc9fdbc-dzgvj) is add to cache<br>[INFO]     2025/07/09 20:10:36.918913 259     kubeclient/kube_cache.go:117    pod(volcano-system/volcano-controllers-7d7b54c6bb-dqfn8) is update to cache<br>[INFO]     2025/07/09 20:10:36.919127 259     kubeclient/kube_cache.go:117    pod(volcano-system/volcano-scheduler-777cc9fdbc-dzgvj) is update to cache<br>[INFO]     2025/07/09 20:10:38.272696 259     kubeclient/kube_cache.go:117    pod(volcano-system/volcano-scheduler-777cc9fdbc-dzgvj) is update to cache<br>[INFO]     2025/07/09 20:10:38.290093 259     kubeclient/kube_cache.go:117    pod(volcano-system/volcano-controllers-7d7b54c6bb-q5hbw) is update to cache<br>[INFO]     2025/07/09 20:10:38.297826 259     kubeclient/kube_cache.go:117    pod(volcano-system/volcano-controllers-7d7b54c6bb-q5hbw) is update to cache<br>[INFO]     2025/07/09 20:10:38.301661 259     kubeclient/kube_cache.go:123    pod(volcano-system/volcano-controllers-7d7b54c6bb-q5hbw) is deleted from cache<br>[INFO]     2025/07/09 20:10:38.321444 259     kubeclient/kube_cache.go:117    pod(volcano-system/volcano-controllers-7d7b54c6bb-dqfn8) is update to cache<br>[INFO]     2025/07/09 20:10:38.402595 259     kubeclient/kube_cache.go:117    pod(volcano-system/volcano-scheduler-777cc9fdbc-czjwt) is update to cache<br>[INFO]     2025/07/09 20:10:38.593594 259     kubeclient/kube_cache.go:117    pod(volcano-system/volcano-scheduler-777cc9fdbc-czjwt) is update to cache<br>[INFO]     2025/07/09 20:10:38.597847 259     kubeclient/kube_cache.go:123    pod(volcano-system/volcano-scheduler-777cc9fdbc-czjwt) is deleted from cache<br>[INFO]     2025/07/09 20:13:41.420596 265     device/ascendcommon.go:294    write deviceInfo into configMap cache success, time is 2025-07-09T20:13:41+08:00<br>[INFO]     2025/07/09 20:18:44.035296 265     device/ascendcommon.go:294    write deviceInfo into configMap cache success, time is 2025-07-09T20:18:44+08:00<br></code></pre></td></tr></table></figure>
<h5 id="k8s节点信息">k8s节点信息</h5>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">k8s集群只有一个节点</span><br>root@controller01:/opt/jiang/test-npu-tasks# kubectl get nodes -o wide<br>NAME           STATUS   ROLES                         AGE   VERSION    INTERNAL-IP     EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION      CONTAINER-RUNTIME<br>controller01   Ready    control-plane,master,worker   4d    v1.23.17   113.57.37.106   &lt;none&gt;        Ubuntu 22.04.4 LTS   5.15.0-94-generic   docker://20.10.24<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">查看节点详细信息</span><br>root@controller01:/opt/jiang/test-npu-tasks# kubectl describe node controller01<br>Name:               controller01<br>Roles:              control-plane,master,worker<br>Labels:             accelerator=huawei-Ascend910<br>                    accelerator-type=module-910b-8<br>                    beta.kubernetes.io/arch=arm64<br>                    beta.kubernetes.io/os=linux<br>                    host-arch=huawei-arm<br>                    kubernetes.io/arch=arm64<br>                    kubernetes.io/hostname=controller01<br>                    kubernetes.io/os=linux<br>                    masterselector=dls-master-node<br>                    mind-cluster/npu-chip-memory=64G<br>                    node-role.kubernetes.io/control-plane=<br>                    node-role.kubernetes.io/master=<br>                    node-role.kubernetes.io/worker=worker<br>                    node.kubernetes.io/exclude-from-external-load-balancers=<br>                    node.kubernetes.io/npu.chip.name=910B3<br>                    nodeDEnable=on<br>                    servertype=Ascend910B-20<br>                    workerselector=dls-worker-node<br>Annotations:        baseDeviceInfos:<br>                      &#123;&quot;Ascend910-0&quot;:&#123;&quot;IP&quot;:&quot;&quot;,&quot;SuperDeviceID&quot;:4290772992&#125;,&quot;Ascend910-1&quot;:&#123;&quot;IP&quot;:&quot;&quot;,&quot;SuperDeviceID&quot;:4291035137&#125;,&quot;Ascend910-2&quot;:&#123;&quot;IP&quot;:&quot;&quot;,&quot;SuperDevice...<br>                    flannel.alpha.coreos.com/backend-data: &#123;&quot;VNI&quot;:1,&quot;VtepMAC&quot;:&quot;56:43:0c:83:5c:c2&quot;&#125;<br>                    flannel.alpha.coreos.com/backend-type: vxlan<br>                    flannel.alpha.coreos.com/kube-subnet-manager: true<br>                    flannel.alpha.coreos.com/public-ip: 113.57.37.106<br>                    kubeadm.alpha.kubernetes.io/cri-socket: /var/run/dockershim.sock<br>                    node.alpha.kubernetes.io/ttl: 0<br>                    product-serial-number: YS2B31202543<br>                    superPodID: -1<br>                    volumes.kubernetes.io/controller-managed-attach-detach: true<br>CreationTimestamp:  Sat, 05 Jul 2025 20:12:33 +0800<br>Taints:             &lt;none&gt;<br>Unschedulable:      false<br>Lease:<br>  HolderIdentity:  controller01<br>  AcquireTime:     &lt;unset&gt;<br>  RenewTime:       Wed, 09 Jul 2025 20:23:55 +0800<br>Conditions:<br>  Type                 Status  LastHeartbeatTime                 LastTransitionTime                Reason                       Message<br>  ----                 ------  -----------------                 ------------------                ------                       -------<br>  NetworkUnavailable   False   Mon, 07 Jul 2025 17:20:42 +0800   Mon, 07 Jul 2025 17:20:42 +0800   FlannelIsUp                  Flannel is running on this node<br>  MemoryPressure       False   Wed, 09 Jul 2025 20:18:54 +0800   Sat, 05 Jul 2025 20:12:29 +0800   KubeletHasSufficientMemory   kubelet has sufficient memory available<br>  DiskPressure         False   Wed, 09 Jul 2025 20:18:54 +0800   Sat, 05 Jul 2025 20:12:29 +0800   KubeletHasNoDiskPressure     kubelet has no disk pressure<br>  PIDPressure          False   Wed, 09 Jul 2025 20:18:54 +0800   Sat, 05 Jul 2025 20:12:29 +0800   KubeletHasSufficientPID      kubelet has sufficient PID available<br>  Ready                True    Wed, 09 Jul 2025 20:18:54 +0800   Sat, 05 Jul 2025 20:18:36 +0800   KubeletReady                 kubelet is posting ready status. AppArmor enabled<br>Addresses:<br>  InternalIP:  113.57.37.106<br>  Hostname:    controller01<br>Capacity:<br>  cpu:                   192<br>  ephemeral-storage:     1030992024Ki<br>  huawei.com/Ascend910:  8<br>  hugepages-1Gi:         0<br>  hugepages-2Mi:         0<br>  hugepages-32Mi:        0<br>  hugepages-64Ki:        0<br>  memory:                1054450268Ki<br>  pods:                  110<br>Allocatable:<br>  cpu:                   192<br>  ephemeral-storage:     950162247746<br>  huawei.com/Ascend910:  8<br>  hugepages-1Gi:         0<br>  hugepages-2Mi:         0<br>  hugepages-32Mi:        0<br>  hugepages-64Ki:        0<br>  memory:                1054347868Ki<br>  pods:                  110<br>System Info:<br>  Machine ID:                 6c7711610158450c8b86fee268b11013<br>  System UUID:                a639ef03-b04f-86f2-ee11-039040afc4a4<br>  Boot ID:                    74951e79-a2e0-4220-91fe-ab98c239fb64<br>  Kernel Version:             5.15.0-94-generic<br>  OS Image:                   Ubuntu 22.04.4 LTS<br>  Operating System:           linux<br>  Architecture:               arm64<br>  Container Runtime Version:  docker://20.10.24<br>  Kubelet Version:            v1.23.17<br>  Kube-Proxy Version:         v1.23.17<br>PodCIDR:                      10.250.0.0/24<br>PodCIDRs:                     10.250.0.0/24<br>Non-terminated Pods:          (16 in total)<br>  Namespace                   Name                                        CPU Requests  CPU Limits  Memory Requests  Memory Limits  Age<br>  ---------                   ----                                        ------------  ----------  ---------------  -------------  ---<br>  kube-flannel                kube-flannel-ds-shsdv                       100m (0%)     0 (0%)      50Mi (0%)        0 (0%)         3d23h<br>  kube-system                 ascend-device-plugin-daemonset-910-gdrk9    500m (0%)     500m (0%)   500Mi (0%)       500Mi (0%)     18m<br>  kube-system                 coredns-6d8c4cb4d-fmjkw                     100m (0%)     0 (0%)      70Mi (0%)        170Mi (0%)     4d<br>  kube-system                 coredns-6d8c4cb4d-nzn5v                     100m (0%)     0 (0%)      70Mi (0%)        170Mi (0%)     4d<br>  kube-system                 etcd-controller01                           100m (0%)     0 (0%)      100Mi (0%)       0 (0%)         4d<br>  kube-system                 kube-apiserver-controller01                 250m (0%)     0 (0%)      0 (0%)           0 (0%)         4d<br>  kube-system                 kube-controller-manager-controller01        200m (0%)     0 (0%)      0 (0%)           0 (0%)         4d<br>  kube-system                 kube-proxy-7cccn                            0 (0%)        0 (0%)      0 (0%)           0 (0%)         4d<br>  kube-system                 kube-scheduler-controller01                 100m (0%)     0 (0%)      0 (0%)           0 (0%)         4d<br>  mindx-dl                    ascend-operator-manager-65557b4b45-npwcx    2 (1%)        2 (1%)      3Gi (0%)         3Gi (0%)       2d7h<br>  mindx-dl                    clusterd-65d6d749dd-qjcgg                   1 (0%)        1 (0%)      1Gi (0%)         1Gi (0%)       2d7h<br>  mindx-dl                    noded-bbpwh                                 500m (0%)     500m (0%)   300Mi (0%)       300Mi (0%)     2d7h<br>  npu-exporter                npu-exporter-bgxn4                          1 (0%)        1 (0%)      1000Mi (0%)      1000Mi (0%)    2d7h<br>  volcano-system              volcano-admission-784b85dc8b-vfdz5          0 (0%)        0 (0%)      0 (0%)           0 (0%)         7h35m<br>  volcano-system              volcano-controllers-7d7b54c6bb-dqfn8        2 (1%)        2 (1%)      3Gi (0%)         3Gi (0%)       13m<br>  volcano-system              volcano-scheduler-777cc9fdbc-dzgvj          5500m (2%)    5500m (2%)  4Gi (0%)         8Gi (0%)       13m<br>Allocated resources:<br>  (Total limits may be over 100 percent, i.e., overcommitted.)<br>  Resource              Requests      Limits<br>  --------              --------      ------<br>  cpu                   13450m (7%)   12500m (6%)<br>  memory                13354Mi (1%)  17500Mi (1%)<br>  ephemeral-storage     0 (0%)        0 (0%)<br>  hugepages-1Gi         0 (0%)        0 (0%)<br>  hugepages-2Mi         0 (0%)        0 (0%)<br>  hugepages-32Mi        0 (0%)        0 (0%)<br>  hugepages-64Ki        0 (0%)        0 (0%)<br>  huawei.com/Ascend910  0             0<br>Events:                 &lt;none&gt;<br></code></pre></td></tr></table></figure>
<h5 id="k8s节点标签">k8s节点标签</h5>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:/opt/jiang/test-npu-tasks# kubectl get nodes --show-labels | grep accelerator-type                          <br>controller01   Ready    control-plane,master,worker   3d20h   v1.23.17   accelerator-type=module-910b-8,accelerator=huawei-Ascend910,beta.kubernetes.io/arch=arm64,beta.kubernetes.io/os=linux,host-arch=huawei-arm,kubernetes.io/arch=arm64,kubernetes.io/hostname=controller01,kubernetes.io/os=linux,masterselector=dls-master-node,mind-cluster/npu-chip-memory=64G,node-role.kubernetes.io/control-plane=,node-role.kubernetes.io/master=,node-role.kubernetes.io/worker=worker,node.kubernetes.io/exclude-from-external-load-balancers=,node.kubernetes.io/npu.chip.name=910B3,nodeDEnable=on,servertype=Ascend910B-20,workerselector=dls-worker-node<br></code></pre></td></tr></table></figure>
<h5 id="查看内核日志">查看内核日志</h5>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@controller01:/opt/jiang/test-npu-tasks# dmesg | grep npu<br>[    9.729827] ACPI: IORT: [Firmware Bug]: [map 000000000ea40318] conflicting mapping for input ID 0x3c00<br>[   11.216647] ACPI: IORT: [Firmware Bug]: [map 00000000bce0839a] conflicting mapping for input ID 0x7c00<br>[   12.481804] ACPI: IORT: [Firmware Bug]: [map 00000000b4d7ef88] conflicting mapping for input ID 0xbc00<br>[   13.867667] ACPI: IORT: [Firmware Bug]: [map 00000000e8b00c76] conflicting mapping for input ID 0xfc00<br>[   14.712007] ACPI: IORT: [Firmware Bug]: [map 000000000ea40318] conflicting mapping for input ID 0x3c00<br>[   14.793857] ACPI: IORT: [Firmware Bug]: [map 00000000bce0839a] conflicting mapping for input ID 0x7c00<br>[   14.922641] ACPI: IORT: [Firmware Bug]: [map 00000000b4d7ef88] conflicting mapping for input ID 0xbc00<br>[   15.009932] ACPI: IORT: [Firmware Bug]: [map 00000000e8b00c76] conflicting mapping for input ID 0xfc00<br>[   15.034418] input: Power Button as /devices/LNXSYSTM:00/LNXSYBUS:00/PNP0C0C:00/input/input0<br>[   20.763981] input: Keyboard/Mouse KVM 2.0 as /devices/pci0000:3a/0000:3a:01.0/usb1/1-1/1-1:1.0/0003:12D1:0001.0001/input/input1<br>[   20.820858] hid-generic 0003:12D1:0001.0001: input,hidraw0: USB HID v2.00 Keyboard [Keyboard/Mouse KVM 2.0] on usb-0000:3a:01.0-1/input0<br>[   20.821009] input: Keyboard/Mouse KVM 2.0 as /devices/pci0000:3a/0000:3a:01.0/usb1/1-1/1-1:1.1/0003:12D1:0001.0002/input/input2<br>[   20.821122] hid-generic 0003:12D1:0001.0002: input,hidraw1: USB HID v2.00 Mouse [Keyboard/Mouse KVM 2.0] on usb-0000:3a:01.0-1/input1<br>[   52.743278] vnpu 0000:c1:00.0: MDEV: Registered<br>[   52.859139] vnpu 0000:c2:00.0: MDEV: Registered<br>[   54.865095] vnpu 0000:01:00.0: MDEV: Registered<br>[   54.865455] vnpu 0000:81:00.0: MDEV: Registered<br>[   54.865707] vnpu 0000:02:00.0: MDEV: Registered<br>[   55.227787] vnpu 0000:42:00.0: MDEV: Registered<br>[   55.228162] vnpu 0000:41:00.0: MDEV: Registered<br>[   55.228515] vnpu 0000:82:00.0: MDEV: Registered<br></code></pre></td></tr></table></figure>
<h5 id="解决办法">解决办法</h5>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">根据昇腾社区的提示，找到一个文档</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">“https://www.hiascend.com/document/detail/zh/mindcluster/70rc1/clustersched/dlug/dlug_installation_013.html”</span> <br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">参照此文档，需要在此节点打上标签：</span><br>root@controller01:/opt/jiang/test-npu-tasks# kubectl label node controller01 accelerator-type=module --overwrite<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">此时vcjob调度成功</span><br>root@controller01:/opt/jiang/test-npu-tasks# kubectl -n vcjob get pods<br>NAME                            READY   STATUS    RESTARTS      AGE<br>mindx-dls-test-default-test-0   1/1     Running   2 (30s ago)   13h<br></code></pre></td></tr></table></figure>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E7%AE%97%E5%8A%9B%E5%8F%8A%E8%B0%83%E5%BA%A6/" class="category-chain-item">算力及调度</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E7%AE%97%E5%8A%9B%E5%8F%8A%E8%B0%83%E5%BA%A6/" class="print-no-link">#算力及调度</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div></div>
      <div>https://jiangsanyin.github.io/2025/07/02/ARM64服务器910B部署与使用volcano/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>sanyinjiang</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年7月2日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/07/05/k8s%E5%9C%A8%E7%BA%BF%E9%83%A8%E7%BD%B2-kubeadm%E9%83%A8%E7%BD%B2arm64%E5%8D%95%E6%9C%BA%E7%89%88k8s1.23.17/" title="k8s在线部署-kubeadm部署arm64单机版k8s1.23.17">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">k8s在线部署-kubeadm部署arm64单机版k8s1.23.17</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/06/29/%E4%BB%8Etensorflow1.8.0%E5%8D%87%E7%BA%A7%E5%88%B02.14.0%E5%B9%B6%E6%94%AF%E6%8C%81%E4%BD%BF%E7%94%A8NVIDIA%20GPU%E5%81%9Amnist%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%AD%E7%BB%83/" title="从tensorflow1.8.0升级到2.14.0并支持使用NVIDIA GPU做mnist分布式训练">
                        <span class="hidden-mobile">从tensorflow1.8.0升级到2.14.0并支持使用NVIDIA GPU做mnist分布式训练</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"lhgjNNoNy5Syl0F4Bw8i5P5K-gzGzoHsz","appKey":"0d6M8Wx7ZmYewOQqA20Nbqen","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>





  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
